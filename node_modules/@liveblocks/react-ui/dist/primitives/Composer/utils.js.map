{"version":3,"file":"utils.js","sources":["../../../src/primitives/Composer/utils.ts"],"sourcesContent":["import type {\n  DetectOverflowOptions,\n  Placement,\n  UseFloatingOptions,\n} from \"@floating-ui/react-dom\";\nimport {\n  autoUpdate,\n  flip,\n  hide,\n  inline,\n  limitShift,\n  offset,\n  shift,\n  size,\n  useFloating,\n} from \"@floating-ui/react-dom\";\nimport type {\n  Client,\n  CommentAttachment,\n  CommentBody,\n  CommentBodyLink,\n  CommentBodyMention,\n  CommentLocalAttachment,\n  CommentMixedAttachment,\n} from \"@liveblocks/core\";\nimport {\n  HttpError,\n  isCommentBodyLink,\n  isCommentBodyMention,\n  isCommentBodyText,\n  kInternal,\n  makeEventSource,\n} from \"@liveblocks/core\";\nimport { useClient } from \"@liveblocks/react\";\nimport { useLatest, useLayoutEffect } from \"@liveblocks/react/_private\";\nimport type { DragEvent } from \"react\";\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n  useSyncExternalStore,\n} from \"react\";\n\nimport {\n  FLOATING_ELEMENT_COLLISION_PADDING,\n  FLOATING_ELEMENT_SIDE_OFFSET,\n} from \"../../constants\";\nimport type {\n  ComposerBody,\n  ComposerBodyAutoLink,\n  ComposerBodyCustomLink,\n  ComposerBodyMention,\n  ComposerBodyText,\n  Direction,\n} from \"../../types\";\nimport { getFiles } from \"../../utils/data-transfer\";\nimport { exists } from \"../../utils/exists\";\nimport { useInitial } from \"../../utils/use-initial\";\nimport { isText } from \"../slate/utils/is-text\";\nimport { useComposer, useComposerAttachmentsContext } from \"./contexts\";\nimport { isComposerBodyAutoLink } from \"./slate/plugins/auto-links\";\nimport { isComposerBodyCustomLink } from \"./slate/plugins/custom-links\";\nimport { isComposerBodyMention } from \"./slate/plugins/mentions\";\nimport type { FloatingAlignment, FloatingPosition } from \"./types\";\n\nexport function composerBodyMentionToCommentBodyMention(\n  mention: ComposerBodyMention\n): CommentBodyMention {\n  const { children: _, ...commentBodyMention } = mention;\n\n  return commentBodyMention;\n}\n\nexport function composerBodyAutoLinkToCommentBodyLink(\n  link: ComposerBodyAutoLink\n): CommentBodyLink {\n  return {\n    type: \"link\",\n    url: link.url,\n  };\n}\n\nexport function composerBodyCustomLinkToCommentBodyLink(\n  link: ComposerBodyCustomLink\n): CommentBodyLink {\n  return {\n    type: \"link\",\n    url: link.url,\n    text: link.children.map((child) => child.text).join(\"\"),\n  };\n}\n\nexport function commentBodyMentionToComposerBodyMention(\n  mention: CommentBodyMention\n): ComposerBodyMention {\n  return {\n    ...mention,\n    children: [{ text: \"\" }],\n  };\n}\n\nexport function commentBodyLinkToComposerBodyLink(\n  link: CommentBodyLink\n): ComposerBodyAutoLink | ComposerBodyCustomLink {\n  if (link.text) {\n    return {\n      type: \"custom-link\",\n      url: link.url,\n      children: [{ text: link.text }],\n    };\n  } else {\n    return {\n      type: \"auto-link\",\n      url: link.url,\n      children: [{ text: link.url }],\n    };\n  }\n}\n\nexport function composerBodyToCommentBody(body: ComposerBody): CommentBody {\n  return {\n    version: 1,\n    content: body\n      .map((block) => {\n        // All root blocks are paragraphs at the moment\n        if (block.type !== \"paragraph\") {\n          return null;\n        }\n\n        const children = block.children\n          .map((inline) => {\n            if (isComposerBodyMention(inline)) {\n              return composerBodyMentionToCommentBodyMention(inline);\n            }\n\n            if (isComposerBodyAutoLink(inline)) {\n              return composerBodyAutoLinkToCommentBodyLink(inline);\n            }\n\n            if (isComposerBodyCustomLink(inline)) {\n              return composerBodyCustomLinkToCommentBodyLink(inline);\n            }\n\n            if (isText(inline)) {\n              return inline;\n            }\n\n            return null;\n          })\n          .filter(exists);\n\n        return {\n          ...block,\n          children,\n        };\n      })\n      .filter(exists),\n  };\n}\n\nconst emptyComposerBody: ComposerBody = [];\n\nexport function commentBodyToComposerBody(body: CommentBody): ComposerBody {\n  if (!body || !body?.content) {\n    return emptyComposerBody;\n  }\n\n  return body.content\n    .map((block) => {\n      // All root blocks are paragraphs at the moment\n      if (block.type !== \"paragraph\") {\n        return null;\n      }\n\n      const children = block.children\n        .map((inline) => {\n          if (isCommentBodyMention(inline)) {\n            return commentBodyMentionToComposerBodyMention(inline);\n          }\n\n          if (isCommentBodyLink(inline)) {\n            return commentBodyLinkToComposerBodyLink(inline);\n          }\n\n          if (isCommentBodyText(inline)) {\n            return inline as ComposerBodyText;\n          }\n\n          return null;\n        })\n        .filter(exists);\n\n      return {\n        ...block,\n        children,\n      };\n    })\n    .filter(exists);\n}\n\nexport function getRtlFloatingAlignment(\n  alignment: FloatingAlignment\n): FloatingAlignment {\n  switch (alignment) {\n    case \"start\":\n      return \"end\";\n    case \"end\":\n      return \"start\";\n    default:\n      return \"center\";\n  }\n}\n\nexport function getSideAndAlignFromFloatingPlacement(placement: Placement) {\n  const [side, align = \"center\"] = placement.split(\"-\");\n\n  return [side, align] as const;\n}\n\n// Copy `z-index` from content to wrapper.\n// Inspired by https://github.com/radix-ui/primitives/blob/main/packages/react/popper/src/Popper.tsx\nexport function useContentZIndex() {\n  const [content, setContent] = useState<HTMLDivElement | null>(null);\n  const contentRef = useCallback(setContent, [setContent]);\n  const [contentZIndex, setContentZIndex] = useState<string>();\n\n  useLayoutEffect(() => {\n    if (content) {\n      setContentZIndex(window.getComputedStyle(content).zIndex);\n    }\n  }, [content]);\n\n  return [contentRef, contentZIndex] as const;\n}\n\nexport function useFloatingWithOptions({\n  type = \"bounds\",\n  position,\n  alignment,\n  dir,\n  open,\n}: {\n  type?: \"bounds\" | \"range\";\n  position: FloatingPosition;\n  alignment: FloatingAlignment;\n  dir: Direction | undefined;\n  open: boolean;\n}) {\n  const floatingOptions: UseFloatingOptions = useMemo(() => {\n    const detectOverflowOptions: DetectOverflowOptions = {\n      padding: FLOATING_ELEMENT_COLLISION_PADDING,\n    };\n\n    const middleware = [\n      type === \"range\" ? inline(detectOverflowOptions) : null,\n      flip({ ...detectOverflowOptions, crossAxis: false }),\n      hide(detectOverflowOptions),\n      shift({\n        ...detectOverflowOptions,\n        limiter: limitShift(),\n      }),\n      type === \"range\" ? offset(FLOATING_ELEMENT_SIDE_OFFSET) : null,\n      size({\n        ...detectOverflowOptions,\n        apply({ availableWidth, availableHeight, elements }) {\n          elements.floating.style.setProperty(\n            \"--lb-composer-floating-available-width\",\n            `${availableWidth}px`\n          );\n          elements.floating.style.setProperty(\n            \"--lb-composer-floating-available-height\",\n            `${availableHeight}px`\n          );\n        },\n      }),\n    ];\n\n    return {\n      strategy: \"fixed\",\n      placement:\n        alignment === \"center\"\n          ? position\n          : (`${position}-${dir === \"rtl\" ? getRtlFloatingAlignment(alignment) : alignment}` as Placement),\n      middleware,\n      whileElementsMounted: (...args) => {\n        return autoUpdate(...args, {\n          animationFrame: true,\n        });\n      },\n    };\n  }, [alignment, position, dir, type]);\n\n  return useFloating({\n    ...floatingOptions,\n    open,\n  });\n}\n\nexport function useComposerAttachmentsDropArea<\n  T extends HTMLElement = HTMLElement,\n>({\n  onDragEnter,\n  onDragLeave,\n  onDragOver,\n  onDrop,\n  disabled,\n}: {\n  onDragEnter?: (event: DragEvent<T>) => void;\n  onDragLeave?: (event: DragEvent<T>) => void;\n  onDragOver?: (event: DragEvent<T>) => void;\n  onDrop?: (event: DragEvent<T>) => void;\n  disabled?: boolean;\n}) {\n  const { isDisabled: isComposerDisabled } = useComposer();\n  const isDisabled = isComposerDisabled || disabled;\n  const { createAttachments } = useComposerAttachmentsContext();\n  const [isDraggingOver, setDraggingOver] = useState(false);\n  const latestIsDraggingOver = useLatest(isDraggingOver);\n\n  const handleDragEnter = useCallback(\n    (event: DragEvent<T>) => {\n      onDragEnter?.(event);\n\n      if (\n        latestIsDraggingOver.current ||\n        isDisabled ||\n        event.isDefaultPrevented()\n      ) {\n        return;\n      }\n\n      const dataTransfer = event.dataTransfer;\n\n      if (!dataTransfer.types.includes(\"Files\")) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      setDraggingOver(true);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [onDragEnter, isDisabled]\n  );\n\n  const handleDragLeave = useCallback(\n    (event: DragEvent<T>) => {\n      onDragLeave?.(event);\n\n      if (\n        !latestIsDraggingOver.current ||\n        isDisabled ||\n        event.isDefaultPrevented()\n      ) {\n        return;\n      }\n\n      // Ignore drag leave events that are not actually leaving the drop area\n      if (\n        event.relatedTarget\n          ? event.relatedTarget === event.currentTarget ||\n            event.currentTarget.contains(event.relatedTarget as HTMLElement)\n          : event.currentTarget !== event.target\n      ) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      setDraggingOver(false);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [onDragLeave, isDisabled]\n  );\n\n  const handleDragOver = useCallback(\n    (event: DragEvent<T>) => {\n      onDragOver?.(event);\n\n      if (isDisabled || event.isDefaultPrevented()) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n    },\n    [onDragOver, isDisabled]\n  );\n\n  const handleDrop = useCallback(\n    (event: DragEvent<T>) => {\n      onDrop?.(event);\n\n      if (\n        !latestIsDraggingOver.current ||\n        isDisabled ||\n        event.isDefaultPrevented()\n      ) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      setDraggingOver(false);\n\n      const files = getFiles(event.dataTransfer);\n\n      createAttachments(files);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [onDrop, isDisabled, createAttachments]\n  );\n\n  return [\n    isDraggingOver,\n    {\n      onDragEnter: handleDragEnter,\n      onDragLeave: handleDragLeave,\n      onDragOver: handleDragOver,\n      onDrop: handleDrop,\n      \"data-drop\": isDraggingOver ? \"\" : undefined,\n      \"data-disabled\": isDisabled ? \"\" : undefined,\n    } as const,\n  ] as const;\n}\n\ninterface ComposerAttachmentsManagerOptions {\n  maxFileSize: number;\n  roomId: string;\n}\n\nexport class AttachmentTooLargeError extends Error {\n  origin: \"client\" | \"server\";\n  name = \"AttachmentTooLargeError\";\n\n  constructor(message: string, origin: \"client\" | \"server\" = \"client\") {\n    super(message);\n    this.origin = origin;\n  }\n}\n\nfunction createComposerAttachmentsManager(\n  client: Client,\n  roomId: string,\n  options: ComposerAttachmentsManagerOptions\n) {\n  const attachments: Map<string, CommentMixedAttachment> = new Map();\n  const abortControllers: Map<string, AbortController> = new Map();\n  const eventSource = makeEventSource<void>();\n  let cachedSnapshot: CommentMixedAttachment[] | null = null;\n\n  function notifySubscribers() {\n    // Invalidate the cached snapshot\n    cachedSnapshot = null;\n    eventSource.notify();\n  }\n\n  function uploadAttachment(attachment: CommentLocalAttachment) {\n    const abortController = new AbortController();\n    abortControllers.set(attachment.id, abortController);\n\n    client[kInternal].httpClient\n      .uploadAttachment({\n        roomId,\n        attachment,\n        signal: abortController.signal,\n      })\n      .then(() => {\n        attachments.set(attachment.id, {\n          ...attachment,\n          status: \"uploaded\",\n        });\n        notifySubscribers();\n      })\n      .catch((error) => {\n        if (\n          error instanceof Error &&\n          error.name !== \"AbortError\" &&\n          error.name !== \"TimeoutError\"\n        ) {\n          attachments.set(attachment.id, {\n            ...attachment,\n            status: \"error\",\n            error:\n              error instanceof HttpError && error.status === 413\n                ? new AttachmentTooLargeError(\"File is too large.\", \"server\")\n                : error,\n          });\n          notifySubscribers();\n        }\n      });\n  }\n\n  function addAttachments(addedAttachments: CommentMixedAttachment[]) {\n    if (addedAttachments.length === 0) {\n      return;\n    }\n\n    // Ignore attachments that are already in the manager\n    const newAttachments = addedAttachments.filter(\n      (attachment) => !attachments.has(attachment.id)\n    );\n\n    const attachmentsToUpload: CommentLocalAttachment[] = [];\n\n    // Add all the new attachments to the manager\n    for (const attachment of newAttachments) {\n      if (attachment.type === \"localAttachment\") {\n        // The file is too large to be uploaded\n        if (attachment.file.size > options.maxFileSize) {\n          attachments.set(attachment.id, {\n            ...attachment,\n            status: \"error\",\n            error: new AttachmentTooLargeError(\"File is too large.\", \"client\"),\n          });\n\n          continue;\n        }\n\n        // Otherwise, mark the attachment to be uploaded\n        attachments.set(attachment.id, {\n          ...attachment,\n          status: \"uploading\",\n        });\n        attachmentsToUpload.push(attachment);\n      } else {\n        attachments.set(attachment.id, attachment);\n      }\n    }\n\n    // Notify subscribers about the new attachments that were added\n    if (newAttachments.length > 0) {\n      notifySubscribers();\n    }\n\n    // Upload all the new local attachments\n    for (const attachment of attachmentsToUpload) {\n      uploadAttachment(attachment);\n    }\n  }\n\n  function removeAttachment(attachmentId: string) {\n    const abortController = abortControllers.get(attachmentId);\n\n    abortController?.abort();\n\n    attachments.delete(attachmentId);\n    abortControllers.delete(attachmentId);\n\n    notifySubscribers();\n  }\n\n  function getSnapshot() {\n    if (!cachedSnapshot) {\n      cachedSnapshot = Array.from(attachments.values());\n    }\n\n    return cachedSnapshot;\n  }\n\n  // Clear all attachments and abort all ongoing uploads\n  function clear() {\n    abortControllers.forEach((controller) => controller.abort());\n    abortControllers.clear();\n    attachments.clear();\n\n    notifySubscribers();\n  }\n\n  return {\n    addAttachments,\n    removeAttachment,\n    getSnapshot,\n    subscribe: eventSource.subscribe,\n    clear,\n  };\n}\n\nfunction preventBeforeUnloadDefault(event: BeforeUnloadEvent) {\n  event.preventDefault();\n}\n\nexport function useComposerAttachmentsManager(\n  defaultAttachments: CommentAttachment[],\n  options: ComposerAttachmentsManagerOptions\n) {\n  const client = useClient();\n  const frozenDefaultAttachments = useInitial(defaultAttachments);\n  const frozenAttachmentsManager = useInitial(() =>\n    createComposerAttachmentsManager(client, options.roomId, options)\n  );\n\n  // Initialize default attachments on mount\n  useEffect(() => {\n    frozenAttachmentsManager.addAttachments(frozenDefaultAttachments);\n  }, [frozenDefaultAttachments, frozenAttachmentsManager]);\n\n  // Clear on unmount\n  useEffect(() => {\n    return () => {\n      frozenAttachmentsManager.clear();\n    };\n  }, [frozenAttachmentsManager]);\n\n  const attachments = useSyncExternalStore(\n    frozenAttachmentsManager.subscribe,\n    frozenAttachmentsManager.getSnapshot,\n    frozenAttachmentsManager.getSnapshot\n  );\n\n  const isUploadingAttachments = useMemo(() => {\n    return attachments.some(\n      (attachment) =>\n        attachment.type === \"localAttachment\" &&\n        attachment.status === \"uploading\"\n    );\n  }, [attachments]);\n\n  useEffect(() => {\n    if (!isUploadingAttachments) {\n      return;\n    }\n\n    window.addEventListener(\"beforeunload\", preventBeforeUnloadDefault);\n\n    return () => {\n      window.removeEventListener(\"beforeunload\", preventBeforeUnloadDefault);\n    };\n  }, [isUploadingAttachments]);\n\n  return {\n    attachments,\n    isUploadingAttachments,\n    addAttachments: frozenAttachmentsManager.addAttachments,\n    removeAttachment: frozenAttachmentsManager.removeAttachment,\n    clearAttachments: frozenAttachmentsManager.clear,\n  };\n}\n"],"names":["inline"],"mappings":"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"}