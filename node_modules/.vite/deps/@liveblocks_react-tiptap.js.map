{
  "version": 3,
  "sources": ["../../direction/index.js", "../../lodash/isObject.js", "../../lodash/_freeGlobal.js", "../../lodash/_root.js", "../../lodash/now.js", "../../lodash/_trimmedEndIndex.js", "../../lodash/_baseTrim.js", "../../lodash/_Symbol.js", "../../lodash/_getRawTag.js", "../../lodash/_objectToString.js", "../../lodash/_baseGetTag.js", "../../lodash/isObjectLike.js", "../../lodash/isSymbol.js", "../../lodash/toNumber.js", "../../lodash/debounce.js", "../../lodash/throttle.js", "../../is-hotkey/lib/index.js", "../../@liveblocks/react-tiptap/src/version.ts", "../../@floating-ui/utils/dist/floating-ui.utils.mjs", "../../@floating-ui/core/dist/floating-ui.core.mjs", "../../@floating-ui/utils/dist/floating-ui.utils.dom.mjs", "../../@floating-ui/dom/dist/floating-ui.dom.mjs", "../../@floating-ui/react-dom/dist/floating-ui.react-dom.mjs", "../../@liveblocks/react/src/lib/use-layout-effect.ts", "../../@liveblocks/react/src/use-group.ts", "../../@liveblocks/react/src/use-mention-suggestions.ts", "../../@liveblocks/react/src/use-sync-source.ts", "../../@liveblocks/react-ui/src/utils/cn.ts", "../../@liveblocks/react-ui/src/utils/get-initials.ts", "../../@liveblocks/react/src/suspense.ts", "../../@liveblocks/react-ui/src/utils/use-initial.ts", "../../@liveblocks/react-ui/src/utils/use-user-or-group-info.ts", "../../@liveblocks/react-ui/src/components/internal/Avatar.tsx", "../../@liveblocks/react-ui/src/components/internal/Icon.tsx", "../../@liveblocks/react-ui/src/icons/ChevronDown.tsx", "../../@liveblocks/react-ui/src/components/internal/Button.tsx", "../../@liveblocks/react-ui/src/components/internal/Group.tsx", "../../@liveblocks/react-ui/src/components/internal/GroupDescription.tsx", "../../@radix-ui/react-slot/src/slot.tsx", "../../@radix-ui/react-compose-refs/src/compose-refs.tsx", "../../@liveblocks/react-ui/src/constants.ts", "../../@liveblocks/react-ui/src/components/internal/Emoji.tsx", "../../@liveblocks/react-ui/src/utils/memoize.ts", "../../@liveblocks/react-ui/src/utils/intl.ts", "../../@liveblocks/react-ui/src/utils/use-interval.ts", "../../@liveblocks/react-ui/src/utils/use-rerender.ts", "../../@liveblocks/react-ui/src/primitives/Duration.tsx", "../../@liveblocks/react-ui/src/utils/pluralize.ts", "../../@liveblocks/react-ui/src/overrides.tsx", "../../@liveblocks/react-ui/src/components/internal/List.tsx", "../../@liveblocks/react-ui/src/components.tsx", "../../marked/src/defaults.ts", "../../marked/src/rules.ts", "../../marked/src/helpers.ts", "../../marked/src/Tokenizer.ts", "../../marked/src/Lexer.ts", "../../marked/src/Renderer.ts", "../../marked/src/TextRenderer.ts", "../../marked/src/Parser.ts", "../../marked/src/Hooks.ts", "../../marked/src/Instance.ts", "../../marked/src/marked.ts", "../../@liveblocks/react-ui/src/primitives/Markdown.tsx", "../../@liveblocks/react-ui/src/icons/ArrowCornerDownRight.tsx", "../../@liveblocks/react-ui/src/icons/ArrowDown.tsx", "../../@liveblocks/react-ui/src/icons/Attachment.tsx", "../../@liveblocks/react-ui/src/icons/Bell.tsx", "../../@liveblocks/react-ui/src/icons/BellCrossed.tsx", "../../@liveblocks/react-ui/src/icons/Blockquote.tsx", "../../@liveblocks/react-ui/src/icons/Bold.tsx", "../../@liveblocks/react-ui/src/icons/Check.tsx", "../../@liveblocks/react-ui/src/icons/CheckCircle.tsx", "../../@liveblocks/react-ui/src/icons/CheckCircleFill.tsx", "../../@liveblocks/react-ui/src/icons/ChevronRight.tsx", "../../@liveblocks/react-ui/src/icons/Code.tsx", "../../@liveblocks/react-ui/src/icons/Comment.tsx", "../../@liveblocks/react-ui/src/icons/Copy.tsx", "../../@liveblocks/react-ui/src/icons/Cross.tsx", "../../@liveblocks/react-ui/src/icons/CrossCircleFill.tsx", "../../@liveblocks/react-ui/src/icons/Delete.tsx", "../../@liveblocks/react-ui/src/icons/Edit.tsx", "../../@liveblocks/react-ui/src/icons/Ellipsis.tsx", "../../@liveblocks/react-ui/src/icons/Emoji.tsx", "../../@liveblocks/react-ui/src/icons/EmojiPlus.tsx", "../../@liveblocks/react-ui/src/icons/H1.tsx", "../../@liveblocks/react-ui/src/icons/H2.tsx", "../../@liveblocks/react-ui/src/icons/H3.tsx", "../../@liveblocks/react-ui/src/icons/Italic.tsx", "../../@liveblocks/react-ui/src/icons/Lengthen.tsx", "../../@liveblocks/react-ui/src/icons/ListOrdered.tsx", "../../@liveblocks/react-ui/src/icons/ListUnordered.tsx", "../../@liveblocks/react-ui/src/icons/Mention.tsx", "../../@liveblocks/react-ui/src/icons/MinusCircle.tsx", "../../@liveblocks/react-ui/src/icons/QuestionMark.tsx", "../../@liveblocks/react-ui/src/icons/Redo.tsx", "../../@liveblocks/react-ui/src/icons/Restore.tsx", "../../@liveblocks/react-ui/src/icons/Search.tsx", "../../@liveblocks/react-ui/src/icons/Send.tsx", "../../@liveblocks/react-ui/src/icons/Shorten.tsx", "../../@liveblocks/react-ui/src/icons/Sparkles.tsx", "../../@liveblocks/react-ui/src/icons/SparklesText.tsx", "../../@liveblocks/react-ui/src/icons/Spinner.tsx", "../../@liveblocks/react-ui/src/icons/Stop.tsx", "../../@liveblocks/react-ui/src/icons/Strikethrough.tsx", "../../@liveblocks/react-ui/src/icons/Text.tsx", "../../@liveblocks/react-ui/src/icons/Underline.tsx", "../../@liveblocks/react-ui/src/icons/Undo.tsx", "../../@liveblocks/react-ui/src/icons/Users.tsx", "../../@liveblocks/react-ui/src/icons/Warning.tsx", "../../@radix-ui/react-tooltip/src/tooltip.tsx", "../../@radix-ui/primitive/src/primitive.tsx", "../../@radix-ui/react-context/src/create-context.tsx", "../../@radix-ui/react-dismissable-layer/src/dismissable-layer.tsx", "../../@radix-ui/react-primitive/src/primitive.tsx", "../../@radix-ui/react-use-callback-ref/src/use-callback-ref.tsx", "../../@radix-ui/react-use-escape-keydown/src/use-escape-keydown.tsx", "../../@radix-ui/react-id/src/id.tsx", "../../@radix-ui/react-use-layout-effect/src/use-layout-effect.tsx", "../../@radix-ui/react-popper/src/popper.tsx", "../../@radix-ui/react-arrow/src/arrow.tsx", "../../@radix-ui/react-use-size/src/use-size.tsx", "../../@radix-ui/react-portal/src/portal.tsx", "../../@radix-ui/react-presence/src/presence.tsx", "../../@radix-ui/react-presence/src/use-state-machine.tsx", "../../@radix-ui/react-use-controllable-state/src/use-controllable-state.tsx", "../../@radix-ui/react-use-controllable-state/src/use-controllable-state-reducer.tsx", "../../@radix-ui/react-use-effect-event/src/use-effect-event.tsx", "../../@radix-ui/react-visually-hidden/src/visually-hidden.tsx", "../../@liveblocks/react-ui/src/config.tsx", "../../@liveblocks/react-ui/src/utils/is-apple.ts", "../../@liveblocks/react-ui/src/components/internal/Tooltip.tsx", "../../@liveblocks/react-ui/src/components/internal/CodeBlock.tsx", "../../@liveblocks/react-ui/src/components/internal/Prose.tsx", "../../@liveblocks/react-ui/src/shared.ts", "../../@liveblocks/react-ui/src/components/internal/User.tsx", "../../@liveblocks/react-ui/src/utils/capitalize.ts", "../../@liveblocks/react-ui/src/utils/use-refs.ts", "../../is-plain-object/dist/is-plain-object.mjs", "../../immer/src/utils/env.ts", "../../immer/src/utils/errors.ts", "../../immer/src/utils/common.ts", "../../immer/src/utils/plugins.ts", "../../immer/src/core/scope.ts", "../../immer/src/core/finalize.ts", "../../immer/src/core/proxy.ts", "../../immer/src/core/immerClass.ts", "../../immer/src/core/current.ts", "../../immer/src/plugins/patches.ts", "../../immer/src/plugins/mapset.ts", "../../immer/src/immer.ts", "../../slate/src/interfaces/path-ref.ts", "../../slate/src/interfaces/point-ref.ts", "../../slate/src/interfaces/range-ref.ts", "../../slate/src/utils/weak-maps.ts", "../../slate/src/interfaces/path.ts", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/typeof.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/toPrimitive.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/toPropertyKey.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/defineProperty.js", "../../slate/src/interfaces/transforms/general.ts", "../../slate/src/interfaces/transforms/node.ts", "../../slate/src/interfaces/transforms/selection.ts", "../../slate/src/utils/deep-equal.ts", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js", "../../slate/src/interfaces/range.ts", "../../slate/src/interfaces/element.ts", "../../slate/src/interfaces/node.ts", "../../slate/src/interfaces/operation.ts", "../../slate/src/editor/is-editor.ts", "../../slate/src/interfaces/editor.ts", "../../slate/src/interfaces/location.ts", "../../slate/src/interfaces/point.ts", "../../slate/src/interfaces/scrubber.ts", "../../slate/src/interfaces/text.ts", "../../slate/src/utils/get-default-insert-location.ts", "../../slate/src/utils/match-path.ts", "../../slate/src/utils/string.ts", "../../slate/src/interfaces/transforms/text.ts", "../../slate/src/interfaces/transforms/index.ts", "../../slate/src/core/batch-dirty-paths.ts", "../../slate/src/core/update-dirty-paths.ts", "../../slate/src/core/apply.ts", "../../slate/src/core/get-dirty-paths.ts", "../../slate/src/core/get-fragment.ts", "../../slate/src/core/normalize-node.ts", "../../slate/src/core/should-normalize.ts", "../../slate/src/editor/above.ts", "../../slate/src/editor/add-mark.ts", "../../slate/src/editor/after.ts", "../../slate/src/editor/before.ts", "../../slate/src/editor/delete-backward.ts", "../../slate/src/editor/delete-forward.ts", "../../slate/src/editor/delete-fragment.ts", "../../slate/src/editor/edges.ts", "../../slate/src/editor/element-read-only.ts", "../../slate/src/editor/end.ts", "../../slate/src/editor/first.ts", "../../slate/src/editor/fragment.ts", "../../slate/src/editor/get-void.ts", "../../slate/src/editor/has-blocks.ts", "../../slate/src/editor/has-inlines.ts", "../../slate/src/editor/has-path.ts", "../../slate/src/editor/has-texts.ts", "../../slate/src/editor/insert-break.ts", "../../slate/src/editor/insert-node.ts", "../../slate/src/editor/insert-soft-break.ts", "../../slate/src/editor/insert-text.ts", "../../slate/src/editor/is-block.ts", "../../slate/src/editor/is-edge.ts", "../../slate/src/editor/is-empty.ts", "../../slate/src/editor/is-end.ts", "../../slate/src/editor/is-normalizing.ts", "../../slate/src/editor/is-start.ts", "../../slate/src/editor/last.ts", "../../slate/src/editor/leaf.ts", "../../slate/src/editor/levels.ts", "../../slate/src/editor/marks.ts", "../../slate/src/editor/next.ts", "../../slate/src/editor/node.ts", "../../slate/src/editor/nodes.ts", "../../slate/src/editor/normalize.ts", "../../slate/src/editor/parent.ts", "../../slate/src/editor/path-ref.ts", "../../slate/src/editor/path-refs.ts", "../../slate/src/editor/path.ts", "../../slate/src/editor/point-ref.ts", "../../slate/src/editor/point-refs.ts", "../../slate/src/editor/point.ts", "../../slate/src/editor/positions.ts", "../../slate/src/editor/previous.ts", "../../slate/src/editor/range-ref.ts", "../../slate/src/editor/range-refs.ts", "../../slate/src/editor/range.ts", "../../slate/src/editor/remove-mark.ts", "../../slate/src/editor/set-normalizing.ts", "../../slate/src/editor/start.ts", "../../slate/src/editor/string.ts", "../../slate/src/editor/unhang-range.ts", "../../slate/src/editor/without-normalizing.ts", "../../slate/src/editor/should-merge-nodes-remove-prev-node.ts", "../../slate/src/transforms-text/delete-text.ts", "../../slate/src/transforms-text/insert-fragment.ts", "../../slate/src/transforms-selection/collapse.ts", "../../slate/src/transforms-selection/deselect.ts", "../../slate/src/transforms-selection/move.ts", "../../slate/src/transforms-selection/select.ts", "../../slate/src/transforms-selection/set-point.ts", "../../slate/src/transforms-selection/set-selection.ts", "../../slate/src/transforms-node/insert-nodes.ts", "../../slate/src/transforms-node/lift-nodes.ts", "../../slate/src/transforms-node/merge-nodes.ts", "../../slate/src/transforms-node/move-nodes.ts", "../../slate/src/transforms-node/remove-nodes.ts", "../../slate/src/transforms-node/set-nodes.ts", "../../slate/src/transforms-node/split-nodes.ts", "../../slate/src/transforms-node/unset-nodes.ts", "../../slate/src/transforms-node/unwrap-nodes.ts", "../../slate/src/transforms-node/wrap-nodes.ts", "../../slate/src/create-editor.ts", "../../slate-history/src/history.ts", "../../slate-history/src/history-editor.ts", "../../slate-history/src/with-history.ts", "../../compute-scroll-into-view/src/index.ts", "../../scroll-into-view-if-needed/src/index.ts", "../../@juggle/resize-observer/lib/utils/resizeObservers.js", "../../@juggle/resize-observer/lib/algorithms/hasActiveObservations.js", "../../@juggle/resize-observer/lib/algorithms/hasSkippedObservations.js", "../../@juggle/resize-observer/lib/algorithms/deliverResizeLoopError.js", "../../@juggle/resize-observer/lib/ResizeObserverBoxOptions.js", "../../@juggle/resize-observer/lib/utils/freeze.js", "../../@juggle/resize-observer/lib/ResizeObserverSize.js", "../../@juggle/resize-observer/lib/DOMRectReadOnly.js", "../../@juggle/resize-observer/lib/utils/element.js", "../../@juggle/resize-observer/lib/utils/global.js", "../../@juggle/resize-observer/lib/algorithms/calculateBoxSize.js", "../../@juggle/resize-observer/lib/ResizeObserverEntry.js", "../../@juggle/resize-observer/lib/algorithms/calculateDepthForNode.js", "../../@juggle/resize-observer/lib/algorithms/broadcastActiveObservations.js", "../../@juggle/resize-observer/lib/algorithms/gatherActiveObservationsAtDepth.js", "../../@juggle/resize-observer/lib/utils/process.js", "../../@juggle/resize-observer/lib/utils/queueMicroTask.js", "../../@juggle/resize-observer/lib/utils/queueResizeObserver.js", "../../@juggle/resize-observer/lib/utils/scheduler.js", "../../@juggle/resize-observer/lib/ResizeObservation.js", "../../@juggle/resize-observer/lib/ResizeObserverDetail.js", "../../@juggle/resize-observer/lib/ResizeObserverController.js", "../../@juggle/resize-observer/lib/ResizeObserver.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/typeof.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/toPrimitive.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/toPropertyKey.js", "../../../../../../.yarn/berry/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-10.zip/node_modules/@babel/runtime/helpers/esm/defineProperty.js", "../../slate-react/src/hooks/use-slate-static.tsx", "../../slate-react/src/utils/environment.ts", "../../slate-react/src/utils/weak-maps.ts", "../../slate-react/src/utils/dom.ts", "../../slate-react/src/utils/key.ts", "../../slate-react/src/plugin/react-editor.ts", "../../slate-react/src/utils/diff-text.ts", "../../slate-react/src/hooks/android-input-manager/android-input-manager.ts", "../../slate-react/src/hooks/use-is-mounted.tsx", "../../slate-react/src/hooks/use-isomorphic-layout-effect.ts", "../../slate-react/src/hooks/use-mutation-observer.ts", "../../slate-react/src/hooks/android-input-manager/use-android-input-manager.ts", "../../slate-react/src/utils/range-list.ts", "../../slate-react/src/components/string.tsx", "../../slate-react/src/components/leaf.tsx", "../../slate-react/src/components/text.tsx", "../../slate-react/src/components/element.tsx", "../../slate-react/src/hooks/use-decorate.ts", "../../slate-react/src/hooks/use-selected.ts", "../../slate-react/src/hooks/use-children.tsx", "../../slate-react/src/hooks/use-read-only.ts", "../../slate-react/src/hooks/use-slate.tsx", "../../slate-react/src/hooks/use-track-user-input.ts", "../../slate-react/src/utils/constants.ts", "../../slate-react/src/utils/hotkeys.ts", "../../slate-react/src/components/restore-dom/restore-dom-manager.ts", "../../slate-react/src/components/restore-dom/restore-dom.tsx", "../../slate-react/src/hooks/use-composing.ts", "../../slate-react/src/components/editable.tsx", "../../slate-react/src/hooks/use-focused.ts", "../../slate-react/src/hooks/use-slate-selector.tsx", "../../slate-react/src/components/slate.tsx", "../../slate-react/src/hooks/use-editor.tsx", "../../slate-react/src/hooks/use-slate-selection.tsx", "../../slate-react/src/utils/lines.ts", "../../slate-react/src/plugin/with-react.ts", "../../@liveblocks/react-ui/src/utils/request-submit.ts", "../../@liveblocks/react-ui/src/primitives/slate/plugins/normalize.ts", "../../@liveblocks/react-ui/src/primitives/slate/utils/is-empty-string.ts", "../../@liveblocks/react-ui/src/primitives/slate/utils/is-text.ts", "../../@liveblocks/react-ui/src/primitives/slate/utils/is-empty.ts", "../../@liveblocks/react-ui/src/primitives/AiComposer/contexts.ts", "../../@liveblocks/react-ui/src/primitives/AiComposer/index.tsx", "../../@liveblocks/react-ui/src/utils/ErrorBoundary.tsx", "../../@liveblocks/react-ui/src/primitives/AiMessage/contexts.ts", "../../@liveblocks/react-ui/src/primitives/AiMessage/tool-invocation.tsx", "../../@liveblocks/react-ui/src/primitives/AiMessage/index.tsx", "../../@liveblocks/react-ui/src/utils/use-controllable-state.ts", "../../@liveblocks/react-ui/src/primitives/Collapsible/index.tsx", "../../cmdk/dist/chunk-NZJY6EH4.mjs", "../../@radix-ui/react-dialog/src/dialog.tsx", "../../@radix-ui/react-focus-scope/src/focus-scope.tsx", "../../@radix-ui/react-focus-guards/src/focus-guards.tsx", "../../tslib/tslib.es6.mjs", "../../react-remove-scroll/dist/es2015/Combination.js", "../../react-remove-scroll/dist/es2015/UI.js", "../../react-remove-scroll-bar/dist/es2015/constants.js", "../../use-callback-ref/dist/es2015/assignRef.js", "../../use-callback-ref/dist/es2015/useRef.js", "../../use-callback-ref/dist/es2015/useMergeRef.js", "../../use-sidecar/dist/es2015/hoc.js", "../../use-sidecar/dist/es2015/hook.js", "../../use-sidecar/dist/es2015/medium.js", "../../use-sidecar/dist/es2015/renderProp.js", "../../use-sidecar/dist/es2015/exports.js", "../../react-remove-scroll/dist/es2015/medium.js", "../../react-remove-scroll/dist/es2015/SideEffect.js", "../../react-remove-scroll-bar/dist/es2015/component.js", "../../react-style-singleton/dist/es2015/hook.js", "../../get-nonce/dist/es2015/index.js", "../../react-style-singleton/dist/es2015/singleton.js", "../../react-style-singleton/dist/es2015/component.js", "../../react-remove-scroll-bar/dist/es2015/utils.js", "../../react-remove-scroll/dist/es2015/aggresiveCapture.js", "../../react-remove-scroll/dist/es2015/handleScroll.js", "../../react-remove-scroll/dist/es2015/sidecar.js", "../../aria-hidden/dist/es2015/index.js", "../../cmdk/dist/index.mjs", "../../@liveblocks/react-tiptap/src/context.tsx", "../../@liveblocks/react-tiptap/src/types.ts", "../../@liveblocks/react-tiptap/src/utils.ts", "../../@liveblocks/react-tiptap/src/ai/AiExtension.ts", "../../@liveblocks/react-tiptap/src/ai/AiToolbar.tsx", "../../@liveblocks/react-ui/src/version.ts", "../../@liveblocks/react-ui/src/utils/use-visible.ts", "../../@liveblocks/react-ui/src/components/internal/AiChatAssistantMessage.tsx", "../../@liveblocks/react-ui/src/components/internal/AiChatUserMessage.tsx", "../../@liveblocks/react-ui/src/components/internal/AiComposer.tsx", "../../@liveblocks/react-ui/src/components/AiChat.tsx", "../../@liveblocks/react-ui/src/components/AiTool.tsx", "../../@radix-ui/react-toggle/src/toggle.tsx", "../../@liveblocks/react-ui/src/primitives/Comment/index.tsx", "../../@liveblocks/react-ui/src/utils/is-key.ts", "../../@liveblocks/react-ui/src/utils/Persist.tsx", "../../@liveblocks/react-ui/src/utils/Portal.tsx", "../../@liveblocks/react-ui/src/utils/clamp.ts", "../../@liveblocks/react-ui/src/utils/wrap.ts", "../../@liveblocks/react-ui/src/utils/use-index.ts", "../../@liveblocks/react-ui/src/utils/use-observable.ts", "../../@liveblocks/react-ui/src/primitives/slate/utils/get-character.ts", "../../@liveblocks/react-ui/src/primitives/slate/utils/marks.ts", "../../@liveblocks/react-ui/src/primitives/slate/plugins/empty-clear-formatting.ts", "../../@liveblocks/react-ui/src/primitives/slate/utils/get-dom-range.ts", "../../@liveblocks/react-ui/src/primitives/Composer/contexts.ts", "../../@liveblocks/react-ui/src/primitives/slate/utils/is-whitespace-character.ts", "../../@liveblocks/react-ui/src/primitives/slate/utils/get-match-range.ts", "../../@liveblocks/react-ui/src/primitives/Composer/slate/plugins/auto-formatting.ts", "../../@liveblocks/react-ui/src/primitives/slate/utils/selection-contains-inlines.ts", "../../@liveblocks/react-ui/src/primitives/Composer/slate/plugins/custom-links.ts", "../../@liveblocks/react-ui/src/primitives/Composer/slate/plugins/auto-links.ts", "../../@liveblocks/react-ui/src/primitives/Composer/slate/plugins/mentions.ts", "../../../.yarn/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-6c4df4839e.zip/node_modules/@babel/runtime/helpers/esm/typeof.js", "../../../.yarn/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-6c4df4839e.zip/node_modules/@babel/runtime/helpers/esm/toPrimitive.js", "../../../.yarn/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-6c4df4839e.zip/node_modules/@babel/runtime/helpers/esm/toPropertyKey.js", "../../../.yarn/cache/@babel-runtime-npm-7.23.2-d013d6cf7e-6c4df4839e.zip/node_modules/@babel/runtime/helpers/esm/defineProperty.js", "../../slate-hyperscript/src/tokens.ts", "../../slate-hyperscript/src/creators.ts", "../../slate-hyperscript/src/hyperscript.ts", "../../slate-hyperscript/src/index.ts", "../../@liveblocks/react-ui/src/utils/exists.ts", "../../@liveblocks/react-ui/src/utils/data-transfer.ts", "../../@liveblocks/react-ui/src/primitives/Composer/slate/plugins/paste.ts", "../../@liveblocks/react-ui/src/primitives/Composer/utils.ts", "../../@liveblocks/react-ui/src/primitives/Composer/index.tsx", "../../@liveblocks/react-ui/src/primitives/Timestamp.tsx", "../../@liveblocks/react-ui/src/utils/download.ts", "../../@liveblocks/react-ui/src/utils/use-group-mention.ts", "../../@liveblocks/react-ui/src/utils/use-window-focus.ts", "../../@liveblocks/react-ui/src/utils/format-file-size.ts", "../../@liveblocks/react-ui/src/primitives/FileSize.tsx", "../../@liveblocks/react-ui/src/components/internal/Attachment.tsx", "../../@liveblocks/react-ui/src/components/internal/Attribution.tsx", "../../@radix-ui/react-popover/src/popover.tsx", "../../frimousse/src/components/emoji-picker.tsx", "../../frimousse/src/constants.ts", "../../frimousse/src/utils/capitalize.ts", "../../frimousse/src/utils/is-emoji-supported.ts", "../../frimousse/src/utils/storage.ts", "../../frimousse/src/utils/validate.ts", "../../frimousse/src/data/emoji.ts", "../../frimousse/src/utils/chunk.ts", "../../frimousse/src/data/emoji-picker.ts", "../../frimousse/src/hooks.ts", "../../frimousse/src/utils/store.tsx", "../../frimousse/src/store.ts", "../../frimousse/src/utils/get-skin-tone-variations.ts", "../../frimousse/src/utils/compare.ts", "../../frimousse/src/utils/noop.ts", "../../frimousse/src/utils/request-idle-callback.ts", "../../frimousse/src/utils/use-layout-effect.ts", "../../frimousse/src/utils/use-stable-callback.ts", "../../@liveblocks/react-ui/src/components/internal/EmojiPicker.tsx", "../../@liveblocks/react-ui/src/components/Composer.tsx", "../../@radix-ui/react-dropdown-menu/src/dropdown-menu.tsx", "../../@radix-ui/react-menu/src/menu.tsx", "../../@radix-ui/react-collection/src/collection-legacy.tsx", "../../@radix-ui/react-collection/src/collection.tsx", "../../@radix-ui/react-collection/src/ordered-dictionary.ts", "../../@radix-ui/react-direction/src/direction.tsx", "../../@radix-ui/react-roving-focus/src/roving-focus-group.tsx", "../../@liveblocks/react-ui/src/components/internal/Dropdown.tsx", "../../@liveblocks/react-ui/src/components/Comment.tsx", "../../@liveblocks/react-ui/src/components/HistoryVersionSummary.tsx", "../../@liveblocks/react-ui/src/components/HistoryVersionSummaryList.tsx", "../../@liveblocks/react-ui/src/components/internal/InboxNotificationThread.tsx", "../../@liveblocks/react-ui/src/components/internal/Room.tsx", "../../@liveblocks/react-ui/src/components/InboxNotification.tsx", "../../@liveblocks/react-ui/src/components/InboxNotificationList.tsx", "../../@liveblocks/react-ui/src/components/Thread.tsx", "../../@liveblocks/react-ui/src/index.ts", "../../@liveblocks/react-tiptap/src/comments/AnchoredThreads.tsx", "../../@liveblocks/react-tiptap/src/comments/FloatingComposer.tsx", "../../@liveblocks/react-tiptap/src/comments/FloatingThreads.tsx", "../../js-base64/base64.mjs", "../../lib0/indexeddb.js", "../../y-indexeddb/src/y-indexeddb.js", "../../@noble/hashes/src/crypto.ts", "../../@noble/hashes/src/utils.ts", "../../@noble/hashes/src/_md.ts", "../../@noble/hashes/src/_u64.ts", "../../@noble/hashes/src/sha2.ts", "../../@liveblocks/yjs/src/index.ts", "../../@liveblocks/yjs/src/version.ts", "../../@liveblocks/yjs/src/provider.ts", "../../node_modules/lib0/map.js", "../../node_modules/lib0/set.js", "../../node_modules/lib0/array.js", "../../node_modules/lib0/observable.js", "../../@liveblocks/yjs/src/awareness.ts", "../../@liveblocks/yjs/src/doc.ts", "../../@liveblocks/yjs/src/providerContext.ts", "../../@tiptap/extension-collaboration/src/collaboration.ts", "../../@tiptap/extension-collaboration/src/helpers/isChangeOrigin.ts", "../../@liveblocks/react-tiptap/src/comments/CommentsExtension.ts", "../../@tiptap/suggestion/src/findSuggestionMatch.ts", "../../@tiptap/suggestion/src/suggestion.ts", "../../@liveblocks/react-tiptap/src/mentions/Mention.tsx", "../../@liveblocks/react-tiptap/src/mentions/GroupMentionNode.ts", "../../@liveblocks/react-tiptap/src/mentions/MentionNode.ts", "../../@liveblocks/react-tiptap/src/mentions/MentionsList.tsx", "../../@liveblocks/react-tiptap/src/mentions/MentionExtension.ts", "../../@liveblocks/react-tiptap/src/LiveblocksExtension.ts", "../../@liveblocks/react-tiptap/src/toolbar/shared.tsx", "../../@radix-ui/react-select/src/select.tsx", "../../@radix-ui/number/src/number.ts", "../../@radix-ui/react-use-previous/src/use-previous.tsx", "../../@liveblocks/react-tiptap/src/toolbar/Toolbar.tsx", "../../@liveblocks/react-tiptap/src/toolbar/FloatingToolbar.tsx", "../../@liveblocks/react-tiptap/src/version-history/HistoryVersionPreview.tsx", "../../@liveblocks/react-tiptap/src/index.ts"],
  "sourcesContent": ["'use strict'\n\nmodule.exports = direction\n\nvar RTL = '\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC'\nvar LTR =\n  'A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6' +\n  '\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF\\u200E\\u2C00-\\uFB1C' +\n  '\\uFE00-\\uFE6F\\uFEFD-\\uFFFF'\n\nvar rtl = new RegExp('^[^' + LTR + ']*[' + RTL + ']')\nvar ltr = new RegExp('^[^' + RTL + ']*[' + LTR + ']')\n\nfunction direction(value) {\n  value = String(value || '')\n\n  if (rtl.test(value)) {\n    return 'rtl'\n  }\n\n  if (ltr.test(value)) {\n    return 'ltr'\n  }\n\n  return 'neutral'\n}\n", "/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n", "/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n", "var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n", "var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n", "/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nmodule.exports = trimmedEndIndex;\n", "var trimmedEndIndex = require('./_trimmedEndIndex');\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nmodule.exports = baseTrim;\n", "var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n", "var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n", "/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n", "var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n", "/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n", "var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n", "var baseTrim = require('./_baseTrim'),\n    isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n", "var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n", "var debounce = require('./debounce'),\n    isObject = require('./isObject');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nmodule.exports = throttle;\n", "'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n/**\n * Constants.\n */\n\nvar IS_MAC = typeof window != 'undefined' && /Mac|iPod|iPhone|iPad/.test(window.navigator.platform);\n\nvar MODIFIERS = {\n  alt: 'altKey',\n  control: 'ctrlKey',\n  meta: 'metaKey',\n  shift: 'shiftKey'\n};\n\nvar ALIASES = {\n  add: '+',\n  break: 'pause',\n  cmd: 'meta',\n  command: 'meta',\n  ctl: 'control',\n  ctrl: 'control',\n  del: 'delete',\n  down: 'arrowdown',\n  esc: 'escape',\n  ins: 'insert',\n  left: 'arrowleft',\n  mod: IS_MAC ? 'meta' : 'control',\n  opt: 'alt',\n  option: 'alt',\n  return: 'enter',\n  right: 'arrowright',\n  space: ' ',\n  spacebar: ' ',\n  up: 'arrowup',\n  win: 'meta',\n  windows: 'meta'\n};\n\nvar CODES = {\n  backspace: 8,\n  tab: 9,\n  enter: 13,\n  shift: 16,\n  control: 17,\n  alt: 18,\n  pause: 19,\n  capslock: 20,\n  escape: 27,\n  ' ': 32,\n  pageup: 33,\n  pagedown: 34,\n  end: 35,\n  home: 36,\n  arrowleft: 37,\n  arrowup: 38,\n  arrowright: 39,\n  arrowdown: 40,\n  insert: 45,\n  delete: 46,\n  meta: 91,\n  numlock: 144,\n  scrolllock: 145,\n  ';': 186,\n  '=': 187,\n  ',': 188,\n  '-': 189,\n  '.': 190,\n  '/': 191,\n  '`': 192,\n  '[': 219,\n  '\\\\': 220,\n  ']': 221,\n  '\\'': 222\n};\n\nfor (var f = 1; f < 20; f++) {\n  CODES['f' + f] = 111 + f;\n}\n\n/**\n * Is hotkey?\n */\n\nfunction isHotkey(hotkey, options, event) {\n  if (options && !('byKey' in options)) {\n    event = options;\n    options = null;\n  }\n\n  if (!Array.isArray(hotkey)) {\n    hotkey = [hotkey];\n  }\n\n  var array = hotkey.map(function (string) {\n    return parseHotkey(string, options);\n  });\n  var check = function check(e) {\n    return array.some(function (object) {\n      return compareHotkey(object, e);\n    });\n  };\n  var ret = event == null ? check : check(event);\n  return ret;\n}\n\nfunction isCodeHotkey(hotkey, event) {\n  return isHotkey(hotkey, event);\n}\n\nfunction isKeyHotkey(hotkey, event) {\n  return isHotkey(hotkey, { byKey: true }, event);\n}\n\n/**\n * Parse.\n */\n\nfunction parseHotkey(hotkey, options) {\n  var byKey = options && options.byKey;\n  var ret = {};\n\n  // Special case to handle the `+` key since we use it as a separator.\n  hotkey = hotkey.replace('++', '+add');\n  var values = hotkey.split('+');\n  var length = values.length;\n\n  // Ensure that all the modifiers are set to false unless the hotkey has them.\n\n  for (var k in MODIFIERS) {\n    ret[MODIFIERS[k]] = false;\n  }\n\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = values[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var value = _step.value;\n\n      var optional = value.endsWith('?') && value.length > 1;\n\n      if (optional) {\n        value = value.slice(0, -1);\n      }\n\n      var name = toKeyName(value);\n      var modifier = MODIFIERS[name];\n\n      if (value.length > 1 && !modifier && !ALIASES[value] && !CODES[name]) {\n        throw new TypeError('Unknown modifier: \"' + value + '\"');\n      }\n\n      if (length === 1 || !modifier) {\n        if (byKey) {\n          ret.key = name;\n        } else {\n          ret.which = toKeyCode(value);\n        }\n      }\n\n      if (modifier) {\n        ret[modifier] = optional ? null : true;\n      }\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  return ret;\n}\n\n/**\n * Compare.\n */\n\nfunction compareHotkey(object, event) {\n  for (var key in object) {\n    var expected = object[key];\n    var actual = void 0;\n\n    if (expected == null) {\n      continue;\n    }\n\n    if (key === 'key' && event.key != null) {\n      actual = event.key.toLowerCase();\n    } else if (key === 'which') {\n      actual = expected === 91 && event.which === 93 ? 91 : event.which;\n    } else {\n      actual = event[key];\n    }\n\n    if (actual == null && expected === false) {\n      continue;\n    }\n\n    if (actual !== expected) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Utils.\n */\n\nfunction toKeyCode(name) {\n  name = toKeyName(name);\n  var code = CODES[name] || name.toUpperCase().charCodeAt(0);\n  return code;\n}\n\nfunction toKeyName(name) {\n  name = name.toLowerCase();\n  name = ALIASES[name] || name;\n  return name;\n}\n\n/**\n * Export.\n */\n\nexports.default = isHotkey;\nexports.isHotkey = isHotkey;\nexports.isCodeHotkey = isCodeHotkey;\nexports.isKeyHotkey = isKeyHotkey;\nexports.parseHotkey = parseHotkey;\nexports.compareHotkey = compareHotkey;\nexports.toKeyCode = toKeyCode;\nexports.toKeyName = toKeyName;", "declare const __VERSION__: string;\ndeclare const ROLLUP_FORMAT: string;\n\nexport const PKG_NAME = \"@liveblocks/react-tiptap\";\nexport const PKG_VERSION = typeof __VERSION__ === \"string\" && __VERSION__;\nexport const PKG_FORMAT = typeof ROLLUP_FORMAT === \"string\" && ROLLUP_FORMAT;\n", "/**\n * Custom positioning reference element.\n * @see https://floating-ui.com/docs/virtual-elements\n */\n\nconst sides = ['top', 'right', 'bottom', 'left'];\nconst alignments = ['start', 'end'];\nconst placements = /*#__PURE__*/sides.reduce((acc, side) => acc.concat(side, side + \"-\" + alignments[0], side + \"-\" + alignments[1]), []);\nconst min = Math.min;\nconst max = Math.max;\nconst round = Math.round;\nconst floor = Math.floor;\nconst createCoords = v => ({\n  x: v,\n  y: v\n});\nconst oppositeSideMap = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nconst oppositeAlignmentMap = {\n  start: 'end',\n  end: 'start'\n};\nfunction clamp(start, value, end) {\n  return max(start, min(value, end));\n}\nfunction evaluate(value, param) {\n  return typeof value === 'function' ? value(param) : value;\n}\nfunction getSide(placement) {\n  return placement.split('-')[0];\n}\nfunction getAlignment(placement) {\n  return placement.split('-')[1];\n}\nfunction getOppositeAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}\nfunction getAxisLength(axis) {\n  return axis === 'y' ? 'height' : 'width';\n}\nconst yAxisSides = /*#__PURE__*/new Set(['top', 'bottom']);\nfunction getSideAxis(placement) {\n  return yAxisSides.has(getSide(placement)) ? 'y' : 'x';\n}\nfunction getAlignmentAxis(placement) {\n  return getOppositeAxis(getSideAxis(placement));\n}\nfunction getAlignmentSides(placement, rects, rtl) {\n  if (rtl === void 0) {\n    rtl = false;\n  }\n  const alignment = getAlignment(placement);\n  const alignmentAxis = getAlignmentAxis(placement);\n  const length = getAxisLength(alignmentAxis);\n  let mainAlignmentSide = alignmentAxis === 'x' ? alignment === (rtl ? 'end' : 'start') ? 'right' : 'left' : alignment === 'start' ? 'bottom' : 'top';\n  if (rects.reference[length] > rects.floating[length]) {\n    mainAlignmentSide = getOppositePlacement(mainAlignmentSide);\n  }\n  return [mainAlignmentSide, getOppositePlacement(mainAlignmentSide)];\n}\nfunction getExpandedPlacements(placement) {\n  const oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeAlignmentPlacement(placement), oppositePlacement, getOppositeAlignmentPlacement(oppositePlacement)];\n}\nfunction getOppositeAlignmentPlacement(placement) {\n  return placement.replace(/start|end/g, alignment => oppositeAlignmentMap[alignment]);\n}\nconst lrPlacement = ['left', 'right'];\nconst rlPlacement = ['right', 'left'];\nconst tbPlacement = ['top', 'bottom'];\nconst btPlacement = ['bottom', 'top'];\nfunction getSideList(side, isStart, rtl) {\n  switch (side) {\n    case 'top':\n    case 'bottom':\n      if (rtl) return isStart ? rlPlacement : lrPlacement;\n      return isStart ? lrPlacement : rlPlacement;\n    case 'left':\n    case 'right':\n      return isStart ? tbPlacement : btPlacement;\n    default:\n      return [];\n  }\n}\nfunction getOppositeAxisPlacements(placement, flipAlignment, direction, rtl) {\n  const alignment = getAlignment(placement);\n  let list = getSideList(getSide(placement), direction === 'start', rtl);\n  if (alignment) {\n    list = list.map(side => side + \"-\" + alignment);\n    if (flipAlignment) {\n      list = list.concat(list.map(getOppositeAlignmentPlacement));\n    }\n  }\n  return list;\n}\nfunction getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, side => oppositeSideMap[side]);\n}\nfunction expandPaddingObject(padding) {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n    ...padding\n  };\n}\nfunction getPaddingObject(padding) {\n  return typeof padding !== 'number' ? expandPaddingObject(padding) : {\n    top: padding,\n    right: padding,\n    bottom: padding,\n    left: padding\n  };\n}\nfunction rectToClientRect(rect) {\n  const {\n    x,\n    y,\n    width,\n    height\n  } = rect;\n  return {\n    width,\n    height,\n    top: y,\n    left: x,\n    right: x + width,\n    bottom: y + height,\n    x,\n    y\n  };\n}\n\nexport { alignments, clamp, createCoords, evaluate, expandPaddingObject, floor, getAlignment, getAlignmentAxis, getAlignmentSides, getAxisLength, getExpandedPlacements, getOppositeAlignmentPlacement, getOppositeAxis, getOppositeAxisPlacements, getOppositePlacement, getPaddingObject, getSide, getSideAxis, max, min, placements, rectToClientRect, round, sides };\n", "import { getSideAxis, getAlignmentAxis, getAxisLength, getSide, getAlignment, evaluate, getPaddingObject, rectToClientRect, min, clamp, placements, getAlignmentSides, getOppositeAlignmentPlacement, getOppositePlacement, getExpandedPlacements, getOppositeAxisPlacements, sides, max, getOppositeAxis } from '@floating-ui/utils';\nexport { rectToClientRect } from '@floating-ui/utils';\n\nfunction computeCoordsFromPlacement(_ref, placement, rtl) {\n  let {\n    reference,\n    floating\n  } = _ref;\n  const sideAxis = getSideAxis(placement);\n  const alignmentAxis = getAlignmentAxis(placement);\n  const alignLength = getAxisLength(alignmentAxis);\n  const side = getSide(placement);\n  const isVertical = sideAxis === 'y';\n  const commonX = reference.x + reference.width / 2 - floating.width / 2;\n  const commonY = reference.y + reference.height / 2 - floating.height / 2;\n  const commonAlign = reference[alignLength] / 2 - floating[alignLength] / 2;\n  let coords;\n  switch (side) {\n    case 'top':\n      coords = {\n        x: commonX,\n        y: reference.y - floating.height\n      };\n      break;\n    case 'bottom':\n      coords = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n    case 'right':\n      coords = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n    case 'left':\n      coords = {\n        x: reference.x - floating.width,\n        y: commonY\n      };\n      break;\n    default:\n      coords = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n  switch (getAlignment(placement)) {\n    case 'start':\n      coords[alignmentAxis] -= commonAlign * (rtl && isVertical ? -1 : 1);\n      break;\n    case 'end':\n      coords[alignmentAxis] += commonAlign * (rtl && isVertical ? -1 : 1);\n      break;\n  }\n  return coords;\n}\n\n/**\n * Computes the `x` and `y` coordinates that will place the floating element\n * next to a given reference element.\n *\n * This export does not have any `platform` interface logic. You will need to\n * write one for the platform you are using Floating UI with.\n */\nconst computePosition = async (reference, floating, config) => {\n  const {\n    placement = 'bottom',\n    strategy = 'absolute',\n    middleware = [],\n    platform\n  } = config;\n  const validMiddleware = middleware.filter(Boolean);\n  const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(floating));\n  let rects = await platform.getElementRects({\n    reference,\n    floating,\n    strategy\n  });\n  let {\n    x,\n    y\n  } = computeCoordsFromPlacement(rects, placement, rtl);\n  let statefulPlacement = placement;\n  let middlewareData = {};\n  let resetCount = 0;\n  for (let i = 0; i < validMiddleware.length; i++) {\n    const {\n      name,\n      fn\n    } = validMiddleware[i];\n    const {\n      x: nextX,\n      y: nextY,\n      data,\n      reset\n    } = await fn({\n      x,\n      y,\n      initialPlacement: placement,\n      placement: statefulPlacement,\n      strategy,\n      middlewareData,\n      rects,\n      platform,\n      elements: {\n        reference,\n        floating\n      }\n    });\n    x = nextX != null ? nextX : x;\n    y = nextY != null ? nextY : y;\n    middlewareData = {\n      ...middlewareData,\n      [name]: {\n        ...middlewareData[name],\n        ...data\n      }\n    };\n    if (reset && resetCount <= 50) {\n      resetCount++;\n      if (typeof reset === 'object') {\n        if (reset.placement) {\n          statefulPlacement = reset.placement;\n        }\n        if (reset.rects) {\n          rects = reset.rects === true ? await platform.getElementRects({\n            reference,\n            floating,\n            strategy\n          }) : reset.rects;\n        }\n        ({\n          x,\n          y\n        } = computeCoordsFromPlacement(rects, statefulPlacement, rtl));\n      }\n      i = -1;\n    }\n  }\n  return {\n    x,\n    y,\n    placement: statefulPlacement,\n    strategy,\n    middlewareData\n  };\n};\n\n/**\n * Resolves with an object of overflow side offsets that determine how much the\n * element is overflowing a given clipping boundary on each side.\n * - positive = overflowing the boundary by that number of pixels\n * - negative = how many pixels left before it will overflow\n * - 0 = lies flush with the boundary\n * @see https://floating-ui.com/docs/detectOverflow\n */\nasync function detectOverflow(state, options) {\n  var _await$platform$isEle;\n  if (options === void 0) {\n    options = {};\n  }\n  const {\n    x,\n    y,\n    platform,\n    rects,\n    elements,\n    strategy\n  } = state;\n  const {\n    boundary = 'clippingAncestors',\n    rootBoundary = 'viewport',\n    elementContext = 'floating',\n    altBoundary = false,\n    padding = 0\n  } = evaluate(options, state);\n  const paddingObject = getPaddingObject(padding);\n  const altContext = elementContext === 'floating' ? 'reference' : 'floating';\n  const element = elements[altBoundary ? altContext : elementContext];\n  const clippingClientRect = rectToClientRect(await platform.getClippingRect({\n    element: ((_await$platform$isEle = await (platform.isElement == null ? void 0 : platform.isElement(element))) != null ? _await$platform$isEle : true) ? element : element.contextElement || (await (platform.getDocumentElement == null ? void 0 : platform.getDocumentElement(elements.floating))),\n    boundary,\n    rootBoundary,\n    strategy\n  }));\n  const rect = elementContext === 'floating' ? {\n    x,\n    y,\n    width: rects.floating.width,\n    height: rects.floating.height\n  } : rects.reference;\n  const offsetParent = await (platform.getOffsetParent == null ? void 0 : platform.getOffsetParent(elements.floating));\n  const offsetScale = (await (platform.isElement == null ? void 0 : platform.isElement(offsetParent))) ? (await (platform.getScale == null ? void 0 : platform.getScale(offsetParent))) || {\n    x: 1,\n    y: 1\n  } : {\n    x: 1,\n    y: 1\n  };\n  const elementClientRect = rectToClientRect(platform.convertOffsetParentRelativeRectToViewportRelativeRect ? await platform.convertOffsetParentRelativeRectToViewportRelativeRect({\n    elements,\n    rect,\n    offsetParent,\n    strategy\n  }) : rect);\n  return {\n    top: (clippingClientRect.top - elementClientRect.top + paddingObject.top) / offsetScale.y,\n    bottom: (elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom) / offsetScale.y,\n    left: (clippingClientRect.left - elementClientRect.left + paddingObject.left) / offsetScale.x,\n    right: (elementClientRect.right - clippingClientRect.right + paddingObject.right) / offsetScale.x\n  };\n}\n\n/**\n * Provides data to position an inner element of the floating element so that it\n * appears centered to the reference element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow = options => ({\n  name: 'arrow',\n  options,\n  async fn(state) {\n    const {\n      x,\n      y,\n      placement,\n      rects,\n      platform,\n      elements,\n      middlewareData\n    } = state;\n    // Since `element` is required, we don't Partial<> the type.\n    const {\n      element,\n      padding = 0\n    } = evaluate(options, state) || {};\n    if (element == null) {\n      return {};\n    }\n    const paddingObject = getPaddingObject(padding);\n    const coords = {\n      x,\n      y\n    };\n    const axis = getAlignmentAxis(placement);\n    const length = getAxisLength(axis);\n    const arrowDimensions = await platform.getDimensions(element);\n    const isYAxis = axis === 'y';\n    const minProp = isYAxis ? 'top' : 'left';\n    const maxProp = isYAxis ? 'bottom' : 'right';\n    const clientProp = isYAxis ? 'clientHeight' : 'clientWidth';\n    const endDiff = rects.reference[length] + rects.reference[axis] - coords[axis] - rects.floating[length];\n    const startDiff = coords[axis] - rects.reference[axis];\n    const arrowOffsetParent = await (platform.getOffsetParent == null ? void 0 : platform.getOffsetParent(element));\n    let clientSize = arrowOffsetParent ? arrowOffsetParent[clientProp] : 0;\n\n    // DOM platform can return `window` as the `offsetParent`.\n    if (!clientSize || !(await (platform.isElement == null ? void 0 : platform.isElement(arrowOffsetParent)))) {\n      clientSize = elements.floating[clientProp] || rects.floating[length];\n    }\n    const centerToReference = endDiff / 2 - startDiff / 2;\n\n    // If the padding is large enough that it causes the arrow to no longer be\n    // centered, modify the padding so that it is centered.\n    const largestPossiblePadding = clientSize / 2 - arrowDimensions[length] / 2 - 1;\n    const minPadding = min(paddingObject[minProp], largestPossiblePadding);\n    const maxPadding = min(paddingObject[maxProp], largestPossiblePadding);\n\n    // Make sure the arrow doesn't overflow the floating element if the center\n    // point is outside the floating element's bounds.\n    const min$1 = minPadding;\n    const max = clientSize - arrowDimensions[length] - maxPadding;\n    const center = clientSize / 2 - arrowDimensions[length] / 2 + centerToReference;\n    const offset = clamp(min$1, center, max);\n\n    // If the reference is small enough that the arrow's padding causes it to\n    // to point to nothing for an aligned placement, adjust the offset of the\n    // floating element itself. To ensure `shift()` continues to take action,\n    // a single reset is performed when this is true.\n    const shouldAddOffset = !middlewareData.arrow && getAlignment(placement) != null && center !== offset && rects.reference[length] / 2 - (center < min$1 ? minPadding : maxPadding) - arrowDimensions[length] / 2 < 0;\n    const alignmentOffset = shouldAddOffset ? center < min$1 ? center - min$1 : center - max : 0;\n    return {\n      [axis]: coords[axis] + alignmentOffset,\n      data: {\n        [axis]: offset,\n        centerOffset: center - offset - alignmentOffset,\n        ...(shouldAddOffset && {\n          alignmentOffset\n        })\n      },\n      reset: shouldAddOffset\n    };\n  }\n});\n\nfunction getPlacementList(alignment, autoAlignment, allowedPlacements) {\n  const allowedPlacementsSortedByAlignment = alignment ? [...allowedPlacements.filter(placement => getAlignment(placement) === alignment), ...allowedPlacements.filter(placement => getAlignment(placement) !== alignment)] : allowedPlacements.filter(placement => getSide(placement) === placement);\n  return allowedPlacementsSortedByAlignment.filter(placement => {\n    if (alignment) {\n      return getAlignment(placement) === alignment || (autoAlignment ? getOppositeAlignmentPlacement(placement) !== placement : false);\n    }\n    return true;\n  });\n}\n/**\n * Optimizes the visibility of the floating element by choosing the placement\n * that has the most space available automatically, without needing to specify a\n * preferred placement. Alternative to `flip`.\n * @see https://floating-ui.com/docs/autoPlacement\n */\nconst autoPlacement = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'autoPlacement',\n    options,\n    async fn(state) {\n      var _middlewareData$autoP, _middlewareData$autoP2, _placementsThatFitOnE;\n      const {\n        rects,\n        middlewareData,\n        placement,\n        platform,\n        elements\n      } = state;\n      const {\n        crossAxis = false,\n        alignment,\n        allowedPlacements = placements,\n        autoAlignment = true,\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      const placements$1 = alignment !== undefined || allowedPlacements === placements ? getPlacementList(alignment || null, autoAlignment, allowedPlacements) : allowedPlacements;\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const currentIndex = ((_middlewareData$autoP = middlewareData.autoPlacement) == null ? void 0 : _middlewareData$autoP.index) || 0;\n      const currentPlacement = placements$1[currentIndex];\n      if (currentPlacement == null) {\n        return {};\n      }\n      const alignmentSides = getAlignmentSides(currentPlacement, rects, await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating)));\n\n      // Make `computeCoords` start from the right place.\n      if (placement !== currentPlacement) {\n        return {\n          reset: {\n            placement: placements$1[0]\n          }\n        };\n      }\n      const currentOverflows = [overflow[getSide(currentPlacement)], overflow[alignmentSides[0]], overflow[alignmentSides[1]]];\n      const allOverflows = [...(((_middlewareData$autoP2 = middlewareData.autoPlacement) == null ? void 0 : _middlewareData$autoP2.overflows) || []), {\n        placement: currentPlacement,\n        overflows: currentOverflows\n      }];\n      const nextPlacement = placements$1[currentIndex + 1];\n\n      // There are more placements to check.\n      if (nextPlacement) {\n        return {\n          data: {\n            index: currentIndex + 1,\n            overflows: allOverflows\n          },\n          reset: {\n            placement: nextPlacement\n          }\n        };\n      }\n      const placementsSortedByMostSpace = allOverflows.map(d => {\n        const alignment = getAlignment(d.placement);\n        return [d.placement, alignment && crossAxis ?\n        // Check along the mainAxis and main crossAxis side.\n        d.overflows.slice(0, 2).reduce((acc, v) => acc + v, 0) :\n        // Check only the mainAxis.\n        d.overflows[0], d.overflows];\n      }).sort((a, b) => a[1] - b[1]);\n      const placementsThatFitOnEachSide = placementsSortedByMostSpace.filter(d => d[2].slice(0,\n      // Aligned placements should not check their opposite crossAxis\n      // side.\n      getAlignment(d[0]) ? 2 : 3).every(v => v <= 0));\n      const resetPlacement = ((_placementsThatFitOnE = placementsThatFitOnEachSide[0]) == null ? void 0 : _placementsThatFitOnE[0]) || placementsSortedByMostSpace[0][0];\n      if (resetPlacement !== placement) {\n        return {\n          data: {\n            index: currentIndex + 1,\n            overflows: allOverflows\n          },\n          reset: {\n            placement: resetPlacement\n          }\n        };\n      }\n      return {};\n    }\n  };\n};\n\n/**\n * Optimizes the visibility of the floating element by flipping the `placement`\n * in order to keep it in view when the preferred placement(s) will overflow the\n * clipping boundary. Alternative to `autoPlacement`.\n * @see https://floating-ui.com/docs/flip\n */\nconst flip = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'flip',\n    options,\n    async fn(state) {\n      var _middlewareData$arrow, _middlewareData$flip;\n      const {\n        placement,\n        middlewareData,\n        rects,\n        initialPlacement,\n        platform,\n        elements\n      } = state;\n      const {\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = true,\n        fallbackPlacements: specifiedFallbackPlacements,\n        fallbackStrategy = 'bestFit',\n        fallbackAxisSideDirection = 'none',\n        flipAlignment = true,\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n\n      // If a reset by the arrow was caused due to an alignment offset being\n      // added, we should skip any logic now since `flip()` has already done its\n      // work.\n      // https://github.com/floating-ui/floating-ui/issues/2549#issuecomment-1719601643\n      if ((_middlewareData$arrow = middlewareData.arrow) != null && _middlewareData$arrow.alignmentOffset) {\n        return {};\n      }\n      const side = getSide(placement);\n      const initialSideAxis = getSideAxis(initialPlacement);\n      const isBasePlacement = getSide(initialPlacement) === initialPlacement;\n      const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating));\n      const fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipAlignment ? [getOppositePlacement(initialPlacement)] : getExpandedPlacements(initialPlacement));\n      const hasFallbackAxisSideDirection = fallbackAxisSideDirection !== 'none';\n      if (!specifiedFallbackPlacements && hasFallbackAxisSideDirection) {\n        fallbackPlacements.push(...getOppositeAxisPlacements(initialPlacement, flipAlignment, fallbackAxisSideDirection, rtl));\n      }\n      const placements = [initialPlacement, ...fallbackPlacements];\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const overflows = [];\n      let overflowsData = ((_middlewareData$flip = middlewareData.flip) == null ? void 0 : _middlewareData$flip.overflows) || [];\n      if (checkMainAxis) {\n        overflows.push(overflow[side]);\n      }\n      if (checkCrossAxis) {\n        const sides = getAlignmentSides(placement, rects, rtl);\n        overflows.push(overflow[sides[0]], overflow[sides[1]]);\n      }\n      overflowsData = [...overflowsData, {\n        placement,\n        overflows\n      }];\n\n      // One or more sides is overflowing.\n      if (!overflows.every(side => side <= 0)) {\n        var _middlewareData$flip2, _overflowsData$filter;\n        const nextIndex = (((_middlewareData$flip2 = middlewareData.flip) == null ? void 0 : _middlewareData$flip2.index) || 0) + 1;\n        const nextPlacement = placements[nextIndex];\n        if (nextPlacement) {\n          const ignoreCrossAxisOverflow = checkCrossAxis === 'alignment' ? initialSideAxis !== getSideAxis(nextPlacement) : false;\n          if (!ignoreCrossAxisOverflow ||\n          // We leave the current main axis only if every placement on that axis\n          // overflows the main axis.\n          overflowsData.every(d => getSideAxis(d.placement) === initialSideAxis ? d.overflows[0] > 0 : true)) {\n            // Try next placement and re-run the lifecycle.\n            return {\n              data: {\n                index: nextIndex,\n                overflows: overflowsData\n              },\n              reset: {\n                placement: nextPlacement\n              }\n            };\n          }\n        }\n\n        // First, find the candidates that fit on the mainAxis side of overflow,\n        // then find the placement that fits the best on the main crossAxis side.\n        let resetPlacement = (_overflowsData$filter = overflowsData.filter(d => d.overflows[0] <= 0).sort((a, b) => a.overflows[1] - b.overflows[1])[0]) == null ? void 0 : _overflowsData$filter.placement;\n\n        // Otherwise fallback.\n        if (!resetPlacement) {\n          switch (fallbackStrategy) {\n            case 'bestFit':\n              {\n                var _overflowsData$filter2;\n                const placement = (_overflowsData$filter2 = overflowsData.filter(d => {\n                  if (hasFallbackAxisSideDirection) {\n                    const currentSideAxis = getSideAxis(d.placement);\n                    return currentSideAxis === initialSideAxis ||\n                    // Create a bias to the `y` side axis due to horizontal\n                    // reading directions favoring greater width.\n                    currentSideAxis === 'y';\n                  }\n                  return true;\n                }).map(d => [d.placement, d.overflows.filter(overflow => overflow > 0).reduce((acc, overflow) => acc + overflow, 0)]).sort((a, b) => a[1] - b[1])[0]) == null ? void 0 : _overflowsData$filter2[0];\n                if (placement) {\n                  resetPlacement = placement;\n                }\n                break;\n              }\n            case 'initialPlacement':\n              resetPlacement = initialPlacement;\n              break;\n          }\n        }\n        if (placement !== resetPlacement) {\n          return {\n            reset: {\n              placement: resetPlacement\n            }\n          };\n        }\n      }\n      return {};\n    }\n  };\n};\n\nfunction getSideOffsets(overflow, rect) {\n  return {\n    top: overflow.top - rect.height,\n    right: overflow.right - rect.width,\n    bottom: overflow.bottom - rect.height,\n    left: overflow.left - rect.width\n  };\n}\nfunction isAnySideFullyClipped(overflow) {\n  return sides.some(side => overflow[side] >= 0);\n}\n/**\n * Provides data to hide the floating element in applicable situations, such as\n * when it is not in the same clipping context as the reference element.\n * @see https://floating-ui.com/docs/hide\n */\nconst hide = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'hide',\n    options,\n    async fn(state) {\n      const {\n        rects\n      } = state;\n      const {\n        strategy = 'referenceHidden',\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      switch (strategy) {\n        case 'referenceHidden':\n          {\n            const overflow = await detectOverflow(state, {\n              ...detectOverflowOptions,\n              elementContext: 'reference'\n            });\n            const offsets = getSideOffsets(overflow, rects.reference);\n            return {\n              data: {\n                referenceHiddenOffsets: offsets,\n                referenceHidden: isAnySideFullyClipped(offsets)\n              }\n            };\n          }\n        case 'escaped':\n          {\n            const overflow = await detectOverflow(state, {\n              ...detectOverflowOptions,\n              altBoundary: true\n            });\n            const offsets = getSideOffsets(overflow, rects.floating);\n            return {\n              data: {\n                escapedOffsets: offsets,\n                escaped: isAnySideFullyClipped(offsets)\n              }\n            };\n          }\n        default:\n          {\n            return {};\n          }\n      }\n    }\n  };\n};\n\nfunction getBoundingRect(rects) {\n  const minX = min(...rects.map(rect => rect.left));\n  const minY = min(...rects.map(rect => rect.top));\n  const maxX = max(...rects.map(rect => rect.right));\n  const maxY = max(...rects.map(rect => rect.bottom));\n  return {\n    x: minX,\n    y: minY,\n    width: maxX - minX,\n    height: maxY - minY\n  };\n}\nfunction getRectsByLine(rects) {\n  const sortedRects = rects.slice().sort((a, b) => a.y - b.y);\n  const groups = [];\n  let prevRect = null;\n  for (let i = 0; i < sortedRects.length; i++) {\n    const rect = sortedRects[i];\n    if (!prevRect || rect.y - prevRect.y > prevRect.height / 2) {\n      groups.push([rect]);\n    } else {\n      groups[groups.length - 1].push(rect);\n    }\n    prevRect = rect;\n  }\n  return groups.map(rect => rectToClientRect(getBoundingRect(rect)));\n}\n/**\n * Provides improved positioning for inline reference elements that can span\n * over multiple lines, such as hyperlinks or range selections.\n * @see https://floating-ui.com/docs/inline\n */\nconst inline = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'inline',\n    options,\n    async fn(state) {\n      const {\n        placement,\n        elements,\n        rects,\n        platform,\n        strategy\n      } = state;\n      // A MouseEvent's client{X,Y} coords can be up to 2 pixels off a\n      // ClientRect's bounds, despite the event listener being triggered. A\n      // padding of 2 seems to handle this issue.\n      const {\n        padding = 2,\n        x,\n        y\n      } = evaluate(options, state);\n      const nativeClientRects = Array.from((await (platform.getClientRects == null ? void 0 : platform.getClientRects(elements.reference))) || []);\n      const clientRects = getRectsByLine(nativeClientRects);\n      const fallback = rectToClientRect(getBoundingRect(nativeClientRects));\n      const paddingObject = getPaddingObject(padding);\n      function getBoundingClientRect() {\n        // There are two rects and they are disjoined.\n        if (clientRects.length === 2 && clientRects[0].left > clientRects[1].right && x != null && y != null) {\n          // Find the first rect in which the point is fully inside.\n          return clientRects.find(rect => x > rect.left - paddingObject.left && x < rect.right + paddingObject.right && y > rect.top - paddingObject.top && y < rect.bottom + paddingObject.bottom) || fallback;\n        }\n\n        // There are 2 or more connected rects.\n        if (clientRects.length >= 2) {\n          if (getSideAxis(placement) === 'y') {\n            const firstRect = clientRects[0];\n            const lastRect = clientRects[clientRects.length - 1];\n            const isTop = getSide(placement) === 'top';\n            const top = firstRect.top;\n            const bottom = lastRect.bottom;\n            const left = isTop ? firstRect.left : lastRect.left;\n            const right = isTop ? firstRect.right : lastRect.right;\n            const width = right - left;\n            const height = bottom - top;\n            return {\n              top,\n              bottom,\n              left,\n              right,\n              width,\n              height,\n              x: left,\n              y: top\n            };\n          }\n          const isLeftSide = getSide(placement) === 'left';\n          const maxRight = max(...clientRects.map(rect => rect.right));\n          const minLeft = min(...clientRects.map(rect => rect.left));\n          const measureRects = clientRects.filter(rect => isLeftSide ? rect.left === minLeft : rect.right === maxRight);\n          const top = measureRects[0].top;\n          const bottom = measureRects[measureRects.length - 1].bottom;\n          const left = minLeft;\n          const right = maxRight;\n          const width = right - left;\n          const height = bottom - top;\n          return {\n            top,\n            bottom,\n            left,\n            right,\n            width,\n            height,\n            x: left,\n            y: top\n          };\n        }\n        return fallback;\n      }\n      const resetRects = await platform.getElementRects({\n        reference: {\n          getBoundingClientRect\n        },\n        floating: elements.floating,\n        strategy\n      });\n      if (rects.reference.x !== resetRects.reference.x || rects.reference.y !== resetRects.reference.y || rects.reference.width !== resetRects.reference.width || rects.reference.height !== resetRects.reference.height) {\n        return {\n          reset: {\n            rects: resetRects\n          }\n        };\n      }\n      return {};\n    }\n  };\n};\n\nconst originSides = /*#__PURE__*/new Set(['left', 'top']);\n\n// For type backwards-compatibility, the `OffsetOptions` type was also\n// Derivable.\n\nasync function convertValueToCoords(state, options) {\n  const {\n    placement,\n    platform,\n    elements\n  } = state;\n  const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating));\n  const side = getSide(placement);\n  const alignment = getAlignment(placement);\n  const isVertical = getSideAxis(placement) === 'y';\n  const mainAxisMulti = originSides.has(side) ? -1 : 1;\n  const crossAxisMulti = rtl && isVertical ? -1 : 1;\n  const rawValue = evaluate(options, state);\n\n  // eslint-disable-next-line prefer-const\n  let {\n    mainAxis,\n    crossAxis,\n    alignmentAxis\n  } = typeof rawValue === 'number' ? {\n    mainAxis: rawValue,\n    crossAxis: 0,\n    alignmentAxis: null\n  } : {\n    mainAxis: rawValue.mainAxis || 0,\n    crossAxis: rawValue.crossAxis || 0,\n    alignmentAxis: rawValue.alignmentAxis\n  };\n  if (alignment && typeof alignmentAxis === 'number') {\n    crossAxis = alignment === 'end' ? alignmentAxis * -1 : alignmentAxis;\n  }\n  return isVertical ? {\n    x: crossAxis * crossAxisMulti,\n    y: mainAxis * mainAxisMulti\n  } : {\n    x: mainAxis * mainAxisMulti,\n    y: crossAxis * crossAxisMulti\n  };\n}\n\n/**\n * Modifies the placement by translating the floating element along the\n * specified axes.\n * A number (shorthand for `mainAxis` or distance), or an axes configuration\n * object may be passed.\n * @see https://floating-ui.com/docs/offset\n */\nconst offset = function (options) {\n  if (options === void 0) {\n    options = 0;\n  }\n  return {\n    name: 'offset',\n    options,\n    async fn(state) {\n      var _middlewareData$offse, _middlewareData$arrow;\n      const {\n        x,\n        y,\n        placement,\n        middlewareData\n      } = state;\n      const diffCoords = await convertValueToCoords(state, options);\n\n      // If the placement is the same and the arrow caused an alignment offset\n      // then we don't need to change the positioning coordinates.\n      if (placement === ((_middlewareData$offse = middlewareData.offset) == null ? void 0 : _middlewareData$offse.placement) && (_middlewareData$arrow = middlewareData.arrow) != null && _middlewareData$arrow.alignmentOffset) {\n        return {};\n      }\n      return {\n        x: x + diffCoords.x,\n        y: y + diffCoords.y,\n        data: {\n          ...diffCoords,\n          placement\n        }\n      };\n    }\n  };\n};\n\n/**\n * Optimizes the visibility of the floating element by shifting it in order to\n * keep it in view when it will overflow the clipping boundary.\n * @see https://floating-ui.com/docs/shift\n */\nconst shift = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'shift',\n    options,\n    async fn(state) {\n      const {\n        x,\n        y,\n        placement\n      } = state;\n      const {\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = false,\n        limiter = {\n          fn: _ref => {\n            let {\n              x,\n              y\n            } = _ref;\n            return {\n              x,\n              y\n            };\n          }\n        },\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      const coords = {\n        x,\n        y\n      };\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const crossAxis = getSideAxis(getSide(placement));\n      const mainAxis = getOppositeAxis(crossAxis);\n      let mainAxisCoord = coords[mainAxis];\n      let crossAxisCoord = coords[crossAxis];\n      if (checkMainAxis) {\n        const minSide = mainAxis === 'y' ? 'top' : 'left';\n        const maxSide = mainAxis === 'y' ? 'bottom' : 'right';\n        const min = mainAxisCoord + overflow[minSide];\n        const max = mainAxisCoord - overflow[maxSide];\n        mainAxisCoord = clamp(min, mainAxisCoord, max);\n      }\n      if (checkCrossAxis) {\n        const minSide = crossAxis === 'y' ? 'top' : 'left';\n        const maxSide = crossAxis === 'y' ? 'bottom' : 'right';\n        const min = crossAxisCoord + overflow[minSide];\n        const max = crossAxisCoord - overflow[maxSide];\n        crossAxisCoord = clamp(min, crossAxisCoord, max);\n      }\n      const limitedCoords = limiter.fn({\n        ...state,\n        [mainAxis]: mainAxisCoord,\n        [crossAxis]: crossAxisCoord\n      });\n      return {\n        ...limitedCoords,\n        data: {\n          x: limitedCoords.x - x,\n          y: limitedCoords.y - y,\n          enabled: {\n            [mainAxis]: checkMainAxis,\n            [crossAxis]: checkCrossAxis\n          }\n        }\n      };\n    }\n  };\n};\n/**\n * Built-in `limiter` that will stop `shift()` at a certain point.\n */\nconst limitShift = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    options,\n    fn(state) {\n      const {\n        x,\n        y,\n        placement,\n        rects,\n        middlewareData\n      } = state;\n      const {\n        offset = 0,\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = true\n      } = evaluate(options, state);\n      const coords = {\n        x,\n        y\n      };\n      const crossAxis = getSideAxis(placement);\n      const mainAxis = getOppositeAxis(crossAxis);\n      let mainAxisCoord = coords[mainAxis];\n      let crossAxisCoord = coords[crossAxis];\n      const rawOffset = evaluate(offset, state);\n      const computedOffset = typeof rawOffset === 'number' ? {\n        mainAxis: rawOffset,\n        crossAxis: 0\n      } : {\n        mainAxis: 0,\n        crossAxis: 0,\n        ...rawOffset\n      };\n      if (checkMainAxis) {\n        const len = mainAxis === 'y' ? 'height' : 'width';\n        const limitMin = rects.reference[mainAxis] - rects.floating[len] + computedOffset.mainAxis;\n        const limitMax = rects.reference[mainAxis] + rects.reference[len] - computedOffset.mainAxis;\n        if (mainAxisCoord < limitMin) {\n          mainAxisCoord = limitMin;\n        } else if (mainAxisCoord > limitMax) {\n          mainAxisCoord = limitMax;\n        }\n      }\n      if (checkCrossAxis) {\n        var _middlewareData$offse, _middlewareData$offse2;\n        const len = mainAxis === 'y' ? 'width' : 'height';\n        const isOriginSide = originSides.has(getSide(placement));\n        const limitMin = rects.reference[crossAxis] - rects.floating[len] + (isOriginSide ? ((_middlewareData$offse = middlewareData.offset) == null ? void 0 : _middlewareData$offse[crossAxis]) || 0 : 0) + (isOriginSide ? 0 : computedOffset.crossAxis);\n        const limitMax = rects.reference[crossAxis] + rects.reference[len] + (isOriginSide ? 0 : ((_middlewareData$offse2 = middlewareData.offset) == null ? void 0 : _middlewareData$offse2[crossAxis]) || 0) - (isOriginSide ? computedOffset.crossAxis : 0);\n        if (crossAxisCoord < limitMin) {\n          crossAxisCoord = limitMin;\n        } else if (crossAxisCoord > limitMax) {\n          crossAxisCoord = limitMax;\n        }\n      }\n      return {\n        [mainAxis]: mainAxisCoord,\n        [crossAxis]: crossAxisCoord\n      };\n    }\n  };\n};\n\n/**\n * Provides data that allows you to change the size of the floating element \n * for instance, prevent it from overflowing the clipping boundary or match the\n * width of the reference element.\n * @see https://floating-ui.com/docs/size\n */\nconst size = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'size',\n    options,\n    async fn(state) {\n      var _state$middlewareData, _state$middlewareData2;\n      const {\n        placement,\n        rects,\n        platform,\n        elements\n      } = state;\n      const {\n        apply = () => {},\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const side = getSide(placement);\n      const alignment = getAlignment(placement);\n      const isYAxis = getSideAxis(placement) === 'y';\n      const {\n        width,\n        height\n      } = rects.floating;\n      let heightSide;\n      let widthSide;\n      if (side === 'top' || side === 'bottom') {\n        heightSide = side;\n        widthSide = alignment === ((await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating))) ? 'start' : 'end') ? 'left' : 'right';\n      } else {\n        widthSide = side;\n        heightSide = alignment === 'end' ? 'top' : 'bottom';\n      }\n      const maximumClippingHeight = height - overflow.top - overflow.bottom;\n      const maximumClippingWidth = width - overflow.left - overflow.right;\n      const overflowAvailableHeight = min(height - overflow[heightSide], maximumClippingHeight);\n      const overflowAvailableWidth = min(width - overflow[widthSide], maximumClippingWidth);\n      const noShift = !state.middlewareData.shift;\n      let availableHeight = overflowAvailableHeight;\n      let availableWidth = overflowAvailableWidth;\n      if ((_state$middlewareData = state.middlewareData.shift) != null && _state$middlewareData.enabled.x) {\n        availableWidth = maximumClippingWidth;\n      }\n      if ((_state$middlewareData2 = state.middlewareData.shift) != null && _state$middlewareData2.enabled.y) {\n        availableHeight = maximumClippingHeight;\n      }\n      if (noShift && !alignment) {\n        const xMin = max(overflow.left, 0);\n        const xMax = max(overflow.right, 0);\n        const yMin = max(overflow.top, 0);\n        const yMax = max(overflow.bottom, 0);\n        if (isYAxis) {\n          availableWidth = width - 2 * (xMin !== 0 || xMax !== 0 ? xMin + xMax : max(overflow.left, overflow.right));\n        } else {\n          availableHeight = height - 2 * (yMin !== 0 || yMax !== 0 ? yMin + yMax : max(overflow.top, overflow.bottom));\n        }\n      }\n      await apply({\n        ...state,\n        availableWidth,\n        availableHeight\n      });\n      const nextDimensions = await platform.getDimensions(elements.floating);\n      if (width !== nextDimensions.width || height !== nextDimensions.height) {\n        return {\n          reset: {\n            rects: true\n          }\n        };\n      }\n      return {};\n    }\n  };\n};\n\nexport { arrow, autoPlacement, computePosition, detectOverflow, flip, hide, inline, limitShift, offset, shift, size };\n", "function hasWindow() {\n  return typeof window !== 'undefined';\n}\nfunction getNodeName(node) {\n  if (isNode(node)) {\n    return (node.nodeName || '').toLowerCase();\n  }\n  // Mocked nodes in testing environments may not be instances of Node. By\n  // returning `#document` an infinite loop won't occur.\n  // https://github.com/floating-ui/floating-ui/issues/2317\n  return '#document';\n}\nfunction getWindow(node) {\n  var _node$ownerDocument;\n  return (node == null || (_node$ownerDocument = node.ownerDocument) == null ? void 0 : _node$ownerDocument.defaultView) || window;\n}\nfunction getDocumentElement(node) {\n  var _ref;\n  return (_ref = (isNode(node) ? node.ownerDocument : node.document) || window.document) == null ? void 0 : _ref.documentElement;\n}\nfunction isNode(value) {\n  if (!hasWindow()) {\n    return false;\n  }\n  return value instanceof Node || value instanceof getWindow(value).Node;\n}\nfunction isElement(value) {\n  if (!hasWindow()) {\n    return false;\n  }\n  return value instanceof Element || value instanceof getWindow(value).Element;\n}\nfunction isHTMLElement(value) {\n  if (!hasWindow()) {\n    return false;\n  }\n  return value instanceof HTMLElement || value instanceof getWindow(value).HTMLElement;\n}\nfunction isShadowRoot(value) {\n  if (!hasWindow() || typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n  return value instanceof ShadowRoot || value instanceof getWindow(value).ShadowRoot;\n}\nconst invalidOverflowDisplayValues = /*#__PURE__*/new Set(['inline', 'contents']);\nfunction isOverflowElement(element) {\n  const {\n    overflow,\n    overflowX,\n    overflowY,\n    display\n  } = getComputedStyle(element);\n  return /auto|scroll|overlay|hidden|clip/.test(overflow + overflowY + overflowX) && !invalidOverflowDisplayValues.has(display);\n}\nconst tableElements = /*#__PURE__*/new Set(['table', 'td', 'th']);\nfunction isTableElement(element) {\n  return tableElements.has(getNodeName(element));\n}\nconst topLayerSelectors = [':popover-open', ':modal'];\nfunction isTopLayer(element) {\n  return topLayerSelectors.some(selector => {\n    try {\n      return element.matches(selector);\n    } catch (_e) {\n      return false;\n    }\n  });\n}\nconst transformProperties = ['transform', 'translate', 'scale', 'rotate', 'perspective'];\nconst willChangeValues = ['transform', 'translate', 'scale', 'rotate', 'perspective', 'filter'];\nconst containValues = ['paint', 'layout', 'strict', 'content'];\nfunction isContainingBlock(elementOrCss) {\n  const webkit = isWebKit();\n  const css = isElement(elementOrCss) ? getComputedStyle(elementOrCss) : elementOrCss;\n\n  // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n  // https://drafts.csswg.org/css-transforms-2/#individual-transforms\n  return transformProperties.some(value => css[value] ? css[value] !== 'none' : false) || (css.containerType ? css.containerType !== 'normal' : false) || !webkit && (css.backdropFilter ? css.backdropFilter !== 'none' : false) || !webkit && (css.filter ? css.filter !== 'none' : false) || willChangeValues.some(value => (css.willChange || '').includes(value)) || containValues.some(value => (css.contain || '').includes(value));\n}\nfunction getContainingBlock(element) {\n  let currentNode = getParentNode(element);\n  while (isHTMLElement(currentNode) && !isLastTraversableNode(currentNode)) {\n    if (isContainingBlock(currentNode)) {\n      return currentNode;\n    } else if (isTopLayer(currentNode)) {\n      return null;\n    }\n    currentNode = getParentNode(currentNode);\n  }\n  return null;\n}\nfunction isWebKit() {\n  if (typeof CSS === 'undefined' || !CSS.supports) return false;\n  return CSS.supports('-webkit-backdrop-filter', 'none');\n}\nconst lastTraversableNodeNames = /*#__PURE__*/new Set(['html', 'body', '#document']);\nfunction isLastTraversableNode(node) {\n  return lastTraversableNodeNames.has(getNodeName(node));\n}\nfunction getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}\nfunction getNodeScroll(element) {\n  if (isElement(element)) {\n    return {\n      scrollLeft: element.scrollLeft,\n      scrollTop: element.scrollTop\n    };\n  }\n  return {\n    scrollLeft: element.scrollX,\n    scrollTop: element.scrollY\n  };\n}\nfunction getParentNode(node) {\n  if (getNodeName(node) === 'html') {\n    return node;\n  }\n  const result =\n  // Step into the shadow DOM of the parent of a slotted node.\n  node.assignedSlot ||\n  // DOM Element detected.\n  node.parentNode ||\n  // ShadowRoot detected.\n  isShadowRoot(node) && node.host ||\n  // Fallback.\n  getDocumentElement(node);\n  return isShadowRoot(result) ? result.host : result;\n}\nfunction getNearestOverflowAncestor(node) {\n  const parentNode = getParentNode(node);\n  if (isLastTraversableNode(parentNode)) {\n    return node.ownerDocument ? node.ownerDocument.body : node.body;\n  }\n  if (isHTMLElement(parentNode) && isOverflowElement(parentNode)) {\n    return parentNode;\n  }\n  return getNearestOverflowAncestor(parentNode);\n}\nfunction getOverflowAncestors(node, list, traverseIframes) {\n  var _node$ownerDocument2;\n  if (list === void 0) {\n    list = [];\n  }\n  if (traverseIframes === void 0) {\n    traverseIframes = true;\n  }\n  const scrollableAncestor = getNearestOverflowAncestor(node);\n  const isBody = scrollableAncestor === ((_node$ownerDocument2 = node.ownerDocument) == null ? void 0 : _node$ownerDocument2.body);\n  const win = getWindow(scrollableAncestor);\n  if (isBody) {\n    const frameElement = getFrameElement(win);\n    return list.concat(win, win.visualViewport || [], isOverflowElement(scrollableAncestor) ? scrollableAncestor : [], frameElement && traverseIframes ? getOverflowAncestors(frameElement) : []);\n  }\n  return list.concat(scrollableAncestor, getOverflowAncestors(scrollableAncestor, [], traverseIframes));\n}\nfunction getFrameElement(win) {\n  return win.parent && Object.getPrototypeOf(win.parent) ? win.frameElement : null;\n}\n\nexport { getComputedStyle, getContainingBlock, getDocumentElement, getFrameElement, getNearestOverflowAncestor, getNodeName, getNodeScroll, getOverflowAncestors, getParentNode, getWindow, isContainingBlock, isElement, isHTMLElement, isLastTraversableNode, isNode, isOverflowElement, isShadowRoot, isTableElement, isTopLayer, isWebKit };\n", "import { rectToClientRect, arrow as arrow$1, autoPlacement as autoPlacement$1, detectOverflow as detectOverflow$1, flip as flip$1, hide as hide$1, inline as inline$1, limitShift as limitShift$1, offset as offset$1, shift as shift$1, size as size$1, computePosition as computePosition$1 } from '@floating-ui/core';\nimport { round, createCoords, max, min, floor } from '@floating-ui/utils';\nimport { getComputedStyle as getComputedStyle$1, isHTMLElement, isElement, getWindow, isWebKit, getFrameElement, getNodeScroll, getDocumentElement, isTopLayer, getNodeName, isOverflowElement, getOverflowAncestors, getParentNode, isLastTraversableNode, isContainingBlock, isTableElement, getContainingBlock } from '@floating-ui/utils/dom';\nexport { getOverflowAncestors } from '@floating-ui/utils/dom';\n\nfunction getCssDimensions(element) {\n  const css = getComputedStyle$1(element);\n  // In testing environments, the `width` and `height` properties are empty\n  // strings for SVG elements, returning NaN. Fallback to `0` in this case.\n  let width = parseFloat(css.width) || 0;\n  let height = parseFloat(css.height) || 0;\n  const hasOffset = isHTMLElement(element);\n  const offsetWidth = hasOffset ? element.offsetWidth : width;\n  const offsetHeight = hasOffset ? element.offsetHeight : height;\n  const shouldFallback = round(width) !== offsetWidth || round(height) !== offsetHeight;\n  if (shouldFallback) {\n    width = offsetWidth;\n    height = offsetHeight;\n  }\n  return {\n    width,\n    height,\n    $: shouldFallback\n  };\n}\n\nfunction unwrapElement(element) {\n  return !isElement(element) ? element.contextElement : element;\n}\n\nfunction getScale(element) {\n  const domElement = unwrapElement(element);\n  if (!isHTMLElement(domElement)) {\n    return createCoords(1);\n  }\n  const rect = domElement.getBoundingClientRect();\n  const {\n    width,\n    height,\n    $\n  } = getCssDimensions(domElement);\n  let x = ($ ? round(rect.width) : rect.width) / width;\n  let y = ($ ? round(rect.height) : rect.height) / height;\n\n  // 0, NaN, or Infinity should always fallback to 1.\n\n  if (!x || !Number.isFinite(x)) {\n    x = 1;\n  }\n  if (!y || !Number.isFinite(y)) {\n    y = 1;\n  }\n  return {\n    x,\n    y\n  };\n}\n\nconst noOffsets = /*#__PURE__*/createCoords(0);\nfunction getVisualOffsets(element) {\n  const win = getWindow(element);\n  if (!isWebKit() || !win.visualViewport) {\n    return noOffsets;\n  }\n  return {\n    x: win.visualViewport.offsetLeft,\n    y: win.visualViewport.offsetTop\n  };\n}\nfunction shouldAddVisualOffsets(element, isFixed, floatingOffsetParent) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n  if (!floatingOffsetParent || isFixed && floatingOffsetParent !== getWindow(element)) {\n    return false;\n  }\n  return isFixed;\n}\n\nfunction getBoundingClientRect(element, includeScale, isFixedStrategy, offsetParent) {\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n  if (isFixedStrategy === void 0) {\n    isFixedStrategy = false;\n  }\n  const clientRect = element.getBoundingClientRect();\n  const domElement = unwrapElement(element);\n  let scale = createCoords(1);\n  if (includeScale) {\n    if (offsetParent) {\n      if (isElement(offsetParent)) {\n        scale = getScale(offsetParent);\n      }\n    } else {\n      scale = getScale(element);\n    }\n  }\n  const visualOffsets = shouldAddVisualOffsets(domElement, isFixedStrategy, offsetParent) ? getVisualOffsets(domElement) : createCoords(0);\n  let x = (clientRect.left + visualOffsets.x) / scale.x;\n  let y = (clientRect.top + visualOffsets.y) / scale.y;\n  let width = clientRect.width / scale.x;\n  let height = clientRect.height / scale.y;\n  if (domElement) {\n    const win = getWindow(domElement);\n    const offsetWin = offsetParent && isElement(offsetParent) ? getWindow(offsetParent) : offsetParent;\n    let currentWin = win;\n    let currentIFrame = getFrameElement(currentWin);\n    while (currentIFrame && offsetParent && offsetWin !== currentWin) {\n      const iframeScale = getScale(currentIFrame);\n      const iframeRect = currentIFrame.getBoundingClientRect();\n      const css = getComputedStyle$1(currentIFrame);\n      const left = iframeRect.left + (currentIFrame.clientLeft + parseFloat(css.paddingLeft)) * iframeScale.x;\n      const top = iframeRect.top + (currentIFrame.clientTop + parseFloat(css.paddingTop)) * iframeScale.y;\n      x *= iframeScale.x;\n      y *= iframeScale.y;\n      width *= iframeScale.x;\n      height *= iframeScale.y;\n      x += left;\n      y += top;\n      currentWin = getWindow(currentIFrame);\n      currentIFrame = getFrameElement(currentWin);\n    }\n  }\n  return rectToClientRect({\n    width,\n    height,\n    x,\n    y\n  });\n}\n\n// If <html> has a CSS width greater than the viewport, then this will be\n// incorrect for RTL.\nfunction getWindowScrollBarX(element, rect) {\n  const leftScroll = getNodeScroll(element).scrollLeft;\n  if (!rect) {\n    return getBoundingClientRect(getDocumentElement(element)).left + leftScroll;\n  }\n  return rect.left + leftScroll;\n}\n\nfunction getHTMLOffset(documentElement, scroll) {\n  const htmlRect = documentElement.getBoundingClientRect();\n  const x = htmlRect.left + scroll.scrollLeft - getWindowScrollBarX(documentElement, htmlRect);\n  const y = htmlRect.top + scroll.scrollTop;\n  return {\n    x,\n    y\n  };\n}\n\nfunction convertOffsetParentRelativeRectToViewportRelativeRect(_ref) {\n  let {\n    elements,\n    rect,\n    offsetParent,\n    strategy\n  } = _ref;\n  const isFixed = strategy === 'fixed';\n  const documentElement = getDocumentElement(offsetParent);\n  const topLayer = elements ? isTopLayer(elements.floating) : false;\n  if (offsetParent === documentElement || topLayer && isFixed) {\n    return rect;\n  }\n  let scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  let scale = createCoords(1);\n  const offsets = createCoords(0);\n  const isOffsetParentAnElement = isHTMLElement(offsetParent);\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || isOverflowElement(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n    if (isHTMLElement(offsetParent)) {\n      const offsetRect = getBoundingClientRect(offsetParent);\n      scale = getScale(offsetParent);\n      offsets.x = offsetRect.x + offsetParent.clientLeft;\n      offsets.y = offsetRect.y + offsetParent.clientTop;\n    }\n  }\n  const htmlOffset = documentElement && !isOffsetParentAnElement && !isFixed ? getHTMLOffset(documentElement, scroll) : createCoords(0);\n  return {\n    width: rect.width * scale.x,\n    height: rect.height * scale.y,\n    x: rect.x * scale.x - scroll.scrollLeft * scale.x + offsets.x + htmlOffset.x,\n    y: rect.y * scale.y - scroll.scrollTop * scale.y + offsets.y + htmlOffset.y\n  };\n}\n\nfunction getClientRects(element) {\n  return Array.from(element.getClientRects());\n}\n\n// Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable.\nfunction getDocumentRect(element) {\n  const html = getDocumentElement(element);\n  const scroll = getNodeScroll(element);\n  const body = element.ownerDocument.body;\n  const width = max(html.scrollWidth, html.clientWidth, body.scrollWidth, body.clientWidth);\n  const height = max(html.scrollHeight, html.clientHeight, body.scrollHeight, body.clientHeight);\n  let x = -scroll.scrollLeft + getWindowScrollBarX(element);\n  const y = -scroll.scrollTop;\n  if (getComputedStyle$1(body).direction === 'rtl') {\n    x += max(html.clientWidth, body.clientWidth) - width;\n  }\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\n\n// Safety check: ensure the scrollbar space is reasonable in case this\n// calculation is affected by unusual styles.\n// Most scrollbars leave 15-18px of space.\nconst SCROLLBAR_MAX = 25;\nfunction getViewportRect(element, strategy) {\n  const win = getWindow(element);\n  const html = getDocumentElement(element);\n  const visualViewport = win.visualViewport;\n  let width = html.clientWidth;\n  let height = html.clientHeight;\n  let x = 0;\n  let y = 0;\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height;\n    const visualViewportBased = isWebKit();\n    if (!visualViewportBased || visualViewportBased && strategy === 'fixed') {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n  const windowScrollbarX = getWindowScrollBarX(html);\n  // <html> `overflow: hidden` + `scrollbar-gutter: stable` reduces the\n  // visual width of the <html> but this is not considered in the size\n  // of `html.clientWidth`.\n  if (windowScrollbarX <= 0) {\n    const doc = html.ownerDocument;\n    const body = doc.body;\n    const bodyStyles = getComputedStyle(body);\n    const bodyMarginInline = doc.compatMode === 'CSS1Compat' ? parseFloat(bodyStyles.marginLeft) + parseFloat(bodyStyles.marginRight) || 0 : 0;\n    const clippingStableScrollbarWidth = Math.abs(html.clientWidth - body.clientWidth - bodyMarginInline);\n    if (clippingStableScrollbarWidth <= SCROLLBAR_MAX) {\n      width -= clippingStableScrollbarWidth;\n    }\n  } else if (windowScrollbarX <= SCROLLBAR_MAX) {\n    // If the <body> scrollbar is on the left, the width needs to be extended\n    // by the scrollbar amount so there isn't extra space on the right.\n    width += windowScrollbarX;\n  }\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\n\nconst absoluteOrFixed = /*#__PURE__*/new Set(['absolute', 'fixed']);\n// Returns the inner client rect, subtracting scrollbars if present.\nfunction getInnerBoundingClientRect(element, strategy) {\n  const clientRect = getBoundingClientRect(element, true, strategy === 'fixed');\n  const top = clientRect.top + element.clientTop;\n  const left = clientRect.left + element.clientLeft;\n  const scale = isHTMLElement(element) ? getScale(element) : createCoords(1);\n  const width = element.clientWidth * scale.x;\n  const height = element.clientHeight * scale.y;\n  const x = left * scale.x;\n  const y = top * scale.y;\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\nfunction getClientRectFromClippingAncestor(element, clippingAncestor, strategy) {\n  let rect;\n  if (clippingAncestor === 'viewport') {\n    rect = getViewportRect(element, strategy);\n  } else if (clippingAncestor === 'document') {\n    rect = getDocumentRect(getDocumentElement(element));\n  } else if (isElement(clippingAncestor)) {\n    rect = getInnerBoundingClientRect(clippingAncestor, strategy);\n  } else {\n    const visualOffsets = getVisualOffsets(element);\n    rect = {\n      x: clippingAncestor.x - visualOffsets.x,\n      y: clippingAncestor.y - visualOffsets.y,\n      width: clippingAncestor.width,\n      height: clippingAncestor.height\n    };\n  }\n  return rectToClientRect(rect);\n}\nfunction hasFixedPositionAncestor(element, stopNode) {\n  const parentNode = getParentNode(element);\n  if (parentNode === stopNode || !isElement(parentNode) || isLastTraversableNode(parentNode)) {\n    return false;\n  }\n  return getComputedStyle$1(parentNode).position === 'fixed' || hasFixedPositionAncestor(parentNode, stopNode);\n}\n\n// A \"clipping ancestor\" is an `overflow` element with the characteristic of\n// clipping (or hiding) child elements. This returns all clipping ancestors\n// of the given element up the tree.\nfunction getClippingElementAncestors(element, cache) {\n  const cachedResult = cache.get(element);\n  if (cachedResult) {\n    return cachedResult;\n  }\n  let result = getOverflowAncestors(element, [], false).filter(el => isElement(el) && getNodeName(el) !== 'body');\n  let currentContainingBlockComputedStyle = null;\n  const elementIsFixed = getComputedStyle$1(element).position === 'fixed';\n  let currentNode = elementIsFixed ? getParentNode(element) : element;\n\n  // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n  while (isElement(currentNode) && !isLastTraversableNode(currentNode)) {\n    const computedStyle = getComputedStyle$1(currentNode);\n    const currentNodeIsContaining = isContainingBlock(currentNode);\n    if (!currentNodeIsContaining && computedStyle.position === 'fixed') {\n      currentContainingBlockComputedStyle = null;\n    }\n    const shouldDropCurrentNode = elementIsFixed ? !currentNodeIsContaining && !currentContainingBlockComputedStyle : !currentNodeIsContaining && computedStyle.position === 'static' && !!currentContainingBlockComputedStyle && absoluteOrFixed.has(currentContainingBlockComputedStyle.position) || isOverflowElement(currentNode) && !currentNodeIsContaining && hasFixedPositionAncestor(element, currentNode);\n    if (shouldDropCurrentNode) {\n      // Drop non-containing blocks.\n      result = result.filter(ancestor => ancestor !== currentNode);\n    } else {\n      // Record last containing block for next iteration.\n      currentContainingBlockComputedStyle = computedStyle;\n    }\n    currentNode = getParentNode(currentNode);\n  }\n  cache.set(element, result);\n  return result;\n}\n\n// Gets the maximum area that the element is visible in due to any number of\n// clipping ancestors.\nfunction getClippingRect(_ref) {\n  let {\n    element,\n    boundary,\n    rootBoundary,\n    strategy\n  } = _ref;\n  const elementClippingAncestors = boundary === 'clippingAncestors' ? isTopLayer(element) ? [] : getClippingElementAncestors(element, this._c) : [].concat(boundary);\n  const clippingAncestors = [...elementClippingAncestors, rootBoundary];\n  const firstClippingAncestor = clippingAncestors[0];\n  const clippingRect = clippingAncestors.reduce((accRect, clippingAncestor) => {\n    const rect = getClientRectFromClippingAncestor(element, clippingAncestor, strategy);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromClippingAncestor(element, firstClippingAncestor, strategy));\n  return {\n    width: clippingRect.right - clippingRect.left,\n    height: clippingRect.bottom - clippingRect.top,\n    x: clippingRect.left,\n    y: clippingRect.top\n  };\n}\n\nfunction getDimensions(element) {\n  const {\n    width,\n    height\n  } = getCssDimensions(element);\n  return {\n    width,\n    height\n  };\n}\n\nfunction getRectRelativeToOffsetParent(element, offsetParent, strategy) {\n  const isOffsetParentAnElement = isHTMLElement(offsetParent);\n  const documentElement = getDocumentElement(offsetParent);\n  const isFixed = strategy === 'fixed';\n  const rect = getBoundingClientRect(element, true, isFixed, offsetParent);\n  let scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  const offsets = createCoords(0);\n\n  // If the <body> scrollbar appears on the left (e.g. RTL systems). Use\n  // Firefox with layout.scrollbar.side = 3 in about:config to test this.\n  function setLeftRTLScrollbarOffset() {\n    offsets.x = getWindowScrollBarX(documentElement);\n  }\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || isOverflowElement(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n    if (isOffsetParentAnElement) {\n      const offsetRect = getBoundingClientRect(offsetParent, true, isFixed, offsetParent);\n      offsets.x = offsetRect.x + offsetParent.clientLeft;\n      offsets.y = offsetRect.y + offsetParent.clientTop;\n    } else if (documentElement) {\n      setLeftRTLScrollbarOffset();\n    }\n  }\n  if (isFixed && !isOffsetParentAnElement && documentElement) {\n    setLeftRTLScrollbarOffset();\n  }\n  const htmlOffset = documentElement && !isOffsetParentAnElement && !isFixed ? getHTMLOffset(documentElement, scroll) : createCoords(0);\n  const x = rect.left + scroll.scrollLeft - offsets.x - htmlOffset.x;\n  const y = rect.top + scroll.scrollTop - offsets.y - htmlOffset.y;\n  return {\n    x,\n    y,\n    width: rect.width,\n    height: rect.height\n  };\n}\n\nfunction isStaticPositioned(element) {\n  return getComputedStyle$1(element).position === 'static';\n}\n\nfunction getTrueOffsetParent(element, polyfill) {\n  if (!isHTMLElement(element) || getComputedStyle$1(element).position === 'fixed') {\n    return null;\n  }\n  if (polyfill) {\n    return polyfill(element);\n  }\n  let rawOffsetParent = element.offsetParent;\n\n  // Firefox returns the <html> element as the offsetParent if it's non-static,\n  // while Chrome and Safari return the <body> element. The <body> element must\n  // be used to perform the correct calculations even if the <html> element is\n  // non-static.\n  if (getDocumentElement(element) === rawOffsetParent) {\n    rawOffsetParent = rawOffsetParent.ownerDocument.body;\n  }\n  return rawOffsetParent;\n}\n\n// Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\nfunction getOffsetParent(element, polyfill) {\n  const win = getWindow(element);\n  if (isTopLayer(element)) {\n    return win;\n  }\n  if (!isHTMLElement(element)) {\n    let svgOffsetParent = getParentNode(element);\n    while (svgOffsetParent && !isLastTraversableNode(svgOffsetParent)) {\n      if (isElement(svgOffsetParent) && !isStaticPositioned(svgOffsetParent)) {\n        return svgOffsetParent;\n      }\n      svgOffsetParent = getParentNode(svgOffsetParent);\n    }\n    return win;\n  }\n  let offsetParent = getTrueOffsetParent(element, polyfill);\n  while (offsetParent && isTableElement(offsetParent) && isStaticPositioned(offsetParent)) {\n    offsetParent = getTrueOffsetParent(offsetParent, polyfill);\n  }\n  if (offsetParent && isLastTraversableNode(offsetParent) && isStaticPositioned(offsetParent) && !isContainingBlock(offsetParent)) {\n    return win;\n  }\n  return offsetParent || getContainingBlock(element) || win;\n}\n\nconst getElementRects = async function (data) {\n  const getOffsetParentFn = this.getOffsetParent || getOffsetParent;\n  const getDimensionsFn = this.getDimensions;\n  const floatingDimensions = await getDimensionsFn(data.floating);\n  return {\n    reference: getRectRelativeToOffsetParent(data.reference, await getOffsetParentFn(data.floating), data.strategy),\n    floating: {\n      x: 0,\n      y: 0,\n      width: floatingDimensions.width,\n      height: floatingDimensions.height\n    }\n  };\n};\n\nfunction isRTL(element) {\n  return getComputedStyle$1(element).direction === 'rtl';\n}\n\nconst platform = {\n  convertOffsetParentRelativeRectToViewportRelativeRect,\n  getDocumentElement,\n  getClippingRect,\n  getOffsetParent,\n  getElementRects,\n  getClientRects,\n  getDimensions,\n  getScale,\n  isElement,\n  isRTL\n};\n\nfunction rectsAreEqual(a, b) {\n  return a.x === b.x && a.y === b.y && a.width === b.width && a.height === b.height;\n}\n\n// https://samthor.au/2021/observing-dom/\nfunction observeMove(element, onMove) {\n  let io = null;\n  let timeoutId;\n  const root = getDocumentElement(element);\n  function cleanup() {\n    var _io;\n    clearTimeout(timeoutId);\n    (_io = io) == null || _io.disconnect();\n    io = null;\n  }\n  function refresh(skip, threshold) {\n    if (skip === void 0) {\n      skip = false;\n    }\n    if (threshold === void 0) {\n      threshold = 1;\n    }\n    cleanup();\n    const elementRectForRootMargin = element.getBoundingClientRect();\n    const {\n      left,\n      top,\n      width,\n      height\n    } = elementRectForRootMargin;\n    if (!skip) {\n      onMove();\n    }\n    if (!width || !height) {\n      return;\n    }\n    const insetTop = floor(top);\n    const insetRight = floor(root.clientWidth - (left + width));\n    const insetBottom = floor(root.clientHeight - (top + height));\n    const insetLeft = floor(left);\n    const rootMargin = -insetTop + \"px \" + -insetRight + \"px \" + -insetBottom + \"px \" + -insetLeft + \"px\";\n    const options = {\n      rootMargin,\n      threshold: max(0, min(1, threshold)) || 1\n    };\n    let isFirstUpdate = true;\n    function handleObserve(entries) {\n      const ratio = entries[0].intersectionRatio;\n      if (ratio !== threshold) {\n        if (!isFirstUpdate) {\n          return refresh();\n        }\n        if (!ratio) {\n          // If the reference is clipped, the ratio is 0. Throttle the refresh\n          // to prevent an infinite loop of updates.\n          timeoutId = setTimeout(() => {\n            refresh(false, 1e-7);\n          }, 1000);\n        } else {\n          refresh(false, ratio);\n        }\n      }\n      if (ratio === 1 && !rectsAreEqual(elementRectForRootMargin, element.getBoundingClientRect())) {\n        // It's possible that even though the ratio is reported as 1, the\n        // element is not actually fully within the IntersectionObserver's root\n        // area anymore. This can happen under performance constraints. This may\n        // be a bug in the browser's IntersectionObserver implementation. To\n        // work around this, we compare the element's bounding rect now with\n        // what it was at the time we created the IntersectionObserver. If they\n        // are not equal then the element moved, so we refresh.\n        refresh();\n      }\n      isFirstUpdate = false;\n    }\n\n    // Older browsers don't support a `document` as the root and will throw an\n    // error.\n    try {\n      io = new IntersectionObserver(handleObserve, {\n        ...options,\n        // Handle <iframe>s\n        root: root.ownerDocument\n      });\n    } catch (_e) {\n      io = new IntersectionObserver(handleObserve, options);\n    }\n    io.observe(element);\n  }\n  refresh(true);\n  return cleanup;\n}\n\n/**\n * Automatically updates the position of the floating element when necessary.\n * Should only be called when the floating element is mounted on the DOM or\n * visible on the screen.\n * @returns cleanup function that should be invoked when the floating element is\n * removed from the DOM or hidden from the screen.\n * @see https://floating-ui.com/docs/autoUpdate\n */\nfunction autoUpdate(reference, floating, update, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  const {\n    ancestorScroll = true,\n    ancestorResize = true,\n    elementResize = typeof ResizeObserver === 'function',\n    layoutShift = typeof IntersectionObserver === 'function',\n    animationFrame = false\n  } = options;\n  const referenceEl = unwrapElement(reference);\n  const ancestors = ancestorScroll || ancestorResize ? [...(referenceEl ? getOverflowAncestors(referenceEl) : []), ...getOverflowAncestors(floating)] : [];\n  ancestors.forEach(ancestor => {\n    ancestorScroll && ancestor.addEventListener('scroll', update, {\n      passive: true\n    });\n    ancestorResize && ancestor.addEventListener('resize', update);\n  });\n  const cleanupIo = referenceEl && layoutShift ? observeMove(referenceEl, update) : null;\n  let reobserveFrame = -1;\n  let resizeObserver = null;\n  if (elementResize) {\n    resizeObserver = new ResizeObserver(_ref => {\n      let [firstEntry] = _ref;\n      if (firstEntry && firstEntry.target === referenceEl && resizeObserver) {\n        // Prevent update loops when using the `size` middleware.\n        // https://github.com/floating-ui/floating-ui/issues/1740\n        resizeObserver.unobserve(floating);\n        cancelAnimationFrame(reobserveFrame);\n        reobserveFrame = requestAnimationFrame(() => {\n          var _resizeObserver;\n          (_resizeObserver = resizeObserver) == null || _resizeObserver.observe(floating);\n        });\n      }\n      update();\n    });\n    if (referenceEl && !animationFrame) {\n      resizeObserver.observe(referenceEl);\n    }\n    resizeObserver.observe(floating);\n  }\n  let frameId;\n  let prevRefRect = animationFrame ? getBoundingClientRect(reference) : null;\n  if (animationFrame) {\n    frameLoop();\n  }\n  function frameLoop() {\n    const nextRefRect = getBoundingClientRect(reference);\n    if (prevRefRect && !rectsAreEqual(prevRefRect, nextRefRect)) {\n      update();\n    }\n    prevRefRect = nextRefRect;\n    frameId = requestAnimationFrame(frameLoop);\n  }\n  update();\n  return () => {\n    var _resizeObserver2;\n    ancestors.forEach(ancestor => {\n      ancestorScroll && ancestor.removeEventListener('scroll', update);\n      ancestorResize && ancestor.removeEventListener('resize', update);\n    });\n    cleanupIo == null || cleanupIo();\n    (_resizeObserver2 = resizeObserver) == null || _resizeObserver2.disconnect();\n    resizeObserver = null;\n    if (animationFrame) {\n      cancelAnimationFrame(frameId);\n    }\n  };\n}\n\n/**\n * Resolves with an object of overflow side offsets that determine how much the\n * element is overflowing a given clipping boundary on each side.\n * - positive = overflowing the boundary by that number of pixels\n * - negative = how many pixels left before it will overflow\n * - 0 = lies flush with the boundary\n * @see https://floating-ui.com/docs/detectOverflow\n */\nconst detectOverflow = detectOverflow$1;\n\n/**\n * Modifies the placement by translating the floating element along the\n * specified axes.\n * A number (shorthand for `mainAxis` or distance), or an axes configuration\n * object may be passed.\n * @see https://floating-ui.com/docs/offset\n */\nconst offset = offset$1;\n\n/**\n * Optimizes the visibility of the floating element by choosing the placement\n * that has the most space available automatically, without needing to specify a\n * preferred placement. Alternative to `flip`.\n * @see https://floating-ui.com/docs/autoPlacement\n */\nconst autoPlacement = autoPlacement$1;\n\n/**\n * Optimizes the visibility of the floating element by shifting it in order to\n * keep it in view when it will overflow the clipping boundary.\n * @see https://floating-ui.com/docs/shift\n */\nconst shift = shift$1;\n\n/**\n * Optimizes the visibility of the floating element by flipping the `placement`\n * in order to keep it in view when the preferred placement(s) will overflow the\n * clipping boundary. Alternative to `autoPlacement`.\n * @see https://floating-ui.com/docs/flip\n */\nconst flip = flip$1;\n\n/**\n * Provides data that allows you to change the size of the floating element \n * for instance, prevent it from overflowing the clipping boundary or match the\n * width of the reference element.\n * @see https://floating-ui.com/docs/size\n */\nconst size = size$1;\n\n/**\n * Provides data to hide the floating element in applicable situations, such as\n * when it is not in the same clipping context as the reference element.\n * @see https://floating-ui.com/docs/hide\n */\nconst hide = hide$1;\n\n/**\n * Provides data to position an inner element of the floating element so that it\n * appears centered to the reference element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow = arrow$1;\n\n/**\n * Provides improved positioning for inline reference elements that can span\n * over multiple lines, such as hyperlinks or range selections.\n * @see https://floating-ui.com/docs/inline\n */\nconst inline = inline$1;\n\n/**\n * Built-in `limiter` that will stop `shift()` at a certain point.\n */\nconst limitShift = limitShift$1;\n\n/**\n * Computes the `x` and `y` coordinates that will place the floating element\n * next to a given reference element.\n */\nconst computePosition = (reference, floating, options) => {\n  // This caches the expensive `getClippingElementAncestors` function so that\n  // multiple lifecycle resets re-use the same result. It only lives for a\n  // single call. If other functions become expensive, we can add them as well.\n  const cache = new Map();\n  const mergedOptions = {\n    platform,\n    ...options\n  };\n  const platformWithCache = {\n    ...mergedOptions.platform,\n    _c: cache\n  };\n  return computePosition$1(reference, floating, {\n    ...mergedOptions,\n    platform: platformWithCache\n  });\n};\n\nexport { arrow, autoPlacement, autoUpdate, computePosition, detectOverflow, flip, hide, inline, limitShift, offset, platform, shift, size };\n", "import { computePosition, arrow as arrow$2, autoPlacement as autoPlacement$1, flip as flip$1, hide as hide$1, inline as inline$1, limitShift as limitShift$1, offset as offset$1, shift as shift$1, size as size$1 } from '@floating-ui/dom';\nexport { autoUpdate, computePosition, detectOverflow, getOverflowAncestors, platform } from '@floating-ui/dom';\nimport * as React from 'react';\nimport { useLayoutEffect } from 'react';\nimport * as ReactDOM from 'react-dom';\n\nvar isClient = typeof document !== 'undefined';\n\nvar noop = function noop() {};\nvar index = isClient ? useLayoutEffect : noop;\n\n// Fork of `fast-deep-equal` that only does the comparisons we need and compares\n// functions\nfunction deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n  if (typeof a !== typeof b) {\n    return false;\n  }\n  if (typeof a === 'function' && a.toString() === b.toString()) {\n    return true;\n  }\n  let length;\n  let i;\n  let keys;\n  if (a && b && typeof a === 'object') {\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length !== b.length) return false;\n      for (i = length; i-- !== 0;) {\n        if (!deepEqual(a[i], b[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) {\n      return false;\n    }\n    for (i = length; i-- !== 0;) {\n      if (!{}.hasOwnProperty.call(b, keys[i])) {\n        return false;\n      }\n    }\n    for (i = length; i-- !== 0;) {\n      const key = keys[i];\n      if (key === '_owner' && a.$$typeof) {\n        continue;\n      }\n      if (!deepEqual(a[key], b[key])) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return a !== a && b !== b;\n}\n\nfunction getDPR(element) {\n  if (typeof window === 'undefined') {\n    return 1;\n  }\n  const win = element.ownerDocument.defaultView || window;\n  return win.devicePixelRatio || 1;\n}\n\nfunction roundByDPR(element, value) {\n  const dpr = getDPR(element);\n  return Math.round(value * dpr) / dpr;\n}\n\nfunction useLatestRef(value) {\n  const ref = React.useRef(value);\n  index(() => {\n    ref.current = value;\n  });\n  return ref;\n}\n\n/**\n * Provides data to position a floating element.\n * @see https://floating-ui.com/docs/useFloating\n */\nfunction useFloating(options) {\n  if (options === void 0) {\n    options = {};\n  }\n  const {\n    placement = 'bottom',\n    strategy = 'absolute',\n    middleware = [],\n    platform,\n    elements: {\n      reference: externalReference,\n      floating: externalFloating\n    } = {},\n    transform = true,\n    whileElementsMounted,\n    open\n  } = options;\n  const [data, setData] = React.useState({\n    x: 0,\n    y: 0,\n    strategy,\n    placement,\n    middlewareData: {},\n    isPositioned: false\n  });\n  const [latestMiddleware, setLatestMiddleware] = React.useState(middleware);\n  if (!deepEqual(latestMiddleware, middleware)) {\n    setLatestMiddleware(middleware);\n  }\n  const [_reference, _setReference] = React.useState(null);\n  const [_floating, _setFloating] = React.useState(null);\n  const setReference = React.useCallback(node => {\n    if (node !== referenceRef.current) {\n      referenceRef.current = node;\n      _setReference(node);\n    }\n  }, []);\n  const setFloating = React.useCallback(node => {\n    if (node !== floatingRef.current) {\n      floatingRef.current = node;\n      _setFloating(node);\n    }\n  }, []);\n  const referenceEl = externalReference || _reference;\n  const floatingEl = externalFloating || _floating;\n  const referenceRef = React.useRef(null);\n  const floatingRef = React.useRef(null);\n  const dataRef = React.useRef(data);\n  const hasWhileElementsMounted = whileElementsMounted != null;\n  const whileElementsMountedRef = useLatestRef(whileElementsMounted);\n  const platformRef = useLatestRef(platform);\n  const openRef = useLatestRef(open);\n  const update = React.useCallback(() => {\n    if (!referenceRef.current || !floatingRef.current) {\n      return;\n    }\n    const config = {\n      placement,\n      strategy,\n      middleware: latestMiddleware\n    };\n    if (platformRef.current) {\n      config.platform = platformRef.current;\n    }\n    computePosition(referenceRef.current, floatingRef.current, config).then(data => {\n      const fullData = {\n        ...data,\n        // The floating element's position may be recomputed while it's closed\n        // but still mounted (such as when transitioning out). To ensure\n        // `isPositioned` will be `false` initially on the next open, avoid\n        // setting it to `true` when `open === false` (must be specified).\n        isPositioned: openRef.current !== false\n      };\n      if (isMountedRef.current && !deepEqual(dataRef.current, fullData)) {\n        dataRef.current = fullData;\n        ReactDOM.flushSync(() => {\n          setData(fullData);\n        });\n      }\n    });\n  }, [latestMiddleware, placement, strategy, platformRef, openRef]);\n  index(() => {\n    if (open === false && dataRef.current.isPositioned) {\n      dataRef.current.isPositioned = false;\n      setData(data => ({\n        ...data,\n        isPositioned: false\n      }));\n    }\n  }, [open]);\n  const isMountedRef = React.useRef(false);\n  index(() => {\n    isMountedRef.current = true;\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, []);\n  index(() => {\n    if (referenceEl) referenceRef.current = referenceEl;\n    if (floatingEl) floatingRef.current = floatingEl;\n    if (referenceEl && floatingEl) {\n      if (whileElementsMountedRef.current) {\n        return whileElementsMountedRef.current(referenceEl, floatingEl, update);\n      }\n      update();\n    }\n  }, [referenceEl, floatingEl, update, whileElementsMountedRef, hasWhileElementsMounted]);\n  const refs = React.useMemo(() => ({\n    reference: referenceRef,\n    floating: floatingRef,\n    setReference,\n    setFloating\n  }), [setReference, setFloating]);\n  const elements = React.useMemo(() => ({\n    reference: referenceEl,\n    floating: floatingEl\n  }), [referenceEl, floatingEl]);\n  const floatingStyles = React.useMemo(() => {\n    const initialStyles = {\n      position: strategy,\n      left: 0,\n      top: 0\n    };\n    if (!elements.floating) {\n      return initialStyles;\n    }\n    const x = roundByDPR(elements.floating, data.x);\n    const y = roundByDPR(elements.floating, data.y);\n    if (transform) {\n      return {\n        ...initialStyles,\n        transform: \"translate(\" + x + \"px, \" + y + \"px)\",\n        ...(getDPR(elements.floating) >= 1.5 && {\n          willChange: 'transform'\n        })\n      };\n    }\n    return {\n      position: strategy,\n      left: x,\n      top: y\n    };\n  }, [strategy, transform, elements.floating, data.x, data.y]);\n  return React.useMemo(() => ({\n    ...data,\n    update,\n    refs,\n    elements,\n    floatingStyles\n  }), [data, update, refs, elements, floatingStyles]);\n}\n\n/**\n * Provides data to position an inner element of the floating element so that it\n * appears centered to the reference element.\n * This wraps the core `arrow` middleware to allow React refs as the element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow$1 = options => {\n  function isRef(value) {\n    return {}.hasOwnProperty.call(value, 'current');\n  }\n  return {\n    name: 'arrow',\n    options,\n    fn(state) {\n      const {\n        element,\n        padding\n      } = typeof options === 'function' ? options(state) : options;\n      if (element && isRef(element)) {\n        if (element.current != null) {\n          return arrow$2({\n            element: element.current,\n            padding\n          }).fn(state);\n        }\n        return {};\n      }\n      if (element) {\n        return arrow$2({\n          element,\n          padding\n        }).fn(state);\n      }\n      return {};\n    }\n  };\n};\n\n/**\n * Modifies the placement by translating the floating element along the\n * specified axes.\n * A number (shorthand for `mainAxis` or distance), or an axes configuration\n * object may be passed.\n * @see https://floating-ui.com/docs/offset\n */\nconst offset = (options, deps) => ({\n  ...offset$1(options),\n  options: [options, deps]\n});\n\n/**\n * Optimizes the visibility of the floating element by shifting it in order to\n * keep it in view when it will overflow the clipping boundary.\n * @see https://floating-ui.com/docs/shift\n */\nconst shift = (options, deps) => ({\n  ...shift$1(options),\n  options: [options, deps]\n});\n\n/**\n * Built-in `limiter` that will stop `shift()` at a certain point.\n */\nconst limitShift = (options, deps) => ({\n  ...limitShift$1(options),\n  options: [options, deps]\n});\n\n/**\n * Optimizes the visibility of the floating element by flipping the `placement`\n * in order to keep it in view when the preferred placement(s) will overflow the\n * clipping boundary. Alternative to `autoPlacement`.\n * @see https://floating-ui.com/docs/flip\n */\nconst flip = (options, deps) => ({\n  ...flip$1(options),\n  options: [options, deps]\n});\n\n/**\n * Provides data that allows you to change the size of the floating element \n * for instance, prevent it from overflowing the clipping boundary or match the\n * width of the reference element.\n * @see https://floating-ui.com/docs/size\n */\nconst size = (options, deps) => ({\n  ...size$1(options),\n  options: [options, deps]\n});\n\n/**\n * Optimizes the visibility of the floating element by choosing the placement\n * that has the most space available automatically, without needing to specify a\n * preferred placement. Alternative to `flip`.\n * @see https://floating-ui.com/docs/autoPlacement\n */\nconst autoPlacement = (options, deps) => ({\n  ...autoPlacement$1(options),\n  options: [options, deps]\n});\n\n/**\n * Provides data to hide the floating element in applicable situations, such as\n * when it is not in the same clipping context as the reference element.\n * @see https://floating-ui.com/docs/hide\n */\nconst hide = (options, deps) => ({\n  ...hide$1(options),\n  options: [options, deps]\n});\n\n/**\n * Provides improved positioning for inline reference elements that can span\n * over multiple lines, such as hyperlinks or range selections.\n * @see https://floating-ui.com/docs/inline\n */\nconst inline = (options, deps) => ({\n  ...inline$1(options),\n  options: [options, deps]\n});\n\n/**\n * Provides data to position an inner element of the floating element so that it\n * appears centered to the reference element.\n * This wraps the core `arrow` middleware to allow React refs as the element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow = (options, deps) => ({\n  ...arrow$1(options),\n  options: [options, deps]\n});\n\nexport { arrow, autoPlacement, flip, hide, inline, limitShift, offset, shift, size, useFloating };\n", "/* eslint-disable no-restricted-syntax */\n\nimport { useEffect, useLayoutEffect as useOriginalLayoutEffect } from \"react\";\n\n// On React 18.2.0 and earlier, useLayoutEffect triggers a warning when\n// executed on the server, so this workaround should be used instead.\nexport const useLayoutEffect =\n  typeof window !== \"undefined\" ? useOriginalLayoutEffect : useEffect;\n", "import {\n  type AsyncResult,\n  type GroupData,\n  kInternal,\n  shallow,\n} from \"@liveblocks/core\";\nimport { useCallback, useEffect } from \"react\";\n\nimport { useClient } from \"./contexts\";\nimport type { GroupAsyncResult } from \"./types\";\nimport { useSyncExternalStoreWithSelector } from \"./use-sync-external-store-with-selector\";\n\nfunction selectorFor_useGroup(\n  state: AsyncResult<GroupData | undefined> | undefined\n): GroupAsyncResult {\n  if (state === undefined || state?.isLoading) {\n    return state ?? { isLoading: true };\n  }\n\n  if (state.error) {\n    return state;\n  }\n\n  return {\n    isLoading: false,\n    group: state.data,\n  };\n}\n\n/** @private - Internal API, do not rely on it. */\nexport function useGroup(groupId: string): GroupAsyncResult {\n  const client = useClient();\n  const store = client[kInternal].httpClient.groupsStore;\n\n  const getGroupState = useCallback(\n    () => store.getItemState(groupId),\n    [store, groupId]\n  );\n\n  useEffect(() => {\n    void store.enqueue(groupId);\n  }, [store, groupId]);\n\n  return useSyncExternalStoreWithSelector(\n    store.subscribe,\n    getGroupState,\n    getGroupState,\n    selectorFor_useGroup,\n    shallow\n  );\n}\n", "import { type MentionData, stableStringify } from \"@liveblocks/core\";\nimport { useEffect, useRef, useState } from \"react\";\n\nimport {\n  useMentionSuggestionsCache,\n  useResolveMentionSuggestions,\n} from \"./room\";\n\nconst MENTION_SUGGESTIONS_DEBOUNCE = 500;\n\n/**\n * Normalize mention suggestions as `MentionData[]`.\n *\n * Mention suggestions were previously typed as `string[]`, a list of user IDs,\n * but to support multiple mention kinds (user, group, etc), they're now\n * typed as `MentionData[]`.\n */\nfunction normalizeMentionSuggestions<T extends string[] | MentionData[]>(\n  suggestions: T\n): MentionData[] {\n  return suggestions.map(\n    (suggestion): MentionData =>\n      typeof suggestion === \"string\"\n        ? { kind: \"user\" as const, id: suggestion }\n        : suggestion\n  );\n}\n\n/**\n * @private For internal use only. Do not rely on this hook.\n *\n * Simplistic debounced search, we don't need to worry too much about deduping\n * and race conditions as there can only be one search at a time.\n */\nexport function useMentionSuggestions(roomId: string, search?: string) {\n  const [mentionSuggestions, setMentionSuggestions] = useState<MentionData[]>();\n  const lastInvokedAt = useRef<number>();\n\n  const resolveMentionSuggestions = useResolveMentionSuggestions();\n  const mentionSuggestionsCache = useMentionSuggestionsCache();\n\n  useEffect(() => {\n    if (search === undefined || !resolveMentionSuggestions) {\n      return;\n    }\n\n    const resolveMentionSuggestionsArgs = { text: search, roomId };\n    const mentionSuggestionsCacheKey = stableStringify(\n      resolveMentionSuggestionsArgs\n    );\n    let debounceTimeout: number | undefined;\n    let isCanceled = false;\n\n    const getMentionSuggestions = async () => {\n      try {\n        lastInvokedAt.current = performance.now();\n        const rawMentionSuggestions = await resolveMentionSuggestions(\n          resolveMentionSuggestionsArgs\n        );\n\n        if (!isCanceled) {\n          const normalizedSuggestions = normalizeMentionSuggestions(\n            rawMentionSuggestions\n          );\n          setMentionSuggestions(normalizedSuggestions);\n          mentionSuggestionsCache.set(\n            mentionSuggestionsCacheKey,\n            normalizedSuggestions\n          );\n        }\n      } catch (error) {\n        console.error((error as Error)?.message);\n      }\n    };\n\n    if (mentionSuggestionsCache.has(mentionSuggestionsCacheKey)) {\n      // If there are already cached mention suggestions, use them immediately.\n      const cachedSuggestions = mentionSuggestionsCache.get(\n        mentionSuggestionsCacheKey\n      );\n      setMentionSuggestions(cachedSuggestions);\n    } else if (\n      !lastInvokedAt.current ||\n      Math.abs(performance.now() - lastInvokedAt.current) >\n        MENTION_SUGGESTIONS_DEBOUNCE\n    ) {\n      // If on the debounce's leading edge (either because it's the first invokation or enough\n      // time has passed since the last debounce), get mention suggestions immediately.\n      void getMentionSuggestions();\n    } else {\n      // Otherwise, wait for the debounce delay.\n      debounceTimeout = window.setTimeout(() => {\n        void getMentionSuggestions();\n      }, MENTION_SUGGESTIONS_DEBOUNCE);\n    }\n\n    return () => {\n      isCanceled = true;\n      window.clearTimeout(debounceTimeout);\n    };\n  }, [search, roomId, resolveMentionSuggestions, mentionSuggestionsCache]);\n\n  return mentionSuggestions;\n}\n", "import type { SyncSource } from \"@liveblocks/core\";\nimport { kInternal } from \"@liveblocks/core\";\nimport { useEffect, useState } from \"react\";\n\nimport { useClient } from \"./contexts\";\n\n/**\n * @private For internal use only. Do not rely on this hook.\n */\nexport function useSyncSource(): SyncSource | undefined {\n  const client = useClient();\n  const createSyncSource = client[kInternal].createSyncSource;\n  const [syncSource, setSyncSource] = useState<SyncSource | undefined>();\n\n  useEffect(() => {\n    // Create new sync source on mount\n    const newSyncSource = createSyncSource();\n    setSyncSource(newSyncSource);\n    return () => newSyncSource.destroy();\n  }, [createSyncSource]);\n\n  return syncSource;\n}\n", "/**\n * Construct class names strings.\n */\nexport function cn(...args: (string | number | boolean | undefined | null)[]) {\n  return args\n    .filter((arg) => typeof arg === \"string\" || typeof arg === \"number\")\n    .join(\" \");\n}\n", "export function getInitials(name: string) {\n  return name\n    .trim()\n    .split(\" \")\n    .reduce((initials, name, index, array) => {\n      if (index === 0 || index === array.length - 1) {\n        initials += name.charAt(0).toLocaleUpperCase();\n      }\n\n      return initials;\n    }, \"\");\n}\n", "/* eslint-disable simple-import-sort/exports */\nimport { detectDupes } from \"@liveblocks/core\";\n\nimport { PKG_FORMAT, PKG_NAME, PKG_VERSION } from \"./version\";\ndetectDupes(PKG_NAME, PKG_VERSION, PKG_FORMAT);\n\nexport { ClientSideSuspense } from \"./ClientSideSuspense\";\nexport type {\n  MutationContext,\n  UseSendAiMessageOptions,\n  UseThreadsOptions,\n  SendAiMessageOptions,\n} from \"./types\";\n\n// Re-exports from @liveblocks/client, for convenience\nexport type { Json, JsonObject } from \"@liveblocks/client\";\nexport { shallow, isNotificationChannelEnabled } from \"@liveblocks/client\";\n\n// Export all the top-level hooks\nexport { ClientContext, RoomContext, useClient } from \"./contexts\";\nexport { RegisterAiKnowledge, RegisterAiTool } from \"./ai\";\nexport type { RegisterAiKnowledgeProps, RegisterAiToolProps } from \"./types/ai\";\nexport {\n  LiveblocksProvider,\n  useInboxNotificationThread,\n  useMarkAllInboxNotificationsAsRead,\n  useMarkInboxNotificationAsRead,\n  useDeleteAllInboxNotifications,\n  useDeleteInboxNotification,\n  useUpdateNotificationSettings,\n  useCreateAiChat,\n  useDeleteAiChat,\n  useSendAiMessage,\n  useSyncStatus,\n  useErrorListener,\n} from \"./liveblocks\";\nexport {\n  RoomProvider,\n  useAddReaction,\n  useBroadcastEvent,\n  useCanRedo,\n  useCanUndo,\n  useCreateComment,\n  useCreateThread,\n  useDeleteComment,\n  useDeleteThread,\n  useEditComment,\n  useEditThreadMetadata,\n  useMarkThreadAsResolved,\n  useMarkThreadAsUnresolved,\n  useSubscribeToThread,\n  useUnsubscribeFromThread,\n  useEventListener,\n  useHistory,\n  useIsInsideRoom,\n  useLostConnectionListener,\n  useMarkThreadAsRead,\n  useMutation,\n  useMyPresence,\n  useOthersListener,\n  useRedo,\n  useRemoveReaction,\n  useRoom,\n  useStatus,\n  useStorageRoot,\n  useThreadSubscription,\n  useUndo,\n  useUpdateMyPresence,\n  useUpdateRoomSubscriptionSettings,\n} from \"./room\";\n\n// Export the Suspense versions of our hooks\n// (This part differs from src/index.ts)\nexport {\n  useOtherSuspense as useOther,\n  useOthersSuspense as useOthers,\n  useOthersConnectionIdsSuspense as useOthersConnectionIds,\n  useOthersMappedSuspense as useOthersMapped,\n  useSelfSuspense as useSelf,\n  useStorageSuspense as useStorage,\n  useThreadsSuspense as useThreads,\n  useAttachmentUrlSuspense as useAttachmentUrl,\n  useHistoryVersionsSuspense as useHistoryVersions,\n  useRoomSubscriptionSettingsSuspense as useRoomSubscriptionSettings,\n} from \"./room\";\nexport {\n  useInboxNotificationsSuspense as useInboxNotifications,\n  useNotificationSettingsSuspense as useNotificationSettings,\n  useRoomInfoSuspense as useRoomInfo,\n  useGroupInfoSuspense as useGroupInfo,\n  useUnreadInboxNotificationsCountSuspense as useUnreadInboxNotificationsCount,\n  useUserSuspense as useUser,\n  useUserThreadsSuspense_experimental as useUserThreads_experimental,\n  useAiChatsSuspense as useAiChats,\n  useAiChatMessagesSuspense as useAiChatMessages,\n  useAiChatSuspense as useAiChat,\n} from \"./liveblocks\";\n", "import { useState } from \"react\";\n\n/**\n * \"Freezes\" a given value, so that it will return the same value/instance on\n * each subsequent render. This can be used to freeze \"initial\" values for\n * custom hooks, much like how `useState(initialState)` or\n * `useRef(initialValue)` works.\n */\nexport function useInitial<T>(value: T | (() => T)): T {\n  const [initialValue] = useState(value);\n\n  return initialValue;\n}\n", "import {\n  assertNever,\n  type AsyncResult,\n  type AsyncSuccess,\n  type BaseGroupInfo,\n  type BaseUserMeta,\n} from \"@liveblocks/core\";\nimport { useGroupInfo, useUser } from \"@liveblocks/react\";\nimport {\n  useGroupInfo as useGroupInfoSuspense,\n  useUser as useUserSuspense,\n} from \"@liveblocks/react/suspense\";\n\nimport { useInitial } from \"./use-initial\";\n\ntype UserOrGroupInfoResult = AsyncResult<\n  BaseUserMeta[\"info\"] | BaseGroupInfo,\n  \"info\"\n>;\n\ntype UserOrGroupInfoSuccess = AsyncSuccess<\n  BaseUserMeta[\"info\"] | BaseGroupInfo,\n  \"info\"\n>;\n\nexport function useUserOrGroupInfo(\n  kind: \"user\" | \"group\",\n  id: string\n): UserOrGroupInfoResult {\n  // Switching between user IDs and group IDs is not supported\n  // to support the Rules of Hooks.\n  const frozenKind = useInitial(kind);\n\n  if (frozenKind === \"user\") {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const { user, isLoading, error } = useUser(id);\n\n    return {\n      info: user,\n      isLoading,\n      error,\n    } as UserOrGroupInfoResult;\n  } else if (frozenKind === \"group\") {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const { info, isLoading, error } = useGroupInfo(id);\n\n    return {\n      info,\n      isLoading,\n      error,\n    } as UserOrGroupInfoResult;\n  }\n\n  return assertNever(frozenKind, \"Invalid kind\");\n}\n\nexport function useUserOrGroupInfoSuspense(\n  kind: \"user\" | \"group\",\n  id: string\n): UserOrGroupInfoSuccess {\n  // Switching between user IDs and group IDs is not supported\n  // to support the Rules of Hooks.\n  const frozenKind = useInitial(kind);\n\n  if (frozenKind === \"user\") {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const { user, isLoading, error } = useUserSuspense(id);\n\n    return {\n      info: user,\n      isLoading,\n      error,\n    };\n  } else if (frozenKind === \"group\") {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const { info, isLoading, error } = useGroupInfoSuspense(id);\n\n    return {\n      info,\n      isLoading,\n      error,\n    };\n  }\n\n  return assertNever(frozenKind, \"Invalid kind\");\n}\n", "\"use client\";\n\nimport type { Relax } from \"@liveblocks/core\";\nimport type { ComponentProps, ReactNode } from \"react\";\nimport { useMemo } from \"react\";\n\nimport { cn } from \"../../utils/cn\";\nimport { getInitials } from \"../../utils/get-initials\";\nimport { useUserOrGroupInfo } from \"../../utils/use-user-or-group-info\";\n\ninterface AvatarLayoutProps extends ComponentProps<\"div\"> {\n  src?: string;\n  name?: string;\n  fallback?: string;\n  isLoading: boolean;\n}\n\nexport type AvatarProps = ComponentProps<\"div\"> & {\n  icon?: ReactNode;\n} & Relax<\n    | {\n        /**\n         * The user ID to display the avatar for.\n         */\n        userId: string;\n      }\n    | {\n        /**\n         * The group ID to display the avatar for.\n         */\n        groupId: string;\n      }\n  >;\n\nfunction AvatarLayout({\n  src,\n  name,\n  fallback,\n  isLoading,\n  className,\n  ...props\n}: AvatarLayoutProps) {\n  const nameInitials = useMemo(\n    () => (name ? getInitials(name) : undefined),\n    [name]\n  );\n  const fallbackInitials = useMemo(\n    () => (!isLoading && fallback && !name ? getInitials(fallback) : undefined),\n    [isLoading, fallback, name]\n  );\n\n  return (\n    <div\n      className={cn(\"lb-avatar\", className)}\n      data-loading={isLoading ? \"\" : undefined}\n      {...props}\n    >\n      {src && <img className=\"lb-avatar-image\" src={src} alt={name} />}\n      {nameInitials ? (\n        <span className=\"lb-avatar-fallback\" aria-hidden>\n          {nameInitials}\n        </span>\n      ) : fallbackInitials ? (\n        <span\n          className=\"lb-avatar-fallback\"\n          aria-label={fallback}\n          title={fallback}\n        >\n          {fallbackInitials}\n        </span>\n      ) : null}\n    </div>\n  );\n}\n\nexport function Avatar({ userId, groupId, icon, ...props }: AvatarProps) {\n  const { info, isLoading } = useUserOrGroupInfo(\n    userId ? \"user\" : \"group\",\n    userId ?? groupId\n  );\n\n  return icon && (isLoading || !info?.avatar) ? (\n    <div {...props}>{icon}</div>\n  ) : (\n    <AvatarLayout\n      src={info?.avatar}\n      name={info?.name}\n      fallback={userId ?? groupId}\n      isLoading={isLoading}\n      {...props}\n    />\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { cn } from \"../../utils/cn\";\n\nexport const ICON_WIDTH = 20;\nexport const ICON_HEIGHT = 20;\n\nexport function Icon({ children, className, ...props }: ComponentProps<\"svg\">) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={ICON_WIDTH}\n      height={ICON_HEIGHT}\n      viewBox={`0 0 ${ICON_WIDTH} ${ICON_HEIGHT}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth={1.5}\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      role=\"presentation\"\n      className={cn(\"lb-icon\", className)}\n      {...props}\n    >\n      {children}\n    </svg>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function ChevronDownIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M14.5 8.5 10 13 5.5 8.5\" />\n    </Icon>\n  );\n}\n", "\"use client\";\n\nimport type { ComponentProps, ReactNode } from \"react\";\nimport { forwardRef } from \"react\";\n\nimport { ChevronDownIcon } from \"../../icons/ChevronDown\";\nimport { cn } from \"../../utils/cn\";\n\nexport interface ButtonProps extends ComponentProps<\"button\"> {\n  variant?:\n    | \"default\"\n    | \"toolbar\"\n    | \"outline\"\n    | \"ghost\"\n    | \"primary\"\n    | \"secondary\"\n    | \"destructive\";\n  size?: \"default\" | \"large\";\n  disableable?: boolean;\n  icon?: ReactNode;\n}\n\nexport const CustomButton = forwardRef<\n  HTMLButtonElement,\n  Omit<ButtonProps, \"icon\">\n>(\n  (\n    {\n      variant = \"default\",\n      size = \"default\",\n      disableable = true,\n      className,\n      children,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    return (\n      <button\n        type=\"button\"\n        className={cn(\n          \"lb-button\",\n          !disableable && \"lb-button:non-disableable\",\n          className\n        )}\n        data-variant={variant}\n        data-size={size}\n        {...props}\n        ref={forwardedRef}\n      >\n        {children}\n      </button>\n    );\n  }\n);\n\nexport const Button = forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ icon, children, ...props }, forwardedRef) => {\n    return (\n      <CustomButton {...props} ref={forwardedRef}>\n        {icon ? <span className=\"lb-icon-container\">{icon}</span> : null}\n        {children ? <span className=\"lb-button-label\">{children}</span> : null}\n      </CustomButton>\n    );\n  }\n);\n\nexport const SelectButton = forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ icon, children, className, ...props }, forwardedRef) => {\n    return (\n      <CustomButton\n        {...props}\n        type=\"button\"\n        className={cn(\"lb-select-button\", className)}\n        ref={forwardedRef}\n      >\n        {icon ? <span className=\"lb-icon-container\">{icon}</span> : null}\n        {children ? <span className=\"lb-button-label\">{children}</span> : null}\n        <span className=\"lb-select-button-chevron\">\n          <ChevronDownIcon />\n        </span>\n      </CustomButton>\n    );\n  }\n);\n", "\"use client\";\n\nimport { useGroupInfo } from \"@liveblocks/react\";\nimport type { ComponentProps } from \"react\";\n\nimport { cn } from \"../../utils/cn\";\n\nexport interface GroupProps extends ComponentProps<\"span\"> {\n  /**\n   * The group ID to display the group name for.\n   */\n  groupId: string;\n}\n\nexport function Group({ groupId, className, children, ...props }: GroupProps) {\n  const { info, isLoading } = useGroupInfo(groupId);\n\n  return (\n    <span\n      className={cn(\"lb-name lb-group\", className)}\n      data-loading={isLoading ? \"\" : undefined}\n      {...props}\n    >\n      {isLoading ? null : (info?.name ?? groupId)}\n      {children}\n    </span>\n  );\n}\n", "\"use client\";\n\nimport { useGroupInfo } from \"@liveblocks/react\";\nimport type { ComponentPropsWithoutRef } from \"react\";\n\nimport { cn } from \"../../utils/cn\";\n\ninterface GroupDescriptionProps extends ComponentPropsWithoutRef<\"span\"> {\n  /**\n   * The group ID to display the group description for.\n   */\n  groupId: string;\n}\n\nexport function GroupDescription({\n  groupId,\n  className,\n  ...props\n}: GroupDescriptionProps) {\n  const { info } = useGroupInfo(groupId);\n\n  return info?.description ? (\n    <span className={cn(\"lb-group-description\", className)} {...props}>\n      {info.description}\n    </span>\n  ) : null;\n}\n", "import * as React from 'react';\nimport { composeRefs } from '@radix-ui/react-compose-refs';\n\n/* -------------------------------------------------------------------------------------------------\n * Slot\n * -----------------------------------------------------------------------------------------------*/\n\ninterface SlotProps extends React.HTMLAttributes<HTMLElement> {\n  children?: React.ReactNode;\n}\n\n/* @__NO_SIDE_EFFECTS__ */ export function createSlot(ownerName: string) {\n  const SlotClone = createSlotClone(ownerName);\n  const Slot = React.forwardRef<HTMLElement, SlotProps>((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n    const childrenArray = React.Children.toArray(children);\n    const slottable = childrenArray.find(isSlottable);\n\n    if (slottable) {\n      // the new element to render is the one passed as a child of `Slottable`\n      const newElement = slottable.props.children;\n\n      const newChildren = childrenArray.map((child) => {\n        if (child === slottable) {\n          // because the new element will be the one rendered, we are only interested\n          // in grabbing its children (`newElement.props.children`)\n          if (React.Children.count(newElement) > 1) return React.Children.only(null);\n          return React.isValidElement(newElement)\n            ? (newElement.props as { children: React.ReactNode }).children\n            : null;\n        } else {\n          return child;\n        }\n      });\n\n      return (\n        <SlotClone {...slotProps} ref={forwardedRef}>\n          {React.isValidElement(newElement)\n            ? React.cloneElement(newElement, undefined, newChildren)\n            : null}\n        </SlotClone>\n      );\n    }\n\n    return (\n      <SlotClone {...slotProps} ref={forwardedRef}>\n        {children}\n      </SlotClone>\n    );\n  });\n\n  Slot.displayName = `${ownerName}.Slot`;\n  return Slot;\n}\n\nconst Slot = createSlot('Slot');\n\n/* -------------------------------------------------------------------------------------------------\n * SlotClone\n * -----------------------------------------------------------------------------------------------*/\n\ninterface SlotCloneProps {\n  children: React.ReactNode;\n}\n\n/* @__NO_SIDE_EFFECTS__ */ function createSlotClone(ownerName: string) {\n  const SlotClone = React.forwardRef<any, SlotCloneProps>((props, forwardedRef) => {\n    const { children, ...slotProps } = props;\n\n    if (React.isValidElement(children)) {\n      const childrenRef = getElementRef(children);\n      const props = mergeProps(slotProps, children.props as AnyProps);\n      // do not pass ref to React.Fragment for React 19 compatibility\n      if (children.type !== React.Fragment) {\n        props.ref = forwardedRef ? composeRefs(forwardedRef, childrenRef) : childrenRef;\n      }\n      return React.cloneElement(children, props);\n    }\n\n    return React.Children.count(children) > 1 ? React.Children.only(null) : null;\n  });\n\n  SlotClone.displayName = `${ownerName}.SlotClone`;\n  return SlotClone;\n}\n\n/* -------------------------------------------------------------------------------------------------\n * Slottable\n * -----------------------------------------------------------------------------------------------*/\n\nconst SLOTTABLE_IDENTIFIER = Symbol('radix.slottable');\n\ninterface SlottableProps {\n  children: React.ReactNode;\n}\n\ninterface SlottableComponent extends React.FC<SlottableProps> {\n  __radixId: symbol;\n}\n\n/* @__NO_SIDE_EFFECTS__ */ export function createSlottable(ownerName: string) {\n  const Slottable: SlottableComponent = ({ children }) => {\n    return <>{children}</>;\n  };\n  Slottable.displayName = `${ownerName}.Slottable`;\n  Slottable.__radixId = SLOTTABLE_IDENTIFIER;\n  return Slottable;\n}\n\nconst Slottable = createSlottable('Slottable');\n\n/* ---------------------------------------------------------------------------------------------- */\n\ntype AnyProps = Record<string, any>;\n\nfunction isSlottable(\n  child: React.ReactNode\n): child is React.ReactElement<SlottableProps, typeof Slottable> {\n  return (\n    React.isValidElement(child) &&\n    typeof child.type === 'function' &&\n    '__radixId' in child.type &&\n    child.type.__radixId === SLOTTABLE_IDENTIFIER\n  );\n}\n\nfunction mergeProps(slotProps: AnyProps, childProps: AnyProps) {\n  // all child props should override\n  const overrideProps = { ...childProps };\n\n  for (const propName in childProps) {\n    const slotPropValue = slotProps[propName];\n    const childPropValue = childProps[propName];\n\n    const isHandler = /^on[A-Z]/.test(propName);\n    if (isHandler) {\n      // if the handler exists on both, we compose them\n      if (slotPropValue && childPropValue) {\n        overrideProps[propName] = (...args: unknown[]) => {\n          const result = childPropValue(...args);\n          slotPropValue(...args);\n          return result;\n        };\n      }\n      // but if it exists only on the slot, we use only this one\n      else if (slotPropValue) {\n        overrideProps[propName] = slotPropValue;\n      }\n    }\n    // if it's `style`, we merge them\n    else if (propName === 'style') {\n      overrideProps[propName] = { ...slotPropValue, ...childPropValue };\n    } else if (propName === 'className') {\n      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(' ');\n    }\n  }\n\n  return { ...slotProps, ...overrideProps };\n}\n\n// Before React 19 accessing `element.props.ref` will throw a warning and suggest using `element.ref`\n// After React 19 accessing `element.ref` does the opposite.\n// https://github.com/facebook/react/pull/28348\n//\n// Access the ref using the method that doesn't yield a warning.\nfunction getElementRef(element: React.ReactElement) {\n  // React <=18 in DEV\n  let getter = Object.getOwnPropertyDescriptor(element.props, 'ref')?.get;\n  let mayWarn = getter && 'isReactWarning' in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return (element as any).ref;\n  }\n\n  // React 19 in DEV\n  getter = Object.getOwnPropertyDescriptor(element, 'ref')?.get;\n  mayWarn = getter && 'isReactWarning' in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return (element.props as { ref?: React.Ref<unknown> }).ref;\n  }\n\n  // Not DEV\n  return (element.props as { ref?: React.Ref<unknown> }).ref || (element as any).ref;\n}\n\nexport {\n  Slot,\n  Slottable,\n  //\n  Slot as Root,\n};\nexport type { SlotProps };\n", "import * as React from 'react';\n\ntype PossibleRef<T> = React.Ref<T> | undefined;\n\n/**\n * Set a given ref to a given value\n * This utility takes care of different types of refs: callback refs and RefObject(s)\n */\nfunction setRef<T>(ref: PossibleRef<T>, value: T) {\n  if (typeof ref === 'function') {\n    return ref(value);\n  } else if (ref !== null && ref !== undefined) {\n    ref.current = value;\n  }\n}\n\n/**\n * A utility to compose multiple refs together\n * Accepts callback refs and RefObject(s)\n */\nfunction composeRefs<T>(...refs: PossibleRef<T>[]): React.RefCallback<T> {\n  return (node) => {\n    let hasCleanup = false;\n    const cleanups = refs.map((ref) => {\n      const cleanup = setRef(ref, node);\n      if (!hasCleanup && typeof cleanup == 'function') {\n        hasCleanup = true;\n      }\n      return cleanup;\n    });\n\n    // React <19 will log an error to the console if a callback ref returns a\n    // value. We don't use ref cleanups internally so this will only happen if a\n    // user's ref callback returns a value, which we only expect if they are\n    // using the cleanup functionality added in React 19.\n    if (hasCleanup) {\n      return () => {\n        for (let i = 0; i < cleanups.length; i++) {\n          const cleanup = cleanups[i];\n          if (typeof cleanup == 'function') {\n            cleanup();\n          } else {\n            setRef(refs[i], null);\n          }\n        }\n      };\n    }\n  };\n}\n\n/**\n * A custom hook that composes multiple refs\n * Accepts callback refs and RefObject(s)\n */\nfunction useComposedRefs<T>(...refs: PossibleRef<T>[]): React.RefCallback<T> {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  return React.useCallback(composeRefs(...refs), refs);\n}\n\nexport { composeRefs, useComposedRefs };\n", "export const FLOATING_ELEMENT_SIDE_OFFSET = 6;\nexport const FLOATING_ELEMENT_COLLISION_PADDING = 10;\n\nexport const EMOJI_FONT_FAMILY =\n  \"'Apple Color Emoji', 'Noto Color Emoji', 'Twemoji Mozilla', 'Android Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', EmojiSymbols, sans-serif\";\n", "import { type ComponentProps, forwardRef } from \"react\";\n\nimport { EMOJI_FONT_FAMILY } from \"../../constants\";\nimport { cn } from \"../../utils/cn\";\n\ninterface EmojiProps extends ComponentProps<\"span\"> {\n  emoji: string;\n}\n\nexport const Emoji = forwardRef<HTMLSpanElement, EmojiProps>(\n  ({ emoji, className, style, ...props }, forwardedRef) => {\n    return (\n      <span\n        role=\"img\"\n        aria-label={emoji}\n        data-emoji={emoji}\n        className={cn(\"lb-emoji\", className)}\n        style={{\n          ...style,\n          fontFamily: EMOJI_FONT_FAMILY,\n        }}\n        {...props}\n        ref={forwardedRef}\n      >\n        {emoji}\n      </span>\n    );\n  }\n);\n", "import { stableStringify } from \"@liveblocks/core\";\n\nexport function memoize<TArgs extends unknown[], TReturn>(\n  fn: (...args: TArgs) => TReturn\n): (...args: TArgs) => TReturn {\n  const cache = new Map<string, TReturn>();\n\n  return (...args: TArgs): TReturn => {\n    const key = JSON.stringify(args.map((arg) => stableStringify(arg)));\n    const cached = cache.get(key);\n\n    if (cached !== undefined) {\n      return cached;\n    }\n\n    const result = fn(...args);\n    cache.set(key, result);\n\n    return result;\n  };\n}\n", "import { memoize } from \"./memoize\";\n\n// Avoid creating Intl formatters on every invocation.\n\nexport const dateTimeFormat = memoize(\n  (...args: ConstructorParameters<(typeof Intl)[\"DateTimeFormat\"]>) => {\n    return new Intl.DateTimeFormat(...args);\n  }\n);\n\nexport const relativeTimeFormat = memoize(\n  (...args: ConstructorParameters<(typeof Intl)[\"RelativeTimeFormat\"]>) => {\n    return new Intl.RelativeTimeFormat(...args);\n  }\n);\n\nexport const listFormat = memoize(\n  (...args: ConstructorParameters<(typeof Intl)[\"ListFormat\"]>) => {\n    return new Intl.ListFormat(...args);\n  }\n);\n\nexport const numberFormat = memoize(\n  (...args: ConstructorParameters<(typeof Intl)[\"NumberFormat\"]>) => {\n    return new Intl.NumberFormat(...args);\n  }\n);\n", "import { useEffect, useRef } from \"react\";\n\n/**\n * Run a function at a given time interval.\n */\nexport function useInterval(\n  callback: () => void | false,\n  delay?: number | false\n) {\n  const latestCallback = useRef(callback);\n\n  useEffect(() => {\n    latestCallback.current = callback;\n  }, [callback]);\n\n  useEffect(() => {\n    if (!delay && delay !== 0) {\n      return;\n    }\n\n    const id = setInterval(() => {\n      if (latestCallback.current() === false) {\n        clearInterval(id);\n      }\n    }, delay);\n\n    return () => clearInterval(id);\n  }, [delay]);\n}\n", "import { useReducer } from \"react\";\n\n/**\n * Trigger a re-render programmatically, without changing the component's\n * state.\n *\n * @example\n * const rerender = useRerender();\n *\n * return (\n *   <button onClick={rerender}>\n *     {Math.random()}\n *   </button>\n * )\n */\nexport function useRerender(): [() => void, number] {\n  const [key, update] = useReducer(\n    // This implementation works by incrementing a hidden counter value that is\n    // never consumed. Simply incrementing the counter changes the component's\n    // state and, thus, trigger a re-render.\n    (key: number): number => key + 1,\n    0\n  );\n  return [update, key];\n}\n", "\"use client\";\n\nimport type { Relax } from \"@liveblocks/core\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { forwardRef, type ReactNode, useMemo } from \"react\";\n\nimport type { ComponentPropsWithSlot } from \"../types\";\nimport { numberFormat } from \"../utils/intl\";\nimport { useInterval } from \"../utils/use-interval\";\nimport { useRerender } from \"../utils/use-rerender\";\n\nconst RENDER_INTERVAL = 0.5 * 1000; // 0.5 second\n\nconst DURATION_NAME = \"Duration\";\n\nexport type DurationProps = Omit<\n  ComponentPropsWithSlot<\"time\">,\n  \"children\" | \"title\"\n> &\n  Relax<\n    | {\n        /**\n         * The duration in milliseconds.\n         * If provided, `from` and `to` will be ignored.\n         */\n        duration: number;\n      }\n    | {\n        /**\n         * The date at which the duration starts.\n         * If provided, `duration` will be ignored.\n         * If provided without `to` it means that the duration is in progress,\n         * and the component will re-render at an interval, customizable with\n         * the `interval` prop.\n         */\n        from: Date | string | number;\n\n        /**\n         * The date at which the duration ends.\n         * If `from` is provided without `to`, `Date.now()` will be used.\n         */\n        to?: Date | string | number;\n      }\n  > & {\n    /**\n     * A function to format the displayed duration.\n     */\n    children?: (duration: number, locale?: string) => ReactNode;\n\n    /**\n     * The `title` attribute's value or a function to format it.\n     */\n    title?: string | ((duration: number, locale?: string) => string);\n\n    /**\n     * The interval in milliseconds at which the component will re-render if\n     * `from` is provided without `to`, meaning that the duration is in progress.\n     * Can be set to `false` to disable re-rendering.\n     */\n    interval?: number | false;\n\n    /**\n     * The locale used when formatting the duration.\n     */\n    locale?: string;\n  };\n\ninterface DurationParts {\n  weeks: number;\n  days: number;\n  hours: number;\n  minutes: number;\n  seconds: number;\n  milliseconds: number;\n}\n\nfunction getDurationParts(duration: number): DurationParts {\n  let remaining = Math.max(duration, 0);\n\n  const milliseconds = remaining % 1000;\n  remaining = Math.floor(remaining / 1000);\n\n  const seconds = remaining % 60;\n  remaining = Math.floor(remaining / 60);\n\n  const minutes = remaining % 60;\n  remaining = Math.floor(remaining / 60);\n\n  const hours = remaining % 24;\n  remaining = Math.floor(remaining / 24);\n\n  const days = remaining % 7;\n  const weeks = Math.floor(remaining / 7);\n\n  return { weeks, days, hours, minutes, seconds, milliseconds };\n}\n\nconst durationPartsToNumberFormatOptions: Record<\n  keyof DurationParts,\n  Intl.NumberFormatOptions[\"unit\"]\n> = {\n  weeks: \"week\",\n  days: \"day\",\n  hours: \"hour\",\n  minutes: \"minute\",\n  seconds: \"second\",\n  milliseconds: \"millisecond\",\n};\n\n/**\n * Formats a duration in a short format.\n * TODO: Use `Intl.DurationFormat` when it's better supported.\n */\nfunction formatShortDuration(duration: number, locale?: string) {\n  let resolvedLocale: string;\n\n  if (locale) {\n    resolvedLocale = locale;\n  } else {\n    const formatter = numberFormat();\n\n    resolvedLocale = formatter.resolvedOptions().locale;\n  }\n\n  const parts = getDurationParts(duration);\n  const formattedParts: string[] = [];\n\n  for (const [unit, value] of Object.entries(parts) as [\n    keyof DurationParts,\n    number,\n  ][]) {\n    if (value === 0 || unit === \"milliseconds\") {\n      continue;\n    }\n\n    const formatter = numberFormat(resolvedLocale, {\n      style: \"unit\",\n      unit: durationPartsToNumberFormatOptions[unit],\n      unitDisplay: \"narrow\",\n    });\n\n    formattedParts.push(formatter.format(value));\n  }\n\n  if (!formattedParts.length) {\n    formattedParts.push(\n      numberFormat(resolvedLocale, {\n        style: \"unit\",\n        unit: \"second\",\n        unitDisplay: \"narrow\",\n      }).format(0)\n    );\n  }\n\n  return formattedParts.join(\" \");\n}\n\n/**\n * Formats a duration in a longer format.\n * TODO: Use `Intl.DurationFormat` when it's better supported.\n */\nfunction formatVerboseDuration(duration: number, locale?: string) {\n  let resolvedLocale: string;\n\n  if (locale) {\n    resolvedLocale = locale;\n  } else {\n    const formatter = numberFormat();\n\n    resolvedLocale = formatter.resolvedOptions().locale;\n  }\n\n  const parts = getDurationParts(duration);\n  const formattedParts: string[] = [];\n\n  for (const [unit, value] of Object.entries(parts) as [\n    keyof DurationParts,\n    number,\n  ][]) {\n    if (value === 0 || unit === \"milliseconds\") {\n      continue;\n    }\n\n    const formatter = numberFormat(resolvedLocale, {\n      style: \"unit\",\n      unit: durationPartsToNumberFormatOptions[unit],\n      unitDisplay: \"long\",\n    });\n\n    formattedParts.push(formatter.format(value));\n  }\n\n  if (!formattedParts.length) {\n    formattedParts.push(\n      numberFormat(resolvedLocale, {\n        style: \"unit\",\n        unit: \"second\",\n        unitDisplay: \"long\",\n      }).format(0)\n    );\n  }\n\n  return formattedParts.join(\" \");\n}\n\n/**\n * Formats a duration as ISO 8601.\n * TODO: Use `Temporal.Duration` when it's better supported.\n */\nexport function formatIso8601Duration(duration: number) {\n  const normalizedDuration = Math.max(duration, 0);\n\n  if (normalizedDuration === 0) {\n    return \"PT0S\";\n  }\n\n  const { weeks, days, hours, minutes, seconds, milliseconds } =\n    getDurationParts(normalizedDuration);\n\n  let isoDuration = \"P\";\n\n  // 1. Weeks\n  if (weeks > 0) {\n    isoDuration += `${weeks}W`;\n  }\n\n  // 2. Days\n  if (days > 0) {\n    isoDuration += `${days}D`;\n  }\n\n  if (hours > 0 || minutes > 0 || seconds > 0 || milliseconds > 0) {\n    isoDuration += \"T\";\n\n    // 3. Hours\n    if (hours > 0) {\n      isoDuration += `${hours}H`;\n    }\n\n    // 4. Minutes\n    if (minutes > 0) {\n      isoDuration += `${minutes}M`;\n    }\n\n    // 5. Seconds and milliseconds\n    if (seconds > 0 || milliseconds > 0) {\n      if (milliseconds > 0) {\n        isoDuration += `${seconds}.${milliseconds.toString().padStart(3, \"0\").replace(/0+$/, \"\")}S`;\n      } else {\n        isoDuration += `${seconds}S`;\n      }\n    }\n  }\n\n  return isoDuration;\n}\n\n/**\n * Converts a Date or Date-like value to a timestamp in milliseconds.\n */\nfunction getDateTime(date: Date | string | number) {\n  if (date instanceof Date) {\n    return date.getTime();\n  }\n\n  return new Date(date).getTime();\n}\n\n/**\n * Get a duration between two Date or Date-like values.\n */\nexport function getDuration(\n  from: Date | string | number,\n  to: Date | string | number\n) {\n  return getDateTime(to) - getDateTime(from);\n}\n\n/**\n * Displays a formatted duration, and automatically re-renders to if the\n * duration is in progress.\n *\n * @example\n * <Duration duration={3 * 60 * 1000} />\n *\n * @example\n * <Duration from={fiveHoursAgoDate} />\n *\n * @example\n * <Duration from={fiveHoursAgoDate} to={oneHourAgoDate} />\n */\nexport const Duration = forwardRef<HTMLTimeElement, DurationProps>(\n  (\n    {\n      duration,\n      from,\n      to,\n      locale,\n      dateTime,\n      title: renderTitle = formatVerboseDuration,\n      children: renderChildren = formatShortDuration,\n      interval = RENDER_INTERVAL,\n      asChild,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const Component = asChild ? Slot : \"time\";\n    const [rerender, key] = useRerender();\n    const resolvedDuration = useMemo(() => {\n      if (duration !== undefined) {\n        return duration;\n      }\n\n      if (from !== undefined) {\n        return getDuration(from, to ?? Date.now());\n      }\n\n      return 0;\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [duration, from, to, key]);\n    const normalizedDuration = useMemo(\n      () => formatIso8601Duration(resolvedDuration),\n      [resolvedDuration]\n    );\n    const title = useMemo(\n      () =>\n        typeof renderTitle === \"function\"\n          ? renderTitle(resolvedDuration, locale)\n          : renderTitle,\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [renderTitle, resolvedDuration, locale]\n    );\n    const children = useMemo(\n      () =>\n        typeof renderChildren === \"function\"\n          ? renderChildren(resolvedDuration, locale)\n          : renderChildren,\n\n      [renderChildren, resolvedDuration, locale]\n    );\n\n    // Only re-render if the duration is in progress.\n    useInterval(\n      rerender,\n      from !== undefined && to === undefined ? interval : false\n    );\n\n    return (\n      <Component\n        {...props}\n        ref={forwardedRef}\n        dateTime={dateTime ?? normalizedDuration}\n        title={title}\n      >\n        {children}\n      </Component>\n    );\n  }\n);\n\nif (process.env.NODE_ENV !== \"production\") {\n  Duration.displayName = DURATION_NAME;\n}\n", "export function pluralize<\n  C extends number,\n  S extends string,\n  P extends string = `${S}s`,\n>(count: C, singular: S, plural?: P): C extends 1 ? S : P {\n  return (count === 1 ? singular : (plural ?? `${singular}s`)) as C extends 1\n    ? S\n    : P;\n}\n", "\"use client\";\n\nimport {\n  type AiReasoningPart,\n  type AiRetrievalPart,\n  assertNever,\n} from \"@liveblocks/core\";\nimport type { PropsWithChildren, ReactNode } from \"react\";\nimport { createContext, useContext, useMemo } from \"react\";\n\nimport { Emoji } from \"./components/internal/Emoji\";\nimport { Duration, getDuration } from \"./primitives/Duration\";\nimport type { ComposerBodyMark, Direction } from \"./types\";\nimport { pluralize } from \"./utils/pluralize\";\n\nconst MINIMUM_VISIBLE_DURATION = 3 * 1000;\n\n// TODO: Move overrides to single-argument-as-object with Liveblocks 4.0,\n//       it didn't make the cut for 3.0 but we should do it next time.\n\nexport interface LocalizationOverrides {\n  locale: string;\n  dir: Direction;\n}\n\nexport interface GlobalOverrides {\n  USER_SELF: string;\n  USER_UNKNOWN: string;\n  LIST_REMAINING: (count: number) => string;\n  LIST_REMAINING_USERS: (count: number) => string;\n  LIST_REMAINING_COMMENTS: (count: number) => string;\n  EMOJI_PICKER_SEARCH_PLACEHOLDER: string;\n  EMOJI_PICKER_EMPTY: ReactNode;\n  EMOJI_PICKER_ERROR: (error: Error) => ReactNode;\n  EMOJI_PICKER_CHANGE_SKIN_TONE: string;\n  ATTACHMENT_TOO_LARGE: (maxSize?: string) => string;\n  ATTACHMENT_ERROR: (error: Error) => string;\n  COPY_TO_CLIPBOARD: string;\n}\n\nexport interface CommentOverrides {\n  COMMENT_EDITED: ReactNode;\n  COMMENT_DELETED: ReactNode;\n  COMMENT_MORE: string;\n  COMMENT_EDIT: string;\n  COMMENT_EDIT_COMPOSER_PLACEHOLDER: string;\n  COMMENT_EDIT_COMPOSER_CANCEL: string;\n  COMMENT_EDIT_COMPOSER_SAVE: string;\n  COMMENT_DELETE: string;\n  COMMENT_DELETE_ATTACHMENT: string;\n  COMMENT_ADD_REACTION: string;\n  COMMENT_REACTION_LIST: (\n    list: ReactNode,\n    emoji: string,\n    count: number\n  ) => ReactNode;\n  COMMENT_REACTION_DESCRIPTION: (emoji: string, count: number) => string;\n}\n\nexport interface ComposerOverrides {\n  COMPOSER_INSERT_MENTION: string;\n  COMPOSER_INSERT_EMOJI: string;\n  COMPOSER_ATTACH_FILES: string;\n  COMPOSER_REMOVE_ATTACHMENT: string;\n  COMPOSER_PLACEHOLDER: string;\n  COMPOSER_SEND: string;\n  COMPOSER_TOGGLE_MARK: (mark: ComposerBodyMark) => string;\n}\n\nexport interface AiToolConfirmationOverrides {\n  AI_TOOL_CONFIRMATION_CONFIRM: string;\n  AI_TOOL_CONFIRMATION_CANCEL: string;\n}\n\nexport interface AiComposerOverrides {\n  AI_COMPOSER_PLACEHOLDER: string;\n  AI_COMPOSER_SEND: string;\n  AI_COMPOSER_ABORT: string;\n}\n\nexport interface AiChatMessageOverrides {\n  AI_CHAT_MESSAGE_DELETED: string;\n  AI_CHAT_MESSAGE_THINKING: ReactNode;\n  AI_CHAT_MESSAGE_REASONING: (\n    isStreaming: boolean,\n    part: AiReasoningPart\n  ) => ReactNode;\n  AI_CHAT_MESSAGE_RETRIEVAL: (\n    isStreaming: boolean,\n    part: AiRetrievalPart\n  ) => ReactNode;\n}\n\nexport interface AiChatOverrides {\n  AI_CHAT_MESSAGES_ERROR: (error: Error) => ReactNode;\n}\n\nexport interface ThreadOverrides {\n  THREAD_RESOLVE: string;\n  THREAD_UNRESOLVE: string;\n  THREAD_SUBSCRIBE: string;\n  THREAD_UNSUBSCRIBE: string;\n  THREAD_NEW_INDICATOR: string;\n  THREAD_NEW_INDICATOR_DESCRIPTION: string;\n  THREAD_SHOW_MORE_COMMENTS: (count: number) => string;\n  THREAD_COMPOSER_PLACEHOLDER: string;\n  THREAD_COMPOSER_SEND: string;\n}\n\nexport interface InboxNotificationOverrides {\n  INBOX_NOTIFICATION_MORE: string;\n  INBOX_NOTIFICATION_MARK_AS_READ: string;\n  INBOX_NOTIFICATION_DELETE: string;\n  INBOX_NOTIFICATION_THREAD_COMMENTS_LIST: (\n    list: ReactNode,\n    room: ReactNode | undefined,\n    count: number\n  ) => ReactNode;\n  INBOX_NOTIFICATION_THREAD_MENTION: (\n    user: ReactNode,\n    room: ReactNode | undefined\n  ) => ReactNode;\n  INBOX_NOTIFICATION_TEXT_MENTION: (\n    user: ReactNode,\n    room: ReactNode | undefined\n  ) => ReactNode;\n}\n\nexport interface HistoryVersionPreviewOverrides {\n  HISTORY_VERSION_PREVIEW_AUTHORS_LIST: (list: ReactNode) => ReactNode;\n  HISTORY_VERSION_PREVIEW_RESTORE: string;\n  HISTORY_VERSION_PREVIEW_EMPTY: ReactNode;\n  HISTORY_VERSION_PREVIEW_ERROR: (error: Error) => ReactNode;\n}\n\nexport type Overrides = LocalizationOverrides &\n  GlobalOverrides &\n  ComposerOverrides &\n  CommentOverrides &\n  ThreadOverrides &\n  InboxNotificationOverrides &\n  HistoryVersionPreviewOverrides &\n  AiComposerOverrides &\n  AiChatMessageOverrides &\n  AiChatOverrides &\n  AiToolConfirmationOverrides;\n\ntype OverridesProviderProps = PropsWithChildren<{\n  overrides?: Partial<Overrides>;\n}>;\n\nfunction isDurationVisible(\n  from: Date | string | number,\n  to: Date | string | number | undefined\n) {\n  return getDuration(from, to ?? Date.now()) >= MINIMUM_VISIBLE_DURATION;\n}\n\nexport const defaultOverrides: Overrides = {\n  locale: \"en\",\n  dir: \"ltr\",\n  USER_SELF: \"you\",\n  USER_UNKNOWN: \"Anonymous\",\n  COPY_TO_CLIPBOARD: \"Copy\",\n  LIST_REMAINING: (count) => `${count} more`,\n  LIST_REMAINING_USERS: (count) => `${count} ${pluralize(count, \"other\")}`,\n  LIST_REMAINING_COMMENTS: (count) =>\n    `${count} more ${pluralize(count, \"comment\")}`,\n  EMOJI_PICKER_SEARCH_PLACEHOLDER: \"Search\",\n  EMOJI_PICKER_EMPTY: \"No emoji found.\",\n  EMOJI_PICKER_ERROR: () =>\n    \"There was an error while getting the list of emoji.\",\n  EMOJI_PICKER_CHANGE_SKIN_TONE: \"Change skin tone\",\n  ATTACHMENT_TOO_LARGE: (maxSize) =>\n    maxSize ? `The file is larger than ${maxSize}` : \"The file is too large\",\n  ATTACHMENT_ERROR: () => \"The file couldnt be uploaded.\",\n  COMPOSER_INSERT_MENTION: \"Mention someone\",\n  COMPOSER_INSERT_EMOJI: \"Add emoji\",\n  COMPOSER_ATTACH_FILES: \"Attach files\",\n  COMPOSER_REMOVE_ATTACHMENT: \"Remove attachment\",\n  COMPOSER_PLACEHOLDER: \"Write a comment\",\n  COMPOSER_SEND: \"Send\",\n  COMPOSER_TOGGLE_MARK: (format) => {\n    switch (format) {\n      case \"bold\":\n        return \"Bold\";\n      case \"italic\":\n        return \"Italic\";\n      case \"strikethrough\":\n        return \"Strikethrough\";\n      case \"code\":\n        return \"Inline code\";\n      default:\n        return assertNever(format, \"Unexpected mark\");\n    }\n  },\n  COMMENT_EDITED: \"(edited)\",\n  COMMENT_DELETED: \"This comment has been deleted.\",\n  COMMENT_MORE: \"More\",\n  COMMENT_EDIT: \"Edit comment\",\n  COMMENT_EDIT_COMPOSER_PLACEHOLDER: \"Edit comment\",\n  COMMENT_EDIT_COMPOSER_CANCEL: \"Cancel\",\n  COMMENT_EDIT_COMPOSER_SAVE: \"Save\",\n  COMMENT_DELETE: \"Delete comment\",\n  COMMENT_DELETE_ATTACHMENT: \"Delete attachment\",\n  COMMENT_ADD_REACTION: \"Add reaction\",\n  COMMENT_REACTION_LIST: (list, emoji) => (\n    <>\n      {list} reacted with <Emoji emoji={emoji} />\n    </>\n  ),\n  COMMENT_REACTION_DESCRIPTION: (emoji, count) =>\n    `${count} ${pluralize(count, \"reaction\")}, react with ${emoji}`,\n  THREAD_RESOLVE: \"Resolve thread\",\n  THREAD_UNRESOLVE: \"Re-open thread\",\n  THREAD_SUBSCRIBE: \"Subscribe to thread\",\n  THREAD_UNSUBSCRIBE: \"Unsubscribe from thread\",\n  THREAD_NEW_INDICATOR: \"New\",\n  THREAD_NEW_INDICATOR_DESCRIPTION: \"New comments\",\n  THREAD_SHOW_MORE_COMMENTS: (count) =>\n    `Show ${count} more ${pluralize(count, \"reply\", \"replies\")}`,\n  THREAD_COMPOSER_PLACEHOLDER: \"Reply to thread\",\n  THREAD_COMPOSER_SEND: \"Reply\",\n  INBOX_NOTIFICATION_MORE: \"More\",\n  INBOX_NOTIFICATION_MARK_AS_READ: \"Mark as read\",\n  INBOX_NOTIFICATION_DELETE: \"Delete notification\",\n  INBOX_NOTIFICATION_THREAD_COMMENTS_LIST: (\n    list: ReactNode,\n    room: ReactNode\n  ) => (\n    <>\n      {list} commented\n      {room ? <> in {room}</> : <> in a thread</>}\n    </>\n  ),\n  INBOX_NOTIFICATION_THREAD_MENTION: (user: ReactNode, room: ReactNode) => (\n    <>\n      {user} mentioned you{room ? <> in {room}</> : null}\n    </>\n  ),\n  INBOX_NOTIFICATION_TEXT_MENTION: (user: ReactNode, room: ReactNode) => (\n    <>\n      {user} mentioned you{room ? <> in {room}</> : null}\n    </>\n  ),\n  HISTORY_VERSION_PREVIEW_AUTHORS_LIST: (list: ReactNode) => (\n    <>Edits from {list}</>\n  ),\n  HISTORY_VERSION_PREVIEW_RESTORE: \"Restore\",\n  HISTORY_VERSION_PREVIEW_EMPTY: \"No content.\",\n  HISTORY_VERSION_PREVIEW_ERROR: () =>\n    \"There was an error while getting this version.\",\n  AI_COMPOSER_PLACEHOLDER: \"Ask anything\",\n  AI_COMPOSER_SEND: \"Send\",\n  AI_COMPOSER_ABORT: \"Abort response\",\n  AI_CHAT_MESSAGE_DELETED: \"This message has been deleted.\",\n  AI_CHAT_MESSAGE_THINKING: \"Thinking\",\n  AI_CHAT_MESSAGE_REASONING: (isStreaming: boolean, part: AiReasoningPart) =>\n    isStreaming ? (\n      <>Reasoning</>\n    ) : (\n      <>\n        Reasoned\n        {isDurationVisible(part.startedAt, part.endedAt) ? (\n          <>\n            {\" \"}\n            for{\" \"}\n            <Duration\n              className=\"lb-duration lb-ai-chat-message-reasoning-duration\"\n              from={part.startedAt}\n              to={part.endedAt}\n            />\n          </>\n        ) : null}\n      </>\n    ),\n  AI_CHAT_MESSAGE_RETRIEVAL: (isStreaming: boolean, part: AiRetrievalPart) =>\n    isStreaming ? (\n      <>\n        Searching{\" \"}\n        <span className=\"lb-ai-chat-message-retrieval-query\">{part.query}</span>\n        \n      </>\n    ) : (\n      <>\n        Searched{\" \"}\n        <span className=\"lb-ai-chat-message-retrieval-query\">{part.query}</span>\n        {isDurationVisible(part.startedAt, part.endedAt) ? (\n          <>\n            {\" \"}\n            for{\" \"}\n            <Duration\n              className=\"lb-duration lb-ai-chat-message-retrieval-duration\"\n              from={part.startedAt}\n              to={part.endedAt}\n            />\n          </>\n        ) : null}\n      </>\n    ),\n  AI_CHAT_MESSAGES_ERROR: () =>\n    \"There was an error while getting the messages.\",\n  AI_TOOL_CONFIRMATION_CONFIRM: \"Confirm\",\n  AI_TOOL_CONFIRMATION_CANCEL: \"Cancel\",\n};\n\nexport const OverridesContext = createContext<Overrides | undefined>(undefined);\n\nexport function useOverrides(overrides?: Partial<Overrides>): Overrides {\n  const contextOverrides = useContext(OverridesContext);\n\n  return useMemo(\n    () => ({\n      ...defaultOverrides,\n      ...contextOverrides,\n      ...overrides,\n    }),\n    [contextOverrides, overrides]\n  );\n}\n\nexport function OverridesProvider({\n  children,\n  overrides: providerOverrides,\n}: OverridesProviderProps) {\n  const contextOverrides = useContext(OverridesContext);\n  const overrides = useMemo(\n    () => ({\n      ...defaultOverrides,\n      ...contextOverrides,\n      ...providerOverrides,\n    }),\n    [contextOverrides, providerOverrides]\n  );\n\n  return (\n    <OverridesContext.Provider value={overrides}>\n      {children}\n    </OverridesContext.Provider>\n  );\n}\n", "import { Slot } from \"@radix-ui/react-slot\";\nimport type { ReactNode } from \"react\";\nimport { forwardRef, useMemo } from \"react\";\n\nimport { useOverrides } from \"../../overrides\";\nimport type { ComponentPropsWithSlot } from \"../../types\";\nimport { cn } from \"../../utils/cn\";\nimport { listFormat } from \"../../utils/intl\";\n\nexport interface ListProps extends ComponentPropsWithSlot<\"span\"> {\n  values: ReactNode[];\n  formatRemaining?: (amount: number) => string;\n  truncate?: number;\n  locale?: string;\n}\n\nexport const List = forwardRef<HTMLSpanElement, ListProps>(\n  (\n    { values, formatRemaining, truncate, locale, className, asChild, ...props },\n    forwardedRef\n  ) => {\n    const Component = asChild ? Slot : \"span\";\n    const $ = useOverrides();\n    const formatRemainingWithDefault = formatRemaining ?? $.LIST_REMAINING;\n    const formattedList = useMemo(() => {\n      const elements =\n        truncate && truncate < values.length - 1\n          ? [\n              ...values.slice(0, truncate),\n              formatRemainingWithDefault(values.length - truncate),\n            ]\n          : [...values];\n      const placeholders = Array(elements.length).fill(\".\");\n      const parts = listFormat(locale).formatToParts(placeholders);\n\n      return parts.map((part) =>\n        part.type === \"element\" ? elements.shift() : part.value\n      );\n    }, [formatRemainingWithDefault, locale, truncate, values]);\n\n    return (\n      <Component\n        className={cn(\"lb-list\", className)}\n        {...props}\n        ref={forwardedRef}\n      >\n        {formattedList}\n      </Component>\n    );\n  }\n);\n", "\"use client\";\n\nimport type {\n  ComponentPropsWithoutRef,\n  ComponentType,\n  PropsWithChildren,\n} from \"react\";\nimport { createContext, useContext, useMemo } from \"react\";\n\nexport interface GlobalComponents {\n  Anchor: ComponentType<ComponentPropsWithoutRef<\"a\">> | \"a\";\n}\n\nexport type Components = GlobalComponents;\n\ntype ComponentsProviderProps = PropsWithChildren<{\n  components?: Partial<Components>;\n}>;\n\nexport const defaultComponents: Components = {\n  Anchor: \"a\",\n};\n\nexport const ComponentsContext = createContext<Components | undefined>(\n  undefined\n);\n\nexport function useComponents(components?: Partial<Components>): Components {\n  const contextComponents = useContext(ComponentsContext);\n\n  return useMemo(\n    () => ({\n      ...defaultComponents,\n      ...contextComponents,\n      ...components,\n    }),\n    [contextComponents, components]\n  );\n}\n\nexport function ComponentsProvider({\n  children,\n  components: providerComponents,\n}: ComponentsProviderProps) {\n  const contextComponents = useContext(ComponentsContext);\n  const components = useMemo(\n    () => ({\n      ...defaultComponents,\n      ...contextComponents,\n      ...providerComponents,\n    }),\n    [contextComponents, providerComponents]\n  );\n\n  return (\n    <ComponentsContext.Provider value={components}>\n      {children}\n    </ComponentsContext.Provider>\n  );\n}\n", "import type { MarkedOptions } from './MarkedOptions.ts';\n\n/**\n * Gets the original marked default options.\n */\nexport function _getDefaults(): MarkedOptions {\n  return {\n    async: false,\n    breaks: false,\n    extensions: null,\n    gfm: true,\n    hooks: null,\n    pedantic: false,\n    renderer: null,\n    silent: false,\n    tokenizer: null,\n    walkTokens: null,\n  };\n}\n\nexport let _defaults = _getDefaults();\n\nexport function changeDefaults(newDefaults: MarkedOptions) {\n  _defaults = newDefaults;\n}\n", "const noopTest = { exec: () => null } as unknown as RegExp;\n\nfunction edit(regex: string | RegExp, opt = '') {\n  let source = typeof regex === 'string' ? regex : regex.source;\n  const obj = {\n    replace: (name: string | RegExp, val: string | RegExp) => {\n      let valSource = typeof val === 'string' ? val : val.source;\n      valSource = valSource.replace(other.caret, '$1');\n      source = source.replace(name, valSource);\n      return obj;\n    },\n    getRegex: () => {\n      return new RegExp(source, opt);\n    },\n  };\n  return obj;\n}\n\nexport const other = {\n  codeRemoveIndent: /^(?: {1,4}| {0,3}\\t)/gm,\n  outputLinkReplace: /\\\\([\\[\\]])/g,\n  indentCodeCompensation: /^(\\s+)(?:```)/,\n  beginningSpace: /^\\s+/,\n  endingHash: /#$/,\n  startingSpaceChar: /^ /,\n  endingSpaceChar: / $/,\n  nonSpaceChar: /[^ ]/,\n  newLineCharGlobal: /\\n/g,\n  tabCharGlobal: /\\t/g,\n  multipleSpaceGlobal: /\\s+/g,\n  blankLine: /^[ \\t]*$/,\n  doubleBlankLine: /\\n[ \\t]*\\n[ \\t]*$/,\n  blockquoteStart: /^ {0,3}>/,\n  blockquoteSetextReplace: /\\n {0,3}((?:=+|-+) *)(?=\\n|$)/g,\n  blockquoteSetextReplace2: /^ {0,3}>[ \\t]?/gm,\n  listReplaceTabs: /^\\t+/,\n  listReplaceNesting: /^ {1,4}(?=( {4})*[^ ])/g,\n  listIsTask: /^\\[[ xX]\\] /,\n  listReplaceTask: /^\\[[ xX]\\] +/,\n  anyLine: /\\n.*\\n/,\n  hrefBrackets: /^<(.*)>$/,\n  tableDelimiter: /[:|]/,\n  tableAlignChars: /^\\||\\| *$/g,\n  tableRowBlankLine: /\\n[ \\t]*$/,\n  tableAlignRight: /^ *-+: *$/,\n  tableAlignCenter: /^ *:-+: *$/,\n  tableAlignLeft: /^ *:-+ *$/,\n  startATag: /^<a /i,\n  endATag: /^<\\/a>/i,\n  startPreScriptTag: /^<(pre|code|kbd|script)(\\s|>)/i,\n  endPreScriptTag: /^<\\/(pre|code|kbd|script)(\\s|>)/i,\n  startAngleBracket: /^</,\n  endAngleBracket: />$/,\n  pedanticHrefTitle: /^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/,\n  unicodeAlphaNumeric: /[\\p{L}\\p{N}]/u,\n  escapeTest: /[&<>\"']/,\n  escapeReplace: /[&<>\"']/g,\n  escapeTestNoEncode: /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/,\n  escapeReplaceNoEncode: /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/g,\n  unescapeTest: /&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig,\n  caret: /(^|[^\\[])\\^/g,\n  percentDecode: /%25/g,\n  findPipe: /\\|/g,\n  splitPipe: / \\|/,\n  slashPipe: /\\\\\\|/g,\n  carriageReturn: /\\r\\n|\\r/g,\n  spaceLine: /^ +$/gm,\n  notSpaceStart: /^\\S*/,\n  endingNewline: /\\n$/,\n  listItemRegex: (bull: string) => new RegExp(`^( {0,3}${bull})((?:[\\t ][^\\\\n]*)?(?:\\\\n|$))`),\n  nextBulletRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \\t][^\\\\n]*)?(?:\\\\n|$))`),\n  hrRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`),\n  fencesBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:\\`\\`\\`|~~~)`),\n  headingBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}#`),\n  htmlBeginRegex: (indent: number) => new RegExp(`^ {0,${Math.min(3, indent - 1)}}<(?:[a-z].*>|!--)`, 'i'),\n};\n\n/**\n * Block-Level Grammar\n */\n\nconst newline = /^(?:[ \\t]*(?:\\n|$))+/;\nconst blockCode = /^((?: {4}| {0,3}\\t)[^\\n]+(?:\\n(?:[ \\t]*(?:\\n|$))*)?)+/;\nconst fences = /^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/;\nconst hr = /^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/;\nconst heading = /^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/;\nconst bullet = /(?:[*+-]|\\d{1,9}[.)])/;\nconst lheadingCore = /^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\\n(?!\\s*?\\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/;\nconst lheading = edit(lheadingCore)\n  .replace(/bull/g, bullet) // lists can interrupt\n  .replace(/blockCode/g, /(?: {4}| {0,3}\\t)/) // indented code blocks can interrupt\n  .replace(/fences/g, / {0,3}(?:`{3,}|~{3,})/) // fenced code blocks can interrupt\n  .replace(/blockquote/g, / {0,3}>/) // blockquote can interrupt\n  .replace(/heading/g, / {0,3}#{1,6}/) // ATX heading can interrupt\n  .replace(/html/g, / {0,3}<[^\\n>]+>\\n/) // block html can interrupt\n  .replace(/\\|table/g, '') // table not in commonmark\n  .getRegex();\nconst lheadingGfm = edit(lheadingCore)\n  .replace(/bull/g, bullet) // lists can interrupt\n  .replace(/blockCode/g, /(?: {4}| {0,3}\\t)/) // indented code blocks can interrupt\n  .replace(/fences/g, / {0,3}(?:`{3,}|~{3,})/) // fenced code blocks can interrupt\n  .replace(/blockquote/g, / {0,3}>/) // blockquote can interrupt\n  .replace(/heading/g, / {0,3}#{1,6}/) // ATX heading can interrupt\n  .replace(/html/g, / {0,3}<[^\\n>]+>\\n/) // block html can interrupt\n  .replace(/table/g, / {0,3}\\|?(?:[:\\- ]*\\|)+[\\:\\- ]*\\n/) // table can interrupt\n  .getRegex();\nconst _paragraph = /^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/;\nconst blockText = /^[^\\n]+/;\nconst _blockLabel = /(?!\\s*\\])(?:\\\\.|[^\\[\\]\\\\])+/;\nconst def = edit(/^ {0,3}\\[(label)\\]: *(?:\\n[ \\t]*)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n[ \\t]*)?| *\\n[ \\t]*)(title))? *(?:\\n+|$)/)\n  .replace('label', _blockLabel)\n  .replace('title', /(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/)\n  .getRegex();\n\nconst list = edit(/^( {0,3}bull)([ \\t][^\\n]+?)?(?:\\n|$)/)\n  .replace(/bull/g, bullet)\n  .getRegex();\n\nconst _tag = 'address|article|aside|base|basefont|blockquote|body|caption'\n  + '|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption'\n  + '|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe'\n  + '|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option'\n  + '|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title'\n  + '|tr|track|ul';\nconst _comment = /<!--(?:-?>|[\\s\\S]*?(?:-->|$))/;\nconst html = edit(\n  '^ {0,3}(?:' // optional indentation\n+ '<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)' // (1)\n+ '|comment[^\\\\n]*(\\\\n+|$)' // (2)\n+ '|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)' // (3)\n+ '|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)' // (4)\n+ '|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)' // (5)\n+ '|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (6)\n+ '|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (7) open tag\n+ '|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n[ \\t]*)+\\\\n|$)' // (7) closing tag\n+ ')', 'i')\n  .replace('comment', _comment)\n  .replace('tag', _tag)\n  .replace('attribute', / +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/)\n  .getRegex();\n\nconst paragraph = edit(_paragraph)\n  .replace('hr', hr)\n  .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n  .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n  .replace('|table', '')\n  .replace('blockquote', ' {0,3}>')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n  .getRegex();\n\nconst blockquote = edit(/^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/)\n  .replace('paragraph', paragraph)\n  .getRegex();\n\n/**\n * Normal Block Grammar\n */\n\nconst blockNormal = {\n  blockquote,\n  code: blockCode,\n  def,\n  fences,\n  heading,\n  hr,\n  html,\n  lheading,\n  list,\n  newline,\n  paragraph,\n  table: noopTest,\n  text: blockText,\n};\n\ntype BlockKeys = keyof typeof blockNormal;\n\n/**\n * GFM Block Grammar\n */\n\nconst gfmTable = edit(\n  '^ *([^\\\\n ].*)\\\\n' // Header\n+ ' {0,3}((?:\\\\| *)?:?-+:? *(?:\\\\| *:?-+:? *)*(?:\\\\| *)?)' // Align\n+ '(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)') // Cells\n  .replace('hr', hr)\n  .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n  .replace('blockquote', ' {0,3}>')\n  .replace('code', '(?: {4}| {0,3}\\t)[^\\\\n]')\n  .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n  .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n  .replace('tag', _tag) // tables can be interrupted by type (6) html blocks\n  .getRegex();\n\nconst blockGfm: Record<BlockKeys, RegExp> = {\n  ...blockNormal,\n  lheading: lheadingGfm,\n  table: gfmTable,\n  paragraph: edit(_paragraph)\n    .replace('hr', hr)\n    .replace('heading', ' {0,3}#{1,6}(?:\\\\s|$)')\n    .replace('|lheading', '') // setext headings don't interrupt commonmark paragraphs\n    .replace('table', gfmTable) // interrupt paragraphs with table\n    .replace('blockquote', ' {0,3}>')\n    .replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n')\n    .replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n    .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)')\n    .replace('tag', _tag) // pars can be interrupted by type (6) html blocks\n    .getRegex(),\n};\n\n/**\n * Pedantic grammar (original John Gruber's loose markdown specification)\n */\n\nconst blockPedantic: Record<BlockKeys, RegExp> = {\n  ...blockNormal,\n  html: edit(\n    '^ *(?:comment *(?:\\\\n|\\\\s*$)'\n    + '|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)' // closed tag\n    + '|<tag(?:\"[^\"]*\"|\\'[^\\']*\\'|\\\\s[^\\'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))')\n    .replace('comment', _comment)\n    .replace(/tag/g, '(?!(?:'\n      + 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub'\n      + '|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)'\n      + '\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b')\n    .getRegex(),\n  def: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,\n  heading: /^(#{1,6})(.*)(?:\\n+|$)/,\n  fences: noopTest, // fences not supported\n  lheading: /^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n  paragraph: edit(_paragraph)\n    .replace('hr', hr)\n    .replace('heading', ' *#{1,6} *[^\\n]')\n    .replace('lheading', lheading)\n    .replace('|table', '')\n    .replace('blockquote', ' {0,3}>')\n    .replace('|fences', '')\n    .replace('|list', '')\n    .replace('|html', '')\n    .replace('|tag', '')\n    .getRegex(),\n};\n\n/**\n * Inline-Level Grammar\n */\n\nconst escape = /^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/;\nconst inlineCode = /^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/;\nconst br = /^( {2,}|\\\\)\\n(?!\\s*$)/;\nconst inlineText = /^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/;\n\n// list of unicode punctuation marks, plus any missing characters from CommonMark spec\nconst _punctuation = /[\\p{P}\\p{S}]/u;\nconst _punctuationOrSpace = /[\\s\\p{P}\\p{S}]/u;\nconst _notPunctuationOrSpace = /[^\\s\\p{P}\\p{S}]/u;\nconst punctuation = edit(/^((?![*_])punctSpace)/, 'u')\n  .replace(/punctSpace/g, _punctuationOrSpace).getRegex();\n\n// GFM allows ~ inside strong and em for strikethrough\nconst _punctuationGfmStrongEm = /(?!~)[\\p{P}\\p{S}]/u;\nconst _punctuationOrSpaceGfmStrongEm = /(?!~)[\\s\\p{P}\\p{S}]/u;\nconst _notPunctuationOrSpaceGfmStrongEm = /(?:[^\\s\\p{P}\\p{S}]|~)/u;\n\n// sequences em should skip over [title](link), `code`, <html>\nconst blockSkip = /\\[[^[\\]]*?\\]\\((?:\\\\.|[^\\\\\\(\\)]|\\((?:\\\\.|[^\\\\\\(\\)])*\\))*\\)|`[^`]*?`|<[^<>]*?>/g;\n\nconst emStrongLDelimCore = /^(?:\\*+(?:((?!\\*)punct)|[^\\s*]))|^_+(?:((?!_)punct)|([^\\s_]))/;\n\nconst emStrongLDelim = edit(emStrongLDelimCore, 'u')\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst emStrongLDelimGfm = edit(emStrongLDelimCore, 'u')\n  .replace(/punct/g, _punctuationGfmStrongEm)\n  .getRegex();\n\nconst emStrongRDelimAstCore =\n  '^[^_*]*?__[^_*]*?\\\\*[^_*]*?(?=__)' // Skip orphan inside strong\n+ '|[^*]+(?=[^*])' // Consume to delim\n+ '|(?!\\\\*)punct(\\\\*+)(?=[\\\\s]|$)' // (1) #*** can only be a Right Delimiter\n+ '|notPunctSpace(\\\\*+)(?!\\\\*)(?=punctSpace|$)' // (2) a***#, a*** can only be a Right Delimiter\n+ '|(?!\\\\*)punctSpace(\\\\*+)(?=notPunctSpace)' // (3) #***a, ***a can only be Left Delimiter\n+ '|[\\\\s](\\\\*+)(?!\\\\*)(?=punct)' // (4) ***# can only be Left Delimiter\n+ '|(?!\\\\*)punct(\\\\*+)(?!\\\\*)(?=punct)' // (5) #***# can be either Left or Right Delimiter\n+ '|notPunctSpace(\\\\*+)(?=notPunctSpace)'; // (6) a***a can be either Left or Right Delimiter\n\nconst emStrongRDelimAst = edit(emStrongRDelimAstCore, 'gu')\n  .replace(/notPunctSpace/g, _notPunctuationOrSpace)\n  .replace(/punctSpace/g, _punctuationOrSpace)\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst emStrongRDelimAstGfm = edit(emStrongRDelimAstCore, 'gu')\n  .replace(/notPunctSpace/g, _notPunctuationOrSpaceGfmStrongEm)\n  .replace(/punctSpace/g, _punctuationOrSpaceGfmStrongEm)\n  .replace(/punct/g, _punctuationGfmStrongEm)\n  .getRegex();\n\n// (6) Not allowed for _\nconst emStrongRDelimUnd = edit(\n  '^[^_*]*?\\\\*\\\\*[^_*]*?_[^_*]*?(?=\\\\*\\\\*)' // Skip orphan inside strong\n+ '|[^_]+(?=[^_])' // Consume to delim\n+ '|(?!_)punct(_+)(?=[\\\\s]|$)' // (1) #___ can only be a Right Delimiter\n+ '|notPunctSpace(_+)(?!_)(?=punctSpace|$)' // (2) a___#, a___ can only be a Right Delimiter\n+ '|(?!_)punctSpace(_+)(?=notPunctSpace)' // (3) #___a, ___a can only be Left Delimiter\n+ '|[\\\\s](_+)(?!_)(?=punct)' // (4) ___# can only be Left Delimiter\n+ '|(?!_)punct(_+)(?!_)(?=punct)', 'gu') // (5) #___# can be either Left or Right Delimiter\n  .replace(/notPunctSpace/g, _notPunctuationOrSpace)\n  .replace(/punctSpace/g, _punctuationOrSpace)\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst anyPunctuation = edit(/\\\\(punct)/, 'gu')\n  .replace(/punct/g, _punctuation)\n  .getRegex();\n\nconst autolink = edit(/^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/)\n  .replace('scheme', /[a-zA-Z][a-zA-Z0-9+.-]{1,31}/)\n  .replace('email', /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/)\n  .getRegex();\n\nconst _inlineComment = edit(_comment).replace('(?:-->|$)', '-->').getRegex();\nconst tag = edit(\n  '^comment'\n    + '|^</[a-zA-Z][\\\\w:-]*\\\\s*>' // self-closing tag\n    + '|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>' // open tag\n    + '|^<\\\\?[\\\\s\\\\S]*?\\\\?>' // processing instruction, e.g. <?php ?>\n    + '|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>' // declaration, e.g. <!DOCTYPE html>\n    + '|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>') // CDATA section\n  .replace('comment', _inlineComment)\n  .replace('attribute', /\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/)\n  .getRegex();\n\nconst _inlineLabel = /(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/;\n\nconst link = edit(/^!?\\[(label)\\]\\(\\s*(href)(?:(?:[ \\t]*(?:\\n[ \\t]*)?)(title))?\\s*\\)/)\n  .replace('label', _inlineLabel)\n  .replace('href', /<(?:\\\\.|[^\\n<>\\\\])+>|[^ \\t\\n\\x00-\\x1f]*/)\n  .replace('title', /\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/)\n  .getRegex();\n\nconst reflink = edit(/^!?\\[(label)\\]\\[(ref)\\]/)\n  .replace('label', _inlineLabel)\n  .replace('ref', _blockLabel)\n  .getRegex();\n\nconst nolink = edit(/^!?\\[(ref)\\](?:\\[\\])?/)\n  .replace('ref', _blockLabel)\n  .getRegex();\n\nconst reflinkSearch = edit('reflink|nolink(?!\\\\()', 'g')\n  .replace('reflink', reflink)\n  .replace('nolink', nolink)\n  .getRegex();\n\n/**\n * Normal Inline Grammar\n */\n\nconst inlineNormal = {\n  _backpedal: noopTest, // only used for GFM url\n  anyPunctuation,\n  autolink,\n  blockSkip,\n  br,\n  code: inlineCode,\n  del: noopTest,\n  emStrongLDelim,\n  emStrongRDelimAst,\n  emStrongRDelimUnd,\n  escape,\n  link,\n  nolink,\n  punctuation,\n  reflink,\n  reflinkSearch,\n  tag,\n  text: inlineText,\n  url: noopTest,\n};\n\ntype InlineKeys = keyof typeof inlineNormal;\n\n/**\n * Pedantic Inline Grammar\n */\n\nconst inlinePedantic: Record<InlineKeys, RegExp> = {\n  ...inlineNormal,\n  link: edit(/^!?\\[(label)\\]\\((.*?)\\)/)\n    .replace('label', _inlineLabel)\n    .getRegex(),\n  reflink: edit(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/)\n    .replace('label', _inlineLabel)\n    .getRegex(),\n};\n\n/**\n * GFM Inline Grammar\n */\n\nconst inlineGfm: Record<InlineKeys, RegExp> = {\n  ...inlineNormal,\n  emStrongRDelimAst: emStrongRDelimAstGfm,\n  emStrongLDelim: emStrongLDelimGfm,\n  url: edit(/^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/, 'i')\n    .replace('email', /[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/)\n    .getRegex(),\n  _backpedal: /(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,\n  del: /^(~~?)(?=[^\\s~])((?:\\\\.|[^\\\\])*?(?:\\\\.|[^\\s~\\\\]))\\1(?=[^~]|$)/,\n  text: /^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/,\n};\n\n/**\n * GFM + Line Breaks Inline Grammar\n */\n\nconst inlineBreaks: Record<InlineKeys, RegExp> = {\n  ...inlineGfm,\n  br: edit(br).replace('{2,}', '*').getRegex(),\n  text: edit(inlineGfm.text)\n    .replace('\\\\b_', '\\\\b_| {2,}\\\\n')\n    .replace(/\\{2,\\}/g, '*')\n    .getRegex(),\n};\n\n/**\n * exports\n */\n\nexport const block = {\n  normal: blockNormal,\n  gfm: blockGfm,\n  pedantic: blockPedantic,\n};\n\nexport const inline = {\n  normal: inlineNormal,\n  gfm: inlineGfm,\n  breaks: inlineBreaks,\n  pedantic: inlinePedantic,\n};\n\nexport interface Rules {\n  other: typeof other\n  block: Record<BlockKeys, RegExp>\n  inline: Record<InlineKeys, RegExp>\n}\n", "import { other } from './rules.ts';\n\n/**\n * Helpers\n */\nconst escapeReplacements: { [index: string]: string } = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n};\nconst getEscapeReplacement = (ch: string) => escapeReplacements[ch];\n\nexport function escape(html: string, encode?: boolean) {\n  if (encode) {\n    if (other.escapeTest.test(html)) {\n      return html.replace(other.escapeReplace, getEscapeReplacement);\n    }\n  } else {\n    if (other.escapeTestNoEncode.test(html)) {\n      return html.replace(other.escapeReplaceNoEncode, getEscapeReplacement);\n    }\n  }\n\n  return html;\n}\n\nexport function unescape(html: string) {\n  // explicitly match decimal, hex, and named HTML entities\n  return html.replace(other.unescapeTest, (_, n) => {\n    n = n.toLowerCase();\n    if (n === 'colon') return ':';\n    if (n.charAt(0) === '#') {\n      return n.charAt(1) === 'x'\n        ? String.fromCharCode(parseInt(n.substring(2), 16))\n        : String.fromCharCode(+n.substring(1));\n    }\n    return '';\n  });\n}\n\nexport function cleanUrl(href: string) {\n  try {\n    href = encodeURI(href).replace(other.percentDecode, '%');\n  } catch {\n    return null;\n  }\n  return href;\n}\n\nexport function splitCells(tableRow: string, count?: number) {\n  // ensure that every cell-delimiting pipe has a space\n  // before it to distinguish it from an escaped pipe\n  const row = tableRow.replace(other.findPipe, (match, offset, str) => {\n      let escaped = false;\n      let curr = offset;\n      while (--curr >= 0 && str[curr] === '\\\\') escaped = !escaped;\n      if (escaped) {\n        // odd number of slashes means | is escaped\n        // so we leave it alone\n        return '|';\n      } else {\n        // add space before unescaped |\n        return ' |';\n      }\n    }),\n    cells = row.split(other.splitPipe);\n  let i = 0;\n\n  // First/last cell in a row cannot be empty if it has no leading/trailing pipe\n  if (!cells[0].trim()) {\n    cells.shift();\n  }\n  if (cells.length > 0 && !cells.at(-1)?.trim()) {\n    cells.pop();\n  }\n\n  if (count) {\n    if (cells.length > count) {\n      cells.splice(count);\n    } else {\n      while (cells.length < count) cells.push('');\n    }\n  }\n\n  for (; i < cells.length; i++) {\n    // leading or trailing whitespace is ignored per the gfm spec\n    cells[i] = cells[i].trim().replace(other.slashPipe, '|');\n  }\n  return cells;\n}\n\n/**\n * Remove trailing 'c's. Equivalent to str.replace(/c*$/, '').\n * /c*$/ is vulnerable to REDOS.\n *\n * @param str\n * @param c\n * @param invert Remove suffix of non-c chars instead. Default falsey.\n */\nexport function rtrim(str: string, c: string, invert?: boolean) {\n  const l = str.length;\n  if (l === 0) {\n    return '';\n  }\n\n  // Length of suffix matching the invert condition.\n  let suffLen = 0;\n\n  // Step left until we fail to match the invert condition.\n  while (suffLen < l) {\n    const currChar = str.charAt(l - suffLen - 1);\n    if (currChar === c && !invert) {\n      suffLen++;\n    } else if (currChar !== c && invert) {\n      suffLen++;\n    } else {\n      break;\n    }\n  }\n\n  return str.slice(0, l - suffLen);\n}\n\nexport function findClosingBracket(str: string, b: string) {\n  if (str.indexOf(b[1]) === -1) {\n    return -1;\n  }\n\n  let level = 0;\n  for (let i = 0; i < str.length; i++) {\n    if (str[i] === '\\\\') {\n      i++;\n    } else if (str[i] === b[0]) {\n      level++;\n    } else if (str[i] === b[1]) {\n      level--;\n      if (level < 0) {\n        return i;\n      }\n    }\n  }\n  if (level > 0) {\n    return -2;\n  }\n\n  return -1;\n}\n", "import { _defaults } from './defaults.ts';\nimport {\n  rtrim,\n  splitCells,\n  findClosingBracket,\n} from './helpers.ts';\nimport type { Rules } from './rules.ts';\nimport type { _Lexer } from './Lexer.ts';\nimport type { Links, Tokens, Token } from './Tokens.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\n\nfunction outputLink(cap: string[], link: Pick<Tokens.Link, 'href' | 'title'>, raw: string, lexer: _Lexer, rules: Rules): Tokens.Link | Tokens.Image {\n  const href = link.href;\n  const title = link.title || null;\n  const text = cap[1].replace(rules.other.outputLinkReplace, '$1');\n\n  lexer.state.inLink = true;\n  const token: Tokens.Link | Tokens.Image = {\n    type: cap[0].charAt(0) === '!' ? 'image' : 'link',\n    raw,\n    href,\n    title,\n    text,\n    tokens: lexer.inlineTokens(text),\n  };\n  lexer.state.inLink = false;\n  return token;\n}\n\nfunction indentCodeCompensation(raw: string, text: string, rules: Rules) {\n  const matchIndentToCode = raw.match(rules.other.indentCodeCompensation);\n\n  if (matchIndentToCode === null) {\n    return text;\n  }\n\n  const indentToCode = matchIndentToCode[1];\n\n  return text\n    .split('\\n')\n    .map(node => {\n      const matchIndentInNode = node.match(rules.other.beginningSpace);\n      if (matchIndentInNode === null) {\n        return node;\n      }\n\n      const [indentInNode] = matchIndentInNode;\n\n      if (indentInNode.length >= indentToCode.length) {\n        return node.slice(indentToCode.length);\n      }\n\n      return node;\n    })\n    .join('\\n');\n}\n\n/**\n * Tokenizer\n */\nexport class _Tokenizer {\n  options: MarkedOptions;\n  rules!: Rules; // set by the lexer\n  lexer!: _Lexer; // set by the lexer\n\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n  }\n\n  space(src: string): Tokens.Space | undefined {\n    const cap = this.rules.block.newline.exec(src);\n    if (cap && cap[0].length > 0) {\n      return {\n        type: 'space',\n        raw: cap[0],\n      };\n    }\n  }\n\n  code(src: string): Tokens.Code | undefined {\n    const cap = this.rules.block.code.exec(src);\n    if (cap) {\n      const text = cap[0].replace(this.rules.other.codeRemoveIndent, '');\n      return {\n        type: 'code',\n        raw: cap[0],\n        codeBlockStyle: 'indented',\n        text: !this.options.pedantic\n          ? rtrim(text, '\\n')\n          : text,\n      };\n    }\n  }\n\n  fences(src: string): Tokens.Code | undefined {\n    const cap = this.rules.block.fences.exec(src);\n    if (cap) {\n      const raw = cap[0];\n      const text = indentCodeCompensation(raw, cap[3] || '', this.rules);\n\n      return {\n        type: 'code',\n        raw,\n        lang: cap[2] ? cap[2].trim().replace(this.rules.inline.anyPunctuation, '$1') : cap[2],\n        text,\n      };\n    }\n  }\n\n  heading(src: string): Tokens.Heading | undefined {\n    const cap = this.rules.block.heading.exec(src);\n    if (cap) {\n      let text = cap[2].trim();\n\n      // remove trailing #s\n      if (this.rules.other.endingHash.test(text)) {\n        const trimmed = rtrim(text, '#');\n        if (this.options.pedantic) {\n          text = trimmed.trim();\n        } else if (!trimmed || this.rules.other.endingSpaceChar.test(trimmed)) {\n          // CommonMark requires space before trailing #s\n          text = trimmed.trim();\n        }\n      }\n\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[1].length,\n        text,\n        tokens: this.lexer.inline(text),\n      };\n    }\n  }\n\n  hr(src: string): Tokens.Hr | undefined {\n    const cap = this.rules.block.hr.exec(src);\n    if (cap) {\n      return {\n        type: 'hr',\n        raw: rtrim(cap[0], '\\n'),\n      };\n    }\n  }\n\n  blockquote(src: string): Tokens.Blockquote | undefined {\n    const cap = this.rules.block.blockquote.exec(src);\n    if (cap) {\n      let lines = rtrim(cap[0], '\\n').split('\\n');\n      let raw = '';\n      let text = '';\n      const tokens: Token[] = [];\n\n      while (lines.length > 0) {\n        let inBlockquote = false;\n        const currentLines = [];\n\n        let i;\n        for (i = 0; i < lines.length; i++) {\n          // get lines up to a continuation\n          if (this.rules.other.blockquoteStart.test(lines[i])) {\n            currentLines.push(lines[i]);\n            inBlockquote = true;\n          } else if (!inBlockquote) {\n            currentLines.push(lines[i]);\n          } else {\n            break;\n          }\n        }\n        lines = lines.slice(i);\n\n        const currentRaw = currentLines.join('\\n');\n        const currentText = currentRaw\n          // precede setext continuation with 4 spaces so it isn't a setext\n          .replace(this.rules.other.blockquoteSetextReplace, '\\n    $1')\n          .replace(this.rules.other.blockquoteSetextReplace2, '');\n        raw = raw ? `${raw}\\n${currentRaw}` : currentRaw;\n        text = text ? `${text}\\n${currentText}` : currentText;\n\n        // parse blockquote lines as top level tokens\n        // merge paragraphs if this is a continuation\n        const top = this.lexer.state.top;\n        this.lexer.state.top = true;\n        this.lexer.blockTokens(currentText, tokens, true);\n        this.lexer.state.top = top;\n\n        // if there is no continuation then we are done\n        if (lines.length === 0) {\n          break;\n        }\n\n        const lastToken = tokens.at(-1);\n\n        if (lastToken?.type === 'code') {\n          // blockquote continuation cannot be preceded by a code block\n          break;\n        } else if (lastToken?.type === 'blockquote') {\n          // include continuation in nested blockquote\n          const oldToken = lastToken as Tokens.Blockquote;\n          const newText = oldToken.raw + '\\n' + lines.join('\\n');\n          const newToken = this.blockquote(newText)!;\n          tokens[tokens.length - 1] = newToken;\n\n          raw = raw.substring(0, raw.length - oldToken.raw.length) + newToken.raw;\n          text = text.substring(0, text.length - oldToken.text.length) + newToken.text;\n          break;\n        } else if (lastToken?.type === 'list') {\n          // include continuation in nested list\n          const oldToken = lastToken as Tokens.List;\n          const newText = oldToken.raw + '\\n' + lines.join('\\n');\n          const newToken = this.list(newText)!;\n          tokens[tokens.length - 1] = newToken;\n\n          raw = raw.substring(0, raw.length - lastToken.raw.length) + newToken.raw;\n          text = text.substring(0, text.length - oldToken.raw.length) + newToken.raw;\n          lines = newText.substring(tokens.at(-1)!.raw.length).split('\\n');\n          continue;\n        }\n      }\n\n      return {\n        type: 'blockquote',\n        raw,\n        tokens,\n        text,\n      };\n    }\n  }\n\n  list(src: string): Tokens.List | undefined {\n    let cap = this.rules.block.list.exec(src);\n    if (cap) {\n      let bull = cap[1].trim();\n      const isordered = bull.length > 1;\n\n      const list: Tokens.List = {\n        type: 'list',\n        raw: '',\n        ordered: isordered,\n        start: isordered ? +bull.slice(0, -1) : '',\n        loose: false,\n        items: [],\n      };\n\n      bull = isordered ? `\\\\d{1,9}\\\\${bull.slice(-1)}` : `\\\\${bull}`;\n\n      if (this.options.pedantic) {\n        bull = isordered ? bull : '[*+-]';\n      }\n\n      // Get next list item\n      const itemRegex = this.rules.other.listItemRegex(bull);\n      let endsWithBlankLine = false;\n      // Check if current bullet point can start a new List Item\n      while (src) {\n        let endEarly = false;\n        let raw = '';\n        let itemContents = '';\n        if (!(cap = itemRegex.exec(src))) {\n          break;\n        }\n\n        if (this.rules.block.hr.test(src)) { // End list if bullet was actually HR (possibly move into itemRegex?)\n          break;\n        }\n\n        raw = cap[0];\n        src = src.substring(raw.length);\n\n        let line = cap[2].split('\\n', 1)[0].replace(this.rules.other.listReplaceTabs, (t: string) => ' '.repeat(3 * t.length));\n        let nextLine = src.split('\\n', 1)[0];\n        let blankLine = !line.trim();\n\n        let indent = 0;\n        if (this.options.pedantic) {\n          indent = 2;\n          itemContents = line.trimStart();\n        } else if (blankLine) {\n          indent = cap[1].length + 1;\n        } else {\n          indent = cap[2].search(this.rules.other.nonSpaceChar); // Find first non-space char\n          indent = indent > 4 ? 1 : indent; // Treat indented code blocks (> 4 spaces) as having only 1 indent\n          itemContents = line.slice(indent);\n          indent += cap[1].length;\n        }\n\n        if (blankLine && this.rules.other.blankLine.test(nextLine)) { // Items begin with at most one blank line\n          raw += nextLine + '\\n';\n          src = src.substring(nextLine.length + 1);\n          endEarly = true;\n        }\n\n        if (!endEarly) {\n          const nextBulletRegex = this.rules.other.nextBulletRegex(indent);\n          const hrRegex = this.rules.other.hrRegex(indent);\n          const fencesBeginRegex = this.rules.other.fencesBeginRegex(indent);\n          const headingBeginRegex = this.rules.other.headingBeginRegex(indent);\n          const htmlBeginRegex = this.rules.other.htmlBeginRegex(indent);\n\n          // Check if following lines should be included in List Item\n          while (src) {\n            const rawLine = src.split('\\n', 1)[0];\n            let nextLineWithoutTabs;\n            nextLine = rawLine;\n\n            // Re-align to follow commonmark nesting rules\n            if (this.options.pedantic) {\n              nextLine = nextLine.replace(this.rules.other.listReplaceNesting, '  ');\n              nextLineWithoutTabs = nextLine;\n            } else {\n              nextLineWithoutTabs = nextLine.replace(this.rules.other.tabCharGlobal, '    ');\n            }\n\n            // End list item if found code fences\n            if (fencesBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new heading\n            if (headingBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of html block\n            if (htmlBeginRegex.test(nextLine)) {\n              break;\n            }\n\n            // End list item if found start of new bullet\n            if (nextBulletRegex.test(nextLine)) {\n              break;\n            }\n\n            // Horizontal rule found\n            if (hrRegex.test(nextLine)) {\n              break;\n            }\n\n            if (nextLineWithoutTabs.search(this.rules.other.nonSpaceChar) >= indent || !nextLine.trim()) { // Dedent if possible\n              itemContents += '\\n' + nextLineWithoutTabs.slice(indent);\n            } else {\n              // not enough indentation\n              if (blankLine) {\n                break;\n              }\n\n              // paragraph continuation unless last line was a different block level element\n              if (line.replace(this.rules.other.tabCharGlobal, '    ').search(this.rules.other.nonSpaceChar) >= 4) { // indented code block\n                break;\n              }\n              if (fencesBeginRegex.test(line)) {\n                break;\n              }\n              if (headingBeginRegex.test(line)) {\n                break;\n              }\n              if (hrRegex.test(line)) {\n                break;\n              }\n\n              itemContents += '\\n' + nextLine;\n            }\n\n            if (!blankLine && !nextLine.trim()) { // Check if current line is blank\n              blankLine = true;\n            }\n\n            raw += rawLine + '\\n';\n            src = src.substring(rawLine.length + 1);\n            line = nextLineWithoutTabs.slice(indent);\n          }\n        }\n\n        if (!list.loose) {\n          // If the previous item ended with a blank line, the list is loose\n          if (endsWithBlankLine) {\n            list.loose = true;\n          } else if (this.rules.other.doubleBlankLine.test(raw)) {\n            endsWithBlankLine = true;\n          }\n        }\n\n        let istask: RegExpExecArray | null = null;\n        let ischecked: boolean | undefined;\n        // Check for task list items\n        if (this.options.gfm) {\n          istask = this.rules.other.listIsTask.exec(itemContents);\n          if (istask) {\n            ischecked = istask[0] !== '[ ] ';\n            itemContents = itemContents.replace(this.rules.other.listReplaceTask, '');\n          }\n        }\n\n        list.items.push({\n          type: 'list_item',\n          raw,\n          task: !!istask,\n          checked: ischecked,\n          loose: false,\n          text: itemContents,\n          tokens: [],\n        });\n\n        list.raw += raw;\n      }\n\n      // Do not consume newlines at end of final item. Alternatively, make itemRegex *start* with any newlines to simplify/speed up endsWithBlankLine logic\n      const lastItem = list.items.at(-1);\n      if (lastItem) {\n        lastItem.raw = lastItem.raw.trimEnd();\n        lastItem.text = lastItem.text.trimEnd();\n      } else {\n        // not a list since there were no items\n        return;\n      }\n      list.raw = list.raw.trimEnd();\n\n      // Item child tokens handled here at end because we needed to have the final item to trim it first\n      for (let i = 0; i < list.items.length; i++) {\n        this.lexer.state.top = false;\n        list.items[i].tokens = this.lexer.blockTokens(list.items[i].text, []);\n\n        if (!list.loose) {\n          // Check if list should be loose\n          const spacers = list.items[i].tokens.filter(t => t.type === 'space');\n          const hasMultipleLineBreaks = spacers.length > 0 && spacers.some(t => this.rules.other.anyLine.test(t.raw));\n\n          list.loose = hasMultipleLineBreaks;\n        }\n      }\n\n      // Set all items to loose if list is loose\n      if (list.loose) {\n        for (let i = 0; i < list.items.length; i++) {\n          list.items[i].loose = true;\n        }\n      }\n\n      return list;\n    }\n  }\n\n  html(src: string): Tokens.HTML | undefined {\n    const cap = this.rules.block.html.exec(src);\n    if (cap) {\n      const token: Tokens.HTML = {\n        type: 'html',\n        block: true,\n        raw: cap[0],\n        pre: cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style',\n        text: cap[0],\n      };\n      return token;\n    }\n  }\n\n  def(src: string): Tokens.Def | undefined {\n    const cap = this.rules.block.def.exec(src);\n    if (cap) {\n      const tag = cap[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal, ' ');\n      const href = cap[2] ? cap[2].replace(this.rules.other.hrefBrackets, '$1').replace(this.rules.inline.anyPunctuation, '$1') : '';\n      const title = cap[3] ? cap[3].substring(1, cap[3].length - 1).replace(this.rules.inline.anyPunctuation, '$1') : cap[3];\n      return {\n        type: 'def',\n        tag,\n        raw: cap[0],\n        href,\n        title,\n      };\n    }\n  }\n\n  table(src: string): Tokens.Table | undefined {\n    const cap = this.rules.block.table.exec(src);\n    if (!cap) {\n      return;\n    }\n\n    if (!this.rules.other.tableDelimiter.test(cap[2])) {\n      // delimiter row must have a pipe (|) or colon (:) otherwise it is a setext heading\n      return;\n    }\n\n    const headers = splitCells(cap[1]);\n    const aligns = cap[2].replace(this.rules.other.tableAlignChars, '').split('|');\n    const rows = cap[3]?.trim() ? cap[3].replace(this.rules.other.tableRowBlankLine, '').split('\\n') : [];\n\n    const item: Tokens.Table = {\n      type: 'table',\n      raw: cap[0],\n      header: [],\n      align: [],\n      rows: [],\n    };\n\n    if (headers.length !== aligns.length) {\n      // header and align columns must be equal, rows can be different.\n      return;\n    }\n\n    for (const align of aligns) {\n      if (this.rules.other.tableAlignRight.test(align)) {\n        item.align.push('right');\n      } else if (this.rules.other.tableAlignCenter.test(align)) {\n        item.align.push('center');\n      } else if (this.rules.other.tableAlignLeft.test(align)) {\n        item.align.push('left');\n      } else {\n        item.align.push(null);\n      }\n    }\n\n    for (let i = 0; i < headers.length; i++) {\n      item.header.push({\n        text: headers[i],\n        tokens: this.lexer.inline(headers[i]),\n        header: true,\n        align: item.align[i],\n      });\n    }\n\n    for (const row of rows) {\n      item.rows.push(splitCells(row, item.header.length).map((cell, i) => {\n        return {\n          text: cell,\n          tokens: this.lexer.inline(cell),\n          header: false,\n          align: item.align[i],\n        };\n      }));\n    }\n\n    return item;\n  }\n\n  lheading(src: string): Tokens.Heading | undefined {\n    const cap = this.rules.block.lheading.exec(src);\n    if (cap) {\n      return {\n        type: 'heading',\n        raw: cap[0],\n        depth: cap[2].charAt(0) === '=' ? 1 : 2,\n        text: cap[1],\n        tokens: this.lexer.inline(cap[1]),\n      };\n    }\n  }\n\n  paragraph(src: string): Tokens.Paragraph | undefined {\n    const cap = this.rules.block.paragraph.exec(src);\n    if (cap) {\n      const text = cap[1].charAt(cap[1].length - 1) === '\\n'\n        ? cap[1].slice(0, -1)\n        : cap[1];\n      return {\n        type: 'paragraph',\n        raw: cap[0],\n        text,\n        tokens: this.lexer.inline(text),\n      };\n    }\n  }\n\n  text(src: string): Tokens.Text | undefined {\n    const cap = this.rules.block.text.exec(src);\n    if (cap) {\n      return {\n        type: 'text',\n        raw: cap[0],\n        text: cap[0],\n        tokens: this.lexer.inline(cap[0]),\n      };\n    }\n  }\n\n  escape(src: string): Tokens.Escape | undefined {\n    const cap = this.rules.inline.escape.exec(src);\n    if (cap) {\n      return {\n        type: 'escape',\n        raw: cap[0],\n        text: cap[1],\n      };\n    }\n  }\n\n  tag(src: string): Tokens.Tag | undefined {\n    const cap = this.rules.inline.tag.exec(src);\n    if (cap) {\n      if (!this.lexer.state.inLink && this.rules.other.startATag.test(cap[0])) {\n        this.lexer.state.inLink = true;\n      } else if (this.lexer.state.inLink && this.rules.other.endATag.test(cap[0])) {\n        this.lexer.state.inLink = false;\n      }\n      if (!this.lexer.state.inRawBlock && this.rules.other.startPreScriptTag.test(cap[0])) {\n        this.lexer.state.inRawBlock = true;\n      } else if (this.lexer.state.inRawBlock && this.rules.other.endPreScriptTag.test(cap[0])) {\n        this.lexer.state.inRawBlock = false;\n      }\n\n      return {\n        type: 'html',\n        raw: cap[0],\n        inLink: this.lexer.state.inLink,\n        inRawBlock: this.lexer.state.inRawBlock,\n        block: false,\n        text: cap[0],\n      };\n    }\n  }\n\n  link(src: string): Tokens.Link | Tokens.Image | undefined {\n    const cap = this.rules.inline.link.exec(src);\n    if (cap) {\n      const trimmedUrl = cap[2].trim();\n      if (!this.options.pedantic && this.rules.other.startAngleBracket.test(trimmedUrl)) {\n        // commonmark requires matching angle brackets\n        if (!(this.rules.other.endAngleBracket.test(trimmedUrl))) {\n          return;\n        }\n\n        // ending angle bracket cannot be escaped\n        const rtrimSlash = rtrim(trimmedUrl.slice(0, -1), '\\\\');\n        if ((trimmedUrl.length - rtrimSlash.length) % 2 === 0) {\n          return;\n        }\n      } else {\n        // find closing parenthesis\n        const lastParenIndex = findClosingBracket(cap[2], '()');\n        if (lastParenIndex === -2) {\n          // more open parens than closed\n          return;\n        }\n\n        if (lastParenIndex > -1) {\n          const start = cap[0].indexOf('!') === 0 ? 5 : 4;\n          const linkLen = start + cap[1].length + lastParenIndex;\n          cap[2] = cap[2].substring(0, lastParenIndex);\n          cap[0] = cap[0].substring(0, linkLen).trim();\n          cap[3] = '';\n        }\n      }\n      let href = cap[2];\n      let title = '';\n      if (this.options.pedantic) {\n        // split pedantic href and title\n        const link = this.rules.other.pedanticHrefTitle.exec(href);\n\n        if (link) {\n          href = link[1];\n          title = link[3];\n        }\n      } else {\n        title = cap[3] ? cap[3].slice(1, -1) : '';\n      }\n\n      href = href.trim();\n      if (this.rules.other.startAngleBracket.test(href)) {\n        if (this.options.pedantic && !(this.rules.other.endAngleBracket.test(trimmedUrl))) {\n          // pedantic allows starting angle bracket without ending angle bracket\n          href = href.slice(1);\n        } else {\n          href = href.slice(1, -1);\n        }\n      }\n      return outputLink(cap, {\n        href: href ? href.replace(this.rules.inline.anyPunctuation, '$1') : href,\n        title: title ? title.replace(this.rules.inline.anyPunctuation, '$1') : title,\n      }, cap[0], this.lexer, this.rules);\n    }\n  }\n\n  reflink(src: string, links: Links): Tokens.Link | Tokens.Image | Tokens.Text | undefined {\n    let cap;\n    if ((cap = this.rules.inline.reflink.exec(src))\n      || (cap = this.rules.inline.nolink.exec(src))) {\n      const linkString = (cap[2] || cap[1]).replace(this.rules.other.multipleSpaceGlobal, ' ');\n      const link = links[linkString.toLowerCase()];\n      if (!link) {\n        const text = cap[0].charAt(0);\n        return {\n          type: 'text',\n          raw: text,\n          text,\n        };\n      }\n      return outputLink(cap, link, cap[0], this.lexer, this.rules);\n    }\n  }\n\n  emStrong(src: string, maskedSrc: string, prevChar = ''): Tokens.Em | Tokens.Strong | undefined {\n    let match = this.rules.inline.emStrongLDelim.exec(src);\n    if (!match) return;\n\n    // _ can't be between two alphanumerics. \\p{L}\\p{N} includes non-english alphabet/numbers as well\n    if (match[3] && prevChar.match(this.rules.other.unicodeAlphaNumeric)) return;\n\n    const nextChar = match[1] || match[2] || '';\n\n    if (!nextChar || !prevChar || this.rules.inline.punctuation.exec(prevChar)) {\n      // unicode Regex counts emoji as 1 char; spread into array for proper count (used multiple times below)\n      const lLength = [...match[0]].length - 1;\n      let rDelim, rLength, delimTotal = lLength, midDelimTotal = 0;\n\n      const endReg = match[0][0] === '*' ? this.rules.inline.emStrongRDelimAst : this.rules.inline.emStrongRDelimUnd;\n      endReg.lastIndex = 0;\n\n      // Clip maskedSrc to same section of string as src (move to lexer?)\n      maskedSrc = maskedSrc.slice(-1 * src.length + lLength);\n\n      while ((match = endReg.exec(maskedSrc)) != null) {\n        rDelim = match[1] || match[2] || match[3] || match[4] || match[5] || match[6];\n\n        if (!rDelim) continue; // skip single * in __abc*abc__\n\n        rLength = [...rDelim].length;\n\n        if (match[3] || match[4]) { // found another Left Delim\n          delimTotal += rLength;\n          continue;\n        } else if (match[5] || match[6]) { // either Left or Right Delim\n          if (lLength % 3 && !((lLength + rLength) % 3)) {\n            midDelimTotal += rLength;\n            continue; // CommonMark Emphasis Rules 9-10\n          }\n        }\n\n        delimTotal -= rLength;\n\n        if (delimTotal > 0) continue; // Haven't found enough closing delimiters\n\n        // Remove extra characters. *a*** -> *a*\n        rLength = Math.min(rLength, rLength + delimTotal + midDelimTotal);\n        // char length can be >1 for unicode characters;\n        const lastCharLength = [...match[0]][0].length;\n        const raw = src.slice(0, lLength + match.index + lastCharLength + rLength);\n\n        // Create `em` if smallest delimiter has odd char count. *a***\n        if (Math.min(lLength, rLength) % 2) {\n          const text = raw.slice(1, -1);\n          return {\n            type: 'em',\n            raw,\n            text,\n            tokens: this.lexer.inlineTokens(text),\n          };\n        }\n\n        // Create 'strong' if smallest delimiter has even char count. **a***\n        const text = raw.slice(2, -2);\n        return {\n          type: 'strong',\n          raw,\n          text,\n          tokens: this.lexer.inlineTokens(text),\n        };\n      }\n    }\n  }\n\n  codespan(src: string): Tokens.Codespan | undefined {\n    const cap = this.rules.inline.code.exec(src);\n    if (cap) {\n      let text = cap[2].replace(this.rules.other.newLineCharGlobal, ' ');\n      const hasNonSpaceChars = this.rules.other.nonSpaceChar.test(text);\n      const hasSpaceCharsOnBothEnds = this.rules.other.startingSpaceChar.test(text) && this.rules.other.endingSpaceChar.test(text);\n      if (hasNonSpaceChars && hasSpaceCharsOnBothEnds) {\n        text = text.substring(1, text.length - 1);\n      }\n      return {\n        type: 'codespan',\n        raw: cap[0],\n        text,\n      };\n    }\n  }\n\n  br(src: string): Tokens.Br | undefined {\n    const cap = this.rules.inline.br.exec(src);\n    if (cap) {\n      return {\n        type: 'br',\n        raw: cap[0],\n      };\n    }\n  }\n\n  del(src: string): Tokens.Del | undefined {\n    const cap = this.rules.inline.del.exec(src);\n    if (cap) {\n      return {\n        type: 'del',\n        raw: cap[0],\n        text: cap[2],\n        tokens: this.lexer.inlineTokens(cap[2]),\n      };\n    }\n  }\n\n  autolink(src: string): Tokens.Link | undefined {\n    const cap = this.rules.inline.autolink.exec(src);\n    if (cap) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = cap[1];\n        href = 'mailto:' + text;\n      } else {\n        text = cap[1];\n        href = text;\n      }\n\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text,\n          },\n        ],\n      };\n    }\n  }\n\n  url(src: string): Tokens.Link | undefined {\n    let cap;\n    if (cap = this.rules.inline.url.exec(src)) {\n      let text, href;\n      if (cap[2] === '@') {\n        text = cap[0];\n        href = 'mailto:' + text;\n      } else {\n        // do extended autolink path validation\n        let prevCapZero;\n        do {\n          prevCapZero = cap[0];\n          cap[0] = this.rules.inline._backpedal.exec(cap[0])?.[0] ?? '';\n        } while (prevCapZero !== cap[0]);\n        text = cap[0];\n        if (cap[1] === 'www.') {\n          href = 'http://' + cap[0];\n        } else {\n          href = cap[0];\n        }\n      }\n      return {\n        type: 'link',\n        raw: cap[0],\n        text,\n        href,\n        tokens: [\n          {\n            type: 'text',\n            raw: text,\n            text,\n          },\n        ],\n      };\n    }\n  }\n\n  inlineText(src: string): Tokens.Text | undefined {\n    const cap = this.rules.inline.text.exec(src);\n    if (cap) {\n      const escaped = this.lexer.state.inRawBlock;\n      return {\n        type: 'text',\n        raw: cap[0],\n        text: cap[0],\n        escaped,\n      };\n    }\n  }\n}\n", "import { _Tokenizer } from './Tokenizer.ts';\nimport { _defaults } from './defaults.ts';\nimport { other, block, inline } from './rules.ts';\nimport type { Token, TokensList, Tokens } from './Tokens.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\n\n/**\n * Block Lexer\n */\nexport class _Lexer {\n  tokens: TokensList;\n  options: MarkedOptions;\n  state: {\n    inLink: boolean;\n    inRawBlock: boolean;\n    top: boolean;\n  };\n\n  private tokenizer: _Tokenizer;\n  private inlineQueue: { src: string, tokens: Token[] }[];\n\n  constructor(options?: MarkedOptions) {\n    // TokenList cannot be created in one go\n    this.tokens = [] as unknown as TokensList;\n    this.tokens.links = Object.create(null);\n    this.options = options || _defaults;\n    this.options.tokenizer = this.options.tokenizer || new _Tokenizer();\n    this.tokenizer = this.options.tokenizer;\n    this.tokenizer.options = this.options;\n    this.tokenizer.lexer = this;\n    this.inlineQueue = [];\n    this.state = {\n      inLink: false,\n      inRawBlock: false,\n      top: true,\n    };\n\n    const rules = {\n      other,\n      block: block.normal,\n      inline: inline.normal,\n    };\n\n    if (this.options.pedantic) {\n      rules.block = block.pedantic;\n      rules.inline = inline.pedantic;\n    } else if (this.options.gfm) {\n      rules.block = block.gfm;\n      if (this.options.breaks) {\n        rules.inline = inline.breaks;\n      } else {\n        rules.inline = inline.gfm;\n      }\n    }\n    this.tokenizer.rules = rules;\n  }\n\n  /**\n   * Expose Rules\n   */\n  static get rules() {\n    return {\n      block,\n      inline,\n    };\n  }\n\n  /**\n   * Static Lex Method\n   */\n  static lex(src: string, options?: MarkedOptions) {\n    const lexer = new _Lexer(options);\n    return lexer.lex(src);\n  }\n\n  /**\n   * Static Lex Inline Method\n   */\n  static lexInline(src: string, options?: MarkedOptions) {\n    const lexer = new _Lexer(options);\n    return lexer.inlineTokens(src);\n  }\n\n  /**\n   * Preprocessing\n   */\n  lex(src: string) {\n    src = src.replace(other.carriageReturn, '\\n');\n\n    this.blockTokens(src, this.tokens);\n\n    for (let i = 0; i < this.inlineQueue.length; i++) {\n      const next = this.inlineQueue[i];\n      this.inlineTokens(next.src, next.tokens);\n    }\n    this.inlineQueue = [];\n\n    return this.tokens;\n  }\n\n  /**\n   * Lexing\n   */\n  blockTokens(src: string, tokens?: Token[], lastParagraphClipped?: boolean): Token[];\n  blockTokens(src: string, tokens?: TokensList, lastParagraphClipped?: boolean): TokensList;\n  blockTokens(src: string, tokens: Token[] = [], lastParagraphClipped = false) {\n    if (this.options.pedantic) {\n      src = src.replace(other.tabCharGlobal, '    ').replace(other.spaceLine, '');\n    }\n\n    while (src) {\n      let token: Tokens.Generic | undefined;\n\n      if (this.options.extensions?.block?.some((extTokenizer) => {\n        if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          return true;\n        }\n        return false;\n      })) {\n        continue;\n      }\n\n      // newline\n      if (token = this.tokenizer.space(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (token.raw.length === 1 && lastToken !== undefined) {\n          // if there's a single \\n as a spacer, it's terminating the last line,\n          // so move it there so that we don't get unnecessary paragraph tags\n          lastToken.raw += '\\n';\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.code(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        // An indented code block cannot interrupt a paragraph.\n        if (lastToken?.type === 'paragraph' || lastToken?.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // fences\n      if (token = this.tokenizer.fences(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // heading\n      if (token = this.tokenizer.heading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // hr\n      if (token = this.tokenizer.hr(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // blockquote\n      if (token = this.tokenizer.blockquote(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // list\n      if (token = this.tokenizer.list(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // html\n      if (token = this.tokenizer.html(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // def\n      if (token = this.tokenizer.def(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'paragraph' || lastToken?.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.raw;\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else if (!this.tokens.links[token.tag]) {\n          this.tokens.links[token.tag] = {\n            href: token.href,\n            title: token.title,\n          };\n        }\n        continue;\n      }\n\n      // table (gfm)\n      if (token = this.tokenizer.table(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // lheading\n      if (token = this.tokenizer.lheading(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // top-level paragraph\n      // prevent paragraph consuming extensions by clipping 'src' to extension start\n      let cutSrc = src;\n      if (this.options.extensions?.startBlock) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startBlock.forEach((getStartIndex) => {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) {\n            startIndex = Math.min(startIndex, tempStart);\n          }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (this.state.top && (token = this.tokenizer.paragraph(cutSrc))) {\n        const lastToken = tokens.at(-1);\n        if (lastParagraphClipped && lastToken?.type === 'paragraph') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        lastParagraphClipped = cutSrc.length !== src.length;\n        src = src.substring(token.raw.length);\n        continue;\n      }\n\n      // text\n      if (token = this.tokenizer.text(src)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'text') {\n          lastToken.raw += '\\n' + token.raw;\n          lastToken.text += '\\n' + token.text;\n          this.inlineQueue.pop();\n          this.inlineQueue.at(-1)!.src = lastToken.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    this.state.top = true;\n    return tokens;\n  }\n\n  inline(src: string, tokens: Token[] = []) {\n    this.inlineQueue.push({ src, tokens });\n    return tokens;\n  }\n\n  /**\n   * Lexing/Compiling\n   */\n  inlineTokens(src: string, tokens: Token[] = []): Token[] {\n    // String with links masked to avoid interference with em and strong\n    let maskedSrc = src;\n    let match: RegExpExecArray | null = null;\n\n    // Mask out reflinks\n    if (this.tokens.links) {\n      const links = Object.keys(this.tokens.links);\n      if (links.length > 0) {\n        while ((match = this.tokenizer.rules.inline.reflinkSearch.exec(maskedSrc)) != null) {\n          if (links.includes(match[0].slice(match[0].lastIndexOf('[') + 1, -1))) {\n            maskedSrc = maskedSrc.slice(0, match.index)\n              + '[' + 'a'.repeat(match[0].length - 2) + ']'\n              + maskedSrc.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex);\n          }\n        }\n      }\n    }\n\n    // Mask out escaped characters\n    while ((match = this.tokenizer.rules.inline.anyPunctuation.exec(maskedSrc)) != null) {\n      maskedSrc = maskedSrc.slice(0, match.index) + '++' + maskedSrc.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);\n    }\n\n    // Mask out other blocks\n    while ((match = this.tokenizer.rules.inline.blockSkip.exec(maskedSrc)) != null) {\n      maskedSrc = maskedSrc.slice(0, match.index) + '[' + 'a'.repeat(match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);\n    }\n\n    let keepPrevChar = false;\n    let prevChar = '';\n    while (src) {\n      if (!keepPrevChar) {\n        prevChar = '';\n      }\n      keepPrevChar = false;\n\n      let token: Tokens.Generic | undefined;\n\n      // extensions\n      if (this.options.extensions?.inline?.some((extTokenizer) => {\n        if (token = extTokenizer.call({ lexer: this }, src, tokens)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          return true;\n        }\n        return false;\n      })) {\n        continue;\n      }\n\n      // escape\n      if (token = this.tokenizer.escape(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // tag\n      if (token = this.tokenizer.tag(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // link\n      if (token = this.tokenizer.link(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // reflink, nolink\n      if (token = this.tokenizer.reflink(src, this.tokens.links)) {\n        src = src.substring(token.raw.length);\n        const lastToken = tokens.at(-1);\n        if (token.type === 'text' && lastToken?.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      // em & strong\n      if (token = this.tokenizer.emStrong(src, maskedSrc, prevChar)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // code\n      if (token = this.tokenizer.codespan(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // br\n      if (token = this.tokenizer.br(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // del (gfm)\n      if (token = this.tokenizer.del(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // autolink\n      if (token = this.tokenizer.autolink(src)) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // url (gfm)\n      if (!this.state.inLink && (token = this.tokenizer.url(src))) {\n        src = src.substring(token.raw.length);\n        tokens.push(token);\n        continue;\n      }\n\n      // text\n      // prevent inlineText consuming extensions by clipping 'src' to extension start\n      let cutSrc = src;\n      if (this.options.extensions?.startInline) {\n        let startIndex = Infinity;\n        const tempSrc = src.slice(1);\n        let tempStart;\n        this.options.extensions.startInline.forEach((getStartIndex) => {\n          tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n          if (typeof tempStart === 'number' && tempStart >= 0) {\n            startIndex = Math.min(startIndex, tempStart);\n          }\n        });\n        if (startIndex < Infinity && startIndex >= 0) {\n          cutSrc = src.substring(0, startIndex + 1);\n        }\n      }\n      if (token = this.tokenizer.inlineText(cutSrc)) {\n        src = src.substring(token.raw.length);\n        if (token.raw.slice(-1) !== '_') { // Track prevChar before string of ____ started\n          prevChar = token.raw.slice(-1);\n        }\n        keepPrevChar = true;\n        const lastToken = tokens.at(-1);\n        if (lastToken?.type === 'text') {\n          lastToken.raw += token.raw;\n          lastToken.text += token.text;\n        } else {\n          tokens.push(token);\n        }\n        continue;\n      }\n\n      if (src) {\n        const errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n        if (this.options.silent) {\n          console.error(errMsg);\n          break;\n        } else {\n          throw new Error(errMsg);\n        }\n      }\n    }\n\n    return tokens;\n  }\n}\n", "import { _defaults } from './defaults.ts';\nimport {\n  cleanUrl,\n  escape,\n} from './helpers.ts';\nimport { other } from './rules.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\nimport type { Tokens } from './Tokens.ts';\nimport type { _Parser } from './Parser.ts';\n\n/**\n * Renderer\n */\nexport class _Renderer {\n  options: MarkedOptions;\n  parser!: _Parser; // set by the parser\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n  }\n\n  space(token: Tokens.Space): string {\n    return '';\n  }\n\n  code({ text, lang, escaped }: Tokens.Code): string {\n    const langString = (lang || '').match(other.notSpaceStart)?.[0];\n\n    const code = text.replace(other.endingNewline, '') + '\\n';\n\n    if (!langString) {\n      return '<pre><code>'\n        + (escaped ? code : escape(code, true))\n        + '</code></pre>\\n';\n    }\n\n    return '<pre><code class=\"language-'\n      + escape(langString)\n      + '\">'\n      + (escaped ? code : escape(code, true))\n      + '</code></pre>\\n';\n  }\n\n  blockquote({ tokens }: Tokens.Blockquote): string {\n    const body = this.parser.parse(tokens);\n    return `<blockquote>\\n${body}</blockquote>\\n`;\n  }\n\n  html({ text }: Tokens.HTML | Tokens.Tag) : string {\n    return text;\n  }\n\n  heading({ tokens, depth }: Tokens.Heading): string {\n    return `<h${depth}>${this.parser.parseInline(tokens)}</h${depth}>\\n`;\n  }\n\n  hr(token: Tokens.Hr): string {\n    return '<hr>\\n';\n  }\n\n  list(token: Tokens.List): string {\n    const ordered = token.ordered;\n    const start = token.start;\n\n    let body = '';\n    for (let j = 0; j < token.items.length; j++) {\n      const item = token.items[j];\n      body += this.listitem(item);\n    }\n\n    const type = ordered ? 'ol' : 'ul';\n    const startAttr = (ordered && start !== 1) ? (' start=\"' + start + '\"') : '';\n    return '<' + type + startAttr + '>\\n' + body + '</' + type + '>\\n';\n  }\n\n  listitem(item: Tokens.ListItem): string {\n    let itemBody = '';\n    if (item.task) {\n      const checkbox = this.checkbox({ checked: !!item.checked });\n      if (item.loose) {\n        if (item.tokens[0]?.type === 'paragraph') {\n          item.tokens[0].text = checkbox + ' ' + item.tokens[0].text;\n          if (item.tokens[0].tokens && item.tokens[0].tokens.length > 0 && item.tokens[0].tokens[0].type === 'text') {\n            item.tokens[0].tokens[0].text = checkbox + ' ' + escape(item.tokens[0].tokens[0].text);\n            item.tokens[0].tokens[0].escaped = true;\n          }\n        } else {\n          item.tokens.unshift({\n            type: 'text',\n            raw: checkbox + ' ',\n            text: checkbox + ' ',\n            escaped: true,\n          });\n        }\n      } else {\n        itemBody += checkbox + ' ';\n      }\n    }\n\n    itemBody += this.parser.parse(item.tokens, !!item.loose);\n\n    return `<li>${itemBody}</li>\\n`;\n  }\n\n  checkbox({ checked }: Tokens.Checkbox): string {\n    return '<input '\n      + (checked ? 'checked=\"\" ' : '')\n      + 'disabled=\"\" type=\"checkbox\">';\n  }\n\n  paragraph({ tokens }: Tokens.Paragraph): string {\n    return `<p>${this.parser.parseInline(tokens)}</p>\\n`;\n  }\n\n  table(token: Tokens.Table): string {\n    let header = '';\n\n    // header\n    let cell = '';\n    for (let j = 0; j < token.header.length; j++) {\n      cell += this.tablecell(token.header[j]);\n    }\n    header += this.tablerow({ text: cell });\n\n    let body = '';\n    for (let j = 0; j < token.rows.length; j++) {\n      const row = token.rows[j];\n\n      cell = '';\n      for (let k = 0; k < row.length; k++) {\n        cell += this.tablecell(row[k]);\n      }\n\n      body += this.tablerow({ text: cell });\n    }\n    if (body) body = `<tbody>${body}</tbody>`;\n\n    return '<table>\\n'\n      + '<thead>\\n'\n      + header\n      + '</thead>\\n'\n      + body\n      + '</table>\\n';\n  }\n\n  tablerow({ text }: Tokens.TableRow): string {\n    return `<tr>\\n${text}</tr>\\n`;\n  }\n\n  tablecell(token: Tokens.TableCell): string {\n    const content = this.parser.parseInline(token.tokens);\n    const type = token.header ? 'th' : 'td';\n    const tag = token.align\n      ? `<${type} align=\"${token.align}\">`\n      : `<${type}>`;\n    return tag + content + `</${type}>\\n`;\n  }\n\n  /**\n   * span level renderer\n   */\n  strong({ tokens }: Tokens.Strong): string {\n    return `<strong>${this.parser.parseInline(tokens)}</strong>`;\n  }\n\n  em({ tokens }: Tokens.Em): string {\n    return `<em>${this.parser.parseInline(tokens)}</em>`;\n  }\n\n  codespan({ text }: Tokens.Codespan): string {\n    return `<code>${escape(text, true)}</code>`;\n  }\n\n  br(token: Tokens.Br): string {\n    return '<br>';\n  }\n\n  del({ tokens }: Tokens.Del): string {\n    return `<del>${this.parser.parseInline(tokens)}</del>`;\n  }\n\n  link({ href, title, tokens }: Tokens.Link): string {\n    const text = this.parser.parseInline(tokens);\n    const cleanHref = cleanUrl(href);\n    if (cleanHref === null) {\n      return text;\n    }\n    href = cleanHref;\n    let out = '<a href=\"' + href + '\"';\n    if (title) {\n      out += ' title=\"' + (escape(title)) + '\"';\n    }\n    out += '>' + text + '</a>';\n    return out;\n  }\n\n  image({ href, title, text, tokens }: Tokens.Image): string {\n    if (tokens) {\n      text = this.parser.parseInline(tokens, this.parser.textRenderer);\n    }\n    const cleanHref = cleanUrl(href);\n    if (cleanHref === null) {\n      return escape(text);\n    }\n    href = cleanHref;\n\n    let out = `<img src=\"${href}\" alt=\"${text}\"`;\n    if (title) {\n      out += ` title=\"${escape(title)}\"`;\n    }\n    out += '>';\n    return out;\n  }\n\n  text(token: Tokens.Text | Tokens.Escape) : string {\n    return 'tokens' in token && token.tokens\n      ? this.parser.parseInline(token.tokens)\n      : ('escaped' in token && token.escaped ? token.text : escape(token.text));\n  }\n}\n", "import type { Tokens } from './Tokens.ts';\n\n/**\n * TextRenderer\n * returns only the textual part of the token\n */\nexport class _TextRenderer {\n  // no need for block level renderers\n  strong({ text }: Tokens.Strong) {\n    return text;\n  }\n\n  em({ text }: Tokens.Em) {\n    return text;\n  }\n\n  codespan({ text }: Tokens.Codespan) {\n    return text;\n  }\n\n  del({ text }: Tokens.Del) {\n    return text;\n  }\n\n  html({ text }: Tokens.HTML | Tokens.Tag) {\n    return text;\n  }\n\n  text({ text }: Tokens.Text | Tokens.Escape | Tokens.Tag) {\n    return text;\n  }\n\n  link({ text }: Tokens.Link) {\n    return '' + text;\n  }\n\n  image({ text }: Tokens.Image) {\n    return '' + text;\n  }\n\n  br() {\n    return '';\n  }\n}\n", "import { _Renderer } from './Renderer.ts';\nimport { _TextRenderer } from './TextRenderer.ts';\nimport { _defaults } from './defaults.ts';\nimport type { MarkedToken, Token, Tokens } from './Tokens.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\n\n/**\n * Parsing & Compiling\n */\nexport class _Parser {\n  options: MarkedOptions;\n  renderer: _Renderer;\n  textRenderer: _TextRenderer;\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n    this.options.renderer = this.options.renderer || new _Renderer();\n    this.renderer = this.options.renderer;\n    this.renderer.options = this.options;\n    this.renderer.parser = this;\n    this.textRenderer = new _TextRenderer();\n  }\n\n  /**\n   * Static Parse Method\n   */\n  static parse(tokens: Token[], options?: MarkedOptions) {\n    const parser = new _Parser(options);\n    return parser.parse(tokens);\n  }\n\n  /**\n   * Static Parse Inline Method\n   */\n  static parseInline(tokens: Token[], options?: MarkedOptions) {\n    const parser = new _Parser(options);\n    return parser.parseInline(tokens);\n  }\n\n  /**\n   * Parse Loop\n   */\n  parse(tokens: Token[], top = true): string {\n    let out = '';\n\n    for (let i = 0; i < tokens.length; i++) {\n      const anyToken = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions?.renderers?.[anyToken.type]) {\n        const genericToken = anyToken as Tokens.Generic;\n        const ret = this.options.extensions.renderers[genericToken.type].call({ parser: this }, genericToken);\n        if (ret !== false || !['space', 'hr', 'heading', 'code', 'table', 'blockquote', 'list', 'html', 'paragraph', 'text'].includes(genericToken.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      const token = anyToken as MarkedToken;\n\n      switch (token.type) {\n        case 'space': {\n          out += this.renderer.space(token);\n          continue;\n        }\n        case 'hr': {\n          out += this.renderer.hr(token);\n          continue;\n        }\n        case 'heading': {\n          out += this.renderer.heading(token);\n          continue;\n        }\n        case 'code': {\n          out += this.renderer.code(token);\n          continue;\n        }\n        case 'table': {\n          out += this.renderer.table(token);\n          continue;\n        }\n        case 'blockquote': {\n          out += this.renderer.blockquote(token);\n          continue;\n        }\n        case 'list': {\n          out += this.renderer.list(token);\n          continue;\n        }\n        case 'html': {\n          out += this.renderer.html(token);\n          continue;\n        }\n        case 'paragraph': {\n          out += this.renderer.paragraph(token);\n          continue;\n        }\n        case 'text': {\n          let textToken = token;\n          let body = this.renderer.text(textToken);\n          while (i + 1 < tokens.length && tokens[i + 1].type === 'text') {\n            textToken = tokens[++i] as Tokens.Text;\n            body += '\\n' + this.renderer.text(textToken);\n          }\n          if (top) {\n            out += this.renderer.paragraph({\n              type: 'paragraph',\n              raw: body,\n              text: body,\n              tokens: [{ type: 'text', raw: body, text: body, escaped: true }],\n            });\n          } else {\n            out += body;\n          }\n          continue;\n        }\n\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return '';\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n\n    return out;\n  }\n\n  /**\n   * Parse Inline Tokens\n   */\n  parseInline(tokens: Token[], renderer: _Renderer | _TextRenderer = this.renderer): string {\n    let out = '';\n\n    for (let i = 0; i < tokens.length; i++) {\n      const anyToken = tokens[i];\n\n      // Run any renderer extensions\n      if (this.options.extensions?.renderers?.[anyToken.type]) {\n        const ret = this.options.extensions.renderers[anyToken.type].call({ parser: this }, anyToken);\n        if (ret !== false || !['escape', 'html', 'link', 'image', 'strong', 'em', 'codespan', 'br', 'del', 'text'].includes(anyToken.type)) {\n          out += ret || '';\n          continue;\n        }\n      }\n\n      const token = anyToken as MarkedToken;\n\n      switch (token.type) {\n        case 'escape': {\n          out += renderer.text(token);\n          break;\n        }\n        case 'html': {\n          out += renderer.html(token);\n          break;\n        }\n        case 'link': {\n          out += renderer.link(token);\n          break;\n        }\n        case 'image': {\n          out += renderer.image(token);\n          break;\n        }\n        case 'strong': {\n          out += renderer.strong(token);\n          break;\n        }\n        case 'em': {\n          out += renderer.em(token);\n          break;\n        }\n        case 'codespan': {\n          out += renderer.codespan(token);\n          break;\n        }\n        case 'br': {\n          out += renderer.br(token);\n          break;\n        }\n        case 'del': {\n          out += renderer.del(token);\n          break;\n        }\n        case 'text': {\n          out += renderer.text(token);\n          break;\n        }\n        default: {\n          const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n          if (this.options.silent) {\n            console.error(errMsg);\n            return '';\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n    }\n    return out;\n  }\n}\n", "import { _defaults } from './defaults.ts';\nimport { _Lexer } from './Lexer.ts';\nimport { _Parser } from './Parser.ts';\nimport type { MarkedOptions } from './MarkedOptions.ts';\nimport type { Token, TokensList } from './Tokens.ts';\n\nexport class _Hooks {\n  options: MarkedOptions;\n  block?: boolean;\n\n  constructor(options?: MarkedOptions) {\n    this.options = options || _defaults;\n  }\n\n  static passThroughHooks = new Set([\n    'preprocess',\n    'postprocess',\n    'processAllTokens',\n  ]);\n\n  /**\n   * Process markdown before marked\n   */\n  preprocess(markdown: string) {\n    return markdown;\n  }\n\n  /**\n   * Process HTML after marked is finished\n   */\n  postprocess(html: string) {\n    return html;\n  }\n\n  /**\n   * Process all tokens before walk tokens\n   */\n  processAllTokens(tokens: Token[] | TokensList) {\n    return tokens;\n  }\n\n  /**\n   * Provide function to tokenize markdown\n   */\n  provideLexer() {\n    return this.block ? _Lexer.lex : _Lexer.lexInline;\n  }\n\n  /**\n   * Provide function to parse tokens\n   */\n  provideParser() {\n    return this.block ? _Parser.parse : _Parser.parseInline;\n  }\n}\n", "import { _getDefaults } from './defaults.ts';\nimport { _Lexer } from './Lexer.ts';\nimport { _Parser } from './Parser.ts';\nimport { _Hooks } from './Hooks.ts';\nimport { _Renderer } from './Renderer.ts';\nimport { _Tokenizer } from './Tokenizer.ts';\nimport { _TextRenderer } from './TextRenderer.ts';\nimport { escape } from './helpers.ts';\nimport type { MarkedExtension, MarkedOptions } from './MarkedOptions.ts';\nimport type { Token, Tokens, TokensList } from './Tokens.ts';\n\nexport type MaybePromise = void | Promise<void>;\n\ntype UnknownFunction = (...args: unknown[]) => unknown;\ntype GenericRendererFunction = (...args: unknown[]) => string | false;\n\nexport class Marked {\n  defaults = _getDefaults();\n  options = this.setOptions;\n\n  parse = this.parseMarkdown(true);\n  parseInline = this.parseMarkdown(false);\n\n  Parser = _Parser;\n  Renderer = _Renderer;\n  TextRenderer = _TextRenderer;\n  Lexer = _Lexer;\n  Tokenizer = _Tokenizer;\n  Hooks = _Hooks;\n\n  constructor(...args: MarkedExtension[]) {\n    this.use(...args);\n  }\n\n  /**\n   * Run callback for every token\n   */\n  walkTokens(tokens: Token[] | TokensList, callback: (token: Token) => MaybePromise | MaybePromise[]) {\n    let values: MaybePromise[] = [];\n    for (const token of tokens) {\n      values = values.concat(callback.call(this, token));\n      switch (token.type) {\n        case 'table': {\n          const tableToken = token as Tokens.Table;\n          for (const cell of tableToken.header) {\n            values = values.concat(this.walkTokens(cell.tokens, callback));\n          }\n          for (const row of tableToken.rows) {\n            for (const cell of row) {\n              values = values.concat(this.walkTokens(cell.tokens, callback));\n            }\n          }\n          break;\n        }\n        case 'list': {\n          const listToken = token as Tokens.List;\n          values = values.concat(this.walkTokens(listToken.items, callback));\n          break;\n        }\n        default: {\n          const genericToken = token as Tokens.Generic;\n          if (this.defaults.extensions?.childTokens?.[genericToken.type]) {\n            this.defaults.extensions.childTokens[genericToken.type].forEach((childTokens) => {\n              const tokens = genericToken[childTokens].flat(Infinity) as Token[] | TokensList;\n              values = values.concat(this.walkTokens(tokens, callback));\n            });\n          } else if (genericToken.tokens) {\n            values = values.concat(this.walkTokens(genericToken.tokens, callback));\n          }\n        }\n      }\n    }\n    return values;\n  }\n\n  use(...args: MarkedExtension[]) {\n    const extensions: MarkedOptions['extensions'] = this.defaults.extensions || { renderers: {}, childTokens: {} };\n\n    args.forEach((pack) => {\n      // copy options to new object\n      const opts = { ...pack } as MarkedOptions;\n\n      // set async to true if it was set to true before\n      opts.async = this.defaults.async || opts.async || false;\n\n      // ==-- Parse \"addon\" extensions --== //\n      if (pack.extensions) {\n        pack.extensions.forEach((ext) => {\n          if (!ext.name) {\n            throw new Error('extension name required');\n          }\n          if ('renderer' in ext) { // Renderer extensions\n            const prevRenderer = extensions.renderers[ext.name];\n            if (prevRenderer) {\n              // Replace extension with func to run new extension but fall back if false\n              extensions.renderers[ext.name] = function(...args) {\n                let ret = ext.renderer.apply(this, args);\n                if (ret === false) {\n                  ret = prevRenderer.apply(this, args);\n                }\n                return ret;\n              };\n            } else {\n              extensions.renderers[ext.name] = ext.renderer;\n            }\n          }\n          if ('tokenizer' in ext) { // Tokenizer Extensions\n            if (!ext.level || (ext.level !== 'block' && ext.level !== 'inline')) {\n              throw new Error(\"extension level must be 'block' or 'inline'\");\n            }\n            const extLevel = extensions[ext.level];\n            if (extLevel) {\n              extLevel.unshift(ext.tokenizer);\n            } else {\n              extensions[ext.level] = [ext.tokenizer];\n            }\n            if (ext.start) { // Function to check for start of token\n              if (ext.level === 'block') {\n                if (extensions.startBlock) {\n                  extensions.startBlock.push(ext.start);\n                } else {\n                  extensions.startBlock = [ext.start];\n                }\n              } else if (ext.level === 'inline') {\n                if (extensions.startInline) {\n                  extensions.startInline.push(ext.start);\n                } else {\n                  extensions.startInline = [ext.start];\n                }\n              }\n            }\n          }\n          if ('childTokens' in ext && ext.childTokens) { // Child tokens to be visited by walkTokens\n            extensions.childTokens[ext.name] = ext.childTokens;\n          }\n        });\n        opts.extensions = extensions;\n      }\n\n      // ==-- Parse \"overwrite\" extensions --== //\n      if (pack.renderer) {\n        const renderer = this.defaults.renderer || new _Renderer(this.defaults);\n        for (const prop in pack.renderer) {\n          if (!(prop in renderer)) {\n            throw new Error(`renderer '${prop}' does not exist`);\n          }\n          if (['options', 'parser'].includes(prop)) {\n            // ignore options property\n            continue;\n          }\n          const rendererProp = prop as Exclude<keyof _Renderer, 'options' | 'parser'>;\n          const rendererFunc = pack.renderer[rendererProp] as GenericRendererFunction;\n          const prevRenderer = renderer[rendererProp] as GenericRendererFunction;\n          // Replace renderer with func to run extension, but fall back if false\n          renderer[rendererProp] = (...args: unknown[]) => {\n            let ret = rendererFunc.apply(renderer, args);\n            if (ret === false) {\n              ret = prevRenderer.apply(renderer, args);\n            }\n            return ret || '';\n          };\n        }\n        opts.renderer = renderer;\n      }\n      if (pack.tokenizer) {\n        const tokenizer = this.defaults.tokenizer || new _Tokenizer(this.defaults);\n        for (const prop in pack.tokenizer) {\n          if (!(prop in tokenizer)) {\n            throw new Error(`tokenizer '${prop}' does not exist`);\n          }\n          if (['options', 'rules', 'lexer'].includes(prop)) {\n            // ignore options, rules, and lexer properties\n            continue;\n          }\n          const tokenizerProp = prop as Exclude<keyof _Tokenizer, 'options' | 'rules' | 'lexer'>;\n          const tokenizerFunc = pack.tokenizer[tokenizerProp] as UnknownFunction;\n          const prevTokenizer = tokenizer[tokenizerProp] as UnknownFunction;\n          // Replace tokenizer with func to run extension, but fall back if false\n          // @ts-expect-error cannot type tokenizer function dynamically\n          tokenizer[tokenizerProp] = (...args: unknown[]) => {\n            let ret = tokenizerFunc.apply(tokenizer, args);\n            if (ret === false) {\n              ret = prevTokenizer.apply(tokenizer, args);\n            }\n            return ret;\n          };\n        }\n        opts.tokenizer = tokenizer;\n      }\n\n      // ==-- Parse Hooks extensions --== //\n      if (pack.hooks) {\n        const hooks = this.defaults.hooks || new _Hooks();\n        for (const prop in pack.hooks) {\n          if (!(prop in hooks)) {\n            throw new Error(`hook '${prop}' does not exist`);\n          }\n          if (['options', 'block'].includes(prop)) {\n            // ignore options and block properties\n            continue;\n          }\n          const hooksProp = prop as Exclude<keyof _Hooks, 'options' | 'block'>;\n          const hooksFunc = pack.hooks[hooksProp] as UnknownFunction;\n          const prevHook = hooks[hooksProp] as UnknownFunction;\n          if (_Hooks.passThroughHooks.has(prop)) {\n            // @ts-expect-error cannot type hook function dynamically\n            hooks[hooksProp] = (arg: unknown) => {\n              if (this.defaults.async) {\n                return Promise.resolve(hooksFunc.call(hooks, arg)).then(ret => {\n                  return prevHook.call(hooks, ret);\n                });\n              }\n\n              const ret = hooksFunc.call(hooks, arg);\n              return prevHook.call(hooks, ret);\n            };\n          } else {\n            // @ts-expect-error cannot type hook function dynamically\n            hooks[hooksProp] = (...args: unknown[]) => {\n              let ret = hooksFunc.apply(hooks, args);\n              if (ret === false) {\n                ret = prevHook.apply(hooks, args);\n              }\n              return ret;\n            };\n          }\n        }\n        opts.hooks = hooks;\n      }\n\n      // ==-- Parse WalkTokens extensions --== //\n      if (pack.walkTokens) {\n        const walkTokens = this.defaults.walkTokens;\n        const packWalktokens = pack.walkTokens;\n        opts.walkTokens = function(token) {\n          let values: MaybePromise[] = [];\n          values.push(packWalktokens.call(this, token));\n          if (walkTokens) {\n            values = values.concat(walkTokens.call(this, token));\n          }\n          return values;\n        };\n      }\n\n      this.defaults = { ...this.defaults, ...opts };\n    });\n\n    return this;\n  }\n\n  setOptions(opt: MarkedOptions) {\n    this.defaults = { ...this.defaults, ...opt };\n    return this;\n  }\n\n  lexer(src: string, options?: MarkedOptions) {\n    return _Lexer.lex(src, options ?? this.defaults);\n  }\n\n  parser(tokens: Token[], options?: MarkedOptions) {\n    return _Parser.parse(tokens, options ?? this.defaults);\n  }\n\n  private parseMarkdown(blockType: boolean) {\n    type overloadedParse = {\n      (src: string, options: MarkedOptions & { async: true }): Promise<string>;\n      (src: string, options: MarkedOptions & { async: false }): string;\n      (src: string, options?: MarkedOptions | null): string | Promise<string>;\n    };\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const parse: overloadedParse = (src: string, options?: MarkedOptions | null): any => {\n      const origOpt = { ...options };\n      const opt = { ...this.defaults, ...origOpt };\n\n      const throwError = this.onError(!!opt.silent, !!opt.async);\n\n      // throw error if an extension set async to true but parse was called with async: false\n      if (this.defaults.async === true && origOpt.async === false) {\n        return throwError(new Error('marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise.'));\n      }\n\n      // throw error in case of non string input\n      if (typeof src === 'undefined' || src === null) {\n        return throwError(new Error('marked(): input parameter is undefined or null'));\n      }\n      if (typeof src !== 'string') {\n        return throwError(new Error('marked(): input parameter is of type '\n          + Object.prototype.toString.call(src) + ', string expected'));\n      }\n\n      if (opt.hooks) {\n        opt.hooks.options = opt;\n        opt.hooks.block = blockType;\n      }\n\n      const lexer = opt.hooks ? opt.hooks.provideLexer() : (blockType ? _Lexer.lex : _Lexer.lexInline);\n      const parser = opt.hooks ? opt.hooks.provideParser() : (blockType ? _Parser.parse : _Parser.parseInline);\n\n      if (opt.async) {\n        return Promise.resolve(opt.hooks ? opt.hooks.preprocess(src) : src)\n          .then(src => lexer(src, opt))\n          .then(tokens => opt.hooks ? opt.hooks.processAllTokens(tokens) : tokens)\n          .then(tokens => opt.walkTokens ? Promise.all(this.walkTokens(tokens, opt.walkTokens)).then(() => tokens) : tokens)\n          .then(tokens => parser(tokens, opt))\n          .then(html => opt.hooks ? opt.hooks.postprocess(html) : html)\n          .catch(throwError);\n      }\n\n      try {\n        if (opt.hooks) {\n          src = opt.hooks.preprocess(src) as string;\n        }\n        let tokens = lexer(src, opt);\n        if (opt.hooks) {\n          tokens = opt.hooks.processAllTokens(tokens);\n        }\n        if (opt.walkTokens) {\n          this.walkTokens(tokens, opt.walkTokens);\n        }\n        let html = parser(tokens, opt);\n        if (opt.hooks) {\n          html = opt.hooks.postprocess(html) as string;\n        }\n        return html;\n      } catch (e) {\n        return throwError(e as Error);\n      }\n    };\n\n    return parse;\n  }\n\n  private onError(silent: boolean, async: boolean) {\n    return (e: Error): string | Promise<string> => {\n      e.message += '\\nPlease report this to https://github.com/markedjs/marked.';\n\n      if (silent) {\n        const msg = '<p>An error occurred:</p><pre>'\n          + escape(e.message + '', true)\n          + '</pre>';\n        if (async) {\n          return Promise.resolve(msg);\n        }\n        return msg;\n      }\n\n      if (async) {\n        return Promise.reject(e);\n      }\n      throw e;\n    };\n  }\n}\n", "import { _Lexer } from './Lexer.ts';\nimport { _Parser } from './Parser.ts';\nimport { _Tokenizer } from './Tokenizer.ts';\nimport { _Renderer } from './Renderer.ts';\nimport { _TextRenderer } from './TextRenderer.ts';\nimport { _Hooks } from './Hooks.ts';\nimport { Marked } from './Instance.ts';\nimport {\n  _getDefaults,\n  changeDefaults,\n  _defaults,\n} from './defaults.ts';\nimport type { MarkedExtension, MarkedOptions } from './MarkedOptions.ts';\nimport type { Token, TokensList } from './Tokens.ts';\nimport type { MaybePromise } from './Instance.ts';\n\nconst markedInstance = new Marked();\n\n/**\n * Compiles markdown to HTML asynchronously.\n *\n * @param src String of markdown source to be compiled\n * @param options Hash of options, having async: true\n * @return Promise of string of compiled HTML\n */\nexport function marked(src: string, options: MarkedOptions & { async: true }): Promise<string>;\n\n/**\n * Compiles markdown to HTML.\n *\n * @param src String of markdown source to be compiled\n * @param options Optional hash of options\n * @return String of compiled HTML. Will be a Promise of string if async is set to true by any extensions.\n */\nexport function marked(src: string, options: MarkedOptions & { async: false }): string;\nexport function marked(src: string, options: MarkedOptions & { async: true }): Promise<string>;\nexport function marked(src: string, options?: MarkedOptions | null): string | Promise<string>;\nexport function marked(src: string, opt?: MarkedOptions | null): string | Promise<string> {\n  return markedInstance.parse(src, opt);\n}\n\n/**\n * Sets the default options.\n *\n * @param options Hash of options\n */\nmarked.options =\nmarked.setOptions = function(options: MarkedOptions) {\n  markedInstance.setOptions(options);\n  marked.defaults = markedInstance.defaults;\n  changeDefaults(marked.defaults);\n  return marked;\n};\n\n/**\n * Gets the original marked default options.\n */\nmarked.getDefaults = _getDefaults;\n\nmarked.defaults = _defaults;\n\n/**\n * Use Extension\n */\n\nmarked.use = function(...args: MarkedExtension[]) {\n  markedInstance.use(...args);\n  marked.defaults = markedInstance.defaults;\n  changeDefaults(marked.defaults);\n  return marked;\n};\n\n/**\n * Run callback for every token\n */\n\nmarked.walkTokens = function(tokens: Token[] | TokensList, callback: (token: Token) => MaybePromise | MaybePromise[]) {\n  return markedInstance.walkTokens(tokens, callback);\n};\n\n/**\n * Compiles markdown to HTML without enclosing `p` tag.\n *\n * @param src String of markdown source to be compiled\n * @param options Hash of options\n * @return String of compiled HTML\n */\nmarked.parseInline = markedInstance.parseInline;\n\n/**\n * Expose\n */\nmarked.Parser = _Parser;\nmarked.parser = _Parser.parse;\nmarked.Renderer = _Renderer;\nmarked.TextRenderer = _TextRenderer;\nmarked.Lexer = _Lexer;\nmarked.lexer = _Lexer.lex;\nmarked.Tokenizer = _Tokenizer;\nmarked.Hooks = _Hooks;\nmarked.parse = marked;\n\nexport const options = marked.options;\nexport const setOptions = marked.setOptions;\nexport const use = marked.use;\nexport const walkTokens = marked.walkTokens;\nexport const parseInline = marked.parseInline;\nexport const parse = marked;\nexport const parser = _Parser.parse;\nexport const lexer = _Lexer.lex;\nexport { _defaults as defaults, _getDefaults as getDefaults } from './defaults.ts';\nexport { _Lexer as Lexer } from './Lexer.ts';\nexport { _Parser as Parser } from './Parser.ts';\nexport { _Tokenizer as Tokenizer } from './Tokenizer.ts';\nexport { _Renderer as Renderer } from './Renderer.ts';\nexport { _TextRenderer as TextRenderer } from './TextRenderer.ts';\nexport { _Hooks as Hooks } from './Hooks.ts';\nexport { Marked } from './Instance.ts';\nexport type * from './MarkedOptions.ts';\nexport type * from './Tokens.ts';\n", "import { assertNever, isUrl, type Relax, sanitizeUrl } from \"@liveblocks/core\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport {\n  Lexer,\n  type MarkedToken,\n  type Token as DefaultToken,\n  type Tokens,\n} from \"marked\";\nimport {\n  type ComponentType,\n  forwardRef,\n  memo,\n  type ReactNode,\n  useMemo,\n} from \"react\";\n\nimport type { ComponentPropsWithSlot } from \"../types\";\n\nconst LIST_ITEM_CHECKBOX_REGEX = /^\\[\\s?(x)?\\]?$/i;\nconst PARTIAL_LINK_IMAGE_REGEX =\n  /(?<!\\\\)(?<image>!)?\\[(?!\\^)(?<text>[^\\]]*)(?:\\](?:\\((?<url>[^)]*)?)?)?$/;\nconst PARTIAL_TABLE_HEADER_REGEX =\n  /^\\s*\\|(?:[^|\\n]+(?:\\|[^|\\n]+)*?)?\\|?\\s*(?:\\n\\s*\\|\\s*[-:|\\s]*\\s*)?$/;\nconst PARTIAL_EMOJI_REGEX =\n  /(?:\\u200D|\\uFE0F|\\u20E3|\\p{Regional_Indicator}|\\p{Emoji_Presentation}|\\p{Emoji_Modifier_Base}|\\p{Emoji_Modifier})+$/u;\nconst TRAILING_NON_WHITESPACE_REGEX = /^\\S*/;\nconst WHITESPACE_REGEX = /\\s/;\nconst NEWLINE_REGEX = /\\r\\n?/g;\nconst BUFFERED_CHARACTERS_REGEX =\n  /(?<!\\\\)((\\*+|_+|~+|`+|\\++|-{0,2}|={0,2}|\\\\|!|<\\/?)\\s*)$/;\nconst SINGLE_CHARACTER_REGEX = /^\\s*(\\S\\s*)$/;\nconst LEFT_ANGLE_BRACKET_REGEX = /</g;\nconst RIGHT_ANGLE_BRACKET_REGEX = />/g;\nconst AMPERSAND_REGEX = /&(?!#?[0-9A-Za-z]+;)/g;\nconst DEFAULT_PARTIAL_LINK_URL = \"#\";\n\ntype CheckboxToken = {\n  type: \"checkbox\";\n  checked: boolean;\n  raw: string;\n};\n\ntype Token = MarkedToken | CheckboxToken;\n\ntype AnyToken = Token | DefaultToken;\n\ntype PotentiallyPartialToken = Relax<\n  | Tokens.Text\n  | Tokens.Paragraph\n  | Tokens.Heading\n  | Tokens.Blockquote\n  | Tokens.ListItem\n  | Tokens.TableCell\n  | Tokens.Code\n>;\n\nexport type MarkdownComponents = {\n  /**\n   * The component used to render paragraphs.\n   *\n   * @example\n   * ```md\n   * A paragraph.\n   *\n   * Another paragraph.\n   * ```\n   * ```tsx\n   * <Markdown\n   *   components={{\n   *     Paragraph: ({ children }) => <p className=\"...\">{children}</p>\n   *   }}\n   * />\n   * ```\n   */\n  Paragraph: ComponentType<MarkdownComponentsParagraphProps>;\n\n  /**\n   * The component used to render inline elements (bold, italic, strikethrough, and inline code).\n   *\n   * @example\n   * ```md\n   * **Bold**, _italic_, ~~strikethrough~~, and `inline code`.\n   * ```\n   * ```tsx\n   * <Markdown\n   *   components={{\n   *     Inline: ({ type, children }) => {\n   *       const Component = type;\n   *       return <Component className=\"...\">{children}</Component>;\n   *     }\n   *   }}\n   * />\n   * ```\n   */\n  Inline: ComponentType<MarkdownComponentsInlineProps>;\n\n  /**\n   * The component used to render links.\n   *\n   * @example\n   * ```md\n   * A [link](https://liveblocks.io).\n   * ```\n   * ```tsx\n   * <Markdown\n   *   components={{\n   *     Link: ({ href, children }) => <a href={href} className=\"...\">{children}</a>\n   *   }}\n   * />\n   * ```\n   */\n  Link: ComponentType<MarkdownComponentsLinkProps>;\n\n  /**\n   * The component used to render headings.\n   *\n   * @example\n   * ```md\n   * # Heading 1\n   * ## Heading 2\n   * ### Heading 3\n   * ```\n   * ```tsx\n   * <Markdown\n   *   components={{\n   *     Heading: ({ level, children }) => {\n   *       const Heading = `h${level}` as const;\n   *       return <Heading className=\"...\">{children}</Heading>;\n   *     }\n   *   }}\n   * />\n   * ```\n   */\n  Heading: ComponentType<MarkdownComponentsHeadingProps>;\n\n  /**\n   * The component used to render blockquotes.\n   *\n   * @example\n   * ```md\n   * > A blockquote.\n   * ```\n   * ```tsx\n   * <Markdown\n   *   components={{\n   *     Blockquote: ({ children }) => <blockquote className=\"...\">{children}</blockquote>\n   *   }}\n   * />\n   * ```\n   */\n  Blockquote: ComponentType<MarkdownComponentsBlockquoteProps>;\n\n  /**\n   * The component used to render code blocks.\n   *\n   * @example\n   * ```md\n   * ```javascript\n   * const a = 1;\n   * ```\n   * ```\n   * ```tsx\n   * <Markdown\n   *   components={{\n   *     CodeBlock: ({ language, code }) => (\n   *       <pre data-language={language} className=\"...\">\n   *         <code className=\"...\">{code}</code>\n   *       </pre>\n   *     )\n   *   }}\n   * />\n   * ```\n   */\n  CodeBlock: ComponentType<MarkdownComponentsCodeBlockProps>;\n\n  /**\n   * The component used to render images.\n   *\n   * @example\n   * ```md\n   * ![An image](https://liveblocks.io/logo.svg)\n   * ```\n   * ```tsx\n   * <Markdown\n   *   components={{\n   *     Image: ({ src, alt }) => <img src={src} alt={alt} className=\"...\">\n   *   }}\n   * />\n   * ```\n   */\n  Image: ComponentType<MarkdownComponentsImageProps>;\n\n  /**\n   * The component used to render lists.\n   *\n   * @example\n   * ```md\n   * 1. An ordered list item\n   * - An unordered list item\n   * - [x] A checked list item\n   * ```\n   * ```tsx\n   * <Markdown\n   *   components={{\n   *     List: ({ type, items, start }) => {\n   *       const List = type === \"ordered\" ? \"ol\" : \"ul\";\n   *       return (\n   *         <List start={start}>\n   *           {items.map((item, index) => (\n   *             <li key={index}>\n   *               {item.children}\n   *             </li>\n   *           ))}\n   *         </List>\n   *       );\n   *     }\n   *   }}\n   * />\n   * ```\n   */\n  List: ComponentType<MarkdownComponentsListProps>;\n\n  /**\n   * The component used to render tables.\n   *\n   * @example\n   * ```md\n   * | Heading 1 | Heading 2 |\n   * |-----------|-----------|\n   * | Cell 1    | Cell 2    |\n   * | Cell 3    | Cell 4    |\n   * ```\n   * ```tsx\n   * <Markdown\n   *   components={{\n   *     Table: ({ headings, rows }) => (\n   *       <table>\n   *         <thead>\n   *           <tr>\n   *             {headings.map(({ children }, index) => (\n   *               <th key={index}>{children}</th>\n   *             ))}\n   *           </tr>\n   *         </thead>\n   *         <tbody>\n   *           {rows.map((row, index) => (\n   *             <tr key={index}>\n   *               {row.map(({ children }, index) => (\n   *                 <td key={index}>{children}</td>\n   *               ))}\n   *             </tr>\n   *           ))}\n   *         </tbody>\n   *       </table>\n   *     )\n   *   }}\n   * />\n   * ```\n   */\n  Table: ComponentType<MarkdownComponentsTableProps>;\n\n  /**\n   * The component used to render separators.\n   *\n   * @example\n   * ```md\n   * ---\n   * ```\n   * ```tsx\n   * <Markdown components={{ Separator: () => <hr className=\"...\" /> }} />\n   * ```\n   */\n  Separator: ComponentType;\n};\n\nexport interface MarkdownComponentsInlineProps {\n  type: \"strong\" | \"em\" | \"code\" | \"del\";\n  children: ReactNode;\n}\n\nexport interface MarkdownComponentsParagraphProps {\n  children: ReactNode;\n}\n\ninterface MarkdownComponentsTableCell {\n  align?: \"left\" | \"center\" | \"right\";\n  children: ReactNode;\n}\n\nexport interface MarkdownComponentsTableProps {\n  headings: MarkdownComponentsTableCell[];\n  rows: MarkdownComponentsTableCell[][];\n}\n\ninterface MarkdownComponentsListItem {\n  checked?: boolean;\n  children: ReactNode;\n}\n\nexport type MarkdownComponentsListProps = Relax<\n  MarkdownComponentsOrderedListProps | MarkdownComponentsUnorderedListProps\n>;\n\ninterface MarkdownComponentsOrderedListProps {\n  type: \"ordered\";\n  items: MarkdownComponentsListItem[];\n  start: number;\n}\n\ninterface MarkdownComponentsUnorderedListProps {\n  type: \"unordered\";\n  items: MarkdownComponentsListItem[];\n}\n\nexport interface MarkdownComponentsBlockquoteProps {\n  children: ReactNode;\n}\n\nexport interface MarkdownComponentsImageProps {\n  src: string;\n  alt: string;\n  title?: string;\n}\n\nexport interface MarkdownComponentsHeadingProps {\n  level: 1 | 2 | 3 | 4 | 5 | 6;\n  children: ReactNode;\n}\n\nexport interface MarkdownComponentsLinkProps {\n  href: string;\n  title?: string;\n  children: ReactNode;\n}\n\nexport interface MarkdownComponentsCodeBlockProps {\n  code: string;\n  language?: string;\n}\n\nexport interface MarkdownProps extends ComponentPropsWithSlot<\"div\"> {\n  content: string;\n  partial?: boolean;\n  components?: Partial<MarkdownComponents>;\n}\n\nconst defaultComponents: MarkdownComponents = {\n  Paragraph: ({ children }) => {\n    return <p>{children}</p>;\n  },\n  Inline: ({ type, children }) => {\n    switch (type) {\n      case \"strong\":\n        return <strong>{children}</strong>;\n      case \"em\":\n        return <em>{children}</em>;\n      case \"code\":\n        return <code>{children}</code>;\n      case \"del\":\n        return <del>{children}</del>;\n      default:\n        assertNever(type, \"Unknown inline type\");\n    }\n  },\n  CodeBlock: ({ language, code }) => {\n    return (\n      <pre data-language={language ?? undefined}>\n        <code>{code}</code>\n      </pre>\n    );\n  },\n  Link: ({ href, title, children }) => {\n    return (\n      <a href={href} title={title} target=\"_blank\" rel=\"noopener noreferrer\">\n        {children}\n      </a>\n    );\n  },\n  Heading: ({ level, children }) => {\n    const Heading = `h${level}` as const;\n\n    return <Heading>{children}</Heading>;\n  },\n  Image: ({ src, alt, title }) => {\n    return <img src={src} alt={alt} title={title} />;\n  },\n  Blockquote: ({ children }) => {\n    return <blockquote>{children}</blockquote>;\n  },\n  Table: ({ headings, rows }) => {\n    return (\n      <table>\n        <thead>\n          <tr>\n            {headings.map((heading, index) => {\n              return (\n                <th key={index} align={heading.align}>\n                  {heading.children}\n                </th>\n              );\n            })}\n          </tr>\n        </thead>\n        <tbody>\n          {rows.map((row, index) => {\n            return (\n              <tr key={index}>\n                {row.map((cell, index) => {\n                  return (\n                    <td key={index} align={cell.align}>\n                      {cell.children}\n                    </td>\n                  );\n                })}\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    );\n  },\n  List: ({ type, items, start }) => {\n    const List = type === \"ordered\" ? \"ol\" : \"ul\";\n\n    return (\n      <List start={start === 1 ? undefined : start}>\n        {items.map((item, index) => (\n          <li key={index}>{item.children}</li>\n        ))}\n      </List>\n    );\n  },\n  Separator: () => {\n    return <hr />;\n  },\n};\n\nexport const Markdown = forwardRef<HTMLDivElement, MarkdownProps>(\n  ({ content, partial, components, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"div\";\n    const tokens = useMemo(() => {\n      if (!content) {\n        return [];\n      }\n\n      return partial ? tokenizePartial(content) : tokenize(content);\n    }, [content, partial]);\n\n    return (\n      <Component {...props} ref={forwardedRef}>\n        {tokens.map((token, index) => {\n          return (\n            <MemoizedMarkdownToken\n              token={token}\n              key={index}\n              components={components}\n              partial={partial}\n            />\n          );\n        })}\n      </Component>\n    );\n  }\n);\n\nconst MemoizedMarkdownToken = memo(\n  ({\n    token,\n    components,\n  }: {\n    token: Token;\n    components?: Partial<MarkdownComponents>;\n    partial?: boolean;\n  }) => {\n    return <MarkdownToken token={token} components={components} />;\n  },\n  (previousProps, nextProps) => {\n    const previousToken = previousProps.token;\n    const nextToken = nextProps.token;\n\n    // 1 Start with the fastest comparisons\n    if (\n      previousToken.type !== nextToken.type ||\n      previousProps.partial !== nextProps.partial\n    ) {\n      return false;\n    }\n\n    let previousContent = previousToken.raw;\n    let nextContent = nextToken.raw;\n\n    if (\"text\" in previousToken && \"text\" in nextToken) {\n      previousContent = previousToken.text;\n      nextContent = nextToken.text;\n    }\n\n    // 2 Then only compare the tokens' content lengths first\n    if (previousContent.length !== nextContent.length) {\n      return false;\n    }\n\n    // 3 And finally compare the actual tokens' content\n    return previousContent === nextContent;\n  }\n);\n\nexport function MarkdownToken({\n  token,\n  components,\n}: {\n  token: Token;\n  components: Partial<MarkdownComponents> | undefined;\n}) {\n  switch (token.type) {\n    case \"escape\": {\n      return token.text;\n    }\n\n    case \"space\": {\n      return null;\n    }\n\n    case \"text\": {\n      if (token.tokens !== undefined) {\n        return <MarkdownTokens tokens={token.tokens} components={components} />;\n      } else {\n        return parseHtmlEntities(token.text);\n      }\n    }\n\n    case \"br\": {\n      return <br />;\n    }\n\n    case \"paragraph\": {\n      const Paragraph = components?.Paragraph ?? defaultComponents.Paragraph;\n\n      return (\n        <Paragraph>\n          <MarkdownTokens tokens={token.tokens} components={components} />\n        </Paragraph>\n      );\n    }\n\n    case \"heading\": {\n      const Heading = components?.Heading ?? defaultComponents.Heading;\n\n      return (\n        <Heading level={clampHeadingLevel(token.depth)}>\n          <MarkdownTokens tokens={token.tokens} components={components} />\n        </Heading>\n      );\n    }\n\n    case \"strong\": {\n      const Inline = components?.Inline ?? defaultComponents.Inline;\n\n      return (\n        <Inline type=\"strong\">\n          <MarkdownTokens tokens={token.tokens} components={components} />\n        </Inline>\n      );\n    }\n\n    case \"em\": {\n      const Inline = components?.Inline ?? defaultComponents.Inline;\n\n      return (\n        <Inline type=\"em\">\n          <MarkdownTokens tokens={token.tokens} components={components} />\n        </Inline>\n      );\n    }\n\n    case \"codespan\": {\n      const Inline = components?.Inline ?? defaultComponents.Inline;\n\n      return <Inline type=\"code\">{parseHtmlEntities(token.text)}</Inline>;\n    }\n\n    case \"del\": {\n      const Inline = components?.Inline ?? defaultComponents.Inline;\n\n      return (\n        <Inline type=\"del\">\n          <MarkdownTokens tokens={token.tokens} components={components} />\n        </Inline>\n      );\n    }\n\n    case \"link\": {\n      const href = sanitizeUrl(token.href);\n\n      if (href === null) {\n        return <MarkdownTokens tokens={token.tokens} components={components} />;\n      }\n\n      const Link = components?.Link ?? defaultComponents.Link;\n\n      return (\n        <Link href={href} title={token.title ?? undefined}>\n          <MarkdownTokens tokens={token.tokens} components={components} />\n        </Link>\n      );\n    }\n\n    case \"code\": {\n      let language: string | undefined = undefined;\n      if (token.lang !== undefined) {\n        language =\n          token.lang.match(TRAILING_NON_WHITESPACE_REGEX)?.[0] ?? undefined;\n      }\n\n      const CodeBlock = components?.CodeBlock ?? defaultComponents.CodeBlock;\n\n      return <CodeBlock language={language} code={token.text || \" \"} />;\n    }\n\n    case \"blockquote\": {\n      const Blockquote = components?.Blockquote ?? defaultComponents.Blockquote;\n\n      return (\n        <Blockquote>\n          <MarkdownTokens\n            tokens={token.tokens}\n            components={components}\n            normalizeToBlockTokens\n          />\n        </Blockquote>\n      );\n    }\n\n    case \"list\": {\n      const List = components?.List ?? defaultComponents.List;\n      const items: MarkdownComponentsListItem[] = token.items.map((item) => {\n        let tokens = item.tokens;\n\n        if (item.task) {\n          tokens = [\n            {\n              type: \"checkbox\",\n              checked: Boolean(item.checked),\n              raw: `[${item.checked ? \"x\" : \" \"}]`,\n            },\n            ...tokens,\n          ];\n        }\n\n        return {\n          checked: item.task ? item.checked : undefined,\n          children: (\n            <MarkdownTokens\n              tokens={tokens}\n              components={components}\n              normalizeToBlockTokens={\n                // A non-loose list item doesn't need to be wrapped in block tokens.\n                item.tokens.length > 0 ? item.loose : false\n              }\n            />\n          ),\n        };\n      });\n\n      const props: MarkdownComponentsListProps = token.ordered\n        ? { type: \"ordered\", items, start: token.start || 1 }\n        : { type: \"unordered\", items };\n\n      return <List {...props} />;\n    }\n\n    case \"checkbox\": {\n      return (\n        <>\n          <input type=\"checkbox\" disabled checked={token.checked} />{\" \"}\n        </>\n      );\n    }\n\n    case \"table\": {\n      const Table = components?.Table ?? defaultComponents.Table;\n      const headings: MarkdownComponentsTableCell[] = token.header.map(\n        (cell) => ({\n          align: cell.align ?? undefined,\n          children: (\n            <MarkdownTokens tokens={cell.tokens} components={components} />\n          ),\n        })\n      );\n\n      const rows: MarkdownComponentsTableCell[][] = token.rows.map((row) =>\n        row.map((cell) => ({\n          align: cell.align ?? undefined,\n          children: (\n            <MarkdownTokens tokens={cell.tokens} components={components} />\n          ),\n        }))\n      );\n\n      return <Table headings={headings} rows={rows} />;\n    }\n\n    case \"image\": {\n      const href = sanitizeUrl(token.href);\n\n      if (href === null) {\n        return token.text;\n      }\n\n      const Image = components?.Image ?? defaultComponents.Image;\n\n      return (\n        <Image src={href} alt={token.text} title={token.title ?? undefined} />\n      );\n    }\n\n    case \"hr\": {\n      const Separator = components?.Separator ?? defaultComponents.Separator;\n\n      return <Separator />;\n    }\n\n    case \"html\": {\n      return parseHtmlEntities(token.text);\n    }\n\n    default: {\n      return null;\n    }\n  }\n}\n\nfunction MarkdownTokens({\n  tokens,\n  components,\n  normalizeToBlockTokens = false,\n}: {\n  tokens: AnyToken[];\n  components: Partial<MarkdownComponents> | undefined;\n  normalizeToBlockTokens?: boolean;\n}) {\n  assertTokens(tokens);\n\n  let normalizedTokens: Token[] = [];\n\n  if (normalizeToBlockTokens) {\n    let leadingCheckboxToken =\n      tokens[0]?.type === \"checkbox\" ? tokens[0] : null;\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i]!;\n\n      switch (token.type) {\n        case \"text\": {\n          const paragraphTextTokens: Tokens.Text[] = [token];\n\n          // Wrap consecutive text tokens into a paragraph.\n          while (i + 1 < tokens.length && tokens[i + 1]!.type === \"text\") {\n            i++;\n            paragraphTextTokens.push(tokens[i] as Tokens.Text);\n          }\n\n          const paragraphRaw = paragraphTextTokens\n            .map((text) => text.raw)\n            .join(\"\");\n          const paragraphText = paragraphTextTokens\n            .map((text) => text.text)\n            .join(\"\");\n\n          // When wrapping loose task list items into paragraphs, we need to\n          // move the checkbox into the first paragraph.\n          normalizedTokens.push({\n            type: \"paragraph\",\n            tokens: leadingCheckboxToken\n              ? [leadingCheckboxToken, ...paragraphTextTokens]\n              : paragraphTextTokens,\n            raw: paragraphRaw,\n            text: paragraphText,\n          } satisfies Tokens.Paragraph);\n          leadingCheckboxToken = null;\n\n          break;\n        }\n\n        case \"checkbox\":\n          break;\n\n        default: {\n          normalizedTokens.push(token);\n        }\n      }\n    }\n  } else {\n    normalizedTokens = tokens;\n  }\n\n  return normalizedTokens.map((token, index) => (\n    <MarkdownToken key={index} token={token} components={components} />\n  ));\n}\n\n/**\n * Marked.js' `Token` union type includes a `Generic` token type which is\n * too broad and makes narrowing difficult, we don't use generic/custom tokens\n * so we can assert the `Generic` type away.\n */\nfunction assertTokens(_: AnyToken): asserts _ is Token;\nfunction assertTokens(_: AnyToken[]): asserts _ is Token[];\nfunction assertTokens(_: AnyToken | AnyToken[]): asserts _ is Token | Token[] {}\n\nfunction isBlockToken(\n  token: Token | Tokens.Generic\n): token is\n  | Tokens.Paragraph\n  | Tokens.Heading\n  | Tokens.Blockquote\n  | Tokens.ListItem {\n  return (\n    token.type === \"paragraph\" ||\n    token.type === \"heading\" ||\n    token.type === \"blockquote\" ||\n    token.type === \"list_item\"\n  );\n}\n\nfunction tokenize(markdown: string) {\n  return new Lexer().lex(markdown) as Token[];\n}\n\nfunction tokenizePartial(markdown: string) {\n  const preprocessedContent = trimPartialMarkdown(normalizeNewlines(markdown));\n\n  const tokens = tokenize(preprocessedContent);\n\n  try {\n    return completePartialTokens(tokens);\n  } catch {\n    return tokens;\n  }\n}\n\n/**\n * Find the last partial token that we could potentially complete.\n */\nfunction findPotentiallyPartialToken(\n  tokens: AnyToken[],\n  parentToken?: PotentiallyPartialToken\n): PotentiallyPartialToken | undefined {\n  if (tokens.length === 0) {\n    return parentToken;\n  }\n\n  assertTokens(tokens);\n\n  const lastIndex = tokens.length - 1;\n  let lastToken = tokens[lastIndex]!;\n\n  if (lastToken.type === \"space\") {\n    const penultimateToken = tokens[lastIndex - 1];\n\n    if (!penultimateToken) {\n      return parentToken;\n    }\n\n    lastToken = penultimateToken;\n  }\n\n  if (lastToken.type === \"list\") {\n    const listToken = lastToken;\n    const lastListItem = listToken.items[listToken.items.length - 1];\n\n    if (!lastListItem) {\n      return parentToken;\n    }\n\n    const lastListItemTokens = lastListItem.tokens as Token[];\n\n    // List items containing empty lines are handled differently,\n    // instead of using the list item's tokens, we use the last one\n    // if it's a text or block token.\n    if (\n      lastListItemTokens.some((token) => token.type === \"space\") &&\n      lastListItemTokens.length > 0\n    ) {\n      const lastListItemLastToken =\n        lastListItemTokens[lastListItemTokens.length - 1];\n\n      if (lastListItemLastToken) {\n        if (lastListItemLastToken.type === \"text\") {\n          return lastListItemLastToken;\n        }\n\n        if (isBlockToken(lastListItemLastToken)) {\n          return findPotentiallyPartialToken(\n            lastListItemLastToken.tokens,\n            lastListItemLastToken\n          );\n        }\n\n        return undefined;\n      }\n    }\n\n    return findPotentiallyPartialToken(lastListItem.tokens, lastListItem);\n  }\n\n  if (lastToken.type === \"table\") {\n    const tableToken = lastToken;\n    const lastTableRow = tableToken.rows[tableToken.rows.length - 1];\n\n    if (!lastTableRow) {\n      return parentToken;\n    }\n\n    // Marked.js creates all cells in advance when creating rows,\n    // we want the cell where the end currently is.\n    const firstEmptyTableCellIndex = lastTableRow.findIndex(\n      (cell) => cell.tokens.length === 0\n    );\n    const lastNonEmptyTableCell =\n      firstEmptyTableCellIndex === -1\n        ? undefined\n        : firstEmptyTableCellIndex === 0\n          ? lastTableRow[firstEmptyTableCellIndex]\n          : lastTableRow[firstEmptyTableCellIndex - 1];\n\n    if (!lastNonEmptyTableCell) {\n      return parentToken;\n    }\n\n    return findPotentiallyPartialToken(\n      lastNonEmptyTableCell.tokens,\n      lastNonEmptyTableCell\n    );\n  }\n\n  if (isBlockToken(lastToken)) {\n    return findPotentiallyPartialToken(lastToken.tokens, lastToken);\n  }\n\n  return parentToken;\n}\n\nfunction normalizeNewlines(string: string) {\n  return string.replace(NEWLINE_REGEX, \"\\n\");\n}\n\n/**\n * Trim a partial Markdown string to avoid incomplete tokens.\n */\nfunction trimPartialMarkdown(markdown: string) {\n  const lines = markdown.split(\"\\n\");\n\n  if (lines.length === 0) {\n    return markdown;\n  }\n\n  // If the last line contains a single non-whitespace character,\n  // we can remove it for now.\n  const [singleCharacterMatch] =\n    lines[lines.length - 1]!.match(SINGLE_CHARACTER_REGEX) ?? [];\n\n  if (singleCharacterMatch) {\n    lines[lines.length - 1] = lines[lines.length - 1]!.slice(\n      0,\n      -singleCharacterMatch.length\n    );\n\n    return lines.join(\"\\n\");\n  }\n\n  // If the last line ends with partial syntax, we can remove it for now.\n  const [bufferedCharactersMatch] =\n    lines[lines.length - 1]!.match(BUFFERED_CHARACTERS_REGEX) ?? [];\n\n  if (bufferedCharactersMatch) {\n    lines[lines.length - 1] = lines[lines.length - 1]!.slice(\n      0,\n      -bufferedCharactersMatch.length\n    );\n\n    return lines.join(\"\\n\");\n  }\n\n  return markdown;\n}\n\n/**\n * Optimistically complete a Markdown string of inline content:\n *\n * - Bold, italic, strikethrough, and inline code\n * - Links\n *\n * Remove any remaining partial content:\n *\n * - Emoji\n */\nfunction completePartialInlineMarkdown(\n  markdown: string,\n  options: { allowLinksImages?: boolean } = {}\n): string {\n  const stack: { string: string; length: number; index: number }[] = [];\n  const allowLinksImages = options.allowLinksImages ?? true;\n  let completedMarkdown = markdown;\n\n  // Trim any partial emoji.\n  //\n  // We do this here rather than in `trimPartialMarkdown` because\n  // `trimPartialMarkdown` needs to run before Marked.js to prevent\n  // it from parsing partial Markdown syntax, emojis won't be parsed\n  // by Marked.js so we can trim them here to be a bit more efficient.\n  const partialEmojiMatch = completedMarkdown.match(PARTIAL_EMOJI_REGEX);\n\n  if (partialEmojiMatch) {\n    const partialEmoji = partialEmojiMatch[0];\n    completedMarkdown = completedMarkdown.slice(0, -partialEmoji.length);\n\n    // If the removed partial emoji contains a special modifier (VS16 or keycap),\n    // we also remove the preceding code point.\n    if (partialEmoji.includes(\"\\uFE0F\") || partialEmoji.includes(\"\\u20E3\")) {\n      const codepoints = Array.from(completedMarkdown);\n\n      if (codepoints.length > 0) {\n        completedMarkdown = codepoints.slice(0, -1).join(\"\");\n      }\n    }\n  }\n\n  // Move forward through the string to collect delimiters.\n  for (let i = 0; i < completedMarkdown.length; i++) {\n    const character = completedMarkdown[i]!;\n    const isEscaped = i > 0 ? completedMarkdown[i - 1] === \"\\\\\" : false;\n\n    if (isEscaped) {\n      continue;\n    }\n\n    if (character === \"`\") {\n      const lastDelimiter = stack[stack.length - 1];\n      const isClosingPreviousDelimiter =\n        lastDelimiter?.string === \"`\" && i > lastDelimiter.index;\n\n      if (isClosingPreviousDelimiter) {\n        // If the delimiter is closing a previous delimiter,\n        // we remove it from the stack.\n        stack.pop();\n      } else {\n        const characterAfterDelimiter = completedMarkdown[i + 1];\n\n        // If the delimiter is opening and is followed by a\n        // non-whitespace character, we add it to the stack.\n        if (\n          characterAfterDelimiter &&\n          !WHITESPACE_REGEX.test(characterAfterDelimiter)\n        ) {\n          stack.push({ string: \"`\", length: 1, index: i });\n        }\n      }\n\n      continue;\n    }\n\n    if (character === \"*\" || character === \"_\" || character === \"~\") {\n      const isInsideInlineCode = stack[stack.length - 1]?.string === \"`\";\n\n      let j = i;\n      while (\n        j < completedMarkdown.length &&\n        completedMarkdown[j] === character\n      ) {\n        j++;\n      }\n      const consecutiveDelimiterCharacters = j - i;\n\n      // Delimiters inside inline code shouldn't be closed so we skip them.\n      if (isInsideInlineCode) {\n        i += consecutiveDelimiterCharacters - 1;\n\n        continue;\n      }\n\n      let remainingConsecutiveDelimiterCharacters =\n        consecutiveDelimiterCharacters;\n      let consecutiveDelimiterCharacterIndex = 0;\n\n      while (remainingConsecutiveDelimiterCharacters > 0) {\n        const lastDelimiter = stack[stack.length - 1];\n\n        if (!lastDelimiter || lastDelimiter.string[0] !== character) {\n          break;\n        }\n\n        // We close as many matching open delimiters as possible from the stack.\n        if (remainingConsecutiveDelimiterCharacters >= lastDelimiter.length) {\n          stack.pop();\n          remainingConsecutiveDelimiterCharacters -= lastDelimiter.length;\n          consecutiveDelimiterCharacterIndex += lastDelimiter.length;\n\n          continue;\n        }\n\n        break;\n      }\n\n      if (remainingConsecutiveDelimiterCharacters > 0) {\n        // If there are any unmatched delimiters at the end of the string,\n        // we can remove them from the string.\n        if (i + consecutiveDelimiterCharacters >= completedMarkdown.length) {\n          completedMarkdown = completedMarkdown.slice(\n            0,\n            completedMarkdown.length - remainingConsecutiveDelimiterCharacters\n          );\n\n          break;\n        }\n\n        const characterAfterDelimiters =\n          completedMarkdown[i + consecutiveDelimiterCharacters];\n\n        if (\n          characterAfterDelimiters &&\n          !WHITESPACE_REGEX.test(characterAfterDelimiters)\n        ) {\n          let delimiterStartIndex = i + consecutiveDelimiterCharacterIndex;\n\n          // If there's an odd number of unmatched delimiters,\n          // we match a single-character delimiter.\n          if (remainingConsecutiveDelimiterCharacters % 2 === 1) {\n            stack.push({\n              string: character,\n              length: 1,\n              index: delimiterStartIndex,\n            });\n            delimiterStartIndex += 1;\n            remainingConsecutiveDelimiterCharacters -= 1;\n          }\n\n          // If there are any unmatched delimiters remaining,\n          // we match double-character delimiters.\n          while (remainingConsecutiveDelimiterCharacters >= 2) {\n            stack.push({\n              string: character + character,\n              length: 2,\n              index: delimiterStartIndex,\n            });\n            delimiterStartIndex += 2;\n            remainingConsecutiveDelimiterCharacters -= 2;\n          }\n        }\n      }\n\n      i += consecutiveDelimiterCharacters - 1;\n\n      continue;\n    }\n  }\n\n  if (allowLinksImages) {\n    const partialLinkImageMatch = completedMarkdown.match(\n      PARTIAL_LINK_IMAGE_REGEX\n    );\n\n    if (partialLinkImageMatch) {\n      const linkImageStartIndex = partialLinkImageMatch.index!;\n      const linkImageEndIndex =\n        linkImageStartIndex + partialLinkImageMatch[0].length;\n\n      const isInsideInlineCode = stack.some(\n        (delimiter) =>\n          delimiter.string === \"`\" && delimiter.index < linkImageStartIndex\n      );\n\n      if (!isInsideInlineCode) {\n        const partialLinkImageContent = partialLinkImageMatch[0];\n        const {\n          text: partialLinkText,\n          url: partialLinkUrl,\n          image: isImage,\n        } = partialLinkImageMatch.groups!;\n\n        if (isImage) {\n          // We can't optimistically complete images, so we remove them until they are complete.\n          completedMarkdown = completedMarkdown.slice(\n            0,\n            -partialLinkImageContent.length\n          );\n        } else {\n          // We can remove delimiters from the stack that are inside the completed link,\n          // since they are now closed.\n          for (let i = stack.length - 1; i >= 0; i--) {\n            const delimiter = stack[i]!;\n\n            if (\n              delimiter.index >= linkImageStartIndex &&\n              delimiter.index < linkImageEndIndex\n            ) {\n              stack.splice(i, 1);\n            }\n          }\n\n          const completedLinkText = partialLinkText\n            ? partialLinkUrl\n              ? // If there's a partial URL, the text is already completed.\n                partialLinkText\n              : // Otherwise, we complete the text and its potential nested elements.\n                completePartialInlineMarkdown(partialLinkText, {\n                  // Links/images cannot be nested.\n                  allowLinksImages: false,\n                })\n            : \"\";\n          const completedLinkUrl =\n            partialLinkUrl &&\n            !WHITESPACE_REGEX.test(partialLinkUrl) &&\n            isUrl(partialLinkUrl)\n              ? // We only use the partial URL if it's valid.\n                partialLinkUrl\n              : DEFAULT_PARTIAL_LINK_URL;\n          const completedLink = `[${completedLinkText}](${completedLinkUrl})`;\n\n          completedMarkdown = completedMarkdown.slice(\n            0,\n            -partialLinkImageContent.length\n          );\n          completedMarkdown += completedLink;\n        }\n      }\n    }\n  }\n\n  // Move through the stack to close open formatting tokens.\n  for (let i = stack.length - 1; i >= 0; i--) {\n    const delimiter = stack[i]!;\n\n    // If the open token is at the end of the string,\n    // we can't close it yet so we remove it.\n    if (delimiter.index + delimiter.length >= completedMarkdown.length) {\n      completedMarkdown = completedMarkdown.slice(0, delimiter.index);\n      continue;\n    }\n\n    // Bold, italic, and strikethrough cannot end with whitespace so\n    // we trim their content before closing them.\n    if (delimiter.string !== \"`\") {\n      completedMarkdown = completedMarkdown.trimEnd();\n    }\n\n    // We can close that open token at this point.\n    completedMarkdown += delimiter.string;\n  }\n\n  return completedMarkdown;\n}\n\n/**\n * Optimistically complete a Markdown string of a table.\n */\nfunction completePartialTableMarkdown(markdown: string): string | undefined {\n  const tableLines = markdown.split(\"\\n\");\n\n  if (tableLines.length === 0) {\n    return undefined;\n  }\n\n  const tableHeader = tableLines[0]!;\n\n  if (tableHeader === \"|\") {\n    return undefined;\n  }\n\n  const tableHeadings = tableHeader\n    .split(\"|\")\n    .map((cell) => cell.trim())\n    .filter((cell) => cell !== \"\");\n\n  if (tableHeadings.length === 0) {\n    return undefined;\n  }\n\n  // If the last header cell is partial, it might also contain partial elements.\n  if (!tableHeader.endsWith(\"|\")) {\n    const lastTableHeading = tableHeadings[tableHeadings.length - 1]!;\n    const completedLastTableHeading =\n      completePartialInlineMarkdown(lastTableHeading);\n\n    tableHeadings[tableHeadings.length - 1] = completedLastTableHeading;\n  }\n\n  return `| ${tableHeadings.join(\" | \")} |\\n| ${tableHeadings.map(() => \"---\").join(\" | \")} |`;\n}\n\nfunction completePartialTokens(tokens: Token[]) {\n  const potentiallyPartialToken = findPotentiallyPartialToken(tokens);\n\n  if (!potentiallyPartialToken) {\n    return tokens;\n  }\n\n  if (\n    potentiallyPartialToken.type === \"paragraph\" ||\n    potentiallyPartialToken.type === \"text\"\n  ) {\n    // Marked.js only creates tables when the table header and its\n    // separator below are complete.\n    //\n    // We optimistically create tables sooner if the current text looks\n    // like a partial table header.\n    if (PARTIAL_TABLE_HEADER_REGEX.test(potentiallyPartialToken.raw)) {\n      const completedTableMarkdown = completePartialTableMarkdown(\n        potentiallyPartialToken.raw\n      );\n\n      if (completedTableMarkdown) {\n        // We optimistically complete the table as a string then re-tokenize\n        // it to get an optimistically complete table token.\n        const completedTable = tokenize(completedTableMarkdown)[0] as\n          | Tokens.Table\n          | undefined;\n\n        if (completedTable) {\n          // We replace the paragraph/text by the optimistically completed table.\n          const table = potentiallyPartialToken as unknown as Tokens.Table;\n\n          table.type = \"table\";\n          table.header = completedTable.header;\n          table.align = completedTable.align;\n          table.rows = completedTable.rows;\n\n          return tokens;\n        }\n      } else {\n        // Otherwise, we hide it for now.\n        potentiallyPartialToken.text = \"\";\n        potentiallyPartialToken.tokens = [];\n      }\n    }\n  }\n\n  if (potentiallyPartialToken.type === \"list_item\") {\n    const listItem = potentiallyPartialToken;\n    const listItemTokens = listItem.tokens as Token[];\n\n    // Marked.js only turns list items into tasks when the list marker\n    // and the task checkbox are complete and followed by a space. (e.g. \"- [x] \")\n    //\n    // We optimistically mark list items as tasks sooner,\n    // whenever a list item starts with \"- [\", \"- [x\", etc.\n    if (\n      !listItem.task &&\n      listItemTokens.length === 1 &&\n      listItemTokens[0]!.type === \"text\"\n    ) {\n      const listItemText = listItemTokens[0];\n      const checkboxMatch = listItemText.text.match(LIST_ITEM_CHECKBOX_REGEX);\n\n      if (checkboxMatch) {\n        listItem.task = true;\n\n        if (checkboxMatch[1] === \"x\") {\n          listItem.checked = true;\n        } else {\n          listItem.checked = false;\n        }\n\n        listItem.text = \"\";\n        listItem.tokens = [];\n      }\n    }\n  }\n\n  if (potentiallyPartialToken.text.length === 0) {\n    return tokens;\n  }\n\n  // We optimistically complete inline content as a string then re-tokenize\n  // it to get optimistically complete tokens.\n  const completedMarkdown = completePartialInlineMarkdown(\n    potentiallyPartialToken.text\n  );\n  const completedMarkdownTokens =\n    (tokenize(completedMarkdown)[0] as Tokens.Paragraph | undefined)?.tokens ??\n    [];\n\n  potentiallyPartialToken.text = completedMarkdown;\n  potentiallyPartialToken.tokens = completedMarkdownTokens;\n\n  return tokens;\n}\n\nfunction parseHtmlEntities(input: string) {\n  const document = new DOMParser().parseFromString(\n    `<!doctype html><body>${input\n      // Prevent some characters from being interpreted as markup.\n      .replace(AMPERSAND_REGEX, \"&amp;\")\n      .replace(LEFT_ANGLE_BRACKET_REGEX, \"&lt;\")\n      .replace(RIGHT_ANGLE_BRACKET_REGEX, \"&gt;\")}`,\n    \"text/html\"\n  );\n\n  return document.body.textContent;\n}\n\nfunction clampHeadingLevel(level: number) {\n  return Math.max(1, Math.min(6, level)) as 1 | 2 | 3 | 4 | 5 | 6;\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function ArrowCornerDownRightIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M16 12.5H7.5a3 3 0 0 1-3-3V4M16 12.5 12.5 16m3.5-3.5L12.5 9\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function ArrowDownIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M10 4v12m6-6-6 6-6-6\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function AttachmentIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"m14.077 11.737-3.723 3.62c-1.55 1.507-4.128 1.507-5.678 0-1.543-1.5-1.543-4.02 0-5.52l5.731-5.573c1.034-1.006 2.754-1.007 3.789-.003 1.03 1 1.032 2.682.003 3.684l-5.744 5.572a1.377 1.377 0 0 1-1.893 0 1.283 1.283 0 0 1-.392-.92c0-.345.14-.676.392-.92L10.348 8\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function BellIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M10 4a3.5 3.5 0 0 0-3.5 3.5c0 3.5-2 6.5-2 6.5h11s-2-3-2-6.5A3.5 3.5 0 0 0 10 4ZM7.55 14a2.5 2.5 0 0 0 4.9 0\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function BellCrossedIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M14 14H4.5s2-3 2-6.5c0-.3.05-.6.12-.88M8.2 4.5a3.5 3.5 0 0 1 5.3 3c0 .96.15 1.88.37 2.7M7.55 14a2.5 2.5 0 0 0 4.9 0M4.5 4.5l11 11\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function BlockquoteIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M16 14.25H9M16 10H9m7-4.25H4M4 10l2 2.13-2 2.12\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function BoldIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M5.5 10h6.63m0 5.75H5.5V4.25h5.63M11.125 10a2.875 2.875 0 0 0 0-5.75m1 11.5a2.875 2.875 0 0 0 0-5.75\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function CheckIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M16 6L8 14L4 10\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function CheckCircleIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <circle cx={10} cy={10} r={7} />\n      <path d=\"m13 8-4 4-2-2\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function CheckCircleFillIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <circle cx={10} cy={10} r={7} fill=\"currentColor\" />\n      <path d=\"m13 8-4 4-2-2\" stroke=\"var(--lb-icon-background)\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function ChevronRightIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M8.5 5.5 13 10l-4.5 4.5\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function CodeIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"m7.5 6-4 4 4 4m5-8 4 4-4 4\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function CommentIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M10 16a6 6 0 1 0-5.552-3.72c.094.229.12.482.052.719l-.753 2.636a.5.5 0 0 0 .618.618l2.636-.753a1.1 1.1 0 0 1 .719.052A6.002 6.002 0 0 0 10 16Z\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function CopyIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M4.5 12.91c-.58-.2-1-.76-1-1.41v-6c0-1.1.9-2 2-2h6c.65 0 1.2.42 1.41 1\" />\n      <rect x={7} y={7} width={9.5} height={9.5} rx={1.5} />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function CrossIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M15 5L5 15\" />\n      <path d=\"M5 5L15 15\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function CrossCircleFillIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <circle cx={10} cy={10} r={7} fill=\"currentColor\" />\n      <path d=\"m12.5 7.5-5 5m0-5 5 5\" stroke=\"var(--lb-icon-background)\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function DeleteIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M4.5 6.5h11M14 6.5V14a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 6 14V6.5M7.5 6.5V5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v1.5\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function EditIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"m11.784 5.797-6.13 6.138a4 4 0 0 0-1.03 1.775L4 16l2.285-.624a4 4 0 0 0 1.776-1.032l6.145-6.152m-2.422-2.395 1.244-1.246c.608-.608 1.826-.81 2.53-.104.7.7.499 1.893-.122 2.515l-1.23 1.23m-2.422-2.395 2.422 2.395\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function EllipsisIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon fill=\"currentColor\" {...props}>\n      <circle cx={5} cy={10} r={0.75} />\n      <circle cx={10} cy={10} r={0.75} />\n      <circle cx={15} cy={10} r={0.75} />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function EmojiIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14Z\" />\n      <path d=\"M7.5 11.5S8.25 13 10 13s2.5-1.5 2.5-1.5M8 8h.007\" />\n      <path d=\"M12 8h.007\" />\n      <circle cx={8} cy={8} r={0.25} />\n      <circle cx={12} cy={8} r={0.25} />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function EmojiPlusIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M11 3.07A7 7 0 1 0 16.93 9\" />\n      <path d=\"M7.5 11.5S8.25 13 10 13s2.5-1.5 2.5-1.5M8 8h0\" />\n      <path d=\"M12 8h0\" />\n      <path d=\"M13 5h4m-2-2v4\" />\n      <circle cx=\"8\" cy=\"8\" r=\".25\" />\n      <circle cx=\"12\" cy=\"8\" r=\".25\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function H1Icon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M4 10h5m-5 4V6m5 8V6m3.5 1.5 2-1.5v8m0 0H13m1.5 0H16\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function H2Icon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M4 10h5m-5 4V6m5 8V6m3 1c.37-.6 1.21-1 2-1 1 0 2 .5 2 2 0 1.788-1.5 3-4 6h4\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function H3Icon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M4 10h5m-5 4V6m5 8V6m3 1c.37-.6 1.2-1 2-1 .97 0 2 .5 2 2 0 1.79-1.47 2-2 2 .53 0 2 .21 2 2 0 1.5-1.03 2-2 2-.8 0-1.63-.4-2-1\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function ItalicIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M15 4.25H8m4 11.5H5m6.75-11.5-3.5 11.5\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function LengthenIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M15.5 11.5H13m2.5 3h-4m4-6H10m5.5-3H10m-3.5 0v9m0 0 3-3m-3 3-3-3\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function ListOrderedIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M16 14.25H9M16 10H9m7-4.25H9m-5 0 1-.5V8.5m0 0H4m1 0h1m-2 3.4c.18-.24.6-.4 1-.4.5 0 1 .2 1 .81 0 .73-.75 1.22-2 2.44h2\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function ListUnorderedIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M16 14.25H8M16 10H8m8-4.25H8m-3.75 0h0\" />\n      <circle cx={4.25} cy={5.75} r={0.25} />\n      <path d=\"M4.25 14.25h0\" />\n      <circle cx={4.25} cy={14.25} r={0.25} />\n      <path d=\"M4.25 10h0\" />\n      <circle cx={4.25} cy={10} r={0.25} />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function MentionIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z\" />\n      <path d=\"M13 7v3.7c0 1.105.855 2.1 1.9 2.1a2.12 2.12 0 0 0 2.1-2.1V10a7 7 0 1 0-2.8 5.6\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function MinusCircleIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <circle cx={10} cy={10} r={7} />\n      <path d=\"M7 10h6\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function QuestionMarkIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14Zm0-3h.007\" />\n      <path d=\"M8 7.5C8 7 8.5 6 10 6s2 1 2 2c0 1.5-2 2-2 3.5\" />\n      <circle cx={10} cy={14} r={0.25} />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function RedoIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M16 8H7.5A3.5 3.5 0 0 0 4 11.5v0A3.5 3.5 0 0 0 7.5 15H9\" />\n      <path d=\"m13 5 3 3-3 3\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function RestoreIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M3.674 7a7 7 0 1 1-.603 4\" />\n      <path d=\"M3.5 3.5V7H7m3-.5V10l2.5 1.5\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function SearchIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M9 15A6 6 0 1 0 9 3a6 6 0 0 0 0 12Zm7.5 1.5-3.25-3.25\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function SendIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"m5 16 12-6L5 4l2 6-2 6ZM7 10h10\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function ShortenIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M15.5 8.5H13m2.5-3h-4m-5 9v-9m0 0 3 3m-3-3-3 3\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function SparklesIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M8.333 7.833a.333.333 0 0 0-.666 0 3.833 3.833 0 0 1-3.834 3.834.333.333 0 1 0 0 .666 3.833 3.833 0 0 1 3.834 3.834.333.333 0 0 0 .666 0 3.833 3.833 0 0 1 3.834-3.834.333.333 0 1 0 0-.666 3.833 3.833 0 0 1-3.834-3.834ZM16 6.5A2.5 2.5 0 0 1 13.5 4 2.5 2.5 0 0 1 11 6.5 2.5 2.5 0 0 1 13.5 9 2.5 2.5 0 0 1 16 6.5Z\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function SparklesTextIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M9 11.5H4.5m3.5 3H4.5m11-6h-11m11-3h-11\" />\n      <path d=\"M16 13.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1-2.5 2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1 2.5-2.5Z\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function SpinnerIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M3 10a7 7 0 0 1 7-7\" className=\"lb-icon-spinner\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function StopIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <rect x={5} y={5} width={10} height={10} rx={1} fill=\"currentColor\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function StrikethroughIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M15.5 10h-11m4.669 0C7.599 9.44 6.5 8.484 6.5 7.125 6.5 5.537 7.79 4.25 10 4.25c1.654 0 2.793.721 3.261 1.75M6.74 14c.468 1.029 1.607 1.75 3.261 1.75 2 0 3.5-1 3.5-2.5 0-.085-.004-.169-.013-.25\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function TextIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M5 6V4.75h10V6m-6.5 9.25h3M10 4.75v10.5\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function UnderlineIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M6.5 4.5V9a3.5 3.5 0 0 0 3.5 3.5v0A3.5 3.5 0 0 0 13.5 9V4.5M15 16H5\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function UndoIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M4 8h8.5a3.5 3.5 0 0 1 3.5 3.5v0a3.5 3.5 0 0 1-3.5 3.5H11\" />\n      <path d=\"M7 5 4 8l3 3\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function UsersIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"M8 9.75a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Zm0 0c-2.42 0-4.055 1.72-4.422 4.004-.087.545.37.996.922.996h7c.552 0 1.01-.45.922-.996C12.055 11.47 10.42 9.75 8 9.75ZM15 14.75h.5c.552 0 1.004-.45.912-.995-.317-1.888-1.485-4.114-3.412-4.505.863-.222 1.5-1.068 1.5-2a2 2 0 0 0-2-2\" />\n    </Icon>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { Icon } from \"../components/internal/Icon\";\n\nexport function WarningIcon(props: ComponentProps<\"svg\">) {\n  return (\n    <Icon {...props}>\n      <path d=\"m3.794 13.526 5.326-9.89a1 1 0 0 1 1.76 0l5.326 9.89a1 1 0 0 1-.88 1.474H4.674a1 1 0 0 1-.88-1.474ZM10 7.5v2m0 2.5h.007\" />\n      <circle cx={10} cy={12} r={0.25} />\n    </Icon>\n  );\n}\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { DismissableLayer } from '@radix-ui/react-dismissable-layer';\nimport { useId } from '@radix-ui/react-id';\nimport * as PopperPrimitive from '@radix-ui/react-popper';\nimport { createPopperScope } from '@radix-ui/react-popper';\nimport { Portal as PortalPrimitive } from '@radix-ui/react-portal';\nimport { Presence } from '@radix-ui/react-presence';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { createSlottable } from '@radix-ui/react-slot';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport * as VisuallyHiddenPrimitive from '@radix-ui/react-visually-hidden';\n\nimport type { Scope } from '@radix-ui/react-context';\n\ntype ScopedProps<P = {}> = P & { __scopeTooltip?: Scope };\nconst [createTooltipContext, createTooltipScope] = createContextScope('Tooltip', [\n  createPopperScope,\n]);\nconst usePopperScope = createPopperScope();\n\n/* -------------------------------------------------------------------------------------------------\n * TooltipProvider\n * -----------------------------------------------------------------------------------------------*/\n\nconst PROVIDER_NAME = 'TooltipProvider';\nconst DEFAULT_DELAY_DURATION = 700;\nconst TOOLTIP_OPEN = 'tooltip.open';\n\ntype TooltipProviderContextValue = {\n  isOpenDelayedRef: React.MutableRefObject<boolean>;\n  delayDuration: number;\n  onOpen(): void;\n  onClose(): void;\n  onPointerInTransitChange(inTransit: boolean): void;\n  isPointerInTransitRef: React.MutableRefObject<boolean>;\n  disableHoverableContent: boolean;\n};\n\nconst [TooltipProviderContextProvider, useTooltipProviderContext] =\n  createTooltipContext<TooltipProviderContextValue>(PROVIDER_NAME);\n\ninterface TooltipProviderProps {\n  children: React.ReactNode;\n  /**\n   * The duration from when the pointer enters the trigger until the tooltip gets opened.\n   * @defaultValue 700\n   */\n  delayDuration?: number;\n  /**\n   * How much time a user has to enter another trigger without incurring a delay again.\n   * @defaultValue 300\n   */\n  skipDelayDuration?: number;\n  /**\n   * When `true`, trying to hover the content will result in the tooltip closing as the pointer leaves the trigger.\n   * @defaultValue false\n   */\n  disableHoverableContent?: boolean;\n}\n\nconst TooltipProvider: React.FC<TooltipProviderProps> = (\n  props: ScopedProps<TooltipProviderProps>\n) => {\n  const {\n    __scopeTooltip,\n    delayDuration = DEFAULT_DELAY_DURATION,\n    skipDelayDuration = 300,\n    disableHoverableContent = false,\n    children,\n  } = props;\n  const isOpenDelayedRef = React.useRef(true);\n  const isPointerInTransitRef = React.useRef(false);\n  const skipDelayTimerRef = React.useRef(0);\n\n  React.useEffect(() => {\n    const skipDelayTimer = skipDelayTimerRef.current;\n    return () => window.clearTimeout(skipDelayTimer);\n  }, []);\n\n  return (\n    <TooltipProviderContextProvider\n      scope={__scopeTooltip}\n      isOpenDelayedRef={isOpenDelayedRef}\n      delayDuration={delayDuration}\n      onOpen={React.useCallback(() => {\n        window.clearTimeout(skipDelayTimerRef.current);\n        isOpenDelayedRef.current = false;\n      }, [])}\n      onClose={React.useCallback(() => {\n        window.clearTimeout(skipDelayTimerRef.current);\n        skipDelayTimerRef.current = window.setTimeout(\n          () => (isOpenDelayedRef.current = true),\n          skipDelayDuration\n        );\n      }, [skipDelayDuration])}\n      isPointerInTransitRef={isPointerInTransitRef}\n      onPointerInTransitChange={React.useCallback((inTransit: boolean) => {\n        isPointerInTransitRef.current = inTransit;\n      }, [])}\n      disableHoverableContent={disableHoverableContent}\n    >\n      {children}\n    </TooltipProviderContextProvider>\n  );\n};\n\nTooltipProvider.displayName = PROVIDER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * Tooltip\n * -----------------------------------------------------------------------------------------------*/\n\nconst TOOLTIP_NAME = 'Tooltip';\n\ntype TooltipContextValue = {\n  contentId: string;\n  open: boolean;\n  stateAttribute: 'closed' | 'delayed-open' | 'instant-open';\n  trigger: TooltipTriggerElement | null;\n  onTriggerChange(trigger: TooltipTriggerElement | null): void;\n  onTriggerEnter(): void;\n  onTriggerLeave(): void;\n  onOpen(): void;\n  onClose(): void;\n  disableHoverableContent: boolean;\n};\n\nconst [TooltipContextProvider, useTooltipContext] =\n  createTooltipContext<TooltipContextValue>(TOOLTIP_NAME);\n\ninterface TooltipProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  /**\n   * The duration from when the pointer enters the trigger until the tooltip gets opened. This will\n   * override the prop with the same name passed to Provider.\n   * @defaultValue 700\n   */\n  delayDuration?: number;\n  /**\n   * When `true`, trying to hover the content will result in the tooltip closing as the pointer leaves the trigger.\n   * @defaultValue false\n   */\n  disableHoverableContent?: boolean;\n}\n\nconst Tooltip: React.FC<TooltipProps> = (props: ScopedProps<TooltipProps>) => {\n  const {\n    __scopeTooltip,\n    children,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    disableHoverableContent: disableHoverableContentProp,\n    delayDuration: delayDurationProp,\n  } = props;\n  const providerContext = useTooltipProviderContext(TOOLTIP_NAME, props.__scopeTooltip);\n  const popperScope = usePopperScope(__scopeTooltip);\n  const [trigger, setTrigger] = React.useState<HTMLButtonElement | null>(null);\n  const contentId = useId();\n  const openTimerRef = React.useRef(0);\n  const disableHoverableContent =\n    disableHoverableContentProp ?? providerContext.disableHoverableContent;\n  const delayDuration = delayDurationProp ?? providerContext.delayDuration;\n  const wasOpenDelayedRef = React.useRef(false);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen ?? false,\n    onChange: (open) => {\n      if (open) {\n        providerContext.onOpen();\n\n        // as `onChange` is called within a lifecycle method we\n        // avoid dispatching via `dispatchDiscreteCustomEvent`.\n        document.dispatchEvent(new CustomEvent(TOOLTIP_OPEN));\n      } else {\n        providerContext.onClose();\n      }\n      onOpenChange?.(open);\n    },\n    caller: TOOLTIP_NAME,\n  });\n  const stateAttribute = React.useMemo(() => {\n    return open ? (wasOpenDelayedRef.current ? 'delayed-open' : 'instant-open') : 'closed';\n  }, [open]);\n\n  const handleOpen = React.useCallback(() => {\n    window.clearTimeout(openTimerRef.current);\n    openTimerRef.current = 0;\n    wasOpenDelayedRef.current = false;\n    setOpen(true);\n  }, [setOpen]);\n\n  const handleClose = React.useCallback(() => {\n    window.clearTimeout(openTimerRef.current);\n    openTimerRef.current = 0;\n    setOpen(false);\n  }, [setOpen]);\n\n  const handleDelayedOpen = React.useCallback(() => {\n    window.clearTimeout(openTimerRef.current);\n    openTimerRef.current = window.setTimeout(() => {\n      wasOpenDelayedRef.current = true;\n      setOpen(true);\n      openTimerRef.current = 0;\n    }, delayDuration);\n  }, [delayDuration, setOpen]);\n\n  React.useEffect(() => {\n    return () => {\n      if (openTimerRef.current) {\n        window.clearTimeout(openTimerRef.current);\n        openTimerRef.current = 0;\n      }\n    };\n  }, []);\n\n  return (\n    <PopperPrimitive.Root {...popperScope}>\n      <TooltipContextProvider\n        scope={__scopeTooltip}\n        contentId={contentId}\n        open={open}\n        stateAttribute={stateAttribute}\n        trigger={trigger}\n        onTriggerChange={setTrigger}\n        onTriggerEnter={React.useCallback(() => {\n          if (providerContext.isOpenDelayedRef.current) handleDelayedOpen();\n          else handleOpen();\n        }, [providerContext.isOpenDelayedRef, handleDelayedOpen, handleOpen])}\n        onTriggerLeave={React.useCallback(() => {\n          if (disableHoverableContent) {\n            handleClose();\n          } else {\n            // Clear the timer in case the pointer leaves the trigger before the tooltip is opened.\n            window.clearTimeout(openTimerRef.current);\n            openTimerRef.current = 0;\n          }\n        }, [handleClose, disableHoverableContent])}\n        onOpen={handleOpen}\n        onClose={handleClose}\n        disableHoverableContent={disableHoverableContent}\n      >\n        {children}\n      </TooltipContextProvider>\n    </PopperPrimitive.Root>\n  );\n};\n\nTooltip.displayName = TOOLTIP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * TooltipTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRIGGER_NAME = 'TooltipTrigger';\n\ntype TooltipTriggerElement = React.ComponentRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = React.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface TooltipTriggerProps extends PrimitiveButtonProps {}\n\nconst TooltipTrigger = React.forwardRef<TooltipTriggerElement, TooltipTriggerProps>(\n  (props: ScopedProps<TooltipTriggerProps>, forwardedRef) => {\n    const { __scopeTooltip, ...triggerProps } = props;\n    const context = useTooltipContext(TRIGGER_NAME, __scopeTooltip);\n    const providerContext = useTooltipProviderContext(TRIGGER_NAME, __scopeTooltip);\n    const popperScope = usePopperScope(__scopeTooltip);\n    const ref = React.useRef<TooltipTriggerElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref, context.onTriggerChange);\n    const isPointerDownRef = React.useRef(false);\n    const hasPointerMoveOpenedRef = React.useRef(false);\n    const handlePointerUp = React.useCallback(() => (isPointerDownRef.current = false), []);\n\n    React.useEffect(() => {\n      return () => document.removeEventListener('pointerup', handlePointerUp);\n    }, [handlePointerUp]);\n\n    return (\n      <PopperPrimitive.Anchor asChild {...popperScope}>\n        <Primitive.button\n          // We purposefully avoid adding `type=button` here because tooltip triggers are also\n          // commonly anchors and the anchor `type` attribute signifies MIME type.\n          aria-describedby={context.open ? context.contentId : undefined}\n          data-state={context.stateAttribute}\n          {...triggerProps}\n          ref={composedRefs}\n          onPointerMove={composeEventHandlers(props.onPointerMove, (event) => {\n            if (event.pointerType === 'touch') return;\n            if (\n              !hasPointerMoveOpenedRef.current &&\n              !providerContext.isPointerInTransitRef.current\n            ) {\n              context.onTriggerEnter();\n              hasPointerMoveOpenedRef.current = true;\n            }\n          })}\n          onPointerLeave={composeEventHandlers(props.onPointerLeave, () => {\n            context.onTriggerLeave();\n            hasPointerMoveOpenedRef.current = false;\n          })}\n          onPointerDown={composeEventHandlers(props.onPointerDown, () => {\n            if (context.open) {\n              context.onClose();\n            }\n            isPointerDownRef.current = true;\n            document.addEventListener('pointerup', handlePointerUp, { once: true });\n          })}\n          onFocus={composeEventHandlers(props.onFocus, () => {\n            if (!isPointerDownRef.current) context.onOpen();\n          })}\n          onBlur={composeEventHandlers(props.onBlur, context.onClose)}\n          onClick={composeEventHandlers(props.onClick, context.onClose)}\n        />\n      </PopperPrimitive.Anchor>\n    );\n  }\n);\n\nTooltipTrigger.displayName = TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * TooltipPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'TooltipPortal';\n\ntype PortalContextValue = { forceMount?: true };\nconst [PortalProvider, usePortalContext] = createTooltipContext<PortalContextValue>(PORTAL_NAME, {\n  forceMount: undefined,\n});\n\ntype PortalProps = React.ComponentPropsWithoutRef<typeof PortalPrimitive>;\ninterface TooltipPortalProps {\n  children?: React.ReactNode;\n  /**\n   * Specify a container element to portal the content into.\n   */\n  container?: PortalProps['container'];\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst TooltipPortal: React.FC<TooltipPortalProps> = (props: ScopedProps<TooltipPortalProps>) => {\n  const { __scopeTooltip, forceMount, children, container } = props;\n  const context = useTooltipContext(PORTAL_NAME, __scopeTooltip);\n  return (\n    <PortalProvider scope={__scopeTooltip} forceMount={forceMount}>\n      <Presence present={forceMount || context.open}>\n        <PortalPrimitive asChild container={container}>\n          {children}\n        </PortalPrimitive>\n      </Presence>\n    </PortalProvider>\n  );\n};\n\nTooltipPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * TooltipContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'TooltipContent';\n\ntype TooltipContentElement = TooltipContentImplElement;\ninterface TooltipContentProps extends TooltipContentImplProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst TooltipContent = React.forwardRef<TooltipContentElement, TooltipContentProps>(\n  (props: ScopedProps<TooltipContentProps>, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopeTooltip);\n    const { forceMount = portalContext.forceMount, side = 'top', ...contentProps } = props;\n    const context = useTooltipContext(CONTENT_NAME, props.__scopeTooltip);\n\n    return (\n      <Presence present={forceMount || context.open}>\n        {context.disableHoverableContent ? (\n          <TooltipContentImpl side={side} {...contentProps} ref={forwardedRef} />\n        ) : (\n          <TooltipContentHoverable side={side} {...contentProps} ref={forwardedRef} />\n        )}\n      </Presence>\n    );\n  }\n);\n\ntype Point = { x: number; y: number };\ntype Polygon = Point[];\n\ntype TooltipContentHoverableElement = TooltipContentImplElement;\ninterface TooltipContentHoverableProps extends TooltipContentImplProps {}\n\nconst TooltipContentHoverable = React.forwardRef<\n  TooltipContentHoverableElement,\n  TooltipContentHoverableProps\n>((props: ScopedProps<TooltipContentHoverableProps>, forwardedRef) => {\n  const context = useTooltipContext(CONTENT_NAME, props.__scopeTooltip);\n  const providerContext = useTooltipProviderContext(CONTENT_NAME, props.__scopeTooltip);\n  const ref = React.useRef<TooltipContentHoverableElement>(null);\n  const composedRefs = useComposedRefs(forwardedRef, ref);\n  const [pointerGraceArea, setPointerGraceArea] = React.useState<Polygon | null>(null);\n\n  const { trigger, onClose } = context;\n  const content = ref.current;\n\n  const { onPointerInTransitChange } = providerContext;\n\n  const handleRemoveGraceArea = React.useCallback(() => {\n    setPointerGraceArea(null);\n    onPointerInTransitChange(false);\n  }, [onPointerInTransitChange]);\n\n  const handleCreateGraceArea = React.useCallback(\n    (event: PointerEvent, hoverTarget: HTMLElement) => {\n      const currentTarget = event.currentTarget as HTMLElement;\n      const exitPoint = { x: event.clientX, y: event.clientY };\n      const exitSide = getExitSideFromRect(exitPoint, currentTarget.getBoundingClientRect());\n      const paddedExitPoints = getPaddedExitPoints(exitPoint, exitSide);\n      const hoverTargetPoints = getPointsFromRect(hoverTarget.getBoundingClientRect());\n      const graceArea = getHull([...paddedExitPoints, ...hoverTargetPoints]);\n      setPointerGraceArea(graceArea);\n      onPointerInTransitChange(true);\n    },\n    [onPointerInTransitChange]\n  );\n\n  React.useEffect(() => {\n    return () => handleRemoveGraceArea();\n  }, [handleRemoveGraceArea]);\n\n  React.useEffect(() => {\n    if (trigger && content) {\n      const handleTriggerLeave = (event: PointerEvent) => handleCreateGraceArea(event, content);\n      const handleContentLeave = (event: PointerEvent) => handleCreateGraceArea(event, trigger);\n\n      trigger.addEventListener('pointerleave', handleTriggerLeave);\n      content.addEventListener('pointerleave', handleContentLeave);\n      return () => {\n        trigger.removeEventListener('pointerleave', handleTriggerLeave);\n        content.removeEventListener('pointerleave', handleContentLeave);\n      };\n    }\n  }, [trigger, content, handleCreateGraceArea, handleRemoveGraceArea]);\n\n  React.useEffect(() => {\n    if (pointerGraceArea) {\n      const handleTrackPointerGrace = (event: PointerEvent) => {\n        const target = event.target as HTMLElement;\n        const pointerPosition = { x: event.clientX, y: event.clientY };\n        const hasEnteredTarget = trigger?.contains(target) || content?.contains(target);\n        const isPointerOutsideGraceArea = !isPointInPolygon(pointerPosition, pointerGraceArea);\n\n        if (hasEnteredTarget) {\n          handleRemoveGraceArea();\n        } else if (isPointerOutsideGraceArea) {\n          handleRemoveGraceArea();\n          onClose();\n        }\n      };\n      document.addEventListener('pointermove', handleTrackPointerGrace);\n      return () => document.removeEventListener('pointermove', handleTrackPointerGrace);\n    }\n  }, [trigger, content, pointerGraceArea, onClose, handleRemoveGraceArea]);\n\n  return <TooltipContentImpl {...props} ref={composedRefs} />;\n});\n\nconst [VisuallyHiddenContentContextProvider, useVisuallyHiddenContentContext] =\n  createTooltipContext(TOOLTIP_NAME, { isInside: false });\n\ntype TooltipContentImplElement = React.ComponentRef<typeof PopperPrimitive.Content>;\ntype DismissableLayerProps = React.ComponentPropsWithoutRef<typeof DismissableLayer>;\ntype PopperContentProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Content>;\ninterface TooltipContentImplProps extends Omit<PopperContentProps, 'onPlaced'> {\n  /**\n   * A more descriptive label for accessibility purpose\n   */\n  'aria-label'?: string;\n\n  /**\n   * Event handler called when the escape key is down.\n   * Can be prevented.\n   */\n  onEscapeKeyDown?: DismissableLayerProps['onEscapeKeyDown'];\n  /**\n   * Event handler called when the a `pointerdown` event happens outside of the `Tooltip`.\n   * Can be prevented.\n   */\n  onPointerDownOutside?: DismissableLayerProps['onPointerDownOutside'];\n}\n\nconst Slottable = createSlottable('TooltipContent');\n\nconst TooltipContentImpl = React.forwardRef<TooltipContentImplElement, TooltipContentImplProps>(\n  (props: ScopedProps<TooltipContentImplProps>, forwardedRef) => {\n    const {\n      __scopeTooltip,\n      children,\n      'aria-label': ariaLabel,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      ...contentProps\n    } = props;\n    const context = useTooltipContext(CONTENT_NAME, __scopeTooltip);\n    const popperScope = usePopperScope(__scopeTooltip);\n    const { onClose } = context;\n\n    // Close this tooltip if another one opens\n    React.useEffect(() => {\n      document.addEventListener(TOOLTIP_OPEN, onClose);\n      return () => document.removeEventListener(TOOLTIP_OPEN, onClose);\n    }, [onClose]);\n\n    // Close the tooltip if the trigger is scrolled\n    React.useEffect(() => {\n      if (context.trigger) {\n        const handleScroll = (event: Event) => {\n          const target = event.target as HTMLElement;\n          if (target?.contains(context.trigger)) onClose();\n        };\n        window.addEventListener('scroll', handleScroll, { capture: true });\n        return () => window.removeEventListener('scroll', handleScroll, { capture: true });\n      }\n    }, [context.trigger, onClose]);\n\n    return (\n      <DismissableLayer\n        asChild\n        disableOutsidePointerEvents={false}\n        onEscapeKeyDown={onEscapeKeyDown}\n        onPointerDownOutside={onPointerDownOutside}\n        onFocusOutside={(event) => event.preventDefault()}\n        onDismiss={onClose}\n      >\n        <PopperPrimitive.Content\n          data-state={context.stateAttribute}\n          {...popperScope}\n          {...contentProps}\n          ref={forwardedRef}\n          style={{\n            ...contentProps.style,\n            // re-namespace exposed content custom properties\n            ...{\n              '--radix-tooltip-content-transform-origin': 'var(--radix-popper-transform-origin)',\n              '--radix-tooltip-content-available-width': 'var(--radix-popper-available-width)',\n              '--radix-tooltip-content-available-height': 'var(--radix-popper-available-height)',\n              '--radix-tooltip-trigger-width': 'var(--radix-popper-anchor-width)',\n              '--radix-tooltip-trigger-height': 'var(--radix-popper-anchor-height)',\n            },\n          }}\n        >\n          <Slottable>{children}</Slottable>\n          <VisuallyHiddenContentContextProvider scope={__scopeTooltip} isInside={true}>\n            <VisuallyHiddenPrimitive.Root id={context.contentId} role=\"tooltip\">\n              {ariaLabel || children}\n            </VisuallyHiddenPrimitive.Root>\n          </VisuallyHiddenContentContextProvider>\n        </PopperPrimitive.Content>\n      </DismissableLayer>\n    );\n  }\n);\n\nTooltipContent.displayName = CONTENT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * TooltipArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'TooltipArrow';\n\ntype TooltipArrowElement = React.ComponentRef<typeof PopperPrimitive.Arrow>;\ntype PopperArrowProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Arrow>;\ninterface TooltipArrowProps extends PopperArrowProps {}\n\nconst TooltipArrow = React.forwardRef<TooltipArrowElement, TooltipArrowProps>(\n  (props: ScopedProps<TooltipArrowProps>, forwardedRef) => {\n    const { __scopeTooltip, ...arrowProps } = props;\n    const popperScope = usePopperScope(__scopeTooltip);\n    const visuallyHiddenContentContext = useVisuallyHiddenContentContext(\n      ARROW_NAME,\n      __scopeTooltip\n    );\n    // if the arrow is inside the `VisuallyHidden`, we don't want to render it all to\n    // prevent issues in positioning the arrow due to the duplicate\n    return visuallyHiddenContentContext.isInside ? null : (\n      <PopperPrimitive.Arrow {...popperScope} {...arrowProps} ref={forwardedRef} />\n    );\n  }\n);\n\nTooltipArrow.displayName = ARROW_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype Side = NonNullable<TooltipContentProps['side']>;\n\nfunction getExitSideFromRect(point: Point, rect: DOMRect): Side {\n  const top = Math.abs(rect.top - point.y);\n  const bottom = Math.abs(rect.bottom - point.y);\n  const right = Math.abs(rect.right - point.x);\n  const left = Math.abs(rect.left - point.x);\n\n  switch (Math.min(top, bottom, right, left)) {\n    case left:\n      return 'left';\n    case right:\n      return 'right';\n    case top:\n      return 'top';\n    case bottom:\n      return 'bottom';\n    default:\n      throw new Error('unreachable');\n  }\n}\n\nfunction getPaddedExitPoints(exitPoint: Point, exitSide: Side, padding = 5) {\n  const paddedExitPoints: Point[] = [];\n  switch (exitSide) {\n    case 'top':\n      paddedExitPoints.push(\n        { x: exitPoint.x - padding, y: exitPoint.y + padding },\n        { x: exitPoint.x + padding, y: exitPoint.y + padding }\n      );\n      break;\n    case 'bottom':\n      paddedExitPoints.push(\n        { x: exitPoint.x - padding, y: exitPoint.y - padding },\n        { x: exitPoint.x + padding, y: exitPoint.y - padding }\n      );\n      break;\n    case 'left':\n      paddedExitPoints.push(\n        { x: exitPoint.x + padding, y: exitPoint.y - padding },\n        { x: exitPoint.x + padding, y: exitPoint.y + padding }\n      );\n      break;\n    case 'right':\n      paddedExitPoints.push(\n        { x: exitPoint.x - padding, y: exitPoint.y - padding },\n        { x: exitPoint.x - padding, y: exitPoint.y + padding }\n      );\n      break;\n  }\n  return paddedExitPoints;\n}\n\nfunction getPointsFromRect(rect: DOMRect) {\n  const { top, right, bottom, left } = rect;\n  return [\n    { x: left, y: top },\n    { x: right, y: top },\n    { x: right, y: bottom },\n    { x: left, y: bottom },\n  ];\n}\n\n// Determine if a point is inside of a polygon.\n// Based on https://github.com/substack/point-in-polygon\nfunction isPointInPolygon(point: Point, polygon: Polygon) {\n  const { x, y } = point;\n  let inside = false;\n  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n    const ii = polygon[i]!;\n    const jj = polygon[j]!;\n    const xi = ii.x;\n    const yi = ii.y;\n    const xj = jj.x;\n    const yj = jj.y;\n\n    // prettier-ignore\n    const intersect = ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n    if (intersect) inside = !inside;\n  }\n\n  return inside;\n}\n\n// Returns a new array of points representing the convex hull of the given set of points.\n// https://www.nayuki.io/page/convex-hull-algorithm\nfunction getHull<P extends Point>(points: Readonly<Array<P>>): Array<P> {\n  const newPoints: Array<P> = points.slice();\n  newPoints.sort((a: Point, b: Point) => {\n    if (a.x < b.x) return -1;\n    else if (a.x > b.x) return +1;\n    else if (a.y < b.y) return -1;\n    else if (a.y > b.y) return +1;\n    else return 0;\n  });\n  return getHullPresorted(newPoints);\n}\n\n// Returns the convex hull, assuming that each points[i] <= points[i + 1]. Runs in O(n) time.\nfunction getHullPresorted<P extends Point>(points: Readonly<Array<P>>): Array<P> {\n  if (points.length <= 1) return points.slice();\n\n  const upperHull: Array<P> = [];\n  for (let i = 0; i < points.length; i++) {\n    const p = points[i]!;\n    while (upperHull.length >= 2) {\n      const q = upperHull[upperHull.length - 1]!;\n      const r = upperHull[upperHull.length - 2]!;\n      if ((q.x - r.x) * (p.y - r.y) >= (q.y - r.y) * (p.x - r.x)) upperHull.pop();\n      else break;\n    }\n    upperHull.push(p);\n  }\n  upperHull.pop();\n\n  const lowerHull: Array<P> = [];\n  for (let i = points.length - 1; i >= 0; i--) {\n    const p = points[i]!;\n    while (lowerHull.length >= 2) {\n      const q = lowerHull[lowerHull.length - 1]!;\n      const r = lowerHull[lowerHull.length - 2]!;\n      if ((q.x - r.x) * (p.y - r.y) >= (q.y - r.y) * (p.x - r.x)) lowerHull.pop();\n      else break;\n    }\n    lowerHull.push(p);\n  }\n  lowerHull.pop();\n\n  if (\n    upperHull.length === 1 &&\n    lowerHull.length === 1 &&\n    upperHull[0]!.x === lowerHull[0]!.x &&\n    upperHull[0]!.y === lowerHull[0]!.y\n  ) {\n    return upperHull;\n  } else {\n    return upperHull.concat(lowerHull);\n  }\n}\n\nconst Provider = TooltipProvider;\nconst Root = Tooltip;\nconst Trigger = TooltipTrigger;\nconst Portal = TooltipPortal;\nconst Content = TooltipContent;\nconst Arrow = TooltipArrow;\n\nexport {\n  createTooltipScope,\n  //\n  TooltipProvider,\n  Tooltip,\n  TooltipTrigger,\n  TooltipPortal,\n  TooltipContent,\n  TooltipArrow,\n  //\n  Provider,\n  Root,\n  Trigger,\n  Portal,\n  Content,\n  Arrow,\n};\nexport type {\n  TooltipProviderProps,\n  TooltipProps,\n  TooltipTriggerProps,\n  TooltipPortalProps,\n  TooltipContentProps,\n  TooltipArrowProps,\n};\n", "/* eslint-disable no-restricted-properties */\n\n/* eslint-disable no-restricted-globals */\nexport const canUseDOM = !!(\n  typeof window !== 'undefined' &&\n  window.document &&\n  window.document.createElement\n);\n/* eslint-enable no-restricted-globals */\n\nexport function composeEventHandlers<E extends { defaultPrevented: boolean }>(\n  originalEventHandler?: (event: E) => void,\n  ourEventHandler?: (event: E) => void,\n  { checkForDefaultPrevented = true } = {}\n) {\n  return function handleEvent(event: E) {\n    originalEventHandler?.(event);\n\n    if (checkForDefaultPrevented === false || !event.defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n}\n\nexport function getOwnerWindow(element: Node | null | undefined) {\n  if (!canUseDOM) {\n    throw new Error('Cannot access window outside of the DOM');\n  }\n  // eslint-disable-next-line no-restricted-globals\n  return element?.ownerDocument?.defaultView ?? window;\n}\n\nexport function getOwnerDocument(element: Node | null | undefined) {\n  if (!canUseDOM) {\n    throw new Error('Cannot access document outside of the DOM');\n  }\n  // eslint-disable-next-line no-restricted-globals\n  return element?.ownerDocument ?? document;\n}\n\n/**\n * Lifted from https://github.com/ariakit/ariakit/blob/main/packages/ariakit-core/src/utils/dom.ts#L37\n * MIT License, Copyright (c) AriaKit.\n */\nexport function getActiveElement(\n  node: Node | null | undefined,\n  activeDescendant = false\n): HTMLElement | null {\n  const { activeElement } = getOwnerDocument(node);\n  if (!activeElement?.nodeName) {\n    // `activeElement` might be an empty object if we're interacting with elements\n    // inside of an iframe.\n    return null;\n  }\n\n  if (isFrame(activeElement) && activeElement.contentDocument) {\n    return getActiveElement(activeElement.contentDocument.body, activeDescendant);\n  }\n\n  if (activeDescendant) {\n    const id = activeElement.getAttribute('aria-activedescendant');\n    if (id) {\n      const element = getOwnerDocument(activeElement).getElementById(id);\n      if (element) {\n        return element;\n      }\n    }\n  }\n\n  return activeElement as HTMLElement | null;\n}\n\nexport function isFrame(element: Element): element is HTMLIFrameElement {\n  return element.tagName === 'IFRAME';\n}\n", "import * as React from 'react';\n\nfunction createContext<ContextValueType extends object | null>(\n  rootComponentName: string,\n  defaultContext?: ContextValueType\n) {\n  const Context = React.createContext<ContextValueType | undefined>(defaultContext);\n\n  const Provider: React.FC<ContextValueType & { children: React.ReactNode }> = (props) => {\n    const { children, ...context } = props;\n    // Only re-memoize when prop values change\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    const value = React.useMemo(() => context, Object.values(context)) as ContextValueType;\n    return <Context.Provider value={value}>{children}</Context.Provider>;\n  };\n\n  Provider.displayName = rootComponentName + 'Provider';\n\n  function useContext(consumerName: string) {\n    const context = React.useContext(Context);\n    if (context) return context;\n    if (defaultContext !== undefined) return defaultContext;\n    // if a defaultContext wasn't specified, it's a required context.\n    throw new Error(`\\`${consumerName}\\` must be used within \\`${rootComponentName}\\``);\n  }\n\n  return [Provider, useContext] as const;\n}\n\n/* -------------------------------------------------------------------------------------------------\n * createContextScope\n * -----------------------------------------------------------------------------------------------*/\n\ntype Scope<C = any> = { [scopeName: string]: React.Context<C>[] } | undefined;\ntype ScopeHook = (scope: Scope) => { [__scopeProp: string]: Scope };\ninterface CreateScope {\n  scopeName: string;\n  (): ScopeHook;\n}\n\nfunction createContextScope(scopeName: string, createContextScopeDeps: CreateScope[] = []) {\n  let defaultContexts: any[] = [];\n\n  /* -----------------------------------------------------------------------------------------------\n   * createContext\n   * ---------------------------------------------------------------------------------------------*/\n\n  function createContext<ContextValueType extends object | null>(\n    rootComponentName: string,\n    defaultContext?: ContextValueType\n  ) {\n    const BaseContext = React.createContext<ContextValueType | undefined>(defaultContext);\n    const index = defaultContexts.length;\n    defaultContexts = [...defaultContexts, defaultContext];\n\n    const Provider: React.FC<\n      ContextValueType & { scope: Scope<ContextValueType>; children: React.ReactNode }\n    > = (props) => {\n      const { scope, children, ...context } = props;\n      const Context = scope?.[scopeName]?.[index] || BaseContext;\n      // Only re-memoize when prop values change\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      const value = React.useMemo(() => context, Object.values(context)) as ContextValueType;\n      return <Context.Provider value={value}>{children}</Context.Provider>;\n    };\n\n    Provider.displayName = rootComponentName + 'Provider';\n\n    function useContext(consumerName: string, scope: Scope<ContextValueType | undefined>) {\n      const Context = scope?.[scopeName]?.[index] || BaseContext;\n      const context = React.useContext(Context);\n      if (context) return context;\n      if (defaultContext !== undefined) return defaultContext;\n      // if a defaultContext wasn't specified, it's a required context.\n      throw new Error(`\\`${consumerName}\\` must be used within \\`${rootComponentName}\\``);\n    }\n\n    return [Provider, useContext] as const;\n  }\n\n  /* -----------------------------------------------------------------------------------------------\n   * createScope\n   * ---------------------------------------------------------------------------------------------*/\n\n  const createScope: CreateScope = () => {\n    const scopeContexts = defaultContexts.map((defaultContext) => {\n      return React.createContext(defaultContext);\n    });\n    return function useScope(scope: Scope) {\n      const contexts = scope?.[scopeName] || scopeContexts;\n      return React.useMemo(\n        () => ({ [`__scope${scopeName}`]: { ...scope, [scopeName]: contexts } }),\n        [scope, contexts]\n      );\n    };\n  };\n\n  createScope.scopeName = scopeName;\n  return [createContext, composeContextScopes(createScope, ...createContextScopeDeps)] as const;\n}\n\n/* -------------------------------------------------------------------------------------------------\n * composeContextScopes\n * -----------------------------------------------------------------------------------------------*/\n\nfunction composeContextScopes(...scopes: CreateScope[]) {\n  const baseScope = scopes[0];\n  if (scopes.length === 1) return baseScope;\n\n  const createScope: CreateScope = () => {\n    const scopeHooks = scopes.map((createScope) => ({\n      useScope: createScope(),\n      scopeName: createScope.scopeName,\n    }));\n\n    return function useComposedScopes(overrideScopes) {\n      const nextScopes = scopeHooks.reduce((nextScopes, { useScope, scopeName }) => {\n        // We are calling a hook inside a callback which React warns against to avoid inconsistent\n        // renders, however, scoping doesn't have render side effects so we ignore the rule.\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        const scopeProps = useScope(overrideScopes);\n        const currentScope = scopeProps[`__scope${scopeName}`];\n        return { ...nextScopes, ...currentScope };\n      }, {});\n\n      return React.useMemo(() => ({ [`__scope${baseScope.scopeName}`]: nextScopes }), [nextScopes]);\n    };\n  };\n\n  createScope.scopeName = baseScope.scopeName;\n  return createScope;\n}\n\n/* -----------------------------------------------------------------------------------------------*/\n\nexport { createContext, createContextScope };\nexport type { CreateScope, Scope };\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { Primitive, dispatchDiscreteCustomEvent } from '@radix-ui/react-primitive';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { useEscapeKeydown } from '@radix-ui/react-use-escape-keydown';\n\n/* -------------------------------------------------------------------------------------------------\n * DismissableLayer\n * -----------------------------------------------------------------------------------------------*/\n\nconst DISMISSABLE_LAYER_NAME = 'DismissableLayer';\nconst CONTEXT_UPDATE = 'dismissableLayer.update';\nconst POINTER_DOWN_OUTSIDE = 'dismissableLayer.pointerDownOutside';\nconst FOCUS_OUTSIDE = 'dismissableLayer.focusOutside';\n\nlet originalBodyPointerEvents: string;\n\nconst DismissableLayerContext = React.createContext({\n  layers: new Set<DismissableLayerElement>(),\n  layersWithOutsidePointerEventsDisabled: new Set<DismissableLayerElement>(),\n  branches: new Set<DismissableLayerBranchElement>(),\n});\n\ntype DismissableLayerElement = React.ComponentRef<typeof Primitive.div>;\ntype PrimitiveDivProps = React.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface DismissableLayerProps extends PrimitiveDivProps {\n  /**\n   * When `true`, hover/focus/click interactions will be disabled on elements outside\n   * the `DismissableLayer`. Users will need to click twice on outside elements to\n   * interact with them: once to close the `DismissableLayer`, and again to trigger the element.\n   */\n  disableOutsidePointerEvents?: boolean;\n  /**\n   * Event handler called when the escape key is down.\n   * Can be prevented.\n   */\n  onEscapeKeyDown?: (event: KeyboardEvent) => void;\n  /**\n   * Event handler called when the a `pointerdown` event happens outside of the `DismissableLayer`.\n   * Can be prevented.\n   */\n  onPointerDownOutside?: (event: PointerDownOutsideEvent) => void;\n  /**\n   * Event handler called when the focus moves outside of the `DismissableLayer`.\n   * Can be prevented.\n   */\n  onFocusOutside?: (event: FocusOutsideEvent) => void;\n  /**\n   * Event handler called when an interaction happens outside the `DismissableLayer`.\n   * Specifically, when a `pointerdown` event happens outside or focus moves outside of it.\n   * Can be prevented.\n   */\n  onInteractOutside?: (event: PointerDownOutsideEvent | FocusOutsideEvent) => void;\n  /**\n   * Handler called when the `DismissableLayer` should be dismissed\n   */\n  onDismiss?: () => void;\n}\n\nconst DismissableLayer = React.forwardRef<DismissableLayerElement, DismissableLayerProps>(\n  (props, forwardedRef) => {\n    const {\n      disableOutsidePointerEvents = false,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      onFocusOutside,\n      onInteractOutside,\n      onDismiss,\n      ...layerProps\n    } = props;\n    const context = React.useContext(DismissableLayerContext);\n    const [node, setNode] = React.useState<DismissableLayerElement | null>(null);\n    const ownerDocument = node?.ownerDocument ?? globalThis?.document;\n    const [, force] = React.useState({});\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setNode(node));\n    const layers = Array.from(context.layers);\n    const [highestLayerWithOutsidePointerEventsDisabled] = [...context.layersWithOutsidePointerEventsDisabled].slice(-1); // prettier-ignore\n    const highestLayerWithOutsidePointerEventsDisabledIndex = layers.indexOf(highestLayerWithOutsidePointerEventsDisabled!); // prettier-ignore\n    const index = node ? layers.indexOf(node) : -1;\n    const isBodyPointerEventsDisabled = context.layersWithOutsidePointerEventsDisabled.size > 0;\n    const isPointerEventsEnabled = index >= highestLayerWithOutsidePointerEventsDisabledIndex;\n\n    const pointerDownOutside = usePointerDownOutside((event) => {\n      const target = event.target as HTMLElement;\n      const isPointerDownOnBranch = [...context.branches].some((branch) => branch.contains(target));\n      if (!isPointerEventsEnabled || isPointerDownOnBranch) return;\n      onPointerDownOutside?.(event);\n      onInteractOutside?.(event);\n      if (!event.defaultPrevented) onDismiss?.();\n    }, ownerDocument);\n\n    const focusOutside = useFocusOutside((event) => {\n      const target = event.target as HTMLElement;\n      const isFocusInBranch = [...context.branches].some((branch) => branch.contains(target));\n      if (isFocusInBranch) return;\n      onFocusOutside?.(event);\n      onInteractOutside?.(event);\n      if (!event.defaultPrevented) onDismiss?.();\n    }, ownerDocument);\n\n    useEscapeKeydown((event) => {\n      const isHighestLayer = index === context.layers.size - 1;\n      if (!isHighestLayer) return;\n      onEscapeKeyDown?.(event);\n      if (!event.defaultPrevented && onDismiss) {\n        event.preventDefault();\n        onDismiss();\n      }\n    }, ownerDocument);\n\n    React.useEffect(() => {\n      if (!node) return;\n      if (disableOutsidePointerEvents) {\n        if (context.layersWithOutsidePointerEventsDisabled.size === 0) {\n          originalBodyPointerEvents = ownerDocument.body.style.pointerEvents;\n          ownerDocument.body.style.pointerEvents = 'none';\n        }\n        context.layersWithOutsidePointerEventsDisabled.add(node);\n      }\n      context.layers.add(node);\n      dispatchUpdate();\n      return () => {\n        if (\n          disableOutsidePointerEvents &&\n          context.layersWithOutsidePointerEventsDisabled.size === 1\n        ) {\n          ownerDocument.body.style.pointerEvents = originalBodyPointerEvents;\n        }\n      };\n    }, [node, ownerDocument, disableOutsidePointerEvents, context]);\n\n    /**\n     * We purposefully prevent combining this effect with the `disableOutsidePointerEvents` effect\n     * because a change to `disableOutsidePointerEvents` would remove this layer from the stack\n     * and add it to the end again so the layering order wouldn't be _creation order_.\n     * We only want them to be removed from context stacks when unmounted.\n     */\n    React.useEffect(() => {\n      return () => {\n        if (!node) return;\n        context.layers.delete(node);\n        context.layersWithOutsidePointerEventsDisabled.delete(node);\n        dispatchUpdate();\n      };\n    }, [node, context]);\n\n    React.useEffect(() => {\n      const handleUpdate = () => force({});\n      document.addEventListener(CONTEXT_UPDATE, handleUpdate);\n      return () => document.removeEventListener(CONTEXT_UPDATE, handleUpdate);\n    }, []);\n\n    return (\n      <Primitive.div\n        {...layerProps}\n        ref={composedRefs}\n        style={{\n          pointerEvents: isBodyPointerEventsDisabled\n            ? isPointerEventsEnabled\n              ? 'auto'\n              : 'none'\n            : undefined,\n          ...props.style,\n        }}\n        onFocusCapture={composeEventHandlers(props.onFocusCapture, focusOutside.onFocusCapture)}\n        onBlurCapture={composeEventHandlers(props.onBlurCapture, focusOutside.onBlurCapture)}\n        onPointerDownCapture={composeEventHandlers(\n          props.onPointerDownCapture,\n          pointerDownOutside.onPointerDownCapture\n        )}\n      />\n    );\n  }\n);\n\nDismissableLayer.displayName = DISMISSABLE_LAYER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DismissableLayerBranch\n * -----------------------------------------------------------------------------------------------*/\n\nconst BRANCH_NAME = 'DismissableLayerBranch';\n\ntype DismissableLayerBranchElement = React.ComponentRef<typeof Primitive.div>;\ninterface DismissableLayerBranchProps extends PrimitiveDivProps {}\n\nconst DismissableLayerBranch = React.forwardRef<\n  DismissableLayerBranchElement,\n  DismissableLayerBranchProps\n>((props, forwardedRef) => {\n  const context = React.useContext(DismissableLayerContext);\n  const ref = React.useRef<DismissableLayerBranchElement>(null);\n  const composedRefs = useComposedRefs(forwardedRef, ref);\n\n  React.useEffect(() => {\n    const node = ref.current;\n    if (node) {\n      context.branches.add(node);\n      return () => {\n        context.branches.delete(node);\n      };\n    }\n  }, [context.branches]);\n\n  return <Primitive.div {...props} ref={composedRefs} />;\n});\n\nDismissableLayerBranch.displayName = BRANCH_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype PointerDownOutsideEvent = CustomEvent<{ originalEvent: PointerEvent }>;\ntype FocusOutsideEvent = CustomEvent<{ originalEvent: FocusEvent }>;\n\n/**\n * Listens for `pointerdown` outside a react subtree. We use `pointerdown` rather than `pointerup`\n * to mimic layer dismissing behaviour present in OS.\n * Returns props to pass to the node we want to check for outside events.\n */\nfunction usePointerDownOutside(\n  onPointerDownOutside?: (event: PointerDownOutsideEvent) => void,\n  ownerDocument: Document = globalThis?.document\n) {\n  const handlePointerDownOutside = useCallbackRef(onPointerDownOutside) as EventListener;\n  const isPointerInsideReactTreeRef = React.useRef(false);\n  const handleClickRef = React.useRef(() => {});\n\n  React.useEffect(() => {\n    const handlePointerDown = (event: PointerEvent) => {\n      if (event.target && !isPointerInsideReactTreeRef.current) {\n        const eventDetail = { originalEvent: event };\n\n        function handleAndDispatchPointerDownOutsideEvent() {\n          handleAndDispatchCustomEvent(\n            POINTER_DOWN_OUTSIDE,\n            handlePointerDownOutside,\n            eventDetail,\n            { discrete: true }\n          );\n        }\n\n        /**\n         * On touch devices, we need to wait for a click event because browsers implement\n         * a ~350ms delay between the time the user stops touching the display and when the\n         * browser executres events. We need to ensure we don't reactivate pointer-events within\n         * this timeframe otherwise the browser may execute events that should have been prevented.\n         *\n         * Additionally, this also lets us deal automatically with cancellations when a click event\n         * isn't raised because the page was considered scrolled/drag-scrolled, long-pressed, etc.\n         *\n         * This is why we also continuously remove the previous listener, because we cannot be\n         * certain that it was raised, and therefore cleaned-up.\n         */\n        if (event.pointerType === 'touch') {\n          ownerDocument.removeEventListener('click', handleClickRef.current);\n          handleClickRef.current = handleAndDispatchPointerDownOutsideEvent;\n          ownerDocument.addEventListener('click', handleClickRef.current, { once: true });\n        } else {\n          handleAndDispatchPointerDownOutsideEvent();\n        }\n      } else {\n        // We need to remove the event listener in case the outside click has been canceled.\n        // See: https://github.com/radix-ui/primitives/issues/2171\n        ownerDocument.removeEventListener('click', handleClickRef.current);\n      }\n      isPointerInsideReactTreeRef.current = false;\n    };\n    /**\n     * if this hook executes in a component that mounts via a `pointerdown` event, the event\n     * would bubble up to the document and trigger a `pointerDownOutside` event. We avoid\n     * this by delaying the event listener registration on the document.\n     * This is not React specific, but rather how the DOM works, ie:\n     * ```\n     * button.addEventListener('pointerdown', () => {\n     *   console.log('I will log');\n     *   document.addEventListener('pointerdown', () => {\n     *     console.log('I will also log');\n     *   })\n     * });\n     */\n    const timerId = window.setTimeout(() => {\n      ownerDocument.addEventListener('pointerdown', handlePointerDown);\n    }, 0);\n    return () => {\n      window.clearTimeout(timerId);\n      ownerDocument.removeEventListener('pointerdown', handlePointerDown);\n      ownerDocument.removeEventListener('click', handleClickRef.current);\n    };\n  }, [ownerDocument, handlePointerDownOutside]);\n\n  return {\n    // ensures we check React component tree (not just DOM tree)\n    onPointerDownCapture: () => (isPointerInsideReactTreeRef.current = true),\n  };\n}\n\n/**\n * Listens for when focus happens outside a react subtree.\n * Returns props to pass to the root (node) of the subtree we want to check.\n */\nfunction useFocusOutside(\n  onFocusOutside?: (event: FocusOutsideEvent) => void,\n  ownerDocument: Document = globalThis?.document\n) {\n  const handleFocusOutside = useCallbackRef(onFocusOutside) as EventListener;\n  const isFocusInsideReactTreeRef = React.useRef(false);\n\n  React.useEffect(() => {\n    const handleFocus = (event: FocusEvent) => {\n      if (event.target && !isFocusInsideReactTreeRef.current) {\n        const eventDetail = { originalEvent: event };\n        handleAndDispatchCustomEvent(FOCUS_OUTSIDE, handleFocusOutside, eventDetail, {\n          discrete: false,\n        });\n      }\n    };\n    ownerDocument.addEventListener('focusin', handleFocus);\n    return () => ownerDocument.removeEventListener('focusin', handleFocus);\n  }, [ownerDocument, handleFocusOutside]);\n\n  return {\n    onFocusCapture: () => (isFocusInsideReactTreeRef.current = true),\n    onBlurCapture: () => (isFocusInsideReactTreeRef.current = false),\n  };\n}\n\nfunction dispatchUpdate() {\n  const event = new CustomEvent(CONTEXT_UPDATE);\n  document.dispatchEvent(event);\n}\n\nfunction handleAndDispatchCustomEvent<E extends CustomEvent, OriginalEvent extends Event>(\n  name: string,\n  handler: ((event: E) => void) | undefined,\n  detail: { originalEvent: OriginalEvent } & (E extends CustomEvent<infer D> ? D : never),\n  { discrete }: { discrete: boolean }\n) {\n  const target = detail.originalEvent.target;\n  const event = new CustomEvent(name, { bubbles: false, cancelable: true, detail });\n  if (handler) target.addEventListener(name, handler as EventListener, { once: true });\n\n  if (discrete) {\n    dispatchDiscreteCustomEvent(target, event);\n  } else {\n    target.dispatchEvent(event);\n  }\n}\n\nconst Root = DismissableLayer;\nconst Branch = DismissableLayerBranch;\n\nexport {\n  DismissableLayer,\n  DismissableLayerBranch,\n  //\n  Root,\n  Branch,\n};\nexport type { DismissableLayerProps };\n", "import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { createSlot } from '@radix-ui/react-slot';\n\nconst NODES = [\n  'a',\n  'button',\n  'div',\n  'form',\n  'h2',\n  'h3',\n  'img',\n  'input',\n  'label',\n  'li',\n  'nav',\n  'ol',\n  'p',\n  'select',\n  'span',\n  'svg',\n  'ul',\n] as const;\n\ntype Primitives = { [E in (typeof NODES)[number]]: PrimitiveForwardRefComponent<E> };\ntype PrimitivePropsWithRef<E extends React.ElementType> = React.ComponentPropsWithRef<E> & {\n  asChild?: boolean;\n};\n\ninterface PrimitiveForwardRefComponent<E extends React.ElementType>\n  extends React.ForwardRefExoticComponent<PrimitivePropsWithRef<E>> {}\n\n/* -------------------------------------------------------------------------------------------------\n * Primitive\n * -----------------------------------------------------------------------------------------------*/\n\nconst Primitive = NODES.reduce((primitive, node) => {\n  const Slot = createSlot(`Primitive.${node}`);\n  const Node = React.forwardRef((props: PrimitivePropsWithRef<typeof node>, forwardedRef: any) => {\n    const { asChild, ...primitiveProps } = props;\n    const Comp: any = asChild ? Slot : node;\n\n    if (typeof window !== 'undefined') {\n      (window as any)[Symbol.for('radix-ui')] = true;\n    }\n\n    return <Comp {...primitiveProps} ref={forwardedRef} />;\n  });\n\n  Node.displayName = `Primitive.${node}`;\n\n  return { ...primitive, [node]: Node };\n}, {} as Primitives);\n\n/* -------------------------------------------------------------------------------------------------\n * Utils\n * -----------------------------------------------------------------------------------------------*/\n\n/**\n * Flush custom event dispatch\n * https://github.com/radix-ui/primitives/pull/1378\n *\n * React batches *all* event handlers since version 18, this introduces certain considerations when using custom event types.\n *\n * Internally, React prioritises events in the following order:\n *  - discrete\n *  - continuous\n *  - default\n *\n * https://github.com/facebook/react/blob/a8a4742f1c54493df00da648a3f9d26e3db9c8b5/packages/react-dom/src/events/ReactDOMEventListener.js#L294-L350\n *\n * `discrete` is an  important distinction as updates within these events are applied immediately.\n * React however, is not able to infer the priority of custom event types due to how they are detected internally.\n * Because of this, it's possible for updates from custom events to be unexpectedly batched when\n * dispatched by another `discrete` event.\n *\n * In order to ensure that updates from custom events are applied predictably, we need to manually flush the batch.\n * This utility should be used when dispatching a custom event from within another `discrete` event, this utility\n * is not necessary when dispatching known event types, or if dispatching a custom type inside a non-discrete event.\n * For example:\n *\n * dispatching a known click \uD83D\uDC4E\n * target.dispatchEvent(new Event(\u2018click\u2019))\n *\n * dispatching a custom type within a non-discrete event \uD83D\uDC4E\n * onScroll={(event) => event.target.dispatchEvent(new CustomEvent(\u2018customType\u2019))}\n *\n * dispatching a custom type within a `discrete` event \uD83D\uDC4D\n * onPointerDown={(event) => dispatchDiscreteCustomEvent(event.target, new CustomEvent(\u2018customType\u2019))}\n *\n * Note: though React classifies `focus`, `focusin` and `focusout` events as `discrete`, it's  not recommended to use\n * this utility with them. This is because it's possible for those handlers to be called implicitly during render\n * e.g. when focus is within a component as it is unmounted, or when managing focus on mount.\n */\n\nfunction dispatchDiscreteCustomEvent<E extends CustomEvent>(target: E['target'], event: E) {\n  if (target) ReactDOM.flushSync(() => target.dispatchEvent(event));\n}\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = Primitive;\n\nexport {\n  Primitive,\n  //\n  Root,\n  //\n  dispatchDiscreteCustomEvent,\n};\nexport type { PrimitivePropsWithRef };\n", "import * as React from 'react';\n\n/**\n * A custom hook that converts a callback to a ref to avoid triggering re-renders when passed as a\n * prop or avoid re-executing effects when passed as a dependency\n */\nfunction useCallbackRef<T extends (...args: any[]) => any>(callback: T | undefined): T {\n  const callbackRef = React.useRef(callback);\n\n  React.useEffect(() => {\n    callbackRef.current = callback;\n  });\n\n  // https://github.com/facebook/react/issues/19240\n  return React.useMemo(() => ((...args) => callbackRef.current?.(...args)) as T, []);\n}\n\nexport { useCallbackRef };\n", "import * as React from 'react';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\n\n/**\n * Listens for when the escape key is down\n */\nfunction useEscapeKeydown(\n  onEscapeKeyDownProp?: (event: KeyboardEvent) => void,\n  ownerDocument: Document = globalThis?.document\n) {\n  const onEscapeKeyDown = useCallbackRef(onEscapeKeyDownProp);\n\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onEscapeKeyDown(event);\n      }\n    };\n    ownerDocument.addEventListener('keydown', handleKeyDown, { capture: true });\n    return () => ownerDocument.removeEventListener('keydown', handleKeyDown, { capture: true });\n  }, [onEscapeKeyDown, ownerDocument]);\n}\n\nexport { useEscapeKeydown };\n", "import * as React from 'react';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\n\n// We spaces with `.trim().toString()` to prevent bundlers from trying to `import { useId } from 'react';`\nconst useReactId = (React as any)[' useId '.trim().toString()] || (() => undefined);\nlet count = 0;\n\nfunction useId(deterministicId?: string): string {\n  const [id, setId] = React.useState<string | undefined>(useReactId());\n  // React versions older than 18 will have client-side ids only.\n  useLayoutEffect(() => {\n    if (!deterministicId) setId((reactId) => reactId ?? String(count++));\n  }, [deterministicId]);\n  return deterministicId || (id ? `radix-${id}` : '');\n}\n\nexport { useId };\n", "import * as React from 'react';\n\n/**\n * On the server, React emits a warning when calling `useLayoutEffect`.\n * This is because neither `useLayoutEffect` nor `useEffect` run on the server.\n * We use this safe version which suppresses the warning by replacing it with a noop on the server.\n *\n * See: https://reactjs.org/docs/hooks-reference.html#uselayouteffect\n */\nconst useLayoutEffect = globalThis?.document ? React.useLayoutEffect : () => {};\n\nexport { useLayoutEffect };\n", "import * as React from 'react';\nimport {\n  useFloating,\n  autoUpdate,\n  offset,\n  shift,\n  limitShift,\n  hide,\n  arrow as floatingUIarrow,\n  flip,\n  size,\n} from '@floating-ui/react-dom';\nimport * as ArrowPrimitive from '@radix-ui/react-arrow';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\nimport { useSize } from '@radix-ui/react-use-size';\n\nimport type { Placement, Middleware } from '@floating-ui/react-dom';\nimport type { Scope } from '@radix-ui/react-context';\nimport type { Measurable } from '@radix-ui/rect';\n\nconst SIDE_OPTIONS = ['top', 'right', 'bottom', 'left'] as const;\nconst ALIGN_OPTIONS = ['start', 'center', 'end'] as const;\n\ntype Side = (typeof SIDE_OPTIONS)[number];\ntype Align = (typeof ALIGN_OPTIONS)[number];\n\n/* -------------------------------------------------------------------------------------------------\n * Popper\n * -----------------------------------------------------------------------------------------------*/\n\nconst POPPER_NAME = 'Popper';\n\ntype ScopedProps<P> = P & { __scopePopper?: Scope };\nconst [createPopperContext, createPopperScope] = createContextScope(POPPER_NAME);\n\ntype PopperContextValue = {\n  anchor: Measurable | null;\n  onAnchorChange(anchor: Measurable | null): void;\n};\nconst [PopperProvider, usePopperContext] = createPopperContext<PopperContextValue>(POPPER_NAME);\n\ninterface PopperProps {\n  children?: React.ReactNode;\n}\nconst Popper: React.FC<PopperProps> = (props: ScopedProps<PopperProps>) => {\n  const { __scopePopper, children } = props;\n  const [anchor, setAnchor] = React.useState<Measurable | null>(null);\n  return (\n    <PopperProvider scope={__scopePopper} anchor={anchor} onAnchorChange={setAnchor}>\n      {children}\n    </PopperProvider>\n  );\n};\n\nPopper.displayName = POPPER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopperAnchor\n * -----------------------------------------------------------------------------------------------*/\n\nconst ANCHOR_NAME = 'PopperAnchor';\n\ntype PopperAnchorElement = React.ComponentRef<typeof Primitive.div>;\ntype PrimitiveDivProps = React.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface PopperAnchorProps extends PrimitiveDivProps {\n  virtualRef?: React.RefObject<Measurable>;\n}\n\nconst PopperAnchor = React.forwardRef<PopperAnchorElement, PopperAnchorProps>(\n  (props: ScopedProps<PopperAnchorProps>, forwardedRef) => {\n    const { __scopePopper, virtualRef, ...anchorProps } = props;\n    const context = usePopperContext(ANCHOR_NAME, __scopePopper);\n    const ref = React.useRef<PopperAnchorElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n\n    const anchorRef = React.useRef<Measurable | null>(null);\n    React.useEffect(() => {\n      const previousAnchor = anchorRef.current;\n      anchorRef.current = virtualRef?.current || ref.current;\n      if (previousAnchor !== anchorRef.current) {\n        // Consumer can anchor the popper to something that isn't\n        // a DOM node e.g. pointer position, so we override the\n        // `anchorRef` with their virtual ref in this case.\n        context.onAnchorChange(anchorRef.current);\n      }\n    });\n\n    return virtualRef ? null : <Primitive.div {...anchorProps} ref={composedRefs} />;\n  }\n);\n\nPopperAnchor.displayName = ANCHOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopperContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'PopperContent';\n\ntype PopperContentContextValue = {\n  placedSide: Side;\n  onArrowChange(arrow: HTMLSpanElement | null): void;\n  arrowX?: number;\n  arrowY?: number;\n  shouldHideArrow: boolean;\n};\n\nconst [PopperContentProvider, useContentContext] =\n  createPopperContext<PopperContentContextValue>(CONTENT_NAME);\n\ntype Boundary = Element | null;\n\ntype PopperContentElement = React.ComponentRef<typeof Primitive.div>;\ninterface PopperContentProps extends PrimitiveDivProps {\n  side?: Side;\n  sideOffset?: number;\n  align?: Align;\n  alignOffset?: number;\n  arrowPadding?: number;\n  avoidCollisions?: boolean;\n  collisionBoundary?: Boundary | Boundary[];\n  collisionPadding?: number | Partial<Record<Side, number>>;\n  sticky?: 'partial' | 'always';\n  hideWhenDetached?: boolean;\n  updatePositionStrategy?: 'optimized' | 'always';\n  onPlaced?: () => void;\n}\n\nconst PopperContent = React.forwardRef<PopperContentElement, PopperContentProps>(\n  (props: ScopedProps<PopperContentProps>, forwardedRef) => {\n    const {\n      __scopePopper,\n      side = 'bottom',\n      sideOffset = 0,\n      align = 'center',\n      alignOffset = 0,\n      arrowPadding = 0,\n      avoidCollisions = true,\n      collisionBoundary = [],\n      collisionPadding: collisionPaddingProp = 0,\n      sticky = 'partial',\n      hideWhenDetached = false,\n      updatePositionStrategy = 'optimized',\n      onPlaced,\n      ...contentProps\n    } = props;\n\n    const context = usePopperContext(CONTENT_NAME, __scopePopper);\n\n    const [content, setContent] = React.useState<HTMLDivElement | null>(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));\n\n    const [arrow, setArrow] = React.useState<HTMLSpanElement | null>(null);\n    const arrowSize = useSize(arrow);\n    const arrowWidth = arrowSize?.width ?? 0;\n    const arrowHeight = arrowSize?.height ?? 0;\n\n    const desiredPlacement = (side + (align !== 'center' ? '-' + align : '')) as Placement;\n\n    const collisionPadding =\n      typeof collisionPaddingProp === 'number'\n        ? collisionPaddingProp\n        : { top: 0, right: 0, bottom: 0, left: 0, ...collisionPaddingProp };\n\n    const boundary = Array.isArray(collisionBoundary) ? collisionBoundary : [collisionBoundary];\n    const hasExplicitBoundaries = boundary.length > 0;\n\n    const detectOverflowOptions = {\n      padding: collisionPadding,\n      boundary: boundary.filter(isNotNull),\n      // with `strategy: 'fixed'`, this is the only way to get it to respect boundaries\n      altBoundary: hasExplicitBoundaries,\n    };\n\n    const { refs, floatingStyles, placement, isPositioned, middlewareData } = useFloating({\n      // default to `fixed` strategy so users don't have to pick and we also avoid focus scroll issues\n      strategy: 'fixed',\n      placement: desiredPlacement,\n      whileElementsMounted: (...args) => {\n        const cleanup = autoUpdate(...args, {\n          animationFrame: updatePositionStrategy === 'always',\n        });\n        return cleanup;\n      },\n      elements: {\n        reference: context.anchor,\n      },\n      middleware: [\n        offset({ mainAxis: sideOffset + arrowHeight, alignmentAxis: alignOffset }),\n        avoidCollisions &&\n          shift({\n            mainAxis: true,\n            crossAxis: false,\n            limiter: sticky === 'partial' ? limitShift() : undefined,\n            ...detectOverflowOptions,\n          }),\n        avoidCollisions && flip({ ...detectOverflowOptions }),\n        size({\n          ...detectOverflowOptions,\n          apply: ({ elements, rects, availableWidth, availableHeight }) => {\n            const { width: anchorWidth, height: anchorHeight } = rects.reference;\n            const contentStyle = elements.floating.style;\n            contentStyle.setProperty('--radix-popper-available-width', `${availableWidth}px`);\n            contentStyle.setProperty('--radix-popper-available-height', `${availableHeight}px`);\n            contentStyle.setProperty('--radix-popper-anchor-width', `${anchorWidth}px`);\n            contentStyle.setProperty('--radix-popper-anchor-height', `${anchorHeight}px`);\n          },\n        }),\n        arrow && floatingUIarrow({ element: arrow, padding: arrowPadding }),\n        transformOrigin({ arrowWidth, arrowHeight }),\n        hideWhenDetached && hide({ strategy: 'referenceHidden', ...detectOverflowOptions }),\n      ],\n    });\n\n    const [placedSide, placedAlign] = getSideAndAlignFromPlacement(placement);\n\n    const handlePlaced = useCallbackRef(onPlaced);\n    useLayoutEffect(() => {\n      if (isPositioned) {\n        handlePlaced?.();\n      }\n    }, [isPositioned, handlePlaced]);\n\n    const arrowX = middlewareData.arrow?.x;\n    const arrowY = middlewareData.arrow?.y;\n    const cannotCenterArrow = middlewareData.arrow?.centerOffset !== 0;\n\n    const [contentZIndex, setContentZIndex] = React.useState<string>();\n    useLayoutEffect(() => {\n      if (content) setContentZIndex(window.getComputedStyle(content).zIndex);\n    }, [content]);\n\n    return (\n      <div\n        ref={refs.setFloating}\n        data-radix-popper-content-wrapper=\"\"\n        style={{\n          ...floatingStyles,\n          transform: isPositioned ? floatingStyles.transform : 'translate(0, -200%)', // keep off the page when measuring\n          minWidth: 'max-content',\n          zIndex: contentZIndex,\n          ['--radix-popper-transform-origin' as any]: [\n            middlewareData.transformOrigin?.x,\n            middlewareData.transformOrigin?.y,\n          ].join(' '),\n\n          // hide the content if using the hide middleware and should be hidden\n          // set visibility to hidden and disable pointer events so the UI behaves\n          // as if the PopperContent isn't there at all\n          ...(middlewareData.hide?.referenceHidden && {\n            visibility: 'hidden',\n            pointerEvents: 'none',\n          }),\n        }}\n        // Floating UI interally calculates logical alignment based the `dir` attribute on\n        // the reference/floating node, we must add this attribute here to ensure\n        // this is calculated when portalled as well as inline.\n        dir={props.dir}\n      >\n        <PopperContentProvider\n          scope={__scopePopper}\n          placedSide={placedSide}\n          onArrowChange={setArrow}\n          arrowX={arrowX}\n          arrowY={arrowY}\n          shouldHideArrow={cannotCenterArrow}\n        >\n          <Primitive.div\n            data-side={placedSide}\n            data-align={placedAlign}\n            {...contentProps}\n            ref={composedRefs}\n            style={{\n              ...contentProps.style,\n              // if the PopperContent hasn't been placed yet (not all measurements done)\n              // we prevent animations so that users's animation don't kick in too early referring wrong sides\n              animation: !isPositioned ? 'none' : undefined,\n            }}\n          />\n        </PopperContentProvider>\n      </div>\n    );\n  }\n);\n\nPopperContent.displayName = CONTENT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopperArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'PopperArrow';\n\nconst OPPOSITE_SIDE: Record<Side, Side> = {\n  top: 'bottom',\n  right: 'left',\n  bottom: 'top',\n  left: 'right',\n};\n\ntype PopperArrowElement = React.ComponentRef<typeof ArrowPrimitive.Root>;\ntype ArrowProps = React.ComponentPropsWithoutRef<typeof ArrowPrimitive.Root>;\ninterface PopperArrowProps extends ArrowProps {}\n\nconst PopperArrow = React.forwardRef<PopperArrowElement, PopperArrowProps>(function PopperArrow(\n  props: ScopedProps<PopperArrowProps>,\n  forwardedRef\n) {\n  const { __scopePopper, ...arrowProps } = props;\n  const contentContext = useContentContext(ARROW_NAME, __scopePopper);\n  const baseSide = OPPOSITE_SIDE[contentContext.placedSide];\n\n  return (\n    // we have to use an extra wrapper because `ResizeObserver` (used by `useSize`)\n    // doesn't report size as we'd expect on SVG elements.\n    // it reports their bounding box which is effectively the largest path inside the SVG.\n    <span\n      ref={contentContext.onArrowChange}\n      style={{\n        position: 'absolute',\n        left: contentContext.arrowX,\n        top: contentContext.arrowY,\n        [baseSide]: 0,\n        transformOrigin: {\n          top: '',\n          right: '0 0',\n          bottom: 'center 0',\n          left: '100% 0',\n        }[contentContext.placedSide],\n        transform: {\n          top: 'translateY(100%)',\n          right: 'translateY(50%) rotate(90deg) translateX(-50%)',\n          bottom: `rotate(180deg)`,\n          left: 'translateY(50%) rotate(-90deg) translateX(50%)',\n        }[contentContext.placedSide],\n        visibility: contentContext.shouldHideArrow ? 'hidden' : undefined,\n      }}\n    >\n      <ArrowPrimitive.Root\n        {...arrowProps}\n        ref={forwardedRef}\n        style={{\n          ...arrowProps.style,\n          // ensures the element can be measured correctly (mostly for if SVG)\n          display: 'block',\n        }}\n      />\n    </span>\n  );\n});\n\nPopperArrow.displayName = ARROW_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction isNotNull<T>(value: T | null): value is T {\n  return value !== null;\n}\n\nconst transformOrigin = (options: { arrowWidth: number; arrowHeight: number }): Middleware => ({\n  name: 'transformOrigin',\n  options,\n  fn(data) {\n    const { placement, rects, middlewareData } = data;\n\n    const cannotCenterArrow = middlewareData.arrow?.centerOffset !== 0;\n    const isArrowHidden = cannotCenterArrow;\n    const arrowWidth = isArrowHidden ? 0 : options.arrowWidth;\n    const arrowHeight = isArrowHidden ? 0 : options.arrowHeight;\n\n    const [placedSide, placedAlign] = getSideAndAlignFromPlacement(placement);\n    const noArrowAlign = { start: '0%', center: '50%', end: '100%' }[placedAlign];\n\n    const arrowXCenter = (middlewareData.arrow?.x ?? 0) + arrowWidth / 2;\n    const arrowYCenter = (middlewareData.arrow?.y ?? 0) + arrowHeight / 2;\n\n    let x = '';\n    let y = '';\n\n    if (placedSide === 'bottom') {\n      x = isArrowHidden ? noArrowAlign : `${arrowXCenter}px`;\n      y = `${-arrowHeight}px`;\n    } else if (placedSide === 'top') {\n      x = isArrowHidden ? noArrowAlign : `${arrowXCenter}px`;\n      y = `${rects.floating.height + arrowHeight}px`;\n    } else if (placedSide === 'right') {\n      x = `${-arrowHeight}px`;\n      y = isArrowHidden ? noArrowAlign : `${arrowYCenter}px`;\n    } else if (placedSide === 'left') {\n      x = `${rects.floating.width + arrowHeight}px`;\n      y = isArrowHidden ? noArrowAlign : `${arrowYCenter}px`;\n    }\n    return { data: { x, y } };\n  },\n});\n\nfunction getSideAndAlignFromPlacement(placement: Placement) {\n  const [side, align = 'center'] = placement.split('-');\n  return [side as Side, align as Align] as const;\n}\n\nconst Root = Popper;\nconst Anchor = PopperAnchor;\nconst Content = PopperContent;\nconst Arrow = PopperArrow;\n\nexport {\n  createPopperScope,\n  //\n  Popper,\n  PopperAnchor,\n  PopperContent,\n  PopperArrow,\n  //\n  Root,\n  Anchor,\n  Content,\n  Arrow,\n  //\n  SIDE_OPTIONS,\n  ALIGN_OPTIONS,\n};\nexport type { PopperProps, PopperAnchorProps, PopperContentProps, PopperArrowProps };\n", "import * as React from 'react';\nimport { Primitive } from '@radix-ui/react-primitive';\n\n/* -------------------------------------------------------------------------------------------------\n * Arrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst NAME = 'Arrow';\n\ntype ArrowElement = React.ComponentRef<typeof Primitive.svg>;\ntype PrimitiveSvgProps = React.ComponentPropsWithoutRef<typeof Primitive.svg>;\ninterface ArrowProps extends PrimitiveSvgProps {}\n\nconst Arrow = React.forwardRef<ArrowElement, ArrowProps>((props, forwardedRef) => {\n  const { children, width = 10, height = 5, ...arrowProps } = props;\n  return (\n    <Primitive.svg\n      {...arrowProps}\n      ref={forwardedRef}\n      width={width}\n      height={height}\n      viewBox=\"0 0 30 10\"\n      preserveAspectRatio=\"none\"\n    >\n      {/* We use their children if they're slotting to replace the whole svg */}\n      {props.asChild ? children : <polygon points=\"0,0 30,0 15,10\" />}\n    </Primitive.svg>\n  );\n});\n\nArrow.displayName = NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = Arrow;\n\nexport {\n  Arrow,\n  //\n  Root,\n};\nexport type { ArrowProps };\n", "/// <reference types=\"resize-observer-browser\" />\n\nimport * as React from 'react';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\n\nfunction useSize(element: HTMLElement | null) {\n  const [size, setSize] = React.useState<{ width: number; height: number } | undefined>(undefined);\n\n  useLayoutEffect(() => {\n    if (element) {\n      // provide size as early as possible\n      setSize({ width: element.offsetWidth, height: element.offsetHeight });\n\n      const resizeObserver = new ResizeObserver((entries) => {\n        if (!Array.isArray(entries)) {\n          return;\n        }\n\n        // Since we only observe the one element, we don't need to loop over the\n        // array\n        if (!entries.length) {\n          return;\n        }\n\n        const entry = entries[0];\n        let width: number;\n        let height: number;\n\n        if ('borderBoxSize' in entry) {\n          const borderSizeEntry = entry['borderBoxSize'];\n          // iron out differences between browsers\n          const borderSize = Array.isArray(borderSizeEntry) ? borderSizeEntry[0] : borderSizeEntry;\n          width = borderSize['inlineSize'];\n          height = borderSize['blockSize'];\n        } else {\n          // for browsers that don't support `borderBoxSize`\n          // we calculate it ourselves to get the correct border box.\n          width = element.offsetWidth;\n          height = element.offsetHeight;\n        }\n\n        setSize({ width, height });\n      });\n\n      resizeObserver.observe(element, { box: 'border-box' });\n\n      return () => resizeObserver.unobserve(element);\n    } else {\n      // We only want to reset to `undefined` when the element becomes `null`,\n      // not if it changes to another element.\n      setSize(undefined);\n    }\n  }, [element]);\n\n  return size;\n}\n\nexport { useSize };\n", "import * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\n\n/* -------------------------------------------------------------------------------------------------\n * Portal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'Portal';\n\ntype PortalElement = React.ComponentRef<typeof Primitive.div>;\ntype PrimitiveDivProps = React.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface PortalProps extends PrimitiveDivProps {\n  /**\n   * An optional container where the portaled content should be appended.\n   */\n  container?: Element | DocumentFragment | null;\n}\n\nconst Portal = React.forwardRef<PortalElement, PortalProps>((props, forwardedRef) => {\n  const { container: containerProp, ...portalProps } = props;\n  const [mounted, setMounted] = React.useState(false);\n  useLayoutEffect(() => setMounted(true), []);\n  const container = containerProp || (mounted && globalThis?.document?.body);\n  return container\n    ? ReactDOM.createPortal(<Primitive.div {...portalProps} ref={forwardedRef} />, container)\n    : null;\n});\n\nPortal.displayName = PORTAL_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = Portal;\n\nexport {\n  Portal,\n  //\n  Root,\n};\nexport type { PortalProps };\n", "import * as React from 'react';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\nimport { useStateMachine } from './use-state-machine';\n\ninterface PresenceProps {\n  children: React.ReactElement | ((props: { present: boolean }) => React.ReactElement);\n  present: boolean;\n}\n\nconst Presence: React.FC<PresenceProps> = (props) => {\n  const { present, children } = props;\n  const presence = usePresence(present);\n\n  const child = (\n    typeof children === 'function'\n      ? children({ present: presence.isPresent })\n      : React.Children.only(children)\n  ) as React.ReactElement<{ ref?: React.Ref<HTMLElement> }>;\n\n  const ref = useComposedRefs(presence.ref, getElementRef(child));\n  const forceMount = typeof children === 'function';\n  return forceMount || presence.isPresent ? React.cloneElement(child, { ref }) : null;\n};\n\nPresence.displayName = 'Presence';\n\n/* -------------------------------------------------------------------------------------------------\n * usePresence\n * -----------------------------------------------------------------------------------------------*/\n\nfunction usePresence(present: boolean) {\n  const [node, setNode] = React.useState<HTMLElement>();\n  const stylesRef = React.useRef<CSSStyleDeclaration | null>(null);\n  const prevPresentRef = React.useRef(present);\n  const prevAnimationNameRef = React.useRef<string>('none');\n  const initialState = present ? 'mounted' : 'unmounted';\n  const [state, send] = useStateMachine(initialState, {\n    mounted: {\n      UNMOUNT: 'unmounted',\n      ANIMATION_OUT: 'unmountSuspended',\n    },\n    unmountSuspended: {\n      MOUNT: 'mounted',\n      ANIMATION_END: 'unmounted',\n    },\n    unmounted: {\n      MOUNT: 'mounted',\n    },\n  });\n\n  React.useEffect(() => {\n    const currentAnimationName = getAnimationName(stylesRef.current);\n    prevAnimationNameRef.current = state === 'mounted' ? currentAnimationName : 'none';\n  }, [state]);\n\n  useLayoutEffect(() => {\n    const styles = stylesRef.current;\n    const wasPresent = prevPresentRef.current;\n    const hasPresentChanged = wasPresent !== present;\n\n    if (hasPresentChanged) {\n      const prevAnimationName = prevAnimationNameRef.current;\n      const currentAnimationName = getAnimationName(styles);\n\n      if (present) {\n        send('MOUNT');\n      } else if (currentAnimationName === 'none' || styles?.display === 'none') {\n        // If there is no exit animation or the element is hidden, animations won't run\n        // so we unmount instantly\n        send('UNMOUNT');\n      } else {\n        /**\n         * When `present` changes to `false`, we check changes to animation-name to\n         * determine whether an animation has started. We chose this approach (reading\n         * computed styles) because there is no `animationrun` event and `animationstart`\n         * fires after `animation-delay` has expired which would be too late.\n         */\n        const isAnimating = prevAnimationName !== currentAnimationName;\n\n        if (wasPresent && isAnimating) {\n          send('ANIMATION_OUT');\n        } else {\n          send('UNMOUNT');\n        }\n      }\n\n      prevPresentRef.current = present;\n    }\n  }, [present, send]);\n\n  useLayoutEffect(() => {\n    if (node) {\n      let timeoutId: number;\n      const ownerWindow = node.ownerDocument.defaultView ?? window;\n      /**\n       * Triggering an ANIMATION_OUT during an ANIMATION_IN will fire an `animationcancel`\n       * event for ANIMATION_IN after we have entered `unmountSuspended` state. So, we\n       * make sure we only trigger ANIMATION_END for the currently active animation.\n       */\n      const handleAnimationEnd = (event: AnimationEvent) => {\n        const currentAnimationName = getAnimationName(stylesRef.current);\n        // The event.animationName is unescaped for CSS syntax,\n        // so we need to escape it to compare with the animationName computed from the style.\n        const isCurrentAnimation = currentAnimationName.includes(CSS.escape(event.animationName));\n        if (event.target === node && isCurrentAnimation) {\n          // With React 18 concurrency this update is applied a frame after the\n          // animation ends, creating a flash of visible content. By setting the\n          // animation fill mode to \"forwards\", we force the node to keep the\n          // styles of the last keyframe, removing the flash.\n          //\n          // Previously we flushed the update via ReactDom.flushSync, but with\n          // exit animations this resulted in the node being removed from the\n          // DOM before the synthetic animationEnd event was dispatched, meaning\n          // user-provided event handlers would not be called.\n          // https://github.com/radix-ui/primitives/pull/1849\n          send('ANIMATION_END');\n          if (!prevPresentRef.current) {\n            const currentFillMode = node.style.animationFillMode;\n            node.style.animationFillMode = 'forwards';\n            // Reset the style after the node had time to unmount (for cases\n            // where the component chooses not to unmount). Doing this any\n            // sooner than `setTimeout` (e.g. with `requestAnimationFrame`)\n            // still causes a flash.\n            timeoutId = ownerWindow.setTimeout(() => {\n              if (node.style.animationFillMode === 'forwards') {\n                node.style.animationFillMode = currentFillMode;\n              }\n            });\n          }\n        }\n      };\n      const handleAnimationStart = (event: AnimationEvent) => {\n        if (event.target === node) {\n          // if animation occurred, store its name as the previous animation.\n          prevAnimationNameRef.current = getAnimationName(stylesRef.current);\n        }\n      };\n      node.addEventListener('animationstart', handleAnimationStart);\n      node.addEventListener('animationcancel', handleAnimationEnd);\n      node.addEventListener('animationend', handleAnimationEnd);\n      return () => {\n        ownerWindow.clearTimeout(timeoutId);\n        node.removeEventListener('animationstart', handleAnimationStart);\n        node.removeEventListener('animationcancel', handleAnimationEnd);\n        node.removeEventListener('animationend', handleAnimationEnd);\n      };\n    } else {\n      // Transition to the unmounted state if the node is removed prematurely.\n      // We avoid doing so during cleanup as the node may change but still exist.\n      send('ANIMATION_END');\n    }\n  }, [node, send]);\n\n  return {\n    isPresent: ['mounted', 'unmountSuspended'].includes(state),\n    ref: React.useCallback((node: HTMLElement) => {\n      stylesRef.current = node ? getComputedStyle(node) : null;\n      setNode(node);\n    }, []),\n  };\n}\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction getAnimationName(styles: CSSStyleDeclaration | null) {\n  return styles?.animationName || 'none';\n}\n\n// Before React 19 accessing `element.props.ref` will throw a warning and suggest using `element.ref`\n// After React 19 accessing `element.ref` does the opposite.\n// https://github.com/facebook/react/pull/28348\n//\n// Access the ref using the method that doesn't yield a warning.\nfunction getElementRef(element: React.ReactElement<{ ref?: React.Ref<unknown> }>) {\n  // React <=18 in DEV\n  let getter = Object.getOwnPropertyDescriptor(element.props, 'ref')?.get;\n  let mayWarn = getter && 'isReactWarning' in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return (element as any).ref;\n  }\n\n  // React 19 in DEV\n  getter = Object.getOwnPropertyDescriptor(element, 'ref')?.get;\n  mayWarn = getter && 'isReactWarning' in getter && getter.isReactWarning;\n  if (mayWarn) {\n    return element.props.ref;\n  }\n\n  // Not DEV\n  return element.props.ref || (element as any).ref;\n}\n\nconst Root = Presence;\n\nexport {\n  Presence,\n  //\n  Root,\n};\nexport type { PresenceProps };\n", "import * as React from 'react';\n\ntype Machine<S> = { [k: string]: { [k: string]: S } };\ntype MachineState<T> = keyof T;\ntype MachineEvent<T> = keyof UnionToIntersection<T[keyof T]>;\n\n// \uD83E\uDD2F https://fettblog.eu/typescript-union-to-intersection/\ntype UnionToIntersection<T> = (T extends any ? (x: T) => any : never) extends (x: infer R) => any\n  ? R\n  : never;\n\nexport function useStateMachine<M>(\n  initialState: MachineState<M>,\n  machine: M & Machine<MachineState<M>>\n) {\n  return React.useReducer((state: MachineState<M>, event: MachineEvent<M>): MachineState<M> => {\n    const nextState = (machine[state] as any)[event];\n    return nextState ?? state;\n  }, initialState);\n}\n", "import * as React from 'react';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\n\n// Prevent bundlers from trying to optimize the import\nconst useInsertionEffect: typeof useLayoutEffect =\n  (React as any)[' useInsertionEffect '.trim().toString()] || useLayoutEffect;\n\ntype ChangeHandler<T> = (state: T) => void;\ntype SetStateFn<T> = React.Dispatch<React.SetStateAction<T>>;\n\ninterface UseControllableStateParams<T> {\n  prop?: T | undefined;\n  defaultProp: T;\n  onChange?: ChangeHandler<T>;\n  caller?: string;\n}\n\nexport function useControllableState<T>({\n  prop,\n  defaultProp,\n  onChange = () => {},\n  caller,\n}: UseControllableStateParams<T>): [T, SetStateFn<T>] {\n  const [uncontrolledProp, setUncontrolledProp, onChangeRef] = useUncontrolledState({\n    defaultProp,\n    onChange,\n  });\n  const isControlled = prop !== undefined;\n  const value = isControlled ? prop : uncontrolledProp;\n\n  // OK to disable conditionally calling hooks here because they will always run\n  // consistently in the same environment. Bundlers should be able to remove the\n  // code block entirely in production.\n  /* eslint-disable react-hooks/rules-of-hooks */\n  if (process.env.NODE_ENV !== 'production') {\n    const isControlledRef = React.useRef(prop !== undefined);\n    React.useEffect(() => {\n      const wasControlled = isControlledRef.current;\n      if (wasControlled !== isControlled) {\n        const from = wasControlled ? 'controlled' : 'uncontrolled';\n        const to = isControlled ? 'controlled' : 'uncontrolled';\n        console.warn(\n          `${caller} is changing from ${from} to ${to}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`\n        );\n      }\n      isControlledRef.current = isControlled;\n    }, [isControlled, caller]);\n  }\n  /* eslint-enable react-hooks/rules-of-hooks */\n\n  const setValue = React.useCallback<SetStateFn<T>>(\n    (nextValue) => {\n      if (isControlled) {\n        const value = isFunction(nextValue) ? nextValue(prop) : nextValue;\n        if (value !== prop) {\n          onChangeRef.current?.(value);\n        }\n      } else {\n        setUncontrolledProp(nextValue);\n      }\n    },\n    [isControlled, prop, setUncontrolledProp, onChangeRef]\n  );\n\n  return [value, setValue];\n}\n\nfunction useUncontrolledState<T>({\n  defaultProp,\n  onChange,\n}: Omit<UseControllableStateParams<T>, 'prop'>): [\n  Value: T,\n  setValue: React.Dispatch<React.SetStateAction<T>>,\n  OnChangeRef: React.RefObject<ChangeHandler<T> | undefined>,\n] {\n  const [value, setValue] = React.useState(defaultProp);\n  const prevValueRef = React.useRef(value);\n\n  const onChangeRef = React.useRef(onChange);\n  useInsertionEffect(() => {\n    onChangeRef.current = onChange;\n  }, [onChange]);\n\n  React.useEffect(() => {\n    if (prevValueRef.current !== value) {\n      onChangeRef.current?.(value);\n      prevValueRef.current = value;\n    }\n  }, [value, prevValueRef]);\n\n  return [value, setValue, onChangeRef];\n}\n\nfunction isFunction(value: unknown): value is (...args: any[]) => any {\n  return typeof value === 'function';\n}\n", "import * as React from 'react';\nimport { useEffectEvent } from '@radix-ui/react-use-effect-event';\n\ntype ChangeHandler<T> = (state: T) => void;\n\ninterface UseControllableStateParams<T> {\n  prop: T | undefined;\n  defaultProp: T;\n  onChange: ChangeHandler<T> | undefined;\n  caller: string;\n}\n\ninterface AnyAction {\n  type: string;\n}\n\nconst SYNC_STATE = Symbol('RADIX:SYNC_STATE');\n\ninterface SyncStateAction<T> {\n  type: typeof SYNC_STATE;\n  state: T;\n}\n\nexport function useControllableStateReducer<T, S extends {}, A extends AnyAction>(\n  reducer: (prevState: S & { state: T }, action: A) => S & { state: T },\n  userArgs: UseControllableStateParams<T>,\n  initialState: S\n): [S & { state: T }, React.Dispatch<A>];\n\nexport function useControllableStateReducer<T, S extends {}, I, A extends AnyAction>(\n  reducer: (prevState: S & { state: T }, action: A) => S & { state: T },\n  userArgs: UseControllableStateParams<T>,\n  initialArg: I,\n  init: (i: I & { state: T }) => S\n): [S & { state: T }, React.Dispatch<A>];\n\nexport function useControllableStateReducer<T, S extends {}, A extends AnyAction>(\n  reducer: (prevState: S & { state: T }, action: A) => S & { state: T },\n  userArgs: UseControllableStateParams<T>,\n  initialArg: any,\n  init?: (i: any) => Omit<S, 'state'>\n): [S & { state: T }, React.Dispatch<A>] {\n  const { prop: controlledState, defaultProp, onChange: onChangeProp, caller } = userArgs;\n  const isControlled = controlledState !== undefined;\n\n  const onChange = useEffectEvent(onChangeProp);\n\n  // OK to disable conditionally calling hooks here because they will always run\n  // consistently in the same environment. Bundlers should be able to remove the\n  // code block entirely in production.\n  /* eslint-disable react-hooks/rules-of-hooks */\n  if (process.env.NODE_ENV !== 'production') {\n    const isControlledRef = React.useRef(controlledState !== undefined);\n    React.useEffect(() => {\n      const wasControlled = isControlledRef.current;\n      if (wasControlled !== isControlled) {\n        const from = wasControlled ? 'controlled' : 'uncontrolled';\n        const to = isControlled ? 'controlled' : 'uncontrolled';\n        console.warn(\n          `${caller} is changing from ${from} to ${to}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`\n        );\n      }\n      isControlledRef.current = isControlled;\n    }, [isControlled, caller]);\n  }\n  /* eslint-enable react-hooks/rules-of-hooks */\n\n  type InternalState = S & { state: T };\n  const args: [InternalState] = [{ ...initialArg, state: defaultProp }];\n  if (init) {\n    // @ts-expect-error\n    args.push(init);\n  }\n\n  const [internalState, dispatch] = React.useReducer(\n    (state: InternalState, action: A | SyncStateAction<T>): InternalState => {\n      if (action.type === SYNC_STATE) {\n        return { ...state, state: action.state };\n      }\n\n      const next = reducer(state, action);\n      if (isControlled && !Object.is(next.state, state.state)) {\n        onChange(next.state);\n      }\n      return next;\n    },\n    ...args\n  );\n\n  const uncontrolledState = internalState.state;\n  const prevValueRef = React.useRef(uncontrolledState);\n  React.useEffect(() => {\n    if (prevValueRef.current !== uncontrolledState) {\n      prevValueRef.current = uncontrolledState;\n      if (!isControlled) {\n        onChange(uncontrolledState);\n      }\n    }\n  }, [onChange, uncontrolledState, prevValueRef, isControlled]);\n\n  const state = React.useMemo(() => {\n    const isControlled = controlledState !== undefined;\n    if (isControlled) {\n      return { ...internalState, state: controlledState };\n    }\n\n    return internalState;\n  }, [internalState, controlledState]);\n\n  React.useEffect(() => {\n    // Sync internal state for controlled components so that reducer is called\n    // with the correct state values\n    if (isControlled && !Object.is(controlledState, internalState.state)) {\n      dispatch({ type: SYNC_STATE, state: controlledState });\n    }\n  }, [controlledState, internalState.state, isControlled]);\n\n  return [state, dispatch as React.Dispatch<A>];\n}\n", "/* eslint-disable react-hooks/rules-of-hooks */\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\nimport * as React from 'react';\n\ntype AnyFunction = (...args: any[]) => any;\n\n// See https://github.com/webpack/webpack/issues/14814\nconst useReactEffectEvent = (React as any)[' useEffectEvent '.trim().toString()];\nconst useReactInsertionEffect = (React as any)[' useInsertionEffect '.trim().toString()];\n\n/**\n * Designed to approximate the behavior on `experimental_useEffectEvent` as best\n * as possible until its stable release, and back-fill it as a shim as needed.\n */\nexport function useEffectEvent<T extends AnyFunction>(callback?: T): T {\n  if (typeof useReactEffectEvent === 'function') {\n    return useReactEffectEvent(callback);\n  }\n\n  const ref = React.useRef<AnyFunction | undefined>(() => {\n    throw new Error('Cannot call an event handler while rendering.');\n  });\n  // See https://github.com/webpack/webpack/issues/14814\n  if (typeof useReactInsertionEffect === 'function') {\n    useReactInsertionEffect(() => {\n      ref.current = callback;\n    });\n  } else {\n    useLayoutEffect(() => {\n      ref.current = callback;\n    });\n  }\n\n  // https://github.com/facebook/react/issues/19240\n  return React.useMemo(() => ((...args) => ref.current?.(...args)) as T, []);\n}\n", "import * as React from 'react';\nimport { Primitive } from '@radix-ui/react-primitive';\n\n/* -------------------------------------------------------------------------------------------------\n * VisuallyHidden\n * -----------------------------------------------------------------------------------------------*/\n\nconst VISUALLY_HIDDEN_STYLES = Object.freeze({\n  // See: https://github.com/twbs/bootstrap/blob/main/scss/mixins/_visually-hidden.scss\n  position: 'absolute',\n  border: 0,\n  width: 1,\n  height: 1,\n  padding: 0,\n  margin: -1,\n  overflow: 'hidden',\n  clip: 'rect(0, 0, 0, 0)',\n  whiteSpace: 'nowrap',\n  wordWrap: 'normal',\n}) satisfies React.CSSProperties;\n\nconst NAME = 'VisuallyHidden';\n\ntype VisuallyHiddenElement = React.ComponentRef<typeof Primitive.span>;\ntype PrimitiveSpanProps = React.ComponentPropsWithoutRef<typeof Primitive.span>;\ninterface VisuallyHiddenProps extends PrimitiveSpanProps {}\n\nconst VisuallyHidden = React.forwardRef<VisuallyHiddenElement, VisuallyHiddenProps>(\n  (props, forwardedRef) => {\n    return (\n      <Primitive.span\n        {...props}\n        ref={forwardedRef}\n        style={{ ...VISUALLY_HIDDEN_STYLES, ...props.style }}\n      />\n    );\n  }\n);\n\nVisuallyHidden.displayName = NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = VisuallyHidden;\n\nexport {\n  VisuallyHidden,\n  //\n  Root,\n  //\n  VISUALLY_HIDDEN_STYLES,\n};\nexport type { VisuallyHiddenProps };\n", "\"use client\";\n\nimport type { PropsWithChildren } from \"react\";\nimport { createContext, useContext, useMemo } from \"react\";\n\nimport { type Components, ComponentsProvider } from \"./components\";\nimport type { Overrides } from \"./overrides\";\nimport { OverridesProvider } from \"./overrides\";\n\ntype LiveblocksUiConfigProps = PropsWithChildren<{\n  /**\n   * Override the components' strings.\n   */\n  overrides?: Partial<Overrides>;\n\n  /**\n   * Override the components' components.\n   */\n  components?: Partial<Components>;\n\n  /**\n   * The container to render the portal into.\n   */\n  portalContainer?: HTMLElement;\n\n  /**\n   * When `preventUnsavedChanges` is set on your Liveblocks client (or set on\n   * <LiveblocksProvider>), then closing a browser tab will be prevented when\n   * there are unsaved changes.\n   *\n   * By default, that will include draft texts or attachments that are (being)\n   * uploaded via comments/threads composers, but not submitted yet.\n   *\n   * If you want to prevent unsaved changes with Liveblocks, but not for\n   * composers, you can opt-out by setting this option to `false`.\n   */\n  preventUnsavedComposerChanges?: boolean;\n\n  /**\n   * The Liveblocks emoji picker (visible when adding reactions in `Comment`) is built with\n   * {@link https://github.com/liveblocks/frimousse | Frimousse}, which fetches its data from\n   * {@link https://emojibase.dev/docs/datasets/ | Emojibase}.\n   *\n   * This option allows you to change the base URL of where the {@link https://www.npmjs.com/package/emojibase-data | `emojibase-data`}\n   * files should be fetched from, used as follows: `${emojibaseUrl}/${locale}/${file}.json`.\n   * (e.g. `${emojibaseUrl}/en/data.json`).\n   *\n   * @example \"https://unpkg.com/emojibase-data\"\n   *\n   * @example \"https://example.com/self-hosted-emojibase-data\"\n   */\n  emojibaseUrl?: string;\n}>;\n\ninterface LiveblocksUiConfigContext {\n  portalContainer?: HTMLElement;\n  preventUnsavedComposerChanges?: boolean;\n  emojibaseUrl?: string;\n}\n\nconst LiveblocksUiConfigContext = createContext<LiveblocksUiConfigContext>({});\n\nexport function useLiveblocksUiConfig() {\n  return useContext(LiveblocksUiConfigContext);\n}\n\n/**\n * Set configuration options for all components.\n *\n * @example\n * <LiveblocksUiConfig overrides={{ locale: \"fr\", USER_UNKNOWN: \"Anonyme\", ... }}>\n *   <App />\n * </LiveblocksUiConfig>\n */\nexport function LiveblocksUiConfig({\n  overrides,\n  components,\n  portalContainer,\n  preventUnsavedComposerChanges = true,\n  emojibaseUrl,\n  children,\n}: LiveblocksUiConfigProps) {\n  const liveblocksUiConfig = useMemo(\n    () => ({\n      portalContainer,\n      preventUnsavedComposerChanges,\n      emojibaseUrl,\n    }),\n    [portalContainer, preventUnsavedComposerChanges, emojibaseUrl]\n  );\n\n  return (\n    <LiveblocksUiConfigContext.Provider value={liveblocksUiConfig}>\n      <OverridesProvider overrides={overrides}>\n        <ComponentsProvider components={components}>\n          {children}\n        </ComponentsProvider>\n      </OverridesProvider>\n    </LiveblocksUiConfigContext.Provider>\n  );\n}\n", "const APPLE_REGEX = /Mac|iPod|iPhone|iPad/;\n\nexport function isApple() {\n  return (\n    typeof window !== \"undefined\" && APPLE_REGEX.test(window.navigator.platform)\n  );\n}\n", "\"use client\";\n\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\";\nimport type { ComponentProps, ReactNode } from \"react\";\nimport { forwardRef, useMemo } from \"react\";\n\nimport { useLiveblocksUiConfig } from \"../../config\";\nimport {\n  FLOATING_ELEMENT_COLLISION_PADDING,\n  FLOATING_ELEMENT_SIDE_OFFSET,\n} from \"../../constants\";\nimport { cn } from \"../../utils/cn\";\nimport { isApple } from \"../../utils/is-apple\";\n\nconst ALT_KEY = { title: \"Alt\", key: \"\" };\nconst COMMAND_KEY = { title: \"Command\", key: \"\" };\nconst CONTROL_KEY = { title: \"Ctrl\", key: \"\" };\nconst SHIFT_KEY = { title: \"Shift\", key: \"\" };\nconst ENTER_KEY = { title: \"Enter\", key: \"\" };\nconst SPACE_KEY = { title: \"Space\", key: \"\" };\nconst ESCAPE_KEY = { title: \"Escape\", key: \"\" };\n\nconst KEYS = {\n  alt: () => ALT_KEY,\n  mod: () => (isApple() ? COMMAND_KEY : CONTROL_KEY),\n  control: () => CONTROL_KEY,\n  ctrl: () => CONTROL_KEY,\n  command: () => COMMAND_KEY,\n  cmd: () => COMMAND_KEY,\n  shift: () => SHIFT_KEY,\n  enter: () => ENTER_KEY,\n  \" \": () => SPACE_KEY,\n  space: () => SPACE_KEY,\n  escape: () => ESCAPE_KEY,\n  esc: () => ESCAPE_KEY,\n} as const;\n\nexport interface TooltipProps\n  extends Pick<TooltipPrimitive.TooltipTriggerProps, \"children\">,\n    Omit<TooltipPrimitive.TooltipContentProps, \"content\"> {\n  content: ReactNode;\n  multiline?: boolean;\n}\n\nexport interface ShortcutTooltipProps extends TooltipProps {\n  shortcut?: string;\n}\n\nexport interface ShortcutTooltipKeyProps extends ComponentProps<\"abbr\"> {\n  name: keyof typeof KEYS;\n}\n\nfunction getShortcutKbdFromKeymap(keymap: string) {\n  const keys = keymap.split(\"-\");\n\n  return (\n    <>\n      {keys.map((key, index) => {\n        const lowerKey = key.toLowerCase();\n\n        if (lowerKey in KEYS) {\n          return (\n            <ShortcutTooltipKey\n              key={index}\n              name={lowerKey as keyof typeof KEYS}\n            />\n          );\n        }\n\n        return <span key={index}>{key}</span>;\n      })}\n    </>\n  );\n}\n\nexport const Tooltip = forwardRef<HTMLButtonElement, TooltipProps>(\n  ({ children, content, multiline, className, ...props }, forwardedRef) => {\n    const { portalContainer } = useLiveblocksUiConfig();\n\n    return (\n      <TooltipPrimitive.Root disableHoverableContent>\n        <TooltipPrimitive.Trigger asChild ref={forwardedRef}>\n          {children}\n        </TooltipPrimitive.Trigger>\n        <TooltipPrimitive.Portal container={portalContainer}>\n          <TooltipPrimitive.Content\n            className={cn(\n              \"lb-root lb-portal lb-tooltip\",\n              multiline && \"lb-tooltip:multiline\",\n              className\n            )}\n            side=\"top\"\n            align=\"center\"\n            sideOffset={FLOATING_ELEMENT_SIDE_OFFSET}\n            collisionPadding={FLOATING_ELEMENT_COLLISION_PADDING}\n            {...props}\n          >\n            {content}\n          </TooltipPrimitive.Content>\n        </TooltipPrimitive.Portal>\n      </TooltipPrimitive.Root>\n    );\n  }\n);\n\nexport const ShortcutTooltip = forwardRef<\n  HTMLButtonElement,\n  ShortcutTooltipProps\n>(({ children, content, shortcut, ...props }, forwardedRef) => {\n  const shortcutKbd = useMemo(() => {\n    return shortcut ? getShortcutKbdFromKeymap(shortcut) : null;\n  }, [shortcut]);\n\n  return (\n    <Tooltip\n      content={\n        <>\n          {content}\n          {shortcutKbd && (\n            <kbd className=\"lb-tooltip-shortcut\">{shortcutKbd}</kbd>\n          )}\n        </>\n      }\n      {...props}\n      ref={forwardedRef}\n    >\n      {children}\n    </Tooltip>\n  );\n});\n\nfunction ShortcutTooltipKey({ name, ...props }: ShortcutTooltipKeyProps) {\n  const { title, key } = useMemo(() => KEYS[name]?.(), [name]);\n\n  return (\n    <abbr title={title} {...props}>\n      {key}\n    </abbr>\n  );\n}\n\nexport { TooltipProvider } from \"@radix-ui/react-tooltip\";\n", "import type { ComponentProps } from \"react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\nimport { CheckIcon, CopyIcon } from \"../../icons\";\nimport type { GlobalOverrides } from \"../../overrides\";\nimport { useOverrides } from \"../../overrides\";\nimport { Button } from \"./Button\";\nimport { Tooltip, TooltipProvider } from \"./Tooltip\";\n\nconst COPY_DELAY = 1500;\n\ninterface CodeBlockProps extends Omit<ComponentProps<\"div\">, \"title\"> {\n  title: string;\n  code: string;\n  overrides?: Partial<GlobalOverrides>;\n}\n\nexport function CodeBlock({ title, code, overrides }: CodeBlockProps) {\n  const $ = useOverrides(overrides);\n  const [isCopied, setCopied] = useState(false);\n  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  useEffect(() => {\n    if (isCopied) {\n      timeoutRef.current = setTimeout(() => {\n        setCopied(false);\n      }, COPY_DELAY);\n    }\n\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, [isCopied]);\n\n  const handleCopy = useCallback(() => {\n    try {\n      navigator.clipboard.writeText(code);\n      setCopied(true);\n    } catch (error) {\n      console.error(error);\n    }\n  }, [code]);\n\n  return (\n    <TooltipProvider>\n      <div className=\"lb-root lb-code-block\">\n        <div className=\"lb-code-block-header\">\n          <span className=\"lb-code-block-title\">{title}</span>\n          <div className=\"lb-code-block-header-actions\">\n            <Tooltip content={isCopied ? null : $.COPY_TO_CLIPBOARD}>\n              <Button\n                className=\"lb-code-block-header-action\"\n                icon={isCopied ? <CheckIcon /> : <CopyIcon />}\n                onClick={handleCopy}\n                aria-label={$.COPY_TO_CLIPBOARD}\n              />\n            </Tooltip>\n          </div>\n        </div>\n        <pre className=\"lb-code-block-content\">\n          <code>{code}</code>\n        </pre>\n      </div>\n    </TooltipProvider>\n  );\n}\n", "import type { ComponentProps } from \"react\";\n\nimport {\n  ComponentsProvider,\n  type GlobalComponents,\n  useComponents,\n} from \"../../components\";\nimport type {\n  MarkdownComponents,\n  MarkdownComponentsCodeBlockProps,\n  MarkdownComponentsLinkProps,\n} from \"../../primitives/Markdown\";\nimport { Markdown } from \"../../primitives/Markdown\";\nimport { cn } from \"../../utils/cn\";\nimport { CodeBlock as DefaultCodeBlock } from \"./CodeBlock\";\n\ninterface ProseProps extends ComponentProps<\"div\"> {\n  content: string;\n  partial?: boolean;\n  components?: Partial<\n    GlobalComponents & { markdown?: Partial<MarkdownComponents> }\n  >;\n}\n\nfunction Link({ href, title, children }: MarkdownComponentsLinkProps) {\n  const { Anchor } = useComponents();\n\n  return (\n    <Anchor href={href} title={title}>\n      {children}\n    </Anchor>\n  );\n}\n\nfunction CodeBlock({ language, code }: MarkdownComponentsCodeBlockProps) {\n  return <DefaultCodeBlock title={language || \"Plain text\"} code={code} />;\n}\n\nconst defaultMarkdownComponents: Partial<MarkdownComponents> = {\n  Link,\n  CodeBlock,\n};\n\n/**\n * This component renders Markdown content with `lb-prose`\n * styles and custom components (code blocks, etc)\n */\nexport function Prose({\n  content,\n  partial,\n  components,\n  className,\n  ...props\n}: ProseProps) {\n  return (\n    <ComponentsProvider components={components}>\n      <Markdown\n        content={content}\n        components={{ ...defaultMarkdownComponents, ...components?.markdown }}\n        className={cn(\"lb-root lb-prose\", className)}\n        partial={partial}\n        {...props}\n      />\n    </ComponentsProvider>\n  );\n}\n", "import { kInternal } from \"@liveblocks/core\";\nimport { useClient } from \"@liveblocks/react\";\nimport { useSignal } from \"@liveblocks/react/_private\";\n\nexport function useCurrentUserId(): string | null {\n  const client = useClient();\n  return useSignal(client[kInternal].currentUserId) ?? null;\n}\n", "\"use client\";\n\nimport { useUser } from \"@liveblocks/react\";\nimport type { ComponentProps } from \"react\";\nimport { useMemo } from \"react\";\n\nimport { useOverrides } from \"../../overrides\";\nimport { useCurrentUserId } from \"../../shared\";\nimport { cn } from \"../../utils/cn\";\n\nexport interface UserProps extends ComponentProps<\"span\"> {\n  /**\n   * The user ID to display the user name for.\n   */\n  userId: string;\n\n  /**\n   * Whether to replace the user name with \"you\" ($.USER_SELF) for the current user.\n   */\n  replaceSelf?: boolean;\n}\n\nexport function User({\n  userId,\n  replaceSelf,\n  className,\n  children,\n  ...props\n}: UserProps) {\n  const currentId = useCurrentUserId();\n  const { user, isLoading } = useUser(userId);\n  const $ = useOverrides();\n  const resolvedUserName = useMemo(() => {\n    return replaceSelf && currentId === userId\n      ? $.USER_SELF\n      : (user?.name ?? $.USER_UNKNOWN);\n  }, [replaceSelf, currentId, userId, $.USER_SELF, $.USER_UNKNOWN, user?.name]);\n\n  return (\n    <span\n      className={cn(\"lb-name lb-user\", className)}\n      data-loading={isLoading ? \"\" : undefined}\n      {...props}\n    >\n      {isLoading ? null : resolvedUserName}\n      {children}\n    </span>\n  );\n}\n", "export function capitalize(string: string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\n", "import type { MutableRefObject, Ref, RefCallback } from \"react\";\nimport { useCallback } from \"react\";\n\nfunction applyRef<T>(ref: Ref<T>, value: T) {\n  if (value) {\n    if (typeof ref === \"function\") {\n      ref(value);\n    } else if (ref && \"current\" in ref) {\n      (ref as MutableRefObject<T>).current = value;\n    }\n  }\n}\n\nfunction mergeRefs<T>(value: T, ...refs: Ref<T>[]) {\n  for (const ref of refs) {\n    applyRef(ref, value);\n  }\n}\n\nexport function useRefs<T>(...refs: Ref<T>[]): RefCallback<T> {\n  // We want to compare the individual refs themselves, not the surrounding array\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  return useCallback((value: T) => mergeRefs(value, ...refs), refs);\n}\n", "/*!\n * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n *\n * Copyright (c) 2014-2017, Jon Schlinkert.\n * Released under the MIT License.\n */\n\nfunction isObject(o) {\n  return Object.prototype.toString.call(o) === '[object Object]';\n}\n\nfunction isPlainObject(o) {\n  var ctor,prot;\n\n  if (isObject(o) === false) return false;\n\n  // If has modified constructor\n  ctor = o.constructor;\n  if (ctor === undefined) return true;\n\n  // If has modified prototype\n  prot = ctor.prototype;\n  if (isObject(prot) === false) return false;\n\n  // If constructor does not have an Object-specific method\n  if (prot.hasOwnProperty('isPrototypeOf') === false) {\n    return false;\n  }\n\n  // Most likely a plain Object\n  return true;\n}\n\nexport { isPlainObject };\n", "// Should be no imports here!\n\n/**\n * The sentinel value returned by producers to replace the draft with undefined.\n */\nexport const NOTHING: unique symbol = Symbol.for(\"immer-nothing\")\n\n/**\n * To let Immer treat your class instances as plain immutable objects\n * (albeit with a custom prototype), you must define either an instance property\n * or a static property on each of your custom classes.\n *\n * Otherwise, your class instance will never be drafted, which means it won't be\n * safe to mutate in a produce callback.\n */\nexport const DRAFTABLE: unique symbol = Symbol.for(\"immer-draftable\")\n\nexport const DRAFT_STATE: unique symbol = Symbol.for(\"immer-state\")\n", "export const errors =\n\tprocess.env.NODE_ENV !== \"production\"\n\t\t? [\n\t\t\t\t// All error codes, starting by 0:\n\t\t\t\tfunction(plugin: string) {\n\t\t\t\t\treturn `The plugin for '${plugin}' has not been loaded into Immer. To enable the plugin, import and call \\`enable${plugin}()\\` when initializing your application.`\n\t\t\t\t},\n\t\t\t\tfunction(thing: string) {\n\t\t\t\t\treturn `produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${thing}'`\n\t\t\t\t},\n\t\t\t\t\"This object has been frozen and should not be mutated\",\n\t\t\t\tfunction(data: any) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t\"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \" +\n\t\t\t\t\t\tdata\n\t\t\t\t\t)\n\t\t\t\t},\n\t\t\t\t\"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",\n\t\t\t\t\"Immer forbids circular references\",\n\t\t\t\t\"The first or second argument to `produce` must be a function\",\n\t\t\t\t\"The third argument to `produce` must be a function or undefined\",\n\t\t\t\t\"First argument to `createDraft` must be a plain object, an array, or an immerable object\",\n\t\t\t\t\"First argument to `finishDraft` must be a draft returned by `createDraft`\",\n\t\t\t\tfunction(thing: string) {\n\t\t\t\t\treturn `'current' expects a draft, got: ${thing}`\n\t\t\t\t},\n\t\t\t\t\"Object.defineProperty() cannot be used on an Immer draft\",\n\t\t\t\t\"Object.setPrototypeOf() cannot be used on an Immer draft\",\n\t\t\t\t\"Immer only supports deleting array indices\",\n\t\t\t\t\"Immer only supports setting array indices and the 'length' property\",\n\t\t\t\tfunction(thing: string) {\n\t\t\t\t\treturn `'original' expects a draft, got: ${thing}`\n\t\t\t\t}\n\t\t\t\t// Note: if more errors are added, the errorOffset in Patches.ts should be increased\n\t\t\t\t// See Patches.ts for additional errors\n\t\t  ]\n\t\t: []\n\nexport function die(error: number, ...args: any[]): never {\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\tconst e = errors[error]\n\t\tconst msg = typeof e === \"function\" ? e.apply(null, args as any) : e\n\t\tthrow new Error(`[Immer] ${msg}`)\n\t}\n\tthrow new Error(\n\t\t`[Immer] minified error nr: ${error}. Full error at: https://bit.ly/3cXEKWf`\n\t)\n}\n", "import {\n\tDRAFT_STATE,\n\tDRAFTABLE,\n\tObjectish,\n\tDrafted,\n\tAnyObject,\n\tAnyMap,\n\tAnySet,\n\tImmerState,\n\tArchType,\n\tdie,\n\tStrictMode\n} from \"../internal\"\n\nexport const getPrototypeOf = Object.getPrototypeOf\n\n/** Returns true if the given value is an Immer draft */\n/*#__PURE__*/\nexport function isDraft(value: any): boolean {\n\treturn !!value && !!value[DRAFT_STATE]\n}\n\n/** Returns true if the given value can be drafted by Immer */\n/*#__PURE__*/\nexport function isDraftable(value: any): boolean {\n\tif (!value) return false\n\treturn (\n\t\tisPlainObject(value) ||\n\t\tArray.isArray(value) ||\n\t\t!!value[DRAFTABLE] ||\n\t\t!!value.constructor?.[DRAFTABLE] ||\n\t\tisMap(value) ||\n\t\tisSet(value)\n\t)\n}\n\nconst objectCtorString = Object.prototype.constructor.toString()\n/*#__PURE__*/\nexport function isPlainObject(value: any): boolean {\n\tif (!value || typeof value !== \"object\") return false\n\tconst proto = getPrototypeOf(value)\n\tif (proto === null) {\n\t\treturn true\n\t}\n\tconst Ctor =\n\t\tObject.hasOwnProperty.call(proto, \"constructor\") && proto.constructor\n\n\tif (Ctor === Object) return true\n\n\treturn (\n\t\ttypeof Ctor == \"function\" &&\n\t\tFunction.toString.call(Ctor) === objectCtorString\n\t)\n}\n\n/** Get the underlying object that is represented by the given draft */\n/*#__PURE__*/\nexport function original<T>(value: T): T | undefined\nexport function original(value: Drafted<any>): any {\n\tif (!isDraft(value)) die(15, value)\n\treturn value[DRAFT_STATE].base_\n}\n\n/**\n * Each iterates a map, set or array.\n * Or, if any other kind of object, all of its own properties.\n * Regardless whether they are enumerable or symbols\n */\nexport function each<T extends Objectish>(\n\tobj: T,\n\titer: (key: string | number, value: any, source: T) => void\n): void\nexport function each(obj: any, iter: any) {\n\tif (getArchtype(obj) === ArchType.Object) {\n\t\tReflect.ownKeys(obj).forEach(key => {\n\t\t\titer(key, obj[key], obj)\n\t\t})\n\t} else {\n\t\tobj.forEach((entry: any, index: any) => iter(index, entry, obj))\n\t}\n}\n\n/*#__PURE__*/\nexport function getArchtype(thing: any): ArchType {\n\tconst state: undefined | ImmerState = thing[DRAFT_STATE]\n\treturn state\n\t\t? state.type_\n\t\t: Array.isArray(thing)\n\t\t? ArchType.Array\n\t\t: isMap(thing)\n\t\t? ArchType.Map\n\t\t: isSet(thing)\n\t\t? ArchType.Set\n\t\t: ArchType.Object\n}\n\n/*#__PURE__*/\nexport function has(thing: any, prop: PropertyKey): boolean {\n\treturn getArchtype(thing) === ArchType.Map\n\t\t? thing.has(prop)\n\t\t: Object.prototype.hasOwnProperty.call(thing, prop)\n}\n\n/*#__PURE__*/\nexport function get(thing: AnyMap | AnyObject, prop: PropertyKey): any {\n\t// @ts-ignore\n\treturn getArchtype(thing) === ArchType.Map ? thing.get(prop) : thing[prop]\n}\n\n/*#__PURE__*/\nexport function set(thing: any, propOrOldValue: PropertyKey, value: any) {\n\tconst t = getArchtype(thing)\n\tif (t === ArchType.Map) thing.set(propOrOldValue, value)\n\telse if (t === ArchType.Set) {\n\t\tthing.add(value)\n\t} else thing[propOrOldValue] = value\n}\n\n/*#__PURE__*/\nexport function is(x: any, y: any): boolean {\n\t// From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n\tif (x === y) {\n\t\treturn x !== 0 || 1 / x === 1 / y\n\t} else {\n\t\treturn x !== x && y !== y\n\t}\n}\n\n/*#__PURE__*/\nexport function isMap(target: any): target is AnyMap {\n\treturn target instanceof Map\n}\n\n/*#__PURE__*/\nexport function isSet(target: any): target is AnySet {\n\treturn target instanceof Set\n}\n/*#__PURE__*/\nexport function latest(state: ImmerState): any {\n\treturn state.copy_ || state.base_\n}\n\n/*#__PURE__*/\nexport function shallowCopy(base: any, strict: StrictMode) {\n\tif (isMap(base)) {\n\t\treturn new Map(base)\n\t}\n\tif (isSet(base)) {\n\t\treturn new Set(base)\n\t}\n\tif (Array.isArray(base)) return Array.prototype.slice.call(base)\n\n\tconst isPlain = isPlainObject(base)\n\n\tif (strict === true || (strict === \"class_only\" && !isPlain)) {\n\t\t// Perform a strict copy\n\t\tconst descriptors = Object.getOwnPropertyDescriptors(base)\n\t\tdelete descriptors[DRAFT_STATE as any]\n\t\tlet keys = Reflect.ownKeys(descriptors)\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst key: any = keys[i]\n\t\t\tconst desc = descriptors[key]\n\t\t\tif (desc.writable === false) {\n\t\t\t\tdesc.writable = true\n\t\t\t\tdesc.configurable = true\n\t\t\t}\n\t\t\t// like object.assign, we will read any _own_, get/set accessors. This helps in dealing\n\t\t\t// with libraries that trap values, like mobx or vue\n\t\t\t// unlike object.assign, non-enumerables will be copied as well\n\t\t\tif (desc.get || desc.set)\n\t\t\t\tdescriptors[key] = {\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\twritable: true, // could live with !!desc.set as well here...\n\t\t\t\t\tenumerable: desc.enumerable,\n\t\t\t\t\tvalue: base[key]\n\t\t\t\t}\n\t\t}\n\t\treturn Object.create(getPrototypeOf(base), descriptors)\n\t} else {\n\t\t// perform a sloppy copy\n\t\tconst proto = getPrototypeOf(base)\n\t\tif (proto !== null && isPlain) {\n\t\t\treturn {...base} // assumption: better inner class optimization than the assign below\n\t\t}\n\t\tconst obj = Object.create(proto)\n\t\treturn Object.assign(obj, base)\n\t}\n}\n\n/**\n * Freezes draftable objects. Returns the original object.\n * By default freezes shallowly, but if the second argument is `true` it will freeze recursively.\n *\n * @param obj\n * @param deep\n */\nexport function freeze<T>(obj: T, deep?: boolean): T\nexport function freeze<T>(obj: any, deep: boolean = false): T {\n\tif (isFrozen(obj) || isDraft(obj) || !isDraftable(obj)) return obj\n\tif (getArchtype(obj) > 1 /* Map or Set */) {\n\t\t Object.defineProperties(obj, {\n                        set: {value: dontMutateFrozenCollections as any},\n                        add: {value: dontMutateFrozenCollections as any},\n                        clear: {value: dontMutateFrozenCollections as any},\n                        delete: {value: dontMutateFrozenCollections as any}\n                })\n\t}\n\tObject.freeze(obj)\n\tif (deep)\n\t\t// See #590, don't recurse into non-enumerable / Symbol properties when freezing\n\t\t// So use Object.values (only string-like, enumerables) instead of each()\n\t\tObject.values(obj).forEach(value => freeze(value, true))\n\treturn obj\n}\n\nfunction dontMutateFrozenCollections() {\n\tdie(2)\n}\n\nexport function isFrozen(obj: any): boolean {\n\treturn Object.isFrozen(obj)\n}\n", "import {\n\tImmerState,\n\tPatch,\n\tDrafted,\n\tImmerBaseState,\n\tAnyMap,\n\tAnySet,\n\tArchType,\n\tdie\n} from \"../internal\"\n\n/** Plugin utilities */\nconst plugins: {\n\tPatches?: {\n\t\tgeneratePatches_(\n\t\t\tstate: ImmerState,\n\t\t\tbasePath: PatchPath,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tgenerateReplacementPatches_(\n\t\t\tbase: any,\n\t\t\treplacement: any,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tapplyPatches_<T>(draft: T, patches: readonly Patch[]): T\n\t}\n\tMapSet?: {\n\t\tproxyMap_<T extends AnyMap>(target: T, parent?: ImmerState): T\n\t\tproxySet_<T extends AnySet>(target: T, parent?: ImmerState): T\n\t}\n} = {}\n\ntype Plugins = typeof plugins\n\nexport function getPlugin<K extends keyof Plugins>(\n\tpluginKey: K\n): Exclude<Plugins[K], undefined> {\n\tconst plugin = plugins[pluginKey]\n\tif (!plugin) {\n\t\tdie(0, pluginKey)\n\t}\n\t// @ts-ignore\n\treturn plugin\n}\n\nexport function loadPlugin<K extends keyof Plugins>(\n\tpluginKey: K,\n\timplementation: Plugins[K]\n): void {\n\tif (!plugins[pluginKey]) plugins[pluginKey] = implementation\n}\n/** Map / Set plugin */\n\nexport interface MapState extends ImmerBaseState {\n\ttype_: ArchType.Map\n\tcopy_: AnyMap | undefined\n\tassigned_: Map<any, boolean> | undefined\n\tbase_: AnyMap\n\trevoked_: boolean\n\tdraft_: Drafted<AnyMap, MapState>\n}\n\nexport interface SetState extends ImmerBaseState {\n\ttype_: ArchType.Set\n\tcopy_: AnySet | undefined\n\tbase_: AnySet\n\tdrafts_: Map<any, Drafted> // maps the original value to the draft value in the new set\n\trevoked_: boolean\n\tdraft_: Drafted<AnySet, SetState>\n}\n\n/** Patches plugin */\n\nexport type PatchPath = (string | number)[]\n", "import {\n\tPatch,\n\tPatchListener,\n\tDrafted,\n\tImmer,\n\tDRAFT_STATE,\n\tImmerState,\n\tArchType,\n\tgetPlugin\n} from \"../internal\"\n\n/** Each scope represents a `produce` call. */\n\nexport interface ImmerScope {\n\tpatches_?: Patch[]\n\tinversePatches_?: Patch[]\n\tcanAutoFreeze_: boolean\n\tdrafts_: any[]\n\tparent_?: ImmerScope\n\tpatchListener_?: PatchListener\n\timmer_: Immer\n\tunfinalizedDrafts_: number\n}\n\nlet currentScope: ImmerScope | undefined\n\nexport function getCurrentScope() {\n\treturn currentScope!\n}\n\nfunction createScope(\n\tparent_: ImmerScope | undefined,\n\timmer_: Immer\n): ImmerScope {\n\treturn {\n\t\tdrafts_: [],\n\t\tparent_,\n\t\timmer_,\n\t\t// Whenever the modified draft contains a draft from another scope, we\n\t\t// need to prevent auto-freezing so the unowned draft can be finalized.\n\t\tcanAutoFreeze_: true,\n\t\tunfinalizedDrafts_: 0\n\t}\n}\n\nexport function usePatchesInScope(\n\tscope: ImmerScope,\n\tpatchListener?: PatchListener\n) {\n\tif (patchListener) {\n\t\tgetPlugin(\"Patches\") // assert we have the plugin\n\t\tscope.patches_ = []\n\t\tscope.inversePatches_ = []\n\t\tscope.patchListener_ = patchListener\n\t}\n}\n\nexport function revokeScope(scope: ImmerScope) {\n\tleaveScope(scope)\n\tscope.drafts_.forEach(revokeDraft)\n\t// @ts-ignore\n\tscope.drafts_ = null\n}\n\nexport function leaveScope(scope: ImmerScope) {\n\tif (scope === currentScope) {\n\t\tcurrentScope = scope.parent_\n\t}\n}\n\nexport function enterScope(immer: Immer) {\n\treturn (currentScope = createScope(currentScope, immer))\n}\n\nfunction revokeDraft(draft: Drafted) {\n\tconst state: ImmerState = draft[DRAFT_STATE]\n\tif (state.type_ === ArchType.Object || state.type_ === ArchType.Array)\n\t\tstate.revoke_()\n\telse state.revoked_ = true\n}\n", "import {\n\tImmerScope,\n\tDRAFT_STATE,\n\tisDraftable,\n\tNOTHING,\n\tPatchPath,\n\teach,\n\thas,\n\tfreeze,\n\tImmerState,\n\tisDraft,\n\tSetState,\n\tset,\n\tArchType,\n\tgetPlugin,\n\tdie,\n\trevokeScope,\n\tisFrozen,\n\tisMap\n} from \"../internal\"\n\nexport function processResult(result: any, scope: ImmerScope) {\n\tscope.unfinalizedDrafts_ = scope.drafts_.length\n\tconst baseDraft = scope.drafts_![0]\n\tconst isReplaced = result !== undefined && result !== baseDraft\n\tif (isReplaced) {\n\t\tif (baseDraft[DRAFT_STATE].modified_) {\n\t\t\trevokeScope(scope)\n\t\t\tdie(4)\n\t\t}\n\t\tif (isDraftable(result)) {\n\t\t\t// Finalize the result in case it contains (or is) a subset of the draft.\n\t\t\tresult = finalize(scope, result)\n\t\t\tif (!scope.parent_) maybeFreeze(scope, result)\n\t\t}\n\t\tif (scope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generateReplacementPatches_(\n\t\t\t\tbaseDraft[DRAFT_STATE].base_,\n\t\t\t\tresult,\n\t\t\t\tscope.patches_,\n\t\t\t\tscope.inversePatches_!\n\t\t\t)\n\t\t}\n\t} else {\n\t\t// Finalize the base draft.\n\t\tresult = finalize(scope, baseDraft, [])\n\t}\n\trevokeScope(scope)\n\tif (scope.patches_) {\n\t\tscope.patchListener_!(scope.patches_, scope.inversePatches_!)\n\t}\n\treturn result !== NOTHING ? result : undefined\n}\n\nfunction finalize(rootScope: ImmerScope, value: any, path?: PatchPath) {\n\t// Don't recurse in tho recursive data structures\n\tif (isFrozen(value)) return value\n\n\tconst state: ImmerState = value[DRAFT_STATE]\n\t// A plain object, might need freezing, might contain drafts\n\tif (!state) {\n\t\teach(value, (key, childValue) =>\n\t\t\tfinalizeProperty(rootScope, state, value, key, childValue, path)\n\t\t)\n\t\treturn value\n\t}\n\t// Never finalize drafts owned by another scope.\n\tif (state.scope_ !== rootScope) return value\n\t// Unmodified draft, return the (frozen) original\n\tif (!state.modified_) {\n\t\tmaybeFreeze(rootScope, state.base_, true)\n\t\treturn state.base_\n\t}\n\t// Not finalized yet, let's do that now\n\tif (!state.finalized_) {\n\t\tstate.finalized_ = true\n\t\tstate.scope_.unfinalizedDrafts_--\n\t\tconst result = state.copy_\n\t\t// Finalize all children of the copy\n\t\t// For sets we clone before iterating, otherwise we can get in endless loop due to modifying during iteration, see #628\n\t\t// To preserve insertion order in all cases we then clear the set\n\t\t// And we let finalizeProperty know it needs to re-add non-draft children back to the target\n\t\tlet resultEach = result\n\t\tlet isSet = false\n\t\tif (state.type_ === ArchType.Set) {\n\t\t\tresultEach = new Set(result)\n\t\t\tresult.clear()\n\t\t\tisSet = true\n\t\t}\n\t\teach(resultEach, (key, childValue) =>\n\t\t\tfinalizeProperty(rootScope, state, result, key, childValue, path, isSet)\n\t\t)\n\t\t// everything inside is frozen, we can freeze here\n\t\tmaybeFreeze(rootScope, result, false)\n\t\t// first time finalizing, let's create those patches\n\t\tif (path && rootScope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generatePatches_(\n\t\t\t\tstate,\n\t\t\t\tpath,\n\t\t\t\trootScope.patches_,\n\t\t\t\trootScope.inversePatches_!\n\t\t\t)\n\t\t}\n\t}\n\treturn state.copy_\n}\n\nfunction finalizeProperty(\n\trootScope: ImmerScope,\n\tparentState: undefined | ImmerState,\n\ttargetObject: any,\n\tprop: string | number,\n\tchildValue: any,\n\trootPath?: PatchPath,\n\ttargetIsSet?: boolean\n) {\n\tif (process.env.NODE_ENV !== \"production\" && childValue === targetObject)\n\t\tdie(5)\n\tif (isDraft(childValue)) {\n\t\tconst path =\n\t\t\trootPath &&\n\t\t\tparentState &&\n\t\t\tparentState!.type_ !== ArchType.Set && // Set objects are atomic since they have no keys.\n\t\t\t!has((parentState as Exclude<ImmerState, SetState>).assigned_!, prop) // Skip deep patches for assigned keys.\n\t\t\t\t? rootPath!.concat(prop)\n\t\t\t\t: undefined\n\t\t// Drafts owned by `scope` are finalized here.\n\t\tconst res = finalize(rootScope, childValue, path)\n\t\tset(targetObject, prop, res)\n\t\t// Drafts from another scope must prevented to be frozen\n\t\t// if we got a draft back from finalize, we're in a nested produce and shouldn't freeze\n\t\tif (isDraft(res)) {\n\t\t\trootScope.canAutoFreeze_ = false\n\t\t} else return\n\t} else if (targetIsSet) {\n\t\ttargetObject.add(childValue)\n\t}\n\t// Search new objects for unfinalized drafts. Frozen objects should never contain drafts.\n\tif (isDraftable(childValue) && !isFrozen(childValue)) {\n\t\tif (!rootScope.immer_.autoFreeze_ && rootScope.unfinalizedDrafts_ < 1) {\n\t\t\t// optimization: if an object is not a draft, and we don't have to\n\t\t\t// deepfreeze everything, and we are sure that no drafts are left in the remaining object\n\t\t\t// cause we saw and finalized all drafts already; we can stop visiting the rest of the tree.\n\t\t\t// This benefits especially adding large data tree's without further processing.\n\t\t\t// See add-data.js perf test\n\t\t\treturn\n\t\t}\n\t\tfinalize(rootScope, childValue)\n\t\t// Immer deep freezes plain objects, so if there is no parent state, we freeze as well\n\t\t// Per #590, we never freeze symbolic properties. Just to make sure don't accidentally interfere\n\t\t// with other frameworks.\n\t\tif (\n\t\t\t(!parentState || !parentState.scope_.parent_) &&\n\t\t\ttypeof prop !== \"symbol\" &&\n\t\t\t(isMap(targetObject)\n\t\t\t\t? targetObject.has(prop)\n\t\t\t\t: Object.prototype.propertyIsEnumerable.call(targetObject, prop))\n\t\t)\n\t\t\tmaybeFreeze(rootScope, childValue)\n\t}\n}\n\nfunction maybeFreeze(scope: ImmerScope, value: any, deep = false) {\n\t// we never freeze for a non-root scope; as it would prevent pruning for drafts inside wrapping objects\n\tif (!scope.parent_ && scope.immer_.autoFreeze_ && scope.canAutoFreeze_) {\n\t\tfreeze(value, deep)\n\t}\n}\n", "import {\n\teach,\n\thas,\n\tis,\n\tisDraftable,\n\tshallowCopy,\n\tlatest,\n\tImmerBaseState,\n\tImmerState,\n\tDrafted,\n\tAnyObject,\n\tAnyArray,\n\tObjectish,\n\tgetCurrentScope,\n\tgetPrototypeOf,\n\tDRAFT_STATE,\n\tdie,\n\tcreateProxy,\n\tArchType,\n\tImmerScope\n} from \"../internal\"\n\ninterface ProxyBaseState extends ImmerBaseState {\n\tassigned_: {\n\t\t[property: string]: boolean\n\t}\n\tparent_?: ImmerState\n\trevoke_(): void\n}\n\nexport interface ProxyObjectState extends ProxyBaseState {\n\ttype_: ArchType.Object\n\tbase_: any\n\tcopy_: any\n\tdraft_: Drafted<AnyObject, ProxyObjectState>\n}\n\nexport interface ProxyArrayState extends ProxyBaseState {\n\ttype_: ArchType.Array\n\tbase_: AnyArray\n\tcopy_: AnyArray | null\n\tdraft_: Drafted<AnyArray, ProxyArrayState>\n}\n\ntype ProxyState = ProxyObjectState | ProxyArrayState\n\n/**\n * Returns a new draft of the `base` object.\n *\n * The second argument is the parent draft-state (used internally).\n */\nexport function createProxyProxy<T extends Objectish>(\n\tbase: T,\n\tparent?: ImmerState\n): Drafted<T, ProxyState> {\n\tconst isArray = Array.isArray(base)\n\tconst state: ProxyState = {\n\t\ttype_: isArray ? ArchType.Array : (ArchType.Object as any),\n\t\t// Track which produce call this is associated with.\n\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t// True for both shallow and deep changes.\n\t\tmodified_: false,\n\t\t// Used during finalization.\n\t\tfinalized_: false,\n\t\t// Track which properties have been assigned (true) or deleted (false).\n\t\tassigned_: {},\n\t\t// The parent draft state.\n\t\tparent_: parent,\n\t\t// The base state.\n\t\tbase_: base,\n\t\t// The base proxy.\n\t\tdraft_: null as any, // set below\n\t\t// The base copy with any updated values.\n\t\tcopy_: null,\n\t\t// Called by the `produce` function.\n\t\trevoke_: null as any,\n\t\tisManual_: false\n\t}\n\n\t// the traps must target something, a bit like the 'real' base.\n\t// but also, we need to be able to determine from the target what the relevant state is\n\t// (to avoid creating traps per instance to capture the state in closure,\n\t// and to avoid creating weird hidden properties as well)\n\t// So the trick is to use 'state' as the actual 'target'! (and make sure we intercept everything)\n\t// Note that in the case of an array, we put the state in an array to have better Reflect defaults ootb\n\tlet target: T = state as any\n\tlet traps: ProxyHandler<object | Array<any>> = objectTraps\n\tif (isArray) {\n\t\ttarget = [state] as any\n\t\ttraps = arrayTraps\n\t}\n\n\tconst {revoke, proxy} = Proxy.revocable(target, traps)\n\tstate.draft_ = proxy as any\n\tstate.revoke_ = revoke\n\treturn proxy as any\n}\n\n/**\n * Object drafts\n */\nexport const objectTraps: ProxyHandler<ProxyState> = {\n\tget(state, prop) {\n\t\tif (prop === DRAFT_STATE) return state\n\n\t\tconst source = latest(state)\n\t\tif (!has(source, prop)) {\n\t\t\t// non-existing or non-own property...\n\t\t\treturn readPropFromProto(state, source, prop)\n\t\t}\n\t\tconst value = source[prop]\n\t\tif (state.finalized_ || !isDraftable(value)) {\n\t\t\treturn value\n\t\t}\n\t\t// Check for existing draft in modified state.\n\t\t// Assigned values are never drafted. This catches any drafts we created, too.\n\t\tif (value === peek(state.base_, prop)) {\n\t\t\tprepareCopy(state)\n\t\t\treturn (state.copy_![prop as any] = createProxy(value, state))\n\t\t}\n\t\treturn value\n\t},\n\thas(state, prop) {\n\t\treturn prop in latest(state)\n\t},\n\townKeys(state) {\n\t\treturn Reflect.ownKeys(latest(state))\n\t},\n\tset(\n\t\tstate: ProxyObjectState,\n\t\tprop: string /* strictly not, but helps TS */,\n\t\tvalue\n\t) {\n\t\tconst desc = getDescriptorFromProto(latest(state), prop)\n\t\tif (desc?.set) {\n\t\t\t// special case: if this write is captured by a setter, we have\n\t\t\t// to trigger it with the correct context\n\t\t\tdesc.set.call(state.draft_, value)\n\t\t\treturn true\n\t\t}\n\t\tif (!state.modified_) {\n\t\t\t// the last check is because we need to be able to distinguish setting a non-existing to undefined (which is a change)\n\t\t\t// from setting an existing property with value undefined to undefined (which is not a change)\n\t\t\tconst current = peek(latest(state), prop)\n\t\t\t// special case, if we assigning the original value to a draft, we can ignore the assignment\n\t\t\tconst currentState: ProxyObjectState = current?.[DRAFT_STATE]\n\t\t\tif (currentState && currentState.base_ === value) {\n\t\t\t\tstate.copy_![prop] = value\n\t\t\t\tstate.assigned_[prop] = false\n\t\t\t\treturn true\n\t\t\t}\n\t\t\tif (is(value, current) && (value !== undefined || has(state.base_, prop)))\n\t\t\t\treturn true\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t}\n\n\t\tif (\n\t\t\t(state.copy_![prop] === value &&\n\t\t\t\t// special case: handle new props with value 'undefined'\n\t\t\t\t(value !== undefined || prop in state.copy_)) ||\n\t\t\t// special case: NaN\n\t\t\t(Number.isNaN(value) && Number.isNaN(state.copy_![prop]))\n\t\t)\n\t\t\treturn true\n\n\t\t// @ts-ignore\n\t\tstate.copy_![prop] = value\n\t\tstate.assigned_[prop] = true\n\t\treturn true\n\t},\n\tdeleteProperty(state, prop: string) {\n\t\t// The `undefined` check is a fast path for pre-existing keys.\n\t\tif (peek(state.base_, prop) !== undefined || prop in state.base_) {\n\t\t\tstate.assigned_[prop] = false\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t} else {\n\t\t\t// if an originally not assigned property was deleted\n\t\t\tdelete state.assigned_[prop]\n\t\t}\n\t\tif (state.copy_) {\n\t\t\tdelete state.copy_[prop]\n\t\t}\n\t\treturn true\n\t},\n\t// Note: We never coerce `desc.value` into an Immer draft, because we can't make\n\t// the same guarantee in ES5 mode.\n\tgetOwnPropertyDescriptor(state, prop) {\n\t\tconst owner = latest(state)\n\t\tconst desc = Reflect.getOwnPropertyDescriptor(owner, prop)\n\t\tif (!desc) return desc\n\t\treturn {\n\t\t\twritable: true,\n\t\t\tconfigurable: state.type_ !== ArchType.Array || prop !== \"length\",\n\t\t\tenumerable: desc.enumerable,\n\t\t\tvalue: owner[prop]\n\t\t}\n\t},\n\tdefineProperty() {\n\t\tdie(11)\n\t},\n\tgetPrototypeOf(state) {\n\t\treturn getPrototypeOf(state.base_)\n\t},\n\tsetPrototypeOf() {\n\t\tdie(12)\n\t}\n}\n\n/**\n * Array drafts\n */\n\nconst arrayTraps: ProxyHandler<[ProxyArrayState]> = {}\neach(objectTraps, (key, fn) => {\n\t// @ts-ignore\n\tarrayTraps[key] = function() {\n\t\targuments[0] = arguments[0][0]\n\t\treturn fn.apply(this, arguments)\n\t}\n})\narrayTraps.deleteProperty = function(state, prop) {\n\tif (process.env.NODE_ENV !== \"production\" && isNaN(parseInt(prop as any)))\n\t\tdie(13)\n\t// @ts-ignore\n\treturn arrayTraps.set!.call(this, state, prop, undefined)\n}\narrayTraps.set = function(state, prop, value) {\n\tif (\n\t\tprocess.env.NODE_ENV !== \"production\" &&\n\t\tprop !== \"length\" &&\n\t\tisNaN(parseInt(prop as any))\n\t)\n\t\tdie(14)\n\treturn objectTraps.set!.call(this, state[0], prop, value, state[0])\n}\n\n// Access a property without creating an Immer draft.\nfunction peek(draft: Drafted, prop: PropertyKey) {\n\tconst state = draft[DRAFT_STATE]\n\tconst source = state ? latest(state) : draft\n\treturn source[prop]\n}\n\nfunction readPropFromProto(state: ImmerState, source: any, prop: PropertyKey) {\n\tconst desc = getDescriptorFromProto(source, prop)\n\treturn desc\n\t\t? `value` in desc\n\t\t\t? desc.value\n\t\t\t: // This is a very special case, if the prop is a getter defined by the\n\t\t\t  // prototype, we should invoke it with the draft as context!\n\t\t\t  desc.get?.call(state.draft_)\n\t\t: undefined\n}\n\nfunction getDescriptorFromProto(\n\tsource: any,\n\tprop: PropertyKey\n): PropertyDescriptor | undefined {\n\t// 'in' checks proto!\n\tif (!(prop in source)) return undefined\n\tlet proto = getPrototypeOf(source)\n\twhile (proto) {\n\t\tconst desc = Object.getOwnPropertyDescriptor(proto, prop)\n\t\tif (desc) return desc\n\t\tproto = getPrototypeOf(proto)\n\t}\n\treturn undefined\n}\n\nexport function markChanged(state: ImmerState) {\n\tif (!state.modified_) {\n\t\tstate.modified_ = true\n\t\tif (state.parent_) {\n\t\t\tmarkChanged(state.parent_)\n\t\t}\n\t}\n}\n\nexport function prepareCopy(state: {\n\tbase_: any\n\tcopy_: any\n\tscope_: ImmerScope\n}) {\n\tif (!state.copy_) {\n\t\tstate.copy_ = shallowCopy(\n\t\t\tstate.base_,\n\t\t\tstate.scope_.immer_.useStrictShallowCopy_\n\t\t)\n\t}\n}\n", "import {\n\tIProduceWithPatches,\n\tIProduce,\n\tImmerState,\n\tDrafted,\n\tisDraftable,\n\tprocessResult,\n\tPatch,\n\tObjectish,\n\tDRAFT_STATE,\n\tDraft,\n\tPatchListener,\n\tisDraft,\n\tisMap,\n\tisSet,\n\tcreateProxyProxy,\n\tgetPlugin,\n\tdie,\n\tenterScope,\n\trevokeScope,\n\tleaveScope,\n\tusePatchesInScope,\n\tgetCurrentScope,\n\tNOTHING,\n\tfreeze,\n\tcurrent\n} from \"../internal\"\n\ninterface ProducersFns {\n\tproduce: IProduce\n\tproduceWithPatches: IProduceWithPatches\n}\n\nexport type StrictMode = boolean | \"class_only\";\n\nexport class Immer implements ProducersFns {\n\tautoFreeze_: boolean = true\n\tuseStrictShallowCopy_: StrictMode = false\n\n\tconstructor(config?: {\n\t\tautoFreeze?: boolean\n\t\tuseStrictShallowCopy?: StrictMode\n\t}) {\n\t\tif (typeof config?.autoFreeze === \"boolean\")\n\t\t\tthis.setAutoFreeze(config!.autoFreeze)\n\t\tif (typeof config?.useStrictShallowCopy === \"boolean\")\n\t\t\tthis.setUseStrictShallowCopy(config!.useStrictShallowCopy)\n\t}\n\n\t/**\n\t * The `produce` function takes a value and a \"recipe function\" (whose\n\t * return value often depends on the base state). The recipe function is\n\t * free to mutate its first argument however it wants. All mutations are\n\t * only ever applied to a __copy__ of the base state.\n\t *\n\t * Pass only a function to create a \"curried producer\" which relieves you\n\t * from passing the recipe function every time.\n\t *\n\t * Only plain objects and arrays are made mutable. All other objects are\n\t * considered uncopyable.\n\t *\n\t * Note: This function is __bound__ to its `Immer` instance.\n\t *\n\t * @param {any} base - the initial state\n\t * @param {Function} recipe - function that receives a proxy of the base state as first argument and which can be freely modified\n\t * @param {Function} patchListener - optional function that will be called with all the patches produced here\n\t * @returns {any} a new state, or the initial state if nothing was modified\n\t */\n\tproduce: IProduce = (base: any, recipe?: any, patchListener?: any) => {\n\t\t// curried invocation\n\t\tif (typeof base === \"function\" && typeof recipe !== \"function\") {\n\t\t\tconst defaultBase = recipe\n\t\t\trecipe = base\n\n\t\t\tconst self = this\n\t\t\treturn function curriedProduce(\n\t\t\t\tthis: any,\n\t\t\t\tbase = defaultBase,\n\t\t\t\t...args: any[]\n\t\t\t) {\n\t\t\t\treturn self.produce(base, (draft: Drafted) => recipe.call(this, draft, ...args)) // prettier-ignore\n\t\t\t}\n\t\t}\n\n\t\tif (typeof recipe !== \"function\") die(6)\n\t\tif (patchListener !== undefined && typeof patchListener !== \"function\")\n\t\t\tdie(7)\n\n\t\tlet result\n\n\t\t// Only plain objects, arrays, and \"immerable classes\" are drafted.\n\t\tif (isDraftable(base)) {\n\t\t\tconst scope = enterScope(this)\n\t\t\tconst proxy = createProxy(base, undefined)\n\t\t\tlet hasError = true\n\t\t\ttry {\n\t\t\t\tresult = recipe(proxy)\n\t\t\t\thasError = false\n\t\t\t} finally {\n\t\t\t\t// finally instead of catch + rethrow better preserves original stack\n\t\t\t\tif (hasError) revokeScope(scope)\n\t\t\t\telse leaveScope(scope)\n\t\t\t}\n\t\t\tusePatchesInScope(scope, patchListener)\n\t\t\treturn processResult(result, scope)\n\t\t} else if (!base || typeof base !== \"object\") {\n\t\t\tresult = recipe(base)\n\t\t\tif (result === undefined) result = base\n\t\t\tif (result === NOTHING) result = undefined\n\t\t\tif (this.autoFreeze_) freeze(result, true)\n\t\t\tif (patchListener) {\n\t\t\t\tconst p: Patch[] = []\n\t\t\t\tconst ip: Patch[] = []\n\t\t\t\tgetPlugin(\"Patches\").generateReplacementPatches_(base, result, p, ip)\n\t\t\t\tpatchListener(p, ip)\n\t\t\t}\n\t\t\treturn result\n\t\t} else die(1, base)\n\t}\n\n\tproduceWithPatches: IProduceWithPatches = (base: any, recipe?: any): any => {\n\t\t// curried invocation\n\t\tif (typeof base === \"function\") {\n\t\t\treturn (state: any, ...args: any[]) =>\n\t\t\t\tthis.produceWithPatches(state, (draft: any) => base(draft, ...args))\n\t\t}\n\n\t\tlet patches: Patch[], inversePatches: Patch[]\n\t\tconst result = this.produce(base, recipe, (p: Patch[], ip: Patch[]) => {\n\t\t\tpatches = p\n\t\t\tinversePatches = ip\n\t\t})\n\t\treturn [result, patches!, inversePatches!]\n\t}\n\n\tcreateDraft<T extends Objectish>(base: T): Draft<T> {\n\t\tif (!isDraftable(base)) die(8)\n\t\tif (isDraft(base)) base = current(base)\n\t\tconst scope = enterScope(this)\n\t\tconst proxy = createProxy(base, undefined)\n\t\tproxy[DRAFT_STATE].isManual_ = true\n\t\tleaveScope(scope)\n\t\treturn proxy as any\n\t}\n\n\tfinishDraft<D extends Draft<any>>(\n\t\tdraft: D,\n\t\tpatchListener?: PatchListener\n\t): D extends Draft<infer T> ? T : never {\n\t\tconst state: ImmerState = draft && (draft as any)[DRAFT_STATE]\n\t\tif (!state || !state.isManual_) die(9)\n\t\tconst {scope_: scope} = state\n\t\tusePatchesInScope(scope, patchListener)\n\t\treturn processResult(undefined, scope)\n\t}\n\n\t/**\n\t * Pass true to automatically freeze all copies created by Immer.\n\t *\n\t * By default, auto-freezing is enabled.\n\t */\n\tsetAutoFreeze(value: boolean) {\n\t\tthis.autoFreeze_ = value\n\t}\n\n\t/**\n\t * Pass true to enable strict shallow copy.\n\t *\n\t * By default, immer does not copy the object descriptors such as getter, setter and non-enumrable properties.\n\t */\n\tsetUseStrictShallowCopy(value: StrictMode) {\n\t\tthis.useStrictShallowCopy_ = value\n\t}\n\n\tapplyPatches<T extends Objectish>(base: T, patches: readonly Patch[]): T {\n\t\t// If a patch replaces the entire state, take that replacement as base\n\t\t// before applying patches\n\t\tlet i: number\n\t\tfor (i = patches.length - 1; i >= 0; i--) {\n\t\t\tconst patch = patches[i]\n\t\t\tif (patch.path.length === 0 && patch.op === \"replace\") {\n\t\t\t\tbase = patch.value\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\t// If there was a patch that replaced the entire state, start from the\n\t\t// patch after that.\n\t\tif (i > -1) {\n\t\t\tpatches = patches.slice(i + 1)\n\t\t}\n\n\t\tconst applyPatchesImpl = getPlugin(\"Patches\").applyPatches_\n\t\tif (isDraft(base)) {\n\t\t\t// N.B: never hits if some patch a replacement, patches are never drafts\n\t\t\treturn applyPatchesImpl(base, patches)\n\t\t}\n\t\t// Otherwise, produce a copy of the base state.\n\t\treturn this.produce(base, (draft: Drafted) =>\n\t\t\tapplyPatchesImpl(draft, patches)\n\t\t)\n\t}\n}\n\nexport function createProxy<T extends Objectish>(\n\tvalue: T,\n\tparent?: ImmerState\n): Drafted<T, ImmerState> {\n\t// precondition: createProxy should be guarded by isDraftable, so we know we can safely draft\n\tconst draft: Drafted = isMap(value)\n\t\t? getPlugin(\"MapSet\").proxyMap_(value, parent)\n\t\t: isSet(value)\n\t\t? getPlugin(\"MapSet\").proxySet_(value, parent)\n\t\t: createProxyProxy(value, parent)\n\n\tconst scope = parent ? parent.scope_ : getCurrentScope()\n\tscope.drafts_.push(draft)\n\treturn draft\n}\n", "import {\n\tdie,\n\tisDraft,\n\tshallowCopy,\n\teach,\n\tDRAFT_STATE,\n\tset,\n\tImmerState,\n\tisDraftable,\n\tisFrozen\n} from \"../internal\"\n\n/** Takes a snapshot of the current state of a draft and finalizes it (but without freezing). This is a great utility to print the current state during debugging (no Proxies in the way). The output of current can also be safely leaked outside the producer. */\nexport function current<T>(value: T): T\nexport function current(value: any): any {\n\tif (!isDraft(value)) die(10, value)\n\treturn currentImpl(value)\n}\n\nfunction currentImpl(value: any): any {\n\tif (!isDraftable(value) || isFrozen(value)) return value\n\tconst state: ImmerState | undefined = value[DRAFT_STATE]\n\tlet copy: any\n\tif (state) {\n\t\tif (!state.modified_) return state.base_\n\t\t// Optimization: avoid generating new drafts during copying\n\t\tstate.finalized_ = true\n\t\tcopy = shallowCopy(value, state.scope_.immer_.useStrictShallowCopy_)\n\t} else {\n\t\tcopy = shallowCopy(value, true)\n\t}\n\t// recurse\n\teach(copy, (key, childValue) => {\n\t\tset(copy, key, currentImpl(childValue))\n\t})\n\tif (state) {\n\t\tstate.finalized_ = false\n\t}\n\treturn copy\n}\n", "import {immerable} from \"../immer\"\nimport {\n\tImmerState,\n\tPatch,\n\tSetState,\n\tProxyArrayState,\n\tMapState,\n\tProxyObjectState,\n\tPatchPath,\n\tget,\n\teach,\n\thas,\n\tgetArchtype,\n\tgetPrototypeOf,\n\tisSet,\n\tisMap,\n\tloadPlugin,\n\tArchType,\n\tdie,\n\tisDraft,\n\tisDraftable,\n\tNOTHING,\n\terrors\n} from \"../internal\"\n\nexport function enablePatches() {\n\tconst errorOffset = 16\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\terrors.push(\n\t\t\t'Sets cannot have \"replace\" patches.',\n\t\t\tfunction(op: string) {\n\t\t\t\treturn \"Unsupported patch operation: \" + op\n\t\t\t},\n\t\t\tfunction(path: string) {\n\t\t\t\treturn \"Cannot apply patch, path doesn't resolve: \" + path\n\t\t\t},\n\t\t\t\"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"\n\t\t)\n\t}\n\n\tconst REPLACE = \"replace\"\n\tconst ADD = \"add\"\n\tconst REMOVE = \"remove\"\n\n\tfunction generatePatches_(\n\t\tstate: ImmerState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t): void {\n\t\tswitch (state.type_) {\n\t\t\tcase ArchType.Object:\n\t\t\tcase ArchType.Map:\n\t\t\t\treturn generatePatchesFromAssigned(\n\t\t\t\t\tstate,\n\t\t\t\t\tbasePath,\n\t\t\t\t\tpatches,\n\t\t\t\t\tinversePatches\n\t\t\t\t)\n\t\t\tcase ArchType.Array:\n\t\t\t\treturn generateArrayPatches(state, basePath, patches, inversePatches)\n\t\t\tcase ArchType.Set:\n\t\t\t\treturn generateSetPatches(\n\t\t\t\t\t(state as any) as SetState,\n\t\t\t\t\tbasePath,\n\t\t\t\t\tpatches,\n\t\t\t\t\tinversePatches\n\t\t\t\t)\n\t\t}\n\t}\n\n\tfunction generateArrayPatches(\n\t\tstate: ProxyArrayState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t) {\n\t\tlet {base_, assigned_} = state\n\t\tlet copy_ = state.copy_!\n\n\t\t// Reduce complexity by ensuring `base` is never longer.\n\t\tif (copy_.length < base_.length) {\n\t\t\t// @ts-ignore\n\t\t\t;[base_, copy_] = [copy_, base_]\n\t\t\t;[patches, inversePatches] = [inversePatches, patches]\n\t\t}\n\n\t\t// Process replaced indices.\n\t\tfor (let i = 0; i < base_.length; i++) {\n\t\t\tif (assigned_[i] && copy_[i] !== base_[i]) {\n\t\t\t\tconst path = basePath.concat([i])\n\t\t\t\tpatches.push({\n\t\t\t\t\top: REPLACE,\n\t\t\t\t\tpath,\n\t\t\t\t\t// Need to maybe clone it, as it can in fact be the original value\n\t\t\t\t\t// due to the base/copy inversion at the start of this function\n\t\t\t\t\tvalue: clonePatchValueIfNeeded(copy_[i])\n\t\t\t\t})\n\t\t\t\tinversePatches.push({\n\t\t\t\t\top: REPLACE,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue: clonePatchValueIfNeeded(base_[i])\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\t// Process added indices.\n\t\tfor (let i = base_.length; i < copy_.length; i++) {\n\t\t\tconst path = basePath.concat([i])\n\t\t\tpatches.push({\n\t\t\t\top: ADD,\n\t\t\t\tpath,\n\t\t\t\t// Need to maybe clone it, as it can in fact be the original value\n\t\t\t\t// due to the base/copy inversion at the start of this function\n\t\t\t\tvalue: clonePatchValueIfNeeded(copy_[i])\n\t\t\t})\n\t\t}\n\t\tfor (let i = copy_.length - 1; base_.length <= i; --i) {\n\t\t\tconst path = basePath.concat([i])\n\t\t\tinversePatches.push({\n\t\t\t\top: REMOVE,\n\t\t\t\tpath\n\t\t\t})\n\t\t}\n\t}\n\n\t// This is used for both Map objects and normal objects.\n\tfunction generatePatchesFromAssigned(\n\t\tstate: MapState | ProxyObjectState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t) {\n\t\tconst {base_, copy_} = state\n\t\teach(state.assigned_!, (key, assignedValue) => {\n\t\t\tconst origValue = get(base_, key)\n\t\t\tconst value = get(copy_!, key)\n\t\t\tconst op = !assignedValue ? REMOVE : has(base_, key) ? REPLACE : ADD\n\t\t\tif (origValue === value && op === REPLACE) return\n\t\t\tconst path = basePath.concat(key as any)\n\t\t\tpatches.push(op === REMOVE ? {op, path} : {op, path, value})\n\t\t\tinversePatches.push(\n\t\t\t\top === ADD\n\t\t\t\t\t? {op: REMOVE, path}\n\t\t\t\t\t: op === REMOVE\n\t\t\t\t\t? {op: ADD, path, value: clonePatchValueIfNeeded(origValue)}\n\t\t\t\t\t: {op: REPLACE, path, value: clonePatchValueIfNeeded(origValue)}\n\t\t\t)\n\t\t})\n\t}\n\n\tfunction generateSetPatches(\n\t\tstate: SetState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t) {\n\t\tlet {base_, copy_} = state\n\n\t\tlet i = 0\n\t\tbase_.forEach((value: any) => {\n\t\t\tif (!copy_!.has(value)) {\n\t\t\t\tconst path = basePath.concat([i])\n\t\t\t\tpatches.push({\n\t\t\t\t\top: REMOVE,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t\tinversePatches.unshift({\n\t\t\t\t\top: ADD,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t}\n\t\t\ti++\n\t\t})\n\t\ti = 0\n\t\tcopy_!.forEach((value: any) => {\n\t\t\tif (!base_.has(value)) {\n\t\t\t\tconst path = basePath.concat([i])\n\t\t\t\tpatches.push({\n\t\t\t\t\top: ADD,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t\tinversePatches.unshift({\n\t\t\t\t\top: REMOVE,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t}\n\t\t\ti++\n\t\t})\n\t}\n\n\tfunction generateReplacementPatches_(\n\t\tbaseValue: any,\n\t\treplacement: any,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t): void {\n\t\tpatches.push({\n\t\t\top: REPLACE,\n\t\t\tpath: [],\n\t\t\tvalue: replacement === NOTHING ? undefined : replacement\n\t\t})\n\t\tinversePatches.push({\n\t\t\top: REPLACE,\n\t\t\tpath: [],\n\t\t\tvalue: baseValue\n\t\t})\n\t}\n\n\tfunction applyPatches_<T>(draft: T, patches: readonly Patch[]): T {\n\t\tpatches.forEach(patch => {\n\t\t\tconst {path, op} = patch\n\n\t\t\tlet base: any = draft\n\t\t\tfor (let i = 0; i < path.length - 1; i++) {\n\t\t\t\tconst parentType = getArchtype(base)\n\t\t\t\tlet p = path[i]\n\t\t\t\tif (typeof p !== \"string\" && typeof p !== \"number\") {\n\t\t\t\t\tp = \"\" + p\n\t\t\t\t}\n\n\t\t\t\t// See #738, avoid prototype pollution\n\t\t\t\tif (\n\t\t\t\t\t(parentType === ArchType.Object || parentType === ArchType.Array) &&\n\t\t\t\t\t(p === \"__proto__\" || p === \"constructor\")\n\t\t\t\t)\n\t\t\t\t\tdie(errorOffset + 3)\n\t\t\t\tif (typeof base === \"function\" && p === \"prototype\")\n\t\t\t\t\tdie(errorOffset + 3)\n\t\t\t\tbase = get(base, p)\n\t\t\t\tif (typeof base !== \"object\") die(errorOffset + 2, path.join(\"/\"))\n\t\t\t}\n\n\t\t\tconst type = getArchtype(base)\n\t\t\tconst value = deepClonePatchValue(patch.value) // used to clone patch to ensure original patch is not modified, see #411\n\t\t\tconst key = path[path.length - 1]\n\t\t\tswitch (op) {\n\t\t\t\tcase REPLACE:\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase ArchType.Map:\n\t\t\t\t\t\t\treturn base.set(key, value)\n\t\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\t\tcase ArchType.Set:\n\t\t\t\t\t\t\tdie(errorOffset)\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// if value is an object, then it's assigned by reference\n\t\t\t\t\t\t\t// in the following add or remove ops, the value field inside the patch will also be modifyed\n\t\t\t\t\t\t\t// so we use value from the cloned patch\n\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\treturn (base[key] = value)\n\t\t\t\t\t}\n\t\t\t\tcase ADD:\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase ArchType.Array:\n\t\t\t\t\t\t\treturn key === \"-\"\n\t\t\t\t\t\t\t\t? base.push(value)\n\t\t\t\t\t\t\t\t: base.splice(key as any, 0, value)\n\t\t\t\t\t\tcase ArchType.Map:\n\t\t\t\t\t\t\treturn base.set(key, value)\n\t\t\t\t\t\tcase ArchType.Set:\n\t\t\t\t\t\t\treturn base.add(value)\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn (base[key] = value)\n\t\t\t\t\t}\n\t\t\t\tcase REMOVE:\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase ArchType.Array:\n\t\t\t\t\t\t\treturn base.splice(key as any, 1)\n\t\t\t\t\t\tcase ArchType.Map:\n\t\t\t\t\t\t\treturn base.delete(key)\n\t\t\t\t\t\tcase ArchType.Set:\n\t\t\t\t\t\t\treturn base.delete(patch.value)\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn delete base[key]\n\t\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tdie(errorOffset + 1, op)\n\t\t\t}\n\t\t})\n\n\t\treturn draft\n\t}\n\n\t// optimize: this is quite a performance hit, can we detect intelligently when it is needed?\n\t// E.g. auto-draft when new objects from outside are assigned and modified?\n\t// (See failing test when deepClone just returns obj)\n\tfunction deepClonePatchValue<T>(obj: T): T\n\tfunction deepClonePatchValue(obj: any) {\n\t\tif (!isDraftable(obj)) return obj\n\t\tif (Array.isArray(obj)) return obj.map(deepClonePatchValue)\n\t\tif (isMap(obj))\n\t\t\treturn new Map(\n\t\t\t\tArray.from(obj.entries()).map(([k, v]) => [k, deepClonePatchValue(v)])\n\t\t\t)\n\t\tif (isSet(obj)) return new Set(Array.from(obj).map(deepClonePatchValue))\n\t\tconst cloned = Object.create(getPrototypeOf(obj))\n\t\tfor (const key in obj) cloned[key] = deepClonePatchValue(obj[key])\n\t\tif (has(obj, immerable)) cloned[immerable] = obj[immerable]\n\t\treturn cloned\n\t}\n\n\tfunction clonePatchValueIfNeeded<T>(obj: T): T {\n\t\tif (isDraft(obj)) {\n\t\t\treturn deepClonePatchValue(obj)\n\t\t} else return obj\n\t}\n\n\tloadPlugin(\"Patches\", {\n\t\tapplyPatches_,\n\t\tgeneratePatches_,\n\t\tgenerateReplacementPatches_\n\t})\n}\n", "// types only!\nimport {\n\tImmerState,\n\tAnyMap,\n\tAnySet,\n\tMapState,\n\tSetState,\n\tDRAFT_STATE,\n\tgetCurrentScope,\n\tlatest,\n\tisDraftable,\n\tcreateProxy,\n\tloadPlugin,\n\tmarkChanged,\n\tdie,\n\tArchType,\n\teach\n} from \"../internal\"\n\nexport function enableMapSet() {\n\tclass DraftMap extends Map {\n\t\t[DRAFT_STATE]: MapState\n\n\t\tconstructor(target: AnyMap, parent?: ImmerState) {\n\t\t\tsuper()\n\t\t\tthis[DRAFT_STATE] = {\n\t\t\t\ttype_: ArchType.Map,\n\t\t\t\tparent_: parent,\n\t\t\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t\t\tmodified_: false,\n\t\t\t\tfinalized_: false,\n\t\t\t\tcopy_: undefined,\n\t\t\t\tassigned_: undefined,\n\t\t\t\tbase_: target,\n\t\t\t\tdraft_: this as any,\n\t\t\t\tisManual_: false,\n\t\t\t\trevoked_: false\n\t\t\t}\n\t\t}\n\n\t\tget size(): number {\n\t\t\treturn latest(this[DRAFT_STATE]).size\n\t\t}\n\n\t\thas(key: any): boolean {\n\t\t\treturn latest(this[DRAFT_STATE]).has(key)\n\t\t}\n\n\t\tset(key: any, value: any) {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (!latest(state).has(key) || latest(state).get(key) !== value) {\n\t\t\t\tprepareMapCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.assigned_!.set(key, true)\n\t\t\t\tstate.copy_!.set(key, value)\n\t\t\t\tstate.assigned_!.set(key, true)\n\t\t\t}\n\t\t\treturn this\n\t\t}\n\n\t\tdelete(key: any): boolean {\n\t\t\tif (!this.has(key)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareMapCopy(state)\n\t\t\tmarkChanged(state)\n\t\t\tif (state.base_.has(key)) {\n\t\t\t\tstate.assigned_!.set(key, false)\n\t\t\t} else {\n\t\t\t\tstate.assigned_!.delete(key)\n\t\t\t}\n\t\t\tstate.copy_!.delete(key)\n\t\t\treturn true\n\t\t}\n\n\t\tclear() {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (latest(state).size) {\n\t\t\t\tprepareMapCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.assigned_ = new Map()\n\t\t\t\teach(state.base_, key => {\n\t\t\t\t\tstate.assigned_!.set(key, false)\n\t\t\t\t})\n\t\t\t\tstate.copy_!.clear()\n\t\t\t}\n\t\t}\n\n\t\tforEach(cb: (value: any, key: any, self: any) => void, thisArg?: any) {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tlatest(state).forEach((_value: any, key: any, _map: any) => {\n\t\t\t\tcb.call(thisArg, this.get(key), key, this)\n\t\t\t})\n\t\t}\n\n\t\tget(key: any): any {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tconst value = latest(state).get(key)\n\t\t\tif (state.finalized_ || !isDraftable(value)) {\n\t\t\t\treturn value\n\t\t\t}\n\t\t\tif (value !== state.base_.get(key)) {\n\t\t\t\treturn value // either already drafted or reassigned\n\t\t\t}\n\t\t\t// despite what it looks, this creates a draft only once, see above condition\n\t\t\tconst draft = createProxy(value, state)\n\t\t\tprepareMapCopy(state)\n\t\t\tstate.copy_!.set(key, draft)\n\t\t\treturn draft\n\t\t}\n\n\t\tkeys(): IterableIterator<any> {\n\t\t\treturn latest(this[DRAFT_STATE]).keys()\n\t\t}\n\n\t\tvalues(): IterableIterator<any> {\n\t\t\tconst iterator = this.keys()\n\t\t\treturn {\n\t\t\t\t[Symbol.iterator]: () => this.values(),\n\t\t\t\tnext: () => {\n\t\t\t\t\tconst r = iterator.next()\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tif (r.done) return r\n\t\t\t\t\tconst value = this.get(r.value)\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdone: false,\n\t\t\t\t\t\tvalue\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as any\n\t\t}\n\n\t\tentries(): IterableIterator<[any, any]> {\n\t\t\tconst iterator = this.keys()\n\t\t\treturn {\n\t\t\t\t[Symbol.iterator]: () => this.entries(),\n\t\t\t\tnext: () => {\n\t\t\t\t\tconst r = iterator.next()\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tif (r.done) return r\n\t\t\t\t\tconst value = this.get(r.value)\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdone: false,\n\t\t\t\t\t\tvalue: [r.value, value]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as any\n\t\t}\n\n\t\t[Symbol.iterator]() {\n\t\t\treturn this.entries()\n\t\t}\n\t}\n\n\tfunction proxyMap_<T extends AnyMap>(target: T, parent?: ImmerState): T {\n\t\t// @ts-ignore\n\t\treturn new DraftMap(target, parent)\n\t}\n\n\tfunction prepareMapCopy(state: MapState) {\n\t\tif (!state.copy_) {\n\t\t\tstate.assigned_ = new Map()\n\t\t\tstate.copy_ = new Map(state.base_)\n\t\t}\n\t}\n\n\tclass DraftSet extends Set {\n\t\t[DRAFT_STATE]: SetState\n\t\tconstructor(target: AnySet, parent?: ImmerState) {\n\t\t\tsuper()\n\t\t\tthis[DRAFT_STATE] = {\n\t\t\t\ttype_: ArchType.Set,\n\t\t\t\tparent_: parent,\n\t\t\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t\t\tmodified_: false,\n\t\t\t\tfinalized_: false,\n\t\t\t\tcopy_: undefined,\n\t\t\t\tbase_: target,\n\t\t\t\tdraft_: this,\n\t\t\t\tdrafts_: new Map(),\n\t\t\t\trevoked_: false,\n\t\t\t\tisManual_: false\n\t\t\t}\n\t\t}\n\n\t\tget size(): number {\n\t\t\treturn latest(this[DRAFT_STATE]).size\n\t\t}\n\n\t\thas(value: any): boolean {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\t// bit of trickery here, to be able to recognize both the value, and the draft of its value\n\t\t\tif (!state.copy_) {\n\t\t\t\treturn state.base_.has(value)\n\t\t\t}\n\t\t\tif (state.copy_.has(value)) return true\n\t\t\tif (state.drafts_.has(value) && state.copy_.has(state.drafts_.get(value)))\n\t\t\t\treturn true\n\t\t\treturn false\n\t\t}\n\n\t\tadd(value: any): any {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (!this.has(value)) {\n\t\t\t\tprepareSetCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.copy_!.add(value)\n\t\t\t}\n\t\t\treturn this\n\t\t}\n\n\t\tdelete(value: any): any {\n\t\t\tif (!this.has(value)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\tmarkChanged(state)\n\t\t\treturn (\n\t\t\t\tstate.copy_!.delete(value) ||\n\t\t\t\t(state.drafts_.has(value)\n\t\t\t\t\t? state.copy_!.delete(state.drafts_.get(value))\n\t\t\t\t\t: /* istanbul ignore next */ false)\n\t\t\t)\n\t\t}\n\n\t\tclear() {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (latest(state).size) {\n\t\t\t\tprepareSetCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.copy_!.clear()\n\t\t\t}\n\t\t}\n\n\t\tvalues(): IterableIterator<any> {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\treturn state.copy_!.values()\n\t\t}\n\n\t\tentries(): IterableIterator<[any, any]> {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\treturn state.copy_!.entries()\n\t\t}\n\n\t\tkeys(): IterableIterator<any> {\n\t\t\treturn this.values()\n\t\t}\n\n\t\t[Symbol.iterator]() {\n\t\t\treturn this.values()\n\t\t}\n\n\t\tforEach(cb: any, thisArg?: any) {\n\t\t\tconst iterator = this.values()\n\t\t\tlet result = iterator.next()\n\t\t\twhile (!result.done) {\n\t\t\t\tcb.call(thisArg, result.value, result.value, this)\n\t\t\t\tresult = iterator.next()\n\t\t\t}\n\t\t}\n\t}\n\tfunction proxySet_<T extends AnySet>(target: T, parent?: ImmerState): T {\n\t\t// @ts-ignore\n\t\treturn new DraftSet(target, parent)\n\t}\n\n\tfunction prepareSetCopy(state: SetState) {\n\t\tif (!state.copy_) {\n\t\t\t// create drafts for all entries to preserve insertion order\n\t\t\tstate.copy_ = new Set()\n\t\t\tstate.base_.forEach(value => {\n\t\t\t\tif (isDraftable(value)) {\n\t\t\t\t\tconst draft = createProxy(value, state)\n\t\t\t\t\tstate.drafts_.set(value, draft)\n\t\t\t\t\tstate.copy_!.add(draft)\n\t\t\t\t} else {\n\t\t\t\t\tstate.copy_!.add(value)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tfunction assertUnrevoked(state: any /*ES5State | MapState | SetState*/) {\n\t\tif (state.revoked_) die(3, JSON.stringify(latest(state)))\n\t}\n\n\tloadPlugin(\"MapSet\", {proxyMap_, proxySet_})\n}\n", "import {\n\tIProduce,\n\tIProduceWithPatches,\n\tImmer,\n\tDraft,\n\tImmutable\n} from \"./internal\"\n\nexport {\n\tDraft,\n\tWritableDraft,\n\tImmutable,\n\tPatch,\n\tPatchListener,\n\tProducer,\n\toriginal,\n\tcurrent,\n\tisDraft,\n\tisDraftable,\n\tNOTHING as nothing,\n\tDRAFTABLE as immerable,\n\tfreeze,\n\tObjectish,\n\tStrictMode\n} from \"./internal\"\n\nconst immer = new Immer()\n\n/**\n * The `produce` function takes a value and a \"recipe function\" (whose\n * return value often depends on the base state). The recipe function is\n * free to mutate its first argument however it wants. All mutations are\n * only ever applied to a __copy__ of the base state.\n *\n * Pass only a function to create a \"curried producer\" which relieves you\n * from passing the recipe function every time.\n *\n * Only plain objects and arrays are made mutable. All other objects are\n * considered uncopyable.\n *\n * Note: This function is __bound__ to its `Immer` instance.\n *\n * @param {any} base - the initial state\n * @param {Function} producer - function that receives a proxy of the base state as first argument and which can be freely modified\n * @param {Function} patchListener - optional function that will be called with all the patches produced here\n * @returns {any} a new state, or the initial state if nothing was modified\n */\nexport const produce: IProduce = /* @__PURE__ */ immer.produce\n\n/**\n * Like `produce`, but `produceWithPatches` always returns a tuple\n * [nextState, patches, inversePatches] (instead of just the next state)\n */\nexport const produceWithPatches: IProduceWithPatches = /* @__PURE__ */ immer.produceWithPatches.bind(\n\timmer\n)\n\n/**\n * Pass true to automatically freeze all copies created by Immer.\n *\n * Always freeze by default, even in production mode\n */\nexport const setAutoFreeze = /* @__PURE__ */ immer.setAutoFreeze.bind(immer)\n\n/**\n * Pass true to enable strict shallow copy.\n *\n * By default, immer does not copy the object descriptors such as getter, setter and non-enumrable properties.\n */\nexport const setUseStrictShallowCopy = /* @__PURE__ */ immer.setUseStrictShallowCopy.bind(\n\timmer\n)\n\n/**\n * Apply an array of Immer patches to the first argument.\n *\n * This function is a producer, which means copy-on-write is in effect.\n */\nexport const applyPatches = /* @__PURE__ */ immer.applyPatches.bind(immer)\n\n/**\n * Create an Immer draft from the given base state, which may be a draft itself.\n * The draft can be modified until you finalize it with the `finishDraft` function.\n */\nexport const createDraft = /* @__PURE__ */ immer.createDraft.bind(immer)\n\n/**\n * Finalize an Immer draft from a `createDraft` call, returning the base state\n * (if no changes were made) or a modified copy. The draft must *not* be\n * mutated afterwards.\n *\n * Pass a function as the 2nd argument to generate Immer patches based on the\n * changes that were made.\n */\nexport const finishDraft = /* @__PURE__ */ immer.finishDraft.bind(immer)\n\n/**\n * This function is actually a no-op, but can be used to cast an immutable type\n * to an draft type and make TypeScript happy\n *\n * @param value\n */\nexport function castDraft<T>(value: T): Draft<T> {\n\treturn value as any\n}\n\n/**\n * This function is actually a no-op, but can be used to cast a mutable type\n * to an immutable type and make TypeScript happy\n * @param value\n */\nexport function castImmutable<T>(value: T): Immutable<T> {\n\treturn value as any\n}\n\nexport {Immer}\n\nexport {enablePatches} from \"./plugins/patches\"\nexport {enableMapSet} from \"./plugins/mapset\"\n", "import { Operation, Path } from '..'\n\n/**\n * `PathRef` objects keep a specific path in a document synced over time as new\n * operations are applied to the editor. You can access their `current` property\n * at any time for the up-to-date path value.\n */\n\nexport interface PathRef {\n  current: Path | null\n  affinity: 'forward' | 'backward' | null\n  unref(): Path | null\n}\n\nexport interface PathRefInterface {\n  /**\n   * Transform the path ref's current value by an operation.\n   */\n  transform: (ref: PathRef, op: Operation) => void\n}\n\n// eslint-disable-next-line no-redeclare\nexport const PathRef: PathRefInterface = {\n  transform(ref: PathRef, op: Operation): void {\n    const { current, affinity } = ref\n\n    if (current == null) {\n      return\n    }\n\n    const path = Path.transform(current, op, { affinity })\n    ref.current = path\n\n    if (path == null) {\n      ref.unref()\n    }\n  },\n}\n", "import { Operation, Point } from '..'\nimport { TextDirection } from '../types/types'\n\n/**\n * `PointRef` objects keep a specific point in a document synced over time as new\n * operations are applied to the editor. You can access their `current` property\n * at any time for the up-to-date point value.\n */\n\nexport interface PointRef {\n  current: Point | null\n  affinity: TextDirection | null\n  unref(): Point | null\n}\n\nexport interface PointRefInterface {\n  /**\n   * Transform the point ref's current value by an operation.\n   */\n  transform: (ref: PointRef, op: Operation) => void\n}\n\n// eslint-disable-next-line no-redeclare\nexport const PointRef: PointRefInterface = {\n  transform(ref: PointRef, op: Operation): void {\n    const { current, affinity } = ref\n\n    if (current == null) {\n      return\n    }\n\n    const point = Point.transform(current, op, { affinity })\n    ref.current = point\n\n    if (point == null) {\n      ref.unref()\n    }\n  },\n}\n", "import { Operation, Range } from '..'\n\n/**\n * `RangeRef` objects keep a specific range in a document synced over time as new\n * operations are applied to the editor. You can access their `current` property\n * at any time for the up-to-date range value.\n */\n\nexport interface RangeRef {\n  current: Range | null\n  affinity: 'forward' | 'backward' | 'outward' | 'inward' | null\n  unref(): Range | null\n}\n\nexport interface RangeRefInterface {\n  /**\n   * Transform the range ref's current value by an operation.\n   */\n  transform: (ref: RangeRef, op: Operation) => void\n}\n\n// eslint-disable-next-line no-redeclare\nexport const RangeRef: RangeRefInterface = {\n  transform(ref: RangeRef, op: Operation): void {\n    const { current, affinity } = ref\n\n    if (current == null) {\n      return\n    }\n\n    const path = Range.transform(current, op, { affinity })\n    ref.current = path\n\n    if (path == null) {\n      ref.unref()\n    }\n  },\n}\n", "import { Editor, Path, PathRef, PointRef, RangeRef } from '..'\n\nexport const DIRTY_PATHS: WeakMap<Editor, Path[]> = new WeakMap()\nexport const DIRTY_PATH_KEYS: WeakMap<Editor, Set<string>> = new WeakMap()\nexport const FLUSHING: WeakMap<Editor, boolean> = new WeakMap()\nexport const NORMALIZING: WeakMap<Editor, boolean> = new WeakMap()\nexport const PATH_REFS: WeakMap<Editor, Set<PathRef>> = new WeakMap()\nexport const POINT_REFS: WeakMap<Editor, Set<PointRef>> = new WeakMap()\nexport const RANGE_REFS: WeakMap<Editor, Set<RangeRef>> = new WeakMap()\n", "import {\n  InsertNodeOperation,\n  MergeNodeOperation,\n  MoveNodeOperation,\n  Operation,\n  RemoveNodeOperation,\n  SplitNodeOperation,\n} from '..'\nimport { TextDirection } from '../types/types'\n\n/**\n * `Path` arrays are a list of indexes that describe a node's exact position in\n * a Slate node tree. Although they are usually relative to the root `Editor`\n * object, they can be relative to any `Node` object.\n */\n\nexport type Path = number[]\n\nexport interface PathAncestorsOptions {\n  reverse?: boolean\n}\n\nexport interface PathLevelsOptions {\n  reverse?: boolean\n}\n\nexport interface PathTransformOptions {\n  affinity?: TextDirection | null\n}\n\nexport interface PathInterface {\n  /**\n   * Get a list of ancestor paths for a given path.\n   *\n   * The paths are sorted from shallowest to deepest ancestor. However, if the\n   * `reverse: true` option is passed, they are reversed.\n   */\n  ancestors: (path: Path, options?: PathAncestorsOptions) => Path[]\n\n  /**\n   * Get the common ancestor path of two paths.\n   */\n  common: (path: Path, another: Path) => Path\n\n  /**\n   * Compare a path to another, returning an integer indicating whether the path\n   * was before, at, or after the other.\n   *\n   * Note: Two paths of unequal length can still receive a `0` result if one is\n   * directly above or below the other. If you want exact matching, use\n   * [[Path.equals]] instead.\n   */\n  compare: (path: Path, another: Path) => -1 | 0 | 1\n\n  /**\n   * Check if a path ends after one of the indexes in another.\n   */\n  endsAfter: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if a path ends at one of the indexes in another.\n   */\n  endsAt: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if a path ends before one of the indexes in another.\n   */\n  endsBefore: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if a path is exactly equal to another.\n   */\n  equals: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if the path of previous sibling node exists\n   */\n  hasPrevious: (path: Path) => boolean\n\n  /**\n   * Check if a path is after another.\n   */\n  isAfter: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if a path is an ancestor of another.\n   */\n  isAncestor: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if a path is before another.\n   */\n  isBefore: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if a path is a child of another.\n   */\n  isChild: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if a path is equal to or an ancestor of another.\n   */\n  isCommon: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if a path is a descendant of another.\n   */\n  isDescendant: (path: Path, another: Path) => boolean\n\n  /**\n   * Check if a path is the parent of another.\n   */\n  isParent: (path: Path, another: Path) => boolean\n\n  /**\n   * Check is a value implements the `Path` interface.\n   */\n  isPath: (value: any) => value is Path\n\n  /**\n   * Check if a path is a sibling of another.\n   */\n  isSibling: (path: Path, another: Path) => boolean\n\n  /**\n   * Get a list of paths at every level down to a path. Note: this is the same\n   * as `Path.ancestors`, but including the path itself.\n   *\n   * The paths are sorted from shallowest to deepest. However, if the `reverse:\n   * true` option is passed, they are reversed.\n   */\n  levels: (path: Path, options?: PathLevelsOptions) => Path[]\n\n  /**\n   * Given a path, get the path to the next sibling node.\n   */\n  next: (path: Path) => Path\n\n  /**\n   * Returns whether this operation can affect paths or not. Used as an\n   * optimization when updating dirty paths during normalization\n   *\n   * NOTE: This *must* be kept in sync with the implementation of 'transform'\n   * below\n   */\n  operationCanTransformPath: (\n    operation: Operation\n  ) => operation is\n    | InsertNodeOperation\n    | RemoveNodeOperation\n    | MergeNodeOperation\n    | SplitNodeOperation\n    | MoveNodeOperation\n\n  /**\n   * Given a path, return a new path referring to the parent node above it.\n   */\n  parent: (path: Path) => Path\n\n  /**\n   * Given a path, get the path to the previous sibling node.\n   */\n  previous: (path: Path) => Path\n\n  /**\n   * Get a path relative to an ancestor.\n   */\n  relative: (path: Path, ancestor: Path) => Path\n\n  /**\n   * Transform a path by an operation.\n   */\n  transform: (\n    path: Path,\n    operation: Operation,\n    options?: PathTransformOptions\n  ) => Path | null\n}\n\n// eslint-disable-next-line no-redeclare\nexport const Path: PathInterface = {\n  ancestors(path: Path, options: PathAncestorsOptions = {}): Path[] {\n    const { reverse = false } = options\n    let paths = Path.levels(path, options)\n\n    if (reverse) {\n      paths = paths.slice(1)\n    } else {\n      paths = paths.slice(0, -1)\n    }\n\n    return paths\n  },\n\n  common(path: Path, another: Path): Path {\n    const common: Path = []\n\n    for (let i = 0; i < path.length && i < another.length; i++) {\n      const av = path[i]\n      const bv = another[i]\n\n      if (av !== bv) {\n        break\n      }\n\n      common.push(av)\n    }\n\n    return common\n  },\n\n  compare(path: Path, another: Path): -1 | 0 | 1 {\n    const min = Math.min(path.length, another.length)\n\n    for (let i = 0; i < min; i++) {\n      if (path[i] < another[i]) return -1\n      if (path[i] > another[i]) return 1\n    }\n\n    return 0\n  },\n\n  endsAfter(path: Path, another: Path): boolean {\n    const i = path.length - 1\n    const as = path.slice(0, i)\n    const bs = another.slice(0, i)\n    const av = path[i]\n    const bv = another[i]\n    return Path.equals(as, bs) && av > bv\n  },\n\n  endsAt(path: Path, another: Path): boolean {\n    const i = path.length\n    const as = path.slice(0, i)\n    const bs = another.slice(0, i)\n    return Path.equals(as, bs)\n  },\n\n  endsBefore(path: Path, another: Path): boolean {\n    const i = path.length - 1\n    const as = path.slice(0, i)\n    const bs = another.slice(0, i)\n    const av = path[i]\n    const bv = another[i]\n    return Path.equals(as, bs) && av < bv\n  },\n\n  equals(path: Path, another: Path): boolean {\n    return (\n      path.length === another.length && path.every((n, i) => n === another[i])\n    )\n  },\n\n  hasPrevious(path: Path): boolean {\n    return path[path.length - 1] > 0\n  },\n\n  isAfter(path: Path, another: Path): boolean {\n    return Path.compare(path, another) === 1\n  },\n\n  isAncestor(path: Path, another: Path): boolean {\n    return path.length < another.length && Path.compare(path, another) === 0\n  },\n\n  isBefore(path: Path, another: Path): boolean {\n    return Path.compare(path, another) === -1\n  },\n\n  isChild(path: Path, another: Path): boolean {\n    return (\n      path.length === another.length + 1 && Path.compare(path, another) === 0\n    )\n  },\n\n  isCommon(path: Path, another: Path): boolean {\n    return path.length <= another.length && Path.compare(path, another) === 0\n  },\n\n  isDescendant(path: Path, another: Path): boolean {\n    return path.length > another.length && Path.compare(path, another) === 0\n  },\n\n  isParent(path: Path, another: Path): boolean {\n    return (\n      path.length + 1 === another.length && Path.compare(path, another) === 0\n    )\n  },\n\n  isPath(value: any): value is Path {\n    return (\n      Array.isArray(value) &&\n      (value.length === 0 || typeof value[0] === 'number')\n    )\n  },\n\n  isSibling(path: Path, another: Path): boolean {\n    if (path.length !== another.length) {\n      return false\n    }\n\n    const as = path.slice(0, -1)\n    const bs = another.slice(0, -1)\n    const al = path[path.length - 1]\n    const bl = another[another.length - 1]\n    return al !== bl && Path.equals(as, bs)\n  },\n\n  levels(path: Path, options: PathLevelsOptions = {}): Path[] {\n    const { reverse = false } = options\n    const list: Path[] = []\n\n    for (let i = 0; i <= path.length; i++) {\n      list.push(path.slice(0, i))\n    }\n\n    if (reverse) {\n      list.reverse()\n    }\n\n    return list\n  },\n\n  next(path: Path): Path {\n    if (path.length === 0) {\n      throw new Error(\n        `Cannot get the next path of a root path [${path}], because it has no next index.`\n      )\n    }\n\n    const last = path[path.length - 1]\n    return path.slice(0, -1).concat(last + 1)\n  },\n\n  operationCanTransformPath(\n    operation: Operation\n  ): operation is\n    | InsertNodeOperation\n    | RemoveNodeOperation\n    | MergeNodeOperation\n    | SplitNodeOperation\n    | MoveNodeOperation {\n    switch (operation.type) {\n      case 'insert_node':\n      case 'remove_node':\n      case 'merge_node':\n      case 'split_node':\n      case 'move_node':\n        return true\n      default:\n        return false\n    }\n  },\n\n  parent(path: Path): Path {\n    if (path.length === 0) {\n      throw new Error(`Cannot get the parent path of the root path [${path}].`)\n    }\n\n    return path.slice(0, -1)\n  },\n\n  previous(path: Path): Path {\n    if (path.length === 0) {\n      throw new Error(\n        `Cannot get the previous path of a root path [${path}], because it has no previous index.`\n      )\n    }\n\n    const last = path[path.length - 1]\n\n    if (last <= 0) {\n      throw new Error(\n        `Cannot get the previous path of a first child path [${path}] because it would result in a negative index.`\n      )\n    }\n\n    return path.slice(0, -1).concat(last - 1)\n  },\n\n  relative(path: Path, ancestor: Path): Path {\n    if (!Path.isAncestor(ancestor, path) && !Path.equals(path, ancestor)) {\n      throw new Error(\n        `Cannot get the relative path of [${path}] inside ancestor [${ancestor}], because it is not above or equal to the path.`\n      )\n    }\n\n    return path.slice(ancestor.length)\n  },\n\n  transform(\n    path: Path | null,\n    operation: Operation,\n    options: PathTransformOptions = {}\n  ): Path | null {\n    if (!path) return null\n\n    // PERF: use destructing instead of immer\n    const p = [...path]\n    const { affinity = 'forward' } = options\n\n    // PERF: Exit early if the operation is guaranteed not to have an effect.\n    if (path.length === 0) {\n      return p\n    }\n\n    switch (operation.type) {\n      case 'insert_node': {\n        const { path: op } = operation\n\n        if (\n          Path.equals(op, p) ||\n          Path.endsBefore(op, p) ||\n          Path.isAncestor(op, p)\n        ) {\n          p[op.length - 1] += 1\n        }\n\n        break\n      }\n\n      case 'remove_node': {\n        const { path: op } = operation\n\n        if (Path.equals(op, p) || Path.isAncestor(op, p)) {\n          return null\n        } else if (Path.endsBefore(op, p)) {\n          p[op.length - 1] -= 1\n        }\n\n        break\n      }\n\n      case 'merge_node': {\n        const { path: op, position } = operation\n\n        if (Path.equals(op, p) || Path.endsBefore(op, p)) {\n          p[op.length - 1] -= 1\n        } else if (Path.isAncestor(op, p)) {\n          p[op.length - 1] -= 1\n          p[op.length] += position\n        }\n\n        break\n      }\n\n      case 'split_node': {\n        const { path: op, position } = operation\n\n        if (Path.equals(op, p)) {\n          if (affinity === 'forward') {\n            p[p.length - 1] += 1\n          } else if (affinity === 'backward') {\n            // Nothing, because it still refers to the right path.\n          } else {\n            return null\n          }\n        } else if (Path.endsBefore(op, p)) {\n          p[op.length - 1] += 1\n        } else if (Path.isAncestor(op, p) && path[op.length] >= position) {\n          p[op.length - 1] += 1\n          p[op.length] -= position\n        }\n\n        break\n      }\n\n      case 'move_node': {\n        const { path: op, newPath: onp } = operation\n\n        // If the old and new path are the same, it's a no-op.\n        if (Path.equals(op, onp)) {\n          return p\n        }\n\n        if (Path.isAncestor(op, p) || Path.equals(op, p)) {\n          const copy = onp.slice()\n\n          if (Path.endsBefore(op, onp) && op.length < onp.length) {\n            copy[op.length - 1] -= 1\n          }\n\n          return copy.concat(p.slice(op.length))\n        } else if (\n          Path.isSibling(op, onp) &&\n          (Path.isAncestor(onp, p) || Path.equals(onp, p))\n        ) {\n          if (Path.endsBefore(op, p)) {\n            p[op.length - 1] -= 1\n          } else {\n            p[op.length - 1] += 1\n          }\n        } else if (\n          Path.endsBefore(onp, p) ||\n          Path.equals(onp, p) ||\n          Path.isAncestor(onp, p)\n        ) {\n          if (Path.endsBefore(op, p)) {\n            p[op.length - 1] -= 1\n          }\n\n          p[onp.length - 1] += 1\n        } else if (Path.endsBefore(op, p)) {\n          if (Path.equals(onp, p)) {\n            p[onp.length - 1] += 1\n          }\n\n          p[op.length - 1] -= 1\n        }\n\n        break\n      }\n    }\n\n    return p\n  },\n}\n", "export default function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}", "import _typeof from \"./typeof.js\";\nexport default function _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}", "import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}", "import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}", "import { createDraft, finishDraft, isDraft } from 'immer'\nimport {\n  Ancestor,\n  Descendant,\n  Editor,\n  Element,\n  Node,\n  NodeEntry,\n  Operation,\n  Path,\n  Point,\n  Range,\n  Scrubber,\n  Selection,\n  Text,\n} from '../../index'\n\nexport interface GeneralTransforms {\n  /**\n   * Transform the editor by an operation.\n   */\n  transform: (editor: Editor, op: Operation) => void\n}\n\nconst applyToDraft = (editor: Editor, selection: Selection, op: Operation) => {\n  switch (op.type) {\n    case 'insert_node': {\n      const { path, node } = op\n      const parent = Node.parent(editor, path)\n      const index = path[path.length - 1]\n\n      if (index > parent.children.length) {\n        throw new Error(\n          `Cannot apply an \"insert_node\" operation at path [${path}] because the destination is past the end of the node.`\n        )\n      }\n\n      parent.children.splice(index, 0, node)\n\n      if (selection) {\n        for (const [point, key] of Range.points(selection)) {\n          selection[key] = Point.transform(point, op)!\n        }\n      }\n\n      break\n    }\n\n    case 'insert_text': {\n      const { path, offset, text } = op\n      if (text.length === 0) break\n      const node = Node.leaf(editor, path)\n      const before = node.text.slice(0, offset)\n      const after = node.text.slice(offset)\n      node.text = before + text + after\n\n      if (selection) {\n        for (const [point, key] of Range.points(selection)) {\n          selection[key] = Point.transform(point, op)!\n        }\n      }\n\n      break\n    }\n\n    case 'merge_node': {\n      const { path } = op\n      const node = Node.get(editor, path)\n      const prevPath = Path.previous(path)\n      const prev = Node.get(editor, prevPath)\n      const parent = Node.parent(editor, path)\n      const index = path[path.length - 1]\n\n      if (Text.isText(node) && Text.isText(prev)) {\n        prev.text += node.text\n      } else if (!Text.isText(node) && !Text.isText(prev)) {\n        prev.children.push(...node.children)\n      } else {\n        throw new Error(\n          `Cannot apply a \"merge_node\" operation at path [${path}] to nodes of different interfaces: ${Scrubber.stringify(\n            node\n          )} ${Scrubber.stringify(prev)}`\n        )\n      }\n\n      parent.children.splice(index, 1)\n\n      if (selection) {\n        for (const [point, key] of Range.points(selection)) {\n          selection[key] = Point.transform(point, op)!\n        }\n      }\n\n      break\n    }\n\n    case 'move_node': {\n      const { path, newPath } = op\n\n      if (Path.isAncestor(path, newPath)) {\n        throw new Error(\n          `Cannot move a path [${path}] to new path [${newPath}] because the destination is inside itself.`\n        )\n      }\n\n      const node = Node.get(editor, path)\n      const parent = Node.parent(editor, path)\n      const index = path[path.length - 1]\n\n      // This is tricky, but since the `path` and `newPath` both refer to\n      // the same snapshot in time, there's a mismatch. After either\n      // removing the original position, the second step's path can be out\n      // of date. So instead of using the `op.newPath` directly, we\n      // transform `op.path` to ascertain what the `newPath` would be after\n      // the operation was applied.\n      parent.children.splice(index, 1)\n      const truePath = Path.transform(path, op)!\n      const newParent = Node.get(editor, Path.parent(truePath)) as Ancestor\n      const newIndex = truePath[truePath.length - 1]\n\n      newParent.children.splice(newIndex, 0, node)\n\n      if (selection) {\n        for (const [point, key] of Range.points(selection)) {\n          selection[key] = Point.transform(point, op)!\n        }\n      }\n\n      break\n    }\n\n    case 'remove_node': {\n      const { path } = op\n      const index = path[path.length - 1]\n      const parent = Node.parent(editor, path)\n      parent.children.splice(index, 1)\n\n      // Transform all the points in the value, but if the point was in the\n      // node that was removed we need to update the range or remove it.\n      if (selection) {\n        for (const [point, key] of Range.points(selection)) {\n          const result = Point.transform(point, op)\n\n          if (selection != null && result != null) {\n            selection[key] = result\n          } else {\n            let prev: NodeEntry<Text> | undefined\n            let next: NodeEntry<Text> | undefined\n\n            for (const [n, p] of Node.texts(editor)) {\n              if (Path.compare(p, path) === -1) {\n                prev = [n, p]\n              } else {\n                next = [n, p]\n                break\n              }\n            }\n\n            let preferNext = false\n            if (prev && next) {\n              if (Path.equals(next[1], path)) {\n                preferNext = !Path.hasPrevious(next[1])\n              } else {\n                preferNext =\n                  Path.common(prev[1], path).length <\n                  Path.common(next[1], path).length\n              }\n            }\n\n            if (prev && !preferNext) {\n              point.path = prev[1]\n              point.offset = prev[0].text.length\n            } else if (next) {\n              point.path = next[1]\n              point.offset = 0\n            } else {\n              selection = null\n            }\n          }\n        }\n      }\n\n      break\n    }\n\n    case 'remove_text': {\n      const { path, offset, text } = op\n      if (text.length === 0) break\n      const node = Node.leaf(editor, path)\n      const before = node.text.slice(0, offset)\n      const after = node.text.slice(offset + text.length)\n      node.text = before + after\n\n      if (selection) {\n        for (const [point, key] of Range.points(selection)) {\n          selection[key] = Point.transform(point, op)!\n        }\n      }\n\n      break\n    }\n\n    case 'set_node': {\n      const { path, properties, newProperties } = op\n\n      if (path.length === 0) {\n        throw new Error(`Cannot set properties on the root node!`)\n      }\n\n      const node = Node.get(editor, path)\n\n      for (const key in newProperties) {\n        if (key === 'children' || key === 'text') {\n          throw new Error(`Cannot set the \"${key}\" property of nodes!`)\n        }\n\n        const value = newProperties[<keyof Node>key]\n\n        if (value == null) {\n          delete node[<keyof Node>key]\n        } else {\n          node[<keyof Node>key] = value\n        }\n      }\n\n      // properties that were previously defined, but are now missing, must be deleted\n      for (const key in properties) {\n        if (!newProperties.hasOwnProperty(key)) {\n          delete node[<keyof Node>key]\n        }\n      }\n\n      break\n    }\n\n    case 'set_selection': {\n      const { newProperties } = op\n\n      if (newProperties == null) {\n        selection = newProperties\n      } else {\n        if (selection == null) {\n          if (!Range.isRange(newProperties)) {\n            throw new Error(\n              `Cannot apply an incomplete \"set_selection\" operation properties ${Scrubber.stringify(\n                newProperties\n              )} when there is no current selection.`\n            )\n          }\n\n          selection = { ...newProperties }\n        }\n\n        for (const key in newProperties) {\n          const value = newProperties[<keyof Range>key]\n\n          if (value == null) {\n            if (key === 'anchor' || key === 'focus') {\n              throw new Error(`Cannot remove the \"${key}\" selection property`)\n            }\n\n            delete selection[<keyof Range>key]\n          } else {\n            selection[<keyof Range>key] = value\n          }\n        }\n      }\n\n      break\n    }\n\n    case 'split_node': {\n      const { path, position, properties } = op\n\n      if (path.length === 0) {\n        throw new Error(\n          `Cannot apply a \"split_node\" operation at path [${path}] because the root node cannot be split.`\n        )\n      }\n\n      const node = Node.get(editor, path)\n      const parent = Node.parent(editor, path)\n      const index = path[path.length - 1]\n      let newNode: Descendant\n\n      if (Text.isText(node)) {\n        const before = node.text.slice(0, position)\n        const after = node.text.slice(position)\n        node.text = before\n        newNode = {\n          ...(properties as Partial<Text>),\n          text: after,\n        }\n      } else {\n        const before = node.children.slice(0, position)\n        const after = node.children.slice(position)\n        node.children = before\n\n        newNode = {\n          ...(properties as Partial<Element>),\n          children: after,\n        }\n      }\n\n      parent.children.splice(index + 1, 0, newNode)\n\n      if (selection) {\n        for (const [point, key] of Range.points(selection)) {\n          selection[key] = Point.transform(point, op)!\n        }\n      }\n\n      break\n    }\n  }\n  return selection\n}\n\n// eslint-disable-next-line no-redeclare\nexport const GeneralTransforms: GeneralTransforms = {\n  transform(editor: Editor, op: Operation): void {\n    editor.children = createDraft(editor.children)\n    let selection = editor.selection && createDraft(editor.selection)\n\n    try {\n      selection = applyToDraft(editor, selection, op)\n    } finally {\n      editor.children = finishDraft(editor.children)\n\n      if (selection) {\n        editor.selection = isDraft(selection)\n          ? (finishDraft(selection) as Range)\n          : selection\n      } else {\n        editor.selection = null\n      }\n    }\n  },\n}\n", "import { Editor, Element, Location, Node, Path } from '../../index'\nimport { NodeMatch, PropsCompare, PropsMerge } from '../editor'\nimport { MaximizeMode, RangeMode } from '../../types/types'\n\nexport interface NodeInsertNodesOptions<T extends Node> {\n  at?: Location\n  match?: NodeMatch<T>\n  mode?: RangeMode\n  hanging?: boolean\n  select?: boolean\n  voids?: boolean\n  batchDirty?: boolean\n}\n\nexport interface NodeTransforms {\n  /**\n   * Insert nodes in the editor\n   * at the specified location or (if not defined) the current selection or (if not defined) the end of the document.\n   */\n  insertNodes: <T extends Node>(\n    editor: Editor,\n    nodes: Node | Node[],\n    options?: NodeInsertNodesOptions<T>\n  ) => void\n\n  /**\n   * Lift nodes at a specific location upwards in the document tree, splitting\n   * their parent in two if necessary.\n   */\n  liftNodes: <T extends Node>(\n    editor: Editor,\n    options?: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: MaximizeMode\n      voids?: boolean\n    }\n  ) => void\n\n  /**\n   * Merge a node at a location with the previous node of the same depth,\n   * removing any empty containing nodes after the merge if necessary.\n   */\n  mergeNodes: <T extends Node>(\n    editor: Editor,\n    options?: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: RangeMode\n      hanging?: boolean\n      voids?: boolean\n    }\n  ) => void\n\n  /**\n   * Move the nodes at a location to a new location.\n   */\n  moveNodes: <T extends Node>(\n    editor: Editor,\n    options: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: MaximizeMode\n      to: Path\n      voids?: boolean\n    }\n  ) => void\n\n  /**\n   * Remove the nodes at a specific location in the document.\n   */\n  removeNodes: <T extends Node>(\n    editor: Editor,\n    options?: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: RangeMode\n      hanging?: boolean\n      voids?: boolean\n    }\n  ) => void\n\n  /**\n   * Set new properties on the nodes at a location.\n   */\n  setNodes: <T extends Node>(\n    editor: Editor,\n    props: Partial<T>,\n    options?: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: MaximizeMode\n      hanging?: boolean\n      split?: boolean\n      voids?: boolean\n      compare?: PropsCompare\n      merge?: PropsMerge\n    }\n  ) => void\n\n  /**\n   * Split the nodes at a specific location.\n   */\n  splitNodes: <T extends Node>(\n    editor: Editor,\n    options?: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: RangeMode\n      always?: boolean\n      height?: number\n      voids?: boolean\n    }\n  ) => void\n\n  /**\n   * Unset properties on the nodes at a location.\n   */\n  unsetNodes: <T extends Node>(\n    editor: Editor,\n    props: string | string[],\n    options?: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: MaximizeMode\n      hanging?: boolean\n      split?: boolean\n      voids?: boolean\n    }\n  ) => void\n\n  /**\n   * Unwrap the nodes at a location from a parent node, splitting the parent if\n   * necessary to ensure that only the content in the range is unwrapped.\n   */\n  unwrapNodes: <T extends Node>(\n    editor: Editor,\n    options?: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: MaximizeMode\n      split?: boolean\n      voids?: boolean\n    }\n  ) => void\n\n  /**\n   * Wrap the nodes at a location in a new container node, splitting the edges\n   * of the range first to ensure that only the content in the range is wrapped.\n   */\n  wrapNodes: <T extends Node>(\n    editor: Editor,\n    element: Element,\n    options?: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: MaximizeMode\n      split?: boolean\n      voids?: boolean\n    }\n  ) => void\n}\n\n// eslint-disable-next-line no-redeclare\nexport const NodeTransforms: NodeTransforms = {\n  insertNodes(editor, nodes, options) {\n    editor.insertNodes(nodes, options)\n  },\n  liftNodes(editor, options) {\n    editor.liftNodes(options)\n  },\n  mergeNodes(editor, options) {\n    editor.mergeNodes(options)\n  },\n  moveNodes(editor, options) {\n    editor.moveNodes(options)\n  },\n  removeNodes(editor, options) {\n    editor.removeNodes(options)\n  },\n  setNodes(editor, props, options) {\n    editor.setNodes(props, options)\n  },\n  splitNodes(editor, options) {\n    editor.splitNodes(options)\n  },\n  unsetNodes(editor, props, options) {\n    editor.unsetNodes(props, options)\n  },\n  unwrapNodes(editor, options) {\n    editor.unwrapNodes(options)\n  },\n  wrapNodes(editor, element, options) {\n    editor.wrapNodes(element, options)\n  },\n}\n", "import { Editor, Location, Point, Range } from '../../index'\nimport { MoveUnit, SelectionEdge } from '../../types/types'\n\nexport interface SelectionCollapseOptions {\n  edge?: SelectionEdge\n}\n\nexport interface SelectionMoveOptions {\n  distance?: number\n  unit?: MoveUnit\n  reverse?: boolean\n  edge?: SelectionEdge\n}\n\nexport interface SelectionSetPointOptions {\n  edge?: SelectionEdge\n}\n\nexport interface SelectionTransforms {\n  /**\n   * Collapse the selection.\n   */\n  collapse: (editor: Editor, options?: SelectionCollapseOptions) => void\n\n  /**\n   * Unset the selection.\n   */\n  deselect: (editor: Editor) => void\n\n  /**\n   * Move the selection's point forward or backward.\n   */\n  move: (editor: Editor, options?: SelectionMoveOptions) => void\n\n  /**\n   * Set the selection to a new value.\n   */\n  select: (editor: Editor, target: Location) => void\n\n  /**\n   * Set new properties on one of the selection's points.\n   */\n  setPoint: (\n    editor: Editor,\n    props: Partial<Point>,\n    options?: SelectionSetPointOptions\n  ) => void\n\n  /**\n   * Set new properties on the selection.\n   */\n  setSelection: (editor: Editor, props: Partial<Range>) => void\n}\n\n// eslint-disable-next-line no-redeclare\nexport const SelectionTransforms: SelectionTransforms = {\n  collapse(editor, options) {\n    editor.collapse(options)\n  },\n  deselect(editor) {\n    editor.deselect()\n  },\n  move(editor, options) {\n    editor.move(options)\n  },\n  select(editor, target) {\n    editor.select(target)\n  },\n  setPoint(editor, props, options) {\n    editor.setPoint(props, options)\n  },\n  setSelection(editor, props) {\n    editor.setSelection(props)\n  },\n}\n", "import { isPlainObject } from 'is-plain-object'\n\n/*\n  Custom deep equal comparison for Slate nodes.\n\n  We don't need general purpose deep equality;\n  Slate only supports plain values, Arrays, and nested objects.\n  Complex values nested inside Arrays are not supported.\n\n  Slate objects are designed to be serialised, so\n  missing keys are deliberately normalised to undefined.\n */\nexport const isDeepEqual = (\n  node: Record<string, any>,\n  another: Record<string, any>\n): boolean => {\n  for (const key in node) {\n    const a = node[key]\n    const b = another[key]\n    if (isPlainObject(a) && isPlainObject(b)) {\n      if (!isDeepEqual(a, b)) return false\n    } else if (Array.isArray(a) && Array.isArray(b)) {\n      if (a.length !== b.length) return false\n      for (let i = 0; i < a.length; i++) {\n        if (a[i] !== b[i]) return false\n      }\n    } else if (a !== b) {\n      return false\n    }\n  }\n\n  /*\n    Deep object equality is only necessary in one direction; in the reverse direction\n    we are only looking for keys that are missing.\n    As above, undefined keys are normalised to missing.\n  */\n\n  for (const key in another) {\n    if (node[key] === undefined && another[key] !== undefined) {\n      return false\n    }\n  }\n\n  return true\n}\n", "export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}", "import objectWithoutPropertiesLoose from \"./objectWithoutPropertiesLoose.js\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}", "import { produce } from 'immer'\nimport { isPlainObject } from 'is-plain-object'\nimport { ExtendedType, Operation, Path, Point, PointEntry } from '..'\nimport { RangeDirection } from '../types/types'\n\n/**\n * `Range` objects are a set of points that refer to a specific span of a Slate\n * document. They can define a span inside a single node or a can span across\n * multiple nodes.\n */\n\nexport interface BaseRange {\n  anchor: Point\n  focus: Point\n}\n\nexport type Range = ExtendedType<'Range', BaseRange>\n\nexport interface RangeEdgesOptions {\n  reverse?: boolean\n}\n\nexport interface RangeTransformOptions {\n  affinity?: RangeDirection | null\n}\n\nexport interface RangeInterface {\n  /**\n   * Get the start and end points of a range, in the order in which they appear\n   * in the document.\n   */\n  edges: (range: Range, options?: RangeEdgesOptions) => [Point, Point]\n\n  /**\n   * Get the end point of a range.\n   */\n  end: (range: Range) => Point\n\n  /**\n   * Check if a range is exactly equal to another.\n   */\n  equals: (range: Range, another: Range) => boolean\n\n  /**\n   * Check if a range includes a path, a point or part of another range.\n   */\n  includes: (range: Range, target: Path | Point | Range) => boolean\n\n  /**\n   * Check if a range includes another range.\n   */\n  surrounds: (range: Range, target: Range) => boolean\n\n  /**\n   * Get the intersection of a range with another.\n   */\n  intersection: (range: Range, another: Range) => Range | null\n\n  /**\n   * Check if a range is backward, meaning that its anchor point appears in the\n   * document _after_ its focus point.\n   */\n  isBackward: (range: Range) => boolean\n\n  /**\n   * Check if a range is collapsed, meaning that both its anchor and focus\n   * points refer to the exact same position in the document.\n   */\n  isCollapsed: (range: Range) => boolean\n\n  /**\n   * Check if a range is expanded.\n   *\n   * This is the opposite of [[Range.isCollapsed]] and is provided for legibility.\n   */\n  isExpanded: (range: Range) => boolean\n\n  /**\n   * Check if a range is forward.\n   *\n   * This is the opposite of [[Range.isBackward]] and is provided for legibility.\n   */\n  isForward: (range: Range) => boolean\n\n  /**\n   * Check if a value implements the [[Range]] interface.\n   */\n  isRange: (value: any) => value is Range\n\n  /**\n   * Iterate through all of the point entries in a range.\n   */\n  points: (range: Range) => Generator<PointEntry, void, undefined>\n\n  /**\n   * Get the start point of a range.\n   */\n  start: (range: Range) => Point\n\n  /**\n   * Transform a range by an operation.\n   */\n  transform: (\n    range: Range,\n    op: Operation,\n    options?: RangeTransformOptions\n  ) => Range | null\n}\n\n// eslint-disable-next-line no-redeclare\nexport const Range: RangeInterface = {\n  edges(range: Range, options: RangeEdgesOptions = {}): [Point, Point] {\n    const { reverse = false } = options\n    const { anchor, focus } = range\n    return Range.isBackward(range) === reverse\n      ? [anchor, focus]\n      : [focus, anchor]\n  },\n\n  end(range: Range): Point {\n    const [, end] = Range.edges(range)\n    return end\n  },\n\n  equals(range: Range, another: Range): boolean {\n    return (\n      Point.equals(range.anchor, another.anchor) &&\n      Point.equals(range.focus, another.focus)\n    )\n  },\n\n  surrounds(range: Range, target: Range): boolean {\n    const intersectionRange = Range.intersection(range, target)\n    if (!intersectionRange) {\n      return false\n    }\n    return Range.equals(intersectionRange, target)\n  },\n\n  includes(range: Range, target: Path | Point | Range): boolean {\n    if (Range.isRange(target)) {\n      if (\n        Range.includes(range, target.anchor) ||\n        Range.includes(range, target.focus)\n      ) {\n        return true\n      }\n\n      const [rs, re] = Range.edges(range)\n      const [ts, te] = Range.edges(target)\n      return Point.isBefore(rs, ts) && Point.isAfter(re, te)\n    }\n\n    const [start, end] = Range.edges(range)\n    let isAfterStart = false\n    let isBeforeEnd = false\n\n    if (Point.isPoint(target)) {\n      isAfterStart = Point.compare(target, start) >= 0\n      isBeforeEnd = Point.compare(target, end) <= 0\n    } else {\n      isAfterStart = Path.compare(target, start.path) >= 0\n      isBeforeEnd = Path.compare(target, end.path) <= 0\n    }\n\n    return isAfterStart && isBeforeEnd\n  },\n\n  intersection(range: Range, another: Range): Range | null {\n    const { anchor, focus, ...rest } = range\n    const [s1, e1] = Range.edges(range)\n    const [s2, e2] = Range.edges(another)\n    const start = Point.isBefore(s1, s2) ? s2 : s1\n    const end = Point.isBefore(e1, e2) ? e1 : e2\n\n    if (Point.isBefore(end, start)) {\n      return null\n    } else {\n      return { anchor: start, focus: end, ...rest }\n    }\n  },\n\n  isBackward(range: Range): boolean {\n    const { anchor, focus } = range\n    return Point.isAfter(anchor, focus)\n  },\n\n  isCollapsed(range: Range): boolean {\n    const { anchor, focus } = range\n    return Point.equals(anchor, focus)\n  },\n\n  isExpanded(range: Range): boolean {\n    return !Range.isCollapsed(range)\n  },\n\n  isForward(range: Range): boolean {\n    return !Range.isBackward(range)\n  },\n\n  isRange(value: any): value is Range {\n    return (\n      isPlainObject(value) &&\n      Point.isPoint(value.anchor) &&\n      Point.isPoint(value.focus)\n    )\n  },\n\n  *points(range: Range): Generator<PointEntry, void, undefined> {\n    yield [range.anchor, 'anchor']\n    yield [range.focus, 'focus']\n  },\n\n  start(range: Range): Point {\n    const [start] = Range.edges(range)\n    return start\n  },\n\n  transform(\n    range: Range | null,\n    op: Operation,\n    options: RangeTransformOptions = {}\n  ): Range | null {\n    return produce(range, r => {\n      if (r === null) {\n        return null\n      }\n      const { affinity = 'inward' } = options\n      let affinityAnchor: 'forward' | 'backward' | null\n      let affinityFocus: 'forward' | 'backward' | null\n\n      if (affinity === 'inward') {\n        // If the range is collapsed, make sure to use the same affinity to\n        // avoid the two points passing each other and expanding in the opposite\n        // direction\n        const isCollapsed = Range.isCollapsed(r)\n        if (Range.isForward(r)) {\n          affinityAnchor = 'forward'\n          affinityFocus = isCollapsed ? affinityAnchor : 'backward'\n        } else {\n          affinityAnchor = 'backward'\n          affinityFocus = isCollapsed ? affinityAnchor : 'forward'\n        }\n      } else if (affinity === 'outward') {\n        if (Range.isForward(r)) {\n          affinityAnchor = 'backward'\n          affinityFocus = 'forward'\n        } else {\n          affinityAnchor = 'forward'\n          affinityFocus = 'backward'\n        }\n      } else {\n        affinityAnchor = affinity\n        affinityFocus = affinity\n      }\n      const anchor = Point.transform(r.anchor, op, { affinity: affinityAnchor })\n      const focus = Point.transform(r.focus, op, { affinity: affinityFocus })\n\n      if (!anchor || !focus) {\n        return null\n      }\n\n      r.anchor = anchor\n      r.focus = focus\n    })\n  },\n}\n", "import { isPlainObject } from 'is-plain-object'\nimport { Ancestor, Descendant, Editor, ExtendedType, Node, Path } from '..'\n\n/**\n * `Element` objects are a type of node in a Slate document that contain other\n * element nodes or text nodes. They can be either \"blocks\" or \"inlines\"\n * depending on the Slate editor's configuration.\n */\n\nexport interface BaseElement {\n  children: Descendant[]\n}\n\nexport type Element = ExtendedType<'Element', BaseElement>\n\nexport interface ElementInterface {\n  /**\n   * Check if a value implements the 'Ancestor' interface.\n   */\n  isAncestor: (value: any) => value is Ancestor\n\n  /**\n   * Check if a value implements the `Element` interface.\n   */\n  isElement: (value: any) => value is Element\n\n  /**\n   * Check if a value is an array of `Element` objects.\n   */\n  isElementList: (value: any) => value is Element[]\n\n  /**\n   * Check if a set of props is a partial of Element.\n   */\n  isElementProps: (props: any) => props is Partial<Element>\n\n  /**\n   * Check if a value implements the `Element` interface and has elementKey with selected value.\n   * Default it check to `type` key value\n   */\n  isElementType: <T extends Element>(\n    value: any,\n    elementVal: string,\n    elementKey?: string\n  ) => value is T\n\n  /**\n   * Check if an element matches set of properties.\n   *\n   * Note: this checks custom properties, and it does not ensure that any\n   * children are equivalent.\n   */\n  matches: (element: Element, props: Partial<Element>) => boolean\n}\n\n/**\n * Shared the function with isElementType utility\n */\nconst isElement = (value: any): value is Element => {\n  return (\n    isPlainObject(value) &&\n    Node.isNodeList(value.children) &&\n    !Editor.isEditor(value)\n  )\n}\n\n// eslint-disable-next-line no-redeclare\nexport const Element: ElementInterface = {\n  isAncestor(value: any): value is Ancestor {\n    return isPlainObject(value) && Node.isNodeList(value.children)\n  },\n\n  isElement,\n\n  isElementList(value: any): value is Element[] {\n    return Array.isArray(value) && value.every(val => Element.isElement(val))\n  },\n\n  isElementProps(props: any): props is Partial<Element> {\n    return (props as Partial<Element>).children !== undefined\n  },\n\n  isElementType: <T extends Element>(\n    value: any,\n    elementVal: string,\n    elementKey: string = 'type'\n  ): value is T => {\n    return (\n      isElement(value) && value[<keyof Descendant>elementKey] === elementVal\n    )\n  },\n\n  matches(element: Element, props: Partial<Element>): boolean {\n    for (const key in props) {\n      if (key === 'children') {\n        continue\n      }\n\n      if (element[<keyof Descendant>key] !== props[<keyof Descendant>key]) {\n        return false\n      }\n    }\n\n    return true\n  },\n}\n\n/**\n * `ElementEntry` objects refer to an `Element` and the `Path` where it can be\n * found inside a root node.\n */\nexport type ElementEntry = [Element, Path]\n", "import { produce } from 'immer'\nimport { Editor, Path, Range, Scrubber, Text } from '..'\nimport { Element, ElementEntry } from './element'\n\n/**\n * The `Node` union type represents all of the different types of nodes that\n * occur in a Slate document tree.\n */\n\nexport type BaseNode = Editor | Element | Text\nexport type Node = Editor | Element | Text\n\nexport interface NodeAncestorsOptions {\n  reverse?: boolean\n}\n\nexport interface NodeChildrenOptions {\n  reverse?: boolean\n}\n\nexport interface NodeDescendantsOptions {\n  from?: Path\n  to?: Path\n  reverse?: boolean\n  pass?: (node: NodeEntry) => boolean\n}\n\nexport interface NodeElementsOptions {\n  from?: Path\n  to?: Path\n  reverse?: boolean\n  pass?: (node: NodeEntry) => boolean\n}\n\nexport interface NodeLevelsOptions {\n  reverse?: boolean\n}\n\nexport interface NodeNodesOptions {\n  from?: Path\n  to?: Path\n  reverse?: boolean\n  pass?: (entry: NodeEntry) => boolean\n}\n\nexport interface NodeTextsOptions {\n  from?: Path\n  to?: Path\n  reverse?: boolean\n  pass?: (node: NodeEntry) => boolean\n}\n\nexport interface NodeInterface {\n  /**\n   * Get the node at a specific path, asserting that it's an ancestor node.\n   */\n  ancestor: (root: Node, path: Path) => Ancestor\n\n  /**\n   * Return a generator of all the ancestor nodes above a specific path.\n   *\n   * By default the order is top-down, from highest to lowest ancestor in\n   * the tree, but you can pass the `reverse: true` option to go bottom-up.\n   */\n  ancestors: (\n    root: Node,\n    path: Path,\n    options?: NodeAncestorsOptions\n  ) => Generator<NodeEntry<Ancestor>, void, undefined>\n\n  /**\n   * Get the child of a node at a specific index.\n   */\n  child: (root: Node, index: number) => Descendant\n\n  /**\n   * Iterate over the children of a node at a specific path.\n   */\n  children: (\n    root: Node,\n    path: Path,\n    options?: NodeChildrenOptions\n  ) => Generator<NodeEntry<Descendant>, void, undefined>\n\n  /**\n   * Get an entry for the common ancesetor node of two paths.\n   */\n  common: (root: Node, path: Path, another: Path) => NodeEntry\n\n  /**\n   * Get the node at a specific path, asserting that it's a descendant node.\n   */\n  descendant: (root: Node, path: Path) => Descendant\n\n  /**\n   * Return a generator of all the descendant node entries inside a root node.\n   */\n  descendants: (\n    root: Node,\n    options?: NodeDescendantsOptions\n  ) => Generator<NodeEntry<Descendant>, void, undefined>\n\n  /**\n   * Return a generator of all the element nodes inside a root node. Each iteration\n   * will return an `ElementEntry` tuple consisting of `[Element, Path]`. If the\n   * root node is an element it will be included in the iteration as well.\n   */\n  elements: (\n    root: Node,\n    options?: NodeElementsOptions\n  ) => Generator<ElementEntry, void, undefined>\n\n  /**\n   * Extract props from a Node.\n   */\n  extractProps: (node: Node) => NodeProps\n\n  /**\n   * Get the first node entry in a root node from a path.\n   */\n  first: (root: Node, path: Path) => NodeEntry\n\n  /**\n   * Get the sliced fragment represented by a range inside a root node.\n   */\n  fragment: (root: Node, range: Range) => Descendant[]\n\n  /**\n   * Get the descendant node referred to by a specific path. If the path is an\n   * empty array, it refers to the root node itself.\n   */\n  get: (root: Node, path: Path) => Node\n\n  /**\n   * Similar to get, but returns undefined if the node does not exist.\n   */\n  getIf: (root: Node, path: Path) => Node | undefined\n\n  /**\n   * Check if a descendant node exists at a specific path.\n   */\n  has: (root: Node, path: Path) => boolean\n\n  /**\n   * Check if a value implements the `Node` interface.\n   */\n  isNode: (value: any) => value is Node\n\n  /**\n   * Check if a value is a list of `Node` objects.\n   */\n  isNodeList: (value: any) => value is Node[]\n\n  /**\n   * Get the last node entry in a root node from a path.\n   */\n  last: (root: Node, path: Path) => NodeEntry\n\n  /**\n   * Get the node at a specific path, ensuring it's a leaf text node.\n   */\n  leaf: (root: Node, path: Path) => Text\n\n  /**\n   * Return a generator of the in a branch of the tree, from a specific path.\n   *\n   * By default the order is top-down, from highest to lowest node in the tree,\n   * but you can pass the `reverse: true` option to go bottom-up.\n   */\n  levels: (\n    root: Node,\n    path: Path,\n    options?: NodeLevelsOptions\n  ) => Generator<NodeEntry, void, undefined>\n\n  /**\n   * Check if a node matches a set of props.\n   */\n  matches: (node: Node, props: Partial<Node>) => boolean\n\n  /**\n   * Return a generator of all the node entries of a root node. Each entry is\n   * returned as a `[Node, Path]` tuple, with the path referring to the node's\n   * position inside the root node.\n   */\n  nodes: (\n    root: Node,\n    options?: NodeNodesOptions\n  ) => Generator<NodeEntry, void, undefined>\n\n  /**\n   * Get the parent of a node at a specific path.\n   */\n  parent: (root: Node, path: Path) => Ancestor\n\n  /**\n   * Get the concatenated text string of a node's content.\n   *\n   * Note that this will not include spaces or line breaks between block nodes.\n   * It is not a user-facing string, but a string for performing offset-related\n   * computations for a node.\n   */\n  string: (node: Node) => string\n\n  /**\n   * Return a generator of all leaf text nodes in a root node.\n   */\n  texts: (\n    root: Node,\n    options?: NodeTextsOptions\n  ) => Generator<NodeEntry<Text>, void, undefined>\n}\n\nconst IS_NODE_LIST_CACHE = new WeakMap<any[], boolean>()\n\n// eslint-disable-next-line no-redeclare\nexport const Node: NodeInterface = {\n  ancestor(root: Node, path: Path): Ancestor {\n    const node = Node.get(root, path)\n\n    if (Text.isText(node)) {\n      throw new Error(\n        `Cannot get the ancestor node at path [${path}] because it refers to a text node instead: ${Scrubber.stringify(\n          node\n        )}`\n      )\n    }\n\n    return node\n  },\n\n  *ancestors(\n    root: Node,\n    path: Path,\n    options: NodeAncestorsOptions = {}\n  ): Generator<NodeEntry<Ancestor>, void, undefined> {\n    for (const p of Path.ancestors(path, options)) {\n      const n = Node.ancestor(root, p)\n      const entry: NodeEntry<Ancestor> = [n, p]\n      yield entry\n    }\n  },\n\n  child(root: Node, index: number): Descendant {\n    if (Text.isText(root)) {\n      throw new Error(\n        `Cannot get the child of a text node: ${Scrubber.stringify(root)}`\n      )\n    }\n\n    const c = root.children[index] as Descendant\n\n    if (c == null) {\n      throw new Error(\n        `Cannot get child at index \\`${index}\\` in node: ${Scrubber.stringify(\n          root\n        )}`\n      )\n    }\n\n    return c\n  },\n\n  *children(\n    root: Node,\n    path: Path,\n    options: NodeChildrenOptions = {}\n  ): Generator<NodeEntry<Descendant>, void, undefined> {\n    const { reverse = false } = options\n    const ancestor = Node.ancestor(root, path)\n    const { children } = ancestor\n    let index = reverse ? children.length - 1 : 0\n\n    while (reverse ? index >= 0 : index < children.length) {\n      const child = Node.child(ancestor, index)\n      const childPath = path.concat(index)\n      yield [child, childPath]\n      index = reverse ? index - 1 : index + 1\n    }\n  },\n\n  common(root: Node, path: Path, another: Path): NodeEntry {\n    const p = Path.common(path, another)\n    const n = Node.get(root, p)\n    return [n, p]\n  },\n\n  descendant(root: Node, path: Path): Descendant {\n    const node = Node.get(root, path)\n\n    if (Editor.isEditor(node)) {\n      throw new Error(\n        `Cannot get the descendant node at path [${path}] because it refers to the root editor node instead: ${Scrubber.stringify(\n          node\n        )}`\n      )\n    }\n\n    return node\n  },\n\n  *descendants(\n    root: Node,\n    options: NodeDescendantsOptions = {}\n  ): Generator<NodeEntry<Descendant>, void, undefined> {\n    for (const [node, path] of Node.nodes(root, options)) {\n      if (path.length !== 0) {\n        // NOTE: we have to coerce here because checking the path's length does\n        // guarantee that `node` is not a `Editor`, but TypeScript doesn't know.\n        yield [node, path] as NodeEntry<Descendant>\n      }\n    }\n  },\n\n  *elements(\n    root: Node,\n    options: NodeElementsOptions = {}\n  ): Generator<ElementEntry, void, undefined> {\n    for (const [node, path] of Node.nodes(root, options)) {\n      if (Element.isElement(node)) {\n        yield [node, path]\n      }\n    }\n  },\n\n  extractProps(node: Node): NodeProps {\n    if (Element.isAncestor(node)) {\n      const { children, ...properties } = node\n\n      return properties\n    } else {\n      const { text, ...properties } = node\n\n      return properties\n    }\n  },\n\n  first(root: Node, path: Path): NodeEntry {\n    const p = path.slice()\n    let n = Node.get(root, p)\n\n    while (n) {\n      if (Text.isText(n) || n.children.length === 0) {\n        break\n      } else {\n        n = n.children[0]\n        p.push(0)\n      }\n    }\n\n    return [n, p]\n  },\n\n  fragment(root: Node, range: Range): Descendant[] {\n    if (Text.isText(root)) {\n      throw new Error(\n        `Cannot get a fragment starting from a root text node: ${Scrubber.stringify(\n          root\n        )}`\n      )\n    }\n\n    const newRoot = produce({ children: root.children }, r => {\n      const [start, end] = Range.edges(range)\n      const nodeEntries = Node.nodes(r, {\n        reverse: true,\n        pass: ([, path]) => !Range.includes(range, path),\n      })\n\n      for (const [, path] of nodeEntries) {\n        if (!Range.includes(range, path)) {\n          const parent = Node.parent(r, path)\n          const index = path[path.length - 1]\n          parent.children.splice(index, 1)\n        }\n\n        if (Path.equals(path, end.path)) {\n          const leaf = Node.leaf(r, path)\n          leaf.text = leaf.text.slice(0, end.offset)\n        }\n\n        if (Path.equals(path, start.path)) {\n          const leaf = Node.leaf(r, path)\n          leaf.text = leaf.text.slice(start.offset)\n        }\n      }\n\n      if (Editor.isEditor(r)) {\n        r.selection = null\n      }\n    })\n\n    return newRoot.children\n  },\n\n  get(root: Node, path: Path): Node {\n    const node = Node.getIf(root, path)\n    if (node === undefined) {\n      throw new Error(\n        `Cannot find a descendant at path [${path}] in node: ${Scrubber.stringify(\n          root\n        )}`\n      )\n    }\n    return node\n  },\n\n  getIf(root: Node, path: Path): Node | undefined {\n    let node = root\n\n    for (let i = 0; i < path.length; i++) {\n      const p = path[i]\n\n      if (Text.isText(node) || !node.children[p]) {\n        return\n      }\n\n      node = node.children[p]\n    }\n\n    return node\n  },\n\n  has(root: Node, path: Path): boolean {\n    let node = root\n\n    for (let i = 0; i < path.length; i++) {\n      const p = path[i]\n\n      if (Text.isText(node) || !node.children[p]) {\n        return false\n      }\n\n      node = node.children[p]\n    }\n\n    return true\n  },\n\n  isNode(value: any): value is Node {\n    return (\n      Text.isText(value) || Element.isElement(value) || Editor.isEditor(value)\n    )\n  },\n\n  isNodeList(value: any): value is Node[] {\n    if (!Array.isArray(value)) {\n      return false\n    }\n    const cachedResult = IS_NODE_LIST_CACHE.get(value)\n    if (cachedResult !== undefined) {\n      return cachedResult\n    }\n    const isNodeList = value.every(val => Node.isNode(val))\n    IS_NODE_LIST_CACHE.set(value, isNodeList)\n    return isNodeList\n  },\n\n  last(root: Node, path: Path): NodeEntry {\n    const p = path.slice()\n    let n = Node.get(root, p)\n\n    while (n) {\n      if (Text.isText(n) || n.children.length === 0) {\n        break\n      } else {\n        const i = n.children.length - 1\n        n = n.children[i]\n        p.push(i)\n      }\n    }\n\n    return [n, p]\n  },\n\n  leaf(root: Node, path: Path): Text {\n    const node = Node.get(root, path)\n\n    if (!Text.isText(node)) {\n      throw new Error(\n        `Cannot get the leaf node at path [${path}] because it refers to a non-leaf node: ${Scrubber.stringify(\n          node\n        )}`\n      )\n    }\n\n    return node\n  },\n\n  *levels(\n    root: Node,\n    path: Path,\n    options: NodeLevelsOptions = {}\n  ): Generator<NodeEntry, void, undefined> {\n    for (const p of Path.levels(path, options)) {\n      const n = Node.get(root, p)\n      yield [n, p]\n    }\n  },\n\n  matches(node: Node, props: Partial<Node>): boolean {\n    return (\n      (Element.isElement(node) &&\n        Element.isElementProps(props) &&\n        Element.matches(node, props)) ||\n      (Text.isText(node) &&\n        Text.isTextProps(props) &&\n        Text.matches(node, props))\n    )\n  },\n\n  *nodes(\n    root: Node,\n    options: NodeNodesOptions = {}\n  ): Generator<NodeEntry, void, undefined> {\n    const { pass, reverse = false } = options\n    const { from = [], to } = options\n    const visited = new Set()\n    let p: Path = []\n    let n = root\n\n    while (true) {\n      if (to && (reverse ? Path.isBefore(p, to) : Path.isAfter(p, to))) {\n        break\n      }\n\n      if (!visited.has(n)) {\n        yield [n, p]\n      }\n\n      // If we're allowed to go downward and we haven't descended yet, do.\n      if (\n        !visited.has(n) &&\n        !Text.isText(n) &&\n        n.children.length !== 0 &&\n        (pass == null || pass([n, p]) === false)\n      ) {\n        visited.add(n)\n        let nextIndex = reverse ? n.children.length - 1 : 0\n\n        if (Path.isAncestor(p, from)) {\n          nextIndex = from[p.length]\n        }\n\n        p = p.concat(nextIndex)\n        n = Node.get(root, p)\n        continue\n      }\n\n      // If we're at the root and we can't go down, we're done.\n      if (p.length === 0) {\n        break\n      }\n\n      // If we're going forward...\n      if (!reverse) {\n        const newPath = Path.next(p)\n\n        if (Node.has(root, newPath)) {\n          p = newPath\n          n = Node.get(root, p)\n          continue\n        }\n      }\n\n      // If we're going backward...\n      if (reverse && p[p.length - 1] !== 0) {\n        const newPath = Path.previous(p)\n        p = newPath\n        n = Node.get(root, p)\n        continue\n      }\n\n      // Otherwise we're going upward...\n      p = Path.parent(p)\n      n = Node.get(root, p)\n      visited.add(n)\n    }\n  },\n\n  parent(root: Node, path: Path): Ancestor {\n    const parentPath = Path.parent(path)\n    const p = Node.get(root, parentPath)\n\n    if (Text.isText(p)) {\n      throw new Error(\n        `Cannot get the parent of path [${path}] because it does not exist in the root.`\n      )\n    }\n\n    return p\n  },\n\n  string(node: Node): string {\n    if (Text.isText(node)) {\n      return node.text\n    } else {\n      return node.children.map(Node.string).join('')\n    }\n  },\n\n  *texts(\n    root: Node,\n    options: NodeTextsOptions = {}\n  ): Generator<NodeEntry<Text>, void, undefined> {\n    for (const [node, path] of Node.nodes(root, options)) {\n      if (Text.isText(node)) {\n        yield [node, path]\n      }\n    }\n  },\n}\n\n/**\n * The `Descendant` union type represents nodes that are descendants in the\n * tree. It is returned as a convenience in certain cases to narrow a value\n * further than the more generic `Node` union.\n */\n\nexport type Descendant = Element | Text\n\n/**\n * The `Ancestor` union type represents nodes that are ancestors in the tree.\n * It is returned as a convenience in certain cases to narrow a value further\n * than the more generic `Node` union.\n */\n\nexport type Ancestor = Editor | Element\n\n/**\n * `NodeEntry` objects are returned when iterating over the nodes in a Slate\n * document tree. They consist of the node and its `Path` relative to the root\n * node in the document.\n */\n\nexport type NodeEntry<T extends Node = Node> = [T, Path]\n\n/**\n * Convenience type for returning the props of a node.\n */\nexport type NodeProps =\n  | Omit<Editor, 'children'>\n  | Omit<Element, 'children'>\n  | Omit<Text, 'text'>\n", "import { ExtendedType, Node, Path, Range } from '..'\nimport { isPlainObject } from 'is-plain-object'\n\nexport type BaseInsertNodeOperation = {\n  type: 'insert_node'\n  path: Path\n  node: Node\n}\n\nexport type InsertNodeOperation = ExtendedType<\n  'InsertNodeOperation',\n  BaseInsertNodeOperation\n>\n\nexport type BaseInsertTextOperation = {\n  type: 'insert_text'\n  path: Path\n  offset: number\n  text: string\n}\n\nexport type InsertTextOperation = ExtendedType<\n  'InsertTextOperation',\n  BaseInsertTextOperation\n>\n\nexport type BaseMergeNodeOperation = {\n  type: 'merge_node'\n  path: Path\n  position: number\n  properties: Partial<Node>\n}\n\nexport type MergeNodeOperation = ExtendedType<\n  'MergeNodeOperation',\n  BaseMergeNodeOperation\n>\n\nexport type BaseMoveNodeOperation = {\n  type: 'move_node'\n  path: Path\n  newPath: Path\n}\n\nexport type MoveNodeOperation = ExtendedType<\n  'MoveNodeOperation',\n  BaseMoveNodeOperation\n>\n\nexport type BaseRemoveNodeOperation = {\n  type: 'remove_node'\n  path: Path\n  node: Node\n}\n\nexport type RemoveNodeOperation = ExtendedType<\n  'RemoveNodeOperation',\n  BaseRemoveNodeOperation\n>\n\nexport type BaseRemoveTextOperation = {\n  type: 'remove_text'\n  path: Path\n  offset: number\n  text: string\n}\n\nexport type RemoveTextOperation = ExtendedType<\n  'RemoveTextOperation',\n  BaseRemoveTextOperation\n>\n\nexport type BaseSetNodeOperation = {\n  type: 'set_node'\n  path: Path\n  properties: Partial<Node>\n  newProperties: Partial<Node>\n}\n\nexport type SetNodeOperation = ExtendedType<\n  'SetNodeOperation',\n  BaseSetNodeOperation\n>\n\nexport type BaseSetSelectionOperation =\n  | {\n      type: 'set_selection'\n      properties: null\n      newProperties: Range\n    }\n  | {\n      type: 'set_selection'\n      properties: Partial<Range>\n      newProperties: Partial<Range>\n    }\n  | {\n      type: 'set_selection'\n      properties: Range\n      newProperties: null\n    }\n\nexport type SetSelectionOperation = ExtendedType<\n  'SetSelectionOperation',\n  BaseSetSelectionOperation\n>\n\nexport type BaseSplitNodeOperation = {\n  type: 'split_node'\n  path: Path\n  position: number\n  properties: Partial<Node>\n}\n\nexport type SplitNodeOperation = ExtendedType<\n  'SplitNodeOperation',\n  BaseSplitNodeOperation\n>\n\nexport type NodeOperation =\n  | InsertNodeOperation\n  | MergeNodeOperation\n  | MoveNodeOperation\n  | RemoveNodeOperation\n  | SetNodeOperation\n  | SplitNodeOperation\n\nexport type SelectionOperation = SetSelectionOperation\n\nexport type TextOperation = InsertTextOperation | RemoveTextOperation\n\n/**\n * `Operation` objects define the low-level instructions that Slate editors use\n * to apply changes to their internal state. Representing all changes as\n * operations is what allows Slate editors to easily implement history,\n * collaboration, and other features.\n */\n\nexport type BaseOperation = NodeOperation | SelectionOperation | TextOperation\nexport type Operation = ExtendedType<'Operation', BaseOperation>\n\nexport interface OperationInterface {\n  /**\n   * Check if a value is a `NodeOperation` object.\n   */\n  isNodeOperation: (value: any) => value is NodeOperation\n\n  /**\n   * Check if a value is an `Operation` object.\n   */\n  isOperation: (value: any) => value is Operation\n\n  /**\n   * Check if a value is a list of `Operation` objects.\n   */\n  isOperationList: (value: any) => value is Operation[]\n\n  /**\n   * Check if a value is a `SelectionOperation` object.\n   */\n  isSelectionOperation: (value: any) => value is SelectionOperation\n\n  /**\n   * Check if a value is a `TextOperation` object.\n   */\n  isTextOperation: (value: any) => value is TextOperation\n\n  /**\n   * Invert an operation, returning a new operation that will exactly undo the\n   * original when applied.\n   */\n  inverse: (op: Operation) => Operation\n}\n\n// eslint-disable-next-line no-redeclare\nexport const Operation: OperationInterface = {\n  isNodeOperation(value: any): value is NodeOperation {\n    return Operation.isOperation(value) && value.type.endsWith('_node')\n  },\n\n  isOperation(value: any): value is Operation {\n    if (!isPlainObject(value)) {\n      return false\n    }\n\n    switch (value.type) {\n      case 'insert_node':\n        return Path.isPath(value.path) && Node.isNode(value.node)\n      case 'insert_text':\n        return (\n          typeof value.offset === 'number' &&\n          typeof value.text === 'string' &&\n          Path.isPath(value.path)\n        )\n      case 'merge_node':\n        return (\n          typeof value.position === 'number' &&\n          Path.isPath(value.path) &&\n          isPlainObject(value.properties)\n        )\n      case 'move_node':\n        return Path.isPath(value.path) && Path.isPath(value.newPath)\n      case 'remove_node':\n        return Path.isPath(value.path) && Node.isNode(value.node)\n      case 'remove_text':\n        return (\n          typeof value.offset === 'number' &&\n          typeof value.text === 'string' &&\n          Path.isPath(value.path)\n        )\n      case 'set_node':\n        return (\n          Path.isPath(value.path) &&\n          isPlainObject(value.properties) &&\n          isPlainObject(value.newProperties)\n        )\n      case 'set_selection':\n        return (\n          (value.properties === null && Range.isRange(value.newProperties)) ||\n          (value.newProperties === null && Range.isRange(value.properties)) ||\n          (isPlainObject(value.properties) &&\n            isPlainObject(value.newProperties))\n        )\n      case 'split_node':\n        return (\n          Path.isPath(value.path) &&\n          typeof value.position === 'number' &&\n          isPlainObject(value.properties)\n        )\n      default:\n        return false\n    }\n  },\n\n  isOperationList(value: any): value is Operation[] {\n    return (\n      Array.isArray(value) && value.every(val => Operation.isOperation(val))\n    )\n  },\n\n  isSelectionOperation(value: any): value is SelectionOperation {\n    return Operation.isOperation(value) && value.type.endsWith('_selection')\n  },\n\n  isTextOperation(value: any): value is TextOperation {\n    return Operation.isOperation(value) && value.type.endsWith('_text')\n  },\n\n  inverse(op: Operation): Operation {\n    switch (op.type) {\n      case 'insert_node': {\n        return { ...op, type: 'remove_node' }\n      }\n\n      case 'insert_text': {\n        return { ...op, type: 'remove_text' }\n      }\n\n      case 'merge_node': {\n        return { ...op, type: 'split_node', path: Path.previous(op.path) }\n      }\n\n      case 'move_node': {\n        const { newPath, path } = op\n\n        // PERF: in this case the move operation is a no-op anyways.\n        if (Path.equals(newPath, path)) {\n          return op\n        }\n\n        // If the move happens completely within a single parent the path and\n        // newPath are stable with respect to each other.\n        if (Path.isSibling(path, newPath)) {\n          return { ...op, path: newPath, newPath: path }\n        }\n\n        // If the move does not happen within a single parent it is possible\n        // for the move to impact the true path to the location where the node\n        // was removed from and where it was inserted. We have to adjust for this\n        // and find the original path. We can accomplish this (only in non-sibling)\n        // moves by looking at the impact of the move operation on the node\n        // after the original move path.\n        const inversePath = Path.transform(path, op)!\n        const inverseNewPath = Path.transform(Path.next(path), op)!\n        return { ...op, path: inversePath, newPath: inverseNewPath }\n      }\n\n      case 'remove_node': {\n        return { ...op, type: 'insert_node' }\n      }\n\n      case 'remove_text': {\n        return { ...op, type: 'insert_text' }\n      }\n\n      case 'set_node': {\n        const { properties, newProperties } = op\n        return { ...op, properties: newProperties, newProperties: properties }\n      }\n\n      case 'set_selection': {\n        const { properties, newProperties } = op\n\n        if (properties == null) {\n          return {\n            ...op,\n            properties: newProperties as Range,\n            newProperties: null,\n          }\n        } else if (newProperties == null) {\n          return {\n            ...op,\n            properties: null,\n            newProperties: properties as Range,\n          }\n        } else {\n          return { ...op, properties: newProperties, newProperties: properties }\n        }\n      }\n\n      case 'split_node': {\n        return { ...op, type: 'merge_node', path: Path.next(op.path) }\n      }\n    }\n  },\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { isPlainObject } from 'is-plain-object'\nimport { Range } from '../interfaces/range'\nimport { Node } from '../interfaces/node'\nimport { Operation } from '../interfaces/operation'\n\nconst IS_EDITOR_CACHE = new WeakMap<object, boolean>()\n\nexport const isEditor: EditorInterface['isEditor'] = (\n  value: any\n): value is Editor => {\n  const cachedIsEditor = IS_EDITOR_CACHE.get(value)\n  if (cachedIsEditor !== undefined) {\n    return cachedIsEditor\n  }\n\n  if (!isPlainObject(value)) {\n    return false\n  }\n\n  const isEditor =\n    typeof value.addMark === 'function' &&\n    typeof value.apply === 'function' &&\n    typeof value.deleteFragment === 'function' &&\n    typeof value.insertBreak === 'function' &&\n    typeof value.insertSoftBreak === 'function' &&\n    typeof value.insertFragment === 'function' &&\n    typeof value.insertNode === 'function' &&\n    typeof value.insertText === 'function' &&\n    typeof value.isElementReadOnly === 'function' &&\n    typeof value.isInline === 'function' &&\n    typeof value.isSelectable === 'function' &&\n    typeof value.isVoid === 'function' &&\n    typeof value.normalizeNode === 'function' &&\n    typeof value.onChange === 'function' &&\n    typeof value.removeMark === 'function' &&\n    typeof value.getDirtyPaths === 'function' &&\n    (value.marks === null || isPlainObject(value.marks)) &&\n    (value.selection === null || Range.isRange(value.selection)) &&\n    Node.isNodeList(value.children) &&\n    Operation.isOperationList(value.operations)\n  IS_EDITOR_CACHE.set(value, isEditor)\n  return isEditor\n}\n", "import {\n  Ancestor,\n  Descendant,\n  Element,\n  ExtendedType,\n  Location,\n  Node,\n  NodeEntry,\n  Operation,\n  Path,\n  PathRef,\n  Point,\n  PointRef,\n  Range,\n  RangeRef,\n  Span,\n  Text,\n  Transforms,\n} from '..'\nimport {\n  LeafEdge,\n  MaximizeMode,\n  RangeDirection,\n  SelectionMode,\n  TextDirection,\n  TextUnit,\n  TextUnitAdjustment,\n} from '../types/types'\nimport { OmitFirstArg } from '../utils/types'\nimport { isEditor } from '../editor/is-editor'\nimport {\n  TextInsertFragmentOptions,\n  TextInsertTextOptions,\n} from './transforms/text'\nimport { NodeInsertNodesOptions } from './transforms/node'\n\n/**\n * The `Editor` interface stores all the state of a Slate editor. It is extended\n * by plugins that wish to add their own helpers and implement new behaviors.\n */\nexport interface BaseEditor {\n  // Core state.\n\n  children: Descendant[]\n  selection: Selection\n  operations: Operation[]\n  marks: EditorMarks | null\n\n  // Overrideable core methods.\n\n  apply: (operation: Operation) => void\n  getDirtyPaths: (operation: Operation) => Path[]\n  getFragment: () => Descendant[]\n  isElementReadOnly: (element: Element) => boolean\n  isSelectable: (element: Element) => boolean\n  markableVoid: (element: Element) => boolean\n  normalizeNode: (entry: NodeEntry, options?: { operation?: Operation }) => void\n  onChange: (options?: { operation?: Operation }) => void\n  shouldNormalize: ({\n    iteration,\n    dirtyPaths,\n    operation,\n  }: {\n    iteration: number\n    initialDirtyPathsLength: number\n    dirtyPaths: Path[]\n    operation?: Operation\n  }) => boolean\n\n  // Overrideable core transforms.\n\n  addMark: OmitFirstArg<typeof Editor.addMark>\n  collapse: OmitFirstArg<typeof Transforms.collapse>\n  delete: OmitFirstArg<typeof Transforms.delete>\n  deleteBackward: (unit: TextUnit) => void\n  deleteForward: (unit: TextUnit) => void\n  deleteFragment: OmitFirstArg<typeof Editor.deleteFragment>\n  deselect: OmitFirstArg<typeof Transforms.deselect>\n  insertBreak: OmitFirstArg<typeof Editor.insertBreak>\n  insertFragment: OmitFirstArg<typeof Transforms.insertFragment>\n  insertNode: OmitFirstArg<typeof Editor.insertNode>\n  insertNodes: OmitFirstArg<typeof Transforms.insertNodes>\n  insertSoftBreak: OmitFirstArg<typeof Editor.insertSoftBreak>\n  insertText: OmitFirstArg<typeof Transforms.insertText>\n  liftNodes: OmitFirstArg<typeof Transforms.liftNodes>\n  mergeNodes: OmitFirstArg<typeof Transforms.mergeNodes>\n  move: OmitFirstArg<typeof Transforms.move>\n  moveNodes: OmitFirstArg<typeof Transforms.moveNodes>\n  normalize: OmitFirstArg<typeof Editor.normalize>\n  removeMark: OmitFirstArg<typeof Editor.removeMark>\n  removeNodes: OmitFirstArg<typeof Transforms.removeNodes>\n  select: OmitFirstArg<typeof Transforms.select>\n  setNodes: <T extends Node>(\n    props: Partial<T>,\n    options?: {\n      at?: Location\n      match?: NodeMatch<T>\n      mode?: MaximizeMode\n      hanging?: boolean\n      split?: boolean\n      voids?: boolean\n      compare?: PropsCompare\n      merge?: PropsMerge\n    }\n  ) => void\n  setNormalizing: OmitFirstArg<typeof Editor.setNormalizing>\n  setPoint: OmitFirstArg<typeof Transforms.setPoint>\n  setSelection: OmitFirstArg<typeof Transforms.setSelection>\n  splitNodes: OmitFirstArg<typeof Transforms.splitNodes>\n  unsetNodes: OmitFirstArg<typeof Transforms.unsetNodes>\n  unwrapNodes: OmitFirstArg<typeof Transforms.unwrapNodes>\n  withoutNormalizing: OmitFirstArg<typeof Editor.withoutNormalizing>\n  wrapNodes: OmitFirstArg<typeof Transforms.wrapNodes>\n\n  // Overrideable core queries.\n\n  above: <T extends Ancestor>(\n    options?: EditorAboveOptions<T>\n  ) => NodeEntry<T> | undefined\n  after: OmitFirstArg<typeof Editor.after>\n  before: OmitFirstArg<typeof Editor.before>\n  edges: OmitFirstArg<typeof Editor.edges>\n  elementReadOnly: OmitFirstArg<typeof Editor.elementReadOnly>\n  end: OmitFirstArg<typeof Editor.end>\n  first: OmitFirstArg<typeof Editor.first>\n  fragment: OmitFirstArg<typeof Editor.fragment>\n  getMarks: OmitFirstArg<typeof Editor.marks>\n  hasBlocks: OmitFirstArg<typeof Editor.hasBlocks>\n  hasInlines: OmitFirstArg<typeof Editor.hasInlines>\n  hasPath: OmitFirstArg<typeof Editor.hasPath>\n  hasTexts: OmitFirstArg<typeof Editor.hasTexts>\n  isBlock: OmitFirstArg<typeof Editor.isBlock>\n  isEdge: OmitFirstArg<typeof Editor.isEdge>\n  isEmpty: OmitFirstArg<typeof Editor.isEmpty>\n  isEnd: OmitFirstArg<typeof Editor.isEnd>\n  isInline: OmitFirstArg<typeof Editor.isInline>\n  isNormalizing: OmitFirstArg<typeof Editor.isNormalizing>\n  isStart: OmitFirstArg<typeof Editor.isStart>\n  isVoid: OmitFirstArg<typeof Editor.isVoid>\n  last: OmitFirstArg<typeof Editor.last>\n  leaf: OmitFirstArg<typeof Editor.leaf>\n  levels: <T extends Node>(\n    options?: EditorLevelsOptions<T>\n  ) => Generator<NodeEntry<T>, void, undefined>\n  next: <T extends Descendant>(\n    options?: EditorNextOptions<T>\n  ) => NodeEntry<T> | undefined\n  node: OmitFirstArg<typeof Editor.node>\n  nodes: <T extends Node>(\n    options?: EditorNodesOptions<T>\n  ) => Generator<NodeEntry<T>, void, undefined>\n  parent: OmitFirstArg<typeof Editor.parent>\n  path: OmitFirstArg<typeof Editor.path>\n  pathRef: OmitFirstArg<typeof Editor.pathRef>\n  pathRefs: OmitFirstArg<typeof Editor.pathRefs>\n  point: OmitFirstArg<typeof Editor.point>\n  pointRef: OmitFirstArg<typeof Editor.pointRef>\n  pointRefs: OmitFirstArg<typeof Editor.pointRefs>\n  positions: OmitFirstArg<typeof Editor.positions>\n  previous: <T extends Node>(\n    options?: EditorPreviousOptions<T>\n  ) => NodeEntry<T> | undefined\n  range: OmitFirstArg<typeof Editor.range>\n  rangeRef: OmitFirstArg<typeof Editor.rangeRef>\n  rangeRefs: OmitFirstArg<typeof Editor.rangeRefs>\n  start: OmitFirstArg<typeof Editor.start>\n  string: OmitFirstArg<typeof Editor.string>\n  unhangRange: OmitFirstArg<typeof Editor.unhangRange>\n  void: OmitFirstArg<typeof Editor.void>\n  shouldMergeNodesRemovePrevNode: OmitFirstArg<\n    typeof Editor.shouldMergeNodesRemovePrevNode\n  >\n}\n\nexport type Editor = ExtendedType<'Editor', BaseEditor>\n\nexport type BaseSelection = Range | null\n\nexport type Selection = ExtendedType<'Selection', BaseSelection>\n\nexport type EditorMarks = Omit<Text, 'text'>\n\nexport interface EditorAboveOptions<T extends Ancestor> {\n  at?: Location\n  match?: NodeMatch<T>\n  mode?: MaximizeMode\n  voids?: boolean\n}\n\nexport interface EditorAfterOptions {\n  distance?: number\n  unit?: TextUnitAdjustment\n  voids?: boolean\n}\n\nexport interface EditorBeforeOptions {\n  distance?: number\n  unit?: TextUnitAdjustment\n  voids?: boolean\n}\n\nexport interface EditorDirectedDeletionOptions {\n  unit?: TextUnit\n}\n\nexport interface EditorElementReadOnlyOptions {\n  at?: Location\n  mode?: MaximizeMode\n  voids?: boolean\n}\n\nexport interface EditorFragmentDeletionOptions {\n  direction?: TextDirection\n}\n\nexport interface EditorLeafOptions {\n  depth?: number\n  edge?: LeafEdge\n}\n\nexport interface EditorLevelsOptions<T extends Node> {\n  at?: Location\n  match?: NodeMatch<T>\n  reverse?: boolean\n  voids?: boolean\n}\n\nexport interface EditorNextOptions<T extends Descendant> {\n  at?: Location\n  match?: NodeMatch<T>\n  mode?: SelectionMode\n  voids?: boolean\n}\n\nexport interface EditorNodeOptions {\n  depth?: number\n  edge?: LeafEdge\n}\n\nexport interface EditorNodesOptions<T extends Node> {\n  at?: Location | Span\n  match?: NodeMatch<T>\n  mode?: SelectionMode\n  universal?: boolean\n  reverse?: boolean\n  voids?: boolean\n  ignoreNonSelectable?: boolean\n}\n\nexport interface EditorNormalizeOptions {\n  force?: boolean\n  operation?: Operation\n}\n\nexport interface EditorParentOptions {\n  depth?: number\n  edge?: LeafEdge\n}\n\nexport interface EditorPathOptions {\n  depth?: number\n  edge?: LeafEdge\n}\n\nexport interface EditorPathRefOptions {\n  affinity?: TextDirection | null\n}\n\nexport interface EditorPointOptions {\n  edge?: LeafEdge\n}\n\nexport interface EditorPointRefOptions {\n  affinity?: TextDirection | null\n}\n\nexport interface EditorPositionsOptions {\n  at?: Location\n  unit?: TextUnitAdjustment\n  reverse?: boolean\n  voids?: boolean\n  ignoreNonSelectable?: boolean\n}\n\nexport interface EditorPreviousOptions<T extends Node> {\n  at?: Location\n  match?: NodeMatch<T>\n  mode?: SelectionMode\n  voids?: boolean\n}\n\nexport interface EditorRangeRefOptions {\n  affinity?: RangeDirection | null\n}\n\nexport interface EditorStringOptions {\n  voids?: boolean\n}\n\nexport interface EditorUnhangRangeOptions {\n  voids?: boolean\n}\n\nexport interface EditorVoidOptions {\n  at?: Location\n  mode?: MaximizeMode\n  voids?: boolean\n}\n\nexport interface EditorInterface {\n  /**\n   * Get the ancestor above a location in the document.\n   */\n  above: <T extends Ancestor>(\n    editor: Editor,\n    options?: EditorAboveOptions<T>\n  ) => NodeEntry<T> | undefined\n\n  /**\n   * Add a custom property to the leaf text nodes in the current selection.\n   *\n   * If the selection is currently collapsed, the marks will be added to the\n   * `editor.marks` property instead, and applied when text is inserted next.\n   */\n  addMark: (editor: Editor, key: string, value: any) => void\n\n  /**\n   * Get the point after a location.\n   */\n  after: (\n    editor: Editor,\n    at: Location,\n    options?: EditorAfterOptions\n  ) => Point | undefined\n\n  /**\n   * Get the point before a location.\n   */\n  before: (\n    editor: Editor,\n    at: Location,\n    options?: EditorBeforeOptions\n  ) => Point | undefined\n\n  /**\n   * Delete content in the editor backward from the current selection.\n   */\n  deleteBackward: (\n    editor: Editor,\n    options?: EditorDirectedDeletionOptions\n  ) => void\n\n  /**\n   * Delete content in the editor forward from the current selection.\n   */\n  deleteForward: (\n    editor: Editor,\n    options?: EditorDirectedDeletionOptions\n  ) => void\n\n  /**\n   * Delete the content in the current selection.\n   */\n  deleteFragment: (\n    editor: Editor,\n    options?: EditorFragmentDeletionOptions\n  ) => void\n\n  /**\n   * Get the start and end points of a location.\n   */\n  edges: (editor: Editor, at: Location) => [Point, Point]\n\n  /**\n   * Match a read-only element in the current branch of the editor.\n   */\n  elementReadOnly: (\n    editor: Editor,\n    options?: EditorElementReadOnlyOptions\n  ) => NodeEntry<Element> | undefined\n\n  /**\n   * Get the end point of a location.\n   */\n  end: (editor: Editor, at: Location) => Point\n\n  /**\n   * Get the first node at a location.\n   */\n  first: (editor: Editor, at: Location) => NodeEntry\n\n  /**\n   * Get the fragment at a location.\n   */\n  fragment: (editor: Editor, at: Location) => Descendant[]\n\n  /**\n   * Check if a node has block children.\n   */\n  hasBlocks: (editor: Editor, element: Element) => boolean\n\n  /**\n   * Check if a node has inline and text children.\n   */\n  hasInlines: (editor: Editor, element: Element) => boolean\n\n  hasPath: (editor: Editor, path: Path) => boolean\n\n  /**\n   * Check if a node has text children.\n   */\n  hasTexts: (editor: Editor, element: Element) => boolean\n\n  /**\n   * Insert a block break at the current selection.\n   *\n   * If the selection is currently expanded, it will be deleted first.\n   */\n  insertBreak: (editor: Editor) => void\n\n  /**\n   * Inserts a fragment\n   * at the specified location or (if not defined) the current selection or (if not defined) the end of the document.\n   */\n  insertFragment: (\n    editor: Editor,\n    fragment: Node[],\n    options?: TextInsertFragmentOptions\n  ) => void\n\n  /**\n   * Atomically inserts `nodes`\n   * at the specified location or (if not defined) the current selection or (if not defined) the end of the document.\n   */\n  insertNode: <T extends Node>(\n    editor: Editor,\n    node: Node,\n    options?: NodeInsertNodesOptions<T>\n  ) => void\n\n  /**\n   * Insert a soft break at the current selection.\n   *\n   * If the selection is currently expanded, it will be deleted first.\n   */\n  insertSoftBreak: (editor: Editor) => void\n\n  /**\n   * Insert a string of text\n   * at the specified location or (if not defined) the current selection or (if not defined) the end of the document.\n   */\n  insertText: (\n    editor: Editor,\n    text: string,\n    options?: TextInsertTextOptions\n  ) => void\n\n  /**\n   * Check if a value is a block `Element` object.\n   */\n  isBlock: (editor: Editor, value: Element) => boolean\n\n  /**\n   * Check if a point is an edge of a location.\n   */\n  isEdge: (editor: Editor, point: Point, at: Location) => boolean\n\n  /**\n   * Check if a value is an `Editor` object.\n   */\n  isEditor: (value: any) => value is Editor\n\n  /**\n   * Check if a value is a read-only `Element` object.\n   */\n  isElementReadOnly: (editor: Editor, element: Element) => boolean\n\n  /**\n   * Check if an element is empty, accounting for void nodes.\n   */\n  isEmpty: (editor: Editor, element: Element) => boolean\n\n  /**\n   * Check if a point is the end point of a location.\n   */\n  isEnd: (editor: Editor, point: Point, at: Location) => boolean\n\n  /**\n   * Check if a value is an inline `Element` object.\n   */\n  isInline: (editor: Editor, value: Element) => boolean\n\n  /**\n   * Check if the editor is currently normalizing after each operation.\n   */\n  isNormalizing: (editor: Editor) => boolean\n\n  /**\n   * Check if a value is a selectable `Element` object.\n   */\n  isSelectable: (editor: Editor, element: Element) => boolean\n\n  /**\n   * Check if a point is the start point of a location.\n   */\n  isStart: (editor: Editor, point: Point, at: Location) => boolean\n\n  /**\n   * Check if a value is a void `Element` object.\n   */\n  isVoid: (editor: Editor, value: Element) => boolean\n\n  /**\n   * Get the last node at a location.\n   */\n  last: (editor: Editor, at: Location) => NodeEntry\n\n  /**\n   * Get the leaf text node at a location.\n   */\n  leaf: (\n    editor: Editor,\n    at: Location,\n    options?: EditorLeafOptions\n  ) => NodeEntry<Text>\n\n  /**\n   * Iterate through all of the levels at a location.\n   */\n  levels: <T extends Node>(\n    editor: Editor,\n    options?: EditorLevelsOptions<T>\n  ) => Generator<NodeEntry<T>, void, undefined>\n\n  /**\n   * Get the marks that would be added to text at the current selection.\n   */\n  marks: (editor: Editor) => Omit<Text, 'text'> | null\n\n  /**\n   * Get the matching node in the branch of the document after a location.\n   */\n  next: <T extends Descendant>(\n    editor: Editor,\n    options?: EditorNextOptions<T>\n  ) => NodeEntry<T> | undefined\n\n  /**\n   * Get the node at a location.\n   */\n  node: (editor: Editor, at: Location, options?: EditorNodeOptions) => NodeEntry\n\n  /**\n   * Iterate through all of the nodes in the Editor.\n   */\n  nodes: <T extends Node>(\n    editor: Editor,\n    options?: EditorNodesOptions<T>\n  ) => Generator<NodeEntry<T>, void, undefined>\n\n  /**\n   * Normalize any dirty objects in the editor.\n   */\n  normalize: (editor: Editor, options?: EditorNormalizeOptions) => void\n\n  /**\n   * Get the parent node of a location.\n   */\n  parent: (\n    editor: Editor,\n    at: Location,\n    options?: EditorParentOptions\n  ) => NodeEntry<Ancestor>\n\n  /**\n   * Get the path of a location.\n   */\n  path: (editor: Editor, at: Location, options?: EditorPathOptions) => Path\n\n  /**\n   * Create a mutable ref for a `Path` object, which will stay in sync as new\n   * operations are applied to the editor.\n   */\n  pathRef: (\n    editor: Editor,\n    path: Path,\n    options?: EditorPathRefOptions\n  ) => PathRef\n\n  /**\n   * Get the set of currently tracked path refs of the editor.\n   */\n  pathRefs: (editor: Editor) => Set<PathRef>\n\n  /**\n   * Get the start or end point of a location.\n   */\n  point: (editor: Editor, at: Location, options?: EditorPointOptions) => Point\n\n  /**\n   * Create a mutable ref for a `Point` object, which will stay in sync as new\n   * operations are applied to the editor.\n   */\n  pointRef: (\n    editor: Editor,\n    point: Point,\n    options?: EditorPointRefOptions\n  ) => PointRef\n\n  /**\n   * Get the set of currently tracked point refs of the editor.\n   */\n  pointRefs: (editor: Editor) => Set<PointRef>\n\n  /**\n   * Return all the positions in `at` range where a `Point` can be placed.\n   *\n   * By default, moves forward by individual offsets at a time, but\n   * the `unit` option can be used to to move by character, word, line, or block.\n   *\n   * The `reverse` option can be used to change iteration direction.\n   *\n   * Note: By default void nodes are treated as a single point and iteration\n   * will not happen inside their content unless you pass in true for the\n   * `voids` option, then iteration will occur.\n   */\n  positions: (\n    editor: Editor,\n    options?: EditorPositionsOptions\n  ) => Generator<Point, void, undefined>\n\n  /**\n   * Get the matching node in the branch of the document before a location.\n   */\n  previous: <T extends Node>(\n    editor: Editor,\n    options?: EditorPreviousOptions<T>\n  ) => NodeEntry<T> | undefined\n\n  /**\n   * Get a range of a location.\n   */\n  range: (editor: Editor, at: Location, to?: Location) => Range\n\n  /**\n   * Create a mutable ref for a `Range` object, which will stay in sync as new\n   * operations are applied to the editor.\n   */\n  rangeRef: (\n    editor: Editor,\n    range: Range,\n    options?: EditorRangeRefOptions\n  ) => RangeRef\n\n  /**\n   * Get the set of currently tracked range refs of the editor.\n   */\n  rangeRefs: (editor: Editor) => Set<RangeRef>\n\n  /**\n   * Remove a custom property from all of the leaf text nodes in the current\n   * selection.\n   *\n   * If the selection is currently collapsed, the removal will be stored on\n   * `editor.marks` and applied to the text inserted next.\n   */\n  removeMark: (editor: Editor, key: string) => void\n\n  /**\n   * Manually set if the editor should currently be normalizing.\n   *\n   * Note: Using this incorrectly can leave the editor in an invalid state.\n   *\n   */\n  setNormalizing: (editor: Editor, isNormalizing: boolean) => void\n\n  /**\n   * Get the start point of a location.\n   */\n  start: (editor: Editor, at: Location) => Point\n\n  /**\n   * Get the text string content of a location.\n   *\n   * Note: by default the text of void nodes is considered to be an empty\n   * string, regardless of content, unless you pass in true for the voids option\n   */\n  string: (\n    editor: Editor,\n    at: Location,\n    options?: EditorStringOptions\n  ) => string\n\n  /**\n   * Convert a range into a non-hanging one.\n   */\n  unhangRange: (\n    editor: Editor,\n    range: Range,\n    options?: EditorUnhangRangeOptions\n  ) => Range\n\n  /**\n   * Match a void node in the current branch of the editor.\n   */\n  void: (\n    editor: Editor,\n    options?: EditorVoidOptions\n  ) => NodeEntry<Element> | undefined\n\n  /**\n   * Call a function, deferring normalization until after it completes.\n   */\n  withoutNormalizing: (editor: Editor, fn: () => void) => void\n\n  /**\n   *  Call a function, Determine whether or not remove the previous node when merge.\n   */\n  shouldMergeNodesRemovePrevNode: (\n    editor: Editor,\n    prevNodeEntry: NodeEntry,\n    curNodeEntry: NodeEntry\n  ) => boolean\n}\n\n// eslint-disable-next-line no-redeclare\nexport const Editor: EditorInterface = {\n  above(editor, options) {\n    return editor.above(options)\n  },\n\n  addMark(editor, key, value) {\n    editor.addMark(key, value)\n  },\n\n  after(editor, at, options) {\n    return editor.after(at, options)\n  },\n\n  before(editor, at, options) {\n    return editor.before(at, options)\n  },\n\n  deleteBackward(editor, options = {}) {\n    const { unit = 'character' } = options\n    editor.deleteBackward(unit)\n  },\n\n  deleteForward(editor, options = {}) {\n    const { unit = 'character' } = options\n    editor.deleteForward(unit)\n  },\n\n  deleteFragment(editor, options) {\n    editor.deleteFragment(options)\n  },\n\n  edges(editor, at) {\n    return editor.edges(at)\n  },\n\n  elementReadOnly(editor: Editor, options: EditorElementReadOnlyOptions = {}) {\n    return editor.elementReadOnly(options)\n  },\n\n  end(editor, at) {\n    return editor.end(at)\n  },\n\n  first(editor, at) {\n    return editor.first(at)\n  },\n\n  fragment(editor, at) {\n    return editor.fragment(at)\n  },\n\n  hasBlocks(editor, element) {\n    return editor.hasBlocks(element)\n  },\n\n  hasInlines(editor, element) {\n    return editor.hasInlines(element)\n  },\n\n  hasPath(editor, path) {\n    return editor.hasPath(path)\n  },\n\n  hasTexts(editor, element) {\n    return editor.hasTexts(element)\n  },\n\n  insertBreak(editor) {\n    editor.insertBreak()\n  },\n\n  insertFragment(editor, fragment, options) {\n    editor.insertFragment(fragment, options)\n  },\n\n  insertNode(editor, node) {\n    editor.insertNode(node)\n  },\n\n  insertSoftBreak(editor) {\n    editor.insertSoftBreak()\n  },\n\n  insertText(editor, text) {\n    editor.insertText(text)\n  },\n\n  isBlock(editor, value) {\n    return editor.isBlock(value)\n  },\n\n  isEdge(editor, point, at) {\n    return editor.isEdge(point, at)\n  },\n\n  isEditor(value: any): value is Editor {\n    return isEditor(value)\n  },\n\n  isElementReadOnly(editor, element) {\n    return editor.isElementReadOnly(element)\n  },\n\n  isEmpty(editor, element) {\n    return editor.isEmpty(element)\n  },\n\n  isEnd(editor, point, at) {\n    return editor.isEnd(point, at)\n  },\n\n  isInline(editor, value) {\n    return editor.isInline(value)\n  },\n\n  isNormalizing(editor) {\n    return editor.isNormalizing()\n  },\n\n  isSelectable(editor: Editor, value: Element) {\n    return editor.isSelectable(value)\n  },\n\n  isStart(editor, point, at) {\n    return editor.isStart(point, at)\n  },\n\n  isVoid(editor, value) {\n    return editor.isVoid(value)\n  },\n\n  last(editor, at) {\n    return editor.last(at)\n  },\n\n  leaf(editor, at, options) {\n    return editor.leaf(at, options)\n  },\n\n  levels(editor, options) {\n    return editor.levels(options)\n  },\n\n  marks(editor) {\n    return editor.getMarks()\n  },\n\n  next<T extends Descendant>(\n    editor: Editor,\n    options?: EditorNextOptions<T>\n  ): NodeEntry<T> | undefined {\n    return editor.next(options)\n  },\n\n  node(editor, at, options) {\n    return editor.node(at, options)\n  },\n\n  nodes(editor, options) {\n    return editor.nodes(options)\n  },\n\n  normalize(editor, options) {\n    editor.normalize(options)\n  },\n\n  parent(editor, at, options) {\n    return editor.parent(at, options)\n  },\n\n  path(editor, at, options) {\n    return editor.path(at, options)\n  },\n\n  pathRef(editor, path, options) {\n    return editor.pathRef(path, options)\n  },\n\n  pathRefs(editor) {\n    return editor.pathRefs()\n  },\n\n  point(editor, at, options) {\n    return editor.point(at, options)\n  },\n\n  pointRef(editor, point, options) {\n    return editor.pointRef(point, options)\n  },\n\n  pointRefs(editor) {\n    return editor.pointRefs()\n  },\n\n  positions(editor, options) {\n    return editor.positions(options)\n  },\n\n  previous(editor, options) {\n    return editor.previous(options)\n  },\n\n  range(editor, at, to) {\n    return editor.range(at, to)\n  },\n\n  rangeRef(editor, range, options) {\n    return editor.rangeRef(range, options)\n  },\n\n  rangeRefs(editor) {\n    return editor.rangeRefs()\n  },\n\n  removeMark(editor, key) {\n    editor.removeMark(key)\n  },\n\n  setNormalizing(editor, isNormalizing) {\n    editor.setNormalizing(isNormalizing)\n  },\n\n  start(editor, at) {\n    return editor.start(at)\n  },\n\n  string(editor, at, options) {\n    return editor.string(at, options)\n  },\n\n  unhangRange(editor, range, options) {\n    return editor.unhangRange(range, options)\n  },\n\n  void(editor, options) {\n    return editor.void(options)\n  },\n\n  withoutNormalizing(editor, fn: () => void) {\n    editor.withoutNormalizing(fn)\n  },\n  shouldMergeNodesRemovePrevNode: (editor, prevNode, curNode) => {\n    return editor.shouldMergeNodesRemovePrevNode(prevNode, curNode)\n  },\n}\n\n/**\n * A helper type for narrowing matched nodes with a predicate.\n */\n\nexport type NodeMatch<T extends Node> =\n  | ((node: Node, path: Path) => node is T)\n  | ((node: Node, path: Path) => boolean)\n\nexport type PropsCompare = (prop: Partial<Node>, node: Partial<Node>) => boolean\nexport type PropsMerge = (prop: Partial<Node>, node: Partial<Node>) => object\n", "import { Path, Point, Range } from '..'\n\n/**\n * The `Location` interface is a union of the ways to refer to a specific\n * location in a Slate document: paths, points or ranges.\n *\n * Methods will often accept a `Location` instead of requiring only a `Path`,\n * `Point` or `Range`. This eliminates the need for developers to manage\n * converting between the different interfaces in their own code base.\n */\n\nexport type Location = Path | Point | Range\n\nexport interface LocationInterface {\n  /**\n   * Check if a value implements the `Location` interface.\n   */\n  isLocation: (value: any) => value is Location\n}\n\n// eslint-disable-next-line no-redeclare\nexport const Location: LocationInterface = {\n  isLocation(value: any): value is Location {\n    return Path.isPath(value) || Point.isPoint(value) || Range.isRange(value)\n  },\n}\n\n/**\n * The `Span` interface is a low-level way to refer to locations in nodes\n * without using `Point` which requires leaf text nodes to be present.\n */\n\nexport type Span = [Path, Path]\n\nexport interface SpanInterface {\n  /**\n   * Check if a value implements the `Span` interface.\n   */\n  isSpan: (value: any) => value is Span\n}\n\n// eslint-disable-next-line no-redeclare\nexport const Span: SpanInterface = {\n  isSpan(value: any): value is Span {\n    return (\n      Array.isArray(value) && value.length === 2 && value.every(Path.isPath)\n    )\n  },\n}\n", "import { isPlainObject } from 'is-plain-object'\nimport { produce } from 'immer'\nimport { ExtendedType, Operation, Path } from '..'\nimport { TextDirection } from '../types/types'\n\n/**\n * `Point` objects refer to a specific location in a text node in a Slate\n * document. Its path refers to the location of the node in the tree, and its\n * offset refers to the distance into the node's string of text. Points can\n * only refer to `Text` nodes.\n */\n\nexport interface BasePoint {\n  path: Path\n  offset: number\n}\n\nexport type Point = ExtendedType<'Point', BasePoint>\n\nexport interface PointTransformOptions {\n  affinity?: TextDirection | null\n}\n\nexport interface PointInterface {\n  /**\n   * Compare a point to another, returning an integer indicating whether the\n   * point was before, at, or after the other.\n   */\n  compare: (point: Point, another: Point) => -1 | 0 | 1\n\n  /**\n   * Check if a point is after another.\n   */\n  isAfter: (point: Point, another: Point) => boolean\n\n  /**\n   * Check if a point is before another.\n   */\n  isBefore: (point: Point, another: Point) => boolean\n\n  /**\n   * Check if a point is exactly equal to another.\n   */\n  equals: (point: Point, another: Point) => boolean\n\n  /**\n   * Check if a value implements the `Point` interface.\n   */\n  isPoint: (value: any) => value is Point\n\n  /**\n   * Transform a point by an operation.\n   */\n  transform: (\n    point: Point,\n    op: Operation,\n    options?: PointTransformOptions\n  ) => Point | null\n}\n\n// eslint-disable-next-line no-redeclare\nexport const Point: PointInterface = {\n  compare(point: Point, another: Point): -1 | 0 | 1 {\n    const result = Path.compare(point.path, another.path)\n\n    if (result === 0) {\n      if (point.offset < another.offset) return -1\n      if (point.offset > another.offset) return 1\n      return 0\n    }\n\n    return result\n  },\n\n  isAfter(point: Point, another: Point): boolean {\n    return Point.compare(point, another) === 1\n  },\n\n  isBefore(point: Point, another: Point): boolean {\n    return Point.compare(point, another) === -1\n  },\n\n  equals(point: Point, another: Point): boolean {\n    // PERF: ensure the offsets are equal first since they are cheaper to check.\n    return (\n      point.offset === another.offset && Path.equals(point.path, another.path)\n    )\n  },\n\n  isPoint(value: any): value is Point {\n    return (\n      isPlainObject(value) &&\n      typeof value.offset === 'number' &&\n      Path.isPath(value.path)\n    )\n  },\n\n  transform(\n    point: Point | null,\n    op: Operation,\n    options: PointTransformOptions = {}\n  ): Point | null {\n    return produce(point, p => {\n      if (p === null) {\n        return null\n      }\n      const { affinity = 'forward' } = options\n      const { path, offset } = p\n\n      switch (op.type) {\n        case 'insert_node':\n        case 'move_node': {\n          p.path = Path.transform(path, op, options)!\n          break\n        }\n\n        case 'insert_text': {\n          if (\n            Path.equals(op.path, path) &&\n            (op.offset < offset ||\n              (op.offset === offset && affinity === 'forward'))\n          ) {\n            p.offset += op.text.length\n          }\n\n          break\n        }\n\n        case 'merge_node': {\n          if (Path.equals(op.path, path)) {\n            p.offset += op.position\n          }\n\n          p.path = Path.transform(path, op, options)!\n          break\n        }\n\n        case 'remove_text': {\n          if (Path.equals(op.path, path) && op.offset <= offset) {\n            p.offset -= Math.min(offset - op.offset, op.text.length)\n          }\n\n          break\n        }\n\n        case 'remove_node': {\n          if (Path.equals(op.path, path) || Path.isAncestor(op.path, path)) {\n            return null\n          }\n\n          p.path = Path.transform(path, op, options)!\n          break\n        }\n\n        case 'split_node': {\n          if (Path.equals(op.path, path)) {\n            if (op.position === offset && affinity == null) {\n              return null\n            } else if (\n              op.position < offset ||\n              (op.position === offset && affinity === 'forward')\n            ) {\n              p.offset -= op.position\n\n              p.path = Path.transform(path, op, {\n                ...options,\n                affinity: 'forward',\n              })!\n            }\n          } else {\n            p.path = Path.transform(path, op, options)!\n          }\n\n          break\n        }\n      }\n    })\n  },\n}\n\n/**\n * `PointEntry` objects are returned when iterating over `Point` objects that\n * belong to a range.\n */\n\nexport type PointEntry = [Point, 'anchor' | 'focus']\n", "export type Scrubber = (key: string, value: unknown) => unknown\n\nexport interface ScrubberInterface {\n  setScrubber(scrubber: Scrubber | undefined): void\n  stringify(value: any): string\n}\n\nlet _scrubber: Scrubber | undefined = undefined\n\n/**\n * This interface implements a stringify() function, which is used by Slate\n * internally when generating exceptions containing end user data. Developers\n * using Slate may call Scrubber.setScrubber() to alter the behavior of this\n * stringify() function.\n *\n * For example, to prevent the cleartext logging of 'text' fields within Nodes:\n *\n *    import { Scrubber } from 'slate';\n *    Scrubber.setScrubber((key, val) => {\n *      if (key === 'text') return '...scrubbed...'\n *      return val\n *    });\n *\n */\n// eslint-disable-next-line no-redeclare\nexport const Scrubber: ScrubberInterface = {\n  setScrubber(scrubber: Scrubber | undefined): void {\n    _scrubber = scrubber\n  },\n\n  stringify(value: any): string {\n    return JSON.stringify(value, _scrubber)\n  },\n}\n", "import { isPlainObject } from 'is-plain-object'\nimport { Range } from '..'\nimport { ExtendedType } from '../types/custom-types'\nimport { isDeepEqual } from '../utils/deep-equal'\n\n/**\n * `Text` objects represent the nodes that contain the actual text content of a\n * Slate document along with any formatting properties. They are always leaf\n * nodes in the document tree as they cannot contain any children.\n */\n\nexport interface BaseText {\n  text: string\n}\n\nexport type Text = ExtendedType<'Text', BaseText>\n\nexport interface TextEqualsOptions {\n  loose?: boolean\n}\n\nexport interface TextInterface {\n  /**\n   * Check if two text nodes are equal.\n   *\n   * When loose is set, the text is not compared. This is\n   * used to check whether sibling text nodes can be merged.\n   */\n  equals: (text: Text, another: Text, options?: TextEqualsOptions) => boolean\n\n  /**\n   * Check if a value implements the `Text` interface.\n   */\n  isText: (value: any) => value is Text\n\n  /**\n   * Check if a value is a list of `Text` objects.\n   */\n  isTextList: (value: any) => value is Text[]\n\n  /**\n   * Check if some props are a partial of Text.\n   */\n  isTextProps: (props: any) => props is Partial<Text>\n\n  /**\n   * Check if an text matches set of properties.\n   *\n   * Note: this is for matching custom properties, and it does not ensure that\n   * the `text` property are two nodes equal.\n   */\n  matches: (text: Text, props: Partial<Text>) => boolean\n\n  /**\n   * Get the leaves for a text node given decorations.\n   */\n  decorations: (node: Text, decorations: Range[]) => Text[]\n}\n\n// eslint-disable-next-line no-redeclare\nexport const Text: TextInterface = {\n  equals(text: Text, another: Text, options: TextEqualsOptions = {}): boolean {\n    const { loose = false } = options\n\n    function omitText(obj: Record<any, any>) {\n      const { text, ...rest } = obj\n\n      return rest\n    }\n\n    return isDeepEqual(\n      loose ? omitText(text) : text,\n      loose ? omitText(another) : another\n    )\n  },\n\n  isText(value: any): value is Text {\n    return isPlainObject(value) && typeof value.text === 'string'\n  },\n\n  isTextList(value: any): value is Text[] {\n    return Array.isArray(value) && value.every(val => Text.isText(val))\n  },\n\n  isTextProps(props: any): props is Partial<Text> {\n    return (props as Partial<Text>).text !== undefined\n  },\n\n  matches(text: Text, props: Partial<Text>): boolean {\n    for (const key in props) {\n      if (key === 'text') {\n        continue\n      }\n\n      if (\n        !text.hasOwnProperty(key) ||\n        text[<keyof Text>key] !== props[<keyof Text>key]\n      ) {\n        return false\n      }\n    }\n\n    return true\n  },\n\n  decorations(node: Text, decorations: Range[]): Text[] {\n    let leaves: Text[] = [{ ...node }]\n\n    for (const dec of decorations) {\n      const { anchor, focus, ...rest } = dec\n      const [start, end] = Range.edges(dec)\n      const next = []\n      let leafEnd = 0\n      const decorationStart = start.offset\n      const decorationEnd = end.offset\n\n      for (const leaf of leaves) {\n        const { length } = leaf.text\n        const leafStart = leafEnd\n        leafEnd += length\n\n        // If the range encompasses the entire leaf, add the range.\n        if (decorationStart <= leafStart && leafEnd <= decorationEnd) {\n          Object.assign(leaf, rest)\n          next.push(leaf)\n          continue\n        }\n\n        // If the range expanded and match the leaf, or starts after, or ends before it, continue.\n        if (\n          (decorationStart !== decorationEnd &&\n            (decorationStart === leafEnd || decorationEnd === leafStart)) ||\n          decorationStart > leafEnd ||\n          decorationEnd < leafStart ||\n          (decorationEnd === leafStart && leafStart !== 0)\n        ) {\n          next.push(leaf)\n          continue\n        }\n\n        // Otherwise we need to split the leaf, at the start, end, or both,\n        // and add the range to the middle intersecting section. Do the end\n        // split first since we don't need to update the offset that way.\n        let middle = leaf\n        let before\n        let after\n\n        if (decorationEnd < leafEnd) {\n          const off = decorationEnd - leafStart\n          after = { ...middle, text: middle.text.slice(off) }\n          middle = { ...middle, text: middle.text.slice(0, off) }\n        }\n\n        if (decorationStart > leafStart) {\n          const off = decorationStart - leafStart\n          before = { ...middle, text: middle.text.slice(0, off) }\n          middle = { ...middle, text: middle.text.slice(off) }\n        }\n\n        Object.assign(middle, rest)\n\n        if (before) {\n          next.push(before)\n        }\n\n        next.push(middle)\n\n        if (after) {\n          next.push(after)\n        }\n      }\n\n      leaves = next\n    }\n\n    return leaves\n  },\n}\n", "import { Editor, Location } from '../interfaces'\n\n/**\n * Get the default location to insert content into the editor.\n * By default, use the selection as the target location. But if there is\n * no selection, insert at the end of the document since that is such a\n * common use case when inserting from a non-selected state.\n */\nexport const getDefaultInsertLocation = (editor: Editor): Location => {\n  if (editor.selection) {\n    return editor.selection\n  } else if (editor.children.length > 0) {\n    return Editor.end(editor, [])\n  } else {\n    return [0]\n  }\n}\n", "import { Editor } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { Node } from '../interfaces/node'\n\nexport const matchPath = (\n  editor: Editor,\n  path: Path\n): ((node: Node) => boolean) => {\n  const [node] = Editor.node(editor, path)\n  return n => n === node\n}\n", "// Character (grapheme cluster) boundaries are determined according to\n// the default grapheme cluster boundary specification, extended grapheme clusters variant[1].\n//\n// References:\n//\n// [1] https://www.unicode.org/reports/tr29/#Default_Grapheme_Cluster_Table\n// [2] https://www.unicode.org/Public/UCD/latest/ucd/auxiliary/GraphemeBreakProperty.txt\n// [3] https://www.unicode.org/Public/UCD/latest/ucd/auxiliary/GraphemeBreakTest.html\n// [4] https://www.unicode.org/Public/UCD/latest/ucd/auxiliary/GraphemeBreakTest.txt\n\n/**\n * Get the distance to the end of the first character in a string of text.\n */\n\nexport const getCharacterDistance = (str: string, isRTL = false): number => {\n  const isLTR = !isRTL\n  const codepoints = isRTL ? codepointsIteratorRTL(str) : str\n\n  let left: CodepointType = CodepointType.None\n  let right: CodepointType = CodepointType.None\n  let distance = 0\n  // Evaluation of these conditions are deferred.\n  let gb11: boolean | null = null // Is GB11 applicable?\n  let gb12Or13: boolean | null = null // Is GB12 or GB13 applicable?\n\n  for (const char of codepoints) {\n    const code = char.codePointAt(0)\n    if (!code) break\n\n    const type = getCodepointType(char, code)\n    ;[left, right] = isLTR ? [right, type] : [type, left]\n\n    if (\n      intersects(left, CodepointType.ZWJ) &&\n      intersects(right, CodepointType.ExtPict)\n    ) {\n      if (isLTR) {\n        gb11 = endsWithEmojiZWJ(str.substring(0, distance))\n      } else {\n        gb11 = endsWithEmojiZWJ(str.substring(0, str.length - distance))\n      }\n      if (!gb11) break\n    }\n\n    if (\n      intersects(left, CodepointType.RI) &&\n      intersects(right, CodepointType.RI)\n    ) {\n      if (gb12Or13 !== null) {\n        gb12Or13 = !gb12Or13\n      } else {\n        if (isLTR) {\n          gb12Or13 = true\n        } else {\n          gb12Or13 = endsWithOddNumberOfRIs(\n            str.substring(0, str.length - distance)\n          )\n        }\n      }\n      if (!gb12Or13) break\n    }\n\n    if (\n      left !== CodepointType.None &&\n      right !== CodepointType.None &&\n      isBoundaryPair(left, right)\n    ) {\n      break\n    }\n\n    distance += char.length\n  }\n\n  return distance || 1\n}\n\nconst SPACE = /\\s/\nconst PUNCTUATION =\n  /[\\u002B\\u0021-\\u0023\\u0025-\\u002A\\u002C-\\u002F\\u003A\\u003B\\u003F\\u0040\\u005B-\\u005D\\u005F\\u007B\\u007D\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]/\nconst CHAMELEON = /['\\u2018\\u2019]/\n\n/**\n * Get the distance to the end of the first word in a string of text.\n */\n\nexport const getWordDistance = (text: string, isRTL = false): number => {\n  let dist = 0\n  let started = false\n\n  while (text.length > 0) {\n    const charDist = getCharacterDistance(text, isRTL)\n    const [char, remaining] = splitByCharacterDistance(text, charDist, isRTL)\n\n    if (isWordCharacter(char, remaining, isRTL)) {\n      started = true\n      dist += charDist\n    } else if (!started) {\n      dist += charDist\n    } else {\n      break\n    }\n\n    text = remaining\n  }\n\n  return dist\n}\n\n/**\n * Split a string in two parts at a given distance starting from the end when\n * `isRTL` is set to `true`.\n */\n\nexport const splitByCharacterDistance = (\n  str: string,\n  dist: number,\n  isRTL?: boolean\n): [string, string] => {\n  if (isRTL) {\n    const at = str.length - dist\n    return [str.slice(at, str.length), str.slice(0, at)]\n  }\n\n  return [str.slice(0, dist), str.slice(dist)]\n}\n\n/**\n * Check if a character is a word character. The `remaining` argument is used\n * because sometimes you must read subsequent characters to truly determine it.\n */\n\nconst isWordCharacter = (\n  char: string,\n  remaining: string,\n  isRTL = false\n): boolean => {\n  if (SPACE.test(char)) {\n    return false\n  }\n\n  // Chameleons count as word characters as long as they're in a word, so\n  // recurse to see if the next one is a word character or not.\n  if (CHAMELEON.test(char)) {\n    const charDist = getCharacterDistance(remaining, isRTL)\n    const [nextChar, nextRemaining] = splitByCharacterDistance(\n      remaining,\n      charDist,\n      isRTL\n    )\n\n    if (isWordCharacter(nextChar, nextRemaining, isRTL)) {\n      return true\n    }\n  }\n\n  if (PUNCTUATION.test(char)) {\n    return false\n  }\n\n  return true\n}\n\n/**\n * Iterate on codepoints from right to left.\n */\n\nexport const codepointsIteratorRTL = function* (str: string) {\n  const end = str.length - 1\n\n  for (let i = 0; i < str.length; i++) {\n    const char1 = str.charAt(end - i)\n\n    if (isLowSurrogate(char1.charCodeAt(0))) {\n      const char2 = str.charAt(end - i - 1)\n      if (isHighSurrogate(char2.charCodeAt(0))) {\n        yield char2 + char1\n\n        i++\n        continue\n      }\n    }\n\n    yield char1\n  }\n}\n\n/**\n * Is `charCode` a high surrogate.\n *\n * https://en.wikipedia.org/wiki/Universal_Character_Set_characters#Surrogates\n */\n\nconst isHighSurrogate = (charCode: number) => {\n  return charCode >= 0xd800 && charCode <= 0xdbff\n}\n\n/**\n * Is `charCode` a low surrogate.\n *\n * https://en.wikipedia.org/wiki/Universal_Character_Set_characters#Surrogates\n */\n\nconst isLowSurrogate = (charCode: number) => {\n  return charCode >= 0xdc00 && charCode <= 0xdfff\n}\n\nenum CodepointType {\n  None = 0,\n  Extend = 1 << 0,\n  ZWJ = 1 << 1,\n  RI = 1 << 2,\n  Prepend = 1 << 3,\n  SpacingMark = 1 << 4,\n  L = 1 << 5,\n  V = 1 << 6,\n  T = 1 << 7,\n  LV = 1 << 8,\n  LVT = 1 << 9,\n  ExtPict = 1 << 10,\n  Any = 1 << 11,\n}\n\nconst reExtend = /^[\\p{Gr_Ext}\\p{EMod}]$/u\nconst rePrepend =\n  /^[\\u0600-\\u0605\\u06DD\\u070F\\u0890-\\u0891\\u08E2\\u0D4E\\u{110BD}\\u{110CD}\\u{111C2}-\\u{111C3}\\u{1193F}\\u{11941}\\u{11A3A}\\u{11A84}-\\u{11A89}\\u{11D46}]$/u\nconst reSpacingMark =\n  /^[\\u0903\\u093B\\u093E-\\u0940\\u0949-\\u094C\\u094E-\\u094F\\u0982-\\u0983\\u09BF-\\u09C0\\u09C7-\\u09C8\\u09CB-\\u09CC\\u0A03\\u0A3E-\\u0A40\\u0A83\\u0ABE-\\u0AC0\\u0AC9\\u0ACB-\\u0ACC\\u0B02-\\u0B03\\u0B40\\u0B47-\\u0B48\\u0B4B-\\u0B4C\\u0BBF\\u0BC1-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCC\\u0C01-\\u0C03\\u0C41-\\u0C44\\u0C82-\\u0C83\\u0CBE\\u0CC0-\\u0CC1\\u0CC3-\\u0CC4\\u0CC7-\\u0CC8\\u0CCA-\\u0CCB\\u0D02-\\u0D03\\u0D3F-\\u0D40\\u0D46-\\u0D48\\u0D4A-\\u0D4C\\u0D82-\\u0D83\\u0DD0-\\u0DD1\\u0DD8-\\u0DDE\\u0DF2-\\u0DF3\\u0E33\\u0EB3\\u0F3E-\\u0F3F\\u0F7F\\u1031\\u103B-\\u103C\\u1056-\\u1057\\u1084\\u1715\\u1734\\u17B6\\u17BE-\\u17C5\\u17C7-\\u17C8\\u1923-\\u1926\\u1929-\\u192B\\u1930-\\u1931\\u1933-\\u1938\\u1A19-\\u1A1A\\u1A55\\u1A57\\u1A6D-\\u1A72\\u1B04\\u1B3B\\u1B3D-\\u1B41\\u1B43-\\u1B44\\u1B82\\u1BA1\\u1BA6-\\u1BA7\\u1BAA\\u1BE7\\u1BEA-\\u1BEC\\u1BEE\\u1BF2-\\u1BF3\\u1C24-\\u1C2B\\u1C34-\\u1C35\\u1CE1\\u1CF7\\uA823-\\uA824\\uA827\\uA880-\\uA881\\uA8B4-\\uA8C3\\uA952-\\uA953\\uA983\\uA9B4-\\uA9B5\\uA9BA-\\uA9BB\\uA9BE-\\uA9C0\\uAA2F-\\uAA30\\uAA33-\\uAA34\\uAA4D\\uAAEB\\uAAEE-\\uAAEF\\uAAF5\\uABE3-\\uABE4\\uABE6-\\uABE7\\uABE9-\\uABEA\\uABEC\\u{11000}\\u{11002}\\u{11082}\\u{110B0}-\\u{110B2}\\u{110B7}-\\u{110B8}\\u{1112C}\\u{11145}-\\u{11146}\\u{11182}\\u{111B3}-\\u{111B5}\\u{111BF}-\\u{111C0}\\u{111CE}\\u{1122C}-\\u{1122E}\\u{11232}-\\u{11233}\\u{11235}\\u{112E0}-\\u{112E2}\\u{11302}-\\u{11303}\\u{1133F}\\u{11341}-\\u{11344}\\u{11347}-\\u{11348}\\u{1134B}-\\u{1134D}\\u{11362}-\\u{11363}\\u{11435}-\\u{11437}\\u{11440}-\\u{11441}\\u{11445}\\u{114B1}-\\u{114B2}\\u{114B9}\\u{114BB}-\\u{114BC}\\u{114BE}\\u{114C1}\\u{115B0}-\\u{115B1}\\u{115B8}-\\u{115BB}\\u{115BE}\\u{11630}-\\u{11632}\\u{1163B}-\\u{1163C}\\u{1163E}\\u{116AC}\\u{116AE}-\\u{116AF}\\u{116B6}\\u{11726}\\u{1182C}-\\u{1182E}\\u{11838}\\u{11931}-\\u{11935}\\u{11937}-\\u{11938}\\u{1193D}\\u{11940}\\u{11942}\\u{119D1}-\\u{119D3}\\u{119DC}-\\u{119DF}\\u{119E4}\\u{11A39}\\u{11A57}-\\u{11A58}\\u{11A97}\\u{11C2F}\\u{11C3E}\\u{11CA9}\\u{11CB1}\\u{11CB4}\\u{11D8A}-\\u{11D8E}\\u{11D93}-\\u{11D94}\\u{11D96}\\u{11EF5}-\\u{11EF6}\\u{16F51}-\\u{16F87}\\u{16FF0}-\\u{16FF1}\\u{1D166}\\u{1D16D}]$/u\nconst reL = /^[\\u1100-\\u115F\\uA960-\\uA97C]$/u\nconst reV = /^[\\u1160-\\u11A7\\uD7B0-\\uD7C6]$/u\nconst reT = /^[\\u11A8-\\u11FF\\uD7CB-\\uD7FB]$/u\nconst reLV =\n  /^[\\uAC00\\uAC1C\\uAC38\\uAC54\\uAC70\\uAC8C\\uACA8\\uACC4\\uACE0\\uACFC\\uAD18\\uAD34\\uAD50\\uAD6C\\uAD88\\uADA4\\uADC0\\uADDC\\uADF8\\uAE14\\uAE30\\uAE4C\\uAE68\\uAE84\\uAEA0\\uAEBC\\uAED8\\uAEF4\\uAF10\\uAF2C\\uAF48\\uAF64\\uAF80\\uAF9C\\uAFB8\\uAFD4\\uAFF0\\uB00C\\uB028\\uB044\\uB060\\uB07C\\uB098\\uB0B4\\uB0D0\\uB0EC\\uB108\\uB124\\uB140\\uB15C\\uB178\\uB194\\uB1B0\\uB1CC\\uB1E8\\uB204\\uB220\\uB23C\\uB258\\uB274\\uB290\\uB2AC\\uB2C8\\uB2E4\\uB300\\uB31C\\uB338\\uB354\\uB370\\uB38C\\uB3A8\\uB3C4\\uB3E0\\uB3FC\\uB418\\uB434\\uB450\\uB46C\\uB488\\uB4A4\\uB4C0\\uB4DC\\uB4F8\\uB514\\uB530\\uB54C\\uB568\\uB584\\uB5A0\\uB5BC\\uB5D8\\uB5F4\\uB610\\uB62C\\uB648\\uB664\\uB680\\uB69C\\uB6B8\\uB6D4\\uB6F0\\uB70C\\uB728\\uB744\\uB760\\uB77C\\uB798\\uB7B4\\uB7D0\\uB7EC\\uB808\\uB824\\uB840\\uB85C\\uB878\\uB894\\uB8B0\\uB8CC\\uB8E8\\uB904\\uB920\\uB93C\\uB958\\uB974\\uB990\\uB9AC\\uB9C8\\uB9E4\\uBA00\\uBA1C\\uBA38\\uBA54\\uBA70\\uBA8C\\uBAA8\\uBAC4\\uBAE0\\uBAFC\\uBB18\\uBB34\\uBB50\\uBB6C\\uBB88\\uBBA4\\uBBC0\\uBBDC\\uBBF8\\uBC14\\uBC30\\uBC4C\\uBC68\\uBC84\\uBCA0\\uBCBC\\uBCD8\\uBCF4\\uBD10\\uBD2C\\uBD48\\uBD64\\uBD80\\uBD9C\\uBDB8\\uBDD4\\uBDF0\\uBE0C\\uBE28\\uBE44\\uBE60\\uBE7C\\uBE98\\uBEB4\\uBED0\\uBEEC\\uBF08\\uBF24\\uBF40\\uBF5C\\uBF78\\uBF94\\uBFB0\\uBFCC\\uBFE8\\uC004\\uC020\\uC03C\\uC058\\uC074\\uC090\\uC0AC\\uC0C8\\uC0E4\\uC100\\uC11C\\uC138\\uC154\\uC170\\uC18C\\uC1A8\\uC1C4\\uC1E0\\uC1FC\\uC218\\uC234\\uC250\\uC26C\\uC288\\uC2A4\\uC2C0\\uC2DC\\uC2F8\\uC314\\uC330\\uC34C\\uC368\\uC384\\uC3A0\\uC3BC\\uC3D8\\uC3F4\\uC410\\uC42C\\uC448\\uC464\\uC480\\uC49C\\uC4B8\\uC4D4\\uC4F0\\uC50C\\uC528\\uC544\\uC560\\uC57C\\uC598\\uC5B4\\uC5D0\\uC5EC\\uC608\\uC624\\uC640\\uC65C\\uC678\\uC694\\uC6B0\\uC6CC\\uC6E8\\uC704\\uC720\\uC73C\\uC758\\uC774\\uC790\\uC7AC\\uC7C8\\uC7E4\\uC800\\uC81C\\uC838\\uC854\\uC870\\uC88C\\uC8A8\\uC8C4\\uC8E0\\uC8FC\\uC918\\uC934\\uC950\\uC96C\\uC988\\uC9A4\\uC9C0\\uC9DC\\uC9F8\\uCA14\\uCA30\\uCA4C\\uCA68\\uCA84\\uCAA0\\uCABC\\uCAD8\\uCAF4\\uCB10\\uCB2C\\uCB48\\uCB64\\uCB80\\uCB9C\\uCBB8\\uCBD4\\uCBF0\\uCC0C\\uCC28\\uCC44\\uCC60\\uCC7C\\uCC98\\uCCB4\\uCCD0\\uCCEC\\uCD08\\uCD24\\uCD40\\uCD5C\\uCD78\\uCD94\\uCDB0\\uCDCC\\uCDE8\\uCE04\\uCE20\\uCE3C\\uCE58\\uCE74\\uCE90\\uCEAC\\uCEC8\\uCEE4\\uCF00\\uCF1C\\uCF38\\uCF54\\uCF70\\uCF8C\\uCFA8\\uCFC4\\uCFE0\\uCFFC\\uD018\\uD034\\uD050\\uD06C\\uD088\\uD0A4\\uD0C0\\uD0DC\\uD0F8\\uD114\\uD130\\uD14C\\uD168\\uD184\\uD1A0\\uD1BC\\uD1D8\\uD1F4\\uD210\\uD22C\\uD248\\uD264\\uD280\\uD29C\\uD2B8\\uD2D4\\uD2F0\\uD30C\\uD328\\uD344\\uD360\\uD37C\\uD398\\uD3B4\\uD3D0\\uD3EC\\uD408\\uD424\\uD440\\uD45C\\uD478\\uD494\\uD4B0\\uD4CC\\uD4E8\\uD504\\uD520\\uD53C\\uD558\\uD574\\uD590\\uD5AC\\uD5C8\\uD5E4\\uD600\\uD61C\\uD638\\uD654\\uD670\\uD68C\\uD6A8\\uD6C4\\uD6E0\\uD6FC\\uD718\\uD734\\uD750\\uD76C\\uD788]$/u\nconst reLVT =\n  /^[\\uAC01-\\uAC1B\\uAC1D-\\uAC37\\uAC39-\\uAC53\\uAC55-\\uAC6F\\uAC71-\\uAC8B\\uAC8D-\\uACA7\\uACA9-\\uACC3\\uACC5-\\uACDF\\uACE1-\\uACFB\\uACFD-\\uAD17\\uAD19-\\uAD33\\uAD35-\\uAD4F\\uAD51-\\uAD6B\\uAD6D-\\uAD87\\uAD89-\\uADA3\\uADA5-\\uADBF\\uADC1-\\uADDB\\uADDD-\\uADF7\\uADF9-\\uAE13\\uAE15-\\uAE2F\\uAE31-\\uAE4B\\uAE4D-\\uAE67\\uAE69-\\uAE83\\uAE85-\\uAE9F\\uAEA1-\\uAEBB\\uAEBD-\\uAED7\\uAED9-\\uAEF3\\uAEF5-\\uAF0F\\uAF11-\\uAF2B\\uAF2D-\\uAF47\\uAF49-\\uAF63\\uAF65-\\uAF7F\\uAF81-\\uAF9B\\uAF9D-\\uAFB7\\uAFB9-\\uAFD3\\uAFD5-\\uAFEF\\uAFF1-\\uB00B\\uB00D-\\uB027\\uB029-\\uB043\\uB045-\\uB05F\\uB061-\\uB07B\\uB07D-\\uB097\\uB099-\\uB0B3\\uB0B5-\\uB0CF\\uB0D1-\\uB0EB\\uB0ED-\\uB107\\uB109-\\uB123\\uB125-\\uB13F\\uB141-\\uB15B\\uB15D-\\uB177\\uB179-\\uB193\\uB195-\\uB1AF\\uB1B1-\\uB1CB\\uB1CD-\\uB1E7\\uB1E9-\\uB203\\uB205-\\uB21F\\uB221-\\uB23B\\uB23D-\\uB257\\uB259-\\uB273\\uB275-\\uB28F\\uB291-\\uB2AB\\uB2AD-\\uB2C7\\uB2C9-\\uB2E3\\uB2E5-\\uB2FF\\uB301-\\uB31B\\uB31D-\\uB337\\uB339-\\uB353\\uB355-\\uB36F\\uB371-\\uB38B\\uB38D-\\uB3A7\\uB3A9-\\uB3C3\\uB3C5-\\uB3DF\\uB3E1-\\uB3FB\\uB3FD-\\uB417\\uB419-\\uB433\\uB435-\\uB44F\\uB451-\\uB46B\\uB46D-\\uB487\\uB489-\\uB4A3\\uB4A5-\\uB4BF\\uB4C1-\\uB4DB\\uB4DD-\\uB4F7\\uB4F9-\\uB513\\uB515-\\uB52F\\uB531-\\uB54B\\uB54D-\\uB567\\uB569-\\uB583\\uB585-\\uB59F\\uB5A1-\\uB5BB\\uB5BD-\\uB5D7\\uB5D9-\\uB5F3\\uB5F5-\\uB60F\\uB611-\\uB62B\\uB62D-\\uB647\\uB649-\\uB663\\uB665-\\uB67F\\uB681-\\uB69B\\uB69D-\\uB6B7\\uB6B9-\\uB6D3\\uB6D5-\\uB6EF\\uB6F1-\\uB70B\\uB70D-\\uB727\\uB729-\\uB743\\uB745-\\uB75F\\uB761-\\uB77B\\uB77D-\\uB797\\uB799-\\uB7B3\\uB7B5-\\uB7CF\\uB7D1-\\uB7EB\\uB7ED-\\uB807\\uB809-\\uB823\\uB825-\\uB83F\\uB841-\\uB85B\\uB85D-\\uB877\\uB879-\\uB893\\uB895-\\uB8AF\\uB8B1-\\uB8CB\\uB8CD-\\uB8E7\\uB8E9-\\uB903\\uB905-\\uB91F\\uB921-\\uB93B\\uB93D-\\uB957\\uB959-\\uB973\\uB975-\\uB98F\\uB991-\\uB9AB\\uB9AD-\\uB9C7\\uB9C9-\\uB9E3\\uB9E5-\\uB9FF\\uBA01-\\uBA1B\\uBA1D-\\uBA37\\uBA39-\\uBA53\\uBA55-\\uBA6F\\uBA71-\\uBA8B\\uBA8D-\\uBAA7\\uBAA9-\\uBAC3\\uBAC5-\\uBADF\\uBAE1-\\uBAFB\\uBAFD-\\uBB17\\uBB19-\\uBB33\\uBB35-\\uBB4F\\uBB51-\\uBB6B\\uBB6D-\\uBB87\\uBB89-\\uBBA3\\uBBA5-\\uBBBF\\uBBC1-\\uBBDB\\uBBDD-\\uBBF7\\uBBF9-\\uBC13\\uBC15-\\uBC2F\\uBC31-\\uBC4B\\uBC4D-\\uBC67\\uBC69-\\uBC83\\uBC85-\\uBC9F\\uBCA1-\\uBCBB\\uBCBD-\\uBCD7\\uBCD9-\\uBCF3\\uBCF5-\\uBD0F\\uBD11-\\uBD2B\\uBD2D-\\uBD47\\uBD49-\\uBD63\\uBD65-\\uBD7F\\uBD81-\\uBD9B\\uBD9D-\\uBDB7\\uBDB9-\\uBDD3\\uBDD5-\\uBDEF\\uBDF1-\\uBE0B\\uBE0D-\\uBE27\\uBE29-\\uBE43\\uBE45-\\uBE5F\\uBE61-\\uBE7B\\uBE7D-\\uBE97\\uBE99-\\uBEB3\\uBEB5-\\uBECF\\uBED1-\\uBEEB\\uBEED-\\uBF07\\uBF09-\\uBF23\\uBF25-\\uBF3F\\uBF41-\\uBF5B\\uBF5D-\\uBF77\\uBF79-\\uBF93\\uBF95-\\uBFAF\\uBFB1-\\uBFCB\\uBFCD-\\uBFE7\\uBFE9-\\uC003\\uC005-\\uC01F\\uC021-\\uC03B\\uC03D-\\uC057\\uC059-\\uC073\\uC075-\\uC08F\\uC091-\\uC0AB\\uC0AD-\\uC0C7\\uC0C9-\\uC0E3\\uC0E5-\\uC0FF\\uC101-\\uC11B\\uC11D-\\uC137\\uC139-\\uC153\\uC155-\\uC16F\\uC171-\\uC18B\\uC18D-\\uC1A7\\uC1A9-\\uC1C3\\uC1C5-\\uC1DF\\uC1E1-\\uC1FB\\uC1FD-\\uC217\\uC219-\\uC233\\uC235-\\uC24F\\uC251-\\uC26B\\uC26D-\\uC287\\uC289-\\uC2A3\\uC2A5-\\uC2BF\\uC2C1-\\uC2DB\\uC2DD-\\uC2F7\\uC2F9-\\uC313\\uC315-\\uC32F\\uC331-\\uC34B\\uC34D-\\uC367\\uC369-\\uC383\\uC385-\\uC39F\\uC3A1-\\uC3BB\\uC3BD-\\uC3D7\\uC3D9-\\uC3F3\\uC3F5-\\uC40F\\uC411-\\uC42B\\uC42D-\\uC447\\uC449-\\uC463\\uC465-\\uC47F\\uC481-\\uC49B\\uC49D-\\uC4B7\\uC4B9-\\uC4D3\\uC4D5-\\uC4EF\\uC4F1-\\uC50B\\uC50D-\\uC527\\uC529-\\uC543\\uC545-\\uC55F\\uC561-\\uC57B\\uC57D-\\uC597\\uC599-\\uC5B3\\uC5B5-\\uC5CF\\uC5D1-\\uC5EB\\uC5ED-\\uC607\\uC609-\\uC623\\uC625-\\uC63F\\uC641-\\uC65B\\uC65D-\\uC677\\uC679-\\uC693\\uC695-\\uC6AF\\uC6B1-\\uC6CB\\uC6CD-\\uC6E7\\uC6E9-\\uC703\\uC705-\\uC71F\\uC721-\\uC73B\\uC73D-\\uC757\\uC759-\\uC773\\uC775-\\uC78F\\uC791-\\uC7AB\\uC7AD-\\uC7C7\\uC7C9-\\uC7E3\\uC7E5-\\uC7FF\\uC801-\\uC81B\\uC81D-\\uC837\\uC839-\\uC853\\uC855-\\uC86F\\uC871-\\uC88B\\uC88D-\\uC8A7\\uC8A9-\\uC8C3\\uC8C5-\\uC8DF\\uC8E1-\\uC8FB\\uC8FD-\\uC917\\uC919-\\uC933\\uC935-\\uC94F\\uC951-\\uC96B\\uC96D-\\uC987\\uC989-\\uC9A3\\uC9A5-\\uC9BF\\uC9C1-\\uC9DB\\uC9DD-\\uC9F7\\uC9F9-\\uCA13\\uCA15-\\uCA2F\\uCA31-\\uCA4B\\uCA4D-\\uCA67\\uCA69-\\uCA83\\uCA85-\\uCA9F\\uCAA1-\\uCABB\\uCABD-\\uCAD7\\uCAD9-\\uCAF3\\uCAF5-\\uCB0F\\uCB11-\\uCB2B\\uCB2D-\\uCB47\\uCB49-\\uCB63\\uCB65-\\uCB7F\\uCB81-\\uCB9B\\uCB9D-\\uCBB7\\uCBB9-\\uCBD3\\uCBD5-\\uCBEF\\uCBF1-\\uCC0B\\uCC0D-\\uCC27\\uCC29-\\uCC43\\uCC45-\\uCC5F\\uCC61-\\uCC7B\\uCC7D-\\uCC97\\uCC99-\\uCCB3\\uCCB5-\\uCCCF\\uCCD1-\\uCCEB\\uCCED-\\uCD07\\uCD09-\\uCD23\\uCD25-\\uCD3F\\uCD41-\\uCD5B\\uCD5D-\\uCD77\\uCD79-\\uCD93\\uCD95-\\uCDAF\\uCDB1-\\uCDCB\\uCDCD-\\uCDE7\\uCDE9-\\uCE03\\uCE05-\\uCE1F\\uCE21-\\uCE3B\\uCE3D-\\uCE57\\uCE59-\\uCE73\\uCE75-\\uCE8F\\uCE91-\\uCEAB\\uCEAD-\\uCEC7\\uCEC9-\\uCEE3\\uCEE5-\\uCEFF\\uCF01-\\uCF1B\\uCF1D-\\uCF37\\uCF39-\\uCF53\\uCF55-\\uCF6F\\uCF71-\\uCF8B\\uCF8D-\\uCFA7\\uCFA9-\\uCFC3\\uCFC5-\\uCFDF\\uCFE1-\\uCFFB\\uCFFD-\\uD017\\uD019-\\uD033\\uD035-\\uD04F\\uD051-\\uD06B\\uD06D-\\uD087\\uD089-\\uD0A3\\uD0A5-\\uD0BF\\uD0C1-\\uD0DB\\uD0DD-\\uD0F7\\uD0F9-\\uD113\\uD115-\\uD12F\\uD131-\\uD14B\\uD14D-\\uD167\\uD169-\\uD183\\uD185-\\uD19F\\uD1A1-\\uD1BB\\uD1BD-\\uD1D7\\uD1D9-\\uD1F3\\uD1F5-\\uD20F\\uD211-\\uD22B\\uD22D-\\uD247\\uD249-\\uD263\\uD265-\\uD27F\\uD281-\\uD29B\\uD29D-\\uD2B7\\uD2B9-\\uD2D3\\uD2D5-\\uD2EF\\uD2F1-\\uD30B\\uD30D-\\uD327\\uD329-\\uD343\\uD345-\\uD35F\\uD361-\\uD37B\\uD37D-\\uD397\\uD399-\\uD3B3\\uD3B5-\\uD3CF\\uD3D1-\\uD3EB\\uD3ED-\\uD407\\uD409-\\uD423\\uD425-\\uD43F\\uD441-\\uD45B\\uD45D-\\uD477\\uD479-\\uD493\\uD495-\\uD4AF\\uD4B1-\\uD4CB\\uD4CD-\\uD4E7\\uD4E9-\\uD503\\uD505-\\uD51F\\uD521-\\uD53B\\uD53D-\\uD557\\uD559-\\uD573\\uD575-\\uD58F\\uD591-\\uD5AB\\uD5AD-\\uD5C7\\uD5C9-\\uD5E3\\uD5E5-\\uD5FF\\uD601-\\uD61B\\uD61D-\\uD637\\uD639-\\uD653\\uD655-\\uD66F\\uD671-\\uD68B\\uD68D-\\uD6A7\\uD6A9-\\uD6C3\\uD6C5-\\uD6DF\\uD6E1-\\uD6FB\\uD6FD-\\uD717\\uD719-\\uD733\\uD735-\\uD74F\\uD751-\\uD76B\\uD76D-\\uD787\\uD789-\\uD7A3]$/u\nconst reExtPict = /^\\p{ExtPict}$/u\n\nconst getCodepointType = (char: string, code: number): CodepointType => {\n  let type = CodepointType.Any\n  if (char.search(reExtend) !== -1) {\n    type |= CodepointType.Extend\n  }\n  if (code === 0x200d) {\n    type |= CodepointType.ZWJ\n  }\n  if (code >= 0x1f1e6 && code <= 0x1f1ff) {\n    type |= CodepointType.RI\n  }\n  if (char.search(rePrepend) !== -1) {\n    type |= CodepointType.Prepend\n  }\n  if (char.search(reSpacingMark) !== -1) {\n    type |= CodepointType.SpacingMark\n  }\n  if (char.search(reL) !== -1) {\n    type |= CodepointType.L\n  }\n  if (char.search(reV) !== -1) {\n    type |= CodepointType.V\n  }\n  if (char.search(reT) !== -1) {\n    type |= CodepointType.T\n  }\n  if (char.search(reLV) !== -1) {\n    type |= CodepointType.LV\n  }\n  if (char.search(reLVT) !== -1) {\n    type |= CodepointType.LVT\n  }\n  if (char.search(reExtPict) !== -1) {\n    type |= CodepointType.ExtPict\n  }\n\n  return type\n}\n\nfunction intersects(x: CodepointType, y: CodepointType) {\n  return (x & y) !== 0\n}\n\nconst NonBoundaryPairs: [CodepointType, CodepointType][] = [\n  // GB6\n  [\n    CodepointType.L,\n    CodepointType.L | CodepointType.V | CodepointType.LV | CodepointType.LVT,\n  ],\n  // GB7\n  [CodepointType.LV | CodepointType.V, CodepointType.V | CodepointType.T],\n  // GB8\n  [CodepointType.LVT | CodepointType.T, CodepointType.T],\n  // GB9\n  [CodepointType.Any, CodepointType.Extend | CodepointType.ZWJ],\n  // GB9a\n  [CodepointType.Any, CodepointType.SpacingMark],\n  // GB9b\n  [CodepointType.Prepend, CodepointType.Any],\n  // GB11\n  [CodepointType.ZWJ, CodepointType.ExtPict],\n  // GB12 and GB13\n  [CodepointType.RI, CodepointType.RI],\n]\n\nfunction isBoundaryPair(left: CodepointType, right: CodepointType) {\n  return (\n    NonBoundaryPairs.findIndex(\n      r => intersects(left, r[0]) && intersects(right, r[1])\n    ) === -1\n  )\n}\n\nconst endingEmojiZWJ = /\\p{ExtPict}[\\p{Gr_Ext}\\p{EMod}]*\\u200D$/u\nconst endsWithEmojiZWJ = (str: string): boolean => {\n  return str.search(endingEmojiZWJ) !== -1\n}\n\nconst endingRIs = /\\p{RI}+$/gu\nconst endsWithOddNumberOfRIs = (str: string): boolean => {\n  const match = str.match(endingRIs)\n  if (match === null) {\n    return false\n  } else {\n    // A RI is represented by a surrogate pair.\n    const numRIs = match[0].length / 2\n    return numRIs % 2 === 1\n  }\n}\n", "import { Editor, Location, Node, Path, Range, Transforms } from '../../index'\nimport { TextUnit } from '../../types/types'\nimport { getDefaultInsertLocation } from '../../utils'\n\nexport interface TextDeleteOptions {\n  at?: Location\n  distance?: number\n  unit?: TextUnit\n  reverse?: boolean\n  hanging?: boolean\n  voids?: boolean\n}\n\nexport interface TextInsertFragmentOptions {\n  at?: Location\n  hanging?: boolean\n  voids?: boolean\n  batchDirty?: boolean\n}\n\nexport interface TextInsertTextOptions {\n  at?: Location\n  voids?: boolean\n}\n\nexport interface TextTransforms {\n  /**\n   * Delete content in the editor.\n   */\n  delete: (editor: Editor, options?: TextDeleteOptions) => void\n\n  /**\n   * Insert a fragment in the editor\n   * at the specified location or (if not defined) the current selection or (if not defined) the end of the document.\n   */\n  insertFragment: (\n    editor: Editor,\n    fragment: Node[],\n    options?: TextInsertFragmentOptions\n  ) => void\n\n  /**\n   * Insert a string of text in the editor\n   * at the specified location or (if not defined) the current selection or (if not defined) the end of the document.\n   */\n  insertText: (\n    editor: Editor,\n    text: string,\n    options?: TextInsertTextOptions\n  ) => void\n}\n\n// eslint-disable-next-line no-redeclare\nexport const TextTransforms: TextTransforms = {\n  delete(editor, options) {\n    editor.delete(options)\n  },\n  insertFragment(editor, fragment, options) {\n    editor.insertFragment(fragment, options)\n  },\n  insertText(\n    editor: Editor,\n    text: string,\n    options: TextInsertTextOptions = {}\n  ): void {\n    Editor.withoutNormalizing(editor, () => {\n      const { voids = false } = options\n      let { at = getDefaultInsertLocation(editor) } = options\n\n      if (Path.isPath(at)) {\n        at = Editor.range(editor, at)\n      }\n\n      if (Range.isRange(at)) {\n        if (Range.isCollapsed(at)) {\n          at = at.anchor\n        } else {\n          const end = Range.end(at)\n          if (!voids && Editor.void(editor, { at: end })) {\n            return\n          }\n          const start = Range.start(at)\n          const startRef = Editor.pointRef(editor, start)\n          const endRef = Editor.pointRef(editor, end)\n          Transforms.delete(editor, { at, voids })\n          const startPoint = startRef.unref()\n          const endPoint = endRef.unref()\n\n          at = startPoint || endPoint!\n          Transforms.setSelection(editor, { anchor: at, focus: at })\n        }\n      }\n\n      if (\n        (!voids && Editor.void(editor, { at })) ||\n        Editor.elementReadOnly(editor, { at })\n      ) {\n        return\n      }\n\n      const { path, offset } = at\n      if (text.length > 0)\n        editor.apply({ type: 'insert_text', path, offset, text })\n    })\n  },\n}\n", "import { GeneralTransforms } from './general'\nimport { NodeTransforms } from './node'\nimport { SelectionTransforms } from './selection'\nimport { TextTransforms } from './text'\n\nexport const Transforms: GeneralTransforms &\n  NodeTransforms &\n  SelectionTransforms &\n  TextTransforms = {\n  ...GeneralTransforms,\n  ...NodeTransforms,\n  ...SelectionTransforms,\n  ...TextTransforms,\n}\n", "// perf\n\nimport { Editor } from '../interfaces/editor'\n\nconst BATCHING_DIRTY_PATHS: WeakMap<Editor, boolean> = new WeakMap()\n\nexport const isBatchingDirtyPaths = (editor: Editor) => {\n  return BATCHING_DIRTY_PATHS.get(editor) || false\n}\n\nexport const batchDirtyPaths = (\n  editor: Editor,\n  fn: () => void,\n  update: () => void\n) => {\n  const value = BATCHING_DIRTY_PATHS.get(editor) || false\n  BATCHING_DIRTY_PATHS.set(editor, true)\n  try {\n    fn()\n    update()\n  } finally {\n    BATCHING_DIRTY_PATHS.set(editor, value)\n  }\n}\n", "import { DIRTY_PATH_KEYS, DIRTY_PATHS } from '../utils/weak-maps'\nimport { Path } from '../interfaces/path'\nimport { Editor } from '../interfaces/editor'\n\n/**\n * update editor dirty paths\n *\n * @param newDirtyPaths: Path[]; new dirty paths\n * @param transform: (p: Path) => Path | null; how to transform existing dirty paths\n */\nexport function updateDirtyPaths(\n  editor: Editor,\n  newDirtyPaths: Path[],\n  transform?: (p: Path) => Path | null\n) {\n  const oldDirtyPaths = DIRTY_PATHS.get(editor) || []\n  const oldDirtyPathKeys = DIRTY_PATH_KEYS.get(editor) || new Set()\n  let dirtyPaths: Path[]\n  let dirtyPathKeys: Set<string>\n\n  const add = (path: Path | null) => {\n    if (path) {\n      const key = path.join(',')\n\n      if (!dirtyPathKeys.has(key)) {\n        dirtyPathKeys.add(key)\n        dirtyPaths.push(path)\n      }\n    }\n  }\n\n  if (transform) {\n    dirtyPaths = []\n    dirtyPathKeys = new Set()\n    for (const path of oldDirtyPaths) {\n      const newPath = transform(path)\n      add(newPath)\n    }\n  } else {\n    dirtyPaths = oldDirtyPaths\n    dirtyPathKeys = oldDirtyPathKeys\n  }\n\n  for (const path of newDirtyPaths) {\n    add(path)\n  }\n\n  DIRTY_PATHS.set(editor, dirtyPaths)\n  DIRTY_PATH_KEYS.set(editor, dirtyPathKeys)\n}\n", "import { PathRef } from '../interfaces/path-ref'\nimport { PointRef } from '../interfaces/point-ref'\nimport { RangeRef } from '../interfaces/range-ref'\nimport { FLUSHING } from '../utils/weak-maps'\nimport { Path } from '../interfaces/path'\nimport { Transforms } from '../interfaces/transforms'\nimport { WithEditorFirstArg } from '../utils/types'\nimport { Editor } from '../interfaces/editor'\nimport { isBatchingDirtyPaths } from './batch-dirty-paths'\nimport { updateDirtyPaths } from './update-dirty-paths'\n\nexport const apply: WithEditorFirstArg<Editor['apply']> = (editor, op) => {\n  for (const ref of Editor.pathRefs(editor)) {\n    PathRef.transform(ref, op)\n  }\n\n  for (const ref of Editor.pointRefs(editor)) {\n    PointRef.transform(ref, op)\n  }\n\n  for (const ref of Editor.rangeRefs(editor)) {\n    RangeRef.transform(ref, op)\n  }\n\n  // update dirty paths\n  if (!isBatchingDirtyPaths(editor)) {\n    const transform = Path.operationCanTransformPath(op)\n      ? (p: Path) => Path.transform(p, op)\n      : undefined\n    updateDirtyPaths(editor, editor.getDirtyPaths(op), transform)\n  }\n\n  Transforms.transform(editor, op)\n  editor.operations.push(op)\n  Editor.normalize(editor, {\n    operation: op,\n  })\n\n  // Clear any formats applied to the cursor if the selection changes.\n  if (op.type === 'set_selection') {\n    editor.marks = null\n  }\n\n  if (!FLUSHING.get(editor)) {\n    FLUSHING.set(editor, true)\n\n    Promise.resolve().then(() => {\n      FLUSHING.set(editor, false)\n      editor.onChange({ operation: op })\n      editor.operations = []\n    })\n  }\n}\n", "import { WithEditorFirstArg } from '../utils/types'\nimport { Path } from '../interfaces/path'\nimport { Text } from '../interfaces/text'\nimport { Node } from '../interfaces/node'\nimport { Editor } from '../interfaces/editor'\n\n/**\n * Get the \"dirty\" paths generated from an operation.\n */\nexport const getDirtyPaths: WithEditorFirstArg<Editor['getDirtyPaths']> = (\n  editor,\n  op\n) => {\n  switch (op.type) {\n    case 'insert_text':\n    case 'remove_text':\n    case 'set_node': {\n      const { path } = op\n      return Path.levels(path)\n    }\n\n    case 'insert_node': {\n      const { node, path } = op\n      const levels = Path.levels(path)\n      const descendants = Text.isText(node)\n        ? []\n        : Array.from(Node.nodes(node), ([, p]) => path.concat(p))\n\n      return [...levels, ...descendants]\n    }\n\n    case 'merge_node': {\n      const { path } = op\n      const ancestors = Path.ancestors(path)\n      const previousPath = Path.previous(path)\n      return [...ancestors, previousPath]\n    }\n\n    case 'move_node': {\n      const { path, newPath } = op\n\n      if (Path.equals(path, newPath)) {\n        return []\n      }\n\n      const oldAncestors: Path[] = []\n      const newAncestors: Path[] = []\n\n      for (const ancestor of Path.ancestors(path)) {\n        const p = Path.transform(ancestor, op)\n        oldAncestors.push(p!)\n      }\n\n      for (const ancestor of Path.ancestors(newPath)) {\n        const p = Path.transform(ancestor, op)\n        newAncestors.push(p!)\n      }\n\n      const newParent = newAncestors[newAncestors.length - 1]\n      const newIndex = newPath[newPath.length - 1]\n      const resultPath = newParent.concat(newIndex)\n\n      return [...oldAncestors, ...newAncestors, resultPath]\n    }\n\n    case 'remove_node': {\n      const { path } = op\n      const ancestors = Path.ancestors(path)\n      return [...ancestors]\n    }\n\n    case 'split_node': {\n      const { path } = op\n      const levels = Path.levels(path)\n      const nextPath = Path.next(path)\n      return [...levels, nextPath]\n    }\n\n    default: {\n      return []\n    }\n  }\n}\n", "import { Editor, Node } from '../interfaces'\nimport { WithEditorFirstArg } from '../utils'\n\nexport const getFragment: WithEditorFirstArg<\n  Editor['getFragment']\n> = editor => {\n  const { selection } = editor\n\n  if (selection) {\n    return Node.fragment(editor, selection)\n  }\n  return []\n}\n", "import { WithEditorFirstArg } from '../utils/types'\nimport { Text } from '../interfaces/text'\nimport { Element } from '../interfaces/element'\nimport { Transforms } from '../interfaces/transforms'\nimport { Descendant, Node } from '../interfaces/node'\nimport { Editor } from '../interfaces/editor'\n\nexport const normalizeNode: WithEditorFirstArg<Editor['normalizeNode']> = (\n  editor,\n  entry\n) => {\n  const [node, path] = entry\n\n  // There are no core normalizations for text nodes.\n  if (Text.isText(node)) {\n    return\n  }\n\n  // Ensure that block and inline nodes have at least one text child.\n  if (Element.isElement(node) && node.children.length === 0) {\n    const child = { text: '' }\n    Transforms.insertNodes(editor, child, {\n      at: path.concat(0),\n      voids: true,\n    })\n    return\n  }\n\n  // Determine whether the node should have block or inline children.\n  const shouldHaveInlines = Editor.isEditor(node)\n    ? false\n    : Element.isElement(node) &&\n      (editor.isInline(node) ||\n        node.children.length === 0 ||\n        Text.isText(node.children[0]) ||\n        editor.isInline(node.children[0]))\n\n  // Since we'll be applying operations while iterating, keep track of an\n  // index that accounts for any added/removed nodes.\n  let n = 0\n\n  for (let i = 0; i < node.children.length; i++, n++) {\n    const currentNode = Node.get(editor, path)\n    if (Text.isText(currentNode)) continue\n    const child = currentNode.children[n] as Descendant\n    const prev = currentNode.children[n - 1] as Descendant\n    const isLast = i === node.children.length - 1\n    const isInlineOrText =\n      Text.isText(child) || (Element.isElement(child) && editor.isInline(child))\n\n    // Only allow block nodes in the top-level children and parent blocks\n    // that only contain block nodes. Similarly, only allow inline nodes in\n    // other inline nodes, or parent blocks that only contain inlines and\n    // text.\n    if (isInlineOrText !== shouldHaveInlines) {\n      Transforms.removeNodes(editor, { at: path.concat(n), voids: true })\n      n--\n    } else if (Element.isElement(child)) {\n      // Ensure that inline nodes are surrounded by text nodes.\n      if (editor.isInline(child)) {\n        if (prev == null || !Text.isText(prev)) {\n          const newChild = { text: '' }\n          Transforms.insertNodes(editor, newChild, {\n            at: path.concat(n),\n            voids: true,\n          })\n          n++\n        } else if (isLast) {\n          const newChild = { text: '' }\n          Transforms.insertNodes(editor, newChild, {\n            at: path.concat(n + 1),\n            voids: true,\n          })\n          n++\n        }\n      }\n    } else {\n      // If the child is not a text node, and doesn't have a `children` field,\n      // then we have an invalid node that will upset slate.\n      //\n      // eg: `{ type: 'some_node' }`.\n      //\n      // To prevent slate from breaking, we can add the `children` field,\n      // and now that it is valid, we can to many more operations easily,\n      // such as extend normalizers to fix erronous structure.\n      if (!Text.isText(child) && !('children' in child)) {\n        const elementChild = child as Element\n        elementChild.children = []\n      }\n\n      // Merge adjacent text nodes that are empty or match.\n      if (prev != null && Text.isText(prev)) {\n        if (Text.equals(child, prev, { loose: true })) {\n          Transforms.mergeNodes(editor, { at: path.concat(n), voids: true })\n          n--\n        } else if (prev.text === '') {\n          Transforms.removeNodes(editor, {\n            at: path.concat(n - 1),\n            voids: true,\n          })\n          n--\n        } else if (child.text === '') {\n          Transforms.removeNodes(editor, {\n            at: path.concat(n),\n            voids: true,\n          })\n          n--\n        }\n      }\n    }\n  }\n}\n", "import { WithEditorFirstArg } from '../utils/types'\nimport { Editor } from '../interfaces/editor'\n\nexport const shouldNormalize: WithEditorFirstArg<Editor['shouldNormalize']> = (\n  editor,\n  { iteration, initialDirtyPathsLength }\n) => {\n  const maxIterations = initialDirtyPathsLength * 42 // HACK: better way?\n\n  if (iteration > maxIterations) {\n    throw new Error(\n      `Could not completely normalize the editor after ${maxIterations} iterations! This is usually due to incorrect normalization logic that leaves a node in an invalid state.`\n    )\n  }\n\n  return true\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Text } from '../interfaces/text'\nimport { Range } from '../interfaces/range'\nimport { Path } from '../interfaces/path'\n\nexport const above: EditorInterface['above'] = (editor, options = {}) => {\n  const {\n    voids = false,\n    mode = 'lowest',\n    at = editor.selection,\n    match,\n  } = options\n\n  if (!at) {\n    return\n  }\n\n  const path = Editor.path(editor, at)\n  const reverse = mode === 'lowest'\n\n  for (const [n, p] of Editor.levels(editor, {\n    at: path,\n    voids,\n    match,\n    reverse,\n  })) {\n    if (Text.isText(n)) continue\n    if (Range.isRange(at)) {\n      if (\n        Path.isAncestor(p, at.anchor.path) &&\n        Path.isAncestor(p, at.focus.path)\n      ) {\n        return [n, p]\n      }\n    } else {\n      if (!Path.equals(path, p)) {\n        return [n, p]\n      }\n    }\n  }\n}\n", "import { Node } from '../interfaces/node'\nimport { Path } from '../interfaces/path'\nimport { Text } from '../interfaces/text'\nimport { Range } from '../interfaces/range'\nimport { Transforms } from '../interfaces/transforms'\nimport { FLUSHING } from '../utils/weak-maps'\nimport { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const addMark: EditorInterface['addMark'] = (editor, key, value) => {\n  const { selection } = editor\n\n  if (selection) {\n    const match = (node: Node, path: Path) => {\n      if (!Text.isText(node)) {\n        return false // marks can only be applied to text\n      }\n      const [parentNode, parentPath] = Editor.parent(editor, path)\n      return !editor.isVoid(parentNode) || editor.markableVoid(parentNode)\n    }\n    const expandedSelection = Range.isExpanded(selection)\n    let markAcceptingVoidSelected = false\n    if (!expandedSelection) {\n      const [selectedNode, selectedPath] = Editor.node(editor, selection)\n      if (selectedNode && match(selectedNode, selectedPath)) {\n        const [parentNode] = Editor.parent(editor, selectedPath)\n        markAcceptingVoidSelected =\n          parentNode && editor.markableVoid(parentNode)\n      }\n    }\n    if (expandedSelection || markAcceptingVoidSelected) {\n      Transforms.setNodes(\n        editor,\n        { [key]: value },\n        {\n          match,\n          split: true,\n          voids: true,\n        }\n      )\n    } else {\n      const marks = {\n        ...(Editor.marks(editor) || {}),\n        [key]: value,\n      }\n\n      editor.marks = marks\n      if (!FLUSHING.get(editor)) {\n        editor.onChange()\n      }\n    }\n  }\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const after: EditorInterface['after'] = (editor, at, options = {}) => {\n  const anchor = Editor.point(editor, at, { edge: 'end' })\n  const focus = Editor.end(editor, [])\n  const range = { anchor, focus }\n  const { distance = 1 } = options\n  let d = 0\n  let target\n\n  for (const p of Editor.positions(editor, {\n    ...options,\n    at: range,\n  })) {\n    if (d > distance) {\n      break\n    }\n\n    if (d !== 0) {\n      target = p\n    }\n\n    d++\n  }\n\n  return target\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const before: EditorInterface['before'] = (editor, at, options = {}) => {\n  const anchor = Editor.start(editor, [])\n  const focus = Editor.point(editor, at, { edge: 'start' })\n  const range = { anchor, focus }\n  const { distance = 1 } = options\n  let d = 0\n  let target\n\n  for (const p of Editor.positions(editor, {\n    ...options,\n    at: range,\n    reverse: true,\n  })) {\n    if (d > distance) {\n      break\n    }\n\n    if (d !== 0) {\n      target = p\n    }\n\n    d++\n  }\n\n  return target\n}\n", "import { Editor } from '../interfaces/editor'\nimport { Transforms } from '../interfaces/transforms'\nimport { Range } from '../interfaces/range'\nimport { WithEditorFirstArg } from '../utils/types'\n\nexport const deleteBackward: WithEditorFirstArg<Editor['deleteBackward']> = (\n  editor,\n  unit\n) => {\n  const { selection } = editor\n\n  if (selection && Range.isCollapsed(selection)) {\n    Transforms.delete(editor, { unit, reverse: true })\n  }\n}\n", "import { Editor } from '../interfaces/editor'\nimport { Transforms } from '../interfaces/transforms'\nimport { Range } from '../interfaces/range'\nimport { WithEditorFirstArg } from '../utils/types'\n\nexport const deleteForward: WithEditorFirstArg<Editor['deleteForward']> = (\n  editor,\n  unit\n) => {\n  const { selection } = editor\n\n  if (selection && Range.isCollapsed(selection)) {\n    Transforms.delete(editor, { unit })\n  }\n}\n", "import { Range } from '../interfaces/range'\nimport { Transforms } from '../interfaces/transforms'\nimport { EditorInterface } from '../interfaces/editor'\n\nexport const deleteFragment: EditorInterface['deleteFragment'] = (\n  editor,\n  { direction = 'forward' } = {}\n) => {\n  const { selection } = editor\n\n  if (selection && Range.isExpanded(selection)) {\n    Transforms.delete(editor, { reverse: direction === 'backward' })\n  }\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const edges: EditorInterface['edges'] = (editor, at) => {\n  return [Editor.start(editor, at), Editor.end(editor, at)]\n}\n", "import { Element } from '../interfaces/element'\nimport { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const elementReadOnly: EditorInterface['elementReadOnly'] = (\n  editor,\n  options = {}\n) => {\n  return Editor.above(editor, {\n    ...options,\n    match: n => Element.isElement(n) && Editor.isElementReadOnly(editor, n),\n  })\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const end: EditorInterface['end'] = (editor, at) => {\n  return Editor.point(editor, at, { edge: 'end' })\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const first: EditorInterface['first'] = (editor, at) => {\n  const path = Editor.path(editor, at, { edge: 'start' })\n  return Editor.node(editor, path)\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Node } from '../interfaces/node'\n\nexport const fragment: EditorInterface['fragment'] = (editor, at) => {\n  const range = Editor.range(editor, at)\n  return Node.fragment(editor, range)\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Element } from '../interfaces/element'\n\nexport const getVoid: EditorInterface['void'] = (editor, options = {}) => {\n  return Editor.above(editor, {\n    ...options,\n    match: n => Element.isElement(n) && Editor.isVoid(editor, n),\n  })\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Element } from '../interfaces/element'\n\nexport const hasBlocks: EditorInterface['hasBlocks'] = (editor, element) => {\n  return element.children.some(\n    n => Element.isElement(n) && Editor.isBlock(editor, n)\n  )\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Text } from '../interfaces/text'\n\nexport const hasInlines: EditorInterface['hasInlines'] = (editor, element) => {\n  return element.children.some(\n    n => Text.isText(n) || Editor.isInline(editor, n)\n  )\n}\n", "import { EditorInterface } from '../interfaces/editor'\nimport { Node } from '../interfaces/node'\n\nexport const hasPath: EditorInterface['hasPath'] = (editor, path) => {\n  return Node.has(editor, path)\n}\n", "import { EditorInterface } from '../interfaces/editor'\nimport { Text } from '../interfaces/text'\n\nexport const hasTexts: EditorInterface['hasTexts'] = (editor, element) => {\n  return element.children.every(n => Text.isText(n))\n}\n", "import { Transforms } from '../interfaces/transforms'\nimport { EditorInterface } from '../interfaces/editor'\n\nexport const insertBreak: EditorInterface['insertBreak'] = editor => {\n  Transforms.splitNodes(editor, { always: true })\n}\n", "import { Transforms } from '../interfaces/transforms'\nimport { EditorInterface } from '../interfaces/editor'\n\nexport const insertNode: EditorInterface['insertNode'] = (\n  editor,\n  node,\n  options\n) => {\n  Transforms.insertNodes(editor, node, options)\n}\n", "import { Transforms } from '../interfaces/transforms'\nimport { EditorInterface } from '../interfaces/editor'\n\nexport const insertSoftBreak: EditorInterface['insertSoftBreak'] = editor => {\n  Transforms.splitNodes(editor, { always: true })\n}\n", "import { Transforms } from '../interfaces/transforms'\nimport { EditorInterface } from '../interfaces/editor'\n\nexport const insertText: EditorInterface['insertText'] = (\n  editor,\n  text,\n  options = {}\n) => {\n  const { selection, marks } = editor\n\n  if (selection) {\n    if (marks) {\n      const node = { text, ...marks }\n      Transforms.insertNodes(editor, node, {\n        at: options.at,\n        voids: options.voids,\n      })\n    } else {\n      Transforms.insertText(editor, text, options)\n    }\n\n    editor.marks = null\n  }\n}\n", "import { EditorInterface } from '../interfaces/editor'\n\nexport const isBlock: EditorInterface['isBlock'] = (editor, value) => {\n  return !editor.isInline(value)\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const isEdge: EditorInterface['isEdge'] = (editor, point, at) => {\n  return Editor.isStart(editor, point, at) || Editor.isEnd(editor, point, at)\n}\n", "import { EditorInterface } from '../interfaces/editor'\nimport { Text } from '../interfaces/text'\n\nexport const isEmpty: EditorInterface['isEmpty'] = (editor, element) => {\n  const { children } = element\n  const [first] = children\n  return (\n    children.length === 0 ||\n    (children.length === 1 &&\n      Text.isText(first) &&\n      first.text === '' &&\n      !editor.isVoid(element))\n  )\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Point } from '../interfaces/point'\n\nexport const isEnd: EditorInterface['isEnd'] = (editor, point, at) => {\n  const end = Editor.end(editor, at)\n  return Point.equals(point, end)\n}\n", "import { EditorInterface } from '../interfaces/editor'\nimport { NORMALIZING } from '../utils/weak-maps'\n\nexport const isNormalizing: EditorInterface['isNormalizing'] = editor => {\n  const isNormalizing = NORMALIZING.get(editor)\n  return isNormalizing === undefined ? true : isNormalizing\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Point } from '../interfaces/point'\n\nexport const isStart: EditorInterface['isStart'] = (editor, point, at) => {\n  // PERF: If the offset isn't `0` we know it's not the start.\n  if (point.offset !== 0) {\n    return false\n  }\n\n  const start = Editor.start(editor, at)\n  return Point.equals(point, start)\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const last: EditorInterface['last'] = (editor, at) => {\n  const path = Editor.path(editor, at, { edge: 'end' })\n  return Editor.node(editor, path)\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Node } from '../interfaces/node'\n\nexport const leaf: EditorInterface['leaf'] = (editor, at, options = {}) => {\n  const path = Editor.path(editor, at, options)\n  const node = Node.leaf(editor, path)\n  return [node, path]\n}\n", "import { Node, NodeEntry } from '../interfaces/node'\nimport { Editor, EditorLevelsOptions } from '../interfaces/editor'\nimport { Element } from '../interfaces/element'\n\nexport function* levels<T extends Node>(\n  editor: Editor,\n  options: EditorLevelsOptions<T> = {}\n): Generator<NodeEntry<T>, void, undefined> {\n  const { at = editor.selection, reverse = false, voids = false } = options\n  let { match } = options\n\n  if (match == null) {\n    match = () => true\n  }\n\n  if (!at) {\n    return\n  }\n\n  const levels: NodeEntry<T>[] = []\n  const path = Editor.path(editor, at)\n\n  for (const [n, p] of Node.levels(editor, path)) {\n    if (!match(n, p)) {\n      continue\n    }\n\n    levels.push([n, p] as NodeEntry<T>)\n\n    if (!voids && Element.isElement(n) && Editor.isVoid(editor, n)) {\n      break\n    }\n  }\n\n  if (reverse) {\n    levels.reverse()\n  }\n\n  yield* levels\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { NodeEntry } from '../interfaces/node'\nimport { Range } from '../interfaces/range'\nimport { Path } from '../interfaces/path'\nimport { Text } from '../interfaces/text'\nimport { Element } from '../interfaces/element'\nimport { Point } from '../interfaces'\n\nexport const marks: EditorInterface['marks'] = (editor, options = {}) => {\n  const { marks, selection } = editor\n\n  if (!selection) {\n    return null\n  }\n  let { anchor, focus } = selection\n\n  if (marks) {\n    return marks\n  }\n\n  if (Range.isExpanded(selection)) {\n    const isBackward = Range.isBackward(selection)\n    if (isBackward) {\n      ;[focus, anchor] = [anchor, focus]\n    }\n    /**\n     * COMPAT: Make sure hanging ranges (caused by double clicking in Firefox)\n     * do not adversely affect the returned marks.\n     */\n    const isEnd = Editor.isEnd(editor, anchor, anchor.path)\n    if (isEnd) {\n      const after = Editor.after(editor, anchor as Point)\n      if (after) {\n        anchor = after\n      }\n    }\n\n    const [match] = Editor.nodes(editor, {\n      match: Text.isText,\n      at: {\n        anchor,\n        focus,\n      },\n    })\n\n    if (match) {\n      const [node] = match as NodeEntry<Text>\n      const { text, ...rest } = node\n      return rest\n    } else {\n      return {}\n    }\n  }\n\n  const { path } = anchor\n\n  let [node] = Editor.leaf(editor, path)\n\n  if (anchor.offset === 0) {\n    const prev = Editor.previous(editor, { at: path, match: Text.isText })\n    const markedVoid = Editor.above(editor, {\n      match: n =>\n        Element.isElement(n) &&\n        Editor.isVoid(editor, n) &&\n        editor.markableVoid(n),\n    })\n    if (!markedVoid) {\n      const block = Editor.above(editor, {\n        match: n => Element.isElement(n) && Editor.isBlock(editor, n),\n      })\n\n      if (prev && block) {\n        const [prevNode, prevPath] = prev\n        const [, blockPath] = block\n\n        if (Path.isAncestor(blockPath, prevPath)) {\n          node = prevNode as Text\n        }\n      }\n    }\n  }\n\n  const { text, ...rest } = node\n  return rest\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Span } from '../interfaces/location'\nimport { Path } from '../interfaces/path'\n\nexport const next: EditorInterface['next'] = (editor, options = {}) => {\n  const { mode = 'lowest', voids = false } = options\n  let { match, at = editor.selection } = options\n\n  if (!at) {\n    return\n  }\n\n  const pointAfterLocation = Editor.after(editor, at, { voids })\n\n  if (!pointAfterLocation) return\n\n  const [, to] = Editor.last(editor, [])\n\n  const span: Span = [pointAfterLocation.path, to]\n\n  if (Path.isPath(at) && at.length === 0) {\n    throw new Error(`Cannot get the next node from the root node!`)\n  }\n\n  if (match == null) {\n    if (Path.isPath(at)) {\n      const [parent] = Editor.parent(editor, at)\n      match = n => parent.children.includes(n)\n    } else {\n      match = () => true\n    }\n  }\n\n  const [next] = Editor.nodes(editor, { at: span, match, mode, voids })\n  return next\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Node } from '../interfaces/node'\n\nexport const node: EditorInterface['node'] = (editor, at, options = {}) => {\n  const path = Editor.path(editor, at, options)\n  const node = Node.get(editor, path)\n  return [node, path]\n}\n", "import { Node, NodeEntry } from '../interfaces/node'\nimport { Editor, EditorNodesOptions } from '../interfaces/editor'\nimport { Span } from '../interfaces/location'\nimport { Element } from '../interfaces/element'\nimport { Path } from '../interfaces/path'\nimport { Text } from '../interfaces/text'\n\nexport function* nodes<T extends Node>(\n  editor: Editor,\n  options: EditorNodesOptions<T> = {}\n): Generator<NodeEntry<T>, void, undefined> {\n  const {\n    at = editor.selection,\n    mode = 'all',\n    universal = false,\n    reverse = false,\n    voids = false,\n    ignoreNonSelectable = false,\n  } = options\n  let { match } = options\n\n  if (!match) {\n    match = () => true\n  }\n\n  if (!at) {\n    return\n  }\n\n  let from\n  let to\n\n  if (Span.isSpan(at)) {\n    from = at[0]\n    to = at[1]\n  } else {\n    const first = Editor.path(editor, at, { edge: 'start' })\n    const last = Editor.path(editor, at, { edge: 'end' })\n    from = reverse ? last : first\n    to = reverse ? first : last\n  }\n\n  const nodeEntries = Node.nodes(editor, {\n    reverse,\n    from,\n    to,\n    pass: ([node]) => {\n      if (!Element.isElement(node)) return false\n      if (\n        !voids &&\n        (Editor.isVoid(editor, node) || Editor.isElementReadOnly(editor, node))\n      )\n        return true\n      if (ignoreNonSelectable && !Editor.isSelectable(editor, node)) return true\n      return false\n    },\n  })\n\n  const matches: NodeEntry<T>[] = []\n  let hit: NodeEntry<T> | undefined\n\n  for (const [node, path] of nodeEntries) {\n    if (\n      ignoreNonSelectable &&\n      Element.isElement(node) &&\n      !Editor.isSelectable(editor, node)\n    ) {\n      continue\n    }\n\n    const isLower = hit && Path.compare(path, hit[1]) === 0\n\n    // In highest mode any node lower than the last hit is not a match.\n    if (mode === 'highest' && isLower) {\n      continue\n    }\n\n    if (!match(node, path)) {\n      // If we've arrived at a leaf text node that is not lower than the last\n      // hit, then we've found a branch that doesn't include a match, which\n      // means the match is not universal.\n      if (universal && !isLower && Text.isText(node)) {\n        return\n      } else {\n        continue\n      }\n    }\n\n    // If there's a match and it's lower than the last, update the hit.\n    if (mode === 'lowest' && isLower) {\n      hit = [node, path] as NodeEntry<T>\n      continue\n    }\n\n    // In lowest mode we emit the last hit, once it's guaranteed lowest.\n    const emit: NodeEntry<T> | undefined =\n      mode === 'lowest' ? hit : ([node, path] as NodeEntry<T>)\n\n    if (emit) {\n      if (universal) {\n        matches.push(emit)\n      } else {\n        yield emit\n      }\n    }\n\n    hit = [node, path] as NodeEntry<T>\n  }\n\n  // Since lowest is always emitting one behind, catch up at the end.\n  if (mode === 'lowest' && hit) {\n    if (universal) {\n      matches.push(hit)\n    } else {\n      yield hit\n    }\n  }\n\n  // Universal defers to ensure that the match occurs in every branch, so we\n  // yield all of the matches after iterating.\n  if (universal) {\n    yield* matches\n  }\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { DIRTY_PATH_KEYS, DIRTY_PATHS } from '../utils/weak-maps'\nimport { Path } from '../interfaces/path'\nimport { Node } from '../interfaces/node'\nimport { Element } from '../interfaces/element'\n\nexport const normalize: EditorInterface['normalize'] = (\n  editor,\n  options = {}\n) => {\n  const { force = false, operation } = options\n  const getDirtyPaths = (editor: Editor) => {\n    return DIRTY_PATHS.get(editor) || []\n  }\n\n  const getDirtyPathKeys = (editor: Editor) => {\n    return DIRTY_PATH_KEYS.get(editor) || new Set()\n  }\n\n  const popDirtyPath = (editor: Editor): Path => {\n    const path = getDirtyPaths(editor).pop()!\n    const key = path.join(',')\n    getDirtyPathKeys(editor).delete(key)\n    return path\n  }\n\n  if (!Editor.isNormalizing(editor)) {\n    return\n  }\n\n  if (force) {\n    const allPaths = Array.from(Node.nodes(editor), ([, p]) => p)\n    const allPathKeys = new Set(allPaths.map(p => p.join(',')))\n    DIRTY_PATHS.set(editor, allPaths)\n    DIRTY_PATH_KEYS.set(editor, allPathKeys)\n  }\n\n  if (getDirtyPaths(editor).length === 0) {\n    return\n  }\n\n  Editor.withoutNormalizing(editor, () => {\n    /*\n      Fix dirty elements with no children.\n      editor.normalizeNode() does fix this, but some normalization fixes also require it to work.\n      Running an initial pass avoids the catch-22 race condition.\n    */\n    for (const dirtyPath of getDirtyPaths(editor)) {\n      if (Node.has(editor, dirtyPath)) {\n        const entry = Editor.node(editor, dirtyPath)\n        const [node, _] = entry\n\n        /*\n          The default normalizer inserts an empty text node in this scenario, but it can be customised.\n          So there is some risk here.\n\n          As long as the normalizer only inserts child nodes for this case it is safe to do in any order;\n          by definition adding children to an empty node can't cause other paths to change.\n        */\n        if (Element.isElement(node) && node.children.length === 0) {\n          editor.normalizeNode(entry, { operation })\n        }\n      }\n    }\n\n    let dirtyPaths = getDirtyPaths(editor)\n    const initialDirtyPathsLength = dirtyPaths.length\n    let iteration = 0\n\n    while (dirtyPaths.length !== 0) {\n      if (\n        !editor.shouldNormalize({\n          dirtyPaths,\n          iteration,\n          initialDirtyPathsLength,\n          operation,\n        })\n      ) {\n        return\n      }\n\n      const dirtyPath = popDirtyPath(editor)\n\n      // If the node doesn't exist in the tree, it does not need to be normalized.\n      if (Node.has(editor, dirtyPath)) {\n        const entry = Editor.node(editor, dirtyPath)\n        editor.normalizeNode(entry, { operation })\n      }\n      iteration++\n      dirtyPaths = getDirtyPaths(editor)\n    }\n  })\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { Ancestor, NodeEntry } from '../interfaces/node'\n\nexport const parent: EditorInterface['parent'] = (editor, at, options = {}) => {\n  const path = Editor.path(editor, at, options)\n  const parentPath = Path.parent(path)\n  const entry = Editor.node(editor, parentPath)\n  return entry as NodeEntry<Ancestor>\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { PathRef } from '../interfaces/path-ref'\n\nexport const pathRef: EditorInterface['pathRef'] = (\n  editor,\n  path,\n  options = {}\n) => {\n  const { affinity = 'forward' } = options\n  const ref: PathRef = {\n    current: path,\n    affinity,\n    unref() {\n      const { current } = ref\n      const pathRefs = Editor.pathRefs(editor)\n      pathRefs.delete(ref)\n      ref.current = null\n      return current\n    },\n  }\n\n  const refs = Editor.pathRefs(editor)\n  refs.add(ref)\n  return ref\n}\n", "import { EditorInterface } from '../interfaces/editor'\nimport { PATH_REFS } from '../utils/weak-maps'\n\nexport const pathRefs: EditorInterface['pathRefs'] = editor => {\n  let refs = PATH_REFS.get(editor)\n\n  if (!refs) {\n    refs = new Set()\n    PATH_REFS.set(editor, refs)\n  }\n\n  return refs\n}\n", "import { EditorInterface, Node, Path, Point, Range } from '../interfaces'\n\nexport const path: EditorInterface['path'] = (editor, at, options = {}) => {\n  const { depth, edge } = options\n\n  if (Path.isPath(at)) {\n    if (edge === 'start') {\n      const [, firstPath] = Node.first(editor, at)\n      at = firstPath\n    } else if (edge === 'end') {\n      const [, lastPath] = Node.last(editor, at)\n      at = lastPath\n    }\n  }\n\n  if (Range.isRange(at)) {\n    if (edge === 'start') {\n      at = Range.start(at)\n    } else if (edge === 'end') {\n      at = Range.end(at)\n    } else {\n      at = Path.common(at.anchor.path, at.focus.path)\n    }\n  }\n\n  if (Point.isPoint(at)) {\n    at = at.path\n  }\n\n  if (depth != null) {\n    at = at.slice(0, depth)\n  }\n\n  return at\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { PointRef } from '../interfaces/point-ref'\n\nexport const pointRef: EditorInterface['pointRef'] = (\n  editor,\n  point,\n  options = {}\n) => {\n  const { affinity = 'forward' } = options\n  const ref: PointRef = {\n    current: point,\n    affinity,\n    unref() {\n      const { current } = ref\n      const pointRefs = Editor.pointRefs(editor)\n      pointRefs.delete(ref)\n      ref.current = null\n      return current\n    },\n  }\n\n  const refs = Editor.pointRefs(editor)\n  refs.add(ref)\n  return ref\n}\n", "import { EditorInterface } from '../interfaces/editor'\nimport { POINT_REFS } from '../utils/weak-maps'\n\nexport const pointRefs: EditorInterface['pointRefs'] = editor => {\n  let refs = POINT_REFS.get(editor)\n\n  if (!refs) {\n    refs = new Set()\n    POINT_REFS.set(editor, refs)\n  }\n\n  return refs\n}\n", "import { EditorInterface } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { Node } from '../interfaces/node'\nimport { Text } from '../interfaces/text'\nimport { Range } from '../interfaces/range'\n\nexport const point: EditorInterface['point'] = (editor, at, options = {}) => {\n  const { edge = 'start' } = options\n\n  if (Path.isPath(at)) {\n    let path\n\n    if (edge === 'end') {\n      const [, lastPath] = Node.last(editor, at)\n      path = lastPath\n    } else {\n      const [, firstPath] = Node.first(editor, at)\n      path = firstPath\n    }\n\n    const node = Node.get(editor, path)\n\n    if (!Text.isText(node)) {\n      throw new Error(\n        `Cannot get the ${edge} point in the node at path [${at}] because it has no ${edge} text node.`\n      )\n    }\n\n    return { path, offset: edge === 'end' ? node.text.length : 0 }\n  }\n\n  if (Range.isRange(at)) {\n    const [start, end] = Range.edges(at)\n    return edge === 'start' ? start : end\n  }\n\n  return at\n}\n", "import { Editor, EditorPositionsOptions } from '../interfaces/editor'\nimport { Point } from '../interfaces/point'\nimport { Range } from '../interfaces/range'\nimport { Element } from '../interfaces/element'\nimport { Path } from '../interfaces/path'\nimport { Text } from '../interfaces/text'\nimport {\n  getCharacterDistance,\n  getWordDistance,\n  splitByCharacterDistance,\n} from '../utils/string'\n\nexport function* positions(\n  editor: Editor,\n  options: EditorPositionsOptions = {}\n): Generator<Point, void, undefined> {\n  const {\n    at = editor.selection,\n    unit = 'offset',\n    reverse = false,\n    voids = false,\n    ignoreNonSelectable = false,\n  } = options\n\n  if (!at) {\n    return\n  }\n\n  /**\n   * Algorithm notes:\n   *\n   * Each step `distance` is dynamic depending on the underlying text\n   * and the `unit` specified.  Each step, e.g., a line or word, may\n   * span multiple text nodes, so we iterate through the text both on\n   * two levels in step-sync:\n   *\n   * `leafText` stores the text on a text leaf level, and is advanced\n   * through using the counters `leafTextOffset` and `leafTextRemaining`.\n   *\n   * `blockText` stores the text on a block level, and is shortened\n   * by `distance` every time it is advanced.\n   *\n   * We only maintain a window of one blockText and one leafText because\n   * a block node always appears before all of its leaf nodes.\n   */\n\n  const range = Editor.range(editor, at)\n  const [start, end] = Range.edges(range)\n  const first = reverse ? end : start\n  let isNewBlock = false\n  let blockText = ''\n  let distance = 0 // Distance for leafText to catch up to blockText.\n  let leafTextRemaining = 0\n  let leafTextOffset = 0\n\n  // Iterate through all nodes in range, grabbing entire textual content\n  // of block nodes in blockText, and text nodes in leafText.\n  // Exploits the fact that nodes are sequenced in such a way that we first\n  // encounter the block node, then all of its text nodes, so when iterating\n  // through the blockText and leafText we just need to remember a window of\n  // one block node and leaf node, respectively.\n  for (const [node, path] of Editor.nodes(editor, {\n    at,\n    reverse,\n    voids,\n    ignoreNonSelectable,\n  })) {\n    /*\n     * ELEMENT NODE - Yield position(s) for voids, collect blockText for blocks\n     */\n    if (Element.isElement(node)) {\n      // Void nodes are a special case, so by default we will always\n      // yield their first point. If the `voids` option is set to true,\n      // then we will iterate over their content.\n      if (!voids && (editor.isVoid(node) || editor.isElementReadOnly(node))) {\n        yield Editor.start(editor, path)\n        continue\n      }\n\n      // Inline element nodes are ignored as they don't themselves\n      // contribute to `blockText` or `leafText` - their parent and\n      // children do.\n      if (editor.isInline(node)) continue\n\n      // Block element node - set `blockText` to its text content.\n      if (Editor.hasInlines(editor, node)) {\n        // We always exhaust block nodes before encountering a new one:\n        //   console.assert(blockText === '',\n        //     `blockText='${blockText}' - `+\n        //     `not exhausted before new block node`, path)\n\n        // Ensure range considered is capped to `range`, in the\n        // start/end edge cases where block extends beyond range.\n        // Equivalent to this, but presumably more performant:\n        //   blockRange = Editor.range(editor, ...Editor.edges(editor, path))\n        //   blockRange = Range.intersection(range, blockRange) // intersect\n        //   blockText = Editor.string(editor, blockRange, { voids })\n        const e = Path.isAncestor(path, end.path)\n          ? end\n          : Editor.end(editor, path)\n        const s = Path.isAncestor(path, start.path)\n          ? start\n          : Editor.start(editor, path)\n\n        blockText = Editor.string(editor, { anchor: s, focus: e }, { voids })\n        isNewBlock = true\n      }\n    }\n\n    /*\n     * TEXT LEAF NODE - Iterate through text content, yielding\n     * positions every `distance` offset according to `unit`.\n     */\n    if (Text.isText(node)) {\n      const isFirst = Path.equals(path, first.path)\n\n      // Proof that we always exhaust text nodes before encountering a new one:\n      //   console.assert(leafTextRemaining <= 0,\n      //     `leafTextRemaining=${leafTextRemaining} - `+\n      //     `not exhausted before new leaf text node`, path)\n\n      // Reset `leafText` counters for new text node.\n      if (isFirst) {\n        leafTextRemaining = reverse\n          ? first.offset\n          : node.text.length - first.offset\n        leafTextOffset = first.offset // Works for reverse too.\n      } else {\n        leafTextRemaining = node.text.length\n        leafTextOffset = reverse ? leafTextRemaining : 0\n      }\n\n      // Yield position at the start of node (potentially).\n      if (isFirst || isNewBlock || unit === 'offset') {\n        yield { path, offset: leafTextOffset }\n        isNewBlock = false\n      }\n\n      // Yield positions every (dynamically calculated) `distance` offset.\n      while (true) {\n        // If `leafText` has caught up with `blockText` (distance=0),\n        // and if blockText is exhausted, break to get another block node,\n        // otherwise advance blockText forward by the new `distance`.\n        if (distance === 0) {\n          if (blockText === '') break\n          distance = calcDistance(blockText, unit, reverse)\n          // Split the string at the previously found distance and use the\n          // remaining string for the next iteration.\n          blockText = splitByCharacterDistance(blockText, distance, reverse)[1]\n        }\n\n        // Advance `leafText` by the current `distance`.\n        leafTextOffset = reverse\n          ? leafTextOffset - distance\n          : leafTextOffset + distance\n        leafTextRemaining = leafTextRemaining - distance\n\n        // If `leafText` is exhausted, break to get a new leaf node\n        // and set distance to the overflow amount, so we'll (maybe)\n        // catch up to blockText in the next leaf text node.\n        if (leafTextRemaining < 0) {\n          distance = -leafTextRemaining\n          break\n        }\n\n        // Successfully walked `distance` offsets through `leafText`\n        // to catch up with `blockText`, so we can reset `distance`\n        // and yield this position in this node.\n        distance = 0\n        yield { path, offset: leafTextOffset }\n      }\n    }\n  }\n  // Proof that upon completion, we've exahusted both leaf and block text:\n  //   console.assert(leafTextRemaining <= 0, \"leafText wasn't exhausted\")\n  //   console.assert(blockText === '', \"blockText wasn't exhausted\")\n\n  // Helper:\n  // Return the distance in offsets for a step of size `unit` on given string.\n  function calcDistance(text: string, unit: string, reverse?: boolean) {\n    if (unit === 'character') {\n      return getCharacterDistance(text, reverse)\n    } else if (unit === 'word') {\n      return getWordDistance(text, reverse)\n    } else if (unit === 'line' || unit === 'block') {\n      return text.length\n    }\n    return 1\n  }\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Span } from '../interfaces/location'\nimport { Path } from '../interfaces/path'\n\nexport const previous: EditorInterface['previous'] = (editor, options = {}) => {\n  const { mode = 'lowest', voids = false } = options\n  let { match, at = editor.selection } = options\n\n  if (!at) {\n    return\n  }\n\n  const pointBeforeLocation = Editor.before(editor, at, { voids })\n\n  if (!pointBeforeLocation) {\n    return\n  }\n\n  const [, to] = Editor.first(editor, [])\n\n  // The search location is from the start of the document to the path of\n  // the point before the location passed in\n  const span: Span = [pointBeforeLocation.path, to]\n\n  if (Path.isPath(at) && at.length === 0) {\n    throw new Error(`Cannot get the previous node from the root node!`)\n  }\n\n  if (match == null) {\n    if (Path.isPath(at)) {\n      const [parent] = Editor.parent(editor, at)\n      match = n => parent.children.includes(n)\n    } else {\n      match = () => true\n    }\n  }\n\n  const [previous] = Editor.nodes(editor, {\n    reverse: true,\n    at: span,\n    match,\n    mode,\n    voids,\n  })\n\n  return previous\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { RangeRef } from '../interfaces/range-ref'\n\nexport const rangeRef: EditorInterface['rangeRef'] = (\n  editor,\n  range,\n  options = {}\n) => {\n  const { affinity = 'forward' } = options\n  const ref: RangeRef = {\n    current: range,\n    affinity,\n    unref() {\n      const { current } = ref\n      const rangeRefs = Editor.rangeRefs(editor)\n      rangeRefs.delete(ref)\n      ref.current = null\n      return current\n    },\n  }\n\n  const refs = Editor.rangeRefs(editor)\n  refs.add(ref)\n  return ref\n}\n", "import { EditorInterface } from '../interfaces/editor'\nimport { RANGE_REFS } from '../utils/weak-maps'\n\nexport const rangeRefs: EditorInterface['rangeRefs'] = editor => {\n  let refs = RANGE_REFS.get(editor)\n\n  if (!refs) {\n    refs = new Set()\n    RANGE_REFS.set(editor, refs)\n  }\n\n  return refs\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Range } from '../interfaces/range'\n\nexport const range: EditorInterface['range'] = (editor, at, to) => {\n  if (Range.isRange(at) && !to) {\n    return at\n  }\n\n  const start = Editor.start(editor, at)\n  const end = Editor.end(editor, to || at)\n  return { anchor: start, focus: end }\n}\n", "import { Node } from '../interfaces/node'\nimport { Path } from '../interfaces/path'\nimport { Text } from '../interfaces/text'\nimport { Range } from '../interfaces/range'\nimport { Transforms } from '../interfaces/transforms'\nimport { FLUSHING } from '../utils/weak-maps'\nimport { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const removeMark: EditorInterface['removeMark'] = (editor, key) => {\n  const { selection } = editor\n\n  if (selection) {\n    const match = (node: Node, path: Path) => {\n      if (!Text.isText(node)) {\n        return false // marks can only be applied to text\n      }\n      const [parentNode, parentPath] = Editor.parent(editor, path)\n      return !editor.isVoid(parentNode) || editor.markableVoid(parentNode)\n    }\n    const expandedSelection = Range.isExpanded(selection)\n    let markAcceptingVoidSelected = false\n    if (!expandedSelection) {\n      const [selectedNode, selectedPath] = Editor.node(editor, selection)\n      if (selectedNode && match(selectedNode, selectedPath)) {\n        const [parentNode] = Editor.parent(editor, selectedPath)\n        markAcceptingVoidSelected =\n          parentNode && editor.markableVoid(parentNode)\n      }\n    }\n    if (expandedSelection || markAcceptingVoidSelected) {\n      Transforms.unsetNodes(editor, key, {\n        match,\n        split: true,\n        voids: true,\n      })\n    } else {\n      const marks = { ...(Editor.marks(editor) || {}) }\n      delete marks[<keyof Node>key]\n      editor.marks = marks\n      if (!FLUSHING.get(editor)) {\n        editor.onChange()\n      }\n    }\n  }\n}\n", "import { EditorInterface } from '../interfaces/editor'\nimport { NORMALIZING } from '../utils/weak-maps'\n\nexport const setNormalizing: EditorInterface['setNormalizing'] = (\n  editor,\n  isNormalizing\n) => {\n  NORMALIZING.set(editor, isNormalizing)\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const start: EditorInterface['start'] = (editor, at) => {\n  return Editor.point(editor, at, { edge: 'start' })\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Range } from '../interfaces/range'\nimport { Text } from '../interfaces/text'\nimport { Path } from '../interfaces/path'\n\nexport const string: EditorInterface['string'] = (editor, at, options = {}) => {\n  const { voids = false } = options\n  const range = Editor.range(editor, at)\n  const [start, end] = Range.edges(range)\n  let text = ''\n\n  for (const [node, path] of Editor.nodes(editor, {\n    at: range,\n    match: Text.isText,\n    voids,\n  })) {\n    let t = node.text\n\n    if (Path.equals(path, end.path)) {\n      t = t.slice(0, end.offset)\n    }\n\n    if (Path.equals(path, start.path)) {\n      t = t.slice(start.offset)\n    }\n\n    text += t\n  }\n\n  return text\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\nimport { Range } from '../interfaces/range'\nimport { Path } from '../interfaces/path'\nimport { Element } from '../interfaces/element'\nimport { Text } from '../interfaces/text'\n\nexport const unhangRange: EditorInterface['unhangRange'] = (\n  editor,\n  range,\n  options = {}\n) => {\n  const { voids = false } = options\n  let [start, end] = Range.edges(range)\n\n  // PERF: exit early if we can guarantee that the range isn't hanging.\n  if (\n    start.offset !== 0 ||\n    end.offset !== 0 ||\n    Range.isCollapsed(range) ||\n    Path.hasPrevious(end.path)\n  ) {\n    return range\n  }\n\n  const endBlock = Editor.above(editor, {\n    at: end,\n    match: n => Element.isElement(n) && Editor.isBlock(editor, n),\n    voids,\n  })\n  const blockPath = endBlock ? endBlock[1] : []\n  const first = Editor.start(editor, start)\n  const before = { anchor: first, focus: end }\n  let skip = true\n\n  for (const [node, path] of Editor.nodes(editor, {\n    at: before,\n    match: Text.isText,\n    reverse: true,\n    voids,\n  })) {\n    if (skip) {\n      skip = false\n      continue\n    }\n\n    if (node.text !== '' || Path.isBefore(path, blockPath)) {\n      end = { path, offset: node.text.length }\n      break\n    }\n  }\n\n  return { anchor: start, focus: end }\n}\n", "import { Editor, EditorInterface } from '../interfaces/editor'\n\nexport const withoutNormalizing: EditorInterface['withoutNormalizing'] = (\n  editor,\n  fn\n) => {\n  const value = Editor.isNormalizing(editor)\n  Editor.setNormalizing(editor, false)\n  try {\n    fn()\n  } finally {\n    Editor.setNormalizing(editor, value)\n  }\n  Editor.normalize(editor)\n}\n", "import { EditorInterface, Element, Editor, Text } from '../interfaces'\n\nexport const shouldMergeNodesRemovePrevNode: EditorInterface['shouldMergeNodesRemovePrevNode'] =\n  (editor, [prevNode, prevPath], [curNode, curNodePath]) => {\n    // If the target node that we're merging with is empty, remove it instead\n    // of merging the two. This is a common rich text editor behavior to\n    // prevent losing formatting when deleting entire nodes when you have a\n    // hanging selection.\n    // if prevNode is first child in parent,don't remove it.\n\n    return (\n      (Element.isElement(prevNode) && Editor.isEmpty(editor, prevNode)) ||\n      (Text.isText(prevNode) &&\n        prevNode.text === '' &&\n        prevPath[prevPath.length - 1] !== 0)\n    )\n  }\n", "import { TextTransforms } from '../interfaces/transforms/text'\nimport { Editor } from '../interfaces/editor'\nimport { Range } from '../interfaces/range'\nimport { Point } from '../interfaces/point'\nimport { Path } from '../interfaces/path'\nimport { Transforms } from '../interfaces/transforms'\nimport { Element } from '../interfaces/element'\nimport { NodeEntry } from '../interfaces/node'\n\nexport const deleteText: TextTransforms['delete'] = (editor, options = {}) => {\n  Editor.withoutNormalizing(editor, () => {\n    const {\n      reverse = false,\n      unit = 'character',\n      distance = 1,\n      voids = false,\n    } = options\n    let { at = editor.selection, hanging = false } = options\n\n    if (!at) {\n      return\n    }\n\n    let isCollapsed = false\n    if (Range.isRange(at) && Range.isCollapsed(at)) {\n      isCollapsed = true\n      at = at.anchor\n    }\n\n    if (Point.isPoint(at)) {\n      const furthestVoid = Editor.void(editor, { at, mode: 'highest' })\n\n      if (!voids && furthestVoid) {\n        const [, voidPath] = furthestVoid\n        at = voidPath\n      } else {\n        const opts = { unit, distance }\n        const target = reverse\n          ? Editor.before(editor, at, opts) || Editor.start(editor, [])\n          : Editor.after(editor, at, opts) || Editor.end(editor, [])\n        at = { anchor: at, focus: target }\n        hanging = true\n      }\n    }\n\n    if (Path.isPath(at)) {\n      Transforms.removeNodes(editor, { at, voids })\n      return\n    }\n\n    if (Range.isCollapsed(at)) {\n      return\n    }\n\n    if (!hanging) {\n      const [, end] = Range.edges(at)\n      const endOfDoc = Editor.end(editor, [])\n\n      if (!Point.equals(end, endOfDoc)) {\n        at = Editor.unhangRange(editor, at, { voids })\n      }\n    }\n\n    let [start, end] = Range.edges(at)\n    const startBlock = Editor.above(editor, {\n      match: n => Element.isElement(n) && Editor.isBlock(editor, n),\n      at: start,\n      voids,\n    })\n    const endBlock = Editor.above(editor, {\n      match: n => Element.isElement(n) && Editor.isBlock(editor, n),\n      at: end,\n      voids,\n    })\n    const isAcrossBlocks =\n      startBlock && endBlock && !Path.equals(startBlock[1], endBlock[1])\n    const isSingleText = Path.equals(start.path, end.path)\n    const startNonEditable = voids\n      ? null\n      : Editor.void(editor, { at: start, mode: 'highest' }) ??\n        Editor.elementReadOnly(editor, { at: start, mode: 'highest' })\n    const endNonEditable = voids\n      ? null\n      : Editor.void(editor, { at: end, mode: 'highest' }) ??\n        Editor.elementReadOnly(editor, { at: end, mode: 'highest' })\n\n    // If the start or end points are inside an inline void, nudge them out.\n    if (startNonEditable) {\n      const before = Editor.before(editor, start)\n\n      if (before && startBlock && Path.isAncestor(startBlock[1], before.path)) {\n        start = before\n      }\n    }\n\n    if (endNonEditable) {\n      const after = Editor.after(editor, end)\n\n      if (after && endBlock && Path.isAncestor(endBlock[1], after.path)) {\n        end = after\n      }\n    }\n\n    // Get the highest nodes that are completely inside the range, as well as\n    // the start and end nodes.\n    const matches: NodeEntry[] = []\n    let lastPath: Path | undefined\n\n    for (const entry of Editor.nodes(editor, { at, voids })) {\n      const [node, path] = entry\n\n      if (lastPath && Path.compare(path, lastPath) === 0) {\n        continue\n      }\n\n      if (\n        (!voids &&\n          Element.isElement(node) &&\n          (Editor.isVoid(editor, node) ||\n            Editor.isElementReadOnly(editor, node))) ||\n        (!Path.isCommon(path, start.path) && !Path.isCommon(path, end.path))\n      ) {\n        matches.push(entry)\n        lastPath = path\n      }\n    }\n\n    const pathRefs = Array.from(matches, ([, p]) => Editor.pathRef(editor, p))\n    const startRef = Editor.pointRef(editor, start)\n    const endRef = Editor.pointRef(editor, end)\n\n    let removedText = ''\n\n    if (!isSingleText && !startNonEditable) {\n      const point = startRef.current!\n      const [node] = Editor.leaf(editor, point)\n      const { path } = point\n      const { offset } = start\n      const text = node.text.slice(offset)\n      if (text.length > 0) {\n        editor.apply({ type: 'remove_text', path, offset, text })\n        removedText = text\n      }\n    }\n\n    pathRefs\n      .reverse()\n      .map(r => r.unref())\n      .filter((r): r is Path => r !== null)\n      .forEach(p => Transforms.removeNodes(editor, { at: p, voids }))\n\n    if (!endNonEditable) {\n      const point = endRef.current!\n      const [node] = Editor.leaf(editor, point)\n      const { path } = point\n      const offset = isSingleText ? start.offset : 0\n      const text = node.text.slice(offset, end.offset)\n      if (text.length > 0) {\n        editor.apply({ type: 'remove_text', path, offset, text })\n        removedText = text\n      }\n    }\n\n    if (!isSingleText && isAcrossBlocks && endRef.current && startRef.current) {\n      Transforms.mergeNodes(editor, {\n        at: endRef.current,\n        hanging: true,\n        voids,\n      })\n    }\n\n    // For Thai script, deleting N character(s) backward should delete\n    // N code point(s) instead of an entire grapheme cluster.\n    // Therefore, the remaining code points should be inserted back.\n    if (\n      isCollapsed &&\n      reverse &&\n      unit === 'character' &&\n      removedText.length > 1 &&\n      removedText.match(/[\\u0E00-\\u0E7F]+/)\n    ) {\n      Transforms.insertText(\n        editor,\n        removedText.slice(0, removedText.length - distance)\n      )\n    }\n\n    const startUnref = startRef.unref()\n    const endUnref = endRef.unref()\n    const point = reverse ? startUnref || endUnref : endUnref || startUnref\n\n    if (options.at == null && point) {\n      Transforms.select(editor, point)\n    }\n  })\n}\n", "import { Transforms } from '../interfaces/transforms'\nimport { Editor } from '../interfaces/editor'\nimport { Range } from '../interfaces/range'\nimport { Path } from '../interfaces/path'\nimport { Element } from '../interfaces/element'\nimport { Node, NodeEntry } from '../interfaces/node'\nimport { Text } from '../interfaces/text'\nimport { TextTransforms } from '../interfaces/transforms/text'\nimport { getDefaultInsertLocation } from '../utils'\n\nexport const insertFragment: TextTransforms['insertFragment'] = (\n  editor,\n  fragment,\n  options = {}\n) => {\n  Editor.withoutNormalizing(editor, () => {\n    const { hanging = false, voids = false } = options\n    let { at = getDefaultInsertLocation(editor), batchDirty = true } = options\n\n    if (!fragment.length) {\n      return\n    }\n\n    if (Range.isRange(at)) {\n      if (!hanging) {\n        at = Editor.unhangRange(editor, at, { voids })\n      }\n\n      if (Range.isCollapsed(at)) {\n        at = at.anchor\n      } else {\n        const [, end] = Range.edges(at)\n\n        if (!voids && Editor.void(editor, { at: end })) {\n          return\n        }\n\n        const pointRef = Editor.pointRef(editor, end)\n        Transforms.delete(editor, { at })\n        at = pointRef.unref()!\n      }\n    } else if (Path.isPath(at)) {\n      at = Editor.start(editor, at)\n    }\n\n    if (!voids && Editor.void(editor, { at })) {\n      return\n    }\n\n    // If the insert point is at the edge of an inline node, move it outside\n    // instead since it will need to be split otherwise.\n    const inlineElementMatch = Editor.above(editor, {\n      at,\n      match: n => Element.isElement(n) && Editor.isInline(editor, n),\n      mode: 'highest',\n      voids,\n    })\n\n    if (inlineElementMatch) {\n      const [, inlinePath] = inlineElementMatch\n\n      if (Editor.isEnd(editor, at, inlinePath)) {\n        const after = Editor.after(editor, inlinePath)!\n        at = after\n      } else if (Editor.isStart(editor, at, inlinePath)) {\n        const before = Editor.before(editor, inlinePath)!\n        at = before\n      }\n    }\n\n    const blockMatch = Editor.above(editor, {\n      match: n => Element.isElement(n) && Editor.isBlock(editor, n),\n      at,\n      voids,\n    })!\n    const [, blockPath] = blockMatch\n    const isBlockStart = Editor.isStart(editor, at, blockPath)\n    const isBlockEnd = Editor.isEnd(editor, at, blockPath)\n    const isBlockEmpty = isBlockStart && isBlockEnd\n    const mergeStart = !isBlockStart || (isBlockStart && isBlockEnd)\n    const mergeEnd = !isBlockEnd\n    const [, firstPath] = Node.first({ children: fragment }, [])\n    const [, lastPath] = Node.last({ children: fragment }, [])\n\n    const matches: NodeEntry[] = []\n    const matcher = ([n, p]: NodeEntry) => {\n      const isRoot = p.length === 0\n      if (isRoot) {\n        return false\n      }\n\n      if (isBlockEmpty) {\n        return true\n      }\n\n      if (\n        mergeStart &&\n        Path.isAncestor(p, firstPath) &&\n        Element.isElement(n) &&\n        !editor.isVoid(n) &&\n        !editor.isInline(n)\n      ) {\n        return false\n      }\n\n      if (\n        mergeEnd &&\n        Path.isAncestor(p, lastPath) &&\n        Element.isElement(n) &&\n        !editor.isVoid(n) &&\n        !editor.isInline(n)\n      ) {\n        return false\n      }\n\n      return true\n    }\n\n    for (const entry of Node.nodes({ children: fragment }, { pass: matcher })) {\n      if (matcher(entry)) {\n        matches.push(entry)\n      }\n    }\n\n    const starts = []\n    const middles = []\n    const ends = []\n    let starting = true\n    let hasBlocks = false\n\n    for (const [node] of matches) {\n      if (Element.isElement(node) && !editor.isInline(node)) {\n        starting = false\n        hasBlocks = true\n        middles.push(node)\n      } else if (starting) {\n        starts.push(node)\n      } else {\n        ends.push(node)\n      }\n    }\n\n    const [inlineMatch] = Editor.nodes(editor, {\n      at,\n      match: n => Text.isText(n) || Editor.isInline(editor, n),\n      mode: 'highest',\n      voids,\n    })!\n\n    const [, inlinePath] = inlineMatch\n    const isInlineStart = Editor.isStart(editor, at, inlinePath)\n    const isInlineEnd = Editor.isEnd(editor, at, inlinePath)\n\n    const middleRef = Editor.pathRef(\n      editor,\n      isBlockEnd && !ends.length ? Path.next(blockPath) : blockPath\n    )\n\n    const endRef = Editor.pathRef(\n      editor,\n      isInlineEnd ? Path.next(inlinePath) : inlinePath\n    )\n\n    Transforms.splitNodes(editor, {\n      at,\n      match: n =>\n        hasBlocks\n          ? Element.isElement(n) && Editor.isBlock(editor, n)\n          : Text.isText(n) || Editor.isInline(editor, n),\n      mode: hasBlocks ? 'lowest' : 'highest',\n      always:\n        hasBlocks &&\n        (!isBlockStart || starts.length > 0) &&\n        (!isBlockEnd || ends.length > 0),\n      voids,\n    })\n\n    const startRef = Editor.pathRef(\n      editor,\n      !isInlineStart || (isInlineStart && isInlineEnd)\n        ? Path.next(inlinePath)\n        : inlinePath\n    )\n\n    Transforms.insertNodes(editor, starts, {\n      at: startRef.current!,\n      match: n => Text.isText(n) || Editor.isInline(editor, n),\n      mode: 'highest',\n      voids,\n      batchDirty,\n    })\n\n    if (isBlockEmpty && !starts.length && middles.length && !ends.length) {\n      Transforms.delete(editor, { at: blockPath, voids })\n    }\n\n    Transforms.insertNodes(editor, middles, {\n      at: middleRef.current!,\n      match: n => Element.isElement(n) && Editor.isBlock(editor, n),\n      mode: 'lowest',\n      voids,\n      batchDirty,\n    })\n\n    Transforms.insertNodes(editor, ends, {\n      at: endRef.current!,\n      match: n => Text.isText(n) || Editor.isInline(editor, n),\n      mode: 'highest',\n      voids,\n      batchDirty,\n    })\n\n    if (!options.at) {\n      let path\n\n      if (ends.length > 0 && endRef.current) {\n        path = Path.previous(endRef.current)\n      } else if (middles.length > 0 && middleRef.current) {\n        path = Path.previous(middleRef.current)\n      } else if (startRef.current) {\n        path = Path.previous(startRef.current)\n      }\n\n      if (path) {\n        const end = Editor.end(editor, path)\n        Transforms.select(editor, end)\n      }\n    }\n\n    startRef.unref()\n    middleRef.unref()\n    endRef.unref()\n  })\n}\n", "import { SelectionTransforms } from '../interfaces/transforms/selection'\nimport { Transforms } from '../interfaces/transforms'\nimport { Range } from '../interfaces/range'\n\nexport const collapse: SelectionTransforms['collapse'] = (\n  editor,\n  options = {}\n) => {\n  const { edge = 'anchor' } = options\n  const { selection } = editor\n\n  if (!selection) {\n    return\n  } else if (edge === 'anchor') {\n    Transforms.select(editor, selection.anchor)\n  } else if (edge === 'focus') {\n    Transforms.select(editor, selection.focus)\n  } else if (edge === 'start') {\n    const [start] = Range.edges(selection)\n    Transforms.select(editor, start)\n  } else if (edge === 'end') {\n    const [, end] = Range.edges(selection)\n    Transforms.select(editor, end)\n  }\n}\n", "import { SelectionTransforms } from '../interfaces/transforms/selection'\n\nexport const deselect: SelectionTransforms['deselect'] = editor => {\n  const { selection } = editor\n\n  if (selection) {\n    editor.apply({\n      type: 'set_selection',\n      properties: selection,\n      newProperties: null,\n    })\n  }\n}\n", "import { SelectionTransforms } from '../interfaces/transforms/selection'\nimport { Range } from '../interfaces/range'\nimport { Editor } from '../interfaces/editor'\nimport { Transforms } from '../interfaces/transforms'\n\nexport const move: SelectionTransforms['move'] = (editor, options = {}) => {\n  const { selection } = editor\n  const { distance = 1, unit = 'character', reverse = false } = options\n  let { edge = null } = options\n\n  if (!selection) {\n    return\n  }\n\n  if (edge === 'start') {\n    edge = Range.isBackward(selection) ? 'focus' : 'anchor'\n  }\n\n  if (edge === 'end') {\n    edge = Range.isBackward(selection) ? 'anchor' : 'focus'\n  }\n\n  const { anchor, focus } = selection\n  const opts = { distance, unit, ignoreNonSelectable: true }\n  const props: Partial<Range> = {}\n\n  if (edge == null || edge === 'anchor') {\n    const point = reverse\n      ? Editor.before(editor, anchor, opts)\n      : Editor.after(editor, anchor, opts)\n\n    if (point) {\n      props.anchor = point\n    }\n  }\n\n  if (edge == null || edge === 'focus') {\n    const point = reverse\n      ? Editor.before(editor, focus, opts)\n      : Editor.after(editor, focus, opts)\n\n    if (point) {\n      props.focus = point\n    }\n  }\n\n  Transforms.setSelection(editor, props)\n}\n", "import { SelectionTransforms } from '../interfaces/transforms/selection'\nimport { Editor } from '../interfaces/editor'\nimport { Transforms } from '../interfaces/transforms'\nimport { Range } from '../interfaces/range'\nimport { Scrubber } from '../interfaces/scrubber'\n\nexport const select: SelectionTransforms['select'] = (editor, target) => {\n  const { selection } = editor\n  target = Editor.range(editor, target)\n\n  if (selection) {\n    Transforms.setSelection(editor, target)\n    return\n  }\n\n  if (!Range.isRange(target)) {\n    throw new Error(\n      `When setting the selection and the current selection is \\`null\\` you must provide at least an \\`anchor\\` and \\`focus\\`, but you passed: ${Scrubber.stringify(\n        target\n      )}`\n    )\n  }\n\n  editor.apply({\n    type: 'set_selection',\n    properties: selection,\n    newProperties: target,\n  })\n}\n", "import { SelectionTransforms } from '../interfaces/transforms/selection'\nimport { Range } from '../interfaces/range'\nimport { Transforms } from '../interfaces/transforms'\n\nexport const setPoint: SelectionTransforms['setPoint'] = (\n  editor,\n  props,\n  options = {}\n) => {\n  const { selection } = editor\n  let { edge = 'both' } = options\n\n  if (!selection) {\n    return\n  }\n\n  if (edge === 'start') {\n    edge = Range.isBackward(selection) ? 'focus' : 'anchor'\n  }\n\n  if (edge === 'end') {\n    edge = Range.isBackward(selection) ? 'anchor' : 'focus'\n  }\n\n  const { anchor, focus } = selection\n  const point = edge === 'anchor' ? anchor : focus\n\n  Transforms.setSelection(editor, {\n    [edge === 'anchor' ? 'anchor' : 'focus']: { ...point, ...props },\n  })\n}\n", "import { SelectionTransforms } from '../interfaces/transforms/selection'\nimport { Range } from '../interfaces/range'\nimport { Point } from '../interfaces/point'\n\nexport const setSelection: SelectionTransforms['setSelection'] = (\n  editor,\n  props\n) => {\n  const { selection } = editor\n  const oldProps: Partial<Range> | null = {}\n  const newProps: Partial<Range> = {}\n\n  if (!selection) {\n    return\n  }\n\n  for (const k in props) {\n    if (\n      (k === 'anchor' &&\n        props.anchor != null &&\n        !Point.equals(props.anchor, selection.anchor)) ||\n      (k === 'focus' &&\n        props.focus != null &&\n        !Point.equals(props.focus, selection.focus)) ||\n      (k !== 'anchor' &&\n        k !== 'focus' &&\n        props[<keyof Range>k] !== selection[<keyof Range>k])\n    ) {\n      oldProps[<keyof Range>k] = selection[<keyof Range>k]\n      newProps[<keyof Range>k] = props[<keyof Range>k]\n    }\n  }\n\n  if (Object.keys(oldProps).length > 0) {\n    editor.apply({\n      type: 'set_selection',\n      properties: oldProps,\n      newProperties: newProps,\n    })\n  }\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Editor } from '../interfaces/editor'\nimport { Node } from '../interfaces/node'\nimport { Range } from '../interfaces/range'\nimport { Transforms } from '../interfaces/transforms'\nimport { Point } from '../interfaces/point'\nimport { Text } from '../interfaces/text'\nimport { Element } from '../interfaces/element'\nimport { Path } from '../interfaces/path'\nimport { getDefaultInsertLocation } from '../utils'\nimport { batchDirtyPaths } from '../core/batch-dirty-paths'\nimport { BaseInsertNodeOperation } from '../interfaces'\nimport { updateDirtyPaths } from '../core/update-dirty-paths'\n\nexport const insertNodes: NodeTransforms['insertNodes'] = (\n  editor,\n  nodes,\n  options = {}\n) => {\n  Editor.withoutNormalizing(editor, () => {\n    const {\n      hanging = false,\n      voids = false,\n      mode = 'lowest',\n      batchDirty = true,\n    } = options\n    let { at, match, select } = options\n\n    if (Node.isNode(nodes)) {\n      nodes = [nodes]\n    }\n\n    if (nodes.length === 0) {\n      return\n    }\n\n    const [node] = nodes\n\n    if (!at) {\n      at = getDefaultInsertLocation(editor)\n      if (select !== false) {\n        select = true\n      }\n    }\n\n    if (select == null) {\n      select = false\n    }\n\n    if (Range.isRange(at)) {\n      if (!hanging) {\n        at = Editor.unhangRange(editor, at, { voids })\n      }\n\n      if (Range.isCollapsed(at)) {\n        at = at.anchor\n      } else {\n        const [, end] = Range.edges(at)\n        const pointRef = Editor.pointRef(editor, end)\n        Transforms.delete(editor, { at })\n        at = pointRef.unref()!\n      }\n    }\n\n    if (Point.isPoint(at)) {\n      if (match == null) {\n        if (Text.isText(node)) {\n          match = n => Text.isText(n)\n        } else if (editor.isInline(node)) {\n          match = n => Text.isText(n) || Editor.isInline(editor, n)\n        } else {\n          match = n => Element.isElement(n) && Editor.isBlock(editor, n)\n        }\n      }\n\n      const [entry] = Editor.nodes(editor, {\n        at: at.path,\n        match,\n        mode,\n        voids,\n      })\n\n      if (entry) {\n        const [, matchPath] = entry\n        const pathRef = Editor.pathRef(editor, matchPath)\n        const isAtEnd = Editor.isEnd(editor, at, matchPath)\n        Transforms.splitNodes(editor, { at, match, mode, voids })\n        const path = pathRef.unref()!\n        at = isAtEnd ? Path.next(path) : path\n      } else {\n        return\n      }\n    }\n\n    const parentPath = Path.parent(at)\n    let index = at[at.length - 1]\n\n    if (!voids && Editor.void(editor, { at: parentPath })) {\n      return\n    }\n\n    if (batchDirty) {\n      // PERF: batch update dirty paths\n      // batched ops used to transform existing dirty paths\n      const batchedOps: BaseInsertNodeOperation[] = []\n      const newDirtyPaths: Path[] = Path.levels(parentPath)\n      batchDirtyPaths(\n        editor,\n        () => {\n          for (const node of nodes as Node[]) {\n            const path = parentPath.concat(index)\n            index++\n\n            const op: BaseInsertNodeOperation = {\n              type: 'insert_node',\n              path,\n              node,\n            }\n            editor.apply(op)\n            at = Path.next(at as Path)\n\n            batchedOps.push(op)\n            if (!Text.isText) {\n              newDirtyPaths.push(path)\n            } else {\n              newDirtyPaths.push(\n                ...Array.from(Node.nodes(node), ([, p]) => path.concat(p))\n              )\n            }\n          }\n        },\n        () => {\n          updateDirtyPaths(editor, newDirtyPaths, p => {\n            let newPath: Path | null = p\n            for (const op of batchedOps) {\n              if (Path.operationCanTransformPath(op)) {\n                newPath = Path.transform(newPath, op)\n                if (!newPath) {\n                  return null\n                }\n              }\n            }\n            return newPath\n          })\n        }\n      )\n    } else {\n      for (const node of nodes as Node[]) {\n        const path = parentPath.concat(index)\n        index++\n\n        editor.apply({ type: 'insert_node', path, node })\n        at = Path.next(at as Path)\n      }\n    }\n\n    at = Path.previous(at)\n\n    if (select) {\n      const point = Editor.end(editor, at)\n\n      if (point) {\n        Transforms.select(editor, point)\n      }\n    }\n  })\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Editor } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { matchPath } from '../utils/match-path'\nimport { Element } from '../interfaces/element'\nimport { Ancestor, NodeEntry } from '../interfaces/node'\nimport { Transforms } from '../interfaces/transforms'\n\nexport const liftNodes: NodeTransforms['liftNodes'] = (\n  editor,\n  options = {}\n) => {\n  Editor.withoutNormalizing(editor, () => {\n    const { at = editor.selection, mode = 'lowest', voids = false } = options\n    let { match } = options\n\n    if (match == null) {\n      match = Path.isPath(at)\n        ? matchPath(editor, at)\n        : n => Element.isElement(n) && Editor.isBlock(editor, n)\n    }\n\n    if (!at) {\n      return\n    }\n\n    const matches = Editor.nodes(editor, { at, match, mode, voids })\n    const pathRefs = Array.from(matches, ([, p]) => Editor.pathRef(editor, p))\n\n    for (const pathRef of pathRefs) {\n      const path = pathRef.unref()!\n\n      if (path.length < 2) {\n        throw new Error(\n          `Cannot lift node at a path [${path}] because it has a depth of less than \\`2\\`.`\n        )\n      }\n\n      const parentNodeEntry = Editor.node(editor, Path.parent(path))\n      const [parent, parentPath] = parentNodeEntry as NodeEntry<Ancestor>\n      const index = path[path.length - 1]\n      const { length } = parent.children\n\n      if (length === 1) {\n        const toPath = Path.next(parentPath)\n        Transforms.moveNodes(editor, { at: path, to: toPath, voids })\n        Transforms.removeNodes(editor, { at: parentPath, voids })\n      } else if (index === 0) {\n        Transforms.moveNodes(editor, { at: path, to: parentPath, voids })\n      } else if (index === length - 1) {\n        const toPath = Path.next(parentPath)\n        Transforms.moveNodes(editor, { at: path, to: toPath, voids })\n      } else {\n        const splitPath = Path.next(path)\n        const toPath = Path.next(parentPath)\n        Transforms.splitNodes(editor, { at: splitPath, voids })\n        Transforms.moveNodes(editor, { at: path, to: toPath, voids })\n      }\n    }\n  })\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Editor } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { Element } from '../interfaces/element'\nimport { Range } from '../interfaces/range'\nimport { Transforms } from '../interfaces/transforms'\nimport { Text } from '../interfaces/text'\nimport { Scrubber } from '../interfaces/scrubber'\nimport { Node } from '../interfaces/node'\n\nconst hasSingleChildNest = (editor: Editor, node: Node): boolean => {\n  if (Element.isElement(node)) {\n    const element = node as Element\n    if (Editor.isVoid(editor, node)) {\n      return true\n    } else if (element.children.length === 1) {\n      return hasSingleChildNest(editor, element.children[0])\n    } else {\n      return false\n    }\n  } else if (Editor.isEditor(node)) {\n    return false\n  } else {\n    return true\n  }\n}\n\nexport const mergeNodes: NodeTransforms['mergeNodes'] = (\n  editor,\n  options = {}\n) => {\n  Editor.withoutNormalizing(editor, () => {\n    let { match, at = editor.selection } = options\n    const { hanging = false, voids = false, mode = 'lowest' } = options\n\n    if (!at) {\n      return\n    }\n\n    if (match == null) {\n      if (Path.isPath(at)) {\n        const [parent] = Editor.parent(editor, at)\n        match = n => parent.children.includes(n)\n      } else {\n        match = n => Element.isElement(n) && Editor.isBlock(editor, n)\n      }\n    }\n\n    if (!hanging && Range.isRange(at)) {\n      at = Editor.unhangRange(editor, at, { voids })\n    }\n\n    if (Range.isRange(at)) {\n      if (Range.isCollapsed(at)) {\n        at = at.anchor\n      } else {\n        const [, end] = Range.edges(at)\n        const pointRef = Editor.pointRef(editor, end)\n        Transforms.delete(editor, { at })\n        at = pointRef.unref()!\n\n        if (options.at == null) {\n          Transforms.select(editor, at)\n        }\n      }\n    }\n\n    const [current] = Editor.nodes(editor, { at, match, voids, mode })\n    const prev = Editor.previous(editor, { at, match, voids, mode })\n\n    if (!current || !prev) {\n      return\n    }\n\n    const [node, path] = current\n    const [prevNode, prevPath] = prev\n\n    if (path.length === 0 || prevPath.length === 0) {\n      return\n    }\n\n    const newPath = Path.next(prevPath)\n    const commonPath = Path.common(path, prevPath)\n    const isPreviousSibling = Path.isSibling(path, prevPath)\n    const levels = Array.from(Editor.levels(editor, { at: path }), ([n]) => n)\n      .slice(commonPath.length)\n      .slice(0, -1)\n\n    // Determine if the merge will leave an ancestor of the path empty as a\n    // result, in which case we'll want to remove it after merging.\n    const emptyAncestor = Editor.above(editor, {\n      at: path,\n      mode: 'highest',\n      match: n => levels.includes(n) && hasSingleChildNest(editor, n),\n    })\n\n    const emptyRef = emptyAncestor && Editor.pathRef(editor, emptyAncestor[1])\n    let properties\n    let position\n\n    // Ensure that the nodes are equivalent, and figure out what the position\n    // and extra properties of the merge will be.\n    if (Text.isText(node) && Text.isText(prevNode)) {\n      const { text, ...rest } = node\n      position = prevNode.text.length\n      properties = rest as Partial<Text>\n    } else if (Element.isElement(node) && Element.isElement(prevNode)) {\n      const { children, ...rest } = node\n      position = prevNode.children.length\n      properties = rest as Partial<Element>\n    } else {\n      throw new Error(\n        `Cannot merge the node at path [${path}] with the previous sibling because it is not the same kind: ${Scrubber.stringify(\n          node\n        )} ${Scrubber.stringify(prevNode)}`\n      )\n    }\n\n    // If the node isn't already the next sibling of the previous node, move\n    // it so that it is before merging.\n    if (!isPreviousSibling) {\n      Transforms.moveNodes(editor, { at: path, to: newPath, voids })\n    }\n\n    // If there was going to be an empty ancestor of the node that was merged,\n    // we remove it from the tree.\n    if (emptyRef) {\n      Transforms.removeNodes(editor, { at: emptyRef.current!, voids })\n    }\n\n    if (Editor.shouldMergeNodesRemovePrevNode(editor, prev, current)) {\n      Transforms.removeNodes(editor, { at: prevPath, voids })\n    } else {\n      editor.apply({\n        type: 'merge_node',\n        path: newPath,\n        position,\n        properties,\n      })\n    }\n\n    if (emptyRef) {\n      emptyRef.unref()\n    }\n  })\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Editor } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { matchPath } from '../utils/match-path'\nimport { Element } from '../interfaces/element'\n\nexport const moveNodes: NodeTransforms['moveNodes'] = (editor, options) => {\n  Editor.withoutNormalizing(editor, () => {\n    const {\n      to,\n      at = editor.selection,\n      mode = 'lowest',\n      voids = false,\n    } = options\n    let { match } = options\n\n    if (!at) {\n      return\n    }\n\n    if (match == null) {\n      match = Path.isPath(at)\n        ? matchPath(editor, at)\n        : n => Element.isElement(n) && Editor.isBlock(editor, n)\n    }\n\n    const toRef = Editor.pathRef(editor, to)\n    const targets = Editor.nodes(editor, { at, match, mode, voids })\n    const pathRefs = Array.from(targets, ([, p]) => Editor.pathRef(editor, p))\n\n    for (const pathRef of pathRefs) {\n      const path = pathRef.unref()!\n      const newPath = toRef.current!\n\n      if (path.length !== 0) {\n        editor.apply({ type: 'move_node', path, newPath })\n      }\n\n      if (\n        toRef.current &&\n        Path.isSibling(newPath, path) &&\n        Path.isAfter(newPath, path)\n      ) {\n        // When performing a sibling move to a later index, the path at the destination is shifted\n        // to before the insertion point instead of after. To ensure our group of nodes are inserted\n        // in the correct order we increment toRef to account for that\n        toRef.current = Path.next(toRef.current)\n      }\n    }\n\n    toRef.unref()\n  })\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Editor } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { matchPath } from '../utils/match-path'\nimport { Element } from '../interfaces/element'\nimport { Range } from '../interfaces/range'\n\nexport const removeNodes: NodeTransforms['removeNodes'] = (\n  editor,\n  options = {}\n) => {\n  Editor.withoutNormalizing(editor, () => {\n    const { hanging = false, voids = false, mode = 'lowest' } = options\n    let { at = editor.selection, match } = options\n\n    if (!at) {\n      return\n    }\n\n    if (match == null) {\n      match = Path.isPath(at)\n        ? matchPath(editor, at)\n        : n => Element.isElement(n) && Editor.isBlock(editor, n)\n    }\n\n    if (!hanging && Range.isRange(at)) {\n      at = Editor.unhangRange(editor, at, { voids })\n    }\n\n    const depths = Editor.nodes(editor, { at, match, mode, voids })\n    const pathRefs = Array.from(depths, ([, p]) => Editor.pathRef(editor, p))\n\n    for (const pathRef of pathRefs) {\n      const path = pathRef.unref()!\n\n      if (path) {\n        const [node] = Editor.node(editor, path)\n        editor.apply({ type: 'remove_node', path, node })\n      }\n    }\n  })\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Editor } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { matchPath } from '../utils/match-path'\nimport { Element } from '../interfaces/element'\nimport { Range } from '../interfaces/range'\nimport { Transforms } from '../interfaces/transforms'\nimport { Node } from '../interfaces/node'\n\nexport const setNodes: NodeTransforms['setNodes'] = (\n  editor,\n  props: Partial<Node>,\n  options = {}\n) => {\n  Editor.withoutNormalizing(editor, () => {\n    let { match, at = editor.selection, compare, merge } = options\n    const {\n      hanging = false,\n      mode = 'lowest',\n      split = false,\n      voids = false,\n    } = options\n\n    if (!at) {\n      return\n    }\n\n    if (match == null) {\n      match = Path.isPath(at)\n        ? matchPath(editor, at)\n        : n => Element.isElement(n) && Editor.isBlock(editor, n)\n    }\n\n    if (!hanging && Range.isRange(at)) {\n      at = Editor.unhangRange(editor, at, { voids })\n    }\n\n    if (split && Range.isRange(at)) {\n      if (\n        Range.isCollapsed(at) &&\n        Editor.leaf(editor, at.anchor)[0].text.length > 0\n      ) {\n        // If the range is collapsed in a non-empty node and 'split' is true, there's nothing to\n        // set that won't get normalized away\n        return\n      }\n      const rangeRef = Editor.rangeRef(editor, at, { affinity: 'inward' })\n      const [start, end] = Range.edges(at)\n      const splitMode = mode === 'lowest' ? 'lowest' : 'highest'\n      const endAtEndOfNode = Editor.isEnd(editor, end, end.path)\n      Transforms.splitNodes(editor, {\n        at: end,\n        match,\n        mode: splitMode,\n        voids,\n        always: !endAtEndOfNode,\n      })\n      const startAtStartOfNode = Editor.isStart(editor, start, start.path)\n      Transforms.splitNodes(editor, {\n        at: start,\n        match,\n        mode: splitMode,\n        voids,\n        always: !startAtStartOfNode,\n      })\n      at = rangeRef.unref()!\n\n      if (options.at == null) {\n        Transforms.select(editor, at)\n      }\n    }\n\n    if (!compare) {\n      compare = (prop, nodeProp) => prop !== nodeProp\n    }\n\n    for (const [node, path] of Editor.nodes(editor, {\n      at,\n      match,\n      mode,\n      voids,\n    })) {\n      const properties: Partial<Node> = {}\n      // FIXME: is this correct?\n      const newProperties: Partial<Node> & { [key: string]: unknown } = {}\n\n      // You can't set properties on the editor node.\n      if (path.length === 0) {\n        continue\n      }\n\n      let hasChanges = false\n\n      for (const k in props) {\n        if (k === 'children' || k === 'text') {\n          continue\n        }\n\n        if (compare(props[<keyof Node>k], node[<keyof Node>k])) {\n          hasChanges = true\n          // Omit new properties from the old properties list\n          if (node.hasOwnProperty(k))\n            properties[<keyof Node>k] = node[<keyof Node>k]\n          // Omit properties that have been removed from the new properties list\n          if (merge) {\n            if (props[<keyof Node>k] != null)\n              newProperties[<keyof Node>k] = merge(\n                node[<keyof Node>k],\n                props[<keyof Node>k]\n              )\n          } else {\n            if (props[<keyof Node>k] != null)\n              newProperties[<keyof Node>k] = props[<keyof Node>k]\n          }\n        }\n      }\n\n      if (hasChanges) {\n        editor.apply({\n          type: 'set_node',\n          path,\n          properties,\n          newProperties,\n        })\n      }\n    }\n  })\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Editor } from '../interfaces/editor'\nimport { Element } from '../interfaces/element'\nimport { Range } from '../interfaces/range'\nimport { Path } from '../interfaces/path'\nimport { PointRef } from '../interfaces/point-ref'\nimport { Transforms } from '../interfaces/transforms'\nimport { Node } from '../interfaces/node'\nimport { Point } from '../interfaces/point'\n\n/**\n * Convert a range into a point by deleting it's content.\n */\nconst deleteRange = (editor: Editor, range: Range): Point | null => {\n  if (Range.isCollapsed(range)) {\n    return range.anchor\n  } else {\n    const [, end] = Range.edges(range)\n    const pointRef = Editor.pointRef(editor, end)\n    Transforms.delete(editor, { at: range })\n    return pointRef.unref()\n  }\n}\n\nexport const splitNodes: NodeTransforms['splitNodes'] = (\n  editor,\n  options = {}\n) => {\n  Editor.withoutNormalizing(editor, () => {\n    const { mode = 'lowest', voids = false } = options\n    let { match, at = editor.selection, height = 0, always = false } = options\n\n    if (match == null) {\n      match = n => Element.isElement(n) && Editor.isBlock(editor, n)\n    }\n\n    if (Range.isRange(at)) {\n      at = deleteRange(editor, at)\n    }\n\n    // If the target is a path, the default height-skipping and position\n    // counters need to account for us potentially splitting at a non-leaf.\n    if (Path.isPath(at)) {\n      const path = at\n      const point = Editor.point(editor, path)\n      const [parent] = Editor.parent(editor, path)\n      match = n => n === parent\n      height = point.path.length - path.length + 1\n      at = point\n      always = true\n    }\n\n    if (!at) {\n      return\n    }\n\n    const beforeRef = Editor.pointRef(editor, at, {\n      affinity: 'backward',\n    })\n    let afterRef: PointRef | undefined\n    try {\n      const [highest] = Editor.nodes(editor, { at, match, mode, voids })\n\n      if (!highest) {\n        return\n      }\n\n      const voidMatch = Editor.void(editor, { at, mode: 'highest' })\n      const nudge = 0\n\n      if (!voids && voidMatch) {\n        const [voidNode, voidPath] = voidMatch\n\n        if (Element.isElement(voidNode) && editor.isInline(voidNode)) {\n          let after = Editor.after(editor, voidPath)\n\n          if (!after) {\n            const text = { text: '' }\n            const afterPath = Path.next(voidPath)\n            Transforms.insertNodes(editor, text, { at: afterPath, voids })\n            after = Editor.point(editor, afterPath)!\n          }\n\n          at = after\n          always = true\n        }\n\n        const siblingHeight = at.path.length - voidPath.length\n        height = siblingHeight + 1\n        always = true\n      }\n\n      afterRef = Editor.pointRef(editor, at)\n      const depth = at.path.length - height\n      const [, highestPath] = highest\n      const lowestPath = at.path.slice(0, depth)\n      let position = height === 0 ? at.offset : at.path[depth] + nudge\n\n      for (const [node, path] of Editor.levels(editor, {\n        at: lowestPath,\n        reverse: true,\n        voids,\n      })) {\n        let split = false\n\n        if (\n          path.length < highestPath.length ||\n          path.length === 0 ||\n          (!voids && Element.isElement(node) && Editor.isVoid(editor, node))\n        ) {\n          break\n        }\n\n        const point = beforeRef.current!\n        const isEnd = Editor.isEnd(editor, point, path)\n\n        if (always || !beforeRef || !Editor.isEdge(editor, point, path)) {\n          split = true\n          const properties = Node.extractProps(node)\n          editor.apply({\n            type: 'split_node',\n            path,\n            position,\n            properties,\n          })\n        }\n\n        position = path[path.length - 1] + (split || isEnd ? 1 : 0)\n      }\n\n      if (options.at == null) {\n        const point = afterRef.current || Editor.end(editor, [])\n        Transforms.select(editor, point)\n      }\n    } finally {\n      beforeRef.unref()\n      afterRef?.unref()\n    }\n  })\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Transforms } from '../interfaces/transforms'\n\nexport const unsetNodes: NodeTransforms['unsetNodes'] = (\n  editor,\n  props,\n  options = {}\n) => {\n  if (!Array.isArray(props)) {\n    props = [props]\n  }\n\n  const obj: any = {}\n\n  for (const key of props) {\n    obj[key] = null\n  }\n\n  Transforms.setNodes(editor, obj, options)\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Editor } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { matchPath } from '../utils/match-path'\nimport { Element } from '../interfaces/element'\nimport { Range } from '../interfaces/range'\nimport { Transforms } from '../interfaces/transforms'\n\nexport const unwrapNodes: NodeTransforms['unwrapNodes'] = (\n  editor,\n  options = {}\n) => {\n  Editor.withoutNormalizing(editor, () => {\n    const { mode = 'lowest', split = false, voids = false } = options\n    let { at = editor.selection, match } = options\n\n    if (!at) {\n      return\n    }\n\n    if (match == null) {\n      match = Path.isPath(at)\n        ? matchPath(editor, at)\n        : n => Element.isElement(n) && Editor.isBlock(editor, n)\n    }\n\n    if (Path.isPath(at)) {\n      at = Editor.range(editor, at)\n    }\n\n    const rangeRef = Range.isRange(at) ? Editor.rangeRef(editor, at) : null\n    const matches = Editor.nodes(editor, { at, match, mode, voids })\n    const pathRefs = Array.from(\n      matches,\n      ([, p]) => Editor.pathRef(editor, p)\n      // unwrapNode will call liftNode which does not support splitting the node when nested.\n      // If we do not reverse the order and call it from top to the bottom, it will remove all blocks\n      // that wrap target node. So we reverse the order.\n    ).reverse()\n\n    for (const pathRef of pathRefs) {\n      const path = pathRef.unref()!\n      const [node] = Editor.node(editor, path)\n      let range = Editor.range(editor, path)\n\n      if (split && rangeRef) {\n        range = Range.intersection(rangeRef.current!, range)!\n      }\n\n      Transforms.liftNodes(editor, {\n        at: range,\n        match: n => Element.isAncestor(node) && node.children.includes(n),\n        voids,\n      })\n    }\n\n    if (rangeRef) {\n      rangeRef.unref()\n    }\n  })\n}\n", "import { NodeTransforms } from '../interfaces/transforms/node'\nimport { Editor } from '../interfaces/editor'\nimport { Path } from '../interfaces/path'\nimport { matchPath } from '../utils/match-path'\nimport { Element } from '../interfaces/element'\nimport { Text } from '../interfaces/text'\nimport { Range } from '../interfaces/range'\nimport { Transforms } from '../interfaces/transforms'\n\nexport const wrapNodes: NodeTransforms['wrapNodes'] = (\n  editor,\n  element,\n  options = {}\n) => {\n  Editor.withoutNormalizing(editor, () => {\n    const { mode = 'lowest', split = false, voids = false } = options\n    let { match, at = editor.selection } = options\n\n    if (!at) {\n      return\n    }\n\n    if (match == null) {\n      if (Path.isPath(at)) {\n        match = matchPath(editor, at)\n      } else if (editor.isInline(element)) {\n        match = n =>\n          (Element.isElement(n) && Editor.isInline(editor, n)) || Text.isText(n)\n      } else {\n        match = n => Element.isElement(n) && Editor.isBlock(editor, n)\n      }\n    }\n\n    if (split && Range.isRange(at)) {\n      const [start, end] = Range.edges(at)\n      const rangeRef = Editor.rangeRef(editor, at, {\n        affinity: 'inward',\n      })\n      Transforms.splitNodes(editor, { at: end, match, voids })\n      Transforms.splitNodes(editor, { at: start, match, voids })\n      at = rangeRef.unref()!\n\n      if (options.at == null) {\n        Transforms.select(editor, at)\n      }\n    }\n\n    const roots = Array.from(\n      Editor.nodes(editor, {\n        at,\n        match: editor.isInline(element)\n          ? n => Element.isElement(n) && Editor.isBlock(editor, n)\n          : n => Editor.isEditor(n),\n        mode: 'lowest',\n        voids,\n      })\n    )\n\n    for (const [, rootPath] of roots) {\n      const a = Range.isRange(at)\n        ? Range.intersection(at, Editor.range(editor, rootPath))\n        : at\n\n      if (!a) {\n        continue\n      }\n\n      const matches = Array.from(\n        Editor.nodes(editor, { at: a, match, mode, voids })\n      )\n\n      if (matches.length > 0) {\n        const [first] = matches\n        const last = matches[matches.length - 1]\n        const [, firstPath] = first\n        const [, lastPath] = last\n\n        if (firstPath.length === 0 && lastPath.length === 0) {\n          // if there's no matching parent - usually means the node is an editor - don't do anything\n          continue\n        }\n\n        const commonPath = Path.equals(firstPath, lastPath)\n          ? Path.parent(firstPath)\n          : Path.common(firstPath, lastPath)\n\n        const range = Editor.range(editor, firstPath, lastPath)\n        const commonNodeEntry = Editor.node(editor, commonPath)\n        const [commonNode] = commonNodeEntry\n        const depth = commonPath.length + 1\n        const wrapperPath = Path.next(lastPath.slice(0, depth))\n        const wrapper = { ...element, children: [] }\n        Transforms.insertNodes(editor, wrapper, { at: wrapperPath, voids })\n\n        Transforms.moveNodes(editor, {\n          at: range,\n          match: n =>\n            Element.isAncestor(commonNode) && commonNode.children.includes(n),\n          to: wrapperPath.concat(0),\n          voids,\n        })\n      }\n    }\n  })\n}\n", "import {\n  addMark,\n  deleteFragment,\n  Editor,\n  getDirtyPaths,\n  getFragment,\n  insertBreak,\n  insertFragment,\n  insertNode,\n  insertSoftBreak,\n  insertText,\n  normalizeNode,\n  removeMark,\n  shouldNormalize,\n} from './'\nimport { apply } from './core'\nimport {\n  above,\n  after,\n  before,\n  deleteBackward,\n  deleteForward,\n  edges,\n  elementReadOnly,\n  end,\n  first,\n  fragment,\n  getVoid,\n  hasBlocks,\n  hasInlines,\n  hasPath,\n  hasTexts,\n  isBlock,\n  isEdge,\n  isEmpty,\n  isEnd,\n  isNormalizing,\n  isStart,\n  last,\n  leaf,\n  levels,\n  marks,\n  next,\n  node,\n  nodes,\n  normalize,\n  parent,\n  path,\n  pathRef,\n  pathRefs,\n  point,\n  pointRef,\n  pointRefs,\n  positions,\n  previous,\n  range,\n  rangeRef,\n  rangeRefs,\n  setNormalizing,\n  shouldMergeNodesRemovePrevNode,\n  start,\n  string,\n  unhangRange,\n  withoutNormalizing,\n} from './editor'\nimport { deleteText } from './transforms-text'\nimport {\n  collapse,\n  deselect,\n  move,\n  select,\n  setPoint,\n  setSelection,\n} from './transforms-selection'\nimport {\n  insertNodes,\n  liftNodes,\n  mergeNodes,\n  moveNodes,\n  removeNodes,\n  setNodes,\n  splitNodes,\n  unsetNodes,\n  unwrapNodes,\n  wrapNodes,\n} from './transforms-node'\n\n/**\n * Create a new Slate `Editor` object.\n */\nexport const createEditor = (): Editor => {\n  const editor: Editor = {\n    children: [],\n    operations: [],\n    selection: null,\n    marks: null,\n    isElementReadOnly: () => false,\n    isInline: () => false,\n    isSelectable: () => true,\n    isVoid: () => false,\n    markableVoid: () => false,\n    onChange: () => {},\n\n    // Core\n    apply: (...args) => apply(editor, ...args),\n\n    // Editor\n    addMark: (...args) => addMark(editor, ...args),\n    deleteBackward: (...args) => deleteBackward(editor, ...args),\n    deleteForward: (...args) => deleteForward(editor, ...args),\n    deleteFragment: (...args) => deleteFragment(editor, ...args),\n    getFragment: (...args) => getFragment(editor, ...args),\n    insertBreak: (...args) => insertBreak(editor, ...args),\n    insertSoftBreak: (...args) => insertSoftBreak(editor, ...args),\n    insertFragment: (...args) => insertFragment(editor, ...args),\n    insertNode: (...args) => insertNode(editor, ...args),\n    insertText: (...args) => insertText(editor, ...args),\n    normalizeNode: (...args) => normalizeNode(editor, ...args),\n    removeMark: (...args) => removeMark(editor, ...args),\n    getDirtyPaths: (...args) => getDirtyPaths(editor, ...args),\n    shouldNormalize: (...args) => shouldNormalize(editor, ...args),\n\n    // Editor interface\n    above: (...args) => above(editor, ...args),\n    after: (...args) => after(editor, ...args),\n    before: (...args) => before(editor, ...args),\n    collapse: (...args) => collapse(editor, ...args),\n    delete: (...args) => deleteText(editor, ...args),\n    deselect: (...args) => deselect(editor, ...args),\n    edges: (...args) => edges(editor, ...args),\n    elementReadOnly: (...args) => elementReadOnly(editor, ...args),\n    end: (...args) => end(editor, ...args),\n    first: (...args) => first(editor, ...args),\n    fragment: (...args) => fragment(editor, ...args),\n    getMarks: (...args) => marks(editor, ...args),\n    hasBlocks: (...args) => hasBlocks(editor, ...args),\n    hasInlines: (...args) => hasInlines(editor, ...args),\n    hasPath: (...args) => hasPath(editor, ...args),\n    hasTexts: (...args) => hasTexts(editor, ...args),\n    insertNodes: (...args) => insertNodes(editor, ...args),\n    isBlock: (...args) => isBlock(editor, ...args),\n    isEdge: (...args) => isEdge(editor, ...args),\n    isEmpty: (...args) => isEmpty(editor, ...args),\n    isEnd: (...args) => isEnd(editor, ...args),\n    isNormalizing: (...args) => isNormalizing(editor, ...args),\n    isStart: (...args) => isStart(editor, ...args),\n    last: (...args) => last(editor, ...args),\n    leaf: (...args) => leaf(editor, ...args),\n    levels: (...args) => levels(editor, ...args),\n    liftNodes: (...args) => liftNodes(editor, ...args),\n    mergeNodes: (...args) => mergeNodes(editor, ...args),\n    move: (...args) => move(editor, ...args),\n    moveNodes: (...args) => moveNodes(editor, ...args),\n    next: (...args) => next(editor, ...args),\n    node: (...args) => node(editor, ...args),\n    nodes: (...args) => nodes(editor, ...args),\n    normalize: (...args) => normalize(editor, ...args),\n    parent: (...args) => parent(editor, ...args),\n    path: (...args) => path(editor, ...args),\n    pathRef: (...args) => pathRef(editor, ...args),\n    pathRefs: (...args) => pathRefs(editor, ...args),\n    point: (...args) => point(editor, ...args),\n    pointRef: (...args) => pointRef(editor, ...args),\n    pointRefs: (...args) => pointRefs(editor, ...args),\n    positions: (...args) => positions(editor, ...args),\n    previous: (...args) => previous(editor, ...args),\n    range: (...args) => range(editor, ...args),\n    rangeRef: (...args) => rangeRef(editor, ...args),\n    rangeRefs: (...args) => rangeRefs(editor, ...args),\n    removeNodes: (...args) => removeNodes(editor, ...args),\n    select: (...args) => select(editor, ...args),\n    setNodes: (...args) => setNodes(editor, ...args),\n    setNormalizing: (...args) => setNormalizing(editor, ...args),\n    setPoint: (...args) => setPoint(editor, ...args),\n    setSelection: (...args) => setSelection(editor, ...args),\n    splitNodes: (...args) => splitNodes(editor, ...args),\n    start: (...args) => start(editor, ...args),\n    string: (...args) => string(editor, ...args),\n    unhangRange: (...args) => unhangRange(editor, ...args),\n    unsetNodes: (...args) => unsetNodes(editor, ...args),\n    unwrapNodes: (...args) => unwrapNodes(editor, ...args),\n    void: (...args) => getVoid(editor, ...args),\n    withoutNormalizing: (...args) => withoutNormalizing(editor, ...args),\n    wrapNodes: (...args) => wrapNodes(editor, ...args),\n    shouldMergeNodesRemovePrevNode: (...args) =>\n      shouldMergeNodesRemovePrevNode(editor, ...args),\n  }\n\n  return editor\n}\n", "import { isPlainObject } from 'is-plain-object'\nimport { Operation, Range } from 'slate'\n\ninterface Batch {\n  operations: Operation[]\n  selectionBefore: Range | null\n}\n\n/**\n * `History` objects hold all of the operations that are applied to a value, so\n * they can be undone or redone as necessary.\n */\n\nexport interface History {\n  redos: Batch[]\n  undos: Batch[]\n}\n\n// eslint-disable-next-line no-redeclare\nexport const History = {\n  /**\n   * Check if a value is a `History` object.\n   */\n\n  isHistory(value: any): value is History {\n    return (\n      isPlainObject(value) &&\n      Array.isArray(value.redos) &&\n      Array.isArray(value.undos) &&\n      (value.redos.length === 0 ||\n        Operation.isOperationList(value.redos[0].operations)) &&\n      (value.undos.length === 0 ||\n        Operation.isOperationList(value.undos[0].operations))\n    )\n  },\n}\n", "import { BaseEditor, Editor } from 'slate'\nimport { History } from './history'\n\n/**\n * Weakmaps for attaching state to the editor.\n */\n\nexport const HISTORY = new WeakMap<Editor, History>()\nexport const SAVING = new WeakMap<Editor, boolean | undefined>()\nexport const MERGING = new WeakMap<Editor, boolean | undefined>()\nexport const SPLITTING_ONCE = new WeakMap<Editor, boolean | undefined>()\n\n/**\n * `HistoryEditor` contains helpers for history-enabled editors.\n */\n\nexport interface HistoryEditor extends BaseEditor {\n  history: History\n  undo: () => void\n  redo: () => void\n  writeHistory: (stack: 'undos' | 'redos', batch: any) => void\n}\n\n// eslint-disable-next-line no-redeclare\nexport const HistoryEditor = {\n  /**\n   * Check if a value is a `HistoryEditor` object.\n   */\n\n  isHistoryEditor(value: any): value is HistoryEditor {\n    return History.isHistory(value.history) && Editor.isEditor(value)\n  },\n\n  /**\n   * Get the merge flag's current value.\n   */\n\n  isMerging(editor: HistoryEditor): boolean | undefined {\n    return MERGING.get(editor)\n  },\n\n  /**\n   * Get the splitting once flag's current value.\n   */\n\n  isSplittingOnce(editor: HistoryEditor): boolean | undefined {\n    return SPLITTING_ONCE.get(editor)\n  },\n\n  setSplittingOnce(editor: HistoryEditor, value: boolean | undefined): void {\n    SPLITTING_ONCE.set(editor, value)\n  },\n\n  /**\n   * Get the saving flag's current value.\n   */\n\n  isSaving(editor: HistoryEditor): boolean | undefined {\n    return SAVING.get(editor)\n  },\n\n  /**\n   * Redo to the previous saved state.\n   */\n\n  redo(editor: HistoryEditor): void {\n    editor.redo()\n  },\n\n  /**\n   * Undo to the previous saved state.\n   */\n\n  undo(editor: HistoryEditor): void {\n    editor.undo()\n  },\n\n  /**\n   * Apply a series of changes inside a synchronous `fn`, These operations will\n   * be merged into the previous history.\n   */\n  withMerging(editor: HistoryEditor, fn: () => void): void {\n    const prev = HistoryEditor.isMerging(editor)\n    MERGING.set(editor, true)\n    fn()\n    MERGING.set(editor, prev)\n  },\n\n  /**\n   * Apply a series of changes inside a synchronous `fn`, ensuring that the first\n   * operation starts a new batch in the history. Subsequent operations will be\n   * merged as usual.\n   */\n  withNewBatch(editor: HistoryEditor, fn: () => void): void {\n    const prev = HistoryEditor.isMerging(editor)\n    MERGING.set(editor, true)\n    SPLITTING_ONCE.set(editor, true)\n    fn()\n    MERGING.set(editor, prev)\n    SPLITTING_ONCE.delete(editor)\n  },\n\n  /**\n   * Apply a series of changes inside a synchronous `fn`, without merging any of\n   * the new operations into previous save point in the history.\n   */\n\n  withoutMerging(editor: HistoryEditor, fn: () => void): void {\n    const prev = HistoryEditor.isMerging(editor)\n    MERGING.set(editor, false)\n    fn()\n    MERGING.set(editor, prev)\n  },\n\n  /**\n   * Apply a series of changes inside a synchronous `fn`, without saving any of\n   * their operations into the history.\n   */\n\n  withoutSaving(editor: HistoryEditor, fn: () => void): void {\n    const prev = HistoryEditor.isSaving(editor)\n    SAVING.set(editor, false)\n    fn()\n    SAVING.set(editor, prev)\n  },\n}\n", "import { Editor, Operation, Path, Transforms } from 'slate'\n\nimport { HistoryEditor } from './history-editor'\n\n/**\n * The `withHistory` plugin keeps track of the operation history of a Slate\n * editor as operations are applied to it, using undo and redo stacks.\n *\n * If you are using TypeScript, you must extend Slate's CustomTypes to use\n * this plugin.\n *\n * See https://docs.slatejs.org/concepts/11-typescript to learn how.\n */\n\nexport const withHistory = <T extends Editor>(editor: T) => {\n  const e = editor as T & HistoryEditor\n  const { apply } = e\n  e.history = { undos: [], redos: [] }\n\n  e.redo = () => {\n    const { history } = e\n    const { redos } = history\n\n    if (redos.length > 0) {\n      const batch = redos[redos.length - 1]\n\n      if (batch.selectionBefore) {\n        Transforms.setSelection(e, batch.selectionBefore)\n      }\n\n      HistoryEditor.withoutSaving(e, () => {\n        Editor.withoutNormalizing(e, () => {\n          for (const op of batch.operations) {\n            e.apply(op)\n          }\n        })\n      })\n\n      history.redos.pop()\n      e.writeHistory('undos', batch)\n    }\n  }\n\n  e.undo = () => {\n    const { history } = e\n    const { undos } = history\n\n    if (undos.length > 0) {\n      const batch = undos[undos.length - 1]\n\n      HistoryEditor.withoutSaving(e, () => {\n        Editor.withoutNormalizing(e, () => {\n          const inverseOps = batch.operations.map(Operation.inverse).reverse()\n\n          for (const op of inverseOps) {\n            e.apply(op)\n          }\n          if (batch.selectionBefore) {\n            Transforms.setSelection(e, batch.selectionBefore)\n          }\n        })\n      })\n\n      e.writeHistory('redos', batch)\n      history.undos.pop()\n    }\n  }\n\n  e.apply = (op: Operation) => {\n    const { operations, history } = e\n    const { undos } = history\n    const lastBatch = undos[undos.length - 1]\n    const lastOp =\n      lastBatch && lastBatch.operations[lastBatch.operations.length - 1]\n    let save = HistoryEditor.isSaving(e)\n    let merge = HistoryEditor.isMerging(e)\n\n    if (save == null) {\n      save = shouldSave(op, lastOp)\n    }\n\n    if (save) {\n      if (merge == null) {\n        if (lastBatch == null) {\n          merge = false\n        } else if (operations.length !== 0) {\n          merge = true\n        } else {\n          merge = shouldMerge(op, lastOp)\n        }\n      }\n\n      if (HistoryEditor.isSplittingOnce(e)) {\n        merge = false\n        HistoryEditor.setSplittingOnce(e, undefined)\n      }\n\n      if (lastBatch && merge) {\n        lastBatch.operations.push(op)\n      } else {\n        const batch = {\n          operations: [op],\n          selectionBefore: e.selection,\n        }\n        e.writeHistory('undos', batch)\n      }\n\n      while (undos.length > 100) {\n        undos.shift()\n      }\n\n      history.redos = []\n    }\n\n    apply(op)\n  }\n\n  e.writeHistory = (stack: 'undos' | 'redos', batch: any) => {\n    e.history[stack].push(batch)\n  }\n\n  return e\n}\n\n/**\n * Check whether to merge an operation into the previous operation.\n */\n\nconst shouldMerge = (op: Operation, prev: Operation | undefined): boolean => {\n  if (\n    prev &&\n    op.type === 'insert_text' &&\n    prev.type === 'insert_text' &&\n    op.offset === prev.offset + prev.text.length &&\n    Path.equals(op.path, prev.path)\n  ) {\n    return true\n  }\n\n  if (\n    prev &&\n    op.type === 'remove_text' &&\n    prev.type === 'remove_text' &&\n    op.offset + op.text.length === prev.offset &&\n    Path.equals(op.path, prev.path)\n  ) {\n    return true\n  }\n\n  return false\n}\n\n/**\n * Check whether an operation needs to be saved to the history.\n */\n\nconst shouldSave = (op: Operation, prev: Operation | undefined): boolean => {\n  if (op.type === 'set_selection') {\n    return false\n  }\n\n  return true\n}\n", "// Compute what scrolling needs to be done on required scrolling boxes for target to be in view\n\n// The type names here are named after the spec to make it easier to find more information around what they mean:\n// To reduce churn and reduce things that need be maintained things from the official TS DOM library is used here\n// https://drafts.csswg.org/cssom-view/\n\n// For a definition on what is \"block flow direction\" exactly, check this: https://drafts.csswg.org/css-writing-modes-4/#block-flow-direction\n\n/**\n * This new option is tracked in this PR, which is the most likely candidate at the time: https://github.com/w3c/csswg-drafts/pull/1805\n * @public\n */\nexport type ScrollMode = 'always' | 'if-needed'\n\n/** @public */\nexport interface Options {\n  /**\n   * Control the logical scroll position on the y-axis. The spec states that the `block` direction is related to the [writing-mode](https://developer.mozilla.org/en-US/docs/Web/CSS/writing-mode), but this is not implemented yet in this library.\n   * This means that `block: 'start'` aligns to the top edge and `block: 'end'` to the bottom.\n   * @defaultValue 'center'\n   */\n  block?: ScrollLogicalPosition\n  /**\n   * Like `block` this is affected by the [writing-mode](https://developer.mozilla.org/en-US/docs/Web/CSS/writing-mode). In left-to-right pages `inline: 'start'` will align to the left edge. In right-to-left it should be flipped. This will be supported in a future release.\n   * @defaultValue 'nearest'\n   */\n  inline?: ScrollLogicalPosition\n  /**\n   * This is a proposed addition to the spec that you can track here: https://github.com/w3c/csswg-drafts/pull/5677\n   *\n   * This library will be updated to reflect any changes to the spec and will provide a migration path.\n   * To be backwards compatible with `Element.scrollIntoViewIfNeeded` if something is not 100% visible it will count as \"needs scrolling\". If you need a different visibility ratio your best option would be to implement an [Intersection Observer](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API).\n   * @defaultValue 'always'\n   */\n  scrollMode?: ScrollMode\n  /**\n   * By default there is no boundary. All the parent elements of your target is checked until it reaches the viewport ([`document.scrollingElement`](https://developer.mozilla.org/en-US/docs/Web/API/document/scrollingElement)) when calculating layout and what to scroll.\n   * By passing a boundary you can short-circuit this loop depending on your needs:\n   * \n   * - Prevent the browser window from scrolling.\n   * - Scroll elements into view in a list, without scrolling container elements.\n   * \n   * You can also pass a function to do more dynamic checks to override the scroll scoping:\n   * \n   * ```js\n   * let actions = compute(target, {\n   *   boundary: (parent) => {\n   *     // By default `overflow: hidden` elements are allowed, only `overflow: visible | clip` is skipped as\n   *     // this is required by the CSSOM spec\n   *     if (getComputedStyle(parent)['overflow'] === 'hidden') {\n   *       return false\n   *     }\n\n   *     return true\n   *   },\n   * })\n   * ```\n   * @defaultValue null\n   */\n  boundary?: Element | ((parent: Element) => boolean) | null\n  /**\n   * New option that skips auto-scrolling all nodes with overflow: hidden set\n   * See FF implementation: https://hg.mozilla.org/integration/fx-team/rev/c48c3ec05012#l7.18\n   * @defaultValue false\n   * @public\n   */\n  skipOverflowHiddenElements?: boolean\n}\n\n/** @public */\nexport interface ScrollAction {\n  el: Element\n  top: number\n  left: number\n}\n\n// @TODO better shadowdom test, 11 = document fragment\nconst isElement = (el: any): el is Element =>\n  typeof el === 'object' && el != null && el.nodeType === 1\n\nconst canOverflow = (\n  overflow: string | null,\n  skipOverflowHiddenElements?: boolean\n) => {\n  if (skipOverflowHiddenElements && overflow === 'hidden') {\n    return false\n  }\n\n  return overflow !== 'visible' && overflow !== 'clip'\n}\n\nconst getFrameElement = (el: Element) => {\n  if (!el.ownerDocument || !el.ownerDocument.defaultView) {\n    return null\n  }\n\n  try {\n    return el.ownerDocument.defaultView.frameElement\n  } catch (e) {\n    return null\n  }\n}\n\nconst isHiddenByFrame = (el: Element): boolean => {\n  const frame = getFrameElement(el)\n  if (!frame) {\n    return false\n  }\n\n  return (\n    frame.clientHeight < el.scrollHeight || frame.clientWidth < el.scrollWidth\n  )\n}\n\nconst isScrollable = (el: Element, skipOverflowHiddenElements?: boolean) => {\n  if (el.clientHeight < el.scrollHeight || el.clientWidth < el.scrollWidth) {\n    const style = getComputedStyle(el, null)\n    return (\n      canOverflow(style.overflowY, skipOverflowHiddenElements) ||\n      canOverflow(style.overflowX, skipOverflowHiddenElements) ||\n      isHiddenByFrame(el)\n    )\n  }\n\n  return false\n}\n/**\n * Find out which edge to align against when logical scroll position is \"nearest\"\n * Interesting fact: \"nearest\" works similarily to \"if-needed\", if the element is fully visible it will not scroll it\n *\n * Legends:\n *      \n *  target    frame\n *      \n */\nconst alignNearest = (\n  scrollingEdgeStart: number,\n  scrollingEdgeEnd: number,\n  scrollingSize: number,\n  scrollingBorderStart: number,\n  scrollingBorderEnd: number,\n  elementEdgeStart: number,\n  elementEdgeEnd: number,\n  elementSize: number\n) => {\n  /**\n   * If element edge A and element edge B are both outside scrolling box edge A and scrolling box edge B\n   *\n   *          \n   *        \n   *            \n   *                    do nothing\n   *            \n   *        \n   *          \n   *\n   *  If element edge C and element edge D are both outside scrolling box edge C and scrolling box edge D\n   *\n   *         \n   *   \n   *                    do nothing\n   *   \n   *         \n   */\n  if (\n    (elementEdgeStart < scrollingEdgeStart &&\n      elementEdgeEnd > scrollingEdgeEnd) ||\n    (elementEdgeStart > scrollingEdgeStart && elementEdgeEnd < scrollingEdgeEnd)\n  ) {\n    return 0\n  }\n\n  /**\n   * If element edge A is outside scrolling box edge A and element height is less than scrolling box height\n   *\n   *          \n   *                 \n   *                         \n   *  from             to    \n   *\n   *                     \n   *\n   * If element edge B is outside scrolling box edge B and element height is greater than scrolling box height\n   *\n   *                   \n   *                             \n   *  from         to      \n   *                           \n   *                 \n   *                         \n   *            \n   *          \n   *\n   * If element edge C is outside scrolling box edge C and element width is less than scrolling box width\n   *\n   *       from                 to\n   *                       \n   *                   \n   *                            \n   *                   \n   *                       \n   *\n   * If element edge D is outside scrolling box edge D and element width is greater than scrolling box width\n   *\n   *       from                 to\n   *                       \n   *           \n   *                              \n   *           \n   *                       \n   */\n  if (\n    (elementEdgeStart <= scrollingEdgeStart && elementSize <= scrollingSize) ||\n    (elementEdgeEnd >= scrollingEdgeEnd && elementSize >= scrollingSize)\n  ) {\n    return elementEdgeStart - scrollingEdgeStart - scrollingBorderStart\n  }\n\n  /**\n   * If element edge B is outside scrolling box edge B and element height is less than scrolling box height\n   *\n   *                     \n   *\n   *  from             to    \n   *                         \n   *                 \n   *          \n   *\n   * If element edge A is outside scrolling box edge A and element height is greater than scrolling box height\n   *\n   *          \n   *            \n   *                         \n   *                 \n   *                           \n   *  from         to      \n   *                             \n   *                   \n   *\n   * If element edge C is outside scrolling box edge C and element width is greater than scrolling box width\n   *\n   *           from                 to\n   *                           \n   *             \n   *                                \n   *             \n   *                           \n   *\n   * If element edge D is outside scrolling box edge D and element width is less than scrolling box width\n   *\n   *           from                 to\n   *                           \n   *                             \n   *                                \n   *                             \n   *                           \n   *\n   */\n  if (\n    (elementEdgeEnd > scrollingEdgeEnd && elementSize < scrollingSize) ||\n    (elementEdgeStart < scrollingEdgeStart && elementSize > scrollingSize)\n  ) {\n    return elementEdgeEnd - scrollingEdgeEnd + scrollingBorderEnd\n  }\n\n  return 0\n}\n\nconst getParentElement = (element: Node): Element | null => {\n  const parent = element.parentElement\n  if (parent == null) {\n    return (element.getRootNode() as ShadowRoot).host || null\n  }\n  return parent\n}\n\nconst getScrollMargins = (target: Element) => {\n  const computedStyle = window.getComputedStyle(target)\n  return {\n    top: parseFloat(computedStyle.scrollMarginTop) || 0,\n    right: parseFloat(computedStyle.scrollMarginRight) || 0,\n    bottom: parseFloat(computedStyle.scrollMarginBottom) || 0,\n    left: parseFloat(computedStyle.scrollMarginLeft) || 0,\n  }\n}\n\n/** @public */\nexport const compute = (target: Element, options: Options): ScrollAction[] => {\n  if (typeof document === 'undefined') {\n    // If there's no DOM we assume it's not in a browser environment\n    return []\n  }\n\n  const { scrollMode, block, inline, boundary, skipOverflowHiddenElements } =\n    options\n  // Allow using a callback to check the boundary\n  // The default behavior is to check if the current target matches the boundary element or not\n  // If undefined it'll check that target is never undefined (can happen as we recurse up the tree)\n  const checkBoundary =\n    typeof boundary === 'function' ? boundary : (node: any) => node !== boundary\n\n  if (!isElement(target)) {\n    throw new TypeError('Invalid target')\n  }\n\n  // Used to handle the top most element that can be scrolled\n  const scrollingElement = document.scrollingElement || document.documentElement\n\n  // Collect all the scrolling boxes, as defined in the spec: https://drafts.csswg.org/cssom-view/#scrolling-box\n  const frames: Element[] = []\n  let cursor: Element | null = target\n  while (isElement(cursor) && checkBoundary(cursor)) {\n    // Move cursor to parent\n    cursor = getParentElement(cursor)\n\n    // Stop when we reach the viewport\n    if (cursor === scrollingElement) {\n      frames.push(cursor)\n      break\n    }\n\n    // Skip document.body if it's not the scrollingElement and documentElement isn't independently scrollable\n    if (\n      cursor != null &&\n      cursor === document.body &&\n      isScrollable(cursor) &&\n      !isScrollable(document.documentElement)\n    ) {\n      continue\n    }\n\n    // Now we check if the element is scrollable, this code only runs if the loop haven't already hit the viewport or a custom boundary\n    if (cursor != null && isScrollable(cursor, skipOverflowHiddenElements)) {\n      frames.push(cursor)\n    }\n  }\n\n  // Support pinch-zooming properly, making sure elements scroll into the visual viewport\n  // Browsers that don't support visualViewport will report the layout viewport dimensions on document.documentElement.clientWidth/Height\n  // and viewport dimensions on window.innerWidth/Height\n  // https://www.quirksmode.org/mobile/viewports2.html\n  // https://bokand.github.io/viewport/index.html\n  const viewportWidth = window.visualViewport?.width ?? innerWidth\n  const viewportHeight = window.visualViewport?.height ?? innerHeight\n  const { scrollX, scrollY } = window\n\n  const {\n    height: targetHeight,\n    width: targetWidth,\n    top: targetTop,\n    right: targetRight,\n    bottom: targetBottom,\n    left: targetLeft,\n  } = target.getBoundingClientRect()\n  const {\n    top: marginTop,\n    right: marginRight,\n    bottom: marginBottom,\n    left: marginLeft,\n  } = getScrollMargins(target)\n\n  // These values mutate as we loop through and generate scroll coordinates\n  let targetBlock: number =\n    block === 'start' || block === 'nearest'\n      ? targetTop - marginTop\n      : block === 'end'\n      ? targetBottom + marginBottom\n      : targetTop + targetHeight / 2 - marginTop + marginBottom // block === 'center\n  let targetInline: number =\n    inline === 'center'\n      ? targetLeft + targetWidth / 2 - marginLeft + marginRight\n      : inline === 'end'\n      ? targetRight + marginRight\n      : targetLeft - marginLeft // inline === 'start || inline === 'nearest\n\n  // Collect new scroll positions\n  const computations: ScrollAction[] = []\n  // In chrome there's no longer a difference between caching the `frames.length` to a var or not, so we don't in this case (size > speed anyways)\n  for (let index = 0; index < frames.length; index++) {\n    const frame = frames[index]\n\n    // @TODO add a shouldScroll hook here that allows userland code to take control\n\n    const { height, width, top, right, bottom, left } =\n      frame.getBoundingClientRect()\n\n    // If the element is already visible we can end it here\n    // @TODO targetBlock and targetInline should be taken into account to be compliant with https://github.com/w3c/csswg-drafts/pull/1805/files#diff-3c17f0e43c20f8ecf89419d49e7ef5e0R1333\n    if (\n      scrollMode === 'if-needed' &&\n      targetTop >= 0 &&\n      targetLeft >= 0 &&\n      targetBottom <= viewportHeight &&\n      targetRight <= viewportWidth &&\n      // scrollingElement is added to the frames array even if it's not scrollable, in which case checking its bounds is not required\n      ((frame === scrollingElement && !isScrollable(frame)) ||\n        (targetTop >= top &&\n          targetBottom <= bottom &&\n          targetLeft >= left &&\n          targetRight <= right))\n    ) {\n      // Break the loop and return the computations for things that are not fully visible\n      return computations\n    }\n\n    const frameStyle = getComputedStyle(frame)\n    const borderLeft = parseInt(frameStyle.borderLeftWidth as string, 10)\n    const borderTop = parseInt(frameStyle.borderTopWidth as string, 10)\n    const borderRight = parseInt(frameStyle.borderRightWidth as string, 10)\n    const borderBottom = parseInt(frameStyle.borderBottomWidth as string, 10)\n\n    let blockScroll: number = 0\n    let inlineScroll: number = 0\n\n    // The property existance checks for offfset[Width|Height] is because only HTMLElement objects have them, but any Element might pass by here\n    // @TODO find out if the \"as HTMLElement\" overrides can be dropped\n    const scrollbarWidth =\n      'offsetWidth' in frame\n        ? (frame as HTMLElement).offsetWidth -\n          (frame as HTMLElement).clientWidth -\n          borderLeft -\n          borderRight\n        : 0\n    const scrollbarHeight =\n      'offsetHeight' in frame\n        ? (frame as HTMLElement).offsetHeight -\n          (frame as HTMLElement).clientHeight -\n          borderTop -\n          borderBottom\n        : 0\n\n    const scaleX =\n      'offsetWidth' in frame\n        ? (frame as HTMLElement).offsetWidth === 0\n          ? 0\n          : width / (frame as HTMLElement).offsetWidth\n        : 0\n    const scaleY =\n      'offsetHeight' in frame\n        ? (frame as HTMLElement).offsetHeight === 0\n          ? 0\n          : height / (frame as HTMLElement).offsetHeight\n        : 0\n\n    if (scrollingElement === frame) {\n      // Handle viewport logic (document.documentElement or document.body)\n\n      if (block === 'start') {\n        blockScroll = targetBlock\n      } else if (block === 'end') {\n        blockScroll = targetBlock - viewportHeight\n      } else if (block === 'nearest') {\n        blockScroll = alignNearest(\n          scrollY,\n          scrollY + viewportHeight,\n          viewportHeight,\n          borderTop,\n          borderBottom,\n          scrollY + targetBlock,\n          scrollY + targetBlock + targetHeight,\n          targetHeight\n        )\n      } else {\n        // block === 'center' is the default\n        blockScroll = targetBlock - viewportHeight / 2\n      }\n\n      if (inline === 'start') {\n        inlineScroll = targetInline\n      } else if (inline === 'center') {\n        inlineScroll = targetInline - viewportWidth / 2\n      } else if (inline === 'end') {\n        inlineScroll = targetInline - viewportWidth\n      } else {\n        // inline === 'nearest' is the default\n        inlineScroll = alignNearest(\n          scrollX,\n          scrollX + viewportWidth,\n          viewportWidth,\n          borderLeft,\n          borderRight,\n          scrollX + targetInline,\n          scrollX + targetInline + targetWidth,\n          targetWidth\n        )\n      }\n\n      // Apply scroll position offsets and ensure they are within bounds\n      // @TODO add more test cases to cover this 100%\n      blockScroll = Math.max(0, blockScroll + scrollY)\n      inlineScroll = Math.max(0, inlineScroll + scrollX)\n    } else {\n      // Handle each scrolling frame that might exist between the target and the viewport\n      if (block === 'start') {\n        blockScroll = targetBlock - top - borderTop\n      } else if (block === 'end') {\n        blockScroll = targetBlock - bottom + borderBottom + scrollbarHeight\n      } else if (block === 'nearest') {\n        blockScroll = alignNearest(\n          top,\n          bottom,\n          height,\n          borderTop,\n          borderBottom + scrollbarHeight,\n          targetBlock,\n          targetBlock + targetHeight,\n          targetHeight\n        )\n      } else {\n        // block === 'center' is the default\n        blockScroll = targetBlock - (top + height / 2) + scrollbarHeight / 2\n      }\n\n      if (inline === 'start') {\n        inlineScroll = targetInline - left - borderLeft\n      } else if (inline === 'center') {\n        inlineScroll = targetInline - (left + width / 2) + scrollbarWidth / 2\n      } else if (inline === 'end') {\n        inlineScroll = targetInline - right + borderRight + scrollbarWidth\n      } else {\n        // inline === 'nearest' is the default\n        inlineScroll = alignNearest(\n          left,\n          right,\n          width,\n          borderLeft,\n          borderRight + scrollbarWidth,\n          targetInline,\n          targetInline + targetWidth,\n          targetWidth\n        )\n      }\n\n      const { scrollLeft, scrollTop } = frame\n      // Ensure scroll coordinates are not out of bounds while applying scroll offsets\n      blockScroll =\n        scaleY === 0\n          ? 0\n          : Math.max(\n              0,\n              Math.min(\n                scrollTop + blockScroll / scaleY,\n                frame.scrollHeight - height / scaleY + scrollbarHeight\n              )\n            )\n      inlineScroll =\n        scaleX === 0\n          ? 0\n          : Math.max(\n              0,\n              Math.min(\n                scrollLeft + inlineScroll / scaleX,\n                frame.scrollWidth - width / scaleX + scrollbarWidth\n              )\n            )\n\n      // Cache the offset so that parent frames can scroll this into view correctly\n      targetBlock += scrollTop - blockScroll\n      targetInline += scrollLeft - inlineScroll\n    }\n\n    computations.push({ el: frame, top: blockScroll, left: inlineScroll })\n  }\n\n  return computations\n}\n", "import { compute } from 'compute-scroll-into-view'\nimport type {\n  Options as BaseOptions,\n  ScrollAction,\n} from 'compute-scroll-into-view'\n\n/** @public */\nexport type Options<T = unknown> =\n  | StandardBehaviorOptions\n  | CustomBehaviorOptions<T>\n\n/**\n * Only scrolls if the `node` is partially out of view:\n * ```ts\n * scrollIntoView(node, { scrollMode: 'if-needed' })\n * ```\n * Skips scrolling `overflow: hidden` elements:\n * ```ts\n * scrollIntoView(node, { skipOverflowHiddenElements: true })\n * ```\n * When scrolling is needed do the least and smoothest scrolling possible:\n * ```ts\n * scrollIntoView(node, {\n *   behavior: 'smooth',\n *   scrollMode: 'if-needed',\n *   block: 'nearest',\n *   inline: 'nearest',\n * })\n * ```\n * @public\n */\nexport interface StandardBehaviorOptions extends BaseOptions {\n  /**\n   * @defaultValue 'auto\n   */\n  behavior?: ScrollBehavior\n}\n\n/** @public */\nexport interface CustomBehaviorOptions<T = unknown> extends BaseOptions {\n  behavior: CustomScrollBehaviorCallback<T>\n}\n\n/** @public */\nexport type CustomScrollBehaviorCallback<T = unknown> = (\n  actions: ScrollAction[]\n) => T\n\nconst isStandardScrollBehavior = (\n  options: any\n): options is StandardBehaviorOptions =>\n  options === Object(options) && Object.keys(options).length !== 0\n\nconst isCustomScrollBehavior = <T = unknown>(\n  options: any\n): options is CustomBehaviorOptions<T> =>\n  typeof options === 'object' ? typeof options.behavior === 'function' : false\n\nconst getOptions = (options: any): StandardBehaviorOptions => {\n  // Handle alignToTop for legacy reasons, to be compatible with the spec\n  if (options === false) {\n    return { block: 'end', inline: 'nearest' }\n  }\n\n  if (isStandardScrollBehavior(options)) {\n    // compute.ts ensures the defaults are block: 'center' and inline: 'nearest', to conform to the spec\n    return options\n  }\n\n  // if options = {}, options = true or options = null, based on w3c web platform test\n  return { block: 'start', inline: 'nearest' }\n}\n\nconst getScrollMargins = (target: Element) => {\n  const computedStyle = window.getComputedStyle(target)\n  return {\n    top: parseFloat(computedStyle.scrollMarginTop) || 0,\n    right: parseFloat(computedStyle.scrollMarginRight) || 0,\n    bottom: parseFloat(computedStyle.scrollMarginBottom) || 0,\n    left: parseFloat(computedStyle.scrollMarginLeft) || 0,\n  }\n}\n\n// Determine if the element is part of the document (including shadow dom)\n// Derived from code of Andy Desmarais\n// https://terodox.tech/how-to-tell-if-an-element-is-in-the-dom-including-the-shadow-dom/\nconst isInDocument = (element: Node) => {\n  let currentElement = element\n  while (currentElement && currentElement.parentNode) {\n    if (currentElement.parentNode === document) {\n      return true\n    } else if (currentElement.parentNode instanceof ShadowRoot) {\n      currentElement = (currentElement.parentNode as ShadowRoot).host\n    } else {\n      currentElement = currentElement.parentNode\n    }\n  }\n  return false\n}\n\n/**\n * Scrolls the given element into view, with options for when, and how.\n * Supports the same `options` as [`Element.prototype.scrollIntoView`](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView) with additions such as `scrollMode`, `behavior: Function` and `skipOverflowHiddenElements`.\n * @public\n */\nfunction scrollIntoView(\n  target: Element,\n  options?: StandardBehaviorOptions | boolean\n): void\n/**\n * Scrolls the given element into view, with options for when, and how.\n * Supports the same `options` as [`Element.prototype.scrollIntoView`](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView) with additions such as `scrollMode`, `behavior: Function` and `skipOverflowHiddenElements`.\n *\n * You can set the expected return type for `behavior: Function`:\n * ```ts\n * await scrollIntoView<Promise<boolean[]>>(node, {\n *   behavior: async actions => {\n *     return Promise.all(actions.map(\n *       // animate() resolves to `true` if anything was animated, `false` if the element already were in the end state\n *       ({ el, left, top }) => animate(el, {scroll: {left, top}})\n *     ))\n *   }\n * })\n * ```\n * @public\n */\nfunction scrollIntoView<T>(\n  target: Element,\n  options: CustomBehaviorOptions<T>\n): T\nfunction scrollIntoView<T = unknown>(\n  target: Element,\n  options?: StandardBehaviorOptions | CustomBehaviorOptions<T> | boolean\n): T | void {\n  // Browsers treats targets that aren't in the dom as a no-op and so should we\n  if (!target.isConnected || !isInDocument(target)) {\n    return\n  }\n\n  const margins = getScrollMargins(target)\n\n  if (isCustomScrollBehavior<T>(options)) {\n    return options.behavior(compute(target, options))\n  }\n\n  const behavior = typeof options === 'boolean' ? undefined : options?.behavior\n\n  for (const { el, top, left } of compute(target, getOptions(options))) {\n    const adjustedTop = top - margins.top + margins.bottom\n    const adjustedLeft = left - margins.left + margins.right\n    el.scroll({ top: adjustedTop, left: adjustedLeft, behavior })\n  }\n}\n\nexport default scrollIntoView\n", "var resizeObservers = [];\nexport { resizeObservers };\n", "import { resizeObservers } from '../utils/resizeObservers';\nvar hasActiveObservations = function () {\n    return resizeObservers.some(function (ro) { return ro.activeTargets.length > 0; });\n};\nexport { hasActiveObservations };\n", "import { resizeObservers } from '../utils/resizeObservers';\nvar hasSkippedObservations = function () {\n    return resizeObservers.some(function (ro) { return ro.skippedTargets.length > 0; });\n};\nexport { hasSkippedObservations };\n", "var msg = 'ResizeObserver loop completed with undelivered notifications.';\nvar deliverResizeLoopError = function () {\n    var event;\n    if (typeof ErrorEvent === 'function') {\n        event = new ErrorEvent('error', {\n            message: msg\n        });\n    }\n    else {\n        event = document.createEvent('Event');\n        event.initEvent('error', false, false);\n        event.message = msg;\n    }\n    window.dispatchEvent(event);\n};\nexport { deliverResizeLoopError };\n", "var ResizeObserverBoxOptions;\n(function (ResizeObserverBoxOptions) {\n    ResizeObserverBoxOptions[\"BORDER_BOX\"] = \"border-box\";\n    ResizeObserverBoxOptions[\"CONTENT_BOX\"] = \"content-box\";\n    ResizeObserverBoxOptions[\"DEVICE_PIXEL_CONTENT_BOX\"] = \"device-pixel-content-box\";\n})(ResizeObserverBoxOptions || (ResizeObserverBoxOptions = {}));\nexport { ResizeObserverBoxOptions };\n", "export var freeze = function (obj) { return Object.freeze(obj); };\n", "import { freeze } from './utils/freeze';\nvar ResizeObserverSize = (function () {\n    function ResizeObserverSize(inlineSize, blockSize) {\n        this.inlineSize = inlineSize;\n        this.blockSize = blockSize;\n        freeze(this);\n    }\n    return ResizeObserverSize;\n}());\nexport { ResizeObserverSize };\n", "import { freeze } from './utils/freeze';\nvar DOMRectReadOnly = (function () {\n    function DOMRectReadOnly(x, y, width, height) {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n        this.top = this.y;\n        this.left = this.x;\n        this.bottom = this.top + this.height;\n        this.right = this.left + this.width;\n        return freeze(this);\n    }\n    DOMRectReadOnly.prototype.toJSON = function () {\n        var _a = this, x = _a.x, y = _a.y, top = _a.top, right = _a.right, bottom = _a.bottom, left = _a.left, width = _a.width, height = _a.height;\n        return { x: x, y: y, top: top, right: right, bottom: bottom, left: left, width: width, height: height };\n    };\n    DOMRectReadOnly.fromRect = function (rectangle) {\n        return new DOMRectReadOnly(rectangle.x, rectangle.y, rectangle.width, rectangle.height);\n    };\n    return DOMRectReadOnly;\n}());\nexport { DOMRectReadOnly };\n", "var isSVG = function (target) { return target instanceof SVGElement && 'getBBox' in target; };\nvar isHidden = function (target) {\n    if (isSVG(target)) {\n        var _a = target.getBBox(), width = _a.width, height = _a.height;\n        return !width && !height;\n    }\n    var _b = target, offsetWidth = _b.offsetWidth, offsetHeight = _b.offsetHeight;\n    return !(offsetWidth || offsetHeight || target.getClientRects().length);\n};\nvar isElement = function (obj) {\n    var _a;\n    if (obj instanceof Element) {\n        return true;\n    }\n    var scope = (_a = obj === null || obj === void 0 ? void 0 : obj.ownerDocument) === null || _a === void 0 ? void 0 : _a.defaultView;\n    return !!(scope && obj instanceof scope.Element);\n};\nvar isReplacedElement = function (target) {\n    switch (target.tagName) {\n        case 'INPUT':\n            if (target.type !== 'image') {\n                break;\n            }\n        case 'VIDEO':\n        case 'AUDIO':\n        case 'EMBED':\n        case 'OBJECT':\n        case 'CANVAS':\n        case 'IFRAME':\n        case 'IMG':\n            return true;\n    }\n    return false;\n};\nexport { isSVG, isHidden, isElement, isReplacedElement };\n", "export var global = typeof window !== 'undefined' ? window : {};\n", "import { ResizeObserverBoxOptions } from '../ResizeObserverBoxOptions';\nimport { ResizeObserverSize } from '../ResizeObserverSize';\nimport { DOMRectReadOnly } from '../DOMRectReadOnly';\nimport { isSVG, isHidden } from '../utils/element';\nimport { freeze } from '../utils/freeze';\nimport { global } from '../utils/global';\nvar cache = new WeakMap();\nvar scrollRegexp = /auto|scroll/;\nvar verticalRegexp = /^tb|vertical/;\nvar IE = (/msie|trident/i).test(global.navigator && global.navigator.userAgent);\nvar parseDimension = function (pixel) { return parseFloat(pixel || '0'); };\nvar size = function (inlineSize, blockSize, switchSizes) {\n    if (inlineSize === void 0) { inlineSize = 0; }\n    if (blockSize === void 0) { blockSize = 0; }\n    if (switchSizes === void 0) { switchSizes = false; }\n    return new ResizeObserverSize((switchSizes ? blockSize : inlineSize) || 0, (switchSizes ? inlineSize : blockSize) || 0);\n};\nvar zeroBoxes = freeze({\n    devicePixelContentBoxSize: size(),\n    borderBoxSize: size(),\n    contentBoxSize: size(),\n    contentRect: new DOMRectReadOnly(0, 0, 0, 0)\n});\nvar calculateBoxSizes = function (target, forceRecalculation) {\n    if (forceRecalculation === void 0) { forceRecalculation = false; }\n    if (cache.has(target) && !forceRecalculation) {\n        return cache.get(target);\n    }\n    if (isHidden(target)) {\n        cache.set(target, zeroBoxes);\n        return zeroBoxes;\n    }\n    var cs = getComputedStyle(target);\n    var svg = isSVG(target) && target.ownerSVGElement && target.getBBox();\n    var removePadding = !IE && cs.boxSizing === 'border-box';\n    var switchSizes = verticalRegexp.test(cs.writingMode || '');\n    var canScrollVertically = !svg && scrollRegexp.test(cs.overflowY || '');\n    var canScrollHorizontally = !svg && scrollRegexp.test(cs.overflowX || '');\n    var paddingTop = svg ? 0 : parseDimension(cs.paddingTop);\n    var paddingRight = svg ? 0 : parseDimension(cs.paddingRight);\n    var paddingBottom = svg ? 0 : parseDimension(cs.paddingBottom);\n    var paddingLeft = svg ? 0 : parseDimension(cs.paddingLeft);\n    var borderTop = svg ? 0 : parseDimension(cs.borderTopWidth);\n    var borderRight = svg ? 0 : parseDimension(cs.borderRightWidth);\n    var borderBottom = svg ? 0 : parseDimension(cs.borderBottomWidth);\n    var borderLeft = svg ? 0 : parseDimension(cs.borderLeftWidth);\n    var horizontalPadding = paddingLeft + paddingRight;\n    var verticalPadding = paddingTop + paddingBottom;\n    var horizontalBorderArea = borderLeft + borderRight;\n    var verticalBorderArea = borderTop + borderBottom;\n    var horizontalScrollbarThickness = !canScrollHorizontally ? 0 : target.offsetHeight - verticalBorderArea - target.clientHeight;\n    var verticalScrollbarThickness = !canScrollVertically ? 0 : target.offsetWidth - horizontalBorderArea - target.clientWidth;\n    var widthReduction = removePadding ? horizontalPadding + horizontalBorderArea : 0;\n    var heightReduction = removePadding ? verticalPadding + verticalBorderArea : 0;\n    var contentWidth = svg ? svg.width : parseDimension(cs.width) - widthReduction - verticalScrollbarThickness;\n    var contentHeight = svg ? svg.height : parseDimension(cs.height) - heightReduction - horizontalScrollbarThickness;\n    var borderBoxWidth = contentWidth + horizontalPadding + verticalScrollbarThickness + horizontalBorderArea;\n    var borderBoxHeight = contentHeight + verticalPadding + horizontalScrollbarThickness + verticalBorderArea;\n    var boxes = freeze({\n        devicePixelContentBoxSize: size(Math.round(contentWidth * devicePixelRatio), Math.round(contentHeight * devicePixelRatio), switchSizes),\n        borderBoxSize: size(borderBoxWidth, borderBoxHeight, switchSizes),\n        contentBoxSize: size(contentWidth, contentHeight, switchSizes),\n        contentRect: new DOMRectReadOnly(paddingLeft, paddingTop, contentWidth, contentHeight)\n    });\n    cache.set(target, boxes);\n    return boxes;\n};\nvar calculateBoxSize = function (target, observedBox, forceRecalculation) {\n    var _a = calculateBoxSizes(target, forceRecalculation), borderBoxSize = _a.borderBoxSize, contentBoxSize = _a.contentBoxSize, devicePixelContentBoxSize = _a.devicePixelContentBoxSize;\n    switch (observedBox) {\n        case ResizeObserverBoxOptions.DEVICE_PIXEL_CONTENT_BOX:\n            return devicePixelContentBoxSize;\n        case ResizeObserverBoxOptions.BORDER_BOX:\n            return borderBoxSize;\n        default:\n            return contentBoxSize;\n    }\n};\nexport { calculateBoxSize, calculateBoxSizes };\n", "import { calculateBoxSizes } from './algorithms/calculateBoxSize';\nimport { freeze } from './utils/freeze';\nvar ResizeObserverEntry = (function () {\n    function ResizeObserverEntry(target) {\n        var boxes = calculateBoxSizes(target);\n        this.target = target;\n        this.contentRect = boxes.contentRect;\n        this.borderBoxSize = freeze([boxes.borderBoxSize]);\n        this.contentBoxSize = freeze([boxes.contentBoxSize]);\n        this.devicePixelContentBoxSize = freeze([boxes.devicePixelContentBoxSize]);\n    }\n    return ResizeObserverEntry;\n}());\nexport { ResizeObserverEntry };\n", "import { isHidden } from '../utils/element';\nvar calculateDepthForNode = function (node) {\n    if (isHidden(node)) {\n        return Infinity;\n    }\n    var depth = 0;\n    var parent = node.parentNode;\n    while (parent) {\n        depth += 1;\n        parent = parent.parentNode;\n    }\n    return depth;\n};\nexport { calculateDepthForNode };\n", "import { resizeObservers } from '../utils/resizeObservers';\nimport { ResizeObserverEntry } from '../ResizeObserverEntry';\nimport { calculateDepthForNode } from './calculateDepthForNode';\nimport { calculateBoxSize } from './calculateBoxSize';\nvar broadcastActiveObservations = function () {\n    var shallowestDepth = Infinity;\n    var callbacks = [];\n    resizeObservers.forEach(function processObserver(ro) {\n        if (ro.activeTargets.length === 0) {\n            return;\n        }\n        var entries = [];\n        ro.activeTargets.forEach(function processTarget(ot) {\n            var entry = new ResizeObserverEntry(ot.target);\n            var targetDepth = calculateDepthForNode(ot.target);\n            entries.push(entry);\n            ot.lastReportedSize = calculateBoxSize(ot.target, ot.observedBox);\n            if (targetDepth < shallowestDepth) {\n                shallowestDepth = targetDepth;\n            }\n        });\n        callbacks.push(function resizeObserverCallback() {\n            ro.callback.call(ro.observer, entries, ro.observer);\n        });\n        ro.activeTargets.splice(0, ro.activeTargets.length);\n    });\n    for (var _i = 0, callbacks_1 = callbacks; _i < callbacks_1.length; _i++) {\n        var callback = callbacks_1[_i];\n        callback();\n    }\n    return shallowestDepth;\n};\nexport { broadcastActiveObservations };\n", "import { resizeObservers } from '../utils/resizeObservers';\nimport { calculateDepthForNode } from './calculateDepthForNode';\nvar gatherActiveObservationsAtDepth = function (depth) {\n    resizeObservers.forEach(function processObserver(ro) {\n        ro.activeTargets.splice(0, ro.activeTargets.length);\n        ro.skippedTargets.splice(0, ro.skippedTargets.length);\n        ro.observationTargets.forEach(function processTarget(ot) {\n            if (ot.isActive()) {\n                if (calculateDepthForNode(ot.target) > depth) {\n                    ro.activeTargets.push(ot);\n                }\n                else {\n                    ro.skippedTargets.push(ot);\n                }\n            }\n        });\n    });\n};\nexport { gatherActiveObservationsAtDepth };\n", "import { hasActiveObservations } from '../algorithms/hasActiveObservations';\nimport { hasSkippedObservations } from '../algorithms/hasSkippedObservations';\nimport { deliverResizeLoopError } from '../algorithms/deliverResizeLoopError';\nimport { broadcastActiveObservations } from '../algorithms/broadcastActiveObservations';\nimport { gatherActiveObservationsAtDepth } from '../algorithms/gatherActiveObservationsAtDepth';\nvar process = function () {\n    var depth = 0;\n    gatherActiveObservationsAtDepth(depth);\n    while (hasActiveObservations()) {\n        depth = broadcastActiveObservations();\n        gatherActiveObservationsAtDepth(depth);\n    }\n    if (hasSkippedObservations()) {\n        deliverResizeLoopError();\n    }\n    return depth > 0;\n};\nexport { process };\n", "var trigger;\nvar callbacks = [];\nvar notify = function () { return callbacks.splice(0).forEach(function (cb) { return cb(); }); };\nvar queueMicroTask = function (callback) {\n    if (!trigger) {\n        var toggle_1 = 0;\n        var el_1 = document.createTextNode('');\n        var config = { characterData: true };\n        new MutationObserver(function () { return notify(); }).observe(el_1, config);\n        trigger = function () { el_1.textContent = \"\".concat(toggle_1 ? toggle_1-- : toggle_1++); };\n    }\n    callbacks.push(callback);\n    trigger();\n};\nexport { queueMicroTask };\n", "import { queueMicroTask } from './queueMicroTask';\nvar queueResizeObserver = function (cb) {\n    queueMicroTask(function ResizeObserver() {\n        requestAnimationFrame(cb);\n    });\n};\nexport { queueResizeObserver };\n", "import { process } from './process';\nimport { global } from './global';\nimport { queueResizeObserver } from './queueResizeObserver';\nvar watching = 0;\nvar isWatching = function () { return !!watching; };\nvar CATCH_PERIOD = 250;\nvar observerConfig = { attributes: true, characterData: true, childList: true, subtree: true };\nvar events = [\n    'resize',\n    'load',\n    'transitionend',\n    'animationend',\n    'animationstart',\n    'animationiteration',\n    'keyup',\n    'keydown',\n    'mouseup',\n    'mousedown',\n    'mouseover',\n    'mouseout',\n    'blur',\n    'focus'\n];\nvar time = function (timeout) {\n    if (timeout === void 0) { timeout = 0; }\n    return Date.now() + timeout;\n};\nvar scheduled = false;\nvar Scheduler = (function () {\n    function Scheduler() {\n        var _this = this;\n        this.stopped = true;\n        this.listener = function () { return _this.schedule(); };\n    }\n    Scheduler.prototype.run = function (timeout) {\n        var _this = this;\n        if (timeout === void 0) { timeout = CATCH_PERIOD; }\n        if (scheduled) {\n            return;\n        }\n        scheduled = true;\n        var until = time(timeout);\n        queueResizeObserver(function () {\n            var elementsHaveResized = false;\n            try {\n                elementsHaveResized = process();\n            }\n            finally {\n                scheduled = false;\n                timeout = until - time();\n                if (!isWatching()) {\n                    return;\n                }\n                if (elementsHaveResized) {\n                    _this.run(1000);\n                }\n                else if (timeout > 0) {\n                    _this.run(timeout);\n                }\n                else {\n                    _this.start();\n                }\n            }\n        });\n    };\n    Scheduler.prototype.schedule = function () {\n        this.stop();\n        this.run();\n    };\n    Scheduler.prototype.observe = function () {\n        var _this = this;\n        var cb = function () { return _this.observer && _this.observer.observe(document.body, observerConfig); };\n        document.body ? cb() : global.addEventListener('DOMContentLoaded', cb);\n    };\n    Scheduler.prototype.start = function () {\n        var _this = this;\n        if (this.stopped) {\n            this.stopped = false;\n            this.observer = new MutationObserver(this.listener);\n            this.observe();\n            events.forEach(function (name) { return global.addEventListener(name, _this.listener, true); });\n        }\n    };\n    Scheduler.prototype.stop = function () {\n        var _this = this;\n        if (!this.stopped) {\n            this.observer && this.observer.disconnect();\n            events.forEach(function (name) { return global.removeEventListener(name, _this.listener, true); });\n            this.stopped = true;\n        }\n    };\n    return Scheduler;\n}());\nvar scheduler = new Scheduler();\nvar updateCount = function (n) {\n    !watching && n > 0 && scheduler.start();\n    watching += n;\n    !watching && scheduler.stop();\n};\nexport { scheduler, updateCount };\n", "import { ResizeObserverBoxOptions } from './ResizeObserverBoxOptions';\nimport { calculateBoxSize } from './algorithms/calculateBoxSize';\nimport { isSVG, isReplacedElement } from './utils/element';\nvar skipNotifyOnElement = function (target) {\n    return !isSVG(target)\n        && !isReplacedElement(target)\n        && getComputedStyle(target).display === 'inline';\n};\nvar ResizeObservation = (function () {\n    function ResizeObservation(target, observedBox) {\n        this.target = target;\n        this.observedBox = observedBox || ResizeObserverBoxOptions.CONTENT_BOX;\n        this.lastReportedSize = {\n            inlineSize: 0,\n            blockSize: 0\n        };\n    }\n    ResizeObservation.prototype.isActive = function () {\n        var size = calculateBoxSize(this.target, this.observedBox, true);\n        if (skipNotifyOnElement(this.target)) {\n            this.lastReportedSize = size;\n        }\n        if (this.lastReportedSize.inlineSize !== size.inlineSize\n            || this.lastReportedSize.blockSize !== size.blockSize) {\n            return true;\n        }\n        return false;\n    };\n    return ResizeObservation;\n}());\nexport { ResizeObservation };\n", "var ResizeObserverDetail = (function () {\n    function ResizeObserverDetail(resizeObserver, callback) {\n        this.activeTargets = [];\n        this.skippedTargets = [];\n        this.observationTargets = [];\n        this.observer = resizeObserver;\n        this.callback = callback;\n    }\n    return ResizeObserverDetail;\n}());\nexport { ResizeObserverDetail };\n", "import { scheduler, updateCount } from './utils/scheduler';\nimport { ResizeObservation } from './ResizeObservation';\nimport { ResizeObserverDetail } from './ResizeObserverDetail';\nimport { resizeObservers } from './utils/resizeObservers';\nvar observerMap = new WeakMap();\nvar getObservationIndex = function (observationTargets, target) {\n    for (var i = 0; i < observationTargets.length; i += 1) {\n        if (observationTargets[i].target === target) {\n            return i;\n        }\n    }\n    return -1;\n};\nvar ResizeObserverController = (function () {\n    function ResizeObserverController() {\n    }\n    ResizeObserverController.connect = function (resizeObserver, callback) {\n        var detail = new ResizeObserverDetail(resizeObserver, callback);\n        observerMap.set(resizeObserver, detail);\n    };\n    ResizeObserverController.observe = function (resizeObserver, target, options) {\n        var detail = observerMap.get(resizeObserver);\n        var firstObservation = detail.observationTargets.length === 0;\n        if (getObservationIndex(detail.observationTargets, target) < 0) {\n            firstObservation && resizeObservers.push(detail);\n            detail.observationTargets.push(new ResizeObservation(target, options && options.box));\n            updateCount(1);\n            scheduler.schedule();\n        }\n    };\n    ResizeObserverController.unobserve = function (resizeObserver, target) {\n        var detail = observerMap.get(resizeObserver);\n        var index = getObservationIndex(detail.observationTargets, target);\n        var lastObservation = detail.observationTargets.length === 1;\n        if (index >= 0) {\n            lastObservation && resizeObservers.splice(resizeObservers.indexOf(detail), 1);\n            detail.observationTargets.splice(index, 1);\n            updateCount(-1);\n        }\n    };\n    ResizeObserverController.disconnect = function (resizeObserver) {\n        var _this = this;\n        var detail = observerMap.get(resizeObserver);\n        detail.observationTargets.slice().forEach(function (ot) { return _this.unobserve(resizeObserver, ot.target); });\n        detail.activeTargets.splice(0, detail.activeTargets.length);\n    };\n    return ResizeObserverController;\n}());\nexport { ResizeObserverController };\n", "import { ResizeObserverController } from './ResizeObserverController';\nimport { isElement } from './utils/element';\nvar ResizeObserver = (function () {\n    function ResizeObserver(callback) {\n        if (arguments.length === 0) {\n            throw new TypeError(\"Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.\");\n        }\n        if (typeof callback !== 'function') {\n            throw new TypeError(\"Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.\");\n        }\n        ResizeObserverController.connect(this, callback);\n    }\n    ResizeObserver.prototype.observe = function (target, options) {\n        if (arguments.length === 0) {\n            throw new TypeError(\"Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.\");\n        }\n        if (!isElement(target)) {\n            throw new TypeError(\"Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element\");\n        }\n        ResizeObserverController.observe(this, target, options);\n    };\n    ResizeObserver.prototype.unobserve = function (target) {\n        if (arguments.length === 0) {\n            throw new TypeError(\"Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.\");\n        }\n        if (!isElement(target)) {\n            throw new TypeError(\"Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element\");\n        }\n        ResizeObserverController.unobserve(this, target);\n    };\n    ResizeObserver.prototype.disconnect = function () {\n        ResizeObserverController.disconnect(this);\n    };\n    ResizeObserver.toString = function () {\n        return 'function ResizeObserver () { [polyfill code] }';\n    };\n    return ResizeObserver;\n}());\nexport { ResizeObserver };\n", "export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}", "import objectWithoutPropertiesLoose from \"./objectWithoutPropertiesLoose.js\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}", "export default function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}", "import _typeof from \"./typeof.js\";\nexport default function _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}", "import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}", "import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}", "import { createContext, useContext } from 'react'\nimport { Editor } from 'slate'\nimport { ReactEditor } from '../plugin/react-editor'\n\n/**\n * A React context for sharing the editor object.\n */\n\nexport const EditorContext = createContext<ReactEditor | null>(null)\n\n/**\n * Get the current editor object from the React context.\n */\n\nexport const useSlateStatic = (): Editor => {\n  const editor = useContext(EditorContext)\n\n  if (!editor) {\n    throw new Error(\n      `The \\`useSlateStatic\\` hook must be used inside the <Slate> component's context.`\n    )\n  }\n\n  return editor\n}\n", "import React from 'react'\n\nexport const REACT_MAJOR_VERSION = parseInt(React.version.split('.')[0], 10)\n\nexport const IS_IOS =\n  typeof navigator !== 'undefined' &&\n  typeof window !== 'undefined' &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n  !window.MSStream\n\nexport const IS_APPLE =\n  typeof navigator !== 'undefined' && /Mac OS X/.test(navigator.userAgent)\n\nexport const IS_ANDROID =\n  typeof navigator !== 'undefined' && /Android/.test(navigator.userAgent)\n\nexport const IS_FIREFOX =\n  typeof navigator !== 'undefined' &&\n  /^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent)\n\nexport const IS_WEBKIT =\n  typeof navigator !== 'undefined' &&\n  /AppleWebKit(?!.*Chrome)/i.test(navigator.userAgent)\n\n// \"modern\" Edge was released at 79.x\nexport const IS_EDGE_LEGACY =\n  typeof navigator !== 'undefined' &&\n  /Edge?\\/(?:[0-6][0-9]|[0-7][0-8])(?:\\.)/i.test(navigator.userAgent)\n\nexport const IS_CHROME =\n  typeof navigator !== 'undefined' && /Chrome/i.test(navigator.userAgent)\n\n// Native `beforeInput` events don't work well with react on Chrome 75\n// and older, Chrome 76+ can use `beforeInput` though.\nexport const IS_CHROME_LEGACY =\n  typeof navigator !== 'undefined' &&\n  /Chrome?\\/(?:[0-7][0-5]|[0-6][0-9])(?:\\.)/i.test(navigator.userAgent)\n\nexport const IS_ANDROID_CHROME_LEGACY =\n  IS_ANDROID &&\n  typeof navigator !== 'undefined' &&\n  /Chrome?\\/(?:[0-5]?\\d)(?:\\.)/i.test(navigator.userAgent)\n\n// Firefox did not support `beforeInput` until `v87`.\nexport const IS_FIREFOX_LEGACY =\n  typeof navigator !== 'undefined' &&\n  /^(?!.*Seamonkey)(?=.*Firefox\\/(?:[0-7][0-9]|[0-8][0-6])(?:\\.)).*/i.test(\n    navigator.userAgent\n  )\n\n// UC mobile browser\nexport const IS_UC_MOBILE =\n  typeof navigator !== 'undefined' && /.*UCBrowser/.test(navigator.userAgent)\n\n// Wechat browser (not including mac wechat)\nexport const IS_WECHATBROWSER =\n  typeof navigator !== 'undefined' &&\n  /.*Wechat/.test(navigator.userAgent) &&\n  !/.*MacWechat/.test(navigator.userAgent) // avoid lookbehind (buggy in safari < 16.4)\n\n// Check if DOM is available as React does internally.\n// https://github.com/facebook/react/blob/master/packages/shared/ExecutionEnvironment.js\nexport const CAN_USE_DOM = !!(\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined'\n)\n\n// Check if the browser is Safari and older than 17\nexport const IS_SAFARI_LEGACY =\n  typeof navigator !== 'undefined' &&\n  /Safari/.test(navigator.userAgent) &&\n  /Version\\/(\\d+)/.test(navigator.userAgent) &&\n  (navigator.userAgent.match(/Version\\/(\\d+)/)?.[1]\n    ? parseInt(navigator.userAgent.match(/Version\\/(\\d+)/)?.[1]!, 10) < 17\n    : false)\n\n// COMPAT: Firefox/Edge Legacy don't support the `beforeinput` event\n// Chrome Legacy doesn't support `beforeinput` correctly\nexport const HAS_BEFORE_INPUT_SUPPORT =\n  (!IS_CHROME_LEGACY || !IS_ANDROID_CHROME_LEGACY) &&\n  !IS_EDGE_LEGACY &&\n  // globalThis is undefined in older browsers\n  typeof globalThis !== 'undefined' &&\n  globalThis.InputEvent &&\n  // @ts-ignore The `getTargetRanges` property isn't recognized.\n  typeof globalThis.InputEvent.prototype.getTargetRanges === 'function'\n", "import { Ancestor, Editor, Node, Operation, Range, RangeRef, Text } from 'slate'\nimport { Action } from '../hooks/android-input-manager/android-input-manager'\nimport { TextDiff } from './diff-text'\nimport { Key } from './key'\n\n/**\n * Two weak maps that allow us rebuild a path given a node. They are populated\n * at render time such that after a render occurs we can always backtrack.\n */\nexport const IS_NODE_MAP_DIRTY: WeakMap<Editor, boolean> = new WeakMap()\nexport const NODE_TO_INDEX: WeakMap<Node, number> = new WeakMap()\nexport const NODE_TO_PARENT: WeakMap<Node, Ancestor> = new WeakMap()\n\n/**\n * Weak maps that allow us to go between Slate nodes and DOM nodes. These\n * are used to resolve DOM event-related logic into Slate actions.\n */\nexport const EDITOR_TO_WINDOW: WeakMap<Editor, Window> = new WeakMap()\nexport const EDITOR_TO_ELEMENT: WeakMap<Editor, HTMLElement> = new WeakMap()\nexport const EDITOR_TO_PLACEHOLDER: WeakMap<Editor, string> = new WeakMap()\nexport const EDITOR_TO_PLACEHOLDER_ELEMENT: WeakMap<Editor, HTMLElement> =\n  new WeakMap()\nexport const ELEMENT_TO_NODE: WeakMap<HTMLElement, Node> = new WeakMap()\nexport const NODE_TO_ELEMENT: WeakMap<Node, HTMLElement> = new WeakMap()\nexport const NODE_TO_KEY: WeakMap<Node, Key> = new WeakMap()\nexport const EDITOR_TO_KEY_TO_ELEMENT: WeakMap<\n  Editor,\n  WeakMap<Key, HTMLElement>\n> = new WeakMap()\n\n/**\n * Weak maps for storing editor-related state.\n */\n\nexport const IS_READ_ONLY: WeakMap<Editor, boolean> = new WeakMap()\nexport const IS_FOCUSED: WeakMap<Editor, boolean> = new WeakMap()\nexport const IS_COMPOSING: WeakMap<Editor, boolean> = new WeakMap()\n\nexport const EDITOR_TO_USER_SELECTION: WeakMap<Editor, RangeRef | null> =\n  new WeakMap()\n\n/**\n * Weak map for associating the context `onChange` context with the plugin.\n */\n\nexport const EDITOR_TO_ON_CHANGE = new WeakMap<\n  Editor,\n  (options?: { operation?: Operation }) => void\n>()\n\n/**\n * Weak maps for saving pending state on composition stage.\n */\n\nexport const EDITOR_TO_SCHEDULE_FLUSH: WeakMap<Editor, () => void> =\n  new WeakMap()\n\nexport const EDITOR_TO_PENDING_INSERTION_MARKS: WeakMap<\n  Editor,\n  Partial<Text> | null\n> = new WeakMap()\n\nexport const EDITOR_TO_USER_MARKS: WeakMap<Editor, Partial<Text> | null> =\n  new WeakMap()\n\n/**\n * Android input handling specific weak-maps\n */\n\nexport const EDITOR_TO_PENDING_DIFFS: WeakMap<Editor, TextDiff[]> =\n  new WeakMap()\n\nexport const EDITOR_TO_PENDING_ACTION: WeakMap<Editor, Action | null> =\n  new WeakMap()\n\nexport const EDITOR_TO_PENDING_SELECTION: WeakMap<Editor, Range | null> =\n  new WeakMap()\n\nexport const EDITOR_TO_FORCE_RENDER: WeakMap<Editor, () => void> = new WeakMap()\n\n/**\n * Symbols.\n */\n\nexport const PLACEHOLDER_SYMBOL = Symbol('placeholder') as unknown as string\nexport const MARK_PLACEHOLDER_SYMBOL = Symbol(\n  'mark-placeholder'\n) as unknown as string\n", "/**\n * Types.\n */\n\n// COMPAT: This is required to prevent TypeScript aliases from doing some very\n// weird things for Slate's types with the same name as globals. (2019/11/27)\n// https://github.com/microsoft/TypeScript/issues/35002\nimport DOMNode = globalThis.Node\nimport DOMComment = globalThis.Comment\nimport DOMElement = globalThis.Element\nimport DOMText = globalThis.Text\nimport DOMRange = globalThis.Range\nimport DOMSelection = globalThis.Selection\nimport DOMStaticRange = globalThis.StaticRange\nimport { ReactEditor } from '../plugin/react-editor'\n\nexport {\n  DOMNode,\n  DOMComment,\n  DOMElement,\n  DOMText,\n  DOMRange,\n  DOMSelection,\n  DOMStaticRange,\n}\n\ndeclare global {\n  interface Window {\n    Selection: (typeof Selection)['constructor']\n    DataTransfer: (typeof DataTransfer)['constructor']\n    Node: (typeof Node)['constructor']\n  }\n}\n\nexport type DOMPoint = [Node, number]\n\n/**\n * Returns the host window of a DOM node\n */\n\nexport const getDefaultView = (value: any): Window | null => {\n  return (\n    (value && value.ownerDocument && value.ownerDocument.defaultView) || null\n  )\n}\n\n/**\n * Check if a DOM node is a comment node.\n */\n\nexport const isDOMComment = (value: any): value is DOMComment => {\n  return isDOMNode(value) && value.nodeType === 8\n}\n\n/**\n * Check if a DOM node is an element node.\n */\n\nexport const isDOMElement = (value: any): value is DOMElement => {\n  return isDOMNode(value) && value.nodeType === 1\n}\n\n/**\n * Check if a value is a DOM node.\n */\n\nexport const isDOMNode = (value: any): value is DOMNode => {\n  const window = getDefaultView(value)\n  return !!window && value instanceof window.Node\n}\n\n/**\n * Check if a value is a DOM selection.\n */\n\nexport const isDOMSelection = (value: any): value is DOMSelection => {\n  const window = value && value.anchorNode && getDefaultView(value.anchorNode)\n  return !!window && value instanceof window.Selection\n}\n\n/**\n * Check if a DOM node is an element node.\n */\n\nexport const isDOMText = (value: any): value is DOMText => {\n  return isDOMNode(value) && value.nodeType === 3\n}\n\n/**\n * Checks whether a paste event is a plaintext-only event.\n */\n\nexport const isPlainTextOnlyPaste = (event: ClipboardEvent) => {\n  return (\n    event.clipboardData &&\n    event.clipboardData.getData('text/plain') !== '' &&\n    event.clipboardData.types.length === 1\n  )\n}\n\n/**\n * Normalize a DOM point so that it always refers to a text node.\n */\n\nexport const normalizeDOMPoint = (domPoint: DOMPoint): DOMPoint => {\n  let [node, offset] = domPoint\n\n  // If it's an element node, its offset refers to the index of its children\n  // including comment nodes, so try to find the right text child node.\n  if (isDOMElement(node) && node.childNodes.length) {\n    let isLast = offset === node.childNodes.length\n    let index = isLast ? offset - 1 : offset\n    ;[node, index] = getEditableChildAndIndex(\n      node,\n      index,\n      isLast ? 'backward' : 'forward'\n    )\n    // If the editable child found is in front of input offset, we instead seek to its end\n    isLast = index < offset\n\n    // If the node has children, traverse until we have a leaf node. Leaf nodes\n    // can be either text nodes, or other void DOM nodes.\n    while (isDOMElement(node) && node.childNodes.length) {\n      const i = isLast ? node.childNodes.length - 1 : 0\n      node = getEditableChild(node, i, isLast ? 'backward' : 'forward')\n    }\n\n    // Determine the new offset inside the text node.\n    offset = isLast && node.textContent != null ? node.textContent.length : 0\n  }\n\n  // Return the node and offset.\n  return [node, offset]\n}\n\n/**\n * Determines whether the active element is nested within a shadowRoot\n */\n\nexport const hasShadowRoot = (node: Node | null) => {\n  let parent = node && node.parentNode\n  while (parent) {\n    if (parent.toString() === '[object ShadowRoot]') {\n      return true\n    }\n    parent = parent.parentNode\n  }\n  return false\n}\n\n/**\n * Get the nearest editable child and index at `index` in a `parent`, preferring\n * `direction`.\n */\n\nexport const getEditableChildAndIndex = (\n  parent: DOMElement,\n  index: number,\n  direction: 'forward' | 'backward'\n): [DOMNode, number] => {\n  const { childNodes } = parent\n  let child = childNodes[index]\n  let i = index\n  let triedForward = false\n  let triedBackward = false\n\n  // While the child is a comment node, or an element node with no children,\n  // keep iterating to find a sibling non-void, non-comment node.\n  while (\n    isDOMComment(child) ||\n    (isDOMElement(child) && child.childNodes.length === 0) ||\n    (isDOMElement(child) && child.getAttribute('contenteditable') === 'false')\n  ) {\n    if (triedForward && triedBackward) {\n      break\n    }\n\n    if (i >= childNodes.length) {\n      triedForward = true\n      i = index - 1\n      direction = 'backward'\n      continue\n    }\n\n    if (i < 0) {\n      triedBackward = true\n      i = index + 1\n      direction = 'forward'\n      continue\n    }\n\n    child = childNodes[i]\n    index = i\n    i += direction === 'forward' ? 1 : -1\n  }\n\n  return [child, index]\n}\n\n/**\n * Get the nearest editable child at `index` in a `parent`, preferring\n * `direction`.\n */\n\nexport const getEditableChild = (\n  parent: DOMElement,\n  index: number,\n  direction: 'forward' | 'backward'\n): DOMNode => {\n  const [child] = getEditableChildAndIndex(parent, index, direction)\n  return child\n}\n\n/**\n * Get a plaintext representation of the content of a node, accounting for block\n * elements which get a newline appended.\n *\n * The domNode must be attached to the DOM.\n */\n\nexport const getPlainText = (domNode: DOMNode) => {\n  let text = ''\n\n  if (isDOMText(domNode) && domNode.nodeValue) {\n    return domNode.nodeValue\n  }\n\n  if (isDOMElement(domNode)) {\n    for (const childNode of Array.from(domNode.childNodes)) {\n      text += getPlainText(childNode)\n    }\n\n    const display = getComputedStyle(domNode).getPropertyValue('display')\n\n    if (display === 'block' || display === 'list' || domNode.tagName === 'BR') {\n      text += '\\n'\n    }\n  }\n\n  return text\n}\n\n/**\n * Get x-slate-fragment attribute from data-slate-fragment\n */\nconst catchSlateFragment = /data-slate-fragment=\"(.+?)\"/m\nexport const getSlateFragmentAttribute = (\n  dataTransfer: DataTransfer\n): string | void => {\n  const htmlData = dataTransfer.getData('text/html')\n  const [, fragment] = htmlData.match(catchSlateFragment) || []\n  return fragment\n}\n\n/**\n * Get the x-slate-fragment attribute that exist in text/html data\n * and append it to the DataTransfer object\n */\nexport const getClipboardData = (\n  dataTransfer: DataTransfer,\n  clipboardFormatKey = 'x-slate-fragment'\n): DataTransfer => {\n  if (!dataTransfer.getData(`application/${clipboardFormatKey}`)) {\n    const fragment = getSlateFragmentAttribute(dataTransfer)\n    if (fragment) {\n      const clipboardData = new DataTransfer()\n      dataTransfer.types.forEach(type => {\n        clipboardData.setData(type, dataTransfer.getData(type))\n      })\n      clipboardData.setData(`application/${clipboardFormatKey}`, fragment)\n      return clipboardData\n    }\n  }\n  return dataTransfer\n}\n\n/**\n * Get the dom selection from Shadow Root if possible, otherwise from the document\n */\nexport const getSelection = (root: Document | ShadowRoot): Selection | null => {\n  if (root.getSelection != null) {\n    return root.getSelection()\n  }\n  return document.getSelection()\n}\n\n/**\n * Check whether a mutation originates from a editable element inside the editor.\n */\n\nexport const isTrackedMutation = (\n  editor: ReactEditor,\n  mutation: MutationRecord,\n  batch: MutationRecord[]\n): boolean => {\n  const { target } = mutation\n  if (isDOMElement(target) && target.matches('[contentEditable=\"false\"]')) {\n    return false\n  }\n\n  const { document } = ReactEditor.getWindow(editor)\n  if (document.contains(target)) {\n    return ReactEditor.hasDOMNode(editor, target, { editable: true })\n  }\n\n  const parentMutation = batch.find(({ addedNodes, removedNodes }) => {\n    for (const node of addedNodes) {\n      if (node === target || node.contains(target)) {\n        return true\n      }\n    }\n\n    for (const node of removedNodes) {\n      if (node === target || node.contains(target)) {\n        return true\n      }\n    }\n  })\n\n  if (!parentMutation || parentMutation === mutation) {\n    return false\n  }\n\n  // Target add/remove is tracked. Track the mutation if we track the parent mutation.\n  return isTrackedMutation(editor, parentMutation, batch)\n}\n\n/**\n * Retrieves the deepest active element in the DOM, considering nested shadow DOMs.\n */\nexport const getActiveElement = () => {\n  let activeElement = document.activeElement\n\n  while (activeElement?.shadowRoot && activeElement.shadowRoot?.activeElement) {\n    activeElement = activeElement?.shadowRoot?.activeElement\n  }\n\n  return activeElement\n}\n\n/**\n * @returns `true` if `otherNode` is before `node` in the document; otherwise, `false`.\n */\nexport const isBefore = (node: DOMNode, otherNode: DOMNode): boolean =>\n  Boolean(\n    node.compareDocumentPosition(otherNode) &\n      DOMNode.DOCUMENT_POSITION_PRECEDING\n  )\n\n/**\n * @returns `true` if `otherNode` is after `node` in the document; otherwise, `false`.\n */\nexport const isAfter = (node: DOMNode, otherNode: DOMNode): boolean =>\n  Boolean(\n    node.compareDocumentPosition(otherNode) &\n      DOMNode.DOCUMENT_POSITION_FOLLOWING\n  )\n", "/**\n * An auto-incrementing identifier for keys.\n */\n\nlet n = 0\n\n/**\n * A class that keeps track of a key string. We use a full class here because we\n * want to be able to use them as keys in `WeakMap` objects.\n */\n\nexport class Key {\n  id: string\n\n  constructor() {\n    this.id = `${n++}`\n  }\n}\n", "import {\n  BaseEditor,\n  Editor,\n  Element,\n  Node,\n  Path,\n  Point,\n  Range,\n  Scrubber,\n  Transforms,\n} from 'slate'\nimport { TextDiff } from '../utils/diff-text'\nimport {\n  DOMElement,\n  DOMNode,\n  DOMPoint,\n  DOMRange,\n  DOMSelection,\n  DOMStaticRange,\n  DOMText,\n  getSelection,\n  hasShadowRoot,\n  isAfter,\n  isBefore,\n  isDOMElement,\n  isDOMNode,\n  isDOMSelection,\n  normalizeDOMPoint,\n} from '../utils/dom'\nimport { IS_ANDROID, IS_CHROME, IS_FIREFOX } from '../utils/environment'\n\nimport { Key } from '../utils/key'\nimport {\n  EDITOR_TO_ELEMENT,\n  EDITOR_TO_KEY_TO_ELEMENT,\n  EDITOR_TO_PENDING_DIFFS,\n  EDITOR_TO_SCHEDULE_FLUSH,\n  EDITOR_TO_WINDOW,\n  ELEMENT_TO_NODE,\n  IS_COMPOSING,\n  IS_FOCUSED,\n  IS_READ_ONLY,\n  NODE_TO_INDEX,\n  NODE_TO_KEY,\n  NODE_TO_PARENT,\n} from '../utils/weak-maps'\n\n/**\n * A React and DOM-specific version of the `Editor` interface.\n */\n\nexport interface ReactEditor extends BaseEditor {\n  hasEditableTarget: (\n    editor: ReactEditor,\n    target: EventTarget | null\n  ) => target is DOMNode\n  hasRange: (editor: ReactEditor, range: Range) => boolean\n  hasSelectableTarget: (\n    editor: ReactEditor,\n    target: EventTarget | null\n  ) => boolean\n  hasTarget: (\n    editor: ReactEditor,\n    target: EventTarget | null\n  ) => target is DOMNode\n  insertData: (data: DataTransfer) => void\n  insertFragmentData: (data: DataTransfer) => boolean\n  insertTextData: (data: DataTransfer) => boolean\n  isTargetInsideNonReadonlyVoid: (\n    editor: ReactEditor,\n    target: EventTarget | null\n  ) => boolean\n  setFragmentData: (\n    data: DataTransfer,\n    originEvent?: 'drag' | 'copy' | 'cut'\n  ) => void\n}\n\nexport interface ReactEditorInterface {\n  /**\n   * Experimental and android specific: Get pending diffs\n   */\n  androidPendingDiffs: (editor: Editor) => TextDiff[] | undefined\n\n  /**\n   * Experimental and android specific: Flush all pending diffs and cancel composition at the next possible time.\n   */\n  androidScheduleFlush: (editor: Editor) => void\n\n  /**\n   * Blur the editor.\n   */\n  blur: (editor: ReactEditor) => void\n\n  /**\n   * Deselect the editor.\n   */\n  deselect: (editor: ReactEditor) => void\n\n  /**\n   * Find the DOM node that implements DocumentOrShadowRoot for the editor.\n   */\n  findDocumentOrShadowRoot: (editor: ReactEditor) => Document | ShadowRoot\n\n  /**\n   * Get the target range from a DOM `event`.\n   */\n  findEventRange: (editor: ReactEditor, event: any) => Range\n\n  /**\n   * Find a key for a Slate node.\n   */\n  findKey: (editor: ReactEditor, node: Node) => Key\n\n  /**\n   * Find the path of Slate node.\n   */\n  findPath: (editor: ReactEditor, node: Node) => Path\n\n  /**\n   * Focus the editor.\n   */\n  focus: (editor: ReactEditor, options?: { retries: number }) => void\n\n  /**\n   * Return the host window of the current editor.\n   */\n  getWindow: (editor: ReactEditor) => Window\n\n  /**\n   * Check if a DOM node is within the editor.\n   */\n  hasDOMNode: (\n    editor: ReactEditor,\n    target: DOMNode,\n    options?: { editable?: boolean }\n  ) => boolean\n\n  /**\n   * Check if the target is editable and in the editor.\n   */\n  hasEditableTarget: (\n    editor: ReactEditor,\n    target: EventTarget | null\n  ) => target is DOMNode\n\n  /**\n   *\n   */\n  hasRange: (editor: ReactEditor, range: Range) => boolean\n\n  /**\n   * Check if the target can be selectable\n   */\n  hasSelectableTarget: (\n    editor: ReactEditor,\n    target: EventTarget | null\n  ) => boolean\n\n  /**\n   * Check if the target is in the editor.\n   */\n  hasTarget: (\n    editor: ReactEditor,\n    target: EventTarget | null\n  ) => target is DOMNode\n\n  /**\n   * Insert data from a `DataTransfer` into the editor.\n   */\n  insertData: (editor: ReactEditor, data: DataTransfer) => void\n\n  /**\n   * Insert fragment data from a `DataTransfer` into the editor.\n   */\n  insertFragmentData: (editor: ReactEditor, data: DataTransfer) => boolean\n\n  /**\n   * Insert text data from a `DataTransfer` into the editor.\n   */\n  insertTextData: (editor: ReactEditor, data: DataTransfer) => boolean\n\n  /**\n   * Check if the user is currently composing inside the editor.\n   */\n  isComposing: (editor: ReactEditor) => boolean\n\n  /**\n   * Check if the editor is focused.\n   */\n  isFocused: (editor: ReactEditor) => boolean\n\n  /**\n   * Check if the editor is in read-only mode.\n   */\n  isReadOnly: (editor: ReactEditor) => boolean\n\n  /**\n   * Check if the target is inside void and in an non-readonly editor.\n   */\n  isTargetInsideNonReadonlyVoid: (\n    editor: ReactEditor,\n    target: EventTarget | null\n  ) => boolean\n\n  /**\n   * Sets data from the currently selected fragment on a `DataTransfer`.\n   */\n  setFragmentData: (\n    editor: ReactEditor,\n    data: DataTransfer,\n    originEvent?: 'drag' | 'copy' | 'cut'\n  ) => void\n\n  /**\n   * Find the native DOM element from a Slate node.\n   */\n  toDOMNode: (editor: ReactEditor, node: Node) => HTMLElement\n\n  /**\n   * Find a native DOM selection point from a Slate point.\n   */\n  toDOMPoint: (editor: ReactEditor, point: Point) => DOMPoint\n\n  /**\n   * Find a native DOM range from a Slate `range`.\n   *\n   * Notice: the returned range will always be ordinal regardless of the direction of Slate `range` due to DOM API limit.\n   *\n   * there is no way to create a reverse DOM Range using Range.setStart/setEnd\n   * according to https://dom.spec.whatwg.org/#concept-range-bp-set.\n   */\n  toDOMRange: (editor: ReactEditor, range: Range) => DOMRange\n\n  /**\n   * Find a Slate node from a native DOM `element`.\n   */\n  toSlateNode: (editor: ReactEditor, domNode: DOMNode) => Node\n\n  /**\n   * Find a Slate point from a DOM selection's `domNode` and `domOffset`.\n   */\n  toSlatePoint: <T extends boolean>(\n    editor: ReactEditor,\n    domPoint: DOMPoint,\n    options: {\n      exactMatch: boolean\n      suppressThrow: T\n      /**\n       * The direction to search for Slate leaf nodes if `domPoint` is\n       * non-editable and non-void.\n       */\n      searchDirection?: 'forward' | 'backward'\n    }\n  ) => T extends true ? Point | null : Point\n\n  /**\n   * Find a Slate range from a DOM range or selection.\n   */\n  toSlateRange: <T extends boolean>(\n    editor: ReactEditor,\n    domRange: DOMRange | DOMStaticRange | DOMSelection,\n    options: {\n      exactMatch: boolean\n      suppressThrow: T\n    }\n  ) => T extends true ? Range | null : Range\n}\n\n// eslint-disable-next-line no-redeclare\nexport const ReactEditor: ReactEditorInterface = {\n  androidPendingDiffs: editor => EDITOR_TO_PENDING_DIFFS.get(editor),\n\n  androidScheduleFlush: editor => {\n    EDITOR_TO_SCHEDULE_FLUSH.get(editor)?.()\n  },\n\n  blur: editor => {\n    const el = ReactEditor.toDOMNode(editor, editor)\n    const root = ReactEditor.findDocumentOrShadowRoot(editor)\n    IS_FOCUSED.set(editor, false)\n\n    if (root.activeElement === el) {\n      el.blur()\n    }\n  },\n\n  deselect: editor => {\n    const { selection } = editor\n    const root = ReactEditor.findDocumentOrShadowRoot(editor)\n    const domSelection = getSelection(root)\n\n    if (domSelection && domSelection.rangeCount > 0) {\n      domSelection.removeAllRanges()\n    }\n\n    if (selection) {\n      Transforms.deselect(editor)\n    }\n  },\n\n  findDocumentOrShadowRoot: editor => {\n    const el = ReactEditor.toDOMNode(editor, editor)\n    const root = el.getRootNode()\n\n    if (root instanceof Document || root instanceof ShadowRoot) {\n      return root\n    }\n\n    return el.ownerDocument\n  },\n\n  findEventRange: (editor, event) => {\n    if ('nativeEvent' in event) {\n      event = event.nativeEvent\n    }\n\n    const { clientX: x, clientY: y, target } = event\n\n    if (x == null || y == null) {\n      throw new Error(`Cannot resolve a Slate range from a DOM event: ${event}`)\n    }\n\n    const node = ReactEditor.toSlateNode(editor, event.target)\n    const path = ReactEditor.findPath(editor, node)\n\n    // If the drop target is inside a void node, move it into either the\n    // next or previous node, depending on which side the `x` and `y`\n    // coordinates are closest to.\n    if (Element.isElement(node) && Editor.isVoid(editor, node)) {\n      const rect = target.getBoundingClientRect()\n      const isPrev = editor.isInline(node)\n        ? x - rect.left < rect.left + rect.width - x\n        : y - rect.top < rect.top + rect.height - y\n\n      const edge = Editor.point(editor, path, {\n        edge: isPrev ? 'start' : 'end',\n      })\n      const point = isPrev\n        ? Editor.before(editor, edge)\n        : Editor.after(editor, edge)\n\n      if (point) {\n        const range = Editor.range(editor, point)\n        return range\n      }\n    }\n\n    // Else resolve a range from the caret position where the drop occured.\n    let domRange\n    const { document } = ReactEditor.getWindow(editor)\n\n    // COMPAT: In Firefox, `caretRangeFromPoint` doesn't exist. (2016/07/25)\n    if (document.caretRangeFromPoint) {\n      domRange = document.caretRangeFromPoint(x, y)\n    } else {\n      const position = document.caretPositionFromPoint(x, y)\n\n      if (position) {\n        domRange = document.createRange()\n        domRange.setStart(position.offsetNode, position.offset)\n        domRange.setEnd(position.offsetNode, position.offset)\n      }\n    }\n\n    if (!domRange) {\n      throw new Error(`Cannot resolve a Slate range from a DOM event: ${event}`)\n    }\n\n    // Resolve a Slate range from the DOM range.\n    const range = ReactEditor.toSlateRange(editor, domRange, {\n      exactMatch: false,\n      suppressThrow: false,\n    })\n    return range\n  },\n\n  findKey: (editor, node) => {\n    let key = NODE_TO_KEY.get(node)\n\n    if (!key) {\n      key = new Key()\n      NODE_TO_KEY.set(node, key)\n    }\n\n    return key\n  },\n\n  findPath: (editor, node) => {\n    const path: Path = []\n    let child = node\n\n    while (true) {\n      const parent = NODE_TO_PARENT.get(child)\n\n      if (parent == null) {\n        if (Editor.isEditor(child)) {\n          return path\n        } else {\n          break\n        }\n      }\n\n      const i = NODE_TO_INDEX.get(child)\n\n      if (i == null) {\n        break\n      }\n\n      path.unshift(i)\n      child = parent\n    }\n\n    throw new Error(\n      `Unable to find the path for Slate node: ${Scrubber.stringify(node)}`\n    )\n  },\n\n  focus: (editor, options = { retries: 5 }) => {\n    // Return if already focused\n    if (IS_FOCUSED.get(editor)) {\n      return\n    }\n\n    // Retry setting focus if the editor has pending operations.\n    // The DOM (selection) is unstable while changes are applied.\n    // Retry until retries are exhausted or editor is focused.\n    if (options.retries <= 0) {\n      throw new Error(\n        'Could not set focus, editor seems stuck with pending operations'\n      )\n    }\n    if (editor.operations.length > 0) {\n      setTimeout(() => {\n        ReactEditor.focus(editor, { retries: options.retries - 1 })\n      }, 10)\n      return\n    }\n\n    const el = ReactEditor.toDOMNode(editor, editor)\n    const root = ReactEditor.findDocumentOrShadowRoot(editor)\n    if (root.activeElement !== el) {\n      // Ensure that the DOM selection state is set to the editor's selection\n      if (editor.selection && root instanceof Document) {\n        const domSelection = getSelection(root)\n        const domRange = ReactEditor.toDOMRange(editor, editor.selection)\n        domSelection?.removeAllRanges()\n        domSelection?.addRange(domRange)\n      }\n      // Create a new selection in the top of the document if missing\n      if (!editor.selection) {\n        Transforms.select(editor, Editor.start(editor, []))\n      }\n      // IS_FOCUSED should be set before calling el.focus() to ensure that\n      // FocusedContext is updated to the correct value\n      IS_FOCUSED.set(editor, true)\n      el.focus({ preventScroll: true })\n    }\n  },\n\n  getWindow: editor => {\n    const window = EDITOR_TO_WINDOW.get(editor)\n    if (!window) {\n      throw new Error('Unable to find a host window element for this editor')\n    }\n    return window\n  },\n\n  hasDOMNode: (editor, target, options = {}) => {\n    const { editable = false } = options\n    const editorEl = ReactEditor.toDOMNode(editor, editor)\n    let targetEl\n\n    // COMPAT: In Firefox, reading `target.nodeType` will throw an error if\n    // target is originating from an internal \"restricted\" element (e.g. a\n    // stepper arrow on a number input). (2018/05/04)\n    // https://github.com/ianstormtaylor/slate/issues/1819\n    try {\n      targetEl = (\n        isDOMElement(target) ? target : target.parentElement\n      ) as HTMLElement\n    } catch (err) {\n      if (\n        err instanceof Error &&\n        !err.message.includes('Permission denied to access property \"nodeType\"')\n      ) {\n        throw err\n      }\n    }\n\n    if (!targetEl) {\n      return false\n    }\n\n    return (\n      targetEl.closest(`[data-slate-editor]`) === editorEl &&\n      (!editable || targetEl.isContentEditable\n        ? true\n        : (typeof targetEl.isContentEditable === 'boolean' && // isContentEditable exists only on HTMLElement, and on other nodes it will be undefined\n            // this is the core logic that lets you know you got the right editor.selection instead of null when editor is contenteditable=\"false\"(readOnly)\n            targetEl.closest('[contenteditable=\"false\"]') === editorEl) ||\n          !!targetEl.getAttribute('data-slate-zero-width'))\n    )\n  },\n\n  hasEditableTarget: (editor, target): target is DOMNode =>\n    isDOMNode(target) &&\n    ReactEditor.hasDOMNode(editor, target, { editable: true }),\n\n  hasRange: (editor, range) => {\n    const { anchor, focus } = range\n    return (\n      Editor.hasPath(editor, anchor.path) && Editor.hasPath(editor, focus.path)\n    )\n  },\n\n  hasSelectableTarget: (editor, target) =>\n    ReactEditor.hasEditableTarget(editor, target) ||\n    ReactEditor.isTargetInsideNonReadonlyVoid(editor, target),\n\n  hasTarget: (editor, target): target is DOMNode =>\n    isDOMNode(target) && ReactEditor.hasDOMNode(editor, target),\n\n  insertData: (editor, data) => {\n    editor.insertData(data)\n  },\n\n  insertFragmentData: (editor, data) => editor.insertFragmentData(data),\n\n  insertTextData: (editor, data) => editor.insertTextData(data),\n\n  isComposing: editor => {\n    return !!IS_COMPOSING.get(editor)\n  },\n\n  isFocused: editor => !!IS_FOCUSED.get(editor),\n\n  isReadOnly: editor => !!IS_READ_ONLY.get(editor),\n\n  isTargetInsideNonReadonlyVoid: (editor, target) => {\n    if (IS_READ_ONLY.get(editor)) return false\n\n    const slateNode =\n      ReactEditor.hasTarget(editor, target) &&\n      ReactEditor.toSlateNode(editor, target)\n    return Element.isElement(slateNode) && Editor.isVoid(editor, slateNode)\n  },\n\n  setFragmentData: (editor, data, originEvent) =>\n    editor.setFragmentData(data, originEvent),\n\n  toDOMNode: (editor, node) => {\n    const KEY_TO_ELEMENT = EDITOR_TO_KEY_TO_ELEMENT.get(editor)\n    const domNode = Editor.isEditor(node)\n      ? EDITOR_TO_ELEMENT.get(editor)\n      : KEY_TO_ELEMENT?.get(ReactEditor.findKey(editor, node))\n\n    if (!domNode) {\n      throw new Error(\n        `Cannot resolve a DOM node from Slate node: ${Scrubber.stringify(node)}`\n      )\n    }\n\n    return domNode\n  },\n\n  toDOMPoint: (editor, point) => {\n    const [node] = Editor.node(editor, point.path)\n    const el = ReactEditor.toDOMNode(editor, node)\n    let domPoint: DOMPoint | undefined\n\n    // If we're inside a void node, force the offset to 0, otherwise the zero\n    // width spacing character will result in an incorrect offset of 1\n    if (Editor.void(editor, { at: point })) {\n      point = { path: point.path, offset: 0 }\n    }\n\n    // For each leaf, we need to isolate its content, which means filtering\n    // to its direct text and zero-width spans. (We have to filter out any\n    // other siblings that may have been rendered alongside them.)\n    const selector = `[data-slate-string], [data-slate-zero-width]`\n    const texts = Array.from(el.querySelectorAll(selector))\n    let start = 0\n\n    for (let i = 0; i < texts.length; i++) {\n      const text = texts[i]\n      const domNode = text.childNodes[0] as HTMLElement\n\n      if (domNode == null || domNode.textContent == null) {\n        continue\n      }\n\n      const { length } = domNode.textContent\n      const attr = text.getAttribute('data-slate-length')\n      const trueLength = attr == null ? length : parseInt(attr, 10)\n      const end = start + trueLength\n\n      // Prefer putting the selection inside the mark placeholder to ensure\n      // composed text is displayed with the correct marks.\n      const nextText = texts[i + 1]\n      if (\n        point.offset === end &&\n        nextText?.hasAttribute('data-slate-mark-placeholder')\n      ) {\n        const domText = nextText.childNodes[0]\n\n        domPoint = [\n          // COMPAT: If we don't explicity set the dom point to be on the actual\n          // dom text element, chrome will put the selection behind the actual dom\n          // text element, causing domRange.getBoundingClientRect() calls on a collapsed\n          // selection to return incorrect zero values (https://bugs.chromium.org/p/chromium/issues/detail?id=435438)\n          // which will cause issues when scrolling to it.\n          domText instanceof DOMText ? domText : nextText,\n          nextText.textContent?.startsWith('\\uFEFF') ? 1 : 0,\n        ]\n        break\n      }\n\n      if (point.offset <= end) {\n        const offset = Math.min(length, Math.max(0, point.offset - start))\n        domPoint = [domNode, offset]\n        break\n      }\n\n      start = end\n    }\n\n    if (!domPoint) {\n      throw new Error(\n        `Cannot resolve a DOM point from Slate point: ${Scrubber.stringify(\n          point\n        )}`\n      )\n    }\n\n    return domPoint\n  },\n\n  toDOMRange: (editor, range) => {\n    const { anchor, focus } = range\n    const isBackward = Range.isBackward(range)\n    const domAnchor = ReactEditor.toDOMPoint(editor, anchor)\n    const domFocus = Range.isCollapsed(range)\n      ? domAnchor\n      : ReactEditor.toDOMPoint(editor, focus)\n\n    const window = ReactEditor.getWindow(editor)\n    const domRange = window.document.createRange()\n    const [startNode, startOffset] = isBackward ? domFocus : domAnchor\n    const [endNode, endOffset] = isBackward ? domAnchor : domFocus\n\n    // A slate Point at zero-width Leaf always has an offset of 0 but a native DOM selection at\n    // zero-width node has an offset of 1 so we have to check if we are in a zero-width node and\n    // adjust the offset accordingly.\n    const startEl = (\n      isDOMElement(startNode) ? startNode : startNode.parentElement\n    ) as HTMLElement\n    const isStartAtZeroWidth = !!startEl.getAttribute('data-slate-zero-width')\n    const endEl = (\n      isDOMElement(endNode) ? endNode : endNode.parentElement\n    ) as HTMLElement\n    const isEndAtZeroWidth = !!endEl.getAttribute('data-slate-zero-width')\n\n    domRange.setStart(startNode, isStartAtZeroWidth ? 1 : startOffset)\n    domRange.setEnd(endNode, isEndAtZeroWidth ? 1 : endOffset)\n    return domRange\n  },\n\n  toSlateNode: (editor, domNode) => {\n    let domEl = isDOMElement(domNode) ? domNode : domNode.parentElement\n\n    if (domEl && !domEl.hasAttribute('data-slate-node')) {\n      domEl = domEl.closest(`[data-slate-node]`)\n    }\n\n    const node = domEl ? ELEMENT_TO_NODE.get(domEl as HTMLElement) : null\n\n    if (!node) {\n      throw new Error(`Cannot resolve a Slate node from DOM node: ${domEl}`)\n    }\n\n    return node\n  },\n\n  toSlatePoint: <T extends boolean>(\n    editor: ReactEditor,\n    domPoint: DOMPoint,\n    options: {\n      exactMatch: boolean\n      suppressThrow: T\n      searchDirection?: 'forward' | 'backward'\n    }\n  ): T extends true ? Point | null : Point => {\n    const { exactMatch, suppressThrow, searchDirection = 'backward' } = options\n    const [nearestNode, nearestOffset] = exactMatch\n      ? domPoint\n      : normalizeDOMPoint(domPoint)\n    const parentNode = nearestNode.parentNode as DOMElement\n    let textNode: DOMElement | null = null\n    let offset = 0\n\n    if (parentNode) {\n      const editorEl = ReactEditor.toDOMNode(editor, editor)\n      const potentialVoidNode = parentNode.closest('[data-slate-void=\"true\"]')\n      // Need to ensure that the closest void node is actually a void node\n      // within this editor, and not a void node within some parent editor. This can happen\n      // if this editor is within a void node of another editor (\"nested editors\", like in\n      // the \"Editable Voids\" example on the docs site).\n      const voidNode =\n        potentialVoidNode && editorEl.contains(potentialVoidNode)\n          ? potentialVoidNode\n          : null\n      const potentialNonEditableNode = parentNode.closest(\n        '[contenteditable=\"false\"]'\n      )\n      const nonEditableNode =\n        potentialNonEditableNode && editorEl.contains(potentialNonEditableNode)\n          ? potentialNonEditableNode\n          : null\n      let leafNode = parentNode.closest('[data-slate-leaf]')\n      let domNode: DOMElement | null = null\n\n      // Calculate how far into the text node the `nearestNode` is, so that we\n      // can determine what the offset relative to the text node is.\n      if (leafNode) {\n        textNode = leafNode.closest('[data-slate-node=\"text\"]')\n\n        if (textNode) {\n          const window = ReactEditor.getWindow(editor)\n          const range = window.document.createRange()\n          range.setStart(textNode, 0)\n          range.setEnd(nearestNode, nearestOffset)\n\n          const contents = range.cloneContents()\n          const removals = [\n            ...Array.prototype.slice.call(\n              contents.querySelectorAll('[data-slate-zero-width]')\n            ),\n            ...Array.prototype.slice.call(\n              contents.querySelectorAll('[contenteditable=false]')\n            ),\n          ]\n\n          removals.forEach(el => {\n            // COMPAT: While composing at the start of a text node, some keyboards put\n            // the text content inside the zero width space.\n            if (\n              IS_ANDROID &&\n              !exactMatch &&\n              el.hasAttribute('data-slate-zero-width') &&\n              el.textContent.length > 0 &&\n              el.textContext !== '\\uFEFF'\n            ) {\n              if (el.textContent.startsWith('\\uFEFF')) {\n                el.textContent = el.textContent.slice(1)\n              }\n\n              return\n            }\n\n            el!.parentNode!.removeChild(el)\n          })\n\n          // COMPAT: Edge has a bug where Range.prototype.toString() will\n          // convert \\n into \\r\\n. The bug causes a loop when slate-react\n          // attempts to reposition its cursor to match the native position. Use\n          // textContent.length instead.\n          // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/10291116/\n          offset = contents.textContent!.length\n          domNode = textNode\n        }\n      } else if (voidNode) {\n        // For void nodes, the element with the offset key will be a cousin, not an\n        // ancestor, so find it by going down from the nearest void parent and taking the\n        // first one that isn't inside a nested editor.\n        const leafNodes = voidNode.querySelectorAll('[data-slate-leaf]')\n        for (let index = 0; index < leafNodes.length; index++) {\n          const current = leafNodes[index]\n          if (ReactEditor.hasDOMNode(editor, current)) {\n            leafNode = current\n            break\n          }\n        }\n\n        // COMPAT: In read-only editors the leaf is not rendered.\n        if (!leafNode) {\n          offset = 1\n        } else {\n          textNode = leafNode.closest('[data-slate-node=\"text\"]')!\n          domNode = leafNode\n          offset = domNode.textContent!.length\n          domNode.querySelectorAll('[data-slate-zero-width]').forEach(el => {\n            offset -= el.textContent!.length\n          })\n        }\n      } else if (nonEditableNode) {\n        // Find the edge of the nearest leaf in `searchDirection`\n        const getLeafNodes = (node: DOMElement | null | undefined) =>\n          node\n            ? node.querySelectorAll(\n                // Exclude leaf nodes in nested editors\n                '[data-slate-leaf]:not(:scope [data-slate-editor] [data-slate-leaf])'\n              )\n            : []\n        const elementNode = nonEditableNode.closest(\n          '[data-slate-node=\"element\"]'\n        )\n\n        if (searchDirection === 'forward') {\n          const leafNodes = [\n            ...getLeafNodes(elementNode),\n            ...getLeafNodes(elementNode?.nextElementSibling),\n          ]\n          leafNode =\n            leafNodes.find(leaf => isAfter(nonEditableNode, leaf)) ?? null\n        } else {\n          const leafNodes = [\n            ...getLeafNodes(elementNode?.previousElementSibling),\n            ...getLeafNodes(elementNode),\n          ]\n          leafNode =\n            leafNodes.findLast(leaf => isBefore(nonEditableNode, leaf)) ?? null\n        }\n\n        if (leafNode) {\n          textNode = leafNode.closest('[data-slate-node=\"text\"]')!\n          domNode = leafNode\n          if (searchDirection === 'forward') {\n            offset = 0\n          } else {\n            offset = domNode.textContent!.length\n            domNode.querySelectorAll('[data-slate-zero-width]').forEach(el => {\n              offset -= el.textContent!.length\n            })\n          }\n        }\n      }\n\n      if (\n        domNode &&\n        offset === domNode.textContent!.length &&\n        // COMPAT: Android IMEs might remove the zero width space while composing,\n        // and we don't add it for line-breaks.\n        IS_ANDROID &&\n        domNode.getAttribute('data-slate-zero-width') === 'z' &&\n        domNode.textContent?.startsWith('\\uFEFF') &&\n        // COMPAT: If the parent node is a Slate zero-width space, editor is\n        // because the text node should have no characters. However, during IME\n        // composition the ASCII characters will be prepended to the zero-width\n        // space, so subtract 1 from the offset to account for the zero-width\n        // space character.\n        (parentNode.hasAttribute('data-slate-zero-width') ||\n          // COMPAT: In Firefox, `range.cloneContents()` returns an extra trailing '\\n'\n          // when the document ends with a new-line character. This results in the offset\n          // length being off by one, so we need to subtract one to account for this.\n          (IS_FIREFOX && domNode.textContent?.endsWith('\\n\\n')))\n      ) {\n        offset--\n      }\n    }\n\n    if (IS_ANDROID && !textNode && !exactMatch) {\n      const node = parentNode.hasAttribute('data-slate-node')\n        ? parentNode\n        : parentNode.closest('[data-slate-node]')\n\n      if (node && ReactEditor.hasDOMNode(editor, node, { editable: true })) {\n        const slateNode = ReactEditor.toSlateNode(editor, node)\n        let { path, offset } = Editor.start(\n          editor,\n          ReactEditor.findPath(editor, slateNode)\n        )\n\n        if (!node.querySelector('[data-slate-leaf]')) {\n          offset = nearestOffset\n        }\n\n        return { path, offset } as T extends true ? Point | null : Point\n      }\n    }\n\n    if (!textNode) {\n      if (suppressThrow) {\n        return null as T extends true ? Point | null : Point\n      }\n      throw new Error(\n        `Cannot resolve a Slate point from DOM point: ${domPoint}`\n      )\n    }\n\n    // COMPAT: If someone is clicking from one Slate editor into another,\n    // the select event fires twice, once for the old editor's `element`\n    // first, and then afterwards for the correct `element`. (2017/03/03)\n    const slateNode = ReactEditor.toSlateNode(editor, textNode!)\n    const path = ReactEditor.findPath(editor, slateNode)\n    return { path, offset } as T extends true ? Point | null : Point\n  },\n\n  toSlateRange: <T extends boolean>(\n    editor: ReactEditor,\n    domRange: DOMRange | DOMStaticRange | DOMSelection,\n    options: {\n      exactMatch: boolean\n      suppressThrow: T\n    }\n  ): T extends true ? Range | null : Range => {\n    const { exactMatch, suppressThrow } = options\n    const el = isDOMSelection(domRange)\n      ? domRange.anchorNode\n      : domRange.startContainer\n    let anchorNode\n    let anchorOffset\n    let focusNode\n    let focusOffset\n    let isCollapsed\n\n    if (el) {\n      if (isDOMSelection(domRange)) {\n        // COMPAT: In firefox the normal seletion way does not work\n        // (https://github.com/ianstormtaylor/slate/pull/5486#issue-1820720223)\n        if (IS_FIREFOX && domRange.rangeCount > 1) {\n          focusNode = domRange.focusNode // Focus node works fine\n          const firstRange = domRange.getRangeAt(0)\n          const lastRange = domRange.getRangeAt(domRange.rangeCount - 1)\n\n          // Here we are in the contenteditable mode of a table in firefox\n          if (\n            focusNode instanceof HTMLTableRowElement &&\n            firstRange.startContainer instanceof HTMLTableRowElement &&\n            lastRange.startContainer instanceof HTMLTableRowElement\n          ) {\n            // HTMLElement, becouse Element is a slate element\n            function getLastChildren(element: HTMLElement): HTMLElement {\n              if (element.childElementCount > 0) {\n                return getLastChildren(<HTMLElement>element.children[0])\n              } else {\n                return element\n              }\n            }\n\n            const firstNodeRow = <HTMLTableRowElement>firstRange.startContainer\n            const lastNodeRow = <HTMLTableRowElement>lastRange.startContainer\n\n            // This should never fail as \"The HTMLElement interface represents any HTML element.\"\n            const firstNode = getLastChildren(\n              <HTMLElement>firstNodeRow.children[firstRange.startOffset]\n            )\n            const lastNode = getLastChildren(\n              <HTMLElement>lastNodeRow.children[lastRange.startOffset]\n            )\n\n            // Zero, as we allways take the right one as the anchor point\n            focusOffset = 0\n\n            if (lastNode.childNodes.length > 0) {\n              anchorNode = lastNode.childNodes[0]\n            } else {\n              anchorNode = lastNode\n            }\n\n            if (firstNode.childNodes.length > 0) {\n              focusNode = firstNode.childNodes[0]\n            } else {\n              focusNode = firstNode\n            }\n\n            if (lastNode instanceof HTMLElement) {\n              anchorOffset = (<HTMLElement>lastNode).innerHTML.length\n            } else {\n              // Fallback option\n              anchorOffset = 0\n            }\n          } else {\n            // This is the read only mode of a firefox table\n            // Right to left\n            if (firstRange.startContainer === focusNode) {\n              anchorNode = lastRange.endContainer\n              anchorOffset = lastRange.endOffset\n              focusOffset = firstRange.startOffset\n            } else {\n              // Left to right\n              anchorNode = firstRange.startContainer\n              anchorOffset = firstRange.endOffset\n              focusOffset = lastRange.startOffset\n            }\n          }\n        } else {\n          anchorNode = domRange.anchorNode\n          anchorOffset = domRange.anchorOffset\n          focusNode = domRange.focusNode\n          focusOffset = domRange.focusOffset\n        }\n\n        // COMPAT: There's a bug in chrome that always returns `true` for\n        // `isCollapsed` for a Selection that comes from a ShadowRoot.\n        // (2020/08/08)\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=447523\n        // IsCollapsed might not work in firefox, but this will\n        if ((IS_CHROME && hasShadowRoot(anchorNode)) || IS_FIREFOX) {\n          isCollapsed =\n            domRange.anchorNode === domRange.focusNode &&\n            domRange.anchorOffset === domRange.focusOffset\n        } else {\n          isCollapsed = domRange.isCollapsed\n        }\n      } else {\n        anchorNode = domRange.startContainer\n        anchorOffset = domRange.startOffset\n        focusNode = domRange.endContainer\n        focusOffset = domRange.endOffset\n        isCollapsed = domRange.collapsed\n      }\n    }\n\n    if (\n      anchorNode == null ||\n      focusNode == null ||\n      anchorOffset == null ||\n      focusOffset == null\n    ) {\n      throw new Error(\n        `Cannot resolve a Slate range from DOM range: ${domRange}`\n      )\n    }\n\n    // COMPAT: Firefox sometimes includes an extra \\n (rendered by TextString\n    // when isTrailing is true) in the focusOffset, resulting in an invalid\n    // Slate point. (2023/11/01)\n    if (\n      IS_FIREFOX &&\n      focusNode.textContent?.endsWith('\\n\\n') &&\n      focusOffset === focusNode.textContent.length\n    ) {\n      focusOffset--\n    }\n\n    const anchor = ReactEditor.toSlatePoint(\n      editor,\n      [anchorNode, anchorOffset],\n      {\n        exactMatch,\n        suppressThrow,\n      }\n    )\n    if (!anchor) {\n      return null as T extends true ? Range | null : Range\n    }\n\n    const focusBeforeAnchor =\n      isBefore(anchorNode, focusNode) ||\n      (anchorNode === focusNode && focusOffset < anchorOffset)\n    const focus = isCollapsed\n      ? anchor\n      : ReactEditor.toSlatePoint(editor, [focusNode, focusOffset], {\n          exactMatch,\n          suppressThrow,\n          searchDirection: focusBeforeAnchor ? 'forward' : 'backward',\n        })\n    if (!focus) {\n      return null as T extends true ? Range | null : Range\n    }\n\n    let range: Range = { anchor: anchor as Point, focus: focus as Point }\n    // if the selection is a hanging range that ends in a void\n    // and the DOM focus is an Element\n    // (meaning that the selection ends before the element)\n    // unhang the range to avoid mistakenly including the void\n    if (\n      Range.isExpanded(range) &&\n      Range.isForward(range) &&\n      isDOMElement(focusNode) &&\n      Editor.void(editor, { at: range.focus, mode: 'highest' })\n    ) {\n      range = Editor.unhangRange(editor, range, { voids: true })\n    }\n\n    return range as unknown as T extends true ? Range | null : Range\n  },\n}\n", "import {\n  Editor,\n  Node,\n  Operation,\n  Path,\n  Point,\n  Range,\n  Text,\n  Element,\n} from 'slate'\nimport { EDITOR_TO_PENDING_DIFFS } from './weak-maps'\n\nexport type StringDiff = {\n  start: number\n  end: number\n  text: string\n}\n\nexport type TextDiff = {\n  id: number\n  path: Path\n  diff: StringDiff\n}\n\n/**\n * Check whether a text diff was applied in a way we can perform the pending action on /\n * recover the pending selection.\n */\nexport function verifyDiffState(editor: Editor, textDiff: TextDiff): boolean {\n  const { path, diff } = textDiff\n  if (!Editor.hasPath(editor, path)) {\n    return false\n  }\n\n  const node = Node.get(editor, path)\n  if (!Text.isText(node)) {\n    return false\n  }\n\n  if (diff.start !== node.text.length || diff.text.length === 0) {\n    return (\n      node.text.slice(diff.start, diff.start + diff.text.length) === diff.text\n    )\n  }\n\n  const nextPath = Path.next(path)\n  if (!Editor.hasPath(editor, nextPath)) {\n    return false\n  }\n\n  const nextNode = Node.get(editor, nextPath)\n  return Text.isText(nextNode) && nextNode.text.startsWith(diff.text)\n}\n\nexport function applyStringDiff(text: string, ...diffs: StringDiff[]) {\n  return diffs.reduce(\n    (text, diff) =>\n      text.slice(0, diff.start) + diff.text + text.slice(diff.end),\n    text\n  )\n}\n\nfunction longestCommonPrefixLength(str: string, another: string) {\n  const length = Math.min(str.length, another.length)\n\n  for (let i = 0; i < length; i++) {\n    if (str.charAt(i) !== another.charAt(i)) {\n      return i\n    }\n  }\n\n  return length\n}\n\nfunction longestCommonSuffixLength(\n  str: string,\n  another: string,\n  max: number\n): number {\n  const length = Math.min(str.length, another.length, max)\n\n  for (let i = 0; i < length; i++) {\n    if (\n      str.charAt(str.length - i - 1) !== another.charAt(another.length - i - 1)\n    ) {\n      return i\n    }\n  }\n\n  return length\n}\n\n/**\n * Remove redundant changes from the diff so that it spans the minimal possible range\n */\nexport function normalizeStringDiff(targetText: string, diff: StringDiff) {\n  const { start, end, text } = diff\n  const removedText = targetText.slice(start, end)\n\n  const prefixLength = longestCommonPrefixLength(removedText, text)\n  const max = Math.min(\n    removedText.length - prefixLength,\n    text.length - prefixLength\n  )\n  const suffixLength = longestCommonSuffixLength(removedText, text, max)\n\n  const normalized: StringDiff = {\n    start: start + prefixLength,\n    end: end - suffixLength,\n    text: text.slice(prefixLength, text.length - suffixLength),\n  }\n\n  if (normalized.start === normalized.end && normalized.text.length === 0) {\n    return null\n  }\n\n  return normalized\n}\n\n/**\n * Return a string diff that is equivalent to applying b after a spanning the range of\n * both changes\n */\nexport function mergeStringDiffs(\n  targetText: string,\n  a: StringDiff,\n  b: StringDiff\n): StringDiff | null {\n  const start = Math.min(a.start, b.start)\n  const overlap = Math.max(\n    0,\n    Math.min(a.start + a.text.length, b.end) - b.start\n  )\n\n  const applied = applyStringDiff(targetText, a, b)\n  const sliceEnd = Math.max(\n    b.start + b.text.length,\n    a.start +\n      a.text.length +\n      (a.start + a.text.length > b.start ? b.text.length : 0) -\n      overlap\n  )\n\n  const text = applied.slice(start, sliceEnd)\n  const end = Math.max(a.end, b.end - a.text.length + (a.end - a.start))\n  return normalizeStringDiff(targetText, { start, end, text })\n}\n\n/**\n * Get the slate range the text diff spans.\n */\nexport function targetRange(textDiff: TextDiff): Range {\n  const { path, diff } = textDiff\n  return {\n    anchor: { path, offset: diff.start },\n    focus: { path, offset: diff.end },\n  }\n}\n\n/**\n * Normalize a 'pending point' a.k.a a point based on the dom state before applying\n * the pending diffs. Since the pending diffs might have been inserted with different\n * marks we have to 'walk' the offset from the starting position to ensure we still\n * have a valid point inside the document\n */\nexport function normalizePoint(editor: Editor, point: Point): Point | null {\n  let { path, offset } = point\n  if (!Editor.hasPath(editor, path)) {\n    return null\n  }\n\n  let leaf = Node.get(editor, path)\n  if (!Text.isText(leaf)) {\n    return null\n  }\n\n  const parentBlock = Editor.above(editor, {\n    match: n => Element.isElement(n) && Editor.isBlock(editor, n),\n    at: path,\n  })\n\n  if (!parentBlock) {\n    return null\n  }\n\n  while (offset > leaf.text.length) {\n    const entry = Editor.next(editor, { at: path, match: Text.isText })\n    if (!entry || !Path.isDescendant(entry[1], parentBlock[1])) {\n      return null\n    }\n\n    offset -= leaf.text.length\n    leaf = entry[0]\n    path = entry[1]\n  }\n\n  return { path, offset }\n}\n\n/**\n * Normalize a 'pending selection' to ensure it's valid in the current document state.\n */\nexport function normalizeRange(editor: Editor, range: Range): Range | null {\n  const anchor = normalizePoint(editor, range.anchor)\n  if (!anchor) {\n    return null\n  }\n\n  if (Range.isCollapsed(range)) {\n    return { anchor, focus: anchor }\n  }\n\n  const focus = normalizePoint(editor, range.focus)\n  if (!focus) {\n    return null\n  }\n\n  return { anchor, focus }\n}\n\nexport function transformPendingPoint(\n  editor: Editor,\n  point: Point,\n  op: Operation\n): Point | null {\n  const pendingDiffs = EDITOR_TO_PENDING_DIFFS.get(editor)\n  const textDiff = pendingDiffs?.find(({ path }) =>\n    Path.equals(path, point.path)\n  )\n\n  if (!textDiff || point.offset <= textDiff.diff.start) {\n    return Point.transform(point, op, { affinity: 'backward' })\n  }\n\n  const { diff } = textDiff\n  // Point references location inside the diff => transform the point based on the location\n  // the diff will be applied to and add the offset inside the diff.\n  if (point.offset <= diff.start + diff.text.length) {\n    const anchor = { path: point.path, offset: diff.start }\n    const transformed = Point.transform(anchor, op, {\n      affinity: 'backward',\n    })\n\n    if (!transformed) {\n      return null\n    }\n\n    return {\n      path: transformed.path,\n      offset: transformed.offset + point.offset - diff.start,\n    }\n  }\n\n  // Point references location after the diff\n  const anchor = {\n    path: point.path,\n    offset: point.offset - diff.text.length + diff.end - diff.start,\n  }\n  const transformed = Point.transform(anchor, op, {\n    affinity: 'backward',\n  })\n  if (!transformed) {\n    return null\n  }\n\n  if (\n    op.type === 'split_node' &&\n    Path.equals(op.path, point.path) &&\n    anchor.offset < op.position &&\n    diff.start < op.position\n  ) {\n    return transformed\n  }\n\n  return {\n    path: transformed.path,\n    offset: transformed.offset + diff.text.length - diff.end + diff.start,\n  }\n}\n\nexport function transformPendingRange(\n  editor: Editor,\n  range: Range,\n  op: Operation\n): Range | null {\n  const anchor = transformPendingPoint(editor, range.anchor, op)\n  if (!anchor) {\n    return null\n  }\n\n  if (Range.isCollapsed(range)) {\n    return { anchor, focus: anchor }\n  }\n\n  const focus = transformPendingPoint(editor, range.focus, op)\n  if (!focus) {\n    return null\n  }\n\n  return { anchor, focus }\n}\n\nexport function transformTextDiff(\n  textDiff: TextDiff,\n  op: Operation\n): TextDiff | null {\n  const { path, diff, id } = textDiff\n\n  switch (op.type) {\n    case 'insert_text': {\n      if (!Path.equals(op.path, path) || op.offset >= diff.end) {\n        return textDiff\n      }\n\n      if (op.offset <= diff.start) {\n        return {\n          diff: {\n            start: op.text.length + diff.start,\n            end: op.text.length + diff.end,\n            text: diff.text,\n          },\n          id,\n          path,\n        }\n      }\n\n      return {\n        diff: {\n          start: diff.start,\n          end: diff.end + op.text.length,\n          text: diff.text,\n        },\n        id,\n        path,\n      }\n    }\n    case 'remove_text': {\n      if (!Path.equals(op.path, path) || op.offset >= diff.end) {\n        return textDiff\n      }\n\n      if (op.offset + op.text.length <= diff.start) {\n        return {\n          diff: {\n            start: diff.start - op.text.length,\n            end: diff.end - op.text.length,\n            text: diff.text,\n          },\n          id,\n          path,\n        }\n      }\n\n      return {\n        diff: {\n          start: diff.start,\n          end: diff.end - op.text.length,\n          text: diff.text,\n        },\n        id,\n        path,\n      }\n    }\n    case 'split_node': {\n      if (!Path.equals(op.path, path) || op.position >= diff.end) {\n        return {\n          diff,\n          id,\n          path: Path.transform(path, op, { affinity: 'backward' })!,\n        }\n      }\n\n      if (op.position > diff.start) {\n        return {\n          diff: {\n            start: diff.start,\n            end: Math.min(op.position, diff.end),\n            text: diff.text,\n          },\n          id,\n          path,\n        }\n      }\n\n      return {\n        diff: {\n          start: diff.start - op.position,\n          end: diff.end - op.position,\n          text: diff.text,\n        },\n        id,\n        path: Path.transform(path, op, { affinity: 'forward' })!,\n      }\n    }\n    case 'merge_node': {\n      if (!Path.equals(op.path, path)) {\n        return {\n          diff,\n          id,\n          path: Path.transform(path, op)!,\n        }\n      }\n\n      return {\n        diff: {\n          start: diff.start + op.position,\n          end: diff.end + op.position,\n          text: diff.text,\n        },\n        id,\n        path: Path.transform(path, op)!,\n      }\n    }\n  }\n\n  const newPath = Path.transform(path, op)\n  if (!newPath) {\n    return null\n  }\n\n  return {\n    diff,\n    path: newPath,\n    id,\n  }\n}\n", "import { DebouncedFunc } from 'lodash'\nimport { Editor, Node, Path, Point, Range, Text, Transforms } from 'slate'\nimport { ReactEditor } from '../../plugin/react-editor'\nimport {\n  applyStringDiff,\n  mergeStringDiffs,\n  normalizePoint,\n  normalizeRange,\n  normalizeStringDiff,\n  StringDiff,\n  targetRange,\n  TextDiff,\n  verifyDiffState,\n} from '../../utils/diff-text'\nimport { isDOMSelection, isTrackedMutation } from '../../utils/dom'\nimport {\n  EDITOR_TO_FORCE_RENDER,\n  EDITOR_TO_PENDING_ACTION,\n  EDITOR_TO_PENDING_DIFFS,\n  EDITOR_TO_PENDING_INSERTION_MARKS,\n  EDITOR_TO_PENDING_SELECTION,\n  EDITOR_TO_PLACEHOLDER_ELEMENT,\n  EDITOR_TO_USER_MARKS,\n  IS_COMPOSING,\n  IS_NODE_MAP_DIRTY,\n} from '../../utils/weak-maps'\n\nexport type Action = { at?: Point | Range; run: () => void }\n\n// https://github.com/facebook/draft-js/blob/main/src/component/handlers/composition/DraftEditorCompositionHandler.js#L41\n// When using keyboard English association function, conpositionEnd triggered too fast, resulting in after `insertText` still maintain association state.\nconst RESOLVE_DELAY = 25\n\n// Time with no user interaction before the current user action is considered as done.\nconst FLUSH_DELAY = 200\n\n// Replace with `const debug = console.log` to debug\nconst debug = (..._: unknown[]) => {}\n\n// Type guard to check if a value is a DataTransfer\nconst isDataTransfer = (value: any): value is DataTransfer =>\n  value?.constructor.name === 'DataTransfer'\n\nexport type CreateAndroidInputManagerOptions = {\n  editor: ReactEditor\n\n  scheduleOnDOMSelectionChange: DebouncedFunc<() => void>\n  onDOMSelectionChange: DebouncedFunc<() => void>\n}\n\nexport type AndroidInputManager = {\n  flush: () => void\n  scheduleFlush: () => void\n\n  hasPendingDiffs: () => boolean\n  hasPendingAction: () => boolean\n  hasPendingChanges: () => boolean\n  isFlushing: () => boolean | 'action'\n\n  handleUserSelect: (range: Range | null) => void\n  handleCompositionEnd: (event: React.CompositionEvent<HTMLDivElement>) => void\n  handleCompositionStart: (\n    event: React.CompositionEvent<HTMLDivElement>\n  ) => void\n  handleDOMBeforeInput: (event: InputEvent) => void\n  handleKeyDown: (event: React.KeyboardEvent<HTMLDivElement>) => void\n\n  handleDomMutations: (mutations: MutationRecord[]) => void\n  handleInput: () => void\n}\n\nexport function createAndroidInputManager({\n  editor,\n  scheduleOnDOMSelectionChange,\n  onDOMSelectionChange,\n}: CreateAndroidInputManagerOptions): AndroidInputManager {\n  let flushing: 'action' | boolean = false\n  let compositionEndTimeoutId: ReturnType<typeof setTimeout> | null = null\n  let flushTimeoutId: ReturnType<typeof setTimeout> | null = null\n  let actionTimeoutId: ReturnType<typeof setTimeout> | null = null\n\n  let idCounter = 0\n  let insertPositionHint: StringDiff | null | false = false\n\n  const applyPendingSelection = () => {\n    const pendingSelection = EDITOR_TO_PENDING_SELECTION.get(editor)\n    EDITOR_TO_PENDING_SELECTION.delete(editor)\n\n    if (pendingSelection) {\n      const { selection } = editor\n      const normalized = normalizeRange(editor, pendingSelection)\n\n      debug('apply pending selection', pendingSelection, normalized)\n\n      if (normalized && (!selection || !Range.equals(normalized, selection))) {\n        Transforms.select(editor, normalized)\n      }\n    }\n  }\n\n  const performAction = () => {\n    const action = EDITOR_TO_PENDING_ACTION.get(editor)\n    EDITOR_TO_PENDING_ACTION.delete(editor)\n    if (!action) {\n      return\n    }\n\n    if (action.at) {\n      const target = Point.isPoint(action.at)\n        ? normalizePoint(editor, action.at)\n        : normalizeRange(editor, action.at)\n\n      if (!target) {\n        return\n      }\n\n      const targetRange = Editor.range(editor, target)\n      if (!editor.selection || !Range.equals(editor.selection, targetRange)) {\n        Transforms.select(editor, target)\n      }\n    }\n\n    action.run()\n  }\n\n  const flush = () => {\n    if (flushTimeoutId) {\n      clearTimeout(flushTimeoutId)\n      flushTimeoutId = null\n    }\n\n    if (actionTimeoutId) {\n      clearTimeout(actionTimeoutId)\n      actionTimeoutId = null\n    }\n\n    if (!hasPendingDiffs() && !hasPendingAction()) {\n      applyPendingSelection()\n      return\n    }\n\n    if (!flushing) {\n      flushing = true\n      setTimeout(() => (flushing = false))\n    }\n\n    if (hasPendingAction()) {\n      flushing = 'action'\n    }\n\n    const selectionRef =\n      editor.selection &&\n      Editor.rangeRef(editor, editor.selection, { affinity: 'forward' })\n    EDITOR_TO_USER_MARKS.set(editor, editor.marks)\n\n    debug(\n      'flush',\n      EDITOR_TO_PENDING_ACTION.get(editor),\n      EDITOR_TO_PENDING_DIFFS.get(editor)\n    )\n\n    let scheduleSelectionChange = hasPendingDiffs()\n\n    let diff: TextDiff | undefined\n    while ((diff = EDITOR_TO_PENDING_DIFFS.get(editor)?.[0])) {\n      const pendingMarks = EDITOR_TO_PENDING_INSERTION_MARKS.get(editor)\n\n      if (pendingMarks !== undefined) {\n        EDITOR_TO_PENDING_INSERTION_MARKS.delete(editor)\n        editor.marks = pendingMarks\n      }\n\n      if (pendingMarks && insertPositionHint === false) {\n        insertPositionHint = null\n        debug('insert after mark placeholder')\n      }\n\n      const range = targetRange(diff)\n      if (!editor.selection || !Range.equals(editor.selection, range)) {\n        Transforms.select(editor, range)\n      }\n\n      if (diff.diff.text) {\n        Editor.insertText(editor, diff.diff.text)\n      } else {\n        Editor.deleteFragment(editor)\n      }\n\n      // Remove diff only after we have applied it to account for it when transforming\n      // pending ranges.\n      EDITOR_TO_PENDING_DIFFS.set(\n        editor,\n        EDITOR_TO_PENDING_DIFFS.get(editor)?.filter(\n          ({ id }) => id !== diff!.id\n        )!\n      )\n\n      if (!verifyDiffState(editor, diff)) {\n        debug('invalid diff state')\n        scheduleSelectionChange = false\n        EDITOR_TO_PENDING_ACTION.delete(editor)\n        EDITOR_TO_USER_MARKS.delete(editor)\n        flushing = 'action'\n\n        // Ensure we don't restore the pending user (dom) selection\n        // since the document and dom state do not match.\n        EDITOR_TO_PENDING_SELECTION.delete(editor)\n        scheduleOnDOMSelectionChange.cancel()\n        onDOMSelectionChange.cancel()\n        selectionRef?.unref()\n      }\n    }\n\n    const selection = selectionRef?.unref()\n    if (\n      selection &&\n      !EDITOR_TO_PENDING_SELECTION.get(editor) &&\n      (!editor.selection || !Range.equals(selection, editor.selection))\n    ) {\n      Transforms.select(editor, selection)\n    }\n\n    if (hasPendingAction()) {\n      performAction()\n      return\n    }\n\n    // COMPAT: The selectionChange event is fired after the action is performed,\n    // so we have to manually schedule it to ensure we don't 'throw away' the selection\n    // while rendering if we have pending changes.\n    if (scheduleSelectionChange) {\n      debug('scheduleOnDOMSelectionChange pending changes')\n      scheduleOnDOMSelectionChange()\n    }\n\n    scheduleOnDOMSelectionChange.flush()\n    onDOMSelectionChange.flush()\n\n    applyPendingSelection()\n\n    const userMarks = EDITOR_TO_USER_MARKS.get(editor)\n    EDITOR_TO_USER_MARKS.delete(editor)\n    if (userMarks !== undefined) {\n      editor.marks = userMarks\n      editor.onChange()\n    }\n  }\n\n  const handleCompositionEnd = (\n    _event: React.CompositionEvent<HTMLDivElement>\n  ) => {\n    if (compositionEndTimeoutId) {\n      clearTimeout(compositionEndTimeoutId)\n    }\n\n    compositionEndTimeoutId = setTimeout(() => {\n      IS_COMPOSING.set(editor, false)\n      flush()\n    }, RESOLVE_DELAY)\n  }\n\n  const handleCompositionStart = (\n    _event: React.CompositionEvent<HTMLDivElement>\n  ) => {\n    debug('composition start')\n\n    IS_COMPOSING.set(editor, true)\n\n    if (compositionEndTimeoutId) {\n      clearTimeout(compositionEndTimeoutId)\n      compositionEndTimeoutId = null\n    }\n  }\n\n  const updatePlaceholderVisibility = (forceHide = false) => {\n    const placeholderElement = EDITOR_TO_PLACEHOLDER_ELEMENT.get(editor)\n    if (!placeholderElement) {\n      return\n    }\n\n    if (hasPendingDiffs() || forceHide) {\n      placeholderElement.style.display = 'none'\n      return\n    }\n\n    placeholderElement.style.removeProperty('display')\n  }\n\n  const storeDiff = (path: Path, diff: StringDiff) => {\n    debug('storeDiff', path, diff)\n\n    const pendingDiffs = EDITOR_TO_PENDING_DIFFS.get(editor) ?? []\n    EDITOR_TO_PENDING_DIFFS.set(editor, pendingDiffs)\n\n    const target = Node.leaf(editor, path)\n    const idx = pendingDiffs.findIndex(change => Path.equals(change.path, path))\n    if (idx < 0) {\n      const normalized = normalizeStringDiff(target.text, diff)\n      if (normalized) {\n        pendingDiffs.push({ path, diff, id: idCounter++ })\n      }\n\n      updatePlaceholderVisibility()\n      return\n    }\n\n    const merged = mergeStringDiffs(target.text, pendingDiffs[idx].diff, diff)\n    if (!merged) {\n      pendingDiffs.splice(idx, 1)\n      updatePlaceholderVisibility()\n      return\n    }\n\n    pendingDiffs[idx] = {\n      ...pendingDiffs[idx],\n      diff: merged,\n    }\n  }\n\n  const scheduleAction = (\n    run: () => void,\n    { at }: { at?: Point | Range } = {}\n  ): void => {\n    insertPositionHint = false\n    debug('scheduleAction', { at, run })\n\n    EDITOR_TO_PENDING_SELECTION.delete(editor)\n    scheduleOnDOMSelectionChange.cancel()\n    onDOMSelectionChange.cancel()\n\n    if (hasPendingAction()) {\n      flush()\n    }\n\n    EDITOR_TO_PENDING_ACTION.set(editor, { at, run })\n\n    // COMPAT: When deleting before a non-contenteditable element chrome only fires a beforeinput,\n    // (no input) and doesn't perform any dom mutations. Without a flush timeout we would never flush\n    // in this case and thus never actually perform the action.\n    actionTimeoutId = setTimeout(flush)\n  }\n\n  const handleDOMBeforeInput = (event: InputEvent): void => {\n    if (flushTimeoutId) {\n      clearTimeout(flushTimeoutId)\n      flushTimeoutId = null\n    }\n\n    if (IS_NODE_MAP_DIRTY.get(editor)) {\n      return\n    }\n\n    const { inputType: type } = event\n    let targetRange: Range | null = null\n    const data: DataTransfer | string | undefined =\n      (event as any).dataTransfer || event.data || undefined\n\n    if (\n      insertPositionHint !== false &&\n      type !== 'insertText' &&\n      type !== 'insertCompositionText'\n    ) {\n      insertPositionHint = false\n    }\n\n    let [nativeTargetRange] = (event as any).getTargetRanges()\n    if (nativeTargetRange) {\n      targetRange = ReactEditor.toSlateRange(editor, nativeTargetRange, {\n        exactMatch: false,\n        suppressThrow: true,\n      })\n    }\n\n    // COMPAT: SelectionChange event is fired after the action is performed, so we\n    // have to manually get the selection here to ensure it's up-to-date.\n    const window = ReactEditor.getWindow(editor)\n    const domSelection = window.getSelection()\n    if (!targetRange && domSelection) {\n      nativeTargetRange = domSelection\n      targetRange = ReactEditor.toSlateRange(editor, domSelection, {\n        exactMatch: false,\n        suppressThrow: true,\n      })\n    }\n\n    targetRange = targetRange ?? editor.selection\n    if (!targetRange) {\n      return\n    }\n\n    // By default, the input manager tries to store text diffs so that we can\n    // defer flushing them at a later point in time. We don't want to flush\n    // for every input event as this can be expensive. However, there are some\n    // scenarios where we cannot safely store the text diff and must instead\n    // schedule an action to let Slate normalize the editor state.\n    let canStoreDiff = true\n\n    if (type.startsWith('delete')) {\n      if (Range.isExpanded(targetRange)) {\n        const [start, end] = Range.edges(targetRange)\n        const leaf = Node.leaf(editor, start.path)\n\n        if (leaf.text.length === start.offset && end.offset === 0) {\n          const next = Editor.next(editor, {\n            at: start.path,\n            match: Text.isText,\n          })\n          if (next && Path.equals(next[1], end.path)) {\n            targetRange = { anchor: end, focus: end }\n          }\n        }\n      }\n\n      const direction = type.endsWith('Backward') ? 'backward' : 'forward'\n      const [start, end] = Range.edges(targetRange)\n      const [leaf, path] = Editor.leaf(editor, start.path)\n\n      const diff = {\n        text: '',\n        start: start.offset,\n        end: end.offset,\n      }\n      const pendingDiffs = EDITOR_TO_PENDING_DIFFS.get(editor)\n      const relevantPendingDiffs = pendingDiffs?.find(change =>\n        Path.equals(change.path, path)\n      )\n      const diffs = relevantPendingDiffs\n        ? [relevantPendingDiffs.diff, diff]\n        : [diff]\n      const text = applyStringDiff(leaf.text, ...diffs)\n\n      if (text.length === 0) {\n        // Text leaf will be removed, so we need to schedule an\n        // action to remove it so that Slate can normalize instead\n        // of storing as a diff\n        canStoreDiff = false\n      }\n\n      if (Range.isExpanded(targetRange)) {\n        if (\n          canStoreDiff &&\n          Path.equals(targetRange.anchor.path, targetRange.focus.path)\n        ) {\n          const point = { path: targetRange.anchor.path, offset: start.offset }\n          const range = Editor.range(editor, point, point)\n          handleUserSelect(range)\n\n          return storeDiff(targetRange.anchor.path, {\n            text: '',\n            end: end.offset,\n            start: start.offset,\n          })\n        }\n\n        return scheduleAction(\n          () => Editor.deleteFragment(editor, { direction }),\n          { at: targetRange }\n        )\n      }\n    }\n\n    switch (type) {\n      case 'deleteByComposition':\n      case 'deleteByCut':\n      case 'deleteByDrag': {\n        return scheduleAction(() => Editor.deleteFragment(editor), {\n          at: targetRange,\n        })\n      }\n\n      case 'deleteContent':\n      case 'deleteContentForward': {\n        const { anchor } = targetRange\n        if (canStoreDiff && Range.isCollapsed(targetRange)) {\n          const targetNode = Node.leaf(editor, anchor.path)\n\n          if (anchor.offset < targetNode.text.length) {\n            return storeDiff(anchor.path, {\n              text: '',\n              start: anchor.offset,\n              end: anchor.offset + 1,\n            })\n          }\n        }\n\n        return scheduleAction(() => Editor.deleteForward(editor), {\n          at: targetRange,\n        })\n      }\n\n      case 'deleteContentBackward': {\n        const { anchor } = targetRange\n\n        // If we have a mismatch between the native and slate selection being collapsed\n        // we are most likely deleting a zero-width placeholder and thus should perform it\n        // as an action to ensure correct behavior (mostly happens with mark placeholders)\n        const nativeCollapsed = isDOMSelection(nativeTargetRange)\n          ? nativeTargetRange.isCollapsed\n          : !!nativeTargetRange?.collapsed\n\n        if (\n          canStoreDiff &&\n          nativeCollapsed &&\n          Range.isCollapsed(targetRange) &&\n          anchor.offset > 0\n        ) {\n          return storeDiff(anchor.path, {\n            text: '',\n            start: anchor.offset - 1,\n            end: anchor.offset,\n          })\n        }\n\n        return scheduleAction(() => Editor.deleteBackward(editor), {\n          at: targetRange,\n        })\n      }\n\n      case 'deleteEntireSoftLine': {\n        return scheduleAction(\n          () => {\n            Editor.deleteBackward(editor, { unit: 'line' })\n            Editor.deleteForward(editor, { unit: 'line' })\n          },\n          { at: targetRange }\n        )\n      }\n\n      case 'deleteHardLineBackward': {\n        return scheduleAction(\n          () => Editor.deleteBackward(editor, { unit: 'block' }),\n          { at: targetRange }\n        )\n      }\n\n      case 'deleteSoftLineBackward': {\n        return scheduleAction(\n          () => Editor.deleteBackward(editor, { unit: 'line' }),\n          { at: targetRange }\n        )\n      }\n\n      case 'deleteHardLineForward': {\n        return scheduleAction(\n          () => Editor.deleteForward(editor, { unit: 'block' }),\n          { at: targetRange }\n        )\n      }\n\n      case 'deleteSoftLineForward': {\n        return scheduleAction(\n          () => Editor.deleteForward(editor, { unit: 'line' }),\n          { at: targetRange }\n        )\n      }\n\n      case 'deleteWordBackward': {\n        return scheduleAction(\n          () => Editor.deleteBackward(editor, { unit: 'word' }),\n          { at: targetRange }\n        )\n      }\n\n      case 'deleteWordForward': {\n        return scheduleAction(\n          () => Editor.deleteForward(editor, { unit: 'word' }),\n          { at: targetRange }\n        )\n      }\n\n      case 'insertLineBreak': {\n        return scheduleAction(() => Editor.insertSoftBreak(editor), {\n          at: targetRange,\n        })\n      }\n\n      case 'insertParagraph': {\n        return scheduleAction(() => Editor.insertBreak(editor), {\n          at: targetRange,\n        })\n      }\n      case 'insertCompositionText':\n      case 'deleteCompositionText':\n      case 'insertFromComposition':\n      case 'insertFromDrop':\n      case 'insertFromPaste':\n      case 'insertFromYank':\n      case 'insertReplacementText':\n      case 'insertText': {\n        if (isDataTransfer(data)) {\n          return scheduleAction(() => ReactEditor.insertData(editor, data), {\n            at: targetRange,\n          })\n        }\n\n        let text = data ?? ''\n\n        // COMPAT: If we are writing inside a placeholder, the ime inserts the text inside\n        // the placeholder itself and thus includes the zero-width space inside edit events.\n        if (EDITOR_TO_PENDING_INSERTION_MARKS.get(editor)) {\n          text = text.replace('\\uFEFF', '')\n        }\n\n        // Pastes from the Android clipboard will generate `insertText` events.\n        // If the copied text contains any newlines, Android will append an\n        // extra newline to the end of the copied text.\n        if (type === 'insertText' && /.*\\n.*\\n$/.test(text)) {\n          text = text.slice(0, -1)\n        }\n\n        // If the text includes a newline, split it at newlines and paste each component\n        // string, with soft breaks in between each.\n        if (text.includes('\\n')) {\n          return scheduleAction(\n            () => {\n              const parts = text.split('\\n')\n              parts.forEach((line, i) => {\n                if (line) {\n                  Editor.insertText(editor, line)\n                }\n                if (i !== parts.length - 1) {\n                  Editor.insertSoftBreak(editor)\n                }\n              })\n            },\n            {\n              at: targetRange,\n            }\n          )\n        }\n\n        if (Path.equals(targetRange.anchor.path, targetRange.focus.path)) {\n          const [start, end] = Range.edges(targetRange)\n\n          const diff = {\n            start: start.offset,\n            end: end.offset,\n            text,\n          }\n\n          // COMPAT: Swiftkey has a weird bug where the target range of the 2nd word\n          // inserted after a mark placeholder is inserted with an anchor offset off by 1.\n          // So writing 'some text' will result in 'some ttext'. Luckily all 'normal' insert\n          // text events are fired with the correct target ranges, only the final 'insertComposition'\n          // isn't, so we can adjust the target range start offset if we are confident this is the\n          // swiftkey insert causing the issue.\n          if (text && insertPositionHint && type === 'insertCompositionText') {\n            const hintPosition =\n              insertPositionHint.start + insertPositionHint.text.search(/\\S|$/)\n            const diffPosition = diff.start + diff.text.search(/\\S|$/)\n\n            if (\n              diffPosition === hintPosition + 1 &&\n              diff.end ===\n                insertPositionHint.start + insertPositionHint.text.length\n            ) {\n              debug('adjusting swiftKey insert position using hint')\n              diff.start -= 1\n              insertPositionHint = null\n              scheduleFlush()\n            } else {\n              insertPositionHint = false\n            }\n          } else if (type === 'insertText') {\n            if (insertPositionHint === null) {\n              insertPositionHint = diff\n            } else if (\n              insertPositionHint &&\n              Range.isCollapsed(targetRange) &&\n              insertPositionHint.end + insertPositionHint.text.length ===\n                start.offset\n            ) {\n              insertPositionHint = {\n                ...insertPositionHint,\n                text: insertPositionHint.text + text,\n              }\n            } else {\n              insertPositionHint = false\n            }\n          } else {\n            insertPositionHint = false\n          }\n\n          if (canStoreDiff) {\n            storeDiff(start.path, diff)\n            return\n          }\n        }\n\n        return scheduleAction(() => Editor.insertText(editor, text), {\n          at: targetRange,\n        })\n      }\n    }\n  }\n\n  const hasPendingAction = () => {\n    return !!EDITOR_TO_PENDING_ACTION.get(editor)\n  }\n\n  const hasPendingDiffs = () => {\n    return !!EDITOR_TO_PENDING_DIFFS.get(editor)?.length\n  }\n\n  const hasPendingChanges = () => {\n    return hasPendingAction() || hasPendingDiffs()\n  }\n\n  const isFlushing = () => {\n    return flushing\n  }\n\n  const handleUserSelect = (range: Range | null) => {\n    EDITOR_TO_PENDING_SELECTION.set(editor, range)\n\n    if (flushTimeoutId) {\n      clearTimeout(flushTimeoutId)\n      flushTimeoutId = null\n    }\n\n    const { selection } = editor\n    if (!range) {\n      return\n    }\n\n    const pathChanged =\n      !selection || !Path.equals(selection.anchor.path, range.anchor.path)\n    const parentPathChanged =\n      !selection ||\n      !Path.equals(\n        selection.anchor.path.slice(0, -1),\n        range.anchor.path.slice(0, -1)\n      )\n\n    if ((pathChanged && insertPositionHint) || parentPathChanged) {\n      insertPositionHint = false\n    }\n\n    if (pathChanged || hasPendingDiffs()) {\n      flushTimeoutId = setTimeout(flush, FLUSH_DELAY)\n    }\n  }\n\n  const handleInput = () => {\n    if (hasPendingAction() || !hasPendingDiffs()) {\n      debug('flush input')\n      flush()\n    }\n  }\n\n  const handleKeyDown = (_: React.KeyboardEvent) => {\n    // COMPAT: Swiftkey closes the keyboard when typing inside a empty node\n    // directly next to a non-contenteditable element (= the placeholder).\n    // The only event fired soon enough for us to allow hiding the placeholder\n    // without swiftkey picking it up is the keydown event, so we have to hide it\n    // here. See https://github.com/ianstormtaylor/slate/pull/4988#issuecomment-1201050535\n    if (!hasPendingDiffs()) {\n      updatePlaceholderVisibility(true)\n      setTimeout(updatePlaceholderVisibility)\n    }\n  }\n\n  const scheduleFlush = () => {\n    if (!hasPendingAction()) {\n      actionTimeoutId = setTimeout(flush)\n    }\n  }\n\n  const handleDomMutations = (mutations: MutationRecord[]) => {\n    if (hasPendingDiffs() || hasPendingAction()) {\n      return\n    }\n\n    if (\n      mutations.some(mutation => isTrackedMutation(editor, mutation, mutations))\n    ) {\n      // Cause a re-render to restore the dom state if we encounter tracked mutations without\n      // a corresponding pending action.\n      EDITOR_TO_FORCE_RENDER.get(editor)?.()\n    }\n  }\n\n  return {\n    flush,\n    scheduleFlush,\n\n    hasPendingDiffs,\n    hasPendingAction,\n    hasPendingChanges,\n\n    isFlushing,\n\n    handleUserSelect,\n    handleCompositionEnd,\n    handleCompositionStart,\n    handleDOMBeforeInput,\n    handleKeyDown,\n\n    handleDomMutations,\n    handleInput,\n  }\n}\n", "import { useEffect, useRef } from 'react'\n\nexport function useIsMounted() {\n  const isMountedRef = useRef(false)\n\n  useEffect(() => {\n    isMountedRef.current = true\n    return () => {\n      isMountedRef.current = false\n    }\n  }, [])\n\n  return isMountedRef.current\n}\n", "import { useLayoutEffect, useEffect } from 'react'\nimport { CAN_USE_DOM } from '../utils/environment'\n\n/**\n * Prevent warning on SSR by falling back to useEffect when DOM isn't available\n */\n\nexport const useIsomorphicLayoutEffect = CAN_USE_DOM\n  ? useLayoutEffect\n  : useEffect\n", "import { RefObject, useEffect, useState } from 'react'\nimport { useIsomorphicLayoutEffect } from './use-isomorphic-layout-effect'\n\nexport function useMutationObserver(\n  node: RefObject<HTMLElement>,\n  callback: MutationCallback,\n  options: MutationObserverInit\n) {\n  const [mutationObserver] = useState(() => new MutationObserver(callback))\n\n  useIsomorphicLayoutEffect(() => {\n    // Discard mutations caused during render phase. This works due to react calling\n    // useLayoutEffect synchronously after the render phase before the next tick.\n    mutationObserver.takeRecords()\n  })\n\n  useEffect(() => {\n    if (!node.current) {\n      throw new Error('Failed to attach MutationObserver, `node` is undefined')\n    }\n\n    mutationObserver.observe(node.current, options)\n    return () => mutationObserver.disconnect()\n  }, [mutationObserver, node, options])\n}\n", "import { RefObject, useState } from 'react'\nimport { useSlateStatic } from '../use-slate-static'\nimport { IS_ANDROID } from '../../utils/environment'\nimport { EDITOR_TO_SCHEDULE_FLUSH } from '../../utils/weak-maps'\nimport {\n  createAndroidInputManager,\n  CreateAndroidInputManagerOptions,\n} from './android-input-manager'\nimport { useIsMounted } from '../use-is-mounted'\nimport { useMutationObserver } from '../use-mutation-observer'\n\ntype UseAndroidInputManagerOptions = {\n  node: RefObject<HTMLElement>\n} & Omit<\n  CreateAndroidInputManagerOptions,\n  'editor' | 'onUserInput' | 'receivedUserInput'\n>\n\nconst MUTATION_OBSERVER_CONFIG: MutationObserverInit = {\n  subtree: true,\n  childList: true,\n  characterData: true,\n}\n\nexport const useAndroidInputManager = !IS_ANDROID\n  ? () => null\n  : ({ node, ...options }: UseAndroidInputManagerOptions) => {\n      if (!IS_ANDROID) {\n        return null\n      }\n\n      const editor = useSlateStatic()\n      const isMounted = useIsMounted()\n\n      const [inputManager] = useState(() =>\n        createAndroidInputManager({\n          editor,\n          ...options,\n        })\n      )\n\n      useMutationObserver(\n        node,\n        inputManager.handleDomMutations,\n        MUTATION_OBSERVER_CONFIG\n      )\n\n      EDITOR_TO_SCHEDULE_FLUSH.set(editor, inputManager.scheduleFlush)\n      if (isMounted) {\n        inputManager.flush()\n      }\n\n      return inputManager\n    }\n", "import { Range } from 'slate'\nimport { PLACEHOLDER_SYMBOL } from './weak-maps'\n\nexport const shallowCompare = (\n  obj1: { [key: string]: unknown },\n  obj2: { [key: string]: unknown }\n) =>\n  Object.keys(obj1).length === Object.keys(obj2).length &&\n  Object.keys(obj1).every(\n    key => obj2.hasOwnProperty(key) && obj1[key] === obj2[key]\n  )\n\nconst isDecorationFlagsEqual = (range: Range, other: Range) => {\n  const { anchor: rangeAnchor, focus: rangeFocus, ...rangeOwnProps } = range\n  const { anchor: otherAnchor, focus: otherFocus, ...otherOwnProps } = other\n\n  return (\n    range[PLACEHOLDER_SYMBOL] === other[PLACEHOLDER_SYMBOL] &&\n    shallowCompare(rangeOwnProps, otherOwnProps)\n  )\n}\n\n/**\n * Check if a list of decorator ranges are equal to another.\n *\n * PERF: this requires the two lists to also have the ranges inside them in the\n * same order, but this is an okay constraint for us since decorations are\n * kept in order, and the odd case where they aren't is okay to re-render for.\n */\n\nexport const isElementDecorationsEqual = (\n  list: Range[],\n  another: Range[]\n): boolean => {\n  if (list.length !== another.length) {\n    return false\n  }\n\n  for (let i = 0; i < list.length; i++) {\n    const range = list[i]\n    const other = another[i]\n\n    if (!Range.equals(range, other) || !isDecorationFlagsEqual(range, other)) {\n      return false\n    }\n  }\n\n  return true\n}\n\n/**\n * Check if a list of decorator ranges are equal to another.\n *\n * PERF: this requires the two lists to also have the ranges inside them in the\n * same order, but this is an okay constraint for us since decorations are\n * kept in order, and the odd case where they aren't is okay to re-render for.\n */\n\nexport const isTextDecorationsEqual = (\n  list: Range[],\n  another: Range[]\n): boolean => {\n  if (list.length !== another.length) {\n    return false\n  }\n\n  for (let i = 0; i < list.length; i++) {\n    const range = list[i]\n    const other = another[i]\n\n    // compare only offsets because paths doesn't matter for text\n    if (\n      range.anchor.offset !== other.anchor.offset ||\n      range.focus.offset !== other.focus.offset ||\n      !isDecorationFlagsEqual(range, other)\n    ) {\n      return false\n    }\n  }\n\n  return true\n}\n", "import React, { forwardRef, memo, useRef, useState } from 'react'\nimport { Editor, Text, Path, Element, Node } from 'slate'\n\nimport { ReactEditor, useSlateStatic } from '..'\nimport { useIsomorphicLayoutEffect } from '../hooks/use-isomorphic-layout-effect'\nimport { IS_ANDROID, IS_IOS } from '../utils/environment'\nimport { MARK_PLACEHOLDER_SYMBOL } from '../utils/weak-maps'\n\n/**\n * Leaf content strings.\n */\n\nconst String = (props: {\n  isLast: boolean\n  leaf: Text\n  parent: Element\n  text: Text\n}) => {\n  const { isLast, leaf, parent, text } = props\n  const editor = useSlateStatic()\n  const path = ReactEditor.findPath(editor, text)\n  const parentPath = Path.parent(path)\n  const isMarkPlaceholder = Boolean(leaf[MARK_PLACEHOLDER_SYMBOL])\n\n  // COMPAT: Render text inside void nodes with a zero-width space.\n  // So the node can contain selection but the text is not visible.\n  if (editor.isVoid(parent)) {\n    return <ZeroWidthString length={Node.string(parent).length} />\n  }\n\n  // COMPAT: If this is the last text node in an empty block, render a zero-\n  // width space that will convert into a line break when copying and pasting\n  // to support expected plain text.\n  if (\n    leaf.text === '' &&\n    parent.children[parent.children.length - 1] === text &&\n    !editor.isInline(parent) &&\n    Editor.string(editor, parentPath) === ''\n  ) {\n    return <ZeroWidthString isLineBreak isMarkPlaceholder={isMarkPlaceholder} />\n  }\n\n  // COMPAT: If the text is empty, it's because it's on the edge of an inline\n  // node, so we render a zero-width space so that the selection can be\n  // inserted next to it still.\n  if (leaf.text === '') {\n    return <ZeroWidthString isMarkPlaceholder={isMarkPlaceholder} />\n  }\n\n  // COMPAT: Browsers will collapse trailing new lines at the end of blocks,\n  // so we need to add an extra trailing new lines to prevent that.\n  if (isLast && leaf.text.slice(-1) === '\\n') {\n    return <TextString isTrailing text={leaf.text} />\n  }\n\n  return <TextString text={leaf.text} />\n}\n\n/**\n * Leaf strings with text in them.\n */\nconst TextString = (props: { text: string; isTrailing?: boolean }) => {\n  const { text, isTrailing = false } = props\n  const ref = useRef<HTMLSpanElement>(null)\n  const getTextContent = () => {\n    return `${text ?? ''}${isTrailing ? '\\n' : ''}`\n  }\n  const [initialText] = useState(getTextContent)\n\n  // This is the actual text rendering boundary where we interface with the DOM\n  // The text is not rendered as part of the virtual DOM, as since we handle basic character insertions natively,\n  // updating the DOM is not a one way dataflow anymore. What we need here is not reconciliation and diffing\n  // with previous version of the virtual DOM, but rather diffing with the actual DOM element, and replace the DOM <span> content\n  // exactly if and only if its current content does not match our current virtual DOM.\n  // Otherwise the DOM TextNode would always be replaced by React as the user types, which interferes with native text features,\n  // eg makes native spellcheck opt out from checking the text node.\n\n  // useLayoutEffect: updating our span before browser paint\n  useIsomorphicLayoutEffect(() => {\n    // null coalescing text to make sure we're not outputing \"null\" as a string in the extreme case it is nullish at runtime\n    const textWithTrailing = getTextContent()\n\n    if (ref.current && ref.current.textContent !== textWithTrailing) {\n      ref.current.textContent = textWithTrailing\n    }\n\n    // intentionally not specifying dependencies, so that this effect runs on every render\n    // as this effectively replaces \"specifying the text in the virtual DOM under the <span> below\" on each render\n  })\n\n  // We intentionally render a memoized <span> that only receives the initial text content when the component is mounted.\n  // We defer to the layout effect above to update the `textContent` of the span element when needed.\n  return <MemoizedText ref={ref}>{initialText}</MemoizedText>\n}\n\nconst MemoizedText = memo(\n  forwardRef<HTMLSpanElement, { children: string }>((props, ref) => {\n    return (\n      <span data-slate-string ref={ref}>\n        {props.children}\n      </span>\n    )\n  })\n)\n\n/**\n * Leaf strings without text, render as zero-width strings.\n */\n\nexport const ZeroWidthString = (props: {\n  length?: number\n  isLineBreak?: boolean\n  isMarkPlaceholder?: boolean\n}) => {\n  const { length = 0, isLineBreak = false, isMarkPlaceholder = false } = props\n\n  const attributes: {\n    'data-slate-zero-width': string\n    'data-slate-length': number\n    'data-slate-mark-placeholder'?: boolean\n  } = {\n    'data-slate-zero-width': isLineBreak ? 'n' : 'z',\n    'data-slate-length': length,\n  }\n\n  if (isMarkPlaceholder) {\n    attributes['data-slate-mark-placeholder'] = true\n  }\n\n  return (\n    <span {...attributes}>\n      {!(IS_ANDROID || IS_IOS) || !isLineBreak ? '\\uFEFF' : null}\n      {isLineBreak ? <br /> : null}\n    </span>\n  )\n}\n\nexport default String\n", "import React, {\n  useRef,\n  useCallback,\n  MutableRefObject,\n  useState,\n  useEffect,\n} from 'react'\nimport { JSX } from 'react'\nimport { Element, Text } from 'slate'\nimport { ResizeObserver as ResizeObserverPolyfill } from '@juggle/resize-observer'\nimport String from './string'\nimport {\n  PLACEHOLDER_SYMBOL,\n  EDITOR_TO_PLACEHOLDER_ELEMENT,\n  EDITOR_TO_FORCE_RENDER,\n} from '../utils/weak-maps'\nimport { RenderLeafProps, RenderPlaceholderProps } from './editable'\nimport { useSlateStatic } from '../hooks/use-slate-static'\nimport { IS_WEBKIT, IS_ANDROID } from '../utils/environment'\n\n// Delay the placeholder on Android to prevent the keyboard from closing.\n// (https://github.com/ianstormtaylor/slate/pull/5368)\nconst PLACEHOLDER_DELAY = IS_ANDROID ? 300 : 0\n\nfunction disconnectPlaceholderResizeObserver(\n  placeholderResizeObserver: MutableRefObject<ResizeObserver | null>,\n  releaseObserver: boolean\n) {\n  if (placeholderResizeObserver.current) {\n    placeholderResizeObserver.current.disconnect()\n    if (releaseObserver) {\n      placeholderResizeObserver.current = null\n    }\n  }\n}\n\ntype TimerId = ReturnType<typeof setTimeout> | null\n\nfunction clearTimeoutRef(timeoutRef: MutableRefObject<TimerId>) {\n  if (timeoutRef.current) {\n    clearTimeout(timeoutRef.current)\n    timeoutRef.current = null\n  }\n}\n\n/**\n * Individual leaves in a text node with unique formatting.\n */\nconst Leaf = (props: {\n  isLast: boolean\n  leaf: Text\n  parent: Element\n  renderPlaceholder: (props: RenderPlaceholderProps) => JSX.Element\n  renderLeaf?: (props: RenderLeafProps) => JSX.Element\n  text: Text\n}) => {\n  const {\n    leaf,\n    isLast,\n    text,\n    parent,\n    renderPlaceholder,\n    renderLeaf = (props: RenderLeafProps) => <DefaultLeaf {...props} />,\n  } = props\n\n  const editor = useSlateStatic()\n  const placeholderResizeObserver = useRef<ResizeObserver | null>(null)\n  const placeholderRef = useRef<HTMLElement | null>(null)\n  const [showPlaceholder, setShowPlaceholder] = useState(false)\n  const showPlaceholderTimeoutRef = useRef<TimerId>(null)\n\n  const callbackPlaceholderRef = useCallback(\n    (placeholderEl: HTMLElement | null) => {\n      disconnectPlaceholderResizeObserver(\n        placeholderResizeObserver,\n        placeholderEl == null\n      )\n\n      if (placeholderEl == null) {\n        EDITOR_TO_PLACEHOLDER_ELEMENT.delete(editor)\n        leaf.onPlaceholderResize?.(null)\n      } else {\n        EDITOR_TO_PLACEHOLDER_ELEMENT.set(editor, placeholderEl)\n\n        if (!placeholderResizeObserver.current) {\n          // Create a new observer and observe the placeholder element.\n          const ResizeObserver = window.ResizeObserver || ResizeObserverPolyfill\n          placeholderResizeObserver.current = new ResizeObserver(() => {\n            leaf.onPlaceholderResize?.(placeholderEl)\n          })\n        }\n        placeholderResizeObserver.current.observe(placeholderEl)\n        placeholderRef.current = placeholderEl\n      }\n    },\n    [placeholderRef, leaf, editor]\n  )\n\n  let children = (\n    <String isLast={isLast} leaf={leaf} parent={parent} text={text} />\n  )\n\n  const leafIsPlaceholder = Boolean(leaf[PLACEHOLDER_SYMBOL])\n  useEffect(() => {\n    if (leafIsPlaceholder) {\n      if (!showPlaceholderTimeoutRef.current) {\n        // Delay the placeholder, so it will not render in a selection\n        showPlaceholderTimeoutRef.current = setTimeout(() => {\n          setShowPlaceholder(true)\n          showPlaceholderTimeoutRef.current = null\n        }, PLACEHOLDER_DELAY)\n      }\n    } else {\n      clearTimeoutRef(showPlaceholderTimeoutRef)\n      setShowPlaceholder(false)\n    }\n    return () => clearTimeoutRef(showPlaceholderTimeoutRef)\n  }, [leafIsPlaceholder, setShowPlaceholder])\n\n  if (leafIsPlaceholder && showPlaceholder) {\n    const placeholderProps: RenderPlaceholderProps = {\n      children: leaf.placeholder,\n      attributes: {\n        'data-slate-placeholder': true,\n        style: {\n          position: 'absolute',\n          top: 0,\n          pointerEvents: 'none',\n          width: '100%',\n          maxWidth: '100%',\n          display: 'block',\n          opacity: '0.333',\n          userSelect: 'none',\n          textDecoration: 'none',\n          // Fixes https://github.com/udecode/plate/issues/2315\n          WebkitUserModify: IS_WEBKIT ? 'inherit' : undefined,\n        },\n        contentEditable: false,\n        ref: callbackPlaceholderRef,\n      },\n    }\n\n    children = (\n      <React.Fragment>\n        {renderPlaceholder(placeholderProps)}\n        {children}\n      </React.Fragment>\n    )\n  }\n\n  // COMPAT: Having the `data-` attributes on these leaf elements ensures that\n  // in certain misbehaving browsers they aren't weirdly cloned/destroyed by\n  // contenteditable behaviors. (2019/05/08)\n  const attributes: {\n    'data-slate-leaf': true\n  } = {\n    'data-slate-leaf': true,\n  }\n\n  return renderLeaf({ attributes, children, leaf, text })\n}\n\nconst MemoizedLeaf = React.memo(Leaf, (prev, next) => {\n  return (\n    next.parent === prev.parent &&\n    next.isLast === prev.isLast &&\n    next.renderLeaf === prev.renderLeaf &&\n    next.renderPlaceholder === prev.renderPlaceholder &&\n    next.text === prev.text &&\n    Text.equals(next.leaf, prev.leaf) &&\n    next.leaf[PLACEHOLDER_SYMBOL] === prev.leaf[PLACEHOLDER_SYMBOL]\n  )\n})\n\nexport const DefaultLeaf = (props: RenderLeafProps) => {\n  const { attributes, children } = props\n  return <span {...attributes}>{children}</span>\n}\n\nexport default MemoizedLeaf\n", "import React, { useCallback, useRef } from 'react'\nimport { Element, Range, Text as SlateText } from 'slate'\nimport { ReactEditor, useSlateStatic } from '..'\nimport { isTextDecorationsEqual } from '../utils/range-list'\nimport {\n  EDITOR_TO_KEY_TO_ELEMENT,\n  ELEMENT_TO_NODE,\n  NODE_TO_ELEMENT,\n} from '../utils/weak-maps'\nimport { RenderLeafProps, RenderPlaceholderProps } from './editable'\nimport Leaf from './leaf'\n\n/**\n * Text.\n */\n\nconst Text = (props: {\n  decorations: Range[]\n  isLast: boolean\n  parent: Element\n  renderPlaceholder: (props: RenderPlaceholderProps) => JSX.Element\n  renderLeaf?: (props: RenderLeafProps) => JSX.Element\n  text: SlateText\n}) => {\n  const { decorations, isLast, parent, renderPlaceholder, renderLeaf, text } =\n    props\n  const editor = useSlateStatic()\n  const ref = useRef<HTMLSpanElement | null>(null)\n  const leaves = SlateText.decorations(text, decorations)\n  const key = ReactEditor.findKey(editor, text)\n  const children = []\n\n  for (let i = 0; i < leaves.length; i++) {\n    const leaf = leaves[i]\n\n    children.push(\n      <Leaf\n        isLast={isLast && i === leaves.length - 1}\n        key={`${key.id}-${i}`}\n        renderPlaceholder={renderPlaceholder}\n        leaf={leaf}\n        text={text}\n        parent={parent}\n        renderLeaf={renderLeaf}\n      />\n    )\n  }\n\n  // Update element-related weak maps with the DOM element ref.\n  const callbackRef = useCallback(\n    (span: HTMLSpanElement | null) => {\n      const KEY_TO_ELEMENT = EDITOR_TO_KEY_TO_ELEMENT.get(editor)\n      if (span) {\n        KEY_TO_ELEMENT?.set(key, span)\n        NODE_TO_ELEMENT.set(text, span)\n        ELEMENT_TO_NODE.set(span, text)\n      } else {\n        KEY_TO_ELEMENT?.delete(key)\n        NODE_TO_ELEMENT.delete(text)\n        if (ref.current) {\n          ELEMENT_TO_NODE.delete(ref.current)\n        }\n      }\n      ref.current = span\n    },\n    [ref, editor, key, text]\n  )\n  return (\n    <span data-slate-node=\"text\" ref={callbackRef}>\n      {children}\n    </span>\n  )\n}\n\nconst MemoizedText = React.memo(Text, (prev, next) => {\n  return (\n    next.parent === prev.parent &&\n    next.isLast === prev.isLast &&\n    next.renderLeaf === prev.renderLeaf &&\n    next.renderPlaceholder === prev.renderPlaceholder &&\n    next.text === prev.text &&\n    isTextDecorationsEqual(next.decorations, prev.decorations)\n  )\n})\n\nexport default MemoizedText\n", "import getDirection from 'direction'\nimport React, { useCallback } from 'react'\nimport { JSX } from 'react'\nimport { Editor, Element as SlateElement, Node, Range } from 'slate'\nimport { ReactEditor, useReadOnly, useSlateStatic } from '..'\nimport useChildren from '../hooks/use-children'\nimport { isElementDecorationsEqual } from '../utils/range-list'\nimport {\n  EDITOR_TO_KEY_TO_ELEMENT,\n  ELEMENT_TO_NODE,\n  NODE_TO_ELEMENT,\n  NODE_TO_INDEX,\n  NODE_TO_PARENT,\n} from '../utils/weak-maps'\nimport {\n  RenderElementProps,\n  RenderLeafProps,\n  RenderPlaceholderProps,\n} from './editable'\n\nimport Text from './text'\n\n/**\n * Element.\n */\n\nconst Element = (props: {\n  decorations: Range[]\n  element: SlateElement\n  renderElement?: (props: RenderElementProps) => JSX.Element\n  renderPlaceholder: (props: RenderPlaceholderProps) => JSX.Element\n  renderLeaf?: (props: RenderLeafProps) => JSX.Element\n  selection: Range | null\n}) => {\n  const {\n    decorations,\n    element,\n    renderElement = (p: RenderElementProps) => <DefaultElement {...p} />,\n    renderPlaceholder,\n    renderLeaf,\n    selection,\n  } = props\n  const editor = useSlateStatic()\n  const readOnly = useReadOnly()\n  const isInline = editor.isInline(element)\n  const key = ReactEditor.findKey(editor, element)\n  const ref = useCallback(\n    (ref: HTMLElement | null) => {\n      // Update element-related weak maps with the DOM element ref.\n      const KEY_TO_ELEMENT = EDITOR_TO_KEY_TO_ELEMENT.get(editor)\n      if (ref) {\n        KEY_TO_ELEMENT?.set(key, ref)\n        NODE_TO_ELEMENT.set(element, ref)\n        ELEMENT_TO_NODE.set(ref, element)\n      } else {\n        KEY_TO_ELEMENT?.delete(key)\n        NODE_TO_ELEMENT.delete(element)\n      }\n    },\n    [editor, key, element]\n  )\n  let children: React.ReactNode = useChildren({\n    decorations,\n    node: element,\n    renderElement,\n    renderPlaceholder,\n    renderLeaf,\n    selection,\n  })\n\n  // Attributes that the developer must mix into the element in their\n  // custom node renderer component.\n  const attributes: {\n    'data-slate-node': 'element'\n    'data-slate-void'?: true\n    'data-slate-inline'?: true\n    contentEditable?: false\n    dir?: 'rtl'\n    ref: any\n  } = {\n    'data-slate-node': 'element',\n    ref,\n  }\n\n  if (isInline) {\n    attributes['data-slate-inline'] = true\n  }\n\n  // If it's a block node with inline children, add the proper `dir` attribute\n  // for text direction.\n  if (!isInline && Editor.hasInlines(editor, element)) {\n    const text = Node.string(element)\n    const dir = getDirection(text)\n\n    if (dir === 'rtl') {\n      attributes.dir = dir\n    }\n  }\n\n  // If it's a void node, wrap the children in extra void-specific elements.\n  if (Editor.isVoid(editor, element)) {\n    attributes['data-slate-void'] = true\n\n    if (!readOnly && isInline) {\n      attributes.contentEditable = false\n    }\n\n    const Tag = isInline ? 'span' : 'div'\n    const [[text]] = Node.texts(element)\n\n    children = (\n      <Tag\n        data-slate-spacer\n        style={{\n          height: '0',\n          color: 'transparent',\n          outline: 'none',\n          position: 'absolute',\n        }}\n      >\n        <Text\n          renderPlaceholder={renderPlaceholder}\n          decorations={[]}\n          isLast={false}\n          parent={element}\n          text={text}\n        />\n      </Tag>\n    )\n\n    NODE_TO_INDEX.set(text, 0)\n    NODE_TO_PARENT.set(text, element)\n  }\n\n  return renderElement({ attributes, children, element })\n}\n\nconst MemoizedElement = React.memo(Element, (prev, next) => {\n  return (\n    prev.element === next.element &&\n    prev.renderElement === next.renderElement &&\n    prev.renderLeaf === next.renderLeaf &&\n    prev.renderPlaceholder === next.renderPlaceholder &&\n    isElementDecorationsEqual(prev.decorations, next.decorations) &&\n    (prev.selection === next.selection ||\n      (!!prev.selection &&\n        !!next.selection &&\n        Range.equals(prev.selection, next.selection)))\n  )\n})\n\n/**\n * The default element renderer.\n */\n\nexport const DefaultElement = (props: RenderElementProps) => {\n  const { attributes, children, element } = props\n  const editor = useSlateStatic()\n  const Tag = editor.isInline(element) ? 'span' : 'div'\n  return (\n    <Tag {...attributes} style={{ position: 'relative' }}>\n      {children}\n    </Tag>\n  )\n}\n\nexport default MemoizedElement\n", "import { createContext, useContext } from 'react'\nimport { Range, NodeEntry } from 'slate'\n\n/**\n * A React context for sharing the `decorate` prop of the editable.\n */\n\nexport const DecorateContext = createContext<(entry: NodeEntry) => Range[]>(\n  () => []\n)\n\n/**\n * Get the current `decorate` prop of the editable.\n */\n\nexport const useDecorate = (): ((entry: NodeEntry) => Range[]) => {\n  return useContext(DecorateContext)\n}\n", "import { createContext, useContext } from 'react'\n\n/**\n * A React context for sharing the `selected` state of an element.\n */\n\nexport const SelectedContext = createContext(false)\n\n/**\n * Get the current `selected` state of an element.\n */\n\nexport const useSelected = (): boolean => {\n  return useContext(SelectedContext)\n}\n", "import React from 'react'\nimport { Ancestor, Descendant, Editor, Element, Range } from 'slate'\nimport {\n  RenderElementProps,\n  RenderLeafProps,\n  RenderPlaceholderProps,\n} from '../components/editable'\n\nimport ElementComponent from '../components/element'\nimport TextComponent from '../components/text'\nimport { ReactEditor } from '../plugin/react-editor'\nimport {\n  IS_NODE_MAP_DIRTY,\n  NODE_TO_INDEX,\n  NODE_TO_PARENT,\n} from '../utils/weak-maps'\nimport { useDecorate } from './use-decorate'\nimport { SelectedContext } from './use-selected'\nimport { useSlateStatic } from './use-slate-static'\n\n/**\n * Children.\n */\n\nconst useChildren = (props: {\n  decorations: Range[]\n  node: Ancestor\n  renderElement?: (props: RenderElementProps) => JSX.Element\n  renderPlaceholder: (props: RenderPlaceholderProps) => JSX.Element\n  renderLeaf?: (props: RenderLeafProps) => JSX.Element\n  selection: Range | null\n}) => {\n  const {\n    decorations,\n    node,\n    renderElement,\n    renderPlaceholder,\n    renderLeaf,\n    selection,\n  } = props\n  const decorate = useDecorate()\n  const editor = useSlateStatic()\n  IS_NODE_MAP_DIRTY.set(editor as ReactEditor, false)\n  const path = ReactEditor.findPath(editor, node)\n  const children = []\n  const isLeafBlock =\n    Element.isElement(node) &&\n    !editor.isInline(node) &&\n    Editor.hasInlines(editor, node)\n\n  for (let i = 0; i < node.children.length; i++) {\n    const p = path.concat(i)\n    const n = node.children[i] as Descendant\n    const key = ReactEditor.findKey(editor, n)\n    const range = Editor.range(editor, p)\n    const sel = selection && Range.intersection(range, selection)\n    const ds = decorate([n, p])\n\n    for (const dec of decorations) {\n      const d = Range.intersection(dec, range)\n\n      if (d) {\n        ds.push(d)\n      }\n    }\n\n    if (Element.isElement(n)) {\n      children.push(\n        <SelectedContext.Provider key={`provider-${key.id}`} value={!!sel}>\n          <ElementComponent\n            decorations={ds}\n            element={n}\n            key={key.id}\n            renderElement={renderElement}\n            renderPlaceholder={renderPlaceholder}\n            renderLeaf={renderLeaf}\n            selection={sel}\n          />\n        </SelectedContext.Provider>\n      )\n    } else {\n      children.push(\n        <TextComponent\n          decorations={ds}\n          key={key.id}\n          isLast={isLeafBlock && i === node.children.length - 1}\n          parent={node}\n          renderPlaceholder={renderPlaceholder}\n          renderLeaf={renderLeaf}\n          text={n}\n        />\n      )\n    }\n\n    NODE_TO_INDEX.set(n, i)\n    NODE_TO_PARENT.set(n, node)\n  }\n\n  return children\n}\n\nexport default useChildren\n", "import { createContext, useContext } from 'react'\n\n/**\n * A React context for sharing the `readOnly` state of the editor.\n */\n\nexport const ReadOnlyContext = createContext(false)\n\n/**\n * Get the current `readOnly` state of the editor.\n */\n\nexport const useReadOnly = (): boolean => {\n  return useContext(ReadOnlyContext)\n}\n", "import { createContext, useContext } from 'react'\nimport { Editor } from 'slate'\nimport { ReactEditor } from '../plugin/react-editor'\n\n/**\n * A React context for sharing the editor object, in a way that re-renders the\n * context whenever changes occur.\n */\n\nexport interface SlateContextValue {\n  v: number\n  editor: ReactEditor\n}\n\nexport const SlateContext = createContext<{\n  v: number\n  editor: ReactEditor\n} | null>(null)\n\n/**\n * Get the current editor object from the React context.\n */\n\nexport const useSlate = (): Editor => {\n  const context = useContext(SlateContext)\n\n  if (!context) {\n    throw new Error(\n      `The \\`useSlate\\` hook must be used inside the <Slate> component's context.`\n    )\n  }\n\n  const { editor } = context\n  return editor\n}\n\nexport const useSlateWithV = () => {\n  const context = useContext(SlateContext)\n\n  if (!context) {\n    throw new Error(\n      `The \\`useSlate\\` hook must be used inside the <Slate> component's context.`\n    )\n  }\n\n  return context\n}\n", "import { useCallback, useEffect, useRef } from 'react'\nimport { ReactEditor } from '../plugin/react-editor'\nimport { useSlateStatic } from './use-slate-static'\n\nexport function useTrackUserInput() {\n  const editor = useSlateStatic()\n\n  const receivedUserInput = useRef<boolean>(false)\n  const animationFrameIdRef = useRef<number>(0)\n\n  const onUserInput = useCallback(() => {\n    if (receivedUserInput.current) {\n      return\n    }\n\n    receivedUserInput.current = true\n\n    const window = ReactEditor.getWindow(editor)\n    window.cancelAnimationFrame(animationFrameIdRef.current)\n\n    animationFrameIdRef.current = window.requestAnimationFrame(() => {\n      receivedUserInput.current = false\n    })\n  }, [editor])\n\n  useEffect(() => () => cancelAnimationFrame(animationFrameIdRef.current), [])\n\n  return {\n    receivedUserInput,\n    onUserInput,\n  }\n}\n", "export const TRIPLE_CLICK = 3\n", "import { isHotkey } from 'is-hotkey'\nimport { IS_APPLE } from './environment'\n\n/**\n * Hotkey mappings for each platform.\n */\n\nconst HOTKEYS = {\n  bold: 'mod+b',\n  compose: ['down', 'left', 'right', 'up', 'backspace', 'enter'],\n  moveBackward: 'left',\n  moveForward: 'right',\n  moveWordBackward: 'ctrl+left',\n  moveWordForward: 'ctrl+right',\n  deleteBackward: 'shift?+backspace',\n  deleteForward: 'shift?+delete',\n  extendBackward: 'shift+left',\n  extendForward: 'shift+right',\n  italic: 'mod+i',\n  insertSoftBreak: 'shift+enter',\n  splitBlock: 'enter',\n  undo: 'mod+z',\n}\n\nconst APPLE_HOTKEYS = {\n  moveLineBackward: 'opt+up',\n  moveLineForward: 'opt+down',\n  moveWordBackward: 'opt+left',\n  moveWordForward: 'opt+right',\n  deleteBackward: ['ctrl+backspace', 'ctrl+h'],\n  deleteForward: ['ctrl+delete', 'ctrl+d'],\n  deleteLineBackward: 'cmd+shift?+backspace',\n  deleteLineForward: ['cmd+shift?+delete', 'ctrl+k'],\n  deleteWordBackward: 'opt+shift?+backspace',\n  deleteWordForward: 'opt+shift?+delete',\n  extendLineBackward: 'opt+shift+up',\n  extendLineForward: 'opt+shift+down',\n  redo: 'cmd+shift+z',\n  transposeCharacter: 'ctrl+t',\n}\n\nconst WINDOWS_HOTKEYS = {\n  deleteWordBackward: 'ctrl+shift?+backspace',\n  deleteWordForward: 'ctrl+shift?+delete',\n  redo: ['ctrl+y', 'ctrl+shift+z'],\n}\n\n/**\n * Create a platform-aware hotkey checker.\n */\n\nconst create = (key: string) => {\n  const generic = HOTKEYS[<keyof typeof HOTKEYS>key]\n  const apple = APPLE_HOTKEYS[<keyof typeof APPLE_HOTKEYS>key]\n  const windows = WINDOWS_HOTKEYS[<keyof typeof WINDOWS_HOTKEYS>key]\n  const isGeneric = generic && isHotkey(generic)\n  const isApple = apple && isHotkey(apple)\n  const isWindows = windows && isHotkey(windows)\n\n  return (event: KeyboardEvent) => {\n    if (isGeneric && isGeneric(event)) return true\n    if (IS_APPLE && isApple && isApple(event)) return true\n    if (!IS_APPLE && isWindows && isWindows(event)) return true\n    return false\n  }\n}\n\n/**\n * Hotkeys.\n */\n\nexport default {\n  isBold: create('bold'),\n  isCompose: create('compose'),\n  isMoveBackward: create('moveBackward'),\n  isMoveForward: create('moveForward'),\n  isDeleteBackward: create('deleteBackward'),\n  isDeleteForward: create('deleteForward'),\n  isDeleteLineBackward: create('deleteLineBackward'),\n  isDeleteLineForward: create('deleteLineForward'),\n  isDeleteWordBackward: create('deleteWordBackward'),\n  isDeleteWordForward: create('deleteWordForward'),\n  isExtendBackward: create('extendBackward'),\n  isExtendForward: create('extendForward'),\n  isExtendLineBackward: create('extendLineBackward'),\n  isExtendLineForward: create('extendLineForward'),\n  isItalic: create('italic'),\n  isMoveLineBackward: create('moveLineBackward'),\n  isMoveLineForward: create('moveLineForward'),\n  isMoveWordBackward: create('moveWordBackward'),\n  isMoveWordForward: create('moveWordForward'),\n  isRedo: create('redo'),\n  isSoftBreak: create('insertSoftBreak'),\n  isSplitBlock: create('splitBlock'),\n  isTransposeCharacter: create('transposeCharacter'),\n  isUndo: create('undo'),\n}\n", "import { RefObject } from 'react'\nimport { ReactEditor } from '../../plugin/react-editor'\nimport { isTrackedMutation } from '../../utils/dom'\n\nexport type RestoreDOMManager = {\n  registerMutations: (mutations: MutationRecord[]) => void\n  restoreDOM: () => void\n  clear: () => void\n}\n\nexport const createRestoreDomManager = (\n  editor: ReactEditor,\n  receivedUserInput: RefObject<boolean>\n): RestoreDOMManager => {\n  let bufferedMutations: MutationRecord[] = []\n\n  const clear = () => {\n    bufferedMutations = []\n  }\n\n  const registerMutations = (mutations: MutationRecord[]) => {\n    if (!receivedUserInput.current) {\n      return\n    }\n\n    const trackedMutations = mutations.filter(mutation =>\n      isTrackedMutation(editor, mutation, mutations)\n    )\n\n    bufferedMutations.push(...trackedMutations)\n  }\n\n  function restoreDOM() {\n    if (bufferedMutations.length > 0) {\n      bufferedMutations.reverse().forEach(mutation => {\n        if (mutation.type === 'characterData') {\n          // We don't want to restore the DOM for characterData mutations\n          // because this interrupts the composition.\n          return\n        }\n\n        mutation.removedNodes.forEach(node => {\n          mutation.target.insertBefore(node, mutation.nextSibling)\n        })\n\n        mutation.addedNodes.forEach(node => {\n          mutation.target.removeChild(node)\n        })\n      })\n\n      // Clear buffered mutations to ensure we don't undo them twice\n      clear()\n    }\n  }\n\n  return {\n    registerMutations,\n    restoreDOM,\n    clear,\n  }\n}\n", "import React, {\n  Component,\n  ComponentType,\n  ContextType,\n  ReactNode,\n  RefObject,\n} from 'react'\nimport { EditorContext } from '../../hooks/use-slate-static'\nimport { IS_ANDROID } from '../../utils/environment'\nimport {\n  createRestoreDomManager,\n  RestoreDOMManager,\n} from './restore-dom-manager'\n\nconst MUTATION_OBSERVER_CONFIG: MutationObserverInit = {\n  subtree: true,\n  childList: true,\n  characterData: true,\n  characterDataOldValue: true,\n}\n\ntype RestoreDOMProps = {\n  children?: ReactNode\n  receivedUserInput: RefObject<boolean>\n  node: RefObject<HTMLDivElement>\n}\n\n// We have to use a class component here since we rely on `getSnapshotBeforeUpdate` which has no FC equivalent\n// to run code synchronously immediately before react commits the component update to the DOM.\nclass RestoreDOMComponent extends Component<RestoreDOMProps> {\n  static contextType = EditorContext\n  context: ContextType<typeof EditorContext> = null\n\n  private manager: RestoreDOMManager | null = null\n  private mutationObserver: MutationObserver | null = null\n\n  observe() {\n    const { node } = this.props\n    if (!node.current) {\n      throw new Error('Failed to attach MutationObserver, `node` is undefined')\n    }\n\n    this.mutationObserver?.observe(node.current, MUTATION_OBSERVER_CONFIG)\n  }\n\n  componentDidMount() {\n    const { receivedUserInput } = this.props\n    const editor = this.context!\n\n    this.manager = createRestoreDomManager(editor, receivedUserInput)\n    this.mutationObserver = new MutationObserver(this.manager.registerMutations)\n\n    this.observe()\n  }\n\n  getSnapshotBeforeUpdate() {\n    const pendingMutations = this.mutationObserver?.takeRecords()\n    if (pendingMutations?.length) {\n      this.manager?.registerMutations(pendingMutations)\n    }\n\n    this.mutationObserver?.disconnect()\n    this.manager?.restoreDOM()\n\n    return null\n  }\n\n  componentDidUpdate() {\n    this.manager?.clear()\n    this.observe()\n  }\n\n  componentWillUnmount() {\n    this.mutationObserver?.disconnect()\n  }\n\n  render() {\n    return this.props.children\n  }\n}\n\nexport const RestoreDOM: ComponentType<RestoreDOMProps> = IS_ANDROID\n  ? RestoreDOMComponent\n  : ({ children }) => <>{children}</>\n", "import { createContext, useContext } from 'react'\n\n/**\n * A React context for sharing the `composing` state of the editor.\n */\n\nexport const ComposingContext = createContext(false)\n\n/**\n * Get the current `composing` state of the editor.\n */\n\nexport const useComposing = (): boolean => {\n  return useContext(ComposingContext)\n}\n", "import getDirection from 'direction'\nimport debounce from 'lodash/debounce'\nimport throttle from 'lodash/throttle'\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n  forwardRef,\n  ForwardedRef,\n} from 'react'\nimport { JSX } from 'react'\nimport scrollIntoView from 'scroll-into-view-if-needed'\nimport {\n  Editor,\n  Element,\n  Node,\n  NodeEntry,\n  Path,\n  Range,\n  Text,\n  Transforms,\n} from 'slate'\nimport { useAndroidInputManager } from '../hooks/android-input-manager/use-android-input-manager'\nimport useChildren from '../hooks/use-children'\nimport { DecorateContext } from '../hooks/use-decorate'\nimport { useIsomorphicLayoutEffect } from '../hooks/use-isomorphic-layout-effect'\nimport { ReadOnlyContext } from '../hooks/use-read-only'\nimport { useSlate } from '../hooks/use-slate'\nimport { useTrackUserInput } from '../hooks/use-track-user-input'\nimport { ReactEditor } from '../plugin/react-editor'\nimport { TRIPLE_CLICK } from '../utils/constants'\nimport {\n  DOMElement,\n  DOMRange,\n  DOMText,\n  getActiveElement,\n  getDefaultView,\n  getSelection,\n  isDOMElement,\n  isDOMNode,\n  isPlainTextOnlyPaste,\n} from '../utils/dom'\nimport {\n  CAN_USE_DOM,\n  HAS_BEFORE_INPUT_SUPPORT,\n  IS_ANDROID,\n  IS_CHROME,\n  IS_FIREFOX,\n  IS_FIREFOX_LEGACY,\n  IS_IOS,\n  IS_WEBKIT,\n  IS_UC_MOBILE,\n  IS_WECHATBROWSER,\n} from '../utils/environment'\nimport Hotkeys from '../utils/hotkeys'\nimport {\n  IS_NODE_MAP_DIRTY,\n  EDITOR_TO_ELEMENT,\n  EDITOR_TO_FORCE_RENDER,\n  EDITOR_TO_PENDING_INSERTION_MARKS,\n  EDITOR_TO_USER_MARKS,\n  EDITOR_TO_USER_SELECTION,\n  EDITOR_TO_WINDOW,\n  ELEMENT_TO_NODE,\n  IS_COMPOSING,\n  IS_FOCUSED,\n  IS_READ_ONLY,\n  MARK_PLACEHOLDER_SYMBOL,\n  NODE_TO_ELEMENT,\n  PLACEHOLDER_SYMBOL,\n} from '../utils/weak-maps'\nimport { RestoreDOM } from './restore-dom/restore-dom'\nimport { AndroidInputManager } from '../hooks/android-input-manager/android-input-manager'\nimport { ComposingContext } from '../hooks/use-composing'\n\ntype DeferredOperation = () => void\n\nconst Children = (props: Parameters<typeof useChildren>[0]) => (\n  <React.Fragment>{useChildren(props)}</React.Fragment>\n)\n\n/**\n * `RenderElementProps` are passed to the `renderElement` handler.\n */\n\nexport interface RenderElementProps {\n  children: any\n  element: Element\n  attributes: {\n    'data-slate-node': 'element'\n    'data-slate-inline'?: true\n    'data-slate-void'?: true\n    dir?: 'rtl'\n    ref: any\n  }\n}\n\n/**\n * `RenderLeafProps` are passed to the `renderLeaf` handler.\n */\n\nexport interface RenderLeafProps {\n  children: any\n  leaf: Text\n  text: Text\n  attributes: {\n    'data-slate-leaf': true\n  }\n}\n\n/**\n * `EditableProps` are passed to the `<Editable>` component.\n */\n\nexport type EditableProps = {\n  decorate?: (entry: NodeEntry) => Range[]\n  onDOMBeforeInput?: (event: InputEvent) => void\n  placeholder?: string\n  readOnly?: boolean\n  role?: string\n  style?: React.CSSProperties\n  renderElement?: (props: RenderElementProps) => JSX.Element\n  renderLeaf?: (props: RenderLeafProps) => JSX.Element\n  renderPlaceholder?: (props: RenderPlaceholderProps) => JSX.Element\n  scrollSelectionIntoView?: (editor: ReactEditor, domRange: DOMRange) => void\n  as?: React.ElementType\n  disableDefaultStyles?: boolean\n} & React.TextareaHTMLAttributes<HTMLDivElement>\n\n/**\n * Editable.\n */\n\nexport const Editable = forwardRef(\n  (props: EditableProps, forwardedRef: ForwardedRef<HTMLDivElement>) => {\n    const defaultRenderPlaceholder = useCallback(\n      (props: RenderPlaceholderProps) => <DefaultPlaceholder {...props} />,\n      []\n    )\n    const {\n      autoFocus,\n      decorate = defaultDecorate,\n      onDOMBeforeInput: propsOnDOMBeforeInput,\n      placeholder,\n      readOnly = false,\n      renderElement,\n      renderLeaf,\n      renderPlaceholder = defaultRenderPlaceholder,\n      scrollSelectionIntoView = defaultScrollSelectionIntoView,\n      style: userStyle = {},\n      as: Component = 'div',\n      disableDefaultStyles = false,\n      ...attributes\n    } = props\n    const editor = useSlate()\n    // Rerender editor when composition status changed\n    const [isComposing, setIsComposing] = useState(false)\n    const ref = useRef<HTMLDivElement | null>(null)\n    const deferredOperations = useRef<DeferredOperation[]>([])\n    const [placeholderHeight, setPlaceholderHeight] = useState<\n      number | undefined\n    >()\n    const processing = useRef(false)\n\n    const { onUserInput, receivedUserInput } = useTrackUserInput()\n\n    const [, forceRender] = useReducer(s => s + 1, 0)\n    EDITOR_TO_FORCE_RENDER.set(editor, forceRender)\n\n    // Update internal state on each render.\n    IS_READ_ONLY.set(editor, readOnly)\n\n    // Keep track of some state for the event handler logic.\n    const state = useMemo(\n      () => ({\n        isDraggingInternally: false,\n        isUpdatingSelection: false,\n        latestElement: null as DOMElement | null,\n        hasMarkPlaceholder: false,\n      }),\n      []\n    )\n\n    // The autoFocus TextareaHTMLAttribute doesn't do anything on a div, so it\n    // needs to be manually focused.\n    useEffect(() => {\n      if (ref.current && autoFocus) {\n        ref.current.focus()\n      }\n    }, [autoFocus])\n\n    /**\n     * The AndroidInputManager object has a cyclical dependency on onDOMSelectionChange\n     *\n     * It is defined as a reference to simplify hook dependencies and clarify that\n     * it needs to be initialized.\n     */\n    const androidInputManagerRef = useRef<\n      AndroidInputManager | null | undefined\n    >()\n\n    // Listen on the native `selectionchange` event to be able to update any time\n    // the selection changes. This is required because React's `onSelect` is leaky\n    // and non-standard so it doesn't fire until after a selection has been\n    // released. This causes issues in situations where another change happens\n    // while a selection is being dragged.\n    const onDOMSelectionChange = useMemo(\n      () =>\n        throttle(() => {\n          if (IS_NODE_MAP_DIRTY.get(editor)) {\n            onDOMSelectionChange()\n            return\n          }\n\n          const el = ReactEditor.toDOMNode(editor, editor)\n          const root = el.getRootNode()\n\n          if (!processing.current && IS_WEBKIT && root instanceof ShadowRoot) {\n            processing.current = true\n\n            const active = getActiveElement()\n\n            if (active) {\n              document.execCommand('indent')\n            } else {\n              Transforms.deselect(editor)\n            }\n\n            processing.current = false\n            return\n          }\n\n          const androidInputManager = androidInputManagerRef.current\n          if (\n            (IS_ANDROID || !ReactEditor.isComposing(editor)) &&\n            (!state.isUpdatingSelection || androidInputManager?.isFlushing()) &&\n            !state.isDraggingInternally\n          ) {\n            const root = ReactEditor.findDocumentOrShadowRoot(editor)\n            const { activeElement } = root\n            const el = ReactEditor.toDOMNode(editor, editor)\n            const domSelection = getSelection(root)\n\n            if (activeElement === el) {\n              state.latestElement = activeElement\n              IS_FOCUSED.set(editor, true)\n            } else {\n              IS_FOCUSED.delete(editor)\n            }\n\n            if (!domSelection) {\n              return Transforms.deselect(editor)\n            }\n\n            const { anchorNode, focusNode } = domSelection\n\n            const anchorNodeSelectable =\n              ReactEditor.hasEditableTarget(editor, anchorNode) ||\n              ReactEditor.isTargetInsideNonReadonlyVoid(editor, anchorNode)\n\n            const focusNodeInEditor = ReactEditor.hasTarget(editor, focusNode)\n\n            if (anchorNodeSelectable && focusNodeInEditor) {\n              const range = ReactEditor.toSlateRange(editor, domSelection, {\n                exactMatch: false,\n                suppressThrow: true,\n              })\n\n              if (range) {\n                if (\n                  !ReactEditor.isComposing(editor) &&\n                  !androidInputManager?.hasPendingChanges() &&\n                  !androidInputManager?.isFlushing()\n                ) {\n                  Transforms.select(editor, range)\n                } else {\n                  androidInputManager?.handleUserSelect(range)\n                }\n              }\n            }\n\n            // Deselect the editor if the dom selection is not selectable in readonly mode\n            if (readOnly && (!anchorNodeSelectable || !focusNodeInEditor)) {\n              Transforms.deselect(editor)\n            }\n          }\n        }, 100),\n      [editor, readOnly, state]\n    )\n\n    const scheduleOnDOMSelectionChange = useMemo(\n      () => debounce(onDOMSelectionChange, 0),\n      [onDOMSelectionChange]\n    )\n\n    androidInputManagerRef.current = useAndroidInputManager({\n      node: ref,\n      onDOMSelectionChange,\n      scheduleOnDOMSelectionChange,\n    })\n\n    useIsomorphicLayoutEffect(() => {\n      // Update element-related weak maps with the DOM element ref.\n      let window\n      if (ref.current && (window = getDefaultView(ref.current))) {\n        EDITOR_TO_WINDOW.set(editor, window)\n        EDITOR_TO_ELEMENT.set(editor, ref.current)\n        NODE_TO_ELEMENT.set(editor, ref.current)\n        ELEMENT_TO_NODE.set(ref.current, editor)\n      } else {\n        NODE_TO_ELEMENT.delete(editor)\n      }\n\n      // Make sure the DOM selection state is in sync.\n      const { selection } = editor\n      const root = ReactEditor.findDocumentOrShadowRoot(editor)\n      const domSelection = getSelection(root)\n\n      if (\n        !domSelection ||\n        !ReactEditor.isFocused(editor) ||\n        androidInputManagerRef.current?.hasPendingAction()\n      ) {\n        return\n      }\n\n      const setDomSelection = (forceChange?: boolean) => {\n        const hasDomSelection = domSelection.type !== 'None'\n\n        // If the DOM selection is properly unset, we're done.\n        if (!selection && !hasDomSelection) {\n          return\n        }\n\n        // Get anchorNode and focusNode\n        const focusNode = domSelection.focusNode\n        let anchorNode\n\n        // COMPAT: In firefox the normal seletion way does not work\n        // (https://github.com/ianstormtaylor/slate/pull/5486#issue-1820720223)\n        if (IS_FIREFOX && domSelection.rangeCount > 1) {\n          const firstRange = domSelection.getRangeAt(0)\n          const lastRange = domSelection.getRangeAt(domSelection.rangeCount - 1)\n\n          // Right to left\n          if (firstRange.startContainer === focusNode) {\n            anchorNode = lastRange.endContainer\n          } else {\n            // Left to right\n            anchorNode = firstRange.startContainer\n          }\n        } else {\n          anchorNode = domSelection.anchorNode\n        }\n\n        // verify that the dom selection is in the editor\n        const editorElement = EDITOR_TO_ELEMENT.get(editor)!\n        let hasDomSelectionInEditor = false\n        if (\n          editorElement.contains(anchorNode) &&\n          editorElement.contains(focusNode)\n        ) {\n          hasDomSelectionInEditor = true\n        }\n\n        // If the DOM selection is in the editor and the editor selection is already correct, we're done.\n        if (\n          hasDomSelection &&\n          hasDomSelectionInEditor &&\n          selection &&\n          !forceChange\n        ) {\n          const slateRange = ReactEditor.toSlateRange(editor, domSelection, {\n            exactMatch: true,\n\n            // domSelection is not necessarily a valid Slate range\n            // (e.g. when clicking on contentEditable:false element)\n            suppressThrow: true,\n          })\n\n          if (slateRange && Range.equals(slateRange, selection)) {\n            if (!state.hasMarkPlaceholder) {\n              return\n            }\n\n            // Ensure selection is inside the mark placeholder\n            if (\n              anchorNode?.parentElement?.hasAttribute(\n                'data-slate-mark-placeholder'\n              )\n            ) {\n              return\n            }\n          }\n        }\n\n        // when <Editable/> is being controlled through external value\n        // then its children might just change - DOM responds to it on its own\n        // but Slate's value is not being updated through any operation\n        // and thus it doesn't transform selection on its own\n        if (selection && !ReactEditor.hasRange(editor, selection)) {\n          editor.selection = ReactEditor.toSlateRange(editor, domSelection, {\n            exactMatch: false,\n            suppressThrow: true,\n          })\n          return\n        }\n\n        // Otherwise the DOM selection is out of sync, so update it.\n        state.isUpdatingSelection = true\n\n        const newDomRange: DOMRange | null =\n          selection && ReactEditor.toDOMRange(editor, selection)\n\n        if (newDomRange) {\n          if (ReactEditor.isComposing(editor) && !IS_ANDROID) {\n            domSelection.collapseToEnd()\n          } else if (Range.isBackward(selection!)) {\n            domSelection.setBaseAndExtent(\n              newDomRange.endContainer,\n              newDomRange.endOffset,\n              newDomRange.startContainer,\n              newDomRange.startOffset\n            )\n          } else {\n            domSelection.setBaseAndExtent(\n              newDomRange.startContainer,\n              newDomRange.startOffset,\n              newDomRange.endContainer,\n              newDomRange.endOffset\n            )\n          }\n          scrollSelectionIntoView(editor, newDomRange)\n        } else {\n          domSelection.removeAllRanges()\n        }\n\n        return newDomRange\n      }\n\n      // In firefox if there is more then 1 range and we call setDomSelection we remove the ability to select more cells in a table\n      if (domSelection.rangeCount <= 1) {\n        setDomSelection()\n      }\n\n      const ensureSelection =\n        androidInputManagerRef.current?.isFlushing() === 'action'\n\n      if (!IS_ANDROID || !ensureSelection) {\n        setTimeout(() => {\n          state.isUpdatingSelection = false\n        })\n        return\n      }\n\n      let timeoutId: ReturnType<typeof setTimeout> | null = null\n      const animationFrameId = requestAnimationFrame(() => {\n        if (ensureSelection) {\n          const ensureDomSelection = (forceChange?: boolean) => {\n            try {\n              const el = ReactEditor.toDOMNode(editor, editor)\n              el.focus()\n\n              setDomSelection(forceChange)\n            } catch (e) {\n              // Ignore, dom and state might be out of sync\n            }\n          }\n\n          // Compat: Android IMEs try to force their selection by manually re-applying it even after we set it.\n          // This essentially would make setting the slate selection during an update meaningless, so we force it\n          // again here. We can't only do it in the setTimeout after the animation frame since that would cause a\n          // visible flicker.\n          ensureDomSelection()\n\n          timeoutId = setTimeout(() => {\n            // COMPAT: While setting the selection in an animation frame visually correctly sets the selection,\n            // it doesn't update GBoards spellchecker state. We have to manually trigger a selection change after\n            // the animation frame to ensure it displays the correct state.\n            ensureDomSelection(true)\n            state.isUpdatingSelection = false\n          })\n        }\n      })\n\n      return () => {\n        cancelAnimationFrame(animationFrameId)\n        if (timeoutId) {\n          clearTimeout(timeoutId)\n        }\n      }\n    })\n\n    // Listen on the native `beforeinput` event to get real \"Level 2\" events. This\n    // is required because React's `beforeinput` is fake and never really attaches\n    // to the real event sadly. (2019/11/01)\n    // https://github.com/facebook/react/issues/11211\n    const onDOMBeforeInput = useCallback(\n      (event: InputEvent) => {\n        const el = ReactEditor.toDOMNode(editor, editor)\n        const root = el.getRootNode()\n\n        if (processing?.current && IS_WEBKIT && root instanceof ShadowRoot) {\n          const ranges = event.getTargetRanges()\n          const range = ranges[0]\n\n          const newRange = new window.Range()\n\n          newRange.setStart(range.startContainer, range.startOffset)\n          newRange.setEnd(range.endContainer, range.endOffset)\n\n          // Translate the DOM Range into a Slate Range\n          const slateRange = ReactEditor.toSlateRange(editor, newRange, {\n            exactMatch: false,\n            suppressThrow: false,\n          })\n\n          Transforms.select(editor, slateRange)\n\n          event.preventDefault()\n          event.stopImmediatePropagation()\n          return\n        }\n        onUserInput()\n\n        if (\n          !readOnly &&\n          ReactEditor.hasEditableTarget(editor, event.target) &&\n          !isDOMEventHandled(event, propsOnDOMBeforeInput)\n        ) {\n          // COMPAT: BeforeInput events aren't cancelable on android, so we have to handle them differently using the android input manager.\n          if (androidInputManagerRef.current) {\n            return androidInputManagerRef.current.handleDOMBeforeInput(event)\n          }\n\n          // Some IMEs/Chrome extensions like e.g. Grammarly set the selection immediately before\n          // triggering a `beforeinput` expecting the change to be applied to the immediately before\n          // set selection.\n          scheduleOnDOMSelectionChange.flush()\n          onDOMSelectionChange.flush()\n\n          const { selection } = editor\n          const { inputType: type } = event\n          const data = (event as any).dataTransfer || event.data || undefined\n\n          const isCompositionChange =\n            type === 'insertCompositionText' || type === 'deleteCompositionText'\n\n          // COMPAT: use composition change events as a hint to where we should insert\n          // composition text if we aren't composing to work around https://github.com/ianstormtaylor/slate/issues/5038\n          if (isCompositionChange && ReactEditor.isComposing(editor)) {\n            return\n          }\n\n          let native = false\n          if (\n            type === 'insertText' &&\n            selection &&\n            Range.isCollapsed(selection) &&\n            // Only use native character insertion for single characters a-z or space for now.\n            // Long-press events (hold a + press 4 = ) to choose a special character otherwise\n            // causes duplicate inserts.\n            event.data &&\n            event.data.length === 1 &&\n            /[a-z ]/i.test(event.data) &&\n            // Chrome has issues correctly editing the start of nodes: https://bugs.chromium.org/p/chromium/issues/detail?id=1249405\n            // When there is an inline element, e.g. a link, and you select\n            // right after it (the start of the next node).\n            selection.anchor.offset !== 0\n          ) {\n            native = true\n\n            // Skip native if there are marks, as\n            // `insertText` will insert a node, not just text.\n            if (editor.marks) {\n              native = false\n            }\n\n            // If the NODE_MAP is dirty, we can't trust the selection anchor (eg ReactEditor.toDOMPoint)\n            if (!IS_NODE_MAP_DIRTY.get(editor)) {\n              // Chrome also has issues correctly editing the end of anchor elements: https://bugs.chromium.org/p/chromium/issues/detail?id=1259100\n              // Therefore we don't allow native events to insert text at the end of anchor nodes.\n              const { anchor } = selection\n\n              const [node, offset] = ReactEditor.toDOMPoint(editor, anchor)\n              const anchorNode = node.parentElement?.closest('a')\n\n              const window = ReactEditor.getWindow(editor)\n\n              if (\n                native &&\n                anchorNode &&\n                ReactEditor.hasDOMNode(editor, anchorNode)\n              ) {\n                // Find the last text node inside the anchor.\n                const lastText = window?.document\n                  .createTreeWalker(anchorNode, NodeFilter.SHOW_TEXT)\n                  .lastChild() as DOMText | null\n\n                if (\n                  lastText === node &&\n                  lastText.textContent?.length === offset\n                ) {\n                  native = false\n                }\n              }\n\n              // Chrome has issues with the presence of tab characters inside elements with whiteSpace = 'pre'\n              // causing abnormal insert behavior: https://bugs.chromium.org/p/chromium/issues/detail?id=1219139\n              if (\n                native &&\n                node.parentElement &&\n                window?.getComputedStyle(node.parentElement)?.whiteSpace ===\n                  'pre'\n              ) {\n                const block = Editor.above(editor, {\n                  at: anchor.path,\n                  match: n => Element.isElement(n) && Editor.isBlock(editor, n),\n                })\n\n                if (block && Node.string(block[0]).includes('\\t')) {\n                  native = false\n                }\n              }\n            }\n          }\n          // COMPAT: For the deleting forward/backward input types we don't want\n          // to change the selection because it is the range that will be deleted,\n          // and those commands determine that for themselves.\n          // If the NODE_MAP is dirty, we can't trust the selection anchor (eg ReactEditor.toDOMPoint via ReactEditor.toSlateRange)\n          if (\n            (!type.startsWith('delete') || type.startsWith('deleteBy')) &&\n            !IS_NODE_MAP_DIRTY.get(editor)\n          ) {\n            const [targetRange] = (event as any).getTargetRanges()\n\n            if (targetRange) {\n              const range = ReactEditor.toSlateRange(editor, targetRange, {\n                exactMatch: false,\n                suppressThrow: false,\n              })\n\n              if (!selection || !Range.equals(selection, range)) {\n                native = false\n\n                const selectionRef =\n                  !isCompositionChange &&\n                  editor.selection &&\n                  Editor.rangeRef(editor, editor.selection)\n\n                Transforms.select(editor, range)\n\n                if (selectionRef) {\n                  EDITOR_TO_USER_SELECTION.set(editor, selectionRef)\n                }\n              }\n            }\n          }\n\n          // Composition change types occur while a user is composing text and can't be\n          // cancelled. Let them through and wait for the composition to end.\n          if (isCompositionChange) {\n            return\n          }\n\n          if (!native) {\n            event.preventDefault()\n          }\n\n          // COMPAT: If the selection is expanded, even if the command seems like\n          // a delete forward/backward command it should delete the selection.\n          if (\n            selection &&\n            Range.isExpanded(selection) &&\n            type.startsWith('delete')\n          ) {\n            const direction = type.endsWith('Backward') ? 'backward' : 'forward'\n            Editor.deleteFragment(editor, { direction })\n            return\n          }\n\n          switch (type) {\n            case 'deleteByComposition':\n            case 'deleteByCut':\n            case 'deleteByDrag': {\n              Editor.deleteFragment(editor)\n              break\n            }\n\n            case 'deleteContent':\n            case 'deleteContentForward': {\n              Editor.deleteForward(editor)\n              break\n            }\n\n            case 'deleteContentBackward': {\n              Editor.deleteBackward(editor)\n              break\n            }\n\n            case 'deleteEntireSoftLine': {\n              Editor.deleteBackward(editor, { unit: 'line' })\n              Editor.deleteForward(editor, { unit: 'line' })\n              break\n            }\n\n            case 'deleteHardLineBackward': {\n              Editor.deleteBackward(editor, { unit: 'block' })\n              break\n            }\n\n            case 'deleteSoftLineBackward': {\n              Editor.deleteBackward(editor, { unit: 'line' })\n              break\n            }\n\n            case 'deleteHardLineForward': {\n              Editor.deleteForward(editor, { unit: 'block' })\n              break\n            }\n\n            case 'deleteSoftLineForward': {\n              Editor.deleteForward(editor, { unit: 'line' })\n              break\n            }\n\n            case 'deleteWordBackward': {\n              Editor.deleteBackward(editor, { unit: 'word' })\n              break\n            }\n\n            case 'deleteWordForward': {\n              Editor.deleteForward(editor, { unit: 'word' })\n              break\n            }\n\n            case 'insertLineBreak':\n              Editor.insertSoftBreak(editor)\n              break\n\n            case 'insertParagraph': {\n              Editor.insertBreak(editor)\n              break\n            }\n\n            case 'insertFromComposition':\n            case 'insertFromDrop':\n            case 'insertFromPaste':\n            case 'insertFromYank':\n            case 'insertReplacementText':\n            case 'insertText': {\n              if (type === 'insertFromComposition') {\n                // COMPAT: in Safari, `compositionend` is dispatched after the\n                // `beforeinput` for \"insertFromComposition\". But if we wait for it\n                // then we will abort because we're still composing and the selection\n                // won't be updated properly.\n                // https://www.w3.org/TR/input-events-2/\n                if (ReactEditor.isComposing(editor)) {\n                  setIsComposing(false)\n                  IS_COMPOSING.set(editor, false)\n                }\n              }\n\n              // use a weak comparison instead of 'instanceof' to allow\n              // programmatic access of paste events coming from external windows\n              // like cypress where cy.window does not work realibly\n              if (data?.constructor.name === 'DataTransfer') {\n                ReactEditor.insertData(editor, data)\n              } else if (typeof data === 'string') {\n                // Only insertText operations use the native functionality, for now.\n                // Potentially expand to single character deletes, as well.\n                if (native) {\n                  deferredOperations.current.push(() =>\n                    Editor.insertText(editor, data)\n                  )\n                } else {\n                  Editor.insertText(editor, data)\n                }\n              }\n\n              break\n            }\n          }\n\n          // Restore the actual user section if nothing manually set it.\n          const toRestore = EDITOR_TO_USER_SELECTION.get(editor)?.unref()\n          EDITOR_TO_USER_SELECTION.delete(editor)\n\n          if (\n            toRestore &&\n            (!editor.selection || !Range.equals(editor.selection, toRestore))\n          ) {\n            Transforms.select(editor, toRestore)\n          }\n        }\n      },\n      [\n        editor,\n        onDOMSelectionChange,\n        onUserInput,\n        propsOnDOMBeforeInput,\n        readOnly,\n        scheduleOnDOMSelectionChange,\n      ]\n    )\n\n    const callbackRef = useCallback(\n      (node: HTMLDivElement | null) => {\n        if (node == null) {\n          onDOMSelectionChange.cancel()\n          scheduleOnDOMSelectionChange.cancel()\n\n          EDITOR_TO_ELEMENT.delete(editor)\n          NODE_TO_ELEMENT.delete(editor)\n\n          if (ref.current && HAS_BEFORE_INPUT_SUPPORT) {\n            // @ts-ignore The `beforeinput` event isn't recognized.\n            ref.current.removeEventListener('beforeinput', onDOMBeforeInput)\n          }\n        } else {\n          // Attach a native DOM event handler for `beforeinput` events, because React's\n          // built-in `onBeforeInput` is actually a leaky polyfill that doesn't expose\n          // real `beforeinput` events sadly... (2019/11/04)\n          // https://github.com/facebook/react/issues/11211\n          if (HAS_BEFORE_INPUT_SUPPORT) {\n            // @ts-ignore The `beforeinput` event isn't recognized.\n            node.addEventListener('beforeinput', onDOMBeforeInput)\n          }\n        }\n\n        ref.current = node\n        if (typeof forwardedRef === 'function') {\n          forwardedRef(node)\n        } else if (forwardedRef) {\n          forwardedRef.current = node\n        }\n      },\n      [\n        onDOMSelectionChange,\n        scheduleOnDOMSelectionChange,\n        editor,\n        onDOMBeforeInput,\n        forwardedRef,\n      ]\n    )\n\n    useIsomorphicLayoutEffect(() => {\n      const window = ReactEditor.getWindow(editor)\n\n      // Attach a native DOM event handler for `selectionchange`, because React's\n      // built-in `onSelect` handler doesn't fire for all selection changes. It's\n      // a leaky polyfill that only fires on keypresses or clicks. Instead, we\n      // want to fire for any change to the selection inside the editor.\n      // (2019/11/04) https://github.com/facebook/react/issues/5785\n      window.document.addEventListener(\n        'selectionchange',\n        scheduleOnDOMSelectionChange\n      )\n\n      // Listen for dragend and drop globally. In Firefox, if a drop handler\n      // initiates an operation that causes the originally dragged element to\n      // unmount, that element will not emit a dragend event. (2024/06/21)\n      const stoppedDragging = () => {\n        state.isDraggingInternally = false\n      }\n      window.document.addEventListener('dragend', stoppedDragging)\n      window.document.addEventListener('drop', stoppedDragging)\n\n      return () => {\n        window.document.removeEventListener(\n          'selectionchange',\n          scheduleOnDOMSelectionChange\n        )\n        window.document.removeEventListener('dragend', stoppedDragging)\n        window.document.removeEventListener('drop', stoppedDragging)\n      }\n    }, [scheduleOnDOMSelectionChange, state])\n\n    const decorations = decorate([editor, []])\n\n    const showPlaceholder =\n      placeholder &&\n      editor.children.length === 1 &&\n      Array.from(Node.texts(editor)).length === 1 &&\n      Node.string(editor) === '' &&\n      !isComposing\n\n    const placeHolderResizeHandler = useCallback(\n      (placeholderEl: HTMLElement | null) => {\n        if (placeholderEl && showPlaceholder) {\n          setPlaceholderHeight(placeholderEl.getBoundingClientRect()?.height)\n        } else {\n          setPlaceholderHeight(undefined)\n        }\n      },\n      [showPlaceholder]\n    )\n\n    if (showPlaceholder) {\n      const start = Editor.start(editor, [])\n      decorations.push({\n        [PLACEHOLDER_SYMBOL]: true,\n        placeholder,\n        onPlaceholderResize: placeHolderResizeHandler,\n        anchor: start,\n        focus: start,\n      })\n    }\n\n    const { marks } = editor\n    state.hasMarkPlaceholder = false\n\n    if (editor.selection && Range.isCollapsed(editor.selection) && marks) {\n      const { anchor } = editor.selection\n      const leaf = Node.leaf(editor, anchor.path)\n      const { text, ...rest } = leaf\n\n      // While marks isn't a 'complete' text, we can still use loose Text.equals\n      // here which only compares marks anyway.\n      if (!Text.equals(leaf, marks as Text, { loose: true })) {\n        state.hasMarkPlaceholder = true\n\n        const unset = Object.fromEntries(\n          Object.keys(rest).map(mark => [mark, null])\n        )\n\n        decorations.push({\n          [MARK_PLACEHOLDER_SYMBOL]: true,\n          ...unset,\n          ...marks,\n\n          anchor,\n          focus: anchor,\n        })\n      }\n    }\n\n    // Update EDITOR_TO_MARK_PLACEHOLDER_MARKS in setTimeout useEffect to ensure we don't set it\n    // before we receive the composition end event.\n    useEffect(() => {\n      setTimeout(() => {\n        const { selection } = editor\n        if (selection) {\n          const { anchor } = selection\n          const text = Node.leaf(editor, anchor.path)\n\n          // While marks isn't a 'complete' text, we can still use loose Text.equals\n          // here which only compares marks anyway.\n          if (marks && !Text.equals(text, marks as Text, { loose: true })) {\n            EDITOR_TO_PENDING_INSERTION_MARKS.set(editor, marks)\n            return\n          }\n        }\n\n        EDITOR_TO_PENDING_INSERTION_MARKS.delete(editor)\n      })\n    })\n\n    return (\n      <ReadOnlyContext.Provider value={readOnly}>\n        <ComposingContext.Provider value={isComposing}>\n          <DecorateContext.Provider value={decorate}>\n            <RestoreDOM node={ref} receivedUserInput={receivedUserInput}>\n              <Component\n                role={readOnly ? undefined : 'textbox'}\n                aria-multiline={readOnly ? undefined : true}\n                {...attributes}\n                // COMPAT: Certain browsers don't support the `beforeinput` event, so we'd\n                // have to use hacks to make these replacement-based features work.\n                // For SSR situations HAS_BEFORE_INPUT_SUPPORT is false and results in prop\n                // mismatch warning app moves to browser. Pass-through consumer props when\n                // not CAN_USE_DOM (SSR) and default to falsy value\n                spellCheck={\n                  HAS_BEFORE_INPUT_SUPPORT || !CAN_USE_DOM\n                    ? attributes.spellCheck\n                    : false\n                }\n                autoCorrect={\n                  HAS_BEFORE_INPUT_SUPPORT || !CAN_USE_DOM\n                    ? attributes.autoCorrect\n                    : 'false'\n                }\n                autoCapitalize={\n                  HAS_BEFORE_INPUT_SUPPORT || !CAN_USE_DOM\n                    ? attributes.autoCapitalize\n                    : 'false'\n                }\n                data-slate-editor\n                data-slate-node=\"value\"\n                // explicitly set this\n                contentEditable={!readOnly}\n                // in some cases, a decoration needs access to the range / selection to decorate a text node,\n                // then you will select the whole text node when you select part the of text\n                // this magic zIndex=\"-1\" will fix it\n                zindex={-1}\n                suppressContentEditableWarning\n                ref={callbackRef}\n                style={{\n                  ...(disableDefaultStyles\n                    ? {}\n                    : {\n                        // Allow positioning relative to the editable element.\n                        position: 'relative',\n                        // Preserve adjacent whitespace and new lines.\n                        whiteSpace: 'pre-wrap',\n                        // Allow words to break if they are too long.\n                        wordWrap: 'break-word',\n                        // Make the minimum height that of the placeholder.\n                        ...(placeholderHeight\n                          ? { minHeight: placeholderHeight }\n                          : {}),\n                      }),\n                  // Allow for passed-in styles to override anything.\n                  ...userStyle,\n                }}\n                onBeforeInput={useCallback(\n                  (event: React.FormEvent<HTMLDivElement>) => {\n                    // COMPAT: Certain browsers don't support the `beforeinput` event, so we\n                    // fall back to React's leaky polyfill instead just for it. It\n                    // only works for the `insertText` input type.\n                    if (\n                      !HAS_BEFORE_INPUT_SUPPORT &&\n                      !readOnly &&\n                      !isEventHandled(event, attributes.onBeforeInput) &&\n                      ReactEditor.hasSelectableTarget(editor, event.target)\n                    ) {\n                      event.preventDefault()\n                      if (!ReactEditor.isComposing(editor)) {\n                        const text = (event as any).data as string\n                        Editor.insertText(editor, text)\n                      }\n                    }\n                  },\n                  [attributes.onBeforeInput, editor, readOnly]\n                )}\n                onInput={useCallback(\n                  (event: React.FormEvent<HTMLDivElement>) => {\n                    if (isEventHandled(event, attributes.onInput)) {\n                      return\n                    }\n\n                    if (androidInputManagerRef.current) {\n                      androidInputManagerRef.current.handleInput()\n                      return\n                    }\n\n                    // Flush native operations, as native events will have propogated\n                    // and we can correctly compare DOM text values in components\n                    // to stop rendering, so that browser functions like autocorrect\n                    // and spellcheck work as expected.\n                    for (const op of deferredOperations.current) {\n                      op()\n                    }\n                    deferredOperations.current = []\n\n                    // COMPAT: Since `beforeinput` doesn't fully `preventDefault`,\n                    // there's a chance that content might be placed in the browser's undo stack.\n                    // This means undo can be triggered even when the div is not focused,\n                    // and it only triggers the input event for the node. (2024/10/09)\n                    if (!ReactEditor.isFocused(editor)) {\n                      const native = event.nativeEvent as InputEvent\n                      const maybeHistoryEditor: any = editor\n                      if (\n                        native.inputType === 'historyUndo' &&\n                        typeof maybeHistoryEditor.undo === 'function'\n                      ) {\n                        maybeHistoryEditor.undo()\n                        return\n                      }\n                      if (\n                        native.inputType === 'historyRedo' &&\n                        typeof maybeHistoryEditor.redo === 'function'\n                      ) {\n                        maybeHistoryEditor.redo()\n                        return\n                      }\n                    }\n                  },\n                  [attributes.onInput, editor]\n                )}\n                onBlur={useCallback(\n                  (event: React.FocusEvent<HTMLDivElement>) => {\n                    if (\n                      readOnly ||\n                      state.isUpdatingSelection ||\n                      !ReactEditor.hasSelectableTarget(editor, event.target) ||\n                      isEventHandled(event, attributes.onBlur)\n                    ) {\n                      return\n                    }\n\n                    // COMPAT: If the current `activeElement` is still the previous\n                    // one, this is due to the window being blurred when the tab\n                    // itself becomes unfocused, so we want to abort early to allow to\n                    // editor to stay focused when the tab becomes focused again.\n                    const root = ReactEditor.findDocumentOrShadowRoot(editor)\n                    if (state.latestElement === root.activeElement) {\n                      return\n                    }\n\n                    const { relatedTarget } = event\n                    const el = ReactEditor.toDOMNode(editor, editor)\n\n                    // COMPAT: The event should be ignored if the focus is returning\n                    // to the editor from an embedded editable element (eg. an <input>\n                    // element inside a void node).\n                    if (relatedTarget === el) {\n                      return\n                    }\n\n                    // COMPAT: The event should be ignored if the focus is moving from\n                    // the editor to inside a void node's spacer element.\n                    if (\n                      isDOMElement(relatedTarget) &&\n                      relatedTarget.hasAttribute('data-slate-spacer')\n                    ) {\n                      return\n                    }\n\n                    // COMPAT: The event should be ignored if the focus is moving to a\n                    // non- editable section of an element that isn't a void node (eg.\n                    // a list item of the check list example).\n                    if (\n                      relatedTarget != null &&\n                      isDOMNode(relatedTarget) &&\n                      ReactEditor.hasDOMNode(editor, relatedTarget)\n                    ) {\n                      const node = ReactEditor.toSlateNode(\n                        editor,\n                        relatedTarget\n                      )\n\n                      if (Element.isElement(node) && !editor.isVoid(node)) {\n                        return\n                      }\n                    }\n\n                    // COMPAT: Safari doesn't always remove the selection even if the content-\n                    // editable element no longer has focus. Refer to:\n                    // https://stackoverflow.com/questions/12353247/force-contenteditable-div-to-stop-accepting-input-after-it-loses-focus-under-web\n                    if (IS_WEBKIT) {\n                      const domSelection = getSelection(root)\n                      domSelection?.removeAllRanges()\n                    }\n\n                    IS_FOCUSED.delete(editor)\n                  },\n                  [\n                    readOnly,\n                    state.isUpdatingSelection,\n                    state.latestElement,\n                    editor,\n                    attributes.onBlur,\n                  ]\n                )}\n                onClick={useCallback(\n                  (event: React.MouseEvent<HTMLDivElement>) => {\n                    if (\n                      ReactEditor.hasTarget(editor, event.target) &&\n                      !isEventHandled(event, attributes.onClick) &&\n                      isDOMNode(event.target)\n                    ) {\n                      const node = ReactEditor.toSlateNode(editor, event.target)\n                      const path = ReactEditor.findPath(editor, node)\n\n                      // At this time, the Slate document may be arbitrarily different,\n                      // because onClick handlers can change the document before we get here.\n                      // Therefore we must check that this path actually exists,\n                      // and that it still refers to the same node.\n                      if (\n                        !Editor.hasPath(editor, path) ||\n                        Node.get(editor, path) !== node\n                      ) {\n                        return\n                      }\n\n                      if (event.detail === TRIPLE_CLICK && path.length >= 1) {\n                        let blockPath = path\n                        if (\n                          !(\n                            Element.isElement(node) &&\n                            Editor.isBlock(editor, node)\n                          )\n                        ) {\n                          const block = Editor.above(editor, {\n                            match: n =>\n                              Element.isElement(n) && Editor.isBlock(editor, n),\n                            at: path,\n                          })\n\n                          blockPath = block?.[1] ?? path.slice(0, 1)\n                        }\n\n                        const range = Editor.range(editor, blockPath)\n                        Transforms.select(editor, range)\n                        return\n                      }\n\n                      if (readOnly) {\n                        return\n                      }\n\n                      const start = Editor.start(editor, path)\n                      const end = Editor.end(editor, path)\n                      const startVoid = Editor.void(editor, { at: start })\n                      const endVoid = Editor.void(editor, { at: end })\n\n                      if (\n                        startVoid &&\n                        endVoid &&\n                        Path.equals(startVoid[1], endVoid[1])\n                      ) {\n                        const range = Editor.range(editor, start)\n                        Transforms.select(editor, range)\n                      }\n                    }\n                  },\n                  [editor, attributes.onClick, readOnly]\n                )}\n                onCompositionEnd={useCallback(\n                  (event: React.CompositionEvent<HTMLDivElement>) => {\n                    if (ReactEditor.hasSelectableTarget(editor, event.target)) {\n                      if (ReactEditor.isComposing(editor)) {\n                        Promise.resolve().then(() => {\n                          setIsComposing(false)\n                          IS_COMPOSING.set(editor, false)\n                        })\n                      }\n\n                      androidInputManagerRef.current?.handleCompositionEnd(\n                        event\n                      )\n\n                      if (\n                        isEventHandled(event, attributes.onCompositionEnd) ||\n                        IS_ANDROID\n                      ) {\n                        return\n                      }\n\n                      // COMPAT: In Chrome, `beforeinput` events for compositions\n                      // aren't correct and never fire the \"insertFromComposition\"\n                      // type that we need. So instead, insert whenever a composition\n                      // ends since it will already have been committed to the DOM.\n                      if (\n                        !IS_WEBKIT &&\n                        !IS_FIREFOX_LEGACY &&\n                        !IS_IOS &&\n                        !IS_WECHATBROWSER &&\n                        !IS_UC_MOBILE &&\n                        event.data\n                      ) {\n                        const placeholderMarks =\n                          EDITOR_TO_PENDING_INSERTION_MARKS.get(editor)\n                        EDITOR_TO_PENDING_INSERTION_MARKS.delete(editor)\n\n                        // Ensure we insert text with the marks the user was actually seeing\n                        if (placeholderMarks !== undefined) {\n                          EDITOR_TO_USER_MARKS.set(editor, editor.marks)\n                          editor.marks = placeholderMarks\n                        }\n\n                        Editor.insertText(editor, event.data)\n\n                        const userMarks = EDITOR_TO_USER_MARKS.get(editor)\n                        EDITOR_TO_USER_MARKS.delete(editor)\n                        if (userMarks !== undefined) {\n                          editor.marks = userMarks\n                        }\n                      }\n                    }\n                  },\n                  [attributes.onCompositionEnd, editor]\n                )}\n                onCompositionUpdate={useCallback(\n                  (event: React.CompositionEvent<HTMLDivElement>) => {\n                    if (\n                      ReactEditor.hasSelectableTarget(editor, event.target) &&\n                      !isEventHandled(event, attributes.onCompositionUpdate)\n                    ) {\n                      if (!ReactEditor.isComposing(editor)) {\n                        setIsComposing(true)\n                        IS_COMPOSING.set(editor, true)\n                      }\n                    }\n                  },\n                  [attributes.onCompositionUpdate, editor]\n                )}\n                onCompositionStart={useCallback(\n                  (event: React.CompositionEvent<HTMLDivElement>) => {\n                    if (ReactEditor.hasSelectableTarget(editor, event.target)) {\n                      androidInputManagerRef.current?.handleCompositionStart(\n                        event\n                      )\n\n                      if (\n                        isEventHandled(event, attributes.onCompositionStart) ||\n                        IS_ANDROID\n                      ) {\n                        return\n                      }\n\n                      setIsComposing(true)\n\n                      const { selection } = editor\n                      if (selection && Range.isExpanded(selection)) {\n                        Editor.deleteFragment(editor)\n                        return\n                      }\n                    }\n                  },\n                  [attributes.onCompositionStart, editor]\n                )}\n                onCopy={useCallback(\n                  (event: React.ClipboardEvent<HTMLDivElement>) => {\n                    if (\n                      ReactEditor.hasSelectableTarget(editor, event.target) &&\n                      !isEventHandled(event, attributes.onCopy) &&\n                      !isDOMEventTargetInput(event)\n                    ) {\n                      event.preventDefault()\n                      ReactEditor.setFragmentData(\n                        editor,\n                        event.clipboardData,\n                        'copy'\n                      )\n                    }\n                  },\n                  [attributes.onCopy, editor]\n                )}\n                onCut={useCallback(\n                  (event: React.ClipboardEvent<HTMLDivElement>) => {\n                    if (\n                      !readOnly &&\n                      ReactEditor.hasSelectableTarget(editor, event.target) &&\n                      !isEventHandled(event, attributes.onCut) &&\n                      !isDOMEventTargetInput(event)\n                    ) {\n                      event.preventDefault()\n                      ReactEditor.setFragmentData(\n                        editor,\n                        event.clipboardData,\n                        'cut'\n                      )\n                      const { selection } = editor\n\n                      if (selection) {\n                        if (Range.isExpanded(selection)) {\n                          Editor.deleteFragment(editor)\n                        } else {\n                          const node = Node.parent(\n                            editor,\n                            selection.anchor.path\n                          )\n                          if (Editor.isVoid(editor, node)) {\n                            Transforms.delete(editor)\n                          }\n                        }\n                      }\n                    }\n                  },\n                  [readOnly, editor, attributes.onCut]\n                )}\n                onDragOver={useCallback(\n                  (event: React.DragEvent<HTMLDivElement>) => {\n                    if (\n                      ReactEditor.hasTarget(editor, event.target) &&\n                      !isEventHandled(event, attributes.onDragOver)\n                    ) {\n                      // Only when the target is void, call `preventDefault` to signal\n                      // that drops are allowed. Editable content is droppable by\n                      // default, and calling `preventDefault` hides the cursor.\n                      const node = ReactEditor.toSlateNode(editor, event.target)\n\n                      if (\n                        Element.isElement(node) &&\n                        Editor.isVoid(editor, node)\n                      ) {\n                        event.preventDefault()\n                      }\n                    }\n                  },\n                  [attributes.onDragOver, editor]\n                )}\n                onDragStart={useCallback(\n                  (event: React.DragEvent<HTMLDivElement>) => {\n                    if (\n                      !readOnly &&\n                      ReactEditor.hasTarget(editor, event.target) &&\n                      !isEventHandled(event, attributes.onDragStart)\n                    ) {\n                      const node = ReactEditor.toSlateNode(editor, event.target)\n                      const path = ReactEditor.findPath(editor, node)\n                      const voidMatch =\n                        (Element.isElement(node) &&\n                          Editor.isVoid(editor, node)) ||\n                        Editor.void(editor, { at: path, voids: true })\n\n                      // If starting a drag on a void node, make sure it is selected\n                      // so that it shows up in the selection's fragment.\n                      if (voidMatch) {\n                        const range = Editor.range(editor, path)\n                        Transforms.select(editor, range)\n                      }\n\n                      state.isDraggingInternally = true\n\n                      ReactEditor.setFragmentData(\n                        editor,\n                        event.dataTransfer,\n                        'drag'\n                      )\n                    }\n                  },\n                  [readOnly, editor, attributes.onDragStart, state]\n                )}\n                onDrop={useCallback(\n                  (event: React.DragEvent<HTMLDivElement>) => {\n                    if (\n                      !readOnly &&\n                      ReactEditor.hasTarget(editor, event.target) &&\n                      !isEventHandled(event, attributes.onDrop)\n                    ) {\n                      event.preventDefault()\n\n                      // Keep a reference to the dragged range before updating selection\n                      const draggedRange = editor.selection\n\n                      // Find the range where the drop happened\n                      const range = ReactEditor.findEventRange(editor, event)\n                      const data = event.dataTransfer\n\n                      Transforms.select(editor, range)\n\n                      if (state.isDraggingInternally) {\n                        if (\n                          draggedRange &&\n                          !Range.equals(draggedRange, range) &&\n                          !Editor.void(editor, { at: range, voids: true })\n                        ) {\n                          Transforms.delete(editor, {\n                            at: draggedRange,\n                          })\n                        }\n                      }\n\n                      ReactEditor.insertData(editor, data)\n\n                      // When dragging from another source into the editor, it's possible\n                      // that the current editor does not have focus.\n                      if (!ReactEditor.isFocused(editor)) {\n                        ReactEditor.focus(editor)\n                      }\n                    }\n                  },\n                  [readOnly, editor, attributes.onDrop, state]\n                )}\n                onDragEnd={useCallback(\n                  (event: React.DragEvent<HTMLDivElement>) => {\n                    if (\n                      !readOnly &&\n                      state.isDraggingInternally &&\n                      attributes.onDragEnd &&\n                      ReactEditor.hasTarget(editor, event.target)\n                    ) {\n                      attributes.onDragEnd(event)\n                    }\n                  },\n                  [readOnly, state, attributes, editor]\n                )}\n                onFocus={useCallback(\n                  (event: React.FocusEvent<HTMLDivElement>) => {\n                    if (\n                      !readOnly &&\n                      !state.isUpdatingSelection &&\n                      ReactEditor.hasEditableTarget(editor, event.target) &&\n                      !isEventHandled(event, attributes.onFocus)\n                    ) {\n                      const el = ReactEditor.toDOMNode(editor, editor)\n                      const root = ReactEditor.findDocumentOrShadowRoot(editor)\n                      state.latestElement = root.activeElement\n\n                      // COMPAT: If the editor has nested editable elements, the focus\n                      // can go to them. In Firefox, this must be prevented because it\n                      // results in issues with keyboard navigation. (2017/03/30)\n                      if (IS_FIREFOX && event.target !== el) {\n                        el.focus()\n                        return\n                      }\n\n                      IS_FOCUSED.set(editor, true)\n                    }\n                  },\n                  [readOnly, state, editor, attributes.onFocus]\n                )}\n                onKeyDown={useCallback(\n                  (event: React.KeyboardEvent<HTMLDivElement>) => {\n                    if (\n                      !readOnly &&\n                      ReactEditor.hasEditableTarget(editor, event.target)\n                    ) {\n                      androidInputManagerRef.current?.handleKeyDown(event)\n\n                      const { nativeEvent } = event\n\n                      // COMPAT: The composition end event isn't fired reliably in all browsers,\n                      // so we sometimes might end up stuck in a composition state even though we\n                      // aren't composing any more.\n                      if (\n                        ReactEditor.isComposing(editor) &&\n                        nativeEvent.isComposing === false\n                      ) {\n                        IS_COMPOSING.set(editor, false)\n                        setIsComposing(false)\n                      }\n\n                      if (\n                        isEventHandled(event, attributes.onKeyDown) ||\n                        ReactEditor.isComposing(editor)\n                      ) {\n                        return\n                      }\n\n                      const { selection } = editor\n                      const element =\n                        editor.children[\n                          selection !== null ? selection.focus.path[0] : 0\n                        ]\n                      const isRTL = getDirection(Node.string(element)) === 'rtl'\n\n                      // COMPAT: Since we prevent the default behavior on\n                      // `beforeinput` events, the browser doesn't think there's ever\n                      // any history stack to undo or redo, so we have to manage these\n                      // hotkeys ourselves. (2019/11/06)\n                      if (Hotkeys.isRedo(nativeEvent)) {\n                        event.preventDefault()\n                        const maybeHistoryEditor: any = editor\n\n                        if (typeof maybeHistoryEditor.redo === 'function') {\n                          maybeHistoryEditor.redo()\n                        }\n\n                        return\n                      }\n\n                      if (Hotkeys.isUndo(nativeEvent)) {\n                        event.preventDefault()\n                        const maybeHistoryEditor: any = editor\n\n                        if (typeof maybeHistoryEditor.undo === 'function') {\n                          maybeHistoryEditor.undo()\n                        }\n\n                        return\n                      }\n\n                      // COMPAT: Certain browsers don't handle the selection updates\n                      // properly. In Chrome, the selection isn't properly extended.\n                      // And in Firefox, the selection isn't properly collapsed.\n                      // (2017/10/17)\n                      if (Hotkeys.isMoveLineBackward(nativeEvent)) {\n                        event.preventDefault()\n                        Transforms.move(editor, { unit: 'line', reverse: true })\n                        return\n                      }\n\n                      if (Hotkeys.isMoveLineForward(nativeEvent)) {\n                        event.preventDefault()\n                        Transforms.move(editor, { unit: 'line' })\n                        return\n                      }\n\n                      if (Hotkeys.isExtendLineBackward(nativeEvent)) {\n                        event.preventDefault()\n                        Transforms.move(editor, {\n                          unit: 'line',\n                          edge: 'focus',\n                          reverse: true,\n                        })\n                        return\n                      }\n\n                      if (Hotkeys.isExtendLineForward(nativeEvent)) {\n                        event.preventDefault()\n                        Transforms.move(editor, { unit: 'line', edge: 'focus' })\n                        return\n                      }\n\n                      // COMPAT: If a void node is selected, or a zero-width text node\n                      // adjacent to an inline is selected, we need to handle these\n                      // hotkeys manually because browsers won't be able to skip over\n                      // the void node with the zero-width space not being an empty\n                      // string.\n                      if (Hotkeys.isMoveBackward(nativeEvent)) {\n                        event.preventDefault()\n\n                        if (selection && Range.isCollapsed(selection)) {\n                          Transforms.move(editor, { reverse: !isRTL })\n                        } else {\n                          Transforms.collapse(editor, {\n                            edge: isRTL ? 'end' : 'start',\n                          })\n                        }\n\n                        return\n                      }\n\n                      if (Hotkeys.isMoveForward(nativeEvent)) {\n                        event.preventDefault()\n\n                        if (selection && Range.isCollapsed(selection)) {\n                          Transforms.move(editor, { reverse: isRTL })\n                        } else {\n                          Transforms.collapse(editor, {\n                            edge: isRTL ? 'start' : 'end',\n                          })\n                        }\n\n                        return\n                      }\n\n                      if (Hotkeys.isMoveWordBackward(nativeEvent)) {\n                        event.preventDefault()\n\n                        if (selection && Range.isExpanded(selection)) {\n                          Transforms.collapse(editor, { edge: 'focus' })\n                        }\n\n                        Transforms.move(editor, {\n                          unit: 'word',\n                          reverse: !isRTL,\n                        })\n                        return\n                      }\n\n                      if (Hotkeys.isMoveWordForward(nativeEvent)) {\n                        event.preventDefault()\n\n                        if (selection && Range.isExpanded(selection)) {\n                          Transforms.collapse(editor, { edge: 'focus' })\n                        }\n\n                        Transforms.move(editor, {\n                          unit: 'word',\n                          reverse: isRTL,\n                        })\n                        return\n                      }\n\n                      // COMPAT: Certain browsers don't support the `beforeinput` event, so we\n                      // fall back to guessing at the input intention for hotkeys.\n                      // COMPAT: In iOS, some of these hotkeys are handled in the\n                      if (!HAS_BEFORE_INPUT_SUPPORT) {\n                        // We don't have a core behavior for these, but they change the\n                        // DOM if we don't prevent them, so we have to.\n                        if (\n                          Hotkeys.isBold(nativeEvent) ||\n                          Hotkeys.isItalic(nativeEvent) ||\n                          Hotkeys.isTransposeCharacter(nativeEvent)\n                        ) {\n                          event.preventDefault()\n                          return\n                        }\n\n                        if (Hotkeys.isSoftBreak(nativeEvent)) {\n                          event.preventDefault()\n                          Editor.insertSoftBreak(editor)\n                          return\n                        }\n\n                        if (Hotkeys.isSplitBlock(nativeEvent)) {\n                          event.preventDefault()\n                          Editor.insertBreak(editor)\n                          return\n                        }\n\n                        if (Hotkeys.isDeleteBackward(nativeEvent)) {\n                          event.preventDefault()\n\n                          if (selection && Range.isExpanded(selection)) {\n                            Editor.deleteFragment(editor, {\n                              direction: 'backward',\n                            })\n                          } else {\n                            Editor.deleteBackward(editor)\n                          }\n\n                          return\n                        }\n\n                        if (Hotkeys.isDeleteForward(nativeEvent)) {\n                          event.preventDefault()\n\n                          if (selection && Range.isExpanded(selection)) {\n                            Editor.deleteFragment(editor, {\n                              direction: 'forward',\n                            })\n                          } else {\n                            Editor.deleteForward(editor)\n                          }\n\n                          return\n                        }\n\n                        if (Hotkeys.isDeleteLineBackward(nativeEvent)) {\n                          event.preventDefault()\n\n                          if (selection && Range.isExpanded(selection)) {\n                            Editor.deleteFragment(editor, {\n                              direction: 'backward',\n                            })\n                          } else {\n                            Editor.deleteBackward(editor, { unit: 'line' })\n                          }\n\n                          return\n                        }\n\n                        if (Hotkeys.isDeleteLineForward(nativeEvent)) {\n                          event.preventDefault()\n\n                          if (selection && Range.isExpanded(selection)) {\n                            Editor.deleteFragment(editor, {\n                              direction: 'forward',\n                            })\n                          } else {\n                            Editor.deleteForward(editor, { unit: 'line' })\n                          }\n\n                          return\n                        }\n\n                        if (Hotkeys.isDeleteWordBackward(nativeEvent)) {\n                          event.preventDefault()\n\n                          if (selection && Range.isExpanded(selection)) {\n                            Editor.deleteFragment(editor, {\n                              direction: 'backward',\n                            })\n                          } else {\n                            Editor.deleteBackward(editor, { unit: 'word' })\n                          }\n\n                          return\n                        }\n\n                        if (Hotkeys.isDeleteWordForward(nativeEvent)) {\n                          event.preventDefault()\n\n                          if (selection && Range.isExpanded(selection)) {\n                            Editor.deleteFragment(editor, {\n                              direction: 'forward',\n                            })\n                          } else {\n                            Editor.deleteForward(editor, { unit: 'word' })\n                          }\n\n                          return\n                        }\n                      } else {\n                        if (IS_CHROME || IS_WEBKIT) {\n                          // COMPAT: Chrome and Safari support `beforeinput` event but do not fire\n                          // an event when deleting backwards in a selected void inline node\n                          if (\n                            selection &&\n                            (Hotkeys.isDeleteBackward(nativeEvent) ||\n                              Hotkeys.isDeleteForward(nativeEvent)) &&\n                            Range.isCollapsed(selection)\n                          ) {\n                            const currentNode = Node.parent(\n                              editor,\n                              selection.anchor.path\n                            )\n\n                            if (\n                              Element.isElement(currentNode) &&\n                              Editor.isVoid(editor, currentNode) &&\n                              (Editor.isInline(editor, currentNode) ||\n                                Editor.isBlock(editor, currentNode))\n                            ) {\n                              event.preventDefault()\n                              Editor.deleteBackward(editor, { unit: 'block' })\n\n                              return\n                            }\n                          }\n                        }\n                      }\n                    }\n                  },\n                  [readOnly, editor, attributes.onKeyDown]\n                )}\n                onPaste={useCallback(\n                  (event: React.ClipboardEvent<HTMLDivElement>) => {\n                    if (\n                      !readOnly &&\n                      ReactEditor.hasEditableTarget(editor, event.target) &&\n                      !isEventHandled(event, attributes.onPaste)\n                    ) {\n                      // COMPAT: Certain browsers don't support the `beforeinput` event, so we\n                      // fall back to React's `onPaste` here instead.\n                      // COMPAT: Firefox, Chrome and Safari don't emit `beforeinput` events\n                      // when \"paste without formatting\" is used, so fallback. (2020/02/20)\n                      // COMPAT: Safari InputEvents generated by pasting won't include\n                      // application/x-slate-fragment items, so use the\n                      // ClipboardEvent here. (2023/03/15)\n                      if (\n                        !HAS_BEFORE_INPUT_SUPPORT ||\n                        isPlainTextOnlyPaste(event.nativeEvent) ||\n                        IS_WEBKIT\n                      ) {\n                        event.preventDefault()\n                        ReactEditor.insertData(editor, event.clipboardData)\n                      }\n                    }\n                  },\n                  [readOnly, editor, attributes.onPaste]\n                )}\n              >\n                <Children\n                  decorations={decorations}\n                  node={editor}\n                  renderElement={renderElement}\n                  renderPlaceholder={renderPlaceholder}\n                  renderLeaf={renderLeaf}\n                  selection={editor.selection}\n                />\n              </Component>\n            </RestoreDOM>\n          </DecorateContext.Provider>\n        </ComposingContext.Provider>\n      </ReadOnlyContext.Provider>\n    )\n  }\n)\n\n/**\n * The props that get passed to renderPlaceholder\n */\nexport type RenderPlaceholderProps = {\n  children: any\n  attributes: {\n    'data-slate-placeholder': boolean\n    dir?: 'rtl'\n    contentEditable: boolean\n    ref: React.RefCallback<any>\n    style: React.CSSProperties\n  }\n}\n\n/**\n * The default placeholder element\n */\n\nexport const DefaultPlaceholder = ({\n  attributes,\n  children,\n}: RenderPlaceholderProps) => (\n  // COMPAT: Artificially add a line-break to the end on the placeholder element\n  // to prevent Android IMEs to pick up its content in autocorrect and to auto-capitalize the first letter\n  <span {...attributes}>\n    {children}\n    {IS_ANDROID && <br />}\n  </span>\n)\n\n/**\n * A default memoized decorate function.\n */\n\nexport const defaultDecorate: (entry: NodeEntry) => Range[] = () => []\n\n/**\n * A default implement to scroll dom range into view.\n */\n\nconst defaultScrollSelectionIntoView = (\n  editor: ReactEditor,\n  domRange: DOMRange\n) => {\n  // This was affecting the selection of multiple blocks and dragging behavior,\n  // so enabled only if the selection has been collapsed.\n  if (\n    domRange.getBoundingClientRect &&\n    (!editor.selection ||\n      (editor.selection && Range.isCollapsed(editor.selection)))\n  ) {\n    const leafEl = domRange.startContainer.parentElement!\n    leafEl.getBoundingClientRect = domRange.getBoundingClientRect.bind(domRange)\n    scrollIntoView(leafEl, {\n      scrollMode: 'if-needed',\n    })\n\n    // @ts-expect-error an unorthodox delete D:\n    delete leafEl.getBoundingClientRect\n  }\n}\n\n/**\n * Check if an event is overrided by a handler.\n */\n\nexport const isEventHandled = <\n  EventType extends React.SyntheticEvent<unknown, unknown>,\n>(\n  event: EventType,\n  handler?: (event: EventType) => void | boolean\n) => {\n  if (!handler) {\n    return false\n  }\n  // The custom event handler may return a boolean to specify whether the event\n  // shall be treated as being handled or not.\n  const shouldTreatEventAsHandled = handler(event)\n\n  if (shouldTreatEventAsHandled != null) {\n    return shouldTreatEventAsHandled\n  }\n\n  return event.isDefaultPrevented() || event.isPropagationStopped()\n}\n\n/**\n * Check if the event's target is an input element\n */\nexport const isDOMEventTargetInput = <\n  EventType extends React.SyntheticEvent<unknown, unknown>,\n>(\n  event: EventType\n) => {\n  return (\n    isDOMNode(event.target) &&\n    (event.target instanceof HTMLInputElement ||\n      event.target instanceof HTMLTextAreaElement)\n  )\n}\n\n/**\n * Check if a DOM event is overrided by a handler.\n */\n\nexport const isDOMEventHandled = <E extends Event>(\n  event: E,\n  handler?: (event: E) => void | boolean\n) => {\n  if (!handler) {\n    return false\n  }\n\n  // The custom event handler may return a boolean to specify whether the event\n  // shall be treated as being handled or not.\n  const shouldTreatEventAsHandled = handler(event)\n\n  if (shouldTreatEventAsHandled != null) {\n    return shouldTreatEventAsHandled\n  }\n\n  return event.defaultPrevented\n}\n", "import { createContext, useContext } from 'react'\n\n/**\n * A React context for sharing the `focused` state of the editor.\n */\n\nexport const FocusedContext = createContext(false)\n\n/**\n * Get the current `focused` state of the editor.\n */\n\nexport const useFocused = (): boolean => {\n  return useContext(FocusedContext)\n}\n", "import {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useReducer,\n  useRef,\n} from 'react'\nimport { Editor } from 'slate'\nimport { useIsomorphicLayoutEffect } from './use-isomorphic-layout-effect'\n\nfunction isError(error: any): error is Error {\n  return error instanceof Error\n}\n\ntype EditorChangeHandler = (editor: Editor) => void\n/**\n * A React context for sharing the editor selector context in a way to control rerenders\n */\n\nexport const SlateSelectorContext = createContext<{\n  getSlate: () => Editor\n  addEventListener: (callback: EditorChangeHandler) => () => void\n}>({} as any)\n\nconst refEquality = (a: any, b: any) => a === b\n\n/**\n * use redux style selectors to prevent rerendering on every keystroke.\n * Bear in mind rerendering can only prevented if the returned value is a value type or for reference types (e.g. objects and arrays) add a custom equality function.\n *\n * Example:\n * ```\n *  const isSelectionActive = useSlateSelector(editor => Boolean(editor.selection));\n * ```\n */\nexport function useSlateSelector<T>(\n  selector: (editor: Editor) => T,\n  equalityFn: (a: T, b: T) => boolean = refEquality\n) {\n  const [, forceRender] = useReducer(s => s + 1, 0)\n  const context = useContext(SlateSelectorContext)\n  if (!context) {\n    throw new Error(\n      `The \\`useSlateSelector\\` hook must be used inside the <Slate> component's context.`\n    )\n  }\n  const { getSlate, addEventListener } = context\n\n  const latestSubscriptionCallbackError = useRef<Error | undefined>()\n  const latestSelector = useRef<(editor: Editor) => T>(() => null as any)\n  const latestSelectedState = useRef<T>(null as any as T)\n  let selectedState: T\n\n  try {\n    if (\n      selector !== latestSelector.current ||\n      latestSubscriptionCallbackError.current\n    ) {\n      selectedState = selector(getSlate())\n    } else {\n      selectedState = latestSelectedState.current\n    }\n  } catch (err) {\n    if (latestSubscriptionCallbackError.current && isError(err)) {\n      err.message += `\\nThe error may be correlated with this previous error:\\n${latestSubscriptionCallbackError.current.stack}\\n\\n`\n    }\n\n    throw err\n  }\n  useIsomorphicLayoutEffect(() => {\n    latestSelector.current = selector\n    latestSelectedState.current = selectedState\n    latestSubscriptionCallbackError.current = undefined\n  })\n\n  useIsomorphicLayoutEffect(\n    () => {\n      function checkForUpdates() {\n        try {\n          const newSelectedState = latestSelector.current(getSlate())\n\n          if (equalityFn(newSelectedState, latestSelectedState.current)) {\n            return\n          }\n\n          latestSelectedState.current = newSelectedState\n        } catch (err) {\n          // we ignore all errors here, since when the component\n          // is re-rendered, the selectors are called again, and\n          // will throw again, if neither props nor store state\n          // changed\n          if (err instanceof Error) {\n            latestSubscriptionCallbackError.current = err\n          } else {\n            latestSubscriptionCallbackError.current = new Error(String(err))\n          }\n        }\n\n        forceRender()\n      }\n\n      const unsubscribe = addEventListener(checkForUpdates)\n\n      checkForUpdates()\n\n      return () => unsubscribe()\n    },\n    // don't rerender on equalityFn change since we want to be able to define it inline\n    [addEventListener, getSlate]\n  )\n\n  return selectedState\n}\n\n/**\n * Create selector context with editor updating on every editor change\n */\nexport function useSelectorContext(editor: Editor) {\n  const eventListeners = useRef<EditorChangeHandler[]>([]).current\n  const slateRef = useRef<{\n    editor: Editor\n  }>({\n    editor,\n  }).current\n  const onChange = useCallback(\n    (editor: Editor) => {\n      slateRef.editor = editor\n      eventListeners.forEach((listener: EditorChangeHandler) =>\n        listener(editor)\n      )\n    },\n    [eventListeners, slateRef]\n  )\n\n  const selectorContext = useMemo(() => {\n    return {\n      getSlate: () => slateRef.editor,\n      addEventListener: (callback: EditorChangeHandler) => {\n        eventListeners.push(callback)\n        return () => {\n          eventListeners.splice(eventListeners.indexOf(callback), 1)\n        }\n      },\n    }\n  }, [eventListeners, slateRef])\n  return { selectorContext, onChange }\n}\n", "import React, { useCallback, useEffect, useState } from 'react'\nimport { Descendant, Editor, Node, Operation, Scrubber, Selection } from 'slate'\nimport { FocusedContext } from '../hooks/use-focused'\nimport { useIsomorphicLayoutEffect } from '../hooks/use-isomorphic-layout-effect'\nimport { SlateContext, SlateContextValue } from '../hooks/use-slate'\nimport {\n  useSelectorContext,\n  SlateSelectorContext,\n} from '../hooks/use-slate-selector'\nimport { EditorContext } from '../hooks/use-slate-static'\nimport { ReactEditor } from '../plugin/react-editor'\nimport { REACT_MAJOR_VERSION } from '../utils/environment'\nimport { EDITOR_TO_ON_CHANGE } from '../utils/weak-maps'\n\n/**\n * A wrapper around the provider to handle `onChange` events, because the editor\n * is a mutable singleton so it won't ever register as \"changed\" otherwise.\n */\n\nexport const Slate = (props: {\n  editor: ReactEditor\n  initialValue: Descendant[]\n  children: React.ReactNode\n  onChange?: (value: Descendant[]) => void\n  onSelectionChange?: (selection: Selection) => void\n  onValueChange?: (value: Descendant[]) => void\n}) => {\n  const {\n    editor,\n    children,\n    onChange,\n    onSelectionChange,\n    onValueChange,\n    initialValue,\n    ...rest\n  } = props\n\n  const [context, setContext] = React.useState<SlateContextValue>(() => {\n    if (!Node.isNodeList(initialValue)) {\n      throw new Error(\n        `[Slate] initialValue is invalid! Expected a list of elements but got: ${Scrubber.stringify(\n          initialValue\n        )}`\n      )\n    }\n    if (!Editor.isEditor(editor)) {\n      throw new Error(\n        `[Slate] editor is invalid! You passed: ${Scrubber.stringify(editor)}`\n      )\n    }\n    editor.children = initialValue\n    Object.assign(editor, rest)\n    return { v: 0, editor }\n  })\n\n  const { selectorContext, onChange: handleSelectorChange } =\n    useSelectorContext(editor)\n\n  const onContextChange = useCallback(\n    (options?: { operation?: Operation }) => {\n      if (onChange) {\n        onChange(editor.children)\n      }\n\n      switch (options?.operation?.type) {\n        case 'set_selection':\n          onSelectionChange?.(editor.selection)\n          break\n        default:\n          onValueChange?.(editor.children)\n      }\n\n      setContext(prevContext => ({\n        v: prevContext.v + 1,\n        editor,\n      }))\n      handleSelectorChange(editor)\n    },\n    [editor, handleSelectorChange, onChange, onSelectionChange, onValueChange]\n  )\n\n  useEffect(() => {\n    EDITOR_TO_ON_CHANGE.set(editor, onContextChange)\n\n    return () => {\n      EDITOR_TO_ON_CHANGE.set(editor, () => {})\n    }\n  }, [editor, onContextChange])\n\n  const [isFocused, setIsFocused] = useState(ReactEditor.isFocused(editor))\n\n  useEffect(() => {\n    setIsFocused(ReactEditor.isFocused(editor))\n  }, [editor])\n\n  useIsomorphicLayoutEffect(() => {\n    const fn = () => setIsFocused(ReactEditor.isFocused(editor))\n    if (REACT_MAJOR_VERSION >= 17) {\n      // In React >= 17 onFocus and onBlur listen to the focusin and focusout events during the bubbling phase.\n      // Therefore in order for <Editable />'s handlers to run first, which is necessary for ReactEditor.isFocused(editor)\n      // to return the correct value, we have to listen to the focusin and focusout events without useCapture here.\n      document.addEventListener('focusin', fn)\n      document.addEventListener('focusout', fn)\n      return () => {\n        document.removeEventListener('focusin', fn)\n        document.removeEventListener('focusout', fn)\n      }\n    } else {\n      document.addEventListener('focus', fn, true)\n      document.addEventListener('blur', fn, true)\n      return () => {\n        document.removeEventListener('focus', fn, true)\n        document.removeEventListener('blur', fn, true)\n      }\n    }\n  }, [])\n\n  return (\n    <SlateSelectorContext.Provider value={selectorContext}>\n      <SlateContext.Provider value={context}>\n        <EditorContext.Provider value={context.editor}>\n          <FocusedContext.Provider value={isFocused}>\n            {children}\n          </FocusedContext.Provider>\n        </EditorContext.Provider>\n      </SlateContext.Provider>\n    </SlateSelectorContext.Provider>\n  )\n}\n", "import { useContext } from 'react'\n\nimport { EditorContext } from './use-slate-static'\n\n/**\n * Get the current editor object from the React context.\n * @deprecated Use useSlateStatic instead.\n */\n\nexport const useEditor = () => {\n  const editor = useContext(EditorContext)\n\n  if (!editor) {\n    throw new Error(\n      `The \\`useEditor\\` hook must be used inside the <Slate> component's context.`\n    )\n  }\n\n  return editor\n}\n", "import { BaseSelection, Range } from 'slate'\n\nimport { useSlateSelector } from './use-slate-selector'\n\n/**\n * Get the current slate selection.\n * Only triggers a rerender when the selection actually changes\n */\nexport const useSlateSelection = () => {\n  return useSlateSelector(editor => editor.selection, isSelectionEqual)\n}\n\nconst isSelectionEqual = (a: BaseSelection, b: BaseSelection) => {\n  if (!a && !b) return true\n  if (!a || !b) return false\n  return Range.equals(a, b)\n}\n", "/**\n * Utilities for single-line deletion\n */\n\nimport { Editor, Range } from 'slate'\nimport { ReactEditor } from '../plugin/react-editor'\n\nconst doRectsIntersect = (rect: DOMRect, compareRect: DOMRect) => {\n  const middle = (compareRect.top + compareRect.bottom) / 2\n\n  return rect.top <= middle && rect.bottom >= middle\n}\n\nconst areRangesSameLine = (\n  editor: ReactEditor,\n  range1: Range,\n  range2: Range\n) => {\n  const rect1 = ReactEditor.toDOMRange(editor, range1).getBoundingClientRect()\n  const rect2 = ReactEditor.toDOMRange(editor, range2).getBoundingClientRect()\n\n  return doRectsIntersect(rect1, rect2) && doRectsIntersect(rect2, rect1)\n}\n\n/**\n * A helper utility that returns the end portion of a `Range`\n * which is located on a single line.\n *\n * @param {Editor} editor The editor object to compare against\n * @param {Range} parentRange The parent range to compare against\n * @returns {Range} A valid portion of the parentRange which is one a single line\n */\nexport const findCurrentLineRange = (\n  editor: ReactEditor,\n  parentRange: Range\n): Range => {\n  const parentRangeBoundary = Editor.range(editor, Range.end(parentRange))\n  const positions = Array.from(Editor.positions(editor, { at: parentRange }))\n\n  let left = 0\n  let right = positions.length\n  let middle = Math.floor(right / 2)\n\n  if (\n    areRangesSameLine(\n      editor,\n      Editor.range(editor, positions[left]),\n      parentRangeBoundary\n    )\n  ) {\n    return Editor.range(editor, positions[left], parentRangeBoundary)\n  }\n\n  if (positions.length < 2) {\n    return Editor.range(\n      editor,\n      positions[positions.length - 1],\n      parentRangeBoundary\n    )\n  }\n\n  while (middle !== positions.length && middle !== left) {\n    if (\n      areRangesSameLine(\n        editor,\n        Editor.range(editor, positions[middle]),\n        parentRangeBoundary\n      )\n    ) {\n      right = middle\n    } else {\n      left = middle\n    }\n\n    middle = Math.floor((left + right) / 2)\n  }\n\n  return Editor.range(editor, positions[right], parentRangeBoundary)\n}\n", "import ReactDOM from 'react-dom'\nimport {\n  BaseEditor,\n  Editor,\n  Element,\n  Node,\n  Operation,\n  Path,\n  PathRef,\n  Point,\n  Range,\n  Transforms,\n} from 'slate'\nimport {\n  TextDiff,\n  transformPendingPoint,\n  transformPendingRange,\n  transformTextDiff,\n} from '../utils/diff-text'\nimport {\n  getPlainText,\n  getSlateFragmentAttribute,\n  isDOMText,\n} from '../utils/dom'\nimport { Key } from '../utils/key'\nimport { findCurrentLineRange } from '../utils/lines'\nimport {\n  IS_NODE_MAP_DIRTY,\n  EDITOR_TO_KEY_TO_ELEMENT,\n  EDITOR_TO_ON_CHANGE,\n  EDITOR_TO_PENDING_ACTION,\n  EDITOR_TO_PENDING_DIFFS,\n  EDITOR_TO_PENDING_INSERTION_MARKS,\n  EDITOR_TO_PENDING_SELECTION,\n  EDITOR_TO_SCHEDULE_FLUSH,\n  EDITOR_TO_USER_MARKS,\n  EDITOR_TO_USER_SELECTION,\n  NODE_TO_KEY,\n} from '../utils/weak-maps'\nimport { ReactEditor } from './react-editor'\nimport { REACT_MAJOR_VERSION } from '../utils/environment'\n\n/**\n * `withReact` adds React and DOM specific behaviors to the editor.\n *\n * If you are using TypeScript, you must extend Slate's CustomTypes to use\n * this plugin.\n *\n * See https://docs.slatejs.org/concepts/11-typescript to learn how.\n */\n\nexport const withReact = <T extends BaseEditor>(\n  editor: T,\n  clipboardFormatKey = 'x-slate-fragment'\n): T & ReactEditor => {\n  const e = editor as T & ReactEditor\n  const { apply, onChange, deleteBackward, addMark, removeMark } = e\n\n  // The WeakMap which maps a key to a specific HTMLElement must be scoped to the editor instance to\n  // avoid collisions between editors in the DOM that share the same value.\n  EDITOR_TO_KEY_TO_ELEMENT.set(e, new WeakMap())\n\n  e.addMark = (key, value) => {\n    EDITOR_TO_SCHEDULE_FLUSH.get(e)?.()\n\n    if (\n      !EDITOR_TO_PENDING_INSERTION_MARKS.get(e) &&\n      EDITOR_TO_PENDING_DIFFS.get(e)?.length\n    ) {\n      // Ensure the current pending diffs originating from changes before the addMark\n      // are applied with the current formatting\n      EDITOR_TO_PENDING_INSERTION_MARKS.set(e, null)\n    }\n\n    EDITOR_TO_USER_MARKS.delete(e)\n\n    addMark(key, value)\n  }\n\n  e.removeMark = key => {\n    if (\n      !EDITOR_TO_PENDING_INSERTION_MARKS.get(e) &&\n      EDITOR_TO_PENDING_DIFFS.get(e)?.length\n    ) {\n      // Ensure the current pending diffs originating from changes before the addMark\n      // are applied with the current formatting\n      EDITOR_TO_PENDING_INSERTION_MARKS.set(e, null)\n    }\n\n    EDITOR_TO_USER_MARKS.delete(e)\n\n    removeMark(key)\n  }\n\n  e.deleteBackward = unit => {\n    if (unit !== 'line') {\n      return deleteBackward(unit)\n    }\n\n    if (e.selection && Range.isCollapsed(e.selection)) {\n      const parentBlockEntry = Editor.above(e, {\n        match: n => Element.isElement(n) && Editor.isBlock(e, n),\n        at: e.selection,\n      })\n\n      if (parentBlockEntry) {\n        const [, parentBlockPath] = parentBlockEntry\n        const parentElementRange = Editor.range(\n          e,\n          parentBlockPath,\n          e.selection.anchor\n        )\n\n        const currentLineRange = findCurrentLineRange(e, parentElementRange)\n\n        if (!Range.isCollapsed(currentLineRange)) {\n          Transforms.delete(e, { at: currentLineRange })\n        }\n      }\n    }\n  }\n\n  // This attempts to reset the NODE_TO_KEY entry to the correct value\n  // as apply() changes the object reference and hence invalidates the NODE_TO_KEY entry\n  e.apply = (op: Operation) => {\n    const matches: [Path, Key][] = []\n    const pathRefMatches: [PathRef, Key][] = []\n\n    const pendingDiffs = EDITOR_TO_PENDING_DIFFS.get(e)\n    if (pendingDiffs?.length) {\n      const transformed = pendingDiffs\n        .map(textDiff => transformTextDiff(textDiff, op))\n        .filter(Boolean) as TextDiff[]\n\n      EDITOR_TO_PENDING_DIFFS.set(e, transformed)\n    }\n\n    const pendingSelection = EDITOR_TO_PENDING_SELECTION.get(e)\n    if (pendingSelection) {\n      EDITOR_TO_PENDING_SELECTION.set(\n        e,\n        transformPendingRange(e, pendingSelection, op)\n      )\n    }\n\n    const pendingAction = EDITOR_TO_PENDING_ACTION.get(e)\n    if (pendingAction?.at) {\n      const at = Point.isPoint(pendingAction?.at)\n        ? transformPendingPoint(e, pendingAction.at, op)\n        : transformPendingRange(e, pendingAction.at, op)\n\n      EDITOR_TO_PENDING_ACTION.set(e, at ? { ...pendingAction, at } : null)\n    }\n\n    switch (op.type) {\n      case 'insert_text':\n      case 'remove_text':\n      case 'set_node':\n      case 'split_node': {\n        matches.push(...getMatches(e, op.path))\n        break\n      }\n\n      case 'set_selection': {\n        // Selection was manually set, don't restore the user selection after the change.\n        EDITOR_TO_USER_SELECTION.get(e)?.unref()\n        EDITOR_TO_USER_SELECTION.delete(e)\n        break\n      }\n\n      case 'insert_node':\n      case 'remove_node': {\n        matches.push(...getMatches(e, Path.parent(op.path)))\n        break\n      }\n\n      case 'merge_node': {\n        const prevPath = Path.previous(op.path)\n        matches.push(...getMatches(e, prevPath))\n        break\n      }\n\n      case 'move_node': {\n        const commonPath = Path.common(\n          Path.parent(op.path),\n          Path.parent(op.newPath)\n        )\n        matches.push(...getMatches(e, commonPath))\n\n        let changedPath: Path\n        if (Path.isBefore(op.path, op.newPath)) {\n          matches.push(...getMatches(e, Path.parent(op.path)))\n          changedPath = op.newPath\n        } else {\n          matches.push(...getMatches(e, Path.parent(op.newPath)))\n          changedPath = op.path\n        }\n\n        const changedNode = Node.get(editor, Path.parent(changedPath))\n        const changedNodeKey = ReactEditor.findKey(e, changedNode)\n        const changedPathRef = Editor.pathRef(e, Path.parent(changedPath))\n        pathRefMatches.push([changedPathRef, changedNodeKey])\n\n        break\n      }\n    }\n\n    apply(op)\n\n    switch (op.type) {\n      case 'insert_node':\n      case 'remove_node':\n      case 'merge_node':\n      case 'move_node':\n      case 'split_node': {\n        IS_NODE_MAP_DIRTY.set(e, true)\n      }\n    }\n\n    for (const [path, key] of matches) {\n      const [node] = Editor.node(e, path)\n      NODE_TO_KEY.set(node, key)\n    }\n\n    for (const [pathRef, key] of pathRefMatches) {\n      if (pathRef.current) {\n        const [node] = Editor.node(e, pathRef.current)\n        NODE_TO_KEY.set(node, key)\n      }\n\n      pathRef.unref()\n    }\n  }\n\n  e.setFragmentData = (data: Pick<DataTransfer, 'getData' | 'setData'>) => {\n    const { selection } = e\n\n    if (!selection) {\n      return\n    }\n\n    const [start, end] = Range.edges(selection)\n    const startVoid = Editor.void(e, { at: start.path })\n    const endVoid = Editor.void(e, { at: end.path })\n\n    if (Range.isCollapsed(selection) && !startVoid) {\n      return\n    }\n\n    // Create a fake selection so that we can add a Base64-encoded copy of the\n    // fragment to the HTML, to decode on future pastes.\n    const domRange = ReactEditor.toDOMRange(e, selection)\n    let contents = domRange.cloneContents()\n    let attach = contents.childNodes[0] as HTMLElement\n\n    // Make sure attach is non-empty, since empty nodes will not get copied.\n    contents.childNodes.forEach(node => {\n      if (node.textContent && node.textContent.trim() !== '') {\n        attach = node as HTMLElement\n      }\n    })\n\n    // COMPAT: If the end node is a void node, we need to move the end of the\n    // range from the void node's spacer span, to the end of the void node's\n    // content, since the spacer is before void's content in the DOM.\n    if (endVoid) {\n      const [voidNode] = endVoid\n      const r = domRange.cloneRange()\n      const domNode = ReactEditor.toDOMNode(e, voidNode)\n      r.setEndAfter(domNode)\n      contents = r.cloneContents()\n    }\n\n    // COMPAT: If the start node is a void node, we need to attach the encoded\n    // fragment to the void node's content node instead of the spacer, because\n    // attaching it to empty `<div>/<span>` nodes will end up having it erased by\n    // most browsers. (2018/04/27)\n    if (startVoid) {\n      attach = contents.querySelector('[data-slate-spacer]')! as HTMLElement\n    }\n\n    // Remove any zero-width space spans from the cloned DOM so that they don't\n    // show up elsewhere when pasted.\n    Array.from(contents.querySelectorAll('[data-slate-zero-width]')).forEach(\n      zw => {\n        const isNewline = zw.getAttribute('data-slate-zero-width') === 'n'\n        zw.textContent = isNewline ? '\\n' : ''\n      }\n    )\n\n    // Set a `data-slate-fragment` attribute on a non-empty node, so it shows up\n    // in the HTML, and can be used for intra-Slate pasting. If it's a text\n    // node, wrap it in a `<span>` so we have something to set an attribute on.\n    if (isDOMText(attach)) {\n      const span = attach.ownerDocument.createElement('span')\n      // COMPAT: In Chrome and Safari, if we don't add the `white-space` style\n      // then leading and trailing spaces will be ignored. (2017/09/21)\n      span.style.whiteSpace = 'pre'\n      span.appendChild(attach)\n      contents.appendChild(span)\n      attach = span\n    }\n\n    const fragment = e.getFragment()\n    const string = JSON.stringify(fragment)\n    const encoded = window.btoa(encodeURIComponent(string))\n    attach.setAttribute('data-slate-fragment', encoded)\n    data.setData(`application/${clipboardFormatKey}`, encoded)\n\n    // Add the content to a <div> so that we can get its inner HTML.\n    const div = contents.ownerDocument.createElement('div')\n    div.appendChild(contents)\n    div.setAttribute('hidden', 'true')\n    contents.ownerDocument.body.appendChild(div)\n    data.setData('text/html', div.innerHTML)\n    data.setData('text/plain', getPlainText(div))\n    contents.ownerDocument.body.removeChild(div)\n    return data\n  }\n\n  e.insertData = (data: DataTransfer) => {\n    if (!e.insertFragmentData(data)) {\n      e.insertTextData(data)\n    }\n  }\n\n  e.insertFragmentData = (data: DataTransfer): boolean => {\n    /**\n     * Checking copied fragment from application/x-slate-fragment or data-slate-fragment\n     */\n    const fragment =\n      data.getData(`application/${clipboardFormatKey}`) ||\n      getSlateFragmentAttribute(data)\n\n    if (fragment) {\n      const decoded = decodeURIComponent(window.atob(fragment))\n      const parsed = JSON.parse(decoded) as Node[]\n      e.insertFragment(parsed)\n      return true\n    }\n    return false\n  }\n\n  e.insertTextData = (data: DataTransfer): boolean => {\n    const text = data.getData('text/plain')\n\n    if (text) {\n      const lines = text.split(/\\r\\n|\\r|\\n/)\n      let split = false\n\n      for (const line of lines) {\n        if (split) {\n          Transforms.splitNodes(e, { always: true })\n        }\n\n        e.insertText(line)\n        split = true\n      }\n      return true\n    }\n    return false\n  }\n\n  e.onChange = options => {\n    // COMPAT: React < 18 doesn't batch `setState` hook calls, which means\n    // that the children and selection can get out of sync for one render\n    // pass. So we have to use this unstable API to ensure it batches them.\n    // (2019/12/03)\n    // https://github.com/facebook/react/issues/14259#issuecomment-439702367\n    const maybeBatchUpdates =\n      REACT_MAJOR_VERSION < 18\n        ? ReactDOM.unstable_batchedUpdates\n        : (callback: () => void) => callback()\n\n    maybeBatchUpdates(() => {\n      const onContextChange = EDITOR_TO_ON_CHANGE.get(e)\n\n      if (onContextChange) {\n        onContextChange(options)\n      }\n\n      onChange(options)\n    })\n  }\n\n  return e\n}\n\nconst getMatches = (e: Editor, path: Path) => {\n  const matches: [Path, Key][] = []\n  for (const [n, p] of Editor.levels(e, { at: path })) {\n    const key = ReactEditor.findKey(e, n)\n    matches.push([p, key])\n  }\n  return matches\n}\n", "/**\n * Ponyfill for `HTMLFormElement.requestSubmit`.\n */\nexport function requestSubmit(\n  form: HTMLFormElement,\n  submitter?: HTMLElement | null\n) {\n  if (typeof form.requestSubmit === \"function\") {\n    return form.requestSubmit(submitter);\n  }\n\n  if (submitter) {\n    submitter.click();\n  } else {\n    submitter = document.createElement(\"input\");\n    (submitter as HTMLInputElement).type = \"submit\";\n    submitter.hidden = true;\n\n    form.appendChild(submitter);\n\n    submitter.click();\n\n    form.removeChild(submitter);\n  }\n}\n", "import type { Editor as SlateEditor } from \"slate\";\nimport {\n  Element as SlateElement,\n  Node as SlateNode,\n  Transforms as SlateTransforms,\n} from \"slate\";\n\nexport function withNormalize(editor: SlateEditor) {\n  const { normalizeNode } = editor;\n\n  editor.normalizeNode = (entry) => {\n    const [node, path] = entry;\n\n    // Paragraphs should only contain inline elements\n    if (SlateElement.isElement(node) && node.type === \"paragraph\") {\n      for (const [child, childPath] of SlateNode.children(editor, path)) {\n        if (SlateElement.isElement(child) && !editor.isInline(child)) {\n          SlateTransforms.unwrapNodes(editor, { at: childPath });\n          return;\n        }\n      }\n    }\n\n    normalizeNode(entry);\n  };\n\n  return editor;\n}\n", "export function isEmptyString(string: string) {\n  return !string.trim();\n}\n", "import type { Node as SlateNode, Text as SlateText } from \"slate\";\n\nexport function isText(element: SlateNode): element is SlateText {\n  return (\n    !(\"type\" in element) &&\n    \"text\" in element &&\n    typeof element.text === \"string\"\n  );\n}\n\nexport function isPlainText(node: SlateNode): boolean {\n  return isText(node) && Object.keys(node).length === 1;\n}\n", "import type { Descendant as SlateDescendant } from \"slate\";\nimport { Editor as SlateEditor } from \"slate\";\n\nimport { isEmptyString } from \"./is-empty-string\";\nimport { isText } from \"./is-text\";\n\nexport function isEmpty(editor: SlateEditor, children: SlateDescendant[]) {\n  // Check if all blocks are empty, stopping at the first non-empty block\n  for (const child of children) {\n    if (isText(child)) {\n      // Non-empty text\n      if (!isEmptyString(child.text)) {\n        return false;\n      }\n    } else if (child.type === \"paragraph\") {\n      // Non-empty paragraph\n      if (\n        child.children.length > 1 ||\n        (child.children[0] &&\n          !(isText(child.children[0]) && isEmptyString(child.children[0].text)))\n      ) {\n        return false;\n      }\n    } else {\n      // Non-empty other block\n      if (!SlateEditor.isEmpty(editor, child)) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n", "import { type MessageId, nn } from \"@liveblocks/core\";\nimport {\n  createContext,\n  type Dispatch,\n  type SetStateAction,\n  useContext,\n} from \"react\";\nimport type {\n  Descendant as SlateDescendant,\n  Editor as SlateEditor,\n} from \"slate\";\n\nexport type AiComposerContext = {\n  /**\n   * Whether the composer is currently disabled.\n   */\n  isDisabled: boolean;\n\n  /**\n   * Whether the composer can currently be submitted.\n   */\n  canSubmit: boolean;\n\n  /**\n   * Whether the composer can currently abort a response in its related chat.\n   */\n  canAbort: boolean;\n\n  /**\n   * Whether the editor is currently focused.\n   */\n  isFocused: boolean;\n\n  /**\n   * Whether the editor is currently empty.\n   */\n  isEmpty: boolean;\n\n  /**\n   * Submit the composer programmatically.\n   */\n  submit: () => void;\n\n  /**\n   * Abort the composer's related response programmatically.\n   */\n  abort: () => void;\n\n  /**\n   * Clear the composer programmatically.\n   */\n  clear: () => void;\n\n  /**\n   * Select the editor programmatically.\n   */\n  select: () => void;\n\n  /**\n   * Focus the editor programmatically.\n   */\n  focus: () => void;\n\n  /**\n   * Blur the editor programmatically.\n   */\n  blur: () => void;\n};\n\nexport type AiComposerEditorContext = {\n  onEditorValueChange: (value: SlateDescendant[]) => void;\n  editor: SlateEditor;\n  abortableMessageId: MessageId | undefined;\n  setFocused: Dispatch<SetStateAction<boolean>>;\n};\n\nexport const AiComposerContext = createContext<AiComposerContext | null>(null);\nexport const AiComposerEditorContext =\n  createContext<AiComposerEditorContext | null>(null);\n\nexport function useAiComposerEditorContext() {\n  const composerEditorContext = useContext(AiComposerEditorContext);\n\n  return nn(\n    composerEditorContext,\n    \"AiComposer.Form is missing from the React tree.\"\n  );\n}\n\nexport function useAiComposer(): AiComposerContext {\n  const composerContext = useContext(AiComposerContext);\n\n  return nn(composerContext, \"AiComposer.Form is missing from the React tree.\");\n}\n", "import {\n  type AiChatMessage,\n  kInternal,\n  Signal,\n  type WithNavigation,\n} from \"@liveblocks/core\";\nimport { useClient } from \"@liveblocks/react\";\nimport { useLayoutEffect, useSignal } from \"@liveblocks/react/_private\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport type { FocusEvent, FormEvent, KeyboardEvent, MouseEvent } from \"react\";\nimport {\n  forwardRef,\n  useCallback,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  createEditor,\n  Editor as SlateEditor,\n  Transforms as SlateTransforms,\n} from \"slate\";\nimport { withHistory } from \"slate-history\";\nimport {\n  Editable,\n  ReactEditor,\n  type RenderPlaceholderProps,\n  Slate,\n  withReact,\n} from \"slate-react\";\n\nimport type { AiComposerBody } from \"../../types\";\nimport { requestSubmit } from \"../../utils/request-submit\";\nimport { useInitial } from \"../../utils/use-initial\";\nimport { withNormalize } from \"../slate/plugins/normalize\";\nimport { isEmpty } from \"../slate/utils/is-empty\";\nimport {\n  AiComposerContext,\n  AiComposerEditorContext,\n  useAiComposer,\n  useAiComposerEditorContext,\n} from \"./contexts\";\nimport type {\n  AiComposerEditorProps,\n  AiComposerFormProps,\n  AiComposerSubmitProps,\n} from \"./types\";\n\nconst AI_COMPOSER_SUBMIT_NAME = \"AiComposerSubmit\";\nconst AI_COMPOSER_ABORT_NAME = \"AiComposerAbort\";\nconst AI_COMPOSER_EDITOR_NAME = \"AiComposerEditor\";\nconst AI_COMPOSER_FORM_NAME = \"AiComposerForm\";\n\ntype UiChatMessage = WithNavigation<AiChatMessage>;\n\n/* -------------------------------------------------------------------------------------------------\n * Form\n * -----------------------------------------------------------------------------------------------*/\n\nconst emptyMessages = new Signal<UiChatMessage[]>([]);\n\nfunction getLastMessageId(messages: UiChatMessage[]) {\n  const lastMessage = messages[messages.length - 1];\n\n  if (lastMessage === undefined) {\n    return null;\n  }\n\n  return lastMessage.id;\n}\n\nfunction getAbortableMessageId(messages: UiChatMessage[]) {\n  return messages.find(\n    (message) =>\n      message.role === \"assistant\" &&\n      (message.status === \"generating\" || message.status === \"awaiting-tool\")\n  )?.id;\n}\n\n/**\n * Surrounds the AI composer's content and handles submissions.\n *\n * @example\n * <AiComposer.Form onComposerSubmit={({ text }) => {}}>\n *\t <AiComposer.Editor />\n *   <AiComposer.Submit />\n * </AiComposer.Form>\n */\nexport const AiComposerForm = forwardRef<HTMLFormElement, AiComposerFormProps>(\n  (\n    {\n      onComposerSubmit,\n      onSubmit,\n      disabled,\n      chatId,\n      branchId,\n      asChild,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const Component = asChild ? Slot : \"form\";\n    const client = useClient();\n    const formRef = useRef<HTMLFormElement | null>(null);\n    const editor = useInitial(() =>\n      withNormalize(withHistory(withReact(createEditor())))\n    );\n    const [isEditorEmpty, setEditorEmpty] = useState(true);\n    const [isSubmitting, setSubmitting] = useState(false);\n    const [isFocused, setFocused] = useState(false);\n    const messages = chatId\n      ? client[kInternal].ai.signals.getChatMessagesForBranch(chatId, branchId)\n      : emptyMessages;\n    const lastMessageId = useSignal(messages, getLastMessageId);\n    const abortableMessageId = useSignal(messages, getAbortableMessageId);\n\n    const isDisabled = isSubmitting || disabled === true;\n    const canAbort = abortableMessageId !== undefined;\n    const canSubmit = !isEditorEmpty && !canAbort;\n\n    const clear = useCallback(() => {\n      SlateTransforms.delete(editor, {\n        at: {\n          anchor: SlateEditor.start(editor, []),\n          focus: SlateEditor.end(editor, []),\n        },\n      });\n    }, [editor]);\n\n    const select = useCallback(() => {\n      SlateTransforms.select(editor, SlateEditor.end(editor, []));\n    }, [editor]);\n\n    const focus = useCallback(\n      (resetSelection = true) => {\n        try {\n          if (!ReactEditor.isFocused(editor)) {\n            SlateTransforms.select(\n              editor,\n              resetSelection || !editor.selection\n                ? SlateEditor.end(editor, [])\n                : editor.selection\n            );\n            ReactEditor.focus(editor);\n          }\n        } catch {\n          // Slate's DOM-specific methods will throw if the editor's DOM\n          // node no longer exists. This action doesn't make sense on an\n          // unmounted editor so we can safely ignore it.\n        }\n      },\n      [editor]\n    );\n\n    const blur = useCallback(() => {\n      try {\n        ReactEditor.blur(editor);\n      } catch {\n        // Slate's DOM-specific methods will throw if the editor's DOM\n        // node no longer exists. This action doesn't make sense on an\n        // unmounted editor so we can safely ignore it.\n      }\n    }, [editor]);\n\n    const onSubmitEnd = useCallback(() => {\n      clear();\n      setSubmitting(false);\n    }, [clear]);\n\n    const handleSubmit = useCallback(\n      (event: FormEvent<HTMLFormElement>) => {\n        if (disabled) {\n          return;\n        }\n\n        // In some situations (e.g. pressing Enter while composing diacritics), it's possible\n        // for the form to be submitted as empty even though we already checked whether the\n        // editor was empty when handling the key press.\n        const isEditorEmpty = isEmpty(editor, editor.children);\n\n        // We even prevent the user's `onSubmit` handler from being called if the editor is empty.\n        if (isEditorEmpty) {\n          event.preventDefault();\n\n          return;\n        }\n\n        onSubmit?.(event);\n\n        if (onComposerSubmit === undefined || event.isDefaultPrevented()) {\n          event.preventDefault();\n          return;\n        }\n\n        // Extract the text content from the editor.\n        const content = editor.children\n          .map((block) => {\n            if (\"type\" in block && block.type === \"paragraph\") {\n              return block.children\n                .map((child) => {\n                  if (\"text\" in child) {\n                    return child.text;\n                  }\n                  return \"\";\n                })\n                .join(\"\");\n            }\n            return \"\";\n          })\n          .join(\"\\n\");\n\n        const promise = onComposerSubmit(\n          { text: content, lastMessageId },\n          event\n        );\n\n        event.preventDefault();\n\n        if (promise) {\n          setSubmitting(true);\n          promise.then(onSubmitEnd);\n        } else {\n          onSubmitEnd();\n        }\n      },\n      [disabled, editor, onSubmit, onComposerSubmit, onSubmitEnd, lastMessageId]\n    );\n\n    useLayoutEffect(() => {\n      setEditorEmpty(isEmpty(editor, editor.children));\n    }, [editor]);\n\n    const handleEditorValueChange = useCallback(() => {\n      setEditorEmpty(isEmpty(editor, editor.children));\n    }, [editor]);\n\n    const submit = useCallback(() => {\n      if (!canSubmit) {\n        return;\n      }\n\n      // We need to wait for the next frame in some cases like when composing diacritics,\n      // we want any native handling to be done first while still being handled on `keydown`.\n      requestAnimationFrame(() => {\n        if (formRef.current) {\n          requestSubmit(formRef.current);\n        }\n      });\n    }, [canSubmit]);\n\n    const abort = useCallback(() => {\n      if (!canAbort || !abortableMessageId) {\n        return;\n      }\n\n      client[kInternal].ai.abort(abortableMessageId);\n    }, [canAbort, abortableMessageId, client]);\n\n    useImperativeHandle<HTMLFormElement | null, HTMLFormElement | null>(\n      forwardedRef,\n      () => formRef.current,\n      []\n    );\n\n    return (\n      <AiComposerEditorContext.Provider\n        value={{\n          editor,\n          onEditorValueChange: handleEditorValueChange,\n          abortableMessageId,\n          setFocused,\n        }}\n      >\n        <AiComposerContext.Provider\n          value={{\n            isDisabled,\n            isEmpty: isEditorEmpty,\n            isFocused,\n            canSubmit,\n            canAbort,\n            submit,\n            abort,\n            clear,\n            focus,\n            blur,\n            select,\n          }}\n        >\n          <Component onSubmit={handleSubmit} {...props} ref={formRef} />\n        </AiComposerContext.Provider>\n      </AiComposerEditorContext.Provider>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * Editor\n * -----------------------------------------------------------------------------------------------*/\n\nfunction AiComposerEditorPlaceholder({\n  attributes,\n  children,\n}: RenderPlaceholderProps) {\n  const { opacity: _opacity, ...style } = attributes.style;\n\n  return (\n    <span {...attributes} style={style} data-placeholder=\"\">\n      {children}\n    </span>\n  );\n}\n\n/**\n * Displays the AI composer's editor.\n *\n * @example\n * <AiComposer.Editor placeholder=\"Write a message\" />\n */\nconst AiComposerEditor = forwardRef<HTMLDivElement, AiComposerEditorProps>(\n  (\n    {\n      defaultValue = \"\",\n      onKeyDown,\n      onFocus,\n      onBlur,\n      disabled,\n      autoFocus,\n      dir,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const { editor, onEditorValueChange, setFocused } =\n      useAiComposerEditorContext();\n    const {\n      submit,\n      isDisabled: isComposerDisabled,\n      isFocused,\n      focus,\n      blur,\n      select,\n    } = useAiComposer();\n    const isDisabled = disabled || isComposerDisabled;\n\n    const handleKeyDown = useCallback(\n      (event: KeyboardEvent<HTMLDivElement>) => {\n        onKeyDown?.(event);\n        if (event.isDefaultPrevented()) return;\n\n        if (event.key === \"Enter\" && !event.shiftKey) {\n          event.preventDefault();\n          submit();\n        } else if (event.key === \"Enter\" && event.shiftKey) {\n          event.preventDefault();\n          editor.insertBreak();\n        } else if (event.key === \"Escape\") {\n          blur();\n        }\n      },\n      [editor, onKeyDown, submit, blur]\n    );\n\n    const handleFocus = useCallback(\n      (event: FocusEvent<HTMLDivElement>) => {\n        onFocus?.(event);\n\n        if (!event.isDefaultPrevented()) {\n          setFocused(true);\n        }\n      },\n      [onFocus, setFocused]\n    );\n\n    const handleBlur = useCallback(\n      (event: FocusEvent<HTMLDivElement>) => {\n        onBlur?.(event);\n\n        if (!event.isDefaultPrevented()) {\n          setFocused(false);\n        }\n      },\n      [onBlur, setFocused]\n    );\n\n    useImperativeHandle(\n      forwardedRef,\n      () => ReactEditor.toDOMNode(editor, editor) as HTMLDivElement,\n      [editor]\n    );\n\n    // Manually focus the editor when `autoFocus` is true\n    useLayoutEffect(() => {\n      if (autoFocus) {\n        focus();\n      }\n    }, [autoFocus, editor, focus]);\n\n    // Manually add a selection in the editor if the selection\n    // is still empty after being focused\n    useLayoutEffect(() => {\n      if (isFocused && editor.selection === null) {\n        select();\n      }\n    }, [editor, select, isFocused]);\n\n    const initialValue: AiComposerBody = useMemo(() => {\n      return defaultValue\n        .split(\"\\n\")\n        .map((text) => ({ type: \"paragraph\", children: [{ text }] }));\n    }, [defaultValue]);\n\n    return (\n      <Slate\n        editor={editor}\n        initialValue={initialValue}\n        onValueChange={onEditorValueChange}\n      >\n        <Editable\n          dir={dir}\n          enterKeyHint=\"send\"\n          autoCapitalize=\"sentences\"\n          aria-label=\"Composer editor\"\n          onKeyDown={handleKeyDown}\n          onFocus={handleFocus}\n          onBlur={handleBlur}\n          data-focused={isFocused || undefined}\n          data-disabled={isDisabled || undefined}\n          {...props}\n          readOnly={isDisabled}\n          disabled={isDisabled}\n          renderPlaceholder={AiComposerEditorPlaceholder}\n        />\n      </Slate>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * Submit\n * -----------------------------------------------------------------------------------------------*/\n\n/**\n * A button to submit the AI composer's content.\n *\n * @example\n * <AiComposer.Submit>Send</AiComposer.Submit>\n */\nexport const AiComposerSubmit = forwardRef<\n  HTMLButtonElement,\n  AiComposerSubmitProps\n>(({ disabled, asChild, ...props }, forwardedRef) => {\n  const Component = asChild ? Slot : \"button\";\n  const { isDisabled: isComposerDisabled, canSubmit } = useAiComposer();\n  const isDisabled = isComposerDisabled || disabled || !canSubmit;\n\n  return (\n    <Component\n      type=\"submit\"\n      {...props}\n      ref={forwardedRef}\n      disabled={isDisabled}\n    />\n  );\n});\n\n/* -------------------------------------------------------------------------------------------------\n * Abort\n * -----------------------------------------------------------------------------------------------*/\n\n/**\n * A button to abort a response related to the AI composer.\n *\n * @example\n * <AiComposer.Abort>Cancel</AiComposer.Abort>\n */\nexport const AiComposerAbort = forwardRef<\n  HTMLButtonElement,\n  AiComposerSubmitProps\n>(({ disabled, onClick, asChild, ...props }, forwardedRef) => {\n  const Component = asChild ? Slot : \"button\";\n  const { isDisabled: isComposerDisabled, canAbort, abort } = useAiComposer();\n  const isDisabled = isComposerDisabled || disabled || !canAbort;\n\n  const handleClick = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      onClick?.(event);\n\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n\n      abort();\n    },\n    [abort, onClick]\n  );\n\n  return (\n    <Component\n      type=\"button\"\n      {...props}\n      ref={forwardedRef}\n      disabled={isDisabled}\n      onClick={handleClick}\n    />\n  );\n});\n\nif (process.env.NODE_ENV !== \"production\") {\n  AiComposerEditor.displayName = AI_COMPOSER_EDITOR_NAME;\n  AiComposerForm.displayName = AI_COMPOSER_FORM_NAME;\n  AiComposerSubmit.displayName = AI_COMPOSER_SUBMIT_NAME;\n  AiComposerAbort.displayName = AI_COMPOSER_ABORT_NAME;\n}\n\n// NOTE: Every export from this file will be available publicly as AiComposer.*\nexport {\n  AiComposerAbort as Abort,\n  AiComposerEditor as Editor,\n  AiComposerForm as Form,\n  AiComposerSubmit as Submit,\n};\n", "import type { ComponentType, ErrorInfo, ReactNode } from \"react\";\nimport { Component, createContext, useContext } from \"react\";\n\nconst ErrorBoundaryContext = createContext<{\n  error: Error;\n  reset: () => void;\n} | null>(null);\n\nexport interface ErrorBoundaryProps {\n  children?: ReactNode;\n  fallback?: ReactNode | ComponentType<{ error: Error }>;\n}\n\ninterface ErrorBoundaryState {\n  error: Error | null;\n}\n\nexport class ErrorBoundary extends Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { error: null };\n  }\n\n  static getDerivedStateFromError(error: Error) {\n    return { error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    console.error(error, errorInfo);\n  }\n\n  reset() {\n    this.setState({ error: null });\n  }\n\n  render(): React.ReactNode {\n    if (this.state.error === null) return this.props.children;\n\n    const error = this.state.error;\n    const reset = this.reset.bind(this);\n    const fallback = this.props.fallback;\n    const Fallback =\n      typeof fallback === \"function\" ? fallback : () => fallback ?? null;\n    return (\n      <ErrorBoundaryContext.Provider value={{ error, reset }}>\n        <Fallback error={this.state.error} />\n      </ErrorBoundaryContext.Provider>\n    );\n  }\n}\n\nexport function useErrorBoundary(): {\n  error: Error;\n  reset: () => void;\n} {\n  const context = useContext(ErrorBoundaryContext);\n\n  if (context === null) {\n    throw new Error(\n      \"useErrorBoundary must be used within an ErrorBoundary component\"\n    );\n  }\n\n  return context;\n}\n", "import type { AiOpaqueToolInvocationProps } from \"@liveblocks/core\";\nimport { createContext, useContext } from \"react\";\n\nexport const AiToolInvocationContext =\n  createContext<AiOpaqueToolInvocationProps | null>(null);\n\nexport function useAiToolInvocationContext() {\n  const context = useContext(AiToolInvocationContext);\n\n  if (context === null) {\n    throw new Error(\n      \"This component must be used within a tool's render method.\"\n    );\n  }\n\n  return context;\n}\n", "import type {\n  AiAssistantMessage,\n  AiToolInvocationPart,\n  AiToolInvocationProps,\n  JsonObject,\n  ToolResultResponse,\n} from \"@liveblocks/core\";\nimport { kInternal } from \"@liveblocks/core\";\nimport { useClient } from \"@liveblocks/react\";\nimport { useSignal } from \"@liveblocks/react/_private\";\nimport { type FunctionComponent, useCallback, useMemo } from \"react\";\n\nimport { AiToolInvocationContext } from \"./contexts\";\n\ntype OpaqueAiToolInvocationProps = AiToolInvocationProps<\n  JsonObject,\n  JsonObject\n>;\n\nfunction StableRenderFn(props: {\n  renderFn: FunctionComponent<OpaqueAiToolInvocationProps>;\n  props: OpaqueAiToolInvocationProps;\n}) {\n  return props.renderFn(props.props);\n}\n\n/**\n * @internal\n *\n * This could become publicly exposed as <AiMessage.ToolInvocation /> in the future,\n * but because namespace exports can't be marked `@internal`, we're keeping it in its\n * own file for now.\n */\nexport function AiMessageToolInvocation({\n  message,\n  part,\n}: {\n  message: AiAssistantMessage;\n  part: AiToolInvocationPart;\n}) {\n  const client = useClient();\n  const ai = client[kInternal].ai;\n  const tool = useSignal(ai.signals.getTool(part.name, message.chatId));\n\n  const respond = useCallback(\n    (result: ToolResultResponse | undefined) => {\n      if (message.status !== \"awaiting-tool\") {\n        // console.log(\"Ignoring respond(): message not awaiting tool result\");\n      } else if (part.stage === \"receiving\") {\n        // console.log(\n        //   `Ignoring respond(): tool '${part.name}' (${part.invocationId}) is still receiving`\n        // );\n      } else if (part.stage === \"executed\") {\n        console.log(\n          `Ignoring respond(): tool '${part.name}' (${part.invocationId}) has already executed`\n        );\n      } else {\n        ai.setToolResult(\n          message.chatId,\n          message.id,\n          part.invocationId,\n          result ?? { data: {} },\n          { copilotId: message.copilotId }\n        );\n      }\n    },\n    [\n      ai,\n      message.chatId,\n      message.id,\n      message.status,\n      part.invocationId,\n      part.name,\n      part.stage,\n      message.copilotId,\n    ]\n  );\n\n  const partialArgs = part?.partialArgs;\n  const props = useMemo(() => {\n    // NOTE: Not really used, but necessary to trick useMemo into re-evaluating\n    // when it changes. Without this trick, tool call streaming won't\n    // re-render. The reason this is needed is that `part` gets mutated\n    // in-place by the delta handling, rather than part being replaced by a new\n    // object on every chunk.\n    partialArgs;\n\n    const { type: _, ...rest } = part;\n    return {\n      ...rest,\n      respond,\n      types: undefined as never,\n      [kInternal]: {\n        execute: tool?.execute,\n        messageStatus: message.status,\n      },\n    } satisfies OpaqueAiToolInvocationProps;\n  }, [part, respond, tool?.execute, message.status, partialArgs]);\n\n  if (tool?.render === undefined) return null;\n  return (\n    <AiToolInvocationContext.Provider value={props}>\n      <StableRenderFn\n        renderFn={tool.render as FunctionComponent<OpaqueAiToolInvocationProps>}\n        props={props}\n      />\n    </AiToolInvocationContext.Provider>\n  );\n}\n", "import type { AiAssistantMessage } from \"@liveblocks/core\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { forwardRef, useMemo } from \"react\";\n\nimport { ErrorBoundary } from \"../../utils/ErrorBoundary\";\nimport { Markdown } from \"../Markdown\";\nimport { AiMessageToolInvocation } from \"./tool-invocation\";\nimport type {\n  AiMessageContentComponents,\n  AiMessageContentProps,\n} from \"./types\";\n\nconst AI_MESSAGE_CONTENT_NAME = \"AiMessageContent\";\n\nconst defaultMessageContentComponents: AiMessageContentComponents = {\n  TextPart: ({ part }) => {\n    return <Markdown content={part.text} />;\n  },\n  ReasoningPart: ({ part }) => {\n    return <Markdown content={part.text} />;\n  },\n  RetrievalPart: () => null,\n  ToolInvocationPart: ({ part, message }) => {\n    return (\n      <ErrorBoundary fallback={null}>\n        <AiMessageToolInvocation part={part} message={message} />\n      </ErrorBoundary>\n    );\n  },\n};\n\n/**\n * --------------------------------------------------------------------------\n * @private The API for this component is not yet stable.\n * --------------------------------------------------------------------------\n *\n * Primitive to help display an user or assistant messages content, which is\n * an array of parts.\n *\n * @example\n * <AiMessage.Content message={message} components={{ TextPart }} />\n */\nconst AiMessageContent = forwardRef<HTMLDivElement, AiMessageContentProps>(\n  ({ message, components, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"div\";\n    const { ReasoningPart, RetrievalPart, TextPart, ToolInvocationPart } =\n      useMemo(\n        () => ({ ...defaultMessageContentComponents, ...components }),\n        [components]\n      );\n\n    const content = message.content ?? message.contentSoFar;\n    const numParts = content.length;\n    const isGenerating =\n      message.role === \"assistant\" && message.status === \"generating\";\n\n    return (\n      <Component {...props} ref={forwardedRef}>\n        {content.map((part, index) => {\n          // A part is considered to be still \"streaming in\" if it's the last\n          // part in the content array, and the message is in \"generating\"\n          // state.\n          const isStreaming = isGenerating && index === numParts - 1;\n          const extra = { index, isStreaming };\n          switch (part.type) {\n            case \"text\":\n              return <TextPart key={index} part={part} {...extra} />;\n\n            case \"reasoning\":\n              return <ReasoningPart key={index} part={part} {...extra} />;\n\n            case \"retrieval\":\n              return <RetrievalPart key={index} part={part} {...extra} />;\n\n            case \"tool-invocation\":\n              return (\n                <ToolInvocationPart\n                  key={index}\n                  part={part}\n                  {...extra}\n                  // For tool invocations, we know for sure it's an AiAssistantMessage\n                  message={message as AiAssistantMessage}\n                />\n              );\n            default:\n              return null;\n          }\n        })}\n      </Component>\n    );\n  }\n);\n\nif (process.env.NODE_ENV !== \"production\") {\n  AiMessageContent.displayName = AI_MESSAGE_CONTENT_NAME;\n}\n\n// NOTE: Every export from this file will be available publicly as AiMessage.*\nexport { AiMessageContent as Content };\n", "import { console } from \"@liveblocks/core\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\nimport { useRerender } from \"./use-rerender\";\n\n/**\n * Hold a state in a \"controlled\" or \"uncontrolled\" way.\n */\nexport function useControllableState<T>(\n  /**\n   * The default uncontrolled value.\n   */\n  defaultValue: T,\n\n  /**\n   * The controlled value.\n   *\n   * If `undefined`, the returned value is uncontrolled.\n   * If set, this controlled value is used and returned as is.\n   */\n  value: T | undefined,\n\n  /**\n   * The event handler called when the value changes.\n   */\n  onChange: ((value: T) => void) | undefined\n) {\n  const [uncontrolledValue, setUncontrolledValue] = useState(defaultValue);\n  const isControlled = value !== undefined;\n  const wasControlled = useRef(isControlled);\n\n  useEffect(() => {\n    if (\n      process.env.NODE_ENV !== \"production\" &&\n      wasControlled.current !== isControlled\n    ) {\n      console.warn(\n        `A component is changing from ${\n          wasControlled.current ? \"controlled\" : \"uncontrolled\"\n        } to ${isControlled ? \"controlled\" : \"uncontrolled\"}.`\n      );\n    }\n\n    wasControlled.current = isControlled;\n  }, [isControlled]);\n\n  const currentValue = isControlled ? value : uncontrolledValue;\n\n  const setValue = useCallback(\n    (value: T) => {\n      if (isControlled) {\n        return onChange?.(value);\n      } else {\n        setUncontrolledValue(value);\n\n        return onChange?.(value);\n      }\n    },\n    [isControlled, onChange]\n  );\n\n  return [currentValue, setValue] as const;\n}\n\n/**\n * @experimental\n *\n * Hold a value in a \"semi-controlled\" way: a controlled value that can be\n * overridden by uncontrolled changes in a \"most recent wins\" way.\n *\n * @example\n *\n * A `Collapsible` component uses `useSemiControllableState` to control\n * its \"open\" state, it accepts two optional props: `open` and `onOpenChange`.\n *\n * Internally, it passes them to `useSemiControllableState`:\n *\n * ```tsx\n * const [isOpen, setIsOpen] = useSemiControllableState(\n *   open ?? true, // Defaults to `true` if `open` is not provided\n *   onOpenChange\n * );\n *\n * // ... `isOpen` and `setIsOpen` are used in the component's implementation ...\n * ```\n *\n * And finally here's how it could be used in a \"semi-controlled\" way:\n *\n * ```tsx\n * const status: `\"loading\" | \"success\" | \"error\"`;\n *\n * <Collapsible open={status === \"success\"} />\n * ```\n *\n * Like with a traditional controlled value, the collapsible will start closed\n * and will automatically open when `status` becomes `\"success\"`.\n *\n * But unlike with a traditional controlled value, the collapsible can still\n * open/close when it's clicked on by the user, overriding `open={status === \"success\"}`.\n *\n * It's possible to use it as a traditional uncontrolled value:\n *\n * ```tsx\n * const defaultOpen = false;\n *\n * <Collapsible open={defaultOpen} />\n * ```\n *\n * Or to sync the uncontrolled value like with a traditional uncontrolled value:\n *\n * ```tsx\n * const [isOpen, setIsOpen] = useState(false);\n *\n * // `isOpen` is synced with the uncontrolled value when the user clicks\n * <Collapsible open={isOpen} onOpenChange={setIsOpen} />\n * ```\n *\n * But with the caveat that it will still be possible to change the\n * uncontrolled value:\n *\n * ```tsx\n * const open = false;\n *\n * // Clicking on the collapsible will still open/close it, unlike with a\n * // traditional controlled value.\n * <Collapsible open={open} />\n * ```\n */\nexport function useSemiControllableState<T>(\n  /**\n   * The controlled value.\n   *\n   * When this value changes, it becomes the current value.\n   * But unlike a traditional controlled value, it can be overridden by\n   * uncontrolled changes.\n   */\n  value: T,\n\n  /**\n   * The event handler called when the uncontrolled value changes.\n   */\n  onChange: ((value: T) => void) | undefined\n) {\n  const [uncontrolledValue, setUncontrolledValue] = useState(value);\n  const lastChange = useRef<\"uncontrolled\" | \"controlled\">(\"controlled\");\n  const lastValue = useRef(value);\n  const [rerender] = useRerender();\n\n  // Listen to `value` changes during the render phase to avoid\n  // having to always sync `uncontrolledValue` on every change.\n  if (!Object.is(lastValue.current, value)) {\n    lastValue.current = value;\n    lastChange.current = \"controlled\";\n  }\n\n  const setValue = useCallback(\n    (value: T) => {\n      lastChange.current = \"uncontrolled\";\n      setUncontrolledValue(value);\n\n      // If the new `uncontrolledValue` is the same as last time it was the \"last change\",\n      // `setUncontrolledValue` won't trigger a re-render, but the fact that it's becoming\n      // uncontrolled again is a change that needs a re-render.\n      rerender();\n\n      onChange?.(value);\n    },\n    [onChange, rerender]\n  );\n\n  const currentValue =\n    lastChange.current === \"uncontrolled\" ? uncontrolledValue : value;\n\n  return [currentValue, setValue] as const;\n}\n", "import { Slot } from \"@radix-ui/react-slot\";\nimport {\n  createContext,\n  forwardRef,\n  useContext,\n  useEffect,\n  useId,\n  useImperativeHandle,\n  useRef,\n} from \"react\";\n\nimport { useControllableState } from \"../../utils/use-controllable-state\";\nimport type { ContentProps, RootProps, TriggerProps } from \"./types\";\n\nconst COLLAPSIBLE_ROOT_NAME = \"CollapsibleRoot\";\nconst COLLAPSIBLE_TRIGGER_NAME = \"CollapsibleTrigger\";\nconst COLLAPSIBLE_CONTENT_NAME = \"CollapsibleContent\";\n\nconst CollapsibleContext = createContext<{\n  open?: boolean;\n  onOpenChange: (open: boolean) => void;\n  disabled: boolean;\n  contentId: string;\n} | null>(null);\n\n/* -------------------------------------------------------------------------------------------------\n * Root\n * -----------------------------------------------------------------------------------------------*/\n\nconst CollapsibleRoot = forwardRef<HTMLDivElement, RootProps>(\n  (\n    {\n      open: controlledOpen,\n      onOpenChange: controlledOnOpenChange,\n      defaultOpen,\n      disabled = false,\n      asChild,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const [isOpen, onOpenChange] = useControllableState(\n      defaultOpen ?? true,\n      controlledOpen,\n      controlledOnOpenChange\n    );\n    const Component = asChild ? Slot : \"div\";\n    const id = useId();\n\n    return (\n      <CollapsibleContext.Provider\n        value={{ open: isOpen, onOpenChange, disabled, contentId: id }}\n      >\n        <Component\n          {...props}\n          ref={forwardedRef}\n          data-state={isOpen ? \"open\" : \"closed\"}\n          data-disabled={disabled ? \"\" : undefined}\n        />\n      </CollapsibleContext.Provider>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * Trigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst CollapsibleTrigger = forwardRef<HTMLButtonElement, TriggerProps>(\n  ({ onClick, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"button\";\n    const context = useContext(CollapsibleContext);\n\n    if (!context) {\n      throw new Error(\"Collapsible.Root is missing from the React tree.\");\n    }\n\n    const { open, disabled, contentId, onOpenChange } = context;\n\n    return (\n      <Component\n        {...props}\n        ref={forwardedRef}\n        type=\"button\"\n        aria-controls={contentId}\n        aria-expanded={open || false}\n        data-state={open ? \"open\" : \"closed\"}\n        data-disabled={disabled ? \"\" : undefined}\n        disabled={disabled}\n        onClick={(event) => {\n          onClick?.(event);\n          if (event.defaultPrevented) return;\n          if (disabled) return;\n          onOpenChange(!open);\n        }}\n      />\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * Content\n * -----------------------------------------------------------------------------------------------*/\n\nconst CollapsibleContent = forwardRef<HTMLDivElement, ContentProps>(\n  ({ asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"div\";\n    const context = useContext(CollapsibleContext);\n    const divRef = useRef<HTMLDivElement>(null);\n\n    if (!context) {\n      throw new Error(\"Collapsible.Root is missing from the React tree.\");\n    }\n\n    const { open, onOpenChange, disabled, contentId } = context;\n\n    useEffect(() => {\n      const element = divRef.current;\n      if (element === null) return;\n\n      const isHiddenUntilFoundSupported = \"onbeforematch\" in document.body;\n      if (!isHiddenUntilFoundSupported) return;\n\n      function handleBeforeMatch() {\n        onOpenChange(true);\n      }\n\n      // https://developer.chrome.com/articles/hidden-until-found/\n      element.addEventListener(\"beforematch\", handleBeforeMatch);\n      return () => {\n        element.removeEventListener(\"beforematch\", handleBeforeMatch);\n      };\n    }, [onOpenChange]);\n\n    // Passing `string` to `hidden` in JSX is not currently supported: https://github.com/facebook/react/issues/24740\n    useEffect(() => {\n      const element = divRef.current;\n      if (element === null) return;\n\n      if (open) return;\n\n      const isHiddenUntilFoundSupported = \"onbeforematch\" in document.body;\n      if (!isHiddenUntilFoundSupported) return;\n\n      element.setAttribute(\"hidden\", \"until-found\");\n      return () => {\n        element.removeAttribute(\"hidden\");\n      };\n    }, [open]);\n\n    useImperativeHandle<\n      HTMLDivElement | null,\n      HTMLDivElement | null\n    >(forwardedRef, () => {\n      return divRef.current;\n    }, []);\n\n    return (\n      <Component\n        {...props}\n        ref={divRef}\n        data-state={open ? \"open\" : \"closed\"}\n        data-disabled={disabled ? \"\" : undefined}\n        id={contentId}\n        hidden={!open}\n      />\n    );\n  }\n);\n\nif (process.env.NODE_ENV !== \"production\") {\n  CollapsibleContent.displayName = COLLAPSIBLE_CONTENT_NAME;\n  CollapsibleRoot.displayName = COLLAPSIBLE_ROOT_NAME;\n  CollapsibleTrigger.displayName = COLLAPSIBLE_TRIGGER_NAME;\n}\n\n// NOTE: Every export from this file will be available publicly as Collapsible.*\nexport {\n  CollapsibleContent as Content,\n  CollapsibleRoot as Root,\n  CollapsibleTrigger as Trigger,\n};\n", "var U=1,Y=.9,H=.8,J=.17,p=.1,u=.999,$=.9999;var k=.99,m=/[\\\\\\/_+.#\"@\\[\\(\\{&]/,B=/[\\\\\\/_+.#\"@\\[\\(\\{&]/g,K=/[\\s-]/,X=/[\\s-]/g;function G(_,C,h,P,A,f,O){if(f===C.length)return A===_.length?U:k;var T=`${A},${f}`;if(O[T]!==void 0)return O[T];for(var L=P.charAt(f),c=h.indexOf(L,A),S=0,E,N,R,M;c>=0;)E=G(_,C,h,P,c+1,f+1,O),E>S&&(c===A?E*=U:m.test(_.charAt(c-1))?(E*=H,R=_.slice(A,c-1).match(B),R&&A>0&&(E*=Math.pow(u,R.length))):K.test(_.charAt(c-1))?(E*=Y,M=_.slice(A,c-1).match(X),M&&A>0&&(E*=Math.pow(u,M.length))):(E*=J,A>0&&(E*=Math.pow(u,c-A))),_.charAt(c)!==C.charAt(f)&&(E*=$)),(E<p&&h.charAt(c-1)===P.charAt(f+1)||P.charAt(f+1)===P.charAt(f)&&h.charAt(c-1)!==P.charAt(f))&&(N=G(_,C,h,P,c+1,f+2,O),N*p>E&&(E=N*p)),E>S&&(S=E),c=h.indexOf(L,c+1);return O[T]=S,S}function D(_){return _.toLowerCase().replace(X,\" \")}function W(_,C,h){return _=h&&h.length>0?`${_+\" \"+h.join(\" \")}`:_,G(_,C,D(_),D(C),0,0,{})}export{W as a};\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContext, createContextScope } from '@radix-ui/react-context';\nimport { useId } from '@radix-ui/react-id';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { DismissableLayer } from '@radix-ui/react-dismissable-layer';\nimport { FocusScope } from '@radix-ui/react-focus-scope';\nimport { Portal as PortalPrimitive } from '@radix-ui/react-portal';\nimport { Presence } from '@radix-ui/react-presence';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { useFocusGuards } from '@radix-ui/react-focus-guards';\nimport { RemoveScroll } from 'react-remove-scroll';\nimport { hideOthers } from 'aria-hidden';\nimport { createSlot } from '@radix-ui/react-slot';\n\nimport type { Scope } from '@radix-ui/react-context';\n\n/* -------------------------------------------------------------------------------------------------\n * Dialog\n * -----------------------------------------------------------------------------------------------*/\n\nconst DIALOG_NAME = 'Dialog';\n\ntype ScopedProps<P> = P & { __scopeDialog?: Scope };\nconst [createDialogContext, createDialogScope] = createContextScope(DIALOG_NAME);\n\ntype DialogContextValue = {\n  triggerRef: React.RefObject<HTMLButtonElement | null>;\n  contentRef: React.RefObject<DialogContentElement | null>;\n  contentId: string;\n  titleId: string;\n  descriptionId: string;\n  open: boolean;\n  onOpenChange(open: boolean): void;\n  onOpenToggle(): void;\n  modal: boolean;\n};\n\nconst [DialogProvider, useDialogContext] = createDialogContext<DialogContextValue>(DIALOG_NAME);\n\ninterface DialogProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?(open: boolean): void;\n  modal?: boolean;\n}\n\nconst Dialog: React.FC<DialogProps> = (props: ScopedProps<DialogProps>) => {\n  const {\n    __scopeDialog,\n    children,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    modal = true,\n  } = props;\n  const triggerRef = React.useRef<HTMLButtonElement>(null);\n  const contentRef = React.useRef<DialogContentElement>(null);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen ?? false,\n    onChange: onOpenChange,\n    caller: DIALOG_NAME,\n  });\n\n  return (\n    <DialogProvider\n      scope={__scopeDialog}\n      triggerRef={triggerRef}\n      contentRef={contentRef}\n      contentId={useId()}\n      titleId={useId()}\n      descriptionId={useId()}\n      open={open}\n      onOpenChange={setOpen}\n      onOpenToggle={React.useCallback(() => setOpen((prevOpen) => !prevOpen), [setOpen])}\n      modal={modal}\n    >\n      {children}\n    </DialogProvider>\n  );\n};\n\nDialog.displayName = DIALOG_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRIGGER_NAME = 'DialogTrigger';\n\ntype DialogTriggerElement = React.ComponentRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = React.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface DialogTriggerProps extends PrimitiveButtonProps {}\n\nconst DialogTrigger = React.forwardRef<DialogTriggerElement, DialogTriggerProps>(\n  (props: ScopedProps<DialogTriggerProps>, forwardedRef) => {\n    const { __scopeDialog, ...triggerProps } = props;\n    const context = useDialogContext(TRIGGER_NAME, __scopeDialog);\n    const composedTriggerRef = useComposedRefs(forwardedRef, context.triggerRef);\n    return (\n      <Primitive.button\n        type=\"button\"\n        aria-haspopup=\"dialog\"\n        aria-expanded={context.open}\n        aria-controls={context.contentId}\n        data-state={getState(context.open)}\n        {...triggerProps}\n        ref={composedTriggerRef}\n        onClick={composeEventHandlers(props.onClick, context.onOpenToggle)}\n      />\n    );\n  }\n);\n\nDialogTrigger.displayName = TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'DialogPortal';\n\ntype PortalContextValue = { forceMount?: true };\nconst [PortalProvider, usePortalContext] = createDialogContext<PortalContextValue>(PORTAL_NAME, {\n  forceMount: undefined,\n});\n\ntype PortalProps = React.ComponentPropsWithoutRef<typeof PortalPrimitive>;\ninterface DialogPortalProps {\n  children?: React.ReactNode;\n  /**\n   * Specify a container element to portal the content into.\n   */\n  container?: PortalProps['container'];\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst DialogPortal: React.FC<DialogPortalProps> = (props: ScopedProps<DialogPortalProps>) => {\n  const { __scopeDialog, forceMount, children, container } = props;\n  const context = useDialogContext(PORTAL_NAME, __scopeDialog);\n  return (\n    <PortalProvider scope={__scopeDialog} forceMount={forceMount}>\n      {React.Children.map(children, (child) => (\n        <Presence present={forceMount || context.open}>\n          <PortalPrimitive asChild container={container}>\n            {child}\n          </PortalPrimitive>\n        </Presence>\n      ))}\n    </PortalProvider>\n  );\n};\n\nDialogPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogOverlay\n * -----------------------------------------------------------------------------------------------*/\n\nconst OVERLAY_NAME = 'DialogOverlay';\n\ntype DialogOverlayElement = DialogOverlayImplElement;\ninterface DialogOverlayProps extends DialogOverlayImplProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst DialogOverlay = React.forwardRef<DialogOverlayElement, DialogOverlayProps>(\n  (props: ScopedProps<DialogOverlayProps>, forwardedRef) => {\n    const portalContext = usePortalContext(OVERLAY_NAME, props.__scopeDialog);\n    const { forceMount = portalContext.forceMount, ...overlayProps } = props;\n    const context = useDialogContext(OVERLAY_NAME, props.__scopeDialog);\n    return context.modal ? (\n      <Presence present={forceMount || context.open}>\n        <DialogOverlayImpl {...overlayProps} ref={forwardedRef} />\n      </Presence>\n    ) : null;\n  }\n);\n\nDialogOverlay.displayName = OVERLAY_NAME;\n\ntype DialogOverlayImplElement = React.ComponentRef<typeof Primitive.div>;\ntype PrimitiveDivProps = React.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface DialogOverlayImplProps extends PrimitiveDivProps {}\n\nconst Slot = createSlot('DialogOverlay.RemoveScroll');\n\nconst DialogOverlayImpl = React.forwardRef<DialogOverlayImplElement, DialogOverlayImplProps>(\n  (props: ScopedProps<DialogOverlayImplProps>, forwardedRef) => {\n    const { __scopeDialog, ...overlayProps } = props;\n    const context = useDialogContext(OVERLAY_NAME, __scopeDialog);\n    return (\n      // Make sure `Content` is scrollable even when it doesn't live inside `RemoveScroll`\n      // ie. when `Overlay` and `Content` are siblings\n      <RemoveScroll as={Slot} allowPinchZoom shards={[context.contentRef]}>\n        <Primitive.div\n          data-state={getState(context.open)}\n          {...overlayProps}\n          ref={forwardedRef}\n          // We re-enable pointer-events prevented by `Dialog.Content` to allow scrolling the overlay.\n          style={{ pointerEvents: 'auto', ...overlayProps.style }}\n        />\n      </RemoveScroll>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * DialogContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'DialogContent';\n\ntype DialogContentElement = DialogContentTypeElement;\ninterface DialogContentProps extends DialogContentTypeProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst DialogContent = React.forwardRef<DialogContentElement, DialogContentProps>(\n  (props: ScopedProps<DialogContentProps>, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopeDialog);\n    const { forceMount = portalContext.forceMount, ...contentProps } = props;\n    const context = useDialogContext(CONTENT_NAME, props.__scopeDialog);\n    return (\n      <Presence present={forceMount || context.open}>\n        {context.modal ? (\n          <DialogContentModal {...contentProps} ref={forwardedRef} />\n        ) : (\n          <DialogContentNonModal {...contentProps} ref={forwardedRef} />\n        )}\n      </Presence>\n    );\n  }\n);\n\nDialogContent.displayName = CONTENT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype DialogContentTypeElement = DialogContentImplElement;\ninterface DialogContentTypeProps\n  extends Omit<DialogContentImplProps, 'trapFocus' | 'disableOutsidePointerEvents'> {}\n\nconst DialogContentModal = React.forwardRef<DialogContentTypeElement, DialogContentTypeProps>(\n  (props: ScopedProps<DialogContentTypeProps>, forwardedRef) => {\n    const context = useDialogContext(CONTENT_NAME, props.__scopeDialog);\n    const contentRef = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, context.contentRef, contentRef);\n\n    // aria-hide everything except the content (better supported equivalent to setting aria-modal)\n    React.useEffect(() => {\n      const content = contentRef.current;\n      if (content) return hideOthers(content);\n    }, []);\n\n    return (\n      <DialogContentImpl\n        {...props}\n        ref={composedRefs}\n        // we make sure focus isn't trapped once `DialogContent` has been closed\n        // (closed !== unmounted when animating out)\n        trapFocus={context.open}\n        disableOutsidePointerEvents\n        onCloseAutoFocus={composeEventHandlers(props.onCloseAutoFocus, (event) => {\n          event.preventDefault();\n          context.triggerRef.current?.focus();\n        })}\n        onPointerDownOutside={composeEventHandlers(props.onPointerDownOutside, (event) => {\n          const originalEvent = event.detail.originalEvent;\n          const ctrlLeftClick = originalEvent.button === 0 && originalEvent.ctrlKey === true;\n          const isRightClick = originalEvent.button === 2 || ctrlLeftClick;\n\n          // If the event is a right-click, we shouldn't close because\n          // it is effectively as if we right-clicked the `Overlay`.\n          if (isRightClick) event.preventDefault();\n        })}\n        // When focus is trapped, a `focusout` event may still happen.\n        // We make sure we don't trigger our `onDismiss` in such case.\n        onFocusOutside={composeEventHandlers(props.onFocusOutside, (event) =>\n          event.preventDefault()\n        )}\n      />\n    );\n  }\n);\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst DialogContentNonModal = React.forwardRef<DialogContentTypeElement, DialogContentTypeProps>(\n  (props: ScopedProps<DialogContentTypeProps>, forwardedRef) => {\n    const context = useDialogContext(CONTENT_NAME, props.__scopeDialog);\n    const hasInteractedOutsideRef = React.useRef(false);\n    const hasPointerDownOutsideRef = React.useRef(false);\n\n    return (\n      <DialogContentImpl\n        {...props}\n        ref={forwardedRef}\n        trapFocus={false}\n        disableOutsidePointerEvents={false}\n        onCloseAutoFocus={(event) => {\n          props.onCloseAutoFocus?.(event);\n\n          if (!event.defaultPrevented) {\n            if (!hasInteractedOutsideRef.current) context.triggerRef.current?.focus();\n            // Always prevent auto focus because we either focus manually or want user agent focus\n            event.preventDefault();\n          }\n\n          hasInteractedOutsideRef.current = false;\n          hasPointerDownOutsideRef.current = false;\n        }}\n        onInteractOutside={(event) => {\n          props.onInteractOutside?.(event);\n\n          if (!event.defaultPrevented) {\n            hasInteractedOutsideRef.current = true;\n            if (event.detail.originalEvent.type === 'pointerdown') {\n              hasPointerDownOutsideRef.current = true;\n            }\n          }\n\n          // Prevent dismissing when clicking the trigger.\n          // As the trigger is already setup to close, without doing so would\n          // cause it to close and immediately open.\n          const target = event.target as HTMLElement;\n          const targetIsTrigger = context.triggerRef.current?.contains(target);\n          if (targetIsTrigger) event.preventDefault();\n\n          // On Safari if the trigger is inside a container with tabIndex={0}, when clicked\n          // we will get the pointer down outside event on the trigger, but then a subsequent\n          // focus outside event on the container, we ignore any focus outside event when we've\n          // already had a pointer down outside event.\n          if (event.detail.originalEvent.type === 'focusin' && hasPointerDownOutsideRef.current) {\n            event.preventDefault();\n          }\n        }}\n      />\n    );\n  }\n);\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype DialogContentImplElement = React.ComponentRef<typeof DismissableLayer>;\ntype DismissableLayerProps = React.ComponentPropsWithoutRef<typeof DismissableLayer>;\ntype FocusScopeProps = React.ComponentPropsWithoutRef<typeof FocusScope>;\ninterface DialogContentImplProps extends Omit<DismissableLayerProps, 'onDismiss'> {\n  /**\n   * When `true`, focus cannot escape the `Content` via keyboard,\n   * pointer, or a programmatic focus.\n   * @defaultValue false\n   */\n  trapFocus?: FocusScopeProps['trapped'];\n\n  /**\n   * Event handler called when auto-focusing on open.\n   * Can be prevented.\n   */\n  onOpenAutoFocus?: FocusScopeProps['onMountAutoFocus'];\n\n  /**\n   * Event handler called when auto-focusing on close.\n   * Can be prevented.\n   */\n  onCloseAutoFocus?: FocusScopeProps['onUnmountAutoFocus'];\n}\n\nconst DialogContentImpl = React.forwardRef<DialogContentImplElement, DialogContentImplProps>(\n  (props: ScopedProps<DialogContentImplProps>, forwardedRef) => {\n    const { __scopeDialog, trapFocus, onOpenAutoFocus, onCloseAutoFocus, ...contentProps } = props;\n    const context = useDialogContext(CONTENT_NAME, __scopeDialog);\n    const contentRef = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef);\n\n    // Make sure the whole tree has focus guards as our `Dialog` will be\n    // the last element in the DOM (because of the `Portal`)\n    useFocusGuards();\n\n    return (\n      <>\n        <FocusScope\n          asChild\n          loop\n          trapped={trapFocus}\n          onMountAutoFocus={onOpenAutoFocus}\n          onUnmountAutoFocus={onCloseAutoFocus}\n        >\n          <DismissableLayer\n            role=\"dialog\"\n            id={context.contentId}\n            aria-describedby={context.descriptionId}\n            aria-labelledby={context.titleId}\n            data-state={getState(context.open)}\n            {...contentProps}\n            ref={composedRefs}\n            onDismiss={() => context.onOpenChange(false)}\n          />\n        </FocusScope>\n        {process.env.NODE_ENV !== 'production' && (\n          <>\n            <TitleWarning titleId={context.titleId} />\n            <DescriptionWarning contentRef={contentRef} descriptionId={context.descriptionId} />\n          </>\n        )}\n      </>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * DialogTitle\n * -----------------------------------------------------------------------------------------------*/\n\nconst TITLE_NAME = 'DialogTitle';\n\ntype DialogTitleElement = React.ComponentRef<typeof Primitive.h2>;\ntype PrimitiveHeading2Props = React.ComponentPropsWithoutRef<typeof Primitive.h2>;\ninterface DialogTitleProps extends PrimitiveHeading2Props {}\n\nconst DialogTitle = React.forwardRef<DialogTitleElement, DialogTitleProps>(\n  (props: ScopedProps<DialogTitleProps>, forwardedRef) => {\n    const { __scopeDialog, ...titleProps } = props;\n    const context = useDialogContext(TITLE_NAME, __scopeDialog);\n    return <Primitive.h2 id={context.titleId} {...titleProps} ref={forwardedRef} />;\n  }\n);\n\nDialogTitle.displayName = TITLE_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogDescription\n * -----------------------------------------------------------------------------------------------*/\n\nconst DESCRIPTION_NAME = 'DialogDescription';\n\ntype DialogDescriptionElement = React.ComponentRef<typeof Primitive.p>;\ntype PrimitiveParagraphProps = React.ComponentPropsWithoutRef<typeof Primitive.p>;\ninterface DialogDescriptionProps extends PrimitiveParagraphProps {}\n\nconst DialogDescription = React.forwardRef<DialogDescriptionElement, DialogDescriptionProps>(\n  (props: ScopedProps<DialogDescriptionProps>, forwardedRef) => {\n    const { __scopeDialog, ...descriptionProps } = props;\n    const context = useDialogContext(DESCRIPTION_NAME, __scopeDialog);\n    return <Primitive.p id={context.descriptionId} {...descriptionProps} ref={forwardedRef} />;\n  }\n);\n\nDialogDescription.displayName = DESCRIPTION_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogClose\n * -----------------------------------------------------------------------------------------------*/\n\nconst CLOSE_NAME = 'DialogClose';\n\ntype DialogCloseElement = React.ComponentRef<typeof Primitive.button>;\ninterface DialogCloseProps extends PrimitiveButtonProps {}\n\nconst DialogClose = React.forwardRef<DialogCloseElement, DialogCloseProps>(\n  (props: ScopedProps<DialogCloseProps>, forwardedRef) => {\n    const { __scopeDialog, ...closeProps } = props;\n    const context = useDialogContext(CLOSE_NAME, __scopeDialog);\n    return (\n      <Primitive.button\n        type=\"button\"\n        {...closeProps}\n        ref={forwardedRef}\n        onClick={composeEventHandlers(props.onClick, () => context.onOpenChange(false))}\n      />\n    );\n  }\n);\n\nDialogClose.displayName = CLOSE_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction getState(open: boolean) {\n  return open ? 'open' : 'closed';\n}\n\nconst TITLE_WARNING_NAME = 'DialogTitleWarning';\n\nconst [WarningProvider, useWarningContext] = createContext(TITLE_WARNING_NAME, {\n  contentName: CONTENT_NAME,\n  titleName: TITLE_NAME,\n  docsSlug: 'dialog',\n});\n\ntype TitleWarningProps = { titleId?: string };\n\nconst TitleWarning: React.FC<TitleWarningProps> = ({ titleId }) => {\n  const titleWarningContext = useWarningContext(TITLE_WARNING_NAME);\n\n  const MESSAGE = `\\`${titleWarningContext.contentName}\\` requires a \\`${titleWarningContext.titleName}\\` for the component to be accessible for screen reader users.\n\nIf you want to hide the \\`${titleWarningContext.titleName}\\`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/${titleWarningContext.docsSlug}`;\n\n  React.useEffect(() => {\n    if (titleId) {\n      const hasTitle = document.getElementById(titleId);\n      if (!hasTitle) console.error(MESSAGE);\n    }\n  }, [MESSAGE, titleId]);\n\n  return null;\n};\n\nconst DESCRIPTION_WARNING_NAME = 'DialogDescriptionWarning';\n\ntype DescriptionWarningProps = {\n  contentRef: React.RefObject<DialogContentElement | null>;\n  descriptionId?: string;\n};\n\nconst DescriptionWarning: React.FC<DescriptionWarningProps> = ({ contentRef, descriptionId }) => {\n  const descriptionWarningContext = useWarningContext(DESCRIPTION_WARNING_NAME);\n  const MESSAGE = `Warning: Missing \\`Description\\` or \\`aria-describedby={undefined}\\` for {${descriptionWarningContext.contentName}}.`;\n\n  React.useEffect(() => {\n    const describedById = contentRef.current?.getAttribute('aria-describedby');\n    // if we have an id and the user hasn't set aria-describedby={undefined}\n    if (descriptionId && describedById) {\n      const hasDescription = document.getElementById(descriptionId);\n      if (!hasDescription) console.warn(MESSAGE);\n    }\n  }, [MESSAGE, contentRef, descriptionId]);\n\n  return null;\n};\n\nconst Root = Dialog;\nconst Trigger = DialogTrigger;\nconst Portal = DialogPortal;\nconst Overlay = DialogOverlay;\nconst Content = DialogContent;\nconst Title = DialogTitle;\nconst Description = DialogDescription;\nconst Close = DialogClose;\n\nexport {\n  createDialogScope,\n  //\n  Dialog,\n  DialogTrigger,\n  DialogPortal,\n  DialogOverlay,\n  DialogContent,\n  DialogTitle,\n  DialogDescription,\n  DialogClose,\n  //\n  Root,\n  Trigger,\n  Portal,\n  Overlay,\n  Content,\n  Title,\n  Description,\n  Close,\n  //\n  WarningProvider,\n};\nexport type {\n  DialogProps,\n  DialogTriggerProps,\n  DialogPortalProps,\n  DialogOverlayProps,\n  DialogContentProps,\n  DialogTitleProps,\n  DialogDescriptionProps,\n  DialogCloseProps,\n};\n", "import * as React from 'react';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\n\nconst AUTOFOCUS_ON_MOUNT = 'focusScope.autoFocusOnMount';\nconst AUTOFOCUS_ON_UNMOUNT = 'focusScope.autoFocusOnUnmount';\nconst EVENT_OPTIONS = { bubbles: false, cancelable: true };\n\ntype FocusableTarget = HTMLElement | { focus(): void };\n\n/* -------------------------------------------------------------------------------------------------\n * FocusScope\n * -----------------------------------------------------------------------------------------------*/\n\nconst FOCUS_SCOPE_NAME = 'FocusScope';\n\ntype FocusScopeElement = React.ComponentRef<typeof Primitive.div>;\ntype PrimitiveDivProps = React.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface FocusScopeProps extends PrimitiveDivProps {\n  /**\n   * When `true`, tabbing from last item will focus first tabbable\n   * and shift+tab from first item will focus last tababble.\n   * @defaultValue false\n   */\n  loop?: boolean;\n\n  /**\n   * When `true`, focus cannot escape the focus scope via keyboard,\n   * pointer, or a programmatic focus.\n   * @defaultValue false\n   */\n  trapped?: boolean;\n\n  /**\n   * Event handler called when auto-focusing on mount.\n   * Can be prevented.\n   */\n  onMountAutoFocus?: (event: Event) => void;\n\n  /**\n   * Event handler called when auto-focusing on unmount.\n   * Can be prevented.\n   */\n  onUnmountAutoFocus?: (event: Event) => void;\n}\n\nconst FocusScope = React.forwardRef<FocusScopeElement, FocusScopeProps>((props, forwardedRef) => {\n  const {\n    loop = false,\n    trapped = false,\n    onMountAutoFocus: onMountAutoFocusProp,\n    onUnmountAutoFocus: onUnmountAutoFocusProp,\n    ...scopeProps\n  } = props;\n  const [container, setContainer] = React.useState<HTMLElement | null>(null);\n  const onMountAutoFocus = useCallbackRef(onMountAutoFocusProp);\n  const onUnmountAutoFocus = useCallbackRef(onUnmountAutoFocusProp);\n  const lastFocusedElementRef = React.useRef<HTMLElement | null>(null);\n  const composedRefs = useComposedRefs(forwardedRef, (node) => setContainer(node));\n\n  const focusScope = React.useRef({\n    paused: false,\n    pause() {\n      this.paused = true;\n    },\n    resume() {\n      this.paused = false;\n    },\n  }).current;\n\n  // Takes care of trapping focus if focus is moved outside programmatically for example\n  React.useEffect(() => {\n    if (trapped) {\n      function handleFocusIn(event: FocusEvent) {\n        if (focusScope.paused || !container) return;\n        const target = event.target as HTMLElement | null;\n        if (container.contains(target)) {\n          lastFocusedElementRef.current = target;\n        } else {\n          focus(lastFocusedElementRef.current, { select: true });\n        }\n      }\n\n      function handleFocusOut(event: FocusEvent) {\n        if (focusScope.paused || !container) return;\n        const relatedTarget = event.relatedTarget as HTMLElement | null;\n\n        // A `focusout` event with a `null` `relatedTarget` will happen in at least two cases:\n        //\n        // 1. When the user switches app/tabs/windows/the browser itself loses focus.\n        // 2. In Google Chrome, when the focused element is removed from the DOM.\n        //\n        // We let the browser do its thing here because:\n        //\n        // 1. The browser already keeps a memory of what's focused for when the page gets refocused.\n        // 2. In Google Chrome, if we try to focus the deleted focused element (as per below), it\n        //    throws the CPU to 100%, so we avoid doing anything for this reason here too.\n        if (relatedTarget === null) return;\n\n        // If the focus has moved to an actual legitimate element (`relatedTarget !== null`)\n        // that is outside the container, we move focus to the last valid focused element inside.\n        if (!container.contains(relatedTarget)) {\n          focus(lastFocusedElementRef.current, { select: true });\n        }\n      }\n\n      // When the focused element gets removed from the DOM, browsers move focus\n      // back to the document.body. In this case, we move focus to the container\n      // to keep focus trapped correctly.\n      function handleMutations(mutations: MutationRecord[]) {\n        const focusedElement = document.activeElement as HTMLElement | null;\n        if (focusedElement !== document.body) return;\n        for (const mutation of mutations) {\n          if (mutation.removedNodes.length > 0) focus(container);\n        }\n      }\n\n      document.addEventListener('focusin', handleFocusIn);\n      document.addEventListener('focusout', handleFocusOut);\n      const mutationObserver = new MutationObserver(handleMutations);\n      if (container) mutationObserver.observe(container, { childList: true, subtree: true });\n\n      return () => {\n        document.removeEventListener('focusin', handleFocusIn);\n        document.removeEventListener('focusout', handleFocusOut);\n        mutationObserver.disconnect();\n      };\n    }\n  }, [trapped, container, focusScope.paused]);\n\n  React.useEffect(() => {\n    if (container) {\n      focusScopesStack.add(focusScope);\n      const previouslyFocusedElement = document.activeElement as HTMLElement | null;\n      const hasFocusedCandidate = container.contains(previouslyFocusedElement);\n\n      if (!hasFocusedCandidate) {\n        const mountEvent = new CustomEvent(AUTOFOCUS_ON_MOUNT, EVENT_OPTIONS);\n        container.addEventListener(AUTOFOCUS_ON_MOUNT, onMountAutoFocus);\n        container.dispatchEvent(mountEvent);\n        if (!mountEvent.defaultPrevented) {\n          focusFirst(removeLinks(getTabbableCandidates(container)), { select: true });\n          if (document.activeElement === previouslyFocusedElement) {\n            focus(container);\n          }\n        }\n      }\n\n      return () => {\n        container.removeEventListener(AUTOFOCUS_ON_MOUNT, onMountAutoFocus);\n\n        // We hit a react bug (fixed in v17) with focusing in unmount.\n        // We need to delay the focus a little to get around it for now.\n        // See: https://github.com/facebook/react/issues/17894\n        setTimeout(() => {\n          const unmountEvent = new CustomEvent(AUTOFOCUS_ON_UNMOUNT, EVENT_OPTIONS);\n          container.addEventListener(AUTOFOCUS_ON_UNMOUNT, onUnmountAutoFocus);\n          container.dispatchEvent(unmountEvent);\n          if (!unmountEvent.defaultPrevented) {\n            focus(previouslyFocusedElement ?? document.body, { select: true });\n          }\n          // we need to remove the listener after we `dispatchEvent`\n          container.removeEventListener(AUTOFOCUS_ON_UNMOUNT, onUnmountAutoFocus);\n\n          focusScopesStack.remove(focusScope);\n        }, 0);\n      };\n    }\n  }, [container, onMountAutoFocus, onUnmountAutoFocus, focusScope]);\n\n  // Takes care of looping focus (when tabbing whilst at the edges)\n  const handleKeyDown = React.useCallback(\n    (event: React.KeyboardEvent) => {\n      if (!loop && !trapped) return;\n      if (focusScope.paused) return;\n\n      const isTabKey = event.key === 'Tab' && !event.altKey && !event.ctrlKey && !event.metaKey;\n      const focusedElement = document.activeElement as HTMLElement | null;\n\n      if (isTabKey && focusedElement) {\n        const container = event.currentTarget as HTMLElement;\n        const [first, last] = getTabbableEdges(container);\n        const hasTabbableElementsInside = first && last;\n\n        // we can only wrap focus if we have tabbable edges\n        if (!hasTabbableElementsInside) {\n          if (focusedElement === container) event.preventDefault();\n        } else {\n          if (!event.shiftKey && focusedElement === last) {\n            event.preventDefault();\n            if (loop) focus(first, { select: true });\n          } else if (event.shiftKey && focusedElement === first) {\n            event.preventDefault();\n            if (loop) focus(last, { select: true });\n          }\n        }\n      }\n    },\n    [loop, trapped, focusScope.paused]\n  );\n\n  return (\n    <Primitive.div tabIndex={-1} {...scopeProps} ref={composedRefs} onKeyDown={handleKeyDown} />\n  );\n});\n\nFocusScope.displayName = FOCUS_SCOPE_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * Utils\n * -----------------------------------------------------------------------------------------------*/\n\n/**\n * Attempts focusing the first element in a list of candidates.\n * Stops when focus has actually moved.\n */\nfunction focusFirst(candidates: HTMLElement[], { select = false } = {}) {\n  const previouslyFocusedElement = document.activeElement;\n  for (const candidate of candidates) {\n    focus(candidate, { select });\n    if (document.activeElement !== previouslyFocusedElement) return;\n  }\n}\n\n/**\n * Returns the first and last tabbable elements inside a container.\n */\nfunction getTabbableEdges(container: HTMLElement) {\n  const candidates = getTabbableCandidates(container);\n  const first = findVisible(candidates, container);\n  const last = findVisible(candidates.reverse(), container);\n  return [first, last] as const;\n}\n\n/**\n * Returns a list of potential tabbable candidates.\n *\n * NOTE: This is only a close approximation. For example it doesn't take into account cases like when\n * elements are not visible. This cannot be worked out easily by just reading a property, but rather\n * necessitate runtime knowledge (computed styles, etc). We deal with these cases separately.\n *\n * See: https://developer.mozilla.org/en-US/docs/Web/API/TreeWalker\n * Credit: https://github.com/discord/focus-layers/blob/master/src/util/wrapFocus.tsx#L1\n */\nfunction getTabbableCandidates(container: HTMLElement) {\n  const nodes: HTMLElement[] = [];\n  const walker = document.createTreeWalker(container, NodeFilter.SHOW_ELEMENT, {\n    acceptNode: (node: any) => {\n      const isHiddenInput = node.tagName === 'INPUT' && node.type === 'hidden';\n      if (node.disabled || node.hidden || isHiddenInput) return NodeFilter.FILTER_SKIP;\n      // `.tabIndex` is not the same as the `tabindex` attribute. It works on the\n      // runtime's understanding of tabbability, so this automatically accounts\n      // for any kind of element that could be tabbed to.\n      return node.tabIndex >= 0 ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\n    },\n  });\n  while (walker.nextNode()) nodes.push(walker.currentNode as HTMLElement);\n  // we do not take into account the order of nodes with positive `tabIndex` as it\n  // hinders accessibility to have tab order different from visual order.\n  return nodes;\n}\n\n/**\n * Returns the first visible element in a list.\n * NOTE: Only checks visibility up to the `container`.\n */\nfunction findVisible(elements: HTMLElement[], container: HTMLElement) {\n  for (const element of elements) {\n    // we stop checking if it's hidden at the `container` level (excluding)\n    if (!isHidden(element, { upTo: container })) return element;\n  }\n}\n\nfunction isHidden(node: HTMLElement, { upTo }: { upTo?: HTMLElement }) {\n  if (getComputedStyle(node).visibility === 'hidden') return true;\n  while (node) {\n    // we stop at `upTo` (excluding it)\n    if (upTo !== undefined && node === upTo) return false;\n    if (getComputedStyle(node).display === 'none') return true;\n    node = node.parentElement as HTMLElement;\n  }\n  return false;\n}\n\nfunction isSelectableInput(element: any): element is FocusableTarget & { select: () => void } {\n  return element instanceof HTMLInputElement && 'select' in element;\n}\n\nfunction focus(element?: FocusableTarget | null, { select = false } = {}) {\n  // only focus if that element is focusable\n  if (element && element.focus) {\n    const previouslyFocusedElement = document.activeElement;\n    // NOTE: we prevent scrolling on focus, to minimize jarring transitions for users\n    element.focus({ preventScroll: true });\n    // only select if its not the same element, it supports selection and we need to select\n    if (element !== previouslyFocusedElement && isSelectableInput(element) && select)\n      element.select();\n  }\n}\n\n/* -------------------------------------------------------------------------------------------------\n * FocusScope stack\n * -----------------------------------------------------------------------------------------------*/\n\ntype FocusScopeAPI = { paused: boolean; pause(): void; resume(): void };\nconst focusScopesStack = createFocusScopesStack();\n\nfunction createFocusScopesStack() {\n  /** A stack of focus scopes, with the active one at the top */\n  let stack: FocusScopeAPI[] = [];\n\n  return {\n    add(focusScope: FocusScopeAPI) {\n      // pause the currently active focus scope (at the top of the stack)\n      const activeFocusScope = stack[0];\n      if (focusScope !== activeFocusScope) {\n        activeFocusScope?.pause();\n      }\n      // remove in case it already exists (because we'll re-add it at the top of the stack)\n      stack = arrayRemove(stack, focusScope);\n      stack.unshift(focusScope);\n    },\n\n    remove(focusScope: FocusScopeAPI) {\n      stack = arrayRemove(stack, focusScope);\n      stack[0]?.resume();\n    },\n  };\n}\n\nfunction arrayRemove<T>(array: T[], item: T) {\n  const updatedArray = [...array];\n  const index = updatedArray.indexOf(item);\n  if (index !== -1) {\n    updatedArray.splice(index, 1);\n  }\n  return updatedArray;\n}\n\nfunction removeLinks(items: HTMLElement[]) {\n  return items.filter((item) => item.tagName !== 'A');\n}\n\nconst Root = FocusScope;\n\nexport {\n  FocusScope,\n  //\n  Root,\n};\nexport type { FocusScopeProps };\n", "import * as React from 'react';\n\n/** Number of components which have requested interest to have focus guards */\nlet count = 0;\n\ninterface FocusGuardsProps {\n  children?: React.ReactNode;\n}\n\nfunction FocusGuards(props: FocusGuardsProps) {\n  useFocusGuards();\n  return props.children;\n}\n\n/**\n * Injects a pair of focus guards at the edges of the whole DOM tree\n * to ensure `focusin` & `focusout` events can be caught consistently.\n */\nfunction useFocusGuards() {\n  /* eslint-disable no-restricted-globals */\n  React.useEffect(() => {\n    const edgeGuards = document.querySelectorAll('[data-radix-focus-guard]');\n    document.body.insertAdjacentElement('afterbegin', edgeGuards[0] ?? createFocusGuard());\n    document.body.insertAdjacentElement('beforeend', edgeGuards[1] ?? createFocusGuard());\n    count++;\n\n    return () => {\n      if (count === 1) {\n        document.querySelectorAll('[data-radix-focus-guard]').forEach((node) => node.remove());\n      }\n      count--;\n    };\n  }, []);\n  /* eslint-enable no-restricted-globals */\n}\n\nfunction createFocusGuard() {\n  // eslint-disable-next-line no-restricted-globals\n  const element = document.createElement('span');\n  element.setAttribute('data-radix-focus-guard', '');\n  element.tabIndex = 0;\n  element.style.outline = 'none';\n  element.style.opacity = '0';\n  element.style.position = 'fixed';\n  element.style.pointerEvents = 'none';\n  return element;\n}\n\nexport {\n  FocusGuards,\n  //\n  FocusGuards as Root,\n  //\n  useFocusGuards,\n};\n", "/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n  return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\n  function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nvar ownKeys = function(o) {\n  ownKeys = Object.getOwnPropertyNames || function (o) {\n    var ar = [];\n    for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n    return ar;\n  };\n  return ownKeys(o);\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose, inner;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n      if (async) inner = dispose;\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  var r, s = 0;\n  function next() {\n    while (r = env.stack.pop()) {\n      try {\n        if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\n        if (r.dispose) {\n          var result = r.dispose.call(r.value);\n          if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n        }\n        else s |= 1;\n      }\n      catch (e) {\n        fail(e);\n      }\n    }\n    if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\n  if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n      return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n          return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n      });\n  }\n  return path;\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __esDecorate,\n  __runInitializers,\n  __propKey,\n  __setFunctionName,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n  __rewriteRelativeImportExtension,\n};\n", "import { __assign } from \"tslib\";\nimport * as React from 'react';\nimport { RemoveScroll } from './UI';\nimport SideCar from './sidecar';\nvar ReactRemoveScroll = React.forwardRef(function (props, ref) { return (React.createElement(RemoveScroll, __assign({}, props, { ref: ref, sideCar: SideCar }))); });\nReactRemoveScroll.classNames = RemoveScroll.classNames;\nexport default ReactRemoveScroll;\n", "import { __assign, __rest } from \"tslib\";\nimport * as React from 'react';\nimport { fullWidthClassName, zeroRightClassName } from 'react-remove-scroll-bar/constants';\nimport { useMergeRefs } from 'use-callback-ref';\nimport { effectCar } from './medium';\nvar nothing = function () {\n    return;\n};\n/**\n * Removes scrollbar from the page and contain the scroll within the Lock\n */\nvar RemoveScroll = React.forwardRef(function (props, parentRef) {\n    var ref = React.useRef(null);\n    var _a = React.useState({\n        onScrollCapture: nothing,\n        onWheelCapture: nothing,\n        onTouchMoveCapture: nothing,\n    }), callbacks = _a[0], setCallbacks = _a[1];\n    var forwardProps = props.forwardProps, children = props.children, className = props.className, removeScrollBar = props.removeScrollBar, enabled = props.enabled, shards = props.shards, sideCar = props.sideCar, noRelative = props.noRelative, noIsolation = props.noIsolation, inert = props.inert, allowPinchZoom = props.allowPinchZoom, _b = props.as, Container = _b === void 0 ? 'div' : _b, gapMode = props.gapMode, rest = __rest(props, [\"forwardProps\", \"children\", \"className\", \"removeScrollBar\", \"enabled\", \"shards\", \"sideCar\", \"noRelative\", \"noIsolation\", \"inert\", \"allowPinchZoom\", \"as\", \"gapMode\"]);\n    var SideCar = sideCar;\n    var containerRef = useMergeRefs([ref, parentRef]);\n    var containerProps = __assign(__assign({}, rest), callbacks);\n    return (React.createElement(React.Fragment, null,\n        enabled && (React.createElement(SideCar, { sideCar: effectCar, removeScrollBar: removeScrollBar, shards: shards, noRelative: noRelative, noIsolation: noIsolation, inert: inert, setCallbacks: setCallbacks, allowPinchZoom: !!allowPinchZoom, lockRef: ref, gapMode: gapMode })),\n        forwardProps ? (React.cloneElement(React.Children.only(children), __assign(__assign({}, containerProps), { ref: containerRef }))) : (React.createElement(Container, __assign({}, containerProps, { className: className, ref: containerRef }), children))));\n});\nRemoveScroll.defaultProps = {\n    enabled: true,\n    removeScrollBar: true,\n    inert: false,\n};\nRemoveScroll.classNames = {\n    fullWidth: fullWidthClassName,\n    zeroRight: zeroRightClassName,\n};\nexport { RemoveScroll };\n", "export var zeroRightClassName = 'right-scroll-bar-position';\nexport var fullWidthClassName = 'width-before-scroll-bar';\nexport var noScrollbarsClassName = 'with-scroll-bars-hidden';\n/**\n * Name of a CSS variable containing the amount of \"hidden\" scrollbar\n * ! might be undefined ! use will fallback!\n */\nexport var removedBarSizeVariable = '--removed-body-scroll-bar-size';\n", "/**\n * Assigns a value for a given ref, no matter of the ref format\n * @param {RefObject} ref - a callback function or ref object\n * @param value - a new value\n *\n * @see https://github.com/theKashey/use-callback-ref#assignref\n * @example\n * const refObject = useRef();\n * const refFn = (ref) => {....}\n *\n * assignRef(refObject, \"refValue\");\n * assignRef(refFn, \"refValue\");\n */\nexport function assignRef(ref, value) {\n    if (typeof ref === 'function') {\n        ref(value);\n    }\n    else if (ref) {\n        ref.current = value;\n    }\n    return ref;\n}\n", "import { useState } from 'react';\n/**\n * creates a MutableRef with ref change callback\n * @param initialValue - initial ref value\n * @param {Function} callback - a callback to run when value changes\n *\n * @example\n * const ref = useCallbackRef(0, (newValue, oldValue) => console.log(oldValue, '->', newValue);\n * ref.current = 1;\n * // prints 0 -> 1\n *\n * @see https://reactjs.org/docs/hooks-reference.html#useref\n * @see https://github.com/theKashey/use-callback-ref#usecallbackref---to-replace-reactuseref\n * @returns {MutableRefObject}\n */\nexport function useCallbackRef(initialValue, callback) {\n    var ref = useState(function () { return ({\n        // value\n        value: initialValue,\n        // last callback\n        callback: callback,\n        // \"memoized\" public interface\n        facade: {\n            get current() {\n                return ref.value;\n            },\n            set current(value) {\n                var last = ref.value;\n                if (last !== value) {\n                    ref.value = value;\n                    ref.callback(value, last);\n                }\n            },\n        },\n    }); })[0];\n    // update callback\n    ref.callback = callback;\n    return ref.facade;\n}\n", "import * as React from 'react';\nimport { assignRef } from './assignRef';\nimport { useCallbackRef } from './useRef';\nvar useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\nvar currentValues = new WeakMap();\n/**\n * Merges two or more refs together providing a single interface to set their value\n * @param {RefObject|Ref} refs\n * @returns {MutableRefObject} - a new ref, which translates all changes to {refs}\n *\n * @see {@link mergeRefs} a version without buit-in memoization\n * @see https://github.com/theKashey/use-callback-ref#usemergerefs\n * @example\n * const Component = React.forwardRef((props, ref) => {\n *   const ownRef = useRef();\n *   const domRef = useMergeRefs([ref, ownRef]); //  merge together\n *   return <div ref={domRef}>...</div>\n * }\n */\nexport function useMergeRefs(refs, defaultValue) {\n    var callbackRef = useCallbackRef(defaultValue || null, function (newValue) {\n        return refs.forEach(function (ref) { return assignRef(ref, newValue); });\n    });\n    // handle refs changes - added or removed\n    useIsomorphicLayoutEffect(function () {\n        var oldValue = currentValues.get(callbackRef);\n        if (oldValue) {\n            var prevRefs_1 = new Set(oldValue);\n            var nextRefs_1 = new Set(refs);\n            var current_1 = callbackRef.current;\n            prevRefs_1.forEach(function (ref) {\n                if (!nextRefs_1.has(ref)) {\n                    assignRef(ref, null);\n                }\n            });\n            nextRefs_1.forEach(function (ref) {\n                if (!prevRefs_1.has(ref)) {\n                    assignRef(ref, current_1);\n                }\n            });\n        }\n        currentValues.set(callbackRef, refs);\n    }, [refs]);\n    return callbackRef;\n}\n", "import { __assign } from \"tslib\";\nimport * as React from 'react';\nimport { useSidecar } from './hook';\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function sidecar(importer, errorComponent) {\n    var ErrorCase = function () { return errorComponent; };\n    return function Sidecar(props) {\n        var _a = useSidecar(importer, props.sideCar), Car = _a[0], error = _a[1];\n        if (error && errorComponent) {\n            return ErrorCase;\n        }\n        // @ts-expect-error type shenanigans\n        return Car ? React.createElement(Car, __assign({}, props)) : null;\n    };\n}\n", "import { useState, useEffect } from 'react';\nimport { env } from './env';\nvar cache = new WeakMap();\nvar NO_OPTIONS = {};\nexport function useSidecar(importer, effect) {\n    var options = (effect && effect.options) || NO_OPTIONS;\n    if (env.isNode && !options.ssr) {\n        return [null, null];\n    }\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    return useRealSidecar(importer, effect);\n}\nfunction useRealSidecar(importer, effect) {\n    var options = (effect && effect.options) || NO_OPTIONS;\n    var couldUseCache = env.forceCache || (env.isNode && !!options.ssr) || !options.async;\n    var _a = useState(couldUseCache ? function () { return cache.get(importer); } : undefined), Car = _a[0], setCar = _a[1];\n    var _b = useState(null), error = _b[0], setError = _b[1];\n    useEffect(function () {\n        if (!Car) {\n            importer().then(function (car) {\n                var resolved = effect ? effect.read() : car.default || car;\n                if (!resolved) {\n                    console.error('Sidecar error: with importer', importer);\n                    var error_1;\n                    if (effect) {\n                        console.error('Sidecar error: with medium', effect);\n                        error_1 = new Error('Sidecar medium was not found');\n                    }\n                    else {\n                        error_1 = new Error('Sidecar was not found in exports');\n                    }\n                    setError(function () { return error_1; });\n                    throw error_1;\n                }\n                cache.set(importer, resolved);\n                setCar(function () { return resolved; });\n            }, function (e) { return setError(function () { return e; }); });\n        }\n    }, []);\n    return [Car, error];\n}\n", "import { __assign } from \"tslib\";\nfunction ItoI(a) {\n    return a;\n}\nfunction innerCreateMedium(defaults, middleware) {\n    if (middleware === void 0) { middleware = ItoI; }\n    var buffer = [];\n    var assigned = false;\n    var medium = {\n        read: function () {\n            if (assigned) {\n                throw new Error('Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.');\n            }\n            if (buffer.length) {\n                return buffer[buffer.length - 1];\n            }\n            return defaults;\n        },\n        useMedium: function (data) {\n            var item = middleware(data, assigned);\n            buffer.push(item);\n            return function () {\n                buffer = buffer.filter(function (x) { return x !== item; });\n            };\n        },\n        assignSyncMedium: function (cb) {\n            assigned = true;\n            while (buffer.length) {\n                var cbs = buffer;\n                buffer = [];\n                cbs.forEach(cb);\n            }\n            buffer = {\n                push: function (x) { return cb(x); },\n                filter: function () { return buffer; },\n            };\n        },\n        assignMedium: function (cb) {\n            assigned = true;\n            var pendingQueue = [];\n            if (buffer.length) {\n                var cbs = buffer;\n                buffer = [];\n                cbs.forEach(cb);\n                pendingQueue = buffer;\n            }\n            var executeQueue = function () {\n                var cbs = pendingQueue;\n                pendingQueue = [];\n                cbs.forEach(cb);\n            };\n            var cycle = function () { return Promise.resolve().then(executeQueue); };\n            cycle();\n            buffer = {\n                push: function (x) {\n                    pendingQueue.push(x);\n                    cycle();\n                },\n                filter: function (filter) {\n                    pendingQueue = pendingQueue.filter(filter);\n                    return buffer;\n                },\n            };\n        },\n    };\n    return medium;\n}\nexport function createMedium(defaults, middleware) {\n    if (middleware === void 0) { middleware = ItoI; }\n    return innerCreateMedium(defaults, middleware);\n}\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function createSidecarMedium(options) {\n    if (options === void 0) { options = {}; }\n    var medium = innerCreateMedium(null);\n    medium.options = __assign({ async: true, ssr: false }, options);\n    return medium;\n}\n", "import { __assign } from \"tslib\";\nimport * as React from 'react';\nimport { useState, useCallback, useEffect, useLayoutEffect } from 'react';\nexport function renderCar(WrappedComponent, defaults) {\n    function State(_a) {\n        var stateRef = _a.stateRef, props = _a.props;\n        var renderTarget = useCallback(function SideTarget() {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            useLayoutEffect(function () {\n                stateRef.current(args);\n            });\n            return null;\n        }, []);\n        // @ts-ignore\n        return React.createElement(WrappedComponent, __assign({}, props, { children: renderTarget }));\n    }\n    var Children = React.memo(function (_a) {\n        var stateRef = _a.stateRef, defaultState = _a.defaultState, children = _a.children;\n        var _b = useState(defaultState.current), state = _b[0], setState = _b[1];\n        useEffect(function () {\n            stateRef.current = setState;\n        }, []);\n        return children.apply(void 0, state);\n    }, function () { return true; });\n    return function Combiner(props) {\n        var defaultState = React.useRef(defaults(props));\n        var ref = React.useRef(function (state) { return (defaultState.current = state); });\n        return (React.createElement(React.Fragment, null,\n            React.createElement(State, { stateRef: ref, props: props }),\n            React.createElement(Children, { stateRef: ref, defaultState: defaultState, children: props.children })));\n    };\n}\n", "import { __assign, __rest } from \"tslib\";\nimport * as React from 'react';\nvar SideCar = function (_a) {\n    var sideCar = _a.sideCar, rest = __rest(_a, [\"sideCar\"]);\n    if (!sideCar) {\n        throw new Error('Sidecar: please provide `sideCar` property to import the right car');\n    }\n    var Target = sideCar.read();\n    if (!Target) {\n        throw new Error('Sidecar medium not found');\n    }\n    return React.createElement(Target, __assign({}, rest));\n};\nSideCar.isSideCarExport = true;\nexport function exportSidecar(medium, exported) {\n    medium.useMedium(exported);\n    return SideCar;\n}\n", "import { createSidecarMedium } from 'use-sidecar';\nexport var effectCar = createSidecarMedium();\n", "import { __spreadArray } from \"tslib\";\nimport * as React from 'react';\nimport { RemoveScrollBar } from 'react-remove-scroll-bar';\nimport { styleSingleton } from 'react-style-singleton';\nimport { nonPassive } from './aggresiveCapture';\nimport { handleScroll, locationCouldBeScrolled } from './handleScroll';\nexport var getTouchXY = function (event) {\n    return 'changedTouches' in event ? [event.changedTouches[0].clientX, event.changedTouches[0].clientY] : [0, 0];\n};\nexport var getDeltaXY = function (event) { return [event.deltaX, event.deltaY]; };\nvar extractRef = function (ref) {\n    return ref && 'current' in ref ? ref.current : ref;\n};\nvar deltaCompare = function (x, y) { return x[0] === y[0] && x[1] === y[1]; };\nvar generateStyle = function (id) { return \"\\n  .block-interactivity-\".concat(id, \" {pointer-events: none;}\\n  .allow-interactivity-\").concat(id, \" {pointer-events: all;}\\n\"); };\nvar idCounter = 0;\nvar lockStack = [];\nexport function RemoveScrollSideCar(props) {\n    var shouldPreventQueue = React.useRef([]);\n    var touchStartRef = React.useRef([0, 0]);\n    var activeAxis = React.useRef();\n    var id = React.useState(idCounter++)[0];\n    var Style = React.useState(styleSingleton)[0];\n    var lastProps = React.useRef(props);\n    React.useEffect(function () {\n        lastProps.current = props;\n    }, [props]);\n    React.useEffect(function () {\n        if (props.inert) {\n            document.body.classList.add(\"block-interactivity-\".concat(id));\n            var allow_1 = __spreadArray([props.lockRef.current], (props.shards || []).map(extractRef), true).filter(Boolean);\n            allow_1.forEach(function (el) { return el.classList.add(\"allow-interactivity-\".concat(id)); });\n            return function () {\n                document.body.classList.remove(\"block-interactivity-\".concat(id));\n                allow_1.forEach(function (el) { return el.classList.remove(\"allow-interactivity-\".concat(id)); });\n            };\n        }\n        return;\n    }, [props.inert, props.lockRef.current, props.shards]);\n    var shouldCancelEvent = React.useCallback(function (event, parent) {\n        if (('touches' in event && event.touches.length === 2) || (event.type === 'wheel' && event.ctrlKey)) {\n            return !lastProps.current.allowPinchZoom;\n        }\n        var touch = getTouchXY(event);\n        var touchStart = touchStartRef.current;\n        var deltaX = 'deltaX' in event ? event.deltaX : touchStart[0] - touch[0];\n        var deltaY = 'deltaY' in event ? event.deltaY : touchStart[1] - touch[1];\n        var currentAxis;\n        var target = event.target;\n        var moveDirection = Math.abs(deltaX) > Math.abs(deltaY) ? 'h' : 'v';\n        // allow horizontal touch move on Range inputs. They will not cause any scroll\n        if ('touches' in event && moveDirection === 'h' && target.type === 'range') {\n            return false;\n        }\n        var canBeScrolledInMainDirection = locationCouldBeScrolled(moveDirection, target);\n        if (!canBeScrolledInMainDirection) {\n            return true;\n        }\n        if (canBeScrolledInMainDirection) {\n            currentAxis = moveDirection;\n        }\n        else {\n            currentAxis = moveDirection === 'v' ? 'h' : 'v';\n            canBeScrolledInMainDirection = locationCouldBeScrolled(moveDirection, target);\n            // other axis might be not scrollable\n        }\n        if (!canBeScrolledInMainDirection) {\n            return false;\n        }\n        if (!activeAxis.current && 'changedTouches' in event && (deltaX || deltaY)) {\n            activeAxis.current = currentAxis;\n        }\n        if (!currentAxis) {\n            return true;\n        }\n        var cancelingAxis = activeAxis.current || currentAxis;\n        return handleScroll(cancelingAxis, parent, event, cancelingAxis === 'h' ? deltaX : deltaY, true);\n    }, []);\n    var shouldPrevent = React.useCallback(function (_event) {\n        var event = _event;\n        if (!lockStack.length || lockStack[lockStack.length - 1] !== Style) {\n            // not the last active\n            return;\n        }\n        var delta = 'deltaY' in event ? getDeltaXY(event) : getTouchXY(event);\n        var sourceEvent = shouldPreventQueue.current.filter(function (e) { return e.name === event.type && (e.target === event.target || event.target === e.shadowParent) && deltaCompare(e.delta, delta); })[0];\n        // self event, and should be canceled\n        if (sourceEvent && sourceEvent.should) {\n            if (event.cancelable) {\n                event.preventDefault();\n            }\n            return;\n        }\n        // outside or shard event\n        if (!sourceEvent) {\n            var shardNodes = (lastProps.current.shards || [])\n                .map(extractRef)\n                .filter(Boolean)\n                .filter(function (node) { return node.contains(event.target); });\n            var shouldStop = shardNodes.length > 0 ? shouldCancelEvent(event, shardNodes[0]) : !lastProps.current.noIsolation;\n            if (shouldStop) {\n                if (event.cancelable) {\n                    event.preventDefault();\n                }\n            }\n        }\n    }, []);\n    var shouldCancel = React.useCallback(function (name, delta, target, should) {\n        var event = { name: name, delta: delta, target: target, should: should, shadowParent: getOutermostShadowParent(target) };\n        shouldPreventQueue.current.push(event);\n        setTimeout(function () {\n            shouldPreventQueue.current = shouldPreventQueue.current.filter(function (e) { return e !== event; });\n        }, 1);\n    }, []);\n    var scrollTouchStart = React.useCallback(function (event) {\n        touchStartRef.current = getTouchXY(event);\n        activeAxis.current = undefined;\n    }, []);\n    var scrollWheel = React.useCallback(function (event) {\n        shouldCancel(event.type, getDeltaXY(event), event.target, shouldCancelEvent(event, props.lockRef.current));\n    }, []);\n    var scrollTouchMove = React.useCallback(function (event) {\n        shouldCancel(event.type, getTouchXY(event), event.target, shouldCancelEvent(event, props.lockRef.current));\n    }, []);\n    React.useEffect(function () {\n        lockStack.push(Style);\n        props.setCallbacks({\n            onScrollCapture: scrollWheel,\n            onWheelCapture: scrollWheel,\n            onTouchMoveCapture: scrollTouchMove,\n        });\n        document.addEventListener('wheel', shouldPrevent, nonPassive);\n        document.addEventListener('touchmove', shouldPrevent, nonPassive);\n        document.addEventListener('touchstart', scrollTouchStart, nonPassive);\n        return function () {\n            lockStack = lockStack.filter(function (inst) { return inst !== Style; });\n            document.removeEventListener('wheel', shouldPrevent, nonPassive);\n            document.removeEventListener('touchmove', shouldPrevent, nonPassive);\n            document.removeEventListener('touchstart', scrollTouchStart, nonPassive);\n        };\n    }, []);\n    var removeScrollBar = props.removeScrollBar, inert = props.inert;\n    return (React.createElement(React.Fragment, null,\n        inert ? React.createElement(Style, { styles: generateStyle(id) }) : null,\n        removeScrollBar ? React.createElement(RemoveScrollBar, { noRelative: props.noRelative, gapMode: props.gapMode }) : null));\n}\nfunction getOutermostShadowParent(node) {\n    var shadowParent = null;\n    while (node !== null) {\n        if (node instanceof ShadowRoot) {\n            shadowParent = node.host;\n            node = node.host;\n        }\n        node = node.parentNode;\n    }\n    return shadowParent;\n}\n", "import * as React from 'react';\nimport { styleSingleton } from 'react-style-singleton';\nimport { fullWidthClassName, zeroRightClassName, noScrollbarsClassName, removedBarSizeVariable } from './constants';\nimport { getGapWidth } from './utils';\nvar Style = styleSingleton();\nexport var lockAttribute = 'data-scroll-locked';\n// important tip - once we measure scrollBar width and remove them\n// we could not repeat this operation\n// thus we are using style-singleton - only the first \"yet correct\" style will be applied.\nvar getStyles = function (_a, allowRelative, gapMode, important) {\n    var left = _a.left, top = _a.top, right = _a.right, gap = _a.gap;\n    if (gapMode === void 0) { gapMode = 'margin'; }\n    return \"\\n  .\".concat(noScrollbarsClassName, \" {\\n   overflow: hidden \").concat(important, \";\\n   padding-right: \").concat(gap, \"px \").concat(important, \";\\n  }\\n  body[\").concat(lockAttribute, \"] {\\n    overflow: hidden \").concat(important, \";\\n    overscroll-behavior: contain;\\n    \").concat([\n        allowRelative && \"position: relative \".concat(important, \";\"),\n        gapMode === 'margin' &&\n            \"\\n    padding-left: \".concat(left, \"px;\\n    padding-top: \").concat(top, \"px;\\n    padding-right: \").concat(right, \"px;\\n    margin-left:0;\\n    margin-top:0;\\n    margin-right: \").concat(gap, \"px \").concat(important, \";\\n    \"),\n        gapMode === 'padding' && \"padding-right: \".concat(gap, \"px \").concat(important, \";\"),\n    ]\n        .filter(Boolean)\n        .join(''), \"\\n  }\\n  \\n  .\").concat(zeroRightClassName, \" {\\n    right: \").concat(gap, \"px \").concat(important, \";\\n  }\\n  \\n  .\").concat(fullWidthClassName, \" {\\n    margin-right: \").concat(gap, \"px \").concat(important, \";\\n  }\\n  \\n  .\").concat(zeroRightClassName, \" .\").concat(zeroRightClassName, \" {\\n    right: 0 \").concat(important, \";\\n  }\\n  \\n  .\").concat(fullWidthClassName, \" .\").concat(fullWidthClassName, \" {\\n    margin-right: 0 \").concat(important, \";\\n  }\\n  \\n  body[\").concat(lockAttribute, \"] {\\n    \").concat(removedBarSizeVariable, \": \").concat(gap, \"px;\\n  }\\n\");\n};\nvar getCurrentUseCounter = function () {\n    var counter = parseInt(document.body.getAttribute(lockAttribute) || '0', 10);\n    return isFinite(counter) ? counter : 0;\n};\nexport var useLockAttribute = function () {\n    React.useEffect(function () {\n        document.body.setAttribute(lockAttribute, (getCurrentUseCounter() + 1).toString());\n        return function () {\n            var newCounter = getCurrentUseCounter() - 1;\n            if (newCounter <= 0) {\n                document.body.removeAttribute(lockAttribute);\n            }\n            else {\n                document.body.setAttribute(lockAttribute, newCounter.toString());\n            }\n        };\n    }, []);\n};\n/**\n * Removes page scrollbar and blocks page scroll when mounted\n */\nexport var RemoveScrollBar = function (_a) {\n    var noRelative = _a.noRelative, noImportant = _a.noImportant, _b = _a.gapMode, gapMode = _b === void 0 ? 'margin' : _b;\n    useLockAttribute();\n    /*\n     gap will be measured on every component mount\n     however it will be used only by the \"first\" invocation\n     due to singleton nature of <Style\n     */\n    var gap = React.useMemo(function () { return getGapWidth(gapMode); }, [gapMode]);\n    return React.createElement(Style, { styles: getStyles(gap, !noRelative, gapMode, !noImportant ? '!important' : '') });\n};\n", "import * as React from 'react';\nimport { stylesheetSingleton } from './singleton';\n/**\n * creates a hook to control style singleton\n * @see {@link styleSingleton} for a safer component version\n * @example\n * ```tsx\n * const useStyle = styleHookSingleton();\n * ///\n * useStyle('body { overflow: hidden}');\n */\nexport var styleHookSingleton = function () {\n    var sheet = stylesheetSingleton();\n    return function (styles, isDynamic) {\n        React.useEffect(function () {\n            sheet.add(styles);\n            return function () {\n                sheet.remove();\n            };\n        }, [styles && isDynamic]);\n    };\n};\n", "var currentNonce;\nexport var setNonce = function (nonce) {\n    currentNonce = nonce;\n};\nexport var getNonce = function () {\n    if (currentNonce) {\n        return currentNonce;\n    }\n    if (typeof __webpack_nonce__ !== 'undefined') {\n        return __webpack_nonce__;\n    }\n    return undefined;\n};\n", "import { getNonce } from 'get-nonce';\nfunction makeStyleTag() {\n    if (!document)\n        return null;\n    var tag = document.createElement('style');\n    tag.type = 'text/css';\n    var nonce = getNonce();\n    if (nonce) {\n        tag.setAttribute('nonce', nonce);\n    }\n    return tag;\n}\nfunction injectStyles(tag, css) {\n    // @ts-ignore\n    if (tag.styleSheet) {\n        // @ts-ignore\n        tag.styleSheet.cssText = css;\n    }\n    else {\n        tag.appendChild(document.createTextNode(css));\n    }\n}\nfunction insertStyleTag(tag) {\n    var head = document.head || document.getElementsByTagName('head')[0];\n    head.appendChild(tag);\n}\nexport var stylesheetSingleton = function () {\n    var counter = 0;\n    var stylesheet = null;\n    return {\n        add: function (style) {\n            if (counter == 0) {\n                if ((stylesheet = makeStyleTag())) {\n                    injectStyles(stylesheet, style);\n                    insertStyleTag(stylesheet);\n                }\n            }\n            counter++;\n        },\n        remove: function () {\n            counter--;\n            if (!counter && stylesheet) {\n                stylesheet.parentNode && stylesheet.parentNode.removeChild(stylesheet);\n                stylesheet = null;\n            }\n        },\n    };\n};\n", "import { styleHookSingleton } from './hook';\n/**\n * create a Component to add styles on demand\n * - styles are added when first instance is mounted\n * - styles are removed when the last instance is unmounted\n * - changing styles in runtime does nothing unless dynamic is set. But with multiple components that can lead to the undefined behavior\n */\nexport var styleSingleton = function () {\n    var useStyle = styleHookSingleton();\n    var Sheet = function (_a) {\n        var styles = _a.styles, dynamic = _a.dynamic;\n        useStyle(styles, dynamic);\n        return null;\n    };\n    return Sheet;\n};\n", "export var zeroGap = {\n    left: 0,\n    top: 0,\n    right: 0,\n    gap: 0,\n};\nvar parse = function (x) { return parseInt(x || '', 10) || 0; };\nvar getOffset = function (gapMode) {\n    var cs = window.getComputedStyle(document.body);\n    var left = cs[gapMode === 'padding' ? 'paddingLeft' : 'marginLeft'];\n    var top = cs[gapMode === 'padding' ? 'paddingTop' : 'marginTop'];\n    var right = cs[gapMode === 'padding' ? 'paddingRight' : 'marginRight'];\n    return [parse(left), parse(top), parse(right)];\n};\nexport var getGapWidth = function (gapMode) {\n    if (gapMode === void 0) { gapMode = 'margin'; }\n    if (typeof window === 'undefined') {\n        return zeroGap;\n    }\n    var offsets = getOffset(gapMode);\n    var documentWidth = document.documentElement.clientWidth;\n    var windowWidth = window.innerWidth;\n    return {\n        left: offsets[0],\n        top: offsets[1],\n        right: offsets[2],\n        gap: Math.max(0, windowWidth - documentWidth + offsets[2] - offsets[0]),\n    };\n};\n", "var passiveSupported = false;\nif (typeof window !== 'undefined') {\n    try {\n        var options = Object.defineProperty({}, 'passive', {\n            get: function () {\n                passiveSupported = true;\n                return true;\n            },\n        });\n        // @ts-ignore\n        window.addEventListener('test', options, options);\n        // @ts-ignore\n        window.removeEventListener('test', options, options);\n    }\n    catch (err) {\n        passiveSupported = false;\n    }\n}\nexport var nonPassive = passiveSupported ? { passive: false } : false;\n", "var alwaysContainsScroll = function (node) {\n    // textarea will always _contain_ scroll inside self. It only can be hidden\n    return node.tagName === 'TEXTAREA';\n};\nvar elementCanBeScrolled = function (node, overflow) {\n    if (!(node instanceof Element)) {\n        return false;\n    }\n    var styles = window.getComputedStyle(node);\n    return (\n    // not-not-scrollable\n    styles[overflow] !== 'hidden' &&\n        // contains scroll inside self\n        !(styles.overflowY === styles.overflowX && !alwaysContainsScroll(node) && styles[overflow] === 'visible'));\n};\nvar elementCouldBeVScrolled = function (node) { return elementCanBeScrolled(node, 'overflowY'); };\nvar elementCouldBeHScrolled = function (node) { return elementCanBeScrolled(node, 'overflowX'); };\nexport var locationCouldBeScrolled = function (axis, node) {\n    var ownerDocument = node.ownerDocument;\n    var current = node;\n    do {\n        // Skip over shadow root\n        if (typeof ShadowRoot !== 'undefined' && current instanceof ShadowRoot) {\n            current = current.host;\n        }\n        var isScrollable = elementCouldBeScrolled(axis, current);\n        if (isScrollable) {\n            var _a = getScrollVariables(axis, current), scrollHeight = _a[1], clientHeight = _a[2];\n            if (scrollHeight > clientHeight) {\n                return true;\n            }\n        }\n        current = current.parentNode;\n    } while (current && current !== ownerDocument.body);\n    return false;\n};\nvar getVScrollVariables = function (_a) {\n    var scrollTop = _a.scrollTop, scrollHeight = _a.scrollHeight, clientHeight = _a.clientHeight;\n    return [\n        scrollTop,\n        scrollHeight,\n        clientHeight,\n    ];\n};\nvar getHScrollVariables = function (_a) {\n    var scrollLeft = _a.scrollLeft, scrollWidth = _a.scrollWidth, clientWidth = _a.clientWidth;\n    return [\n        scrollLeft,\n        scrollWidth,\n        clientWidth,\n    ];\n};\nvar elementCouldBeScrolled = function (axis, node) {\n    return axis === 'v' ? elementCouldBeVScrolled(node) : elementCouldBeHScrolled(node);\n};\nvar getScrollVariables = function (axis, node) {\n    return axis === 'v' ? getVScrollVariables(node) : getHScrollVariables(node);\n};\nvar getDirectionFactor = function (axis, direction) {\n    /**\n     * If the element's direction is rtl (right-to-left), then scrollLeft is 0 when the scrollbar is at its rightmost position,\n     * and then increasingly negative as you scroll towards the end of the content.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollLeft\n     */\n    return axis === 'h' && direction === 'rtl' ? -1 : 1;\n};\nexport var handleScroll = function (axis, endTarget, event, sourceDelta, noOverscroll) {\n    var directionFactor = getDirectionFactor(axis, window.getComputedStyle(endTarget).direction);\n    var delta = directionFactor * sourceDelta;\n    // find scrollable target\n    var target = event.target;\n    var targetInLock = endTarget.contains(target);\n    var shouldCancelScroll = false;\n    var isDeltaPositive = delta > 0;\n    var availableScroll = 0;\n    var availableScrollTop = 0;\n    do {\n        if (!target) {\n            break;\n        }\n        var _a = getScrollVariables(axis, target), position = _a[0], scroll_1 = _a[1], capacity = _a[2];\n        var elementScroll = scroll_1 - capacity - directionFactor * position;\n        if (position || elementScroll) {\n            if (elementCouldBeScrolled(axis, target)) {\n                availableScroll += elementScroll;\n                availableScrollTop += position;\n            }\n        }\n        var parent_1 = target.parentNode;\n        // we will \"bubble\" from ShadowDom in case we are, or just to the parent in normal case\n        // this is the same logic used in focus-lock\n        target = (parent_1 && parent_1.nodeType === Node.DOCUMENT_FRAGMENT_NODE ? parent_1.host : parent_1);\n    } while (\n    // portaled content\n    (!targetInLock && target !== document.body) ||\n        // self content\n        (targetInLock && (endTarget.contains(target) || endTarget === target)));\n    // handle epsilon around 0 (non standard zoom levels)\n    if (isDeltaPositive &&\n        ((noOverscroll && Math.abs(availableScroll) < 1) || (!noOverscroll && delta > availableScroll))) {\n        shouldCancelScroll = true;\n    }\n    else if (!isDeltaPositive &&\n        ((noOverscroll && Math.abs(availableScrollTop) < 1) || (!noOverscroll && -delta > availableScrollTop))) {\n        shouldCancelScroll = true;\n    }\n    return shouldCancelScroll;\n};\n", "import { exportSidecar } from 'use-sidecar';\nimport { RemoveScrollSideCar } from './SideEffect';\nimport { effectCar } from './medium';\nexport default exportSidecar(effectCar, RemoveScrollSideCar);\n", "var getDefaultParent = function (originalTarget) {\n    if (typeof document === 'undefined') {\n        return null;\n    }\n    var sampleTarget = Array.isArray(originalTarget) ? originalTarget[0] : originalTarget;\n    return sampleTarget.ownerDocument.body;\n};\nvar counterMap = new WeakMap();\nvar uncontrolledNodes = new WeakMap();\nvar markerMap = {};\nvar lockCount = 0;\nvar unwrapHost = function (node) {\n    return node && (node.host || unwrapHost(node.parentNode));\n};\nvar correctTargets = function (parent, targets) {\n    return targets\n        .map(function (target) {\n        if (parent.contains(target)) {\n            return target;\n        }\n        var correctedTarget = unwrapHost(target);\n        if (correctedTarget && parent.contains(correctedTarget)) {\n            return correctedTarget;\n        }\n        console.error('aria-hidden', target, 'in not contained inside', parent, '. Doing nothing');\n        return null;\n    })\n        .filter(function (x) { return Boolean(x); });\n};\n/**\n * Marks everything except given node(or nodes) as aria-hidden\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @param {String} [controlAttribute] - html Attribute to control\n * @return {Undo} undo command\n */\nvar applyAttributeToOthers = function (originalTarget, parentNode, markerName, controlAttribute) {\n    var targets = correctTargets(parentNode, Array.isArray(originalTarget) ? originalTarget : [originalTarget]);\n    if (!markerMap[markerName]) {\n        markerMap[markerName] = new WeakMap();\n    }\n    var markerCounter = markerMap[markerName];\n    var hiddenNodes = [];\n    var elementsToKeep = new Set();\n    var elementsToStop = new Set(targets);\n    var keep = function (el) {\n        if (!el || elementsToKeep.has(el)) {\n            return;\n        }\n        elementsToKeep.add(el);\n        keep(el.parentNode);\n    };\n    targets.forEach(keep);\n    var deep = function (parent) {\n        if (!parent || elementsToStop.has(parent)) {\n            return;\n        }\n        Array.prototype.forEach.call(parent.children, function (node) {\n            if (elementsToKeep.has(node)) {\n                deep(node);\n            }\n            else {\n                try {\n                    var attr = node.getAttribute(controlAttribute);\n                    var alreadyHidden = attr !== null && attr !== 'false';\n                    var counterValue = (counterMap.get(node) || 0) + 1;\n                    var markerValue = (markerCounter.get(node) || 0) + 1;\n                    counterMap.set(node, counterValue);\n                    markerCounter.set(node, markerValue);\n                    hiddenNodes.push(node);\n                    if (counterValue === 1 && alreadyHidden) {\n                        uncontrolledNodes.set(node, true);\n                    }\n                    if (markerValue === 1) {\n                        node.setAttribute(markerName, 'true');\n                    }\n                    if (!alreadyHidden) {\n                        node.setAttribute(controlAttribute, 'true');\n                    }\n                }\n                catch (e) {\n                    console.error('aria-hidden: cannot operate on ', node, e);\n                }\n            }\n        });\n    };\n    deep(parentNode);\n    elementsToKeep.clear();\n    lockCount++;\n    return function () {\n        hiddenNodes.forEach(function (node) {\n            var counterValue = counterMap.get(node) - 1;\n            var markerValue = markerCounter.get(node) - 1;\n            counterMap.set(node, counterValue);\n            markerCounter.set(node, markerValue);\n            if (!counterValue) {\n                if (!uncontrolledNodes.has(node)) {\n                    node.removeAttribute(controlAttribute);\n                }\n                uncontrolledNodes.delete(node);\n            }\n            if (!markerValue) {\n                node.removeAttribute(markerName);\n            }\n        });\n        lockCount--;\n        if (!lockCount) {\n            // clear\n            counterMap = new WeakMap();\n            counterMap = new WeakMap();\n            uncontrolledNodes = new WeakMap();\n            markerMap = {};\n        }\n    };\n};\n/**\n * Marks everything except given node(or nodes) as aria-hidden\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @return {Undo} undo command\n */\nexport var hideOthers = function (originalTarget, parentNode, markerName) {\n    if (markerName === void 0) { markerName = 'data-aria-hidden'; }\n    var targets = Array.from(Array.isArray(originalTarget) ? originalTarget : [originalTarget]);\n    var activeParentNode = parentNode || getDefaultParent(originalTarget);\n    if (!activeParentNode) {\n        return function () { return null; };\n    }\n    // we should not hide aria-live elements - https://github.com/theKashey/aria-hidden/issues/10\n    // and script elements, as they have no impact on accessibility.\n    targets.push.apply(targets, Array.from(activeParentNode.querySelectorAll('[aria-live], script')));\n    return applyAttributeToOthers(targets, activeParentNode, markerName, 'aria-hidden');\n};\n/**\n * Marks everything except given node(or nodes) as inert\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @return {Undo} undo command\n */\nexport var inertOthers = function (originalTarget, parentNode, markerName) {\n    if (markerName === void 0) { markerName = 'data-inert-ed'; }\n    var activeParentNode = parentNode || getDefaultParent(originalTarget);\n    if (!activeParentNode) {\n        return function () { return null; };\n    }\n    return applyAttributeToOthers(originalTarget, activeParentNode, markerName, 'inert');\n};\n/**\n * @returns if current browser supports inert\n */\nexport var supportsInert = function () {\n    return typeof HTMLElement !== 'undefined' && HTMLElement.prototype.hasOwnProperty('inert');\n};\n/**\n * Automatic function to \"suppress\" DOM elements - _hide_ or _inert_ in the best possible way\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @return {Undo} undo command\n */\nexport var suppressOthers = function (originalTarget, parentNode, markerName) {\n    if (markerName === void 0) { markerName = 'data-suppressed'; }\n    return (supportsInert() ? inertOthers : hideOthers)(originalTarget, parentNode, markerName);\n};\n", "\"use client\";import{a as ae}from\"./chunk-NZJY6EH4.mjs\";import*as w from\"@radix-ui/react-dialog\";import*as t from\"react\";import{Primitive as D}from\"@radix-ui/react-primitive\";import{useId as H}from\"@radix-ui/react-id\";import{composeRefs as G}from\"@radix-ui/react-compose-refs\";var N='[cmdk-group=\"\"]',Y='[cmdk-group-items=\"\"]',be='[cmdk-group-heading=\"\"]',le='[cmdk-item=\"\"]',ce=`${le}:not([aria-disabled=\"true\"])`,Z=\"cmdk-item-select\",T=\"data-value\",Re=(r,o,n)=>ae(r,o,n),ue=t.createContext(void 0),K=()=>t.useContext(ue),de=t.createContext(void 0),ee=()=>t.useContext(de),fe=t.createContext(void 0),me=t.forwardRef((r,o)=>{let n=L(()=>{var e,a;return{search:\"\",value:(a=(e=r.value)!=null?e:r.defaultValue)!=null?a:\"\",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),u=L(()=>new Set),c=L(()=>new Map),d=L(()=>new Map),f=L(()=>new Set),p=pe(r),{label:b,children:m,value:R,onValueChange:x,filter:C,shouldFilter:S,loop:A,disablePointerSelection:ge=!1,vimBindings:j=!0,...O}=r,$=H(),q=H(),_=H(),I=t.useRef(null),v=ke();k(()=>{if(R!==void 0){let e=R.trim();n.current.value=e,E.emit()}},[R]),k(()=>{v(6,ne)},[]);let E=t.useMemo(()=>({subscribe:e=>(f.current.add(e),()=>f.current.delete(e)),snapshot:()=>n.current,setState:(e,a,s)=>{var i,l,g,y;if(!Object.is(n.current[e],a)){if(n.current[e]=a,e===\"search\")J(),z(),v(1,W);else if(e===\"value\"){if(document.activeElement.hasAttribute(\"cmdk-input\")||document.activeElement.hasAttribute(\"cmdk-root\")){let h=document.getElementById(_);h?h.focus():(i=document.getElementById($))==null||i.focus()}if(v(7,()=>{var h;n.current.selectedItemId=(h=M())==null?void 0:h.id,E.emit()}),s||v(5,ne),((l=p.current)==null?void 0:l.value)!==void 0){let h=a!=null?a:\"\";(y=(g=p.current).onValueChange)==null||y.call(g,h);return}}E.emit()}},emit:()=>{f.current.forEach(e=>e())}}),[]),U=t.useMemo(()=>({value:(e,a,s)=>{var i;a!==((i=d.current.get(e))==null?void 0:i.value)&&(d.current.set(e,{value:a,keywords:s}),n.current.filtered.items.set(e,te(a,s)),v(2,()=>{z(),E.emit()}))},item:(e,a)=>(u.current.add(e),a&&(c.current.has(a)?c.current.get(a).add(e):c.current.set(a,new Set([e]))),v(3,()=>{J(),z(),n.current.value||W(),E.emit()}),()=>{d.current.delete(e),u.current.delete(e),n.current.filtered.items.delete(e);let s=M();v(4,()=>{J(),(s==null?void 0:s.getAttribute(\"id\"))===e&&W(),E.emit()})}),group:e=>(c.current.has(e)||c.current.set(e,new Set),()=>{d.current.delete(e),c.current.delete(e)}),filter:()=>p.current.shouldFilter,label:b||r[\"aria-label\"],getDisablePointerSelection:()=>p.current.disablePointerSelection,listId:$,inputId:_,labelId:q,listInnerRef:I}),[]);function te(e,a){var i,l;let s=(l=(i=p.current)==null?void 0:i.filter)!=null?l:Re;return e?s(e,n.current.search,a):0}function z(){if(!n.current.search||p.current.shouldFilter===!1)return;let e=n.current.filtered.items,a=[];n.current.filtered.groups.forEach(i=>{let l=c.current.get(i),g=0;l.forEach(y=>{let h=e.get(y);g=Math.max(h,g)}),a.push([i,g])});let s=I.current;V().sort((i,l)=>{var h,F;let g=i.getAttribute(\"id\"),y=l.getAttribute(\"id\");return((h=e.get(y))!=null?h:0)-((F=e.get(g))!=null?F:0)}).forEach(i=>{let l=i.closest(Y);l?l.appendChild(i.parentElement===l?i:i.closest(`${Y} > *`)):s.appendChild(i.parentElement===s?i:i.closest(`${Y} > *`))}),a.sort((i,l)=>l[1]-i[1]).forEach(i=>{var g;let l=(g=I.current)==null?void 0:g.querySelector(`${N}[${T}=\"${encodeURIComponent(i[0])}\"]`);l==null||l.parentElement.appendChild(l)})}function W(){let e=V().find(s=>s.getAttribute(\"aria-disabled\")!==\"true\"),a=e==null?void 0:e.getAttribute(T);E.setState(\"value\",a||void 0)}function J(){var a,s,i,l;if(!n.current.search||p.current.shouldFilter===!1){n.current.filtered.count=u.current.size;return}n.current.filtered.groups=new Set;let e=0;for(let g of u.current){let y=(s=(a=d.current.get(g))==null?void 0:a.value)!=null?s:\"\",h=(l=(i=d.current.get(g))==null?void 0:i.keywords)!=null?l:[],F=te(y,h);n.current.filtered.items.set(g,F),F>0&&e++}for(let[g,y]of c.current)for(let h of y)if(n.current.filtered.items.get(h)>0){n.current.filtered.groups.add(g);break}n.current.filtered.count=e}function ne(){var a,s,i;let e=M();e&&(((a=e.parentElement)==null?void 0:a.firstChild)===e&&((i=(s=e.closest(N))==null?void 0:s.querySelector(be))==null||i.scrollIntoView({block:\"nearest\"})),e.scrollIntoView({block:\"nearest\"}))}function M(){var e;return(e=I.current)==null?void 0:e.querySelector(`${le}[aria-selected=\"true\"]`)}function V(){var e;return Array.from(((e=I.current)==null?void 0:e.querySelectorAll(ce))||[])}function X(e){let s=V()[e];s&&E.setState(\"value\",s.getAttribute(T))}function Q(e){var g;let a=M(),s=V(),i=s.findIndex(y=>y===a),l=s[i+e];(g=p.current)!=null&&g.loop&&(l=i+e<0?s[s.length-1]:i+e===s.length?s[0]:s[i+e]),l&&E.setState(\"value\",l.getAttribute(T))}function re(e){let a=M(),s=a==null?void 0:a.closest(N),i;for(;s&&!i;)s=e>0?we(s,N):De(s,N),i=s==null?void 0:s.querySelector(ce);i?E.setState(\"value\",i.getAttribute(T)):Q(e)}let oe=()=>X(V().length-1),ie=e=>{e.preventDefault(),e.metaKey?oe():e.altKey?re(1):Q(1)},se=e=>{e.preventDefault(),e.metaKey?X(0):e.altKey?re(-1):Q(-1)};return t.createElement(D.div,{ref:o,tabIndex:-1,...O,\"cmdk-root\":\"\",onKeyDown:e=>{var s;(s=O.onKeyDown)==null||s.call(O,e);let a=e.nativeEvent.isComposing||e.keyCode===229;if(!(e.defaultPrevented||a))switch(e.key){case\"n\":case\"j\":{j&&e.ctrlKey&&ie(e);break}case\"ArrowDown\":{ie(e);break}case\"p\":case\"k\":{j&&e.ctrlKey&&se(e);break}case\"ArrowUp\":{se(e);break}case\"Home\":{e.preventDefault(),X(0);break}case\"End\":{e.preventDefault(),oe();break}case\"Enter\":{e.preventDefault();let i=M();if(i){let l=new Event(Z);i.dispatchEvent(l)}}}}},t.createElement(\"label\",{\"cmdk-label\":\"\",htmlFor:U.inputId,id:U.labelId,style:Te},b),B(r,e=>t.createElement(de.Provider,{value:E},t.createElement(ue.Provider,{value:U},e))))}),he=t.forwardRef((r,o)=>{var _,I;let n=H(),u=t.useRef(null),c=t.useContext(fe),d=K(),f=pe(r),p=(I=(_=f.current)==null?void 0:_.forceMount)!=null?I:c==null?void 0:c.forceMount;k(()=>{if(!p)return d.item(n,c==null?void 0:c.id)},[p]);let b=ve(n,u,[r.value,r.children,u],r.keywords),m=ee(),R=P(v=>v.value&&v.value===b.current),x=P(v=>p||d.filter()===!1?!0:v.search?v.filtered.items.get(n)>0:!0);t.useEffect(()=>{let v=u.current;if(!(!v||r.disabled))return v.addEventListener(Z,C),()=>v.removeEventListener(Z,C)},[x,r.onSelect,r.disabled]);function C(){var v,E;S(),(E=(v=f.current).onSelect)==null||E.call(v,b.current)}function S(){m.setState(\"value\",b.current,!0)}if(!x)return null;let{disabled:A,value:ge,onSelect:j,forceMount:O,keywords:$,...q}=r;return t.createElement(D.div,{ref:G(u,o),...q,id:n,\"cmdk-item\":\"\",role:\"option\",\"aria-disabled\":!!A,\"aria-selected\":!!R,\"data-disabled\":!!A,\"data-selected\":!!R,onPointerMove:A||d.getDisablePointerSelection()?void 0:S,onClick:A?void 0:C},r.children)}),Ee=t.forwardRef((r,o)=>{let{heading:n,children:u,forceMount:c,...d}=r,f=H(),p=t.useRef(null),b=t.useRef(null),m=H(),R=K(),x=P(S=>c||R.filter()===!1?!0:S.search?S.filtered.groups.has(f):!0);k(()=>R.group(f),[]),ve(f,p,[r.value,r.heading,b]);let C=t.useMemo(()=>({id:f,forceMount:c}),[c]);return t.createElement(D.div,{ref:G(p,o),...d,\"cmdk-group\":\"\",role:\"presentation\",hidden:x?void 0:!0},n&&t.createElement(\"div\",{ref:b,\"cmdk-group-heading\":\"\",\"aria-hidden\":!0,id:m},n),B(r,S=>t.createElement(\"div\",{\"cmdk-group-items\":\"\",role:\"group\",\"aria-labelledby\":n?m:void 0},t.createElement(fe.Provider,{value:C},S))))}),ye=t.forwardRef((r,o)=>{let{alwaysRender:n,...u}=r,c=t.useRef(null),d=P(f=>!f.search);return!n&&!d?null:t.createElement(D.div,{ref:G(c,o),...u,\"cmdk-separator\":\"\",role:\"separator\"})}),Se=t.forwardRef((r,o)=>{let{onValueChange:n,...u}=r,c=r.value!=null,d=ee(),f=P(m=>m.search),p=P(m=>m.selectedItemId),b=K();return t.useEffect(()=>{r.value!=null&&d.setState(\"search\",r.value)},[r.value]),t.createElement(D.input,{ref:o,...u,\"cmdk-input\":\"\",autoComplete:\"off\",autoCorrect:\"off\",spellCheck:!1,\"aria-autocomplete\":\"list\",role:\"combobox\",\"aria-expanded\":!0,\"aria-controls\":b.listId,\"aria-labelledby\":b.labelId,\"aria-activedescendant\":p,id:b.inputId,type:\"text\",value:c?r.value:f,onChange:m=>{c||d.setState(\"search\",m.target.value),n==null||n(m.target.value)}})}),Ce=t.forwardRef((r,o)=>{let{children:n,label:u=\"Suggestions\",...c}=r,d=t.useRef(null),f=t.useRef(null),p=P(m=>m.selectedItemId),b=K();return t.useEffect(()=>{if(f.current&&d.current){let m=f.current,R=d.current,x,C=new ResizeObserver(()=>{x=requestAnimationFrame(()=>{let S=m.offsetHeight;R.style.setProperty(\"--cmdk-list-height\",S.toFixed(1)+\"px\")})});return C.observe(m),()=>{cancelAnimationFrame(x),C.unobserve(m)}}},[]),t.createElement(D.div,{ref:G(d,o),...c,\"cmdk-list\":\"\",role:\"listbox\",tabIndex:-1,\"aria-activedescendant\":p,\"aria-label\":u,id:b.listId},B(r,m=>t.createElement(\"div\",{ref:G(f,b.listInnerRef),\"cmdk-list-sizer\":\"\"},m)))}),xe=t.forwardRef((r,o)=>{let{open:n,onOpenChange:u,overlayClassName:c,contentClassName:d,container:f,...p}=r;return t.createElement(w.Root,{open:n,onOpenChange:u},t.createElement(w.Portal,{container:f},t.createElement(w.Overlay,{\"cmdk-overlay\":\"\",className:c}),t.createElement(w.Content,{\"aria-label\":r.label,\"cmdk-dialog\":\"\",className:d},t.createElement(me,{ref:o,...p}))))}),Ie=t.forwardRef((r,o)=>P(u=>u.filtered.count===0)?t.createElement(D.div,{ref:o,...r,\"cmdk-empty\":\"\",role:\"presentation\"}):null),Pe=t.forwardRef((r,o)=>{let{progress:n,children:u,label:c=\"Loading...\",...d}=r;return t.createElement(D.div,{ref:o,...d,\"cmdk-loading\":\"\",role:\"progressbar\",\"aria-valuenow\":n,\"aria-valuemin\":0,\"aria-valuemax\":100,\"aria-label\":c},B(r,f=>t.createElement(\"div\",{\"aria-hidden\":!0},f)))}),_e=Object.assign(me,{List:Ce,Item:he,Input:Se,Group:Ee,Separator:ye,Dialog:xe,Empty:Ie,Loading:Pe});function we(r,o){let n=r.nextElementSibling;for(;n;){if(n.matches(o))return n;n=n.nextElementSibling}}function De(r,o){let n=r.previousElementSibling;for(;n;){if(n.matches(o))return n;n=n.previousElementSibling}}function pe(r){let o=t.useRef(r);return k(()=>{o.current=r}),o}var k=typeof window==\"undefined\"?t.useEffect:t.useLayoutEffect;function L(r){let o=t.useRef();return o.current===void 0&&(o.current=r()),o}function P(r){let o=ee(),n=()=>r(o.snapshot());return t.useSyncExternalStore(o.subscribe,n,n)}function ve(r,o,n,u=[]){let c=t.useRef(),d=K();return k(()=>{var b;let f=(()=>{var m;for(let R of n){if(typeof R==\"string\")return R.trim();if(typeof R==\"object\"&&\"current\"in R)return R.current?(m=R.current.textContent)==null?void 0:m.trim():c.current}})(),p=u.map(m=>m.trim());d.value(r,f,p),(b=o.current)==null||b.setAttribute(T,f),c.current=f}),c}var ke=()=>{let[r,o]=t.useState(),n=L(()=>new Map);return k(()=>{n.current.forEach(u=>u()),n.current=new Map},[r]),(u,c)=>{n.current.set(u,c),o({})}};function Me(r){let o=r.type;return typeof o==\"function\"?o(r.props):\"render\"in o?o.render(r.props):r}function B({asChild:r,children:o},n){return r&&t.isValidElement(o)?t.cloneElement(Me(o),{ref:o.ref},n(o.props.children)):n(o)}var Te={position:\"absolute\",width:\"1px\",height:\"1px\",padding:\"0\",margin:\"-1px\",overflow:\"hidden\",clip:\"rect(0, 0, 0, 0)\",whiteSpace:\"nowrap\",borderWidth:\"0\"};export{_e as Command,xe as CommandDialog,Ie as CommandEmpty,Ee as CommandGroup,Se as CommandInput,he as CommandItem,Ce as CommandList,Pe as CommandLoading,me as CommandRoot,ye as CommandSeparator,Re as defaultFilter,P as useCommandState};\n", "import { nn } from \"@liveblocks/core\";\nimport type { Editor } from \"@tiptap/react\";\nimport type { PropsWithChildren } from \"react\";\nimport { createContext, useContext } from \"react\";\n\nconst EditorContext = createContext<Editor | null>(null);\n\nexport function EditorProvider({\n  editor,\n  children,\n}: PropsWithChildren<{ editor: Editor }>) {\n  return (\n    <EditorContext.Provider value={editor}>{children}</EditorContext.Provider>\n  );\n}\n\n/**\n * @tiptap/react already offers a `useCurrentEditor` hook but our components might\n * not live under `EditorProvider` or `EditorContent` so we create our own to reduce\n * repetition within our own nested components.\n *\n * @example\n * <Toolbar editor={editor}> // `editor` is required here\n *   <ToolbarSectionInline /> // But it isn't there, because `Toolbar` uses our own `EditorProvider`\n * </Toolbar>\n */\nexport function useCurrentEditor(source: string, parent: string) {\n  const currentEditor = useContext(EditorContext);\n\n  return nn(currentEditor, `${source} cant be used outside of ${parent}.`);\n}\n", "import type {\n  ContextualPromptContext,\n  ContextualPromptResponse,\n  MentionData,\n  Relax,\n  TextEditorType,\n  ThreadData,\n} from \"@liveblocks/core\";\nimport type { LiveblocksYjsProvider } from \"@liveblocks/yjs\";\nimport type { Content, Range } from \"@tiptap/core\";\nimport { PluginKey } from \"@tiptap/pm/state\";\nimport type { DecorationSet } from \"@tiptap/pm/view\";\nimport type { ChainedCommands, SingleCommands } from \"@tiptap/react\";\nimport type { ProsemirrorBinding } from \"y-prosemirror\";\nimport type { Doc, PermanentUserData, Snapshot } from \"yjs\";\n\nexport const LIVEBLOCKS_MENTION_KEY = new PluginKey(\"lb-plugin-mention\");\nexport const LIVEBLOCKS_MENTION_PASTE_KEY = new PluginKey(\n  \"lb-plugin-mention-paste\"\n);\nexport const LIVEBLOCKS_MENTION_NOTIFIER_KEY = new PluginKey(\n  \"lb-plugin-mention-notify\"\n);\n\nexport const LIVEBLOCKS_MENTION_EXTENSION = \"liveblocksMentionExt\";\nexport const LIVEBLOCKS_MENTION_TYPE = \"liveblocksMention\";\nexport const LIVEBLOCKS_GROUP_MENTION_TYPE = \"liveblocksGroupMention\";\n\nexport const THREADS_ACTIVE_SELECTION_PLUGIN = new PluginKey(\n  \"lb-threads-active-selection-plugin\"\n);\nexport const THREADS_PLUGIN_KEY = new PluginKey<ThreadPluginState>(\n  \"lb-threads-plugin\"\n);\nexport const AI_TOOLBAR_SELECTION_PLUGIN = new PluginKey(\n  \"lb-ai-toolbar-selection-plugin\"\n);\n\nexport const LIVEBLOCKS_COMMENT_MARK_TYPE = \"liveblocksCommentMark\";\n\n/**\n * @beta\n */\nexport type ResolveContextualPromptArgs = {\n  /**\n   * The prompt being requested by the user.\n   */\n  prompt: string;\n\n  /**\n   * The context of the document and its current selection.\n   */\n  context: ContextualPromptContext;\n\n  /**\n   * The previous request and its response, if this is a follow-up request.\n   */\n  previous?: {\n    prompt: string;\n    response: ContextualPromptResponse;\n  };\n\n  /**\n   * An abort signal that can be used to cancel requests.\n   */\n  signal: AbortSignal;\n};\n\n/**\n * @beta\n */\nexport type ResolveContextualPromptResponse = ContextualPromptResponse;\n\nexport interface AiConfiguration {\n  /**\n   * The AI's name. (\"Ask {name} anything\", \"{name} is thinking\", etc)\n   */\n  name?: string;\n\n  /**\n   * A function that returns an a response to a contextual prompt.\n   */\n  resolveContextualPrompt?: (\n    args: ResolveContextualPromptArgs\n  ) => Promise<ContextualPromptResponse>;\n}\n\nexport type LiveblocksExtensionOptions = {\n  field?: string;\n  comments?: boolean; // | CommentsConfiguration\n  mentions?: boolean; // | MentionsConfiguration\n  ai?: boolean | AiConfiguration;\n  offlineSupport_experimental?: boolean;\n  threads_experimental?: ThreadData[];\n  initialContent?: Content;\n  enablePermanentUserData?: boolean;\n  /**\n   * @internal\n   * For reporting another text editor type from a\n   * text editor extended from `TipTap` such as our `BlockNote` integration.\n   *\n   * Only useful for Liveblocks developers, not for end users.\n   */\n  textEditorType?: TextEditorType;\n};\n\nexport type LiveblocksExtensionStorage = {\n  unsubs: (() => void)[];\n  doc: Doc;\n  provider: LiveblocksYjsProvider;\n  permanentUserData?: PermanentUserData;\n};\n\nexport type CommentsExtensionStorage = {\n  pendingComment: boolean;\n};\n\nexport const enum ThreadPluginActions {\n  SET_SELECTED_THREAD_ID = \"SET_SELECTED_THREAD_ID\",\n}\n\nexport type AiExtensionOptions = Required<\n  Pick<AiConfiguration, \"name\" | \"resolveContextualPrompt\">\n> & {\n  doc: Doc | undefined;\n  pud: PermanentUserData | undefined;\n};\n\n/**\n * The state of the AI toolbar.\n *\n *                             \n *                                                                                                             \n *                                                             \n *                                                                                                           \n *              $closeAiToolbar()                                                              \n *                                                                                                           \n *                       \n *          CLOSED                        ASKING                       THINKING                      REVIEWING       \n *                       \n *                                                                                                     \n *             $openAiToolbarAsking()                              \n *                                                                                                         \n *            $startAiToolbarThinking(prompt)                                 \n *                                                                                                           \n *                                              \n *                                                                                                             \n *                                            $cancelAiToolbarThinking()                                 \n *                                                                                                               \n *           $acceptAiToolbarResponse()\n *\n */\nexport type AiToolbarState = Relax<\n  | {\n      phase: \"closed\";\n    }\n  | {\n      phase: \"asking\";\n\n      /**\n       * The selection stored when opening the AI toolbar.\n       */\n      initialSelection: Range;\n\n      /**\n       * The custom prompt being written in the toolbar.\n       */\n      customPrompt: string;\n\n      /**\n       * A potential error that occurred during the last AI request.\n       */\n      error?: Error;\n    }\n  | {\n      phase: \"thinking\";\n\n      /**\n       * The selection stored when opening the AI toolbar.\n       */\n      initialSelection: Range;\n\n      /**\n       * The custom prompt being written in the toolbar.\n       */\n      customPrompt: string;\n\n      /**\n       * An abort controller to cancel the AI request.\n       */\n      abortController: AbortController;\n\n      /**\n       * The prompt sent to the AI.\n       */\n      prompt: string;\n\n      /**\n       * The previous response if this \"thinking\" phase is a refinement.\n       */\n      previousResponse?: ContextualPromptResponse;\n    }\n  | {\n      phase: \"reviewing\";\n\n      /**\n       * The selection stored when opening the AI toolbar.\n       */\n      initialSelection: Range;\n\n      /**\n       * The custom prompt being written in the toolbar.\n       */\n      customPrompt: string;\n\n      /**\n       * The prompt sent to the AI.\n       */\n      prompt: string;\n\n      /**\n       * The response of the AI request.\n       */\n      response: ContextualPromptResponse;\n    }\n>;\n\nexport type AiExtensionStorage = {\n  name: string;\n  state: AiToolbarState;\n  snapshot?: Snapshot;\n};\n\nexport type ThreadPluginState = {\n  threadPositions: Map<string, { from: number; to: number }>;\n  selectedThreadId: string | null;\n  selectedThreadPos: number | null;\n  decorations: DecorationSet;\n};\n\nexport type FloatingPosition = \"top\" | \"bottom\";\n\nexport type ExtendedCommands<\n  T extends string,\n  A extends any[] = [],\n> = SingleCommands & Record<T, (...args: A) => boolean>;\n\nexport type ExtendedChainedCommands<\n  T extends string,\n  A extends any[] = [],\n> = ChainedCommands & Record<T, (...args: A) => ChainedCommands>;\n\nexport type ChainedAiCommands = ChainedCommands & {\n  [K in keyof AiCommands]: (\n    ...args: Parameters<AiCommands[K]>\n  ) => ChainedCommands;\n};\n\nexport type CommentsCommands<ReturnType = boolean> = {\n  /**\n   * Add a comment\n   */\n  addComment: (id: string) => ReturnType;\n  selectThread: (id: string | null) => ReturnType;\n  addPendingComment: () => ReturnType;\n\n  /** @internal */\n  closePendingComment: () => ReturnType;\n};\n\nexport type AiCommands<ReturnType = boolean> = {\n  /**\n   * Open the AI toolbar, with an optional prompt.\n   */\n  askAi: (prompt?: string) => ReturnType;\n\n  /**\n   * Close the AI toolbar.\n   */\n  closeAi: () => ReturnType;\n\n  // Transitions (see AiToolbarState)\n\n  /**\n   * @internal\n   * @transition\n   *\n   * Close the AI toolbar.\n   */\n  $closeAiToolbar: () => ReturnType;\n\n  /**\n   * @internal\n   * @transition\n   *\n   * Accept the current AI response and close the AI toolbar.\n   */\n  $acceptAiToolbarResponse: () => ReturnType;\n\n  /**\n   * @internal\n   * @transition\n   *\n   * Open the AI toolbar in the \"asking\" phase.\n   */\n  $openAiToolbarAsking: () => ReturnType;\n\n  /**\n   * @internal\n   * @transition\n   *\n   * Set (and open if not already open) the AI toolbar in the \"thinking\" phase with the given prompt.\n   */\n  $startAiToolbarThinking: (\n    prompt: string,\n    withPreviousResponse?: boolean\n  ) => ReturnType;\n\n  /**\n   * @internal\n   * @transition\n   *\n   * Cancel the current \"thinking\" phase, going back to the \"asking\" phase.\n   */\n  $cancelAiToolbarThinking: () => ReturnType;\n\n  // Other\n\n  /**\n   * @internal\n   *\n   * Show the diff of the current \"reviewing\" phase.\n   */\n  _showAiToolbarReviewingDiff: () => ReturnType;\n\n  /**\n   * @internal\n   *\n   * Handle the success of the current \"thinking\" phase.\n   */\n  _handleAiToolbarThinkingSuccess: (\n    response: ContextualPromptResponse\n  ) => ReturnType;\n\n  /**\n   * @internal\n   *\n   * Handle an error of the current \"thinking\" phase.\n   */\n  _handleAiToolbarThinkingError: (error: unknown) => ReturnType;\n\n  /**\n   * @internal\n   *\n   * Update the current custom AI prompt.\n   */\n  _updateAiToolbarCustomPrompt: (\n    customPrompt: string | ((currentCustomPrompt: string) => string)\n  ) => ReturnType;\n};\n\nexport type YSyncPluginState = {\n  binding: ProsemirrorBinding;\n};\n\nexport type TiptapMentionData = MentionData & {\n  notificationId: string;\n};\n\nexport type SerializedTiptapMentionData = TiptapMentionData extends infer T\n  ? T extends { kind: \"group\" }\n    ? Omit<T, \"userIds\"> & { userIds?: string }\n    : T\n  : never;\n", "import type { ClientRectObject } from \"@floating-ui/react-dom\";\nimport { assertNever, type ContextualPromptContext } from \"@liveblocks/core\";\nimport type { Editor, Range } from \"@tiptap/core\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport { Fragment } from \"@tiptap/pm/model\";\nimport {\n  type EditorState,\n  type Selection,\n  TextSelection,\n} from \"@tiptap/pm/state\";\nimport {\n  getRelativeSelection,\n  relativePositionToAbsolutePosition,\n  ySyncPluginKey,\n} from \"y-prosemirror\";\nimport type { RelativePosition } from \"yjs\";\n\nimport type {\n  SerializedTiptapMentionData,\n  TiptapMentionData,\n  YSyncPluginState,\n} from \"./types\";\nimport {\n  LIVEBLOCKS_GROUP_MENTION_TYPE,\n  LIVEBLOCKS_MENTION_TYPE,\n} from \"./types\";\n\nconst CONTEXT_TRUNCATION = \"[]\";\nconst CONTEXT_BLOCK_SEPARATOR = \"\\n\";\n\nexport const getRelativeSelectionFromState = (state: EditorState) => {\n  const pluginState = ySyncPluginKey.getState(state) as YSyncPluginState;\n  if (!pluginState) return null;\n  return getRelativeSelection(pluginState.binding, state);\n};\n\nexport const getRangeFromRelativeSelections = (\n  pos: { anchor: RelativePosition; head: RelativePosition },\n  state: EditorState\n) => {\n  const pluginState = ySyncPluginKey.getState(state) as YSyncPluginState;\n  if (!pluginState || !pluginState.binding) return { from: 0, to: 0 };\n  const { doc, type, mapping } = pluginState.binding;\n  const anchor =\n    relativePositionToAbsolutePosition(doc, type, pos.anchor, mapping) ?? 0;\n  const head =\n    relativePositionToAbsolutePosition(doc, type, pos.head, mapping) ?? 0;\n\n  const from = anchor > head ? head : anchor;\n  const to = anchor > head ? anchor : head;\n  return { from, to };\n};\n\nexport const getRectFromCoords = (coords: {\n  top: number;\n  left: number;\n  right: number;\n  bottom: number;\n}): ClientRectObject => {\n  return {\n    ...coords,\n    x: coords.left,\n    y: coords.top,\n    width: coords.right - coords.left,\n    height: coords.bottom - coords.top,\n  };\n};\n\nexport const getMentionsFromNode = (\n  node: ProseMirrorNode,\n  range: Range\n): Map<string, TiptapMentionData> => {\n  const mentions = new Map<string, TiptapMentionData>();\n\n  node.nodesBetween(range.from, range.to, (child) => {\n    if (\n      child.type.name === LIVEBLOCKS_MENTION_TYPE ||\n      child.type.name === LIVEBLOCKS_GROUP_MENTION_TYPE\n    ) {\n      const mention = child.attrs as Omit<SerializedTiptapMentionData, \"kind\">;\n\n      if (mention.id && mention.notificationId) {\n        if (child.type.name === LIVEBLOCKS_MENTION_TYPE) {\n          mentions.set(mention.notificationId, {\n            kind: \"user\",\n            id: mention.id,\n            notificationId: mention.notificationId,\n          });\n        } else if (child.type.name === LIVEBLOCKS_GROUP_MENTION_TYPE) {\n          let userIds: string[] | undefined;\n\n          if (mention.userIds) {\n            try {\n              const parsedUserIds = JSON.parse(mention.userIds) as string[];\n\n              if (Array.isArray(parsedUserIds)) {\n                userIds = parsedUserIds;\n              }\n            } catch {\n              userIds = undefined;\n            }\n          }\n\n          mentions.set(mention.notificationId, {\n            kind: \"group\",\n            id: mention.id,\n            userIds,\n            notificationId: mention.notificationId,\n          });\n        } else {\n          assertNever(child.type.name, \"Unexpected mention kind\");\n        }\n      }\n    }\n  });\n\n  return mentions;\n};\n\n// How to modify data in transformPasted, inspired by: https://discuss.prosemirror.net/t/modify-specific-node-on-copy-and-paste-in-clipboard/4901/4\nexport const mapFragment = (\n  fragment: Fragment,\n  callback: (\n    node: ProseMirrorNode\n  ) => ProseMirrorNode | ProseMirrorNode[] | Fragment | null\n): Fragment => {\n  const content: ProseMirrorNode[] = [];\n  fragment.forEach((node) => {\n    if (node.content.childCount > 0) {\n      content.push(\n        node.type.create(node.attrs, mapFragment(node.content, callback))\n      );\n      return;\n    }\n    content.push(callback(node) as ProseMirrorNode);\n  });\n\n  return Fragment.from(content);\n};\n\nexport function getDomRangeFromSelection(editor: Editor, selection: Selection) {\n  if (selection.from === selection.to) {\n    const { parent, parentOffset } = selection.$from;\n\n    // If the selection is collapsed and in an empty block node or at the end\n    // of a text node, extend it to the entire node\n    if (\n      (parent.isBlock && parent.content.size === 0) ||\n      (parent.isTextblock && parentOffset === parent.content.size)\n    ) {\n      selection = TextSelection.create(\n        editor.state.doc,\n        selection.$from.before(),\n        selection.$from.after()\n      );\n    }\n  }\n\n  const from = editor.view.domAtPos(selection.from);\n  const to = editor.view.domAtPos(selection.to);\n\n  const domRange = document.createRange();\n  domRange.setStart(from.node, from.offset);\n  domRange.setEnd(to.node, to.offset);\n\n  return domRange;\n}\n\nexport function compareSelections(\n  a: Selection | null | undefined,\n  b: Selection | null | undefined\n) {\n  if (!a || !b) {\n    return false;\n  }\n\n  return a.eq(b);\n}\n\nexport function getContextualPromptContext(\n  editor: Editor,\n  maxLength = 10_000\n): ContextualPromptContext {\n  const { selection, doc } = editor.state;\n\n  const selectionLength = selection.to - selection.from;\n\n  if (maxLength >= doc.content.size) {\n    // If the document is smaller than the maximum length, return the entire document\n    return {\n      beforeSelection: doc.textBetween(\n        0,\n        selection.from,\n        CONTEXT_BLOCK_SEPARATOR\n      ),\n      selection: doc.textBetween(\n        selection.from,\n        selection.to,\n        CONTEXT_BLOCK_SEPARATOR\n      ),\n      afterSelection: doc.textBetween(\n        selection.to,\n        doc.content.size,\n        CONTEXT_BLOCK_SEPARATOR\n      ),\n    };\n  } else if (selectionLength > maxLength) {\n    // If the selection is too large, truncate its middle to still allow continuations\n    const selectionStart = doc.textBetween(\n      selection.from,\n      selection.from + Math.floor(maxLength / 2) - CONTEXT_TRUNCATION.length,\n      CONTEXT_BLOCK_SEPARATOR\n    );\n    const selectionEnd = doc.textBetween(\n      selection.to - Math.floor(maxLength / 2) + CONTEXT_TRUNCATION.length,\n      selection.to,\n      CONTEXT_BLOCK_SEPARATOR\n    );\n\n    return {\n      beforeSelection: \"\",\n      selection: `${selectionStart}${CONTEXT_TRUNCATION}${selectionEnd}`,\n      afterSelection: \"\",\n    };\n  } else {\n    // If the selection is smaller than (or equal to) the maximum length, extract as much as possible from the document around the selection\n\n    // Start by taking as much as possible after the selection\n    let beforeLength = Math.min(\n      selection.from,\n      Math.floor((maxLength - selectionLength) / 2)\n    );\n    const afterLength = Math.min(\n      doc.content.size - selection.to,\n      maxLength - selectionLength - beforeLength\n    );\n\n    // If needed (e.g. the selection is near the end), compensate before the selection\n    if (beforeLength + afterLength + selectionLength < maxLength) {\n      beforeLength = Math.min(\n        selection.from,\n        maxLength - selectionLength - afterLength\n      );\n    }\n\n    let beforeSelection = doc.textBetween(\n      Math.max(0, selection.from - beforeLength),\n      selection.from,\n      CONTEXT_BLOCK_SEPARATOR\n    );\n    let afterSelection = doc.textBetween(\n      selection.to,\n      Math.min(doc.content.size, selection.to + afterLength),\n      CONTEXT_BLOCK_SEPARATOR\n    );\n\n    // Add leading truncation if `beforeSelection` doesn't contain the document's start\n    if (selection.from - beforeLength > 0) {\n      beforeSelection = `${CONTEXT_TRUNCATION}${beforeSelection}`;\n    }\n\n    // Add trailing truncation if `afterSelection` doesn't contain the document's end\n    if (selection.to + afterLength < doc.content.size) {\n      afterSelection = `${afterSelection}${CONTEXT_TRUNCATION}`;\n    }\n\n    return {\n      beforeSelection,\n      selection: doc.textBetween(\n        selection.from,\n        selection.to,\n        CONTEXT_BLOCK_SEPARATOR\n      ),\n      afterSelection,\n    };\n  }\n}\n", "import {\n  autoRetry,\n  type ContextualPromptResponse,\n  HttpError,\n} from \"@liveblocks/core\";\nimport type { LiveblocksYjsProvider } from \"@liveblocks/yjs\";\nimport type { CommandProps, Editor } from \"@tiptap/core\";\nimport { Extension } from \"@tiptap/core\";\nimport { Fragment, Slice } from \"@tiptap/pm/model\";\nimport type { Transaction } from \"@tiptap/pm/state\";\nimport { Plugin } from \"@tiptap/pm/state\";\nimport { Decoration, DecorationSet } from \"@tiptap/pm/view\";\nimport {\n  ySyncPluginKey,\n  yXmlFragmentToProseMirrorFragment,\n} from \"y-prosemirror\";\nimport type { Doc, Snapshot } from \"yjs\";\nimport {\n  createDocFromSnapshot,\n  emptySnapshot,\n  equalSnapshots,\n  snapshot as takeSnapshot,\n} from \"yjs\";\n\nimport {\n  AI_TOOLBAR_SELECTION_PLUGIN,\n  type AiCommands,\n  type AiExtensionOptions,\n  type AiExtensionStorage,\n  type AiToolbarState,\n  type LiveblocksExtensionStorage,\n  type ResolveContextualPromptResponse,\n  type YSyncPluginState,\n} from \"../types\";\nimport { getContextualPromptContext } from \"../utils\";\n\nconst DEFAULT_AI_NAME = \"AI\";\nexport const DEFAULT_STATE: AiToolbarState = { phase: \"closed\" };\n\nconst RESOLVE_AI_PROMPT_RETRY_ATTEMPTS = 3;\nconst RESOLVE_AI_PROMPT_RETRY_DELAYS = [1000, 2000, 4000];\n\nfunction getYjsBinding(editor: Editor) {\n  return (ySyncPluginKey.getState(editor.view.state) as YSyncPluginState)\n    .binding;\n}\n\nfunction getLiveblocksYjsProvider(editor: Editor) {\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n  return (\n    editor.extensionStorage.liveblocksExtension as\n      | LiveblocksExtensionStorage\n      | undefined\n  )?.provider as LiveblocksYjsProvider | undefined;\n}\n\nexport function isContextualPromptDiffResponse(\n  response: ContextualPromptResponse\n): response is Extract<\n  ContextualPromptResponse,\n  { type: \"replace\" | \"insert\" }\n> {\n  return response.type === \"replace\" || response.type === \"insert\";\n}\n\nfunction isResolveContextualPromptResponse(\n  response: unknown\n): response is ResolveContextualPromptResponse {\n  return (\n    typeof response === \"object\" &&\n    response !== null &&\n    typeof (response as { text: unknown }).text === \"string\" &&\n    typeof (response as { type: unknown }).type === \"string\" &&\n    [\"insert\", \"replace\", \"other\"].includes((response as { type: string }).type)\n  );\n}\n\nfunction createParagraph(editor: Editor, text: string) {\n  const paragraph =\n    editor.schema.nodes.paragraph ??\n    Object.values(editor.schema.nodes).find((node) => node.isBlock);\n\n  if (!paragraph) {\n    throw new Error(\"Could not create a paragraph.\");\n  }\n\n  return paragraph.create(null, text ? editor.schema.text(text) : undefined);\n}\n\nfunction getRevertTransaction(\n  tr: Transaction,\n  editor: Editor,\n  storage: AiExtensionStorage,\n  doc?: Doc\n): Transaction | null {\n  if (storage.snapshot) {\n    const binding = getYjsBinding(editor);\n\n    if (binding) {\n      binding.mapping.clear();\n\n      const docFromSnapshot = createDocFromSnapshot(\n        binding.doc,\n        storage.snapshot\n      );\n      const type = docFromSnapshot.getXmlFragment(\"default\"); // TODO: field\n      const fragmentContent = yXmlFragmentToProseMirrorFragment(\n        type,\n        editor.state.schema\n      );\n\n      tr.setMeta(\"addToHistory\", false);\n      tr.replace(\n        0,\n        editor.state.doc.content.size,\n        new Slice(Fragment.from(fragmentContent), 0, 0)\n      );\n      tr.setMeta(ySyncPluginKey, {\n        snapshot: null,\n        prevSnapshot: null,\n      });\n\n      if (doc) {\n        doc.gc = true;\n      }\n\n      storage.snapshot = undefined;\n\n      return tr;\n    }\n  }\n  return null;\n}\n\nexport const AiExtension = Extension.create<\n  AiExtensionOptions,\n  AiExtensionStorage\n>({\n  name: \"liveblocksAi\",\n  addOptions() {\n    return {\n      doc: undefined,\n      pud: undefined,\n\n      // The actual default resolver is set in LiveblocksExtension via AiExtension.configure()\n      resolveContextualPrompt: () => Promise.reject(),\n      name: DEFAULT_AI_NAME,\n    };\n  },\n  addStorage() {\n    return {\n      state: DEFAULT_STATE,\n      name: this.options.name,\n    };\n  },\n  addCommands() {\n    return {\n      askAi: (prompt) => () => {\n        if (typeof prompt === \"string\") {\n          (\n            this.editor.commands as unknown as AiCommands\n          ).$startAiToolbarThinking(prompt);\n        } else {\n          (\n            this.editor.commands as unknown as AiCommands\n          ).$openAiToolbarAsking();\n        }\n\n        return true;\n      },\n\n      closeAi: () => () => {\n        (this.editor.commands as unknown as AiCommands).$closeAiToolbar();\n\n        return true;\n      },\n\n      $acceptAiToolbarResponse:\n        () =>\n        ({ tr, view }: CommandProps) => {\n          const currentState = this.storage.state;\n\n          // 1. If NOT in \"reviewing\" phase, do nothing\n          if (currentState.phase !== \"reviewing\") {\n            return false;\n          }\n\n          // 2. Accept the response\n          if (isContextualPromptDiffResponse(currentState.response)) {\n            // 2.a. If the response is a diff, apply it definitely\n            const binding = getYjsBinding(this.editor);\n            if (!binding) {\n              return false;\n            }\n\n            const fragmentContent = yXmlFragmentToProseMirrorFragment(\n              binding.type,\n              this.editor.state.schema\n            );\n            tr.setMeta(\"addToHistory\", false);\n            tr.replace(\n              0,\n              this.editor.state.doc.content.size,\n              new Slice(Fragment.from(fragmentContent), 0, 0)\n            );\n            tr.setMeta(ySyncPluginKey, {\n              snapshot: null,\n              prevSnapshot: null,\n            });\n\n            this.storage.snapshot = undefined;\n          } else {\n            // 2.b. If the response is not a diff, insert it below the selection\n\n            const paragraphs = currentState.response.text\n              .split(\"\\n\")\n              .map((paragraph) => createParagraph(this.editor, paragraph));\n\n            tr.insert(this.editor.state.selection.$to.end(), paragraphs);\n            tr.setMeta(\"addToHistory\", true);\n            view.dispatch(tr);\n            // Prevent TipTap from dispatching this transaction, because we already did (this is a hack)\n            tr.setMeta(\"preventDispatch\", true);\n          }\n\n          // 3. Unblock the editor\n          getLiveblocksYjsProvider(this.editor)?.unpause();\n          this.editor.setEditable(true);\n\n          // 4. Set to \"closed\" phase\n          this.storage.state = { phase: \"closed\" };\n\n          return true;\n        },\n\n      $closeAiToolbar:\n        () =>\n        ({ tr, view }: CommandProps) => {\n          const currentState = this.storage.state;\n\n          // 1. If already in \"closed\" phase, do nothing\n          if (currentState.phase === \"closed\") {\n            return false;\n          }\n\n          // 2. If in \"thinking\" phase, cancel the current AI request\n          if (currentState.phase === \"thinking\") {\n            currentState.abortController.abort();\n          }\n\n          // 3. If in \"thinking\" or \"reviewing\" phase, revert the editor if possible and unblock it\n          if (\n            currentState.phase === \"thinking\" ||\n            currentState.phase === \"reviewing\"\n          ) {\n            // Get the revert transaction and dispatch it\n            const revertTr = getRevertTransaction(\n              tr,\n              this.editor,\n              this.storage,\n              this.options.doc\n            );\n            if (revertTr) {\n              view.dispatch(revertTr);\n              // Prevent TipTap from dispatching this transaction, because we already did (this is a hack)\n              tr.setMeta(\"preventDispatch\", true);\n            }\n          }\n\n          // 4. Restore the initial selection\n          this.editor.commands.setTextSelection(currentState.initialSelection);\n\n          // 5. Unblock the editor\n          getLiveblocksYjsProvider(this.editor)?.unpause();\n          this.editor.setEditable(true);\n\n          // 6. Set to \"closed\" phase\n          this.storage.state = { phase: \"closed\" };\n\n          return true;\n        },\n\n      $openAiToolbarAsking: () => () => {\n        const currentState = this.storage.state;\n\n        // 1. If NOT in \"closed\" phase, do nothing\n        if (currentState.phase !== \"closed\") {\n          return false;\n        }\n\n        // 2. Blur the editor if needed\n        if (this.editor.isFocused) {\n          this.editor.commands.blur();\n        }\n\n        // 3. Set to \"asking\" phase\n        this.storage.state = {\n          phase: \"asking\",\n          // Store the initial selection\n          initialSelection: {\n            from: this.editor.state.selection.from,\n            to: this.editor.state.selection.to,\n          },\n          // Initialize the custom prompt as empty\n          customPrompt: \"\",\n        };\n\n        return true;\n      },\n\n      $startAiToolbarThinking:\n        (prompt: string, withPreviousResponse?: boolean) =>\n        ({ tr, view }: CommandProps) => {\n          const currentState = this.storage.state;\n\n          // 1. If in \"thinking\" phase already, do nothing\n          if (currentState.phase === \"thinking\") {\n            return false;\n          }\n\n          // 2. Blur the editor if needed\n          if (this.editor.isFocused) {\n            this.editor.commands.blur();\n          }\n\n          const abortController = new AbortController();\n          const provider = getLiveblocksYjsProvider(this.editor);\n\n          // 3. If this is a retry or a refinement, revert the editor and restore the initial selection\n          if (currentState.phase === \"reviewing\") {\n            // 3.a. Revert the editor\n            const revertTr = getRevertTransaction(\n              tr,\n              this.editor,\n              this.storage,\n              this.options.doc\n            );\n            if (revertTr) {\n              // Important: in this scenario we do not unpause the provider\n              view.dispatch(revertTr);\n              // Prevent Tiptap from dispatching this transaction, because we already did (this is a hack)\n              tr.setMeta(\"preventDispatch\", true);\n            }\n\n            // 3.b. Restore the initial selection\n            this.editor.commands.setTextSelection(\n              currentState.initialSelection\n            );\n          }\n\n          // 4. Set to \"thinking\" phase\n          this.storage.state = {\n            phase: \"thinking\",\n            // Store the initial selection if the toolbar is opened directly in the \"thinking\" phase\n            initialSelection: currentState.initialSelection ?? {\n              from: this.editor.state.selection.from,\n              to: this.editor.state.selection.to,\n            },\n            // Initialize the custom prompt as empty if the toolbar is opened directly in the \"thinking\" phase\n            customPrompt: currentState.customPrompt ?? \"\",\n            prompt,\n            abortController,\n            previousResponse: currentState.response,\n          };\n\n          // 5. Block the editor\n          this.editor.setEditable(false);\n\n          // 6. Start the AI request\n          autoRetry(\n            async () => {\n              await provider?.pause();\n\n              // 6.a. Resolve the AI prompt\n              const response = (await this.options.resolveContextualPrompt({\n                prompt,\n                context: getContextualPromptContext(this.editor, 3_000),\n                signal: abortController.signal,\n                previous:\n                  withPreviousResponse && currentState.phase === \"reviewing\"\n                    ? {\n                        prompt: currentState.prompt,\n                        response: {\n                          type: currentState.response?.type,\n                          text: currentState.response?.text,\n                        },\n                      }\n                    : undefined,\n              })) as unknown;\n\n              // 6.b. Validate the response\n              if (isResolveContextualPromptResponse(response)) {\n                return response;\n              } else {\n                throw new Error(\"Failed to resolve AI prompt.\");\n              }\n            },\n            RESOLVE_AI_PROMPT_RETRY_ATTEMPTS,\n            RESOLVE_AI_PROMPT_RETRY_DELAYS,\n\n            (error) => {\n              // Don't retry on 4xx errors or if the request was aborted\n              return (\n                abortController.signal.aborted ||\n                (error instanceof HttpError &&\n                  error.status >= 400 &&\n                  error.status < 500)\n              );\n            }\n          )\n            .then((response) => {\n              if (abortController.signal.aborted) {\n                return;\n              }\n\n              // 6.a. If the AI request succeeds, set to \"reviewing\" phase with the response\n              (\n                this.editor.commands as unknown as AiCommands\n              )._handleAiToolbarThinkingSuccess({\n                type: response.type,\n                text: response.text,\n              });\n            })\n            .catch((error) => {\n              if (abortController.signal.aborted) {\n                return;\n              }\n\n              // 6.b. If the AI request fails, set to \"asking\" phase with error\n              (\n                this.editor.commands as unknown as AiCommands\n              )._handleAiToolbarThinkingError(error);\n            });\n\n          return true;\n        },\n\n      $cancelAiToolbarThinking: () => () => {\n        const currentState = this.storage.state;\n\n        // 1. If NOT in \"thinking\" phase, do nothing\n        if (currentState.phase !== \"thinking\") {\n          return false;\n        }\n\n        // 2. Cancel the current AI request\n        currentState.abortController.abort();\n\n        // 3. Unblock the editor\n        this.editor.setEditable(true);\n\n        // 4. Set to \"asking\" phase\n        this.storage.state = {\n          phase: \"asking\",\n          initialSelection: currentState.initialSelection,\n          // If the custom prompt is different than the prompt, reset it\n          customPrompt:\n            currentState.prompt === currentState.customPrompt\n              ? currentState.customPrompt\n              : \"\",\n        };\n\n        return true;\n      },\n\n      _showAiToolbarReviewingDiff: () => () => {\n        // The diff is applied right before moving to the \"reviewing\" phase\n        if (this.storage.state.phase !== \"reviewing\") {\n          return false;\n        }\n\n        if (!this.options.doc || !this.storage.snapshot) {\n          return false;\n        }\n\n        const previousSnapshot: Snapshot =\n          this.storage.snapshot ?? emptySnapshot;\n        const currentSnapshot = takeSnapshot(this.options.doc);\n\n        if (equalSnapshots(previousSnapshot, currentSnapshot)) {\n          return true;\n        }\n\n        getYjsBinding(this.editor)?.renderSnapshot(\n          currentSnapshot,\n          previousSnapshot\n        );\n\n        return true;\n      },\n\n      _handleAiToolbarThinkingSuccess:\n        (response: ContextualPromptResponse) =>\n        ({ view, tr }: CommandProps) => {\n          const currentState = this.storage.state;\n\n          // 1. If NOT in \"thinking\" phase, do nothing\n          if (currentState.phase !== \"thinking\") {\n            return false;\n          }\n\n          // 2. If this is not a diff, the response will just be in the toolbar, set to \"reviewing\" phase directly with the response\n          if (!isContextualPromptDiffResponse(response)) {\n            this.storage.state = {\n              phase: \"reviewing\",\n              initialSelection: currentState.initialSelection,\n              customPrompt: \"\",\n              prompt: currentState.prompt,\n              response,\n            };\n\n            return true;\n          }\n\n          if (!this.options.doc) {\n            return false;\n          }\n\n          // 3. Otherwise, the response is a diff, apply it to the editor\n          this.options.doc.gc = false;\n          this.storage.snapshot = takeSnapshot(this.options.doc);\n\n          // 4. Set to \"reviewing\" phase with the new range\n          this.storage.state = {\n            phase: \"reviewing\",\n            initialSelection: currentState.initialSelection,\n            customPrompt: \"\",\n            prompt: currentState.prompt,\n            response,\n          };\n\n          // 5. Insert the response's text as inline first (and replace the selection if it's a replace) then as block if there are multiple paragraphs\n          const [firstParagraph, ...otherParagraphs] =\n            response.text.split(\"\\n\");\n\n          tr.insertText(\n            firstParagraph,\n            response.type === \"insert\"\n              ? this.editor.state.selection.to\n              : this.editor.state.selection.from,\n            this.editor.state.selection.to\n          );\n\n          if (otherParagraphs.length > 0) {\n            const paragraphs = otherParagraphs.map((paragraph) =>\n              createParagraph(this.editor, paragraph)\n            );\n\n            tr.insert(tr.selection.$to.pos, paragraphs);\n          }\n\n          view.dispatch(tr);\n          // Prevent Tiptap from dispatching this transaction, because we already did (this is a hack)\n          tr.setMeta(\"preventDispatch\", true);\n\n          // 6. Show the diff\n          (\n            this.editor.commands as unknown as AiCommands\n          )._showAiToolbarReviewingDiff();\n\n          // We moved to the \"reviewing\" phase, so even if `_showAiToolbarReviewingDiff`\n          // returns `false` somehow, we still want to return `true`\n          return true;\n        },\n\n      _handleAiToolbarThinkingError: (error: unknown) => () => {\n        const currentState = this.storage.state;\n\n        // 1. If NOT in \"thinking\" phase, do nothing\n        if (currentState.phase !== \"thinking\") {\n          return false;\n        }\n\n        // 2. Unblock the editor\n        this.editor.setEditable(true);\n\n        // 3. Log the error\n        console.error(error);\n\n        // 4. Set to \"asking\" phase with error\n        this.storage.state = {\n          phase: \"asking\",\n          initialSelection: currentState.initialSelection,\n          // If the custom prompt is different than the prompt, reset it\n          customPrompt:\n            currentState.prompt === currentState.customPrompt\n              ? currentState.customPrompt\n              : \"\",\n          // Pass the error so it can be displayed\n          error:\n            error instanceof Error\n              ? error\n              : new Error(String(error), { cause: error }),\n        };\n\n        return true;\n      },\n\n      _updateAiToolbarCustomPrompt:\n        (customPrompt: string | ((currentCustomPrompt: string) => string)) =>\n        () => {\n          const currentState = this.storage.state;\n\n          // 1. If NOT in a phase with a custom prompt, do nothing\n          if (typeof currentState.customPrompt !== \"string\") {\n            return false;\n          }\n\n          // 2. Update the custom prompt\n          this.storage.state.customPrompt =\n            typeof customPrompt === \"function\"\n              ? customPrompt(currentState.customPrompt)\n              : customPrompt;\n\n          return true;\n        },\n    };\n  },\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: AI_TOOLBAR_SELECTION_PLUGIN,\n        props: {\n          decorations: ({ doc, selection }) => {\n            // Don't show the AI toolbar selection if the toolbar is closed or when reviewing diff responses\n            if (\n              this.storage.state.phase === \"closed\" ||\n              (this.storage.state.phase === \"reviewing\" &&\n                isContextualPromptDiffResponse(this.storage.state.response))\n            ) {\n              return DecorationSet.create(doc, []);\n            }\n\n            const { from, to } = selection;\n            const decorations: Decoration[] = [\n              Decoration.inline(from, to, {\n                class: \"lb-root lb-selection lb-tiptap-active-selection\",\n              }),\n            ];\n\n            return DecorationSet.create(doc, decorations);\n          },\n        },\n      }),\n    ];\n  },\n});\n", "import {\n  autoUpdate,\n  type DetectOverflowOptions,\n  hide,\n  limitShift,\n  type Middleware,\n  offset,\n  shift,\n  useFloating,\n  type UseFloatingOptions,\n} from \"@floating-ui/react-dom\";\nimport { useLayoutEffect } from \"@liveblocks/react/_private\";\nimport {\n  ArrowCornerDownRightIcon,\n  Button,\n  CheckIcon,\n  cn,\n  CrossIcon,\n  EditIcon,\n  LengthenIcon,\n  QuestionMarkIcon,\n  SendIcon,\n  ShortcutTooltip,\n  ShortenIcon,\n  SparklesIcon,\n  SparklesTextIcon,\n  StopIcon,\n  TooltipProvider,\n  UndoIcon,\n  useRefs,\n  WarningIcon,\n} from \"@liveblocks/react-ui/_private\";\nimport { type Editor, useEditorState } from \"@tiptap/react\";\nimport { Command, useCommandState } from \"cmdk\";\nimport type {\n  ComponentProps,\n  ComponentType,\n  KeyboardEvent as ReactKeyboardEvent,\n  PropsWithChildren,\n  ReactNode,\n  RefObject,\n} from \"react\";\nimport {\n  createContext,\n  forwardRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { EditorProvider, useCurrentEditor } from \"../context\";\nimport type {\n  AiCommands,\n  AiExtensionStorage,\n  AiToolbarState,\n  ChainedAiCommands,\n} from \"../types\";\nimport { getDomRangeFromSelection } from \"../utils\";\nimport { DEFAULT_STATE, isContextualPromptDiffResponse } from \"./AiExtension\";\n\nexport const AI_TOOLBAR_COLLISION_PADDING = 10;\n\nexport interface AiToolbarProps\n  extends Omit<ComponentProps<\"div\">, \"value\" | \"defaultValue\" | \"children\"> {\n  /**\n   * The Tiptap editor.\n   */\n  editor: Editor | null;\n\n  /**\n   * The vertical offset of the AI toolbar from the selection.\n   */\n  offset?: number;\n\n  /**\n   * The prompt suggestions to display below the AI toolbar.\n   */\n  suggestions?: ReactNode | ComponentType<PropsWithChildren>;\n}\n\ntype AiToolbarDropdownSeparatorProps = ComponentProps<\"div\">;\n\ninterface AiToolbarDropdownItemProps\n  extends ComponentProps<typeof Command.Item> {\n  icon?: ReactNode;\n}\n\ntype AiToolbarSuggestionsSeparatorProps = AiToolbarDropdownSeparatorProps;\n\ntype AiToolbarSuggestionsLabelProps = ComponentProps<\"span\">;\n\ninterface AiToolbarSuggestionProps extends ComponentProps<\"div\"> {\n  prompt?: string;\n  icon?: ReactNode;\n}\n\ninterface AiToolbarContext {\n  state: AiToolbarState;\n  toolbarRef: RefObject<HTMLDivElement>;\n  dropdownRef: RefObject<HTMLDivElement>;\n  isDropdownHidden: boolean;\n}\n\nconst AiToolbarContext = createContext<AiToolbarContext | null>(null);\n\nfunction useAiToolbarContext() {\n  const context = useContext(AiToolbarContext);\n\n  if (!context) {\n    throw new Error(\"useAiToolbarContext must be used within an AiToolbar\");\n  }\n\n  return context;\n}\n\n/**\n * A custom Floating UI middleware to position/scale the toolbar:\n * - Vertically: relative to the reference (e.g. selection)\n * - Horizontally: relative to the editor\n * - Width: relative to the editor\n */\nfunction tiptapFloating(editor: Editor | null): Middleware {\n  return {\n    name: \"tiptap\",\n    options: editor,\n    fn({ elements }) {\n      if (!editor) {\n        return {};\n      }\n\n      const editorRect = editor.view.dom.getBoundingClientRect();\n\n      elements.floating.style.setProperty(\n        \"--lb-tiptap-editor-width\",\n        `${editorRect.width}px`\n      );\n      elements.floating.style.setProperty(\n        \"--lb-tiptap-editor-height\",\n        `${editorRect.height}px`\n      );\n\n      return {\n        x: editorRect.x,\n      };\n    },\n  };\n}\n\n/**\n * A custom Floating UI middleware to flip the toolbar/dropdown when shifted more than 100%.\n */\nfunction flipToolbar(): Middleware {\n  return {\n    name: \"flipToolbar\",\n    fn({ elements, middlewareData, rects }) {\n      const shiftOffsetY = middlewareData.shift?.y ?? 0;\n\n      if (Math.abs(shiftOffsetY) >= rects.floating.height) {\n        elements.floating.setAttribute(\"data-liveblocks-ai-toolbar-flip\", \"\");\n      } else {\n        elements.floating.removeAttribute(\"data-liveblocks-ai-toolbar-flip\");\n      }\n\n      return {};\n    },\n  };\n}\n\nconst AiToolbarDropdownSeparator = forwardRef<\n  HTMLDivElement,\n  AiToolbarDropdownSeparatorProps\n>(({ className, ...props }, forwardedRef) => {\n  return (\n    <Command.Separator\n      className={cn(\"lb-dropdown-separator\", className)}\n      {...props}\n      ref={forwardedRef}\n    />\n  );\n});\n\nconst AiToolbarSuggestionsSeparator = forwardRef<\n  HTMLDivElement,\n  AiToolbarSuggestionsSeparatorProps\n>((props, forwardedRef) => {\n  return <AiToolbarDropdownSeparator ref={forwardedRef} {...props} />;\n});\n\nconst AiToolbarDropdownItem = forwardRef<\n  HTMLDivElement,\n  AiToolbarDropdownItemProps\n>(({ children, onSelect, icon, className, ...props }, forwardedRef) => {\n  return (\n    <Command.Item\n      className={cn(\"lb-dropdown-item\", className)}\n      onSelect={onSelect}\n      {...props}\n      ref={forwardedRef}\n    >\n      {icon ? <span className=\"lb-icon-container\">{icon}</span> : null}\n      {children ? (\n        <span className=\"lb-dropdown-item-label\">{children}</span>\n      ) : null}\n    </Command.Item>\n  );\n});\n\nconst AiToolbarSuggestionsLabel = forwardRef<\n  HTMLDivElement,\n  AiToolbarSuggestionsLabelProps\n>(({ children, className, ...props }, forwardedRef) => {\n  return (\n    <span\n      ref={forwardedRef}\n      className={cn(\"lb-dropdown-label\", className)}\n      {...props}\n    >\n      {children}\n    </span>\n  );\n});\n\nconst AiToolbarSuggestion = forwardRef<\n  HTMLDivElement,\n  AiToolbarSuggestionProps\n>(({ prompt: manualPrompt, ...props }, forwardedRef) => {\n  const editor = useCurrentEditor(\"Suggestion\", \"AiToolbar\");\n\n  const handleSelect = useCallback(\n    (prompt: string) => {\n      (editor.commands as unknown as AiCommands).$startAiToolbarThinking(\n        manualPrompt ?? prompt\n      );\n    },\n    [editor, manualPrompt]\n  );\n\n  return (\n    <AiToolbarDropdownItem\n      {...props}\n      onSelect={handleSelect}\n      ref={forwardedRef}\n    />\n  );\n});\n\nfunction AiToolbarReviewingSuggestions() {\n  const editor = useCurrentEditor(\"ReviewingSuggestions\", \"AiToolbar\");\n  const { state } = useAiToolbarContext();\n  const { response } = state as Extract<AiToolbarState, { phase: \"reviewing\" }>;\n\n  if (isContextualPromptDiffResponse(response)) {\n    return (\n      <>\n        <AiToolbarDropdownItem\n          icon={<CheckIcon />}\n          onSelect={\n            (editor.commands as unknown as AiCommands).$acceptAiToolbarResponse\n          }\n        >\n          Accept\n        </AiToolbarDropdownItem>\n        <AiToolbarDropdownItem\n          icon={<UndoIcon />}\n          onSelect={\n            (editor.commands as unknown as AiCommands).$startAiToolbarThinking\n          }\n        >\n          Try again\n        </AiToolbarDropdownItem>\n        <AiToolbarDropdownItem\n          icon={<CrossIcon />}\n          onSelect={(editor.commands as unknown as AiCommands).$closeAiToolbar}\n        >\n          Discard\n        </AiToolbarDropdownItem>\n      </>\n    );\n  } else {\n    return (\n      <>\n        <AiToolbarDropdownItem\n          icon={<ArrowCornerDownRightIcon />}\n          onSelect={\n            (editor.commands as unknown as AiCommands).$acceptAiToolbarResponse\n          }\n        >\n          Insert below\n        </AiToolbarDropdownItem>\n        <AiToolbarDropdownItem\n          icon={<UndoIcon />}\n          onSelect={\n            (editor.commands as unknown as AiCommands).$startAiToolbarThinking\n          }\n        >\n          Try again\n        </AiToolbarDropdownItem>\n        <AiToolbarDropdownItem\n          icon={<CrossIcon />}\n          onSelect={(editor.commands as unknown as AiCommands).$closeAiToolbar}\n        >\n          Discard\n        </AiToolbarDropdownItem>\n      </>\n    );\n  }\n}\n\nfunction AiToolbarCustomPromptContent() {\n  const editor = useCurrentEditor(\"CustomPromptContent\", \"AiToolbar\");\n  const aiName = (editor.storage.liveblocksAi as AiExtensionStorage).name;\n  const textAreaRef = useRef<HTMLTextAreaElement>(null);\n  const { state, dropdownRef, isDropdownHidden } = useAiToolbarContext();\n  const { customPrompt } = state as Exclude<\n    AiToolbarState,\n    { phase: \"closed\" }\n  >;\n  const isCustomPromptEmpty = useMemo(\n    () => customPrompt.trim() === \"\",\n    [customPrompt]\n  );\n\n  useLayoutEffect(\n    () => {\n      requestAnimationFrame(() => {\n        const textArea = textAreaRef.current;\n\n        if (!textArea) {\n          return;\n        }\n\n        textArea.focus();\n        textArea.setSelectionRange(\n          textArea.value.length,\n          textArea.value.length\n        );\n      });\n    },\n    [] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  const handlePromptKeyDown = (\n    event: ReactKeyboardEvent<HTMLTextAreaElement>\n  ) => {\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (event.shiftKey) {\n        // If the shift key is pressed, add a new line\n        (editor.commands as unknown as AiCommands)._updateAiToolbarCustomPrompt(\n          (customPrompt) => customPrompt + \"\\n\"\n        );\n      } else {\n        const selectedDropdownItem = dropdownRef.current?.querySelector(\n          \"[role='option'][data-selected='true']\"\n        ) as HTMLElement | null;\n\n        if (!isDropdownHidden && selectedDropdownItem) {\n          // If there's a selected dropdown item, select it\n          selectedDropdownItem.click();\n        } else if (!isCustomPromptEmpty) {\n          // Otherwise, submit the custom prompt\n          (editor.commands as unknown as AiCommands).$startAiToolbarThinking(\n            customPrompt,\n            state.phase === \"reviewing\"\n          );\n        }\n      }\n    }\n  };\n\n  const handleCustomPromptChange = useCallback(\n    (customPrompt: string) => {\n      (editor.commands as unknown as AiCommands)._updateAiToolbarCustomPrompt(\n        customPrompt\n      );\n    },\n    [editor]\n  );\n\n  const handleSendClick = useCallback(() => {\n    if (isCustomPromptEmpty) {\n      return;\n    }\n\n    (editor.commands as unknown as AiCommands).$startAiToolbarThinking(\n      customPrompt,\n      state.phase === \"reviewing\"\n    );\n  }, [editor, customPrompt, isCustomPromptEmpty, state.phase]);\n\n  return (\n    <div className=\"lb-tiptap-ai-toolbar-content\">\n      <span className=\"lb-icon-container lb-tiptap-ai-toolbar-icon-container\">\n        <SparklesIcon />\n      </span>\n      <div\n        className=\"lb-tiptap-ai-toolbar-custom-prompt-container\"\n        data-value={customPrompt}\n      >\n        <Command.Input\n          value={customPrompt}\n          onValueChange={handleCustomPromptChange}\n          asChild\n        >\n          <textarea\n            ref={textAreaRef}\n            className=\"lb-tiptap-ai-toolbar-custom-prompt\"\n            placeholder={`Ask ${aiName} anything`}\n            onKeyDown={handlePromptKeyDown}\n            rows={1}\n            autoFocus\n          />\n        </Command.Input>\n      </div>\n      <div className=\"lb-tiptap-ai-toolbar-actions\">\n        <ShortcutTooltip content={`Ask ${aiName}`} shortcut=\"Enter\">\n          <Button\n            className=\"lb-tiptap-ai-toolbar-action\"\n            variant=\"primary\"\n            aria-label={`Ask ${aiName}`}\n            icon={<SendIcon />}\n            disabled={isCustomPromptEmpty}\n            onClick={handleSendClick}\n          />\n        </ShortcutTooltip>\n      </div>\n    </div>\n  );\n}\n\nfunction AiToolbarAsking() {\n  const { state } = useAiToolbarContext();\n  const { error } = state as Exclude<AiToolbarState, { phase: \"closed\" }>;\n\n  return (\n    <>\n      <AiToolbarCustomPromptContent />\n      {error ? (\n        <div className=\"lb-tiptap-ai-toolbar-error\">\n          <span className=\"lb-icon-container\">\n            <WarningIcon />\n          </span>\n          There was a problem with your request.\n        </div>\n      ) : null}\n    </>\n  );\n}\n\nfunction AiToolbarThinking() {\n  const editor = useCurrentEditor(\"AiToolbarThinking\", \"AiToolbar\");\n  const contentRef = useRef<HTMLDivElement>(null);\n  const aiName = (editor.storage.liveblocksAi as AiExtensionStorage).name;\n\n  const handleAbort = useCallback(() => {\n    (editor.commands as unknown as AiCommands).$cancelAiToolbarThinking();\n  }, [editor]);\n\n  // Focus the toolbar content and clear the current window selection while thinking\n  useLayoutEffect(() => {\n    contentRef.current?.focus();\n    window.getSelection()?.removeAllRanges();\n  }, []);\n\n  return (\n    <>\n      <div\n        className=\"lb-tiptap-ai-toolbar-content\"\n        tabIndex={0}\n        ref={contentRef}\n      >\n        <span className=\"lb-icon-container lb-tiptap-ai-toolbar-icon-container\">\n          <SparklesIcon />\n        </span>\n        <div className=\"lb-tiptap-ai-toolbar-thinking\">\n          {aiName} is thinking\n        </div>\n        <div className=\"lb-tiptap-ai-toolbar-actions\">\n          <ShortcutTooltip content=\"Abort response\" shortcut=\"Escape\">\n            <Button\n              className=\"lb-tiptap-ai-toolbar-action\"\n              variant=\"secondary\"\n              aria-label=\"Abort response\"\n              icon={<StopIcon />}\n              onClick={handleAbort}\n            />\n          </ShortcutTooltip>\n        </div>\n      </div>\n    </>\n  );\n}\n\nfunction AiToolbarReviewing() {\n  const { state } = useAiToolbarContext();\n  const { response } = state as Extract<AiToolbarState, { phase: \"reviewing\" }>;\n\n  return (\n    <>\n      {response.type === \"other\" ? (\n        <div className=\"lb-tiptap-ai-toolbar-response-container\">\n          <div className=\"lb-tiptap-ai-toolbar-response\">{response.text}</div>\n        </div>\n      ) : null}\n      <AiToolbarCustomPromptContent />\n    </>\n  );\n}\n\nfunction AiToolbarContainer({\n  state,\n  toolbarRef,\n  dropdownRef,\n  children,\n}: PropsWithChildren<{\n  state: AiToolbarState;\n  toolbarRef: RefObject<HTMLDivElement>;\n  dropdownRef: RefObject<HTMLDivElement>;\n}>) {\n  const editor = useCurrentEditor(\"AiToolbarContainer\", \"AiToolbar\");\n  const customPrompt = state.customPrompt;\n  const isCustomPromptMultiline = useMemo(\n    () => customPrompt?.includes(\"\\n\"),\n    [customPrompt]\n  );\n  const hasDropdownItems = useCommandState(\n    (state) => state.filtered.count > 0\n  ) as boolean;\n  const isDropdownHidden = isCustomPromptMultiline || !hasDropdownItems;\n\n  useEffect(() => {\n    if (!editor) {\n      return;\n    }\n\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (!event.defaultPrevented && event.key === \"Escape\") {\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (state.phase === \"thinking\") {\n          (editor.commands as unknown as AiCommands).$cancelAiToolbarThinking();\n        } else {\n          (editor.chain() as ChainedAiCommands).$closeAiToolbar().focus().run();\n        }\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleKeyDown);\n\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyDown);\n    };\n  }, [editor, state.phase]);\n\n  return (\n    <AiToolbarContext.Provider\n      value={{\n        state,\n        toolbarRef,\n        dropdownRef,\n        isDropdownHidden,\n      }}\n    >\n      <div className=\"lb-tiptap-ai-toolbar-container\">\n        <div className=\"lb-elevation lb-tiptap-ai-toolbar\">\n          {state.phase === \"asking\" ? (\n            <AiToolbarAsking />\n          ) : state.phase === \"thinking\" ? (\n            <AiToolbarThinking />\n          ) : state.phase === \"reviewing\" ? (\n            <AiToolbarReviewing />\n          ) : null}\n        </div>\n        <div\n          className=\"lb-tiptap-ai-toolbar-halo\"\n          data-active={state.phase === \"thinking\" ? \"\" : undefined}\n          aria-hidden\n        >\n          <div className=\"lb-tiptap-ai-toolbar-halo-horizontal\" />\n          <div className=\"lb-tiptap-ai-toolbar-halo-vertical\" />\n        </div>\n      </div>\n      {state.phase === \"asking\" || state.phase === \"reviewing\" ? (\n        <Command.List\n          className=\"lb-elevation lb-dropdown lb-tiptap-ai-toolbar-dropdown\"\n          data-hidden={isDropdownHidden ? \"\" : undefined}\n          ref={dropdownRef}\n        >\n          {state.phase === \"reviewing\" ? (\n            <AiToolbarReviewingSuggestions />\n          ) : (\n            children\n          )}\n        </Command.List>\n      ) : null}\n    </AiToolbarContext.Provider>\n  );\n}\n\nconst defaultSuggestions = (\n  <>\n    <AiToolbarSuggestion\n      icon={<EditIcon />}\n      prompt=\"Improve the quality of the text\"\n    >\n      Improve writing\n    </AiToolbarSuggestion>\n    <AiToolbarSuggestion\n      icon={<CheckIcon />}\n      prompt=\"Fix spelling & grammar errors in the text\"\n    >\n      Fix mistakes\n    </AiToolbarSuggestion>\n    <AiToolbarSuggestion\n      icon={<ShortenIcon />}\n      prompt=\"Shorten the text, simplifying it\"\n    >\n      Simplify\n    </AiToolbarSuggestion>\n    <AiToolbarSuggestion\n      icon={<LengthenIcon />}\n      prompt=\"Lengthen the text, going into more detail\"\n    >\n      Add more detail\n    </AiToolbarSuggestion>\n    <AiToolbarSuggestionsSeparator />\n    <AiToolbarSuggestion\n      icon={<SparklesTextIcon />}\n      prompt=\"Continue writing from the text's end\"\n    >\n      Continue writing\n    </AiToolbarSuggestion>\n    <AiToolbarSuggestion\n      icon={<QuestionMarkIcon />}\n      prompt=\"Explain what the text is about\"\n    >\n      Explain\n    </AiToolbarSuggestion>\n  </>\n);\n\n/**\n * @beta\n *\n * A floating AI toolbar attached to the editor.\n */\nexport const AiToolbar = Object.assign(\n  forwardRef<HTMLDivElement, AiToolbarProps>(\n    (\n      {\n        offset: sideOffset = 6,\n        editor,\n        className,\n        suggestions: Suggestions = defaultSuggestions,\n        ...props\n      },\n      forwardedRef\n    ) => {\n      const state =\n        useEditorState({\n          editor,\n          selector: (ctx) => {\n            return (\n              ctx.editor?.storage.liveblocksAi as AiExtensionStorage | undefined\n            )?.state;\n          },\n        }) ?? DEFAULT_STATE;\n      const selection = editor?.state.selection;\n      const floatingOptions: UseFloatingOptions = useMemo(() => {\n        const detectOverflowOptions: DetectOverflowOptions = {\n          padding: AI_TOOLBAR_COLLISION_PADDING,\n        };\n\n        return {\n          strategy: \"fixed\",\n          placement: \"bottom\",\n          middleware: [\n            tiptapFloating(editor),\n            hide(detectOverflowOptions),\n            offset(sideOffset),\n            shift({\n              ...detectOverflowOptions,\n              mainAxis: false,\n              crossAxis: true,\n              limiter: limitShift(),\n            }),\n            flipToolbar(),\n          ],\n          whileElementsMounted: (...args) => {\n            return autoUpdate(...args, {\n              animationFrame: true,\n            });\n          },\n        };\n      }, [editor, sideOffset]);\n      const isOpen = selection !== undefined && state.phase !== \"closed\";\n      const {\n        refs: { setReference, setFloating },\n        strategy,\n        x,\n        y,\n        isPositioned,\n      } = useFloating({\n        ...floatingOptions,\n        open: isOpen,\n      });\n      const toolbarRef = useRef<HTMLDivElement>(null);\n      const mergedRefs = useRefs(forwardedRef, toolbarRef, setFloating);\n      const dropdownRef = useRef<HTMLDivElement>(null);\n      const [selectedDropdownValue, setSelectedDropdownValue] = useState(\"\");\n\n      // Reset the selected dropdown value when the toolbar is closed\n      useEffect(() => {\n        if (state.phase === \"closed\") {\n          setSelectedDropdownValue(\"\");\n        }\n      }, [state.phase]);\n\n      useEffect(() => {\n        // Reset the selected dropdown value when the dropdown is closed\n        if (state.phase === \"closed\") {\n          setSelectedDropdownValue(\"\");\n\n          return;\n        }\n\n        // Otherwise, make sure a dropdown item is selected when moving between phases\n        const selectedDropdownItem = dropdownRef.current?.querySelector(\n          \"[role='option'][data-selected='true']\"\n        );\n\n        if (selectedDropdownItem) {\n          return;\n        }\n\n        const firstDropdownItem =\n          dropdownRef.current?.querySelector(\"[role='option']\");\n\n        setSelectedDropdownValue(\n          (firstDropdownItem as HTMLElement | null)?.dataset.value ?? \"\"\n        );\n      }, [state.phase, dropdownRef, setSelectedDropdownValue]);\n\n      useEffect(() => {\n        if (!editor) {\n          return;\n        }\n\n        if (!selection && state.phase !== \"closed\") {\n          (editor.commands as unknown as AiCommands).$closeAiToolbar();\n        }\n      }, [state.phase, editor, selection]);\n\n      useLayoutEffect(() => {\n        if (!editor || !isOpen) {\n          return;\n        }\n\n        setReference(null);\n\n        setTimeout(() => {\n          if (\n            state.phase === \"reviewing\" &&\n            isContextualPromptDiffResponse(state.response)\n          ) {\n            const changes = editor.view.dom.querySelectorAll(\n              \"ychange[data-liveblocks]\"\n            );\n\n            // When diffs are displayed, we manually calculate bounds around all the\n            // rendered changes instead of using the selection\n            setReference({\n              getBoundingClientRect: () => {\n                const rects: DOMRect[] = [];\n\n                changes.forEach((change) => {\n                  rects.push(change.getBoundingClientRect());\n                });\n\n                const minX = Math.min(...rects.map((rect) => rect.left));\n                const minY = Math.min(...rects.map((rect) => rect.top));\n                const maxX = Math.max(...rects.map((rect) => rect.right));\n                const maxY = Math.max(...rects.map((rect) => rect.bottom));\n\n                return {\n                  x: minX,\n                  y: minY,\n                  width: maxX - minX,\n                  height: maxY - minY,\n                  top: minY,\n                  left: minX,\n                  bottom: maxY,\n                  right: maxX,\n                };\n              },\n            });\n          } else if (selection) {\n            const domRange = getDomRangeFromSelection(editor, selection);\n            setReference(domRange);\n          } else {\n            setReference(null);\n          }\n        }, 0);\n      }, [\n        selection,\n        editor,\n        isOpen,\n        setReference,\n        state.phase,\n        state.response,\n      ]);\n\n      // Close the toolbar when clicking anywhere outside of it\n      useEffect(() => {\n        if (!editor || !isOpen) {\n          return;\n        }\n\n        const handleOutsideEvent = (event: MouseEvent) => {\n          if (!toolbarRef.current) {\n            return;\n          }\n\n          if (\n            event.target &&\n            !toolbarRef.current.contains(event.target as Node) &&\n            (dropdownRef.current\n              ? !dropdownRef.current.contains(event.target as Node)\n              : true)\n          ) {\n            (editor.commands as unknown as AiCommands).$closeAiToolbar();\n          }\n        };\n\n        setTimeout(() => {\n          document.addEventListener(\"pointerdown\", handleOutsideEvent);\n        }, 0);\n\n        return () => {\n          document.removeEventListener(\"pointerdown\", handleOutsideEvent);\n        };\n      }, [editor, isOpen]);\n\n      if (!editor || !isOpen) {\n        return null;\n      }\n\n      return createPortal(\n        <TooltipProvider>\n          <EditorProvider editor={editor}>\n            <Command\n              role=\"toolbar\"\n              label=\"AI toolbar\"\n              aria-orientation=\"horizontal\"\n              className={cn(\n                \"lb-root lb-portal lb-tiptap-ai-toolbar-portal\",\n                className\n              )}\n              ref={mergedRefs}\n              style={{\n                position: strategy,\n                top: 0,\n                left: 0,\n                transform: isPositioned\n                  ? `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`\n                  : \"translate3d(0, -200%, 0)\",\n              }}\n              value={selectedDropdownValue}\n              onValueChange={setSelectedDropdownValue}\n              {...props}\n            >\n              <AiToolbarContainer\n                state={state}\n                dropdownRef={dropdownRef}\n                toolbarRef={toolbarRef}\n              >\n                {typeof Suggestions === \"function\" ? (\n                  <Suggestions children={defaultSuggestions} />\n                ) : (\n                  Suggestions\n                )}\n              </AiToolbarContainer>\n            </Command>\n          </EditorProvider>\n        </TooltipProvider>,\n        document.body\n      );\n    }\n  ),\n  {\n    /**\n     * @beta\n     *\n     * A prompt suggestion displayed in the AI toolbar.\n     */\n    Suggestion: AiToolbarSuggestion,\n\n    /**\n     * @beta\n     *\n     * A label to describe a group of prompt suggestions displayed in the AI toolbar.\n     */\n    SuggestionsLabel: AiToolbarSuggestionsLabel,\n\n    /**\n     * @beta\n     *\n     * A separator between groups of prompt suggestions displayed in the AI toolbar.\n     */\n    SuggestionsSeparator: AiToolbarSuggestionsSeparator,\n  }\n);\n", "declare const __VERSION__: string;\ndeclare const ROLLUP_FORMAT: string;\n\nexport const PKG_NAME = \"@liveblocks/react-ui\";\nexport const PKG_VERSION = typeof __VERSION__ === \"string\" && __VERSION__;\nexport const PKG_FORMAT = typeof ROLLUP_FORMAT === \"string\" && ROLLUP_FORMAT;\n", "import { useLatest } from \"@liveblocks/react/_private\";\nimport { type RefObject, useEffect, useState } from \"react\";\n\ninterface ObserveOptions {\n  rootMargin?: string | number;\n  root?: RefObject<Element>;\n  threshold?: number | number[];\n}\n\ninterface Options extends ObserveOptions {\n  enabled?: boolean;\n}\n\ninterface VisibleOptions<T = boolean> extends Options {\n  initialValue?: T;\n}\n\ntype IntersectionObserverSingleCallback = (\n  entry: IntersectionObserverEntry\n) => void;\n\nlet optionlessIntersectionObserver: IntersectionObserver | undefined;\nconst optionlessIntersectionCallbacks = new WeakMap<\n  Element,\n  IntersectionObserverSingleCallback\n>();\n\nconst individualIntersectionObservers = new WeakMap<\n  Element,\n  IntersectionObserver\n>();\n\nfunction observe(\n  element: Element,\n  callback: IntersectionObserverSingleCallback,\n  options?: ObserveOptions\n) {\n  // Observers without options share a common IntersectionObserver instance, ones with options have their own\n  if (!options) {\n    if (!optionlessIntersectionObserver) {\n      optionlessIntersectionObserver = new IntersectionObserver((entries) => {\n        for (const entry of entries) {\n          const callback = optionlessIntersectionCallbacks.get(entry.target);\n\n          callback?.(entry);\n        }\n      });\n    }\n\n    optionlessIntersectionCallbacks.set(element, callback);\n    optionlessIntersectionObserver.observe(element);\n  } else {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        for (const entry of entries) {\n          callback?.(entry);\n        }\n      },\n      {\n        root: options.root?.current,\n        rootMargin:\n          typeof options.rootMargin === \"number\"\n            ? `${options.rootMargin}px`\n            : options.rootMargin,\n        threshold: options.threshold,\n      }\n    );\n\n    individualIntersectionObservers.set(element, observer);\n    observer.observe(element);\n  }\n}\n\nfunction unobserve(element: Element, options?: ObserveOptions) {\n  if (!options) {\n    optionlessIntersectionCallbacks.delete(element);\n    optionlessIntersectionObserver?.unobserve(element);\n  } else {\n    const observer = individualIntersectionObservers.get(element);\n\n    observer?.unobserve(element);\n    individualIntersectionObservers.delete(element);\n  }\n}\n\n/**\n * Observe when an element enters or exits the viewport.\n *\n * If you only need to get a stateful visibility value, use the higher level hook `useVisible` instead.\n */\nexport function useIntersectionCallback(\n  ref: RefObject<Element>,\n  callback: (isIntersecting: boolean, entry: IntersectionObserverEntry) => void,\n  options?: Options\n) {\n  const enabled = options?.enabled ?? true;\n  const latestCallback = useLatest(callback);\n  const { root, rootMargin, threshold } = options ?? {};\n\n  useEffect(() => {\n    const element = ref.current;\n\n    if (!element) {\n      return;\n    }\n\n    const observeOptions: ObserveOptions = {\n      root,\n      rootMargin,\n      threshold,\n    };\n\n    if (enabled) {\n      observe(\n        element,\n        (entry) => {\n          // The intersection observer entry might be useful in some cases but the main information\n          // is whether the element is intersecting or not so we pass that as the first argument.\n          latestCallback.current(entry.isIntersecting, entry);\n        },\n        observeOptions\n      );\n    } else {\n      unobserve(element, observeOptions);\n    }\n\n    return () => {\n      unobserve(element, observeOptions);\n    };\n  }, [ref, enabled, latestCallback, root, rootMargin, threshold]);\n}\n\n/**\n * Observe whether an element is currently visible or not.\n */\nexport function useVisible<T extends boolean | null = boolean>(\n  ref: RefObject<Element>,\n  options?: VisibleOptions<T>\n) {\n  const [isVisible, setVisible] = useState(\n    options?.initialValue !== undefined ? options.initialValue : false\n  );\n\n  useIntersectionCallback(\n    ref,\n    (isIntersecting) => setVisible(isIntersecting),\n    options\n  );\n\n  return isVisible;\n}\n", "import type { AiAssistantMessage, WithNavigation } from \"@liveblocks/core\";\nimport {\n  type ComponentProps,\n  forwardRef,\n  memo,\n  type ReactNode,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { type GlobalComponents } from \"../../components\";\nimport { ChevronRightIcon } from \"../../icons/ChevronRight\";\nimport { WarningIcon } from \"../../icons/Warning\";\nimport {\n  type AiChatMessageOverrides,\n  type GlobalOverrides,\n  OverridesProvider,\n  useOverrides,\n} from \"../../overrides\";\nimport * as AiMessage from \"../../primitives/AiMessage\";\nimport { AiMessageToolInvocation } from \"../../primitives/AiMessage/tool-invocation\";\nimport type {\n  AiMessageContentReasoningPartProps,\n  AiMessageContentRetrievalPartProps,\n  AiMessageContentTextPartProps,\n  AiMessageContentToolInvocationPartProps,\n} from \"../../primitives/AiMessage/types\";\nimport * as Collapsible from \"../../primitives/Collapsible\";\nimport type { MarkdownComponents } from \"../../primitives/Markdown\";\nimport { cn } from \"../../utils/cn\";\nimport { ErrorBoundary } from \"../../utils/ErrorBoundary\";\nimport { Prose } from \"./Prose\";\n\ntype UiAssistantMessage = WithNavigation<AiAssistantMessage>;\n\ntype AiChatAssistantMessageComponents = {\n  /**\n   * The components used to render Markdown content.\n   */\n  markdown?: Partial<MarkdownComponents>;\n};\n\n/* -------------------------------------------------------------------------------------------------\n * AiChatAssistantMessage\n * -----------------------------------------------------------------------------------------------*/\nexport interface AiChatAssistantMessageProps extends ComponentProps<\"div\"> {\n  /**\n   * The message to display.\n   */\n  message: UiAssistantMessage;\n\n  /**\n   * Override the component's strings.\n   */\n  overrides?: Partial<GlobalOverrides & AiChatMessageOverrides>;\n\n  /**\n   * Override the component's components.\n   */\n  components?: Partial<GlobalComponents & AiChatAssistantMessageComponents>;\n}\n\ninterface TextPartProps extends AiMessageContentTextPartProps {\n  components?: Partial<GlobalComponents & AiChatAssistantMessageComponents>;\n}\n\ninterface ReasoningPartProps extends AiMessageContentReasoningPartProps {\n  components?: Partial<GlobalComponents & AiChatAssistantMessageComponents>;\n}\n\ninterface RetrievalPartProps extends AiMessageContentRetrievalPartProps {\n  components?: Partial<GlobalComponents & AiChatAssistantMessageComponents>;\n}\n\nexport const AiChatAssistantMessage = memo(\n  forwardRef<HTMLDivElement, AiChatAssistantMessageProps>(\n    ({ message, className, overrides, components, ...props }, forwardedRef) => {\n      const $ = useOverrides(overrides);\n\n      let children: ReactNode = null;\n\n      if (message.deletedAt !== undefined) {\n        children = (\n          <div className=\"lb-ai-chat-message-deleted\">\n            {$.AI_CHAT_MESSAGE_DELETED}\n          </div>\n        );\n      } else if (\n        message.status === \"generating\" ||\n        message.status === \"awaiting-tool\"\n      ) {\n        if (message.contentSoFar.length === 0) {\n          children = (\n            <div className=\"lb-ai-chat-message-thinking lb-ai-chat-pending\">\n              {$.AI_CHAT_MESSAGE_THINKING}\n            </div>\n          );\n        } else {\n          children = (\n            <AssistantMessageContent\n              message={message}\n              components={components}\n            />\n          );\n        }\n      } else if (message.status === \"completed\") {\n        children = (\n          <AssistantMessageContent message={message} components={components} />\n        );\n      } else if (message.status === \"failed\") {\n        // Do not include the error message if the user aborted the request.\n        if (message.errorReason === \"Aborted by user\") {\n          children = (\n            <AssistantMessageContent\n              message={message}\n              components={components}\n            />\n          );\n        } else {\n          children = (\n            <>\n              <AssistantMessageContent\n                message={message}\n                components={components}\n              />\n\n              <div className=\"lb-ai-chat-message-error\">\n                <span className=\"lb-icon-container\">\n                  <WarningIcon />\n                </span>\n                {message.errorReason}\n              </div>\n            </>\n          );\n        }\n      }\n\n      return (\n        <div\n          className={cn(\n            \"lb-ai-chat-message lb-ai-chat-assistant-message\",\n            className\n          )}\n          {...props}\n          ref={forwardedRef}\n        >\n          <OverridesProvider overrides={overrides}>\n            {children}\n          </OverridesProvider>\n        </div>\n      );\n    }\n  )\n);\n\nfunction AssistantMessageContent({\n  message,\n  components,\n}: {\n  message: UiAssistantMessage;\n  components?: Partial<GlobalComponents & AiChatAssistantMessageComponents>;\n}) {\n  const ref = useRef(components);\n  const BoundTextPart = useMemo(\n    () => (props: TextPartProps) => (\n      <TextPart {...props} components={ref.current} />\n    ),\n    []\n  );\n  const BoundReasoningPart = useMemo(\n    () => (props: ReasoningPartProps) => (\n      <ReasoningPart {...props} components={ref.current} />\n    ),\n    []\n  );\n  return (\n    <AiMessage.Content\n      message={message}\n      components={{\n        TextPart: BoundTextPart,\n        ReasoningPart: BoundReasoningPart,\n        RetrievalPart,\n        ToolInvocationPart,\n      }}\n      className=\"lb-ai-chat-message-content\"\n    />\n  );\n}\n\n/* -------------------------------------------------------------------------------------------------\n * TextPart\n * -----------------------------------------------------------------------------------------------*/\nfunction TextPart({ part, components, isStreaming }: TextPartProps) {\n  return (\n    <Prose\n      content={part.text}\n      className=\"lb-ai-chat-message-text\"\n      components={components}\n      partial={isStreaming}\n    />\n  );\n}\n\n/* -------------------------------------------------------------------------------------------------\n * ReasoningPart\n * -----------------------------------------------------------------------------------------------*/\nfunction ReasoningPart({ part, isStreaming, components }: ReasoningPartProps) {\n  // Start collapsed if reasoning is already done.\n  const [isOpen, setIsOpen] = useState(isStreaming);\n  const $ = useOverrides();\n\n  // Auto-collapse when reasoning is done, while still allowing the user to\n  // open/collapse it manually during and after it's done.\n  useEffect(() => {\n    if (!isStreaming) {\n      setIsOpen(false);\n    }\n  }, [isStreaming]);\n\n  return (\n    <Collapsible.Root\n      className=\"lb-collapsible lb-ai-chat-message-reasoning\"\n      open={isOpen}\n      onOpenChange={setIsOpen}\n    >\n      <Collapsible.Trigger\n        className={cn(\n          \"lb-collapsible-trigger\",\n          isStreaming && \"lb-ai-chat-pending\"\n        )}\n      >\n        {$.AI_CHAT_MESSAGE_REASONING(isStreaming, part)}\n        <span className=\"lb-collapsible-chevron lb-icon-container\">\n          <ChevronRightIcon />\n        </span>\n      </Collapsible.Trigger>\n\n      <Collapsible.Content className=\"lb-collapsible-content\">\n        <Prose\n          content={part.text}\n          partial={isStreaming}\n          components={components}\n        />\n      </Collapsible.Content>\n    </Collapsible.Root>\n  );\n}\n\n/* -------------------------------------------------------------------------------------------------\n * RetrievalPart\n * -----------------------------------------------------------------------------------------------*/\nfunction RetrievalPart({ part, isStreaming }: RetrievalPartProps) {\n  const $ = useOverrides();\n\n  return (\n    <div\n      className={cn(\n        \"lb-ai-chat-message-retrieval\",\n        isStreaming && \"lb-ai-chat-pending\"\n      )}\n    >\n      {$.AI_CHAT_MESSAGE_RETRIEVAL(isStreaming, part)}\n    </div>\n  );\n}\n\n/* -------------------------------------------------------------------------------------------------\n * ToolInvocationPart\n * -----------------------------------------------------------------------------------------------*/\nfunction ToolInvocationPart({\n  part,\n  message,\n}: AiMessageContentToolInvocationPartProps) {\n  return (\n    <div className=\"lb-ai-chat-message-tool-invocation\">\n      <ErrorBoundary\n        fallback={\n          <div className=\"lb-ai-chat-message-error\">\n            <span className=\"lb-icon-container\">\n              <WarningIcon />\n            </span>\n            <p>\n              Failed to render tool call result for <code>{part.name}</code>.\n              See console for details.\n            </p>\n          </div>\n        }\n      >\n        <AiMessageToolInvocation part={part} message={message} />\n      </ErrorBoundary>\n    </div>\n  );\n}\n", "import type { AiUserMessage, WithNavigation } from \"@liveblocks/core\";\nimport type { ComponentProps } from \"react\";\nimport { forwardRef, memo } from \"react\";\n\nimport type { GlobalComponents } from \"../../components\";\nimport { type GlobalOverrides, useOverrides } from \"../../overrides\";\nimport * as AiMessage from \"../../primitives/AiMessage\";\nimport type { AiMessageContentTextPartProps } from \"../../primitives/AiMessage/types\";\nimport type { MarkdownComponents } from \"../../primitives/Markdown\";\nimport { cn } from \"../../utils/cn\";\nimport { Prose } from \"./Prose\";\n\ntype UiUserMessage = WithNavigation<AiUserMessage>;\n\ntype AiChatUserMessageComponents = {\n  /**\n   * The components used to render Markdown content.\n   */\n  markdown?: Partial<MarkdownComponents>;\n};\n\n/* -------------------------------------------------------------------------------------------------\n * AiChatUserMessage\n * -----------------------------------------------------------------------------------------------*/\nexport interface AiChatUserMessageProps extends ComponentProps<\"div\"> {\n  /**\n   * The message to display.\n   */\n  message: UiUserMessage;\n\n  /**\n   * Override the component's strings.\n   */\n  overrides?: Partial<GlobalOverrides>;\n\n  /**\n   * Override the component's components.\n   */\n  components?: Partial<GlobalComponents & AiChatUserMessageComponents>;\n}\n\ninterface TextPartProps extends AiMessageContentTextPartProps {\n  components?: Partial<GlobalComponents & AiChatUserMessageComponents>;\n}\n\nfunction TextPart({ part, components }: TextPartProps) {\n  return (\n    <Prose\n      content={part.text}\n      className=\"lb-ai-chat-message-text\"\n      components={components}\n    />\n  );\n}\n\nexport const AiChatUserMessage = memo(\n  forwardRef<HTMLDivElement, AiChatUserMessageProps>(\n    ({ message, className, overrides, components, ...props }, forwardedRef) => {\n      const $ = useOverrides(overrides);\n      return (\n        <div\n          ref={forwardedRef}\n          className={cn(\n            \"lb-ai-chat-message lb-ai-chat-user-message\",\n            className\n          )}\n          {...props}\n        >\n          {message.deletedAt !== undefined ? (\n            <div className=\"lb-ai-chat-message-deleted\">\n              {$.AI_CHAT_MESSAGE_DELETED}\n            </div>\n          ) : (\n            <AiMessage.Content\n              className=\"lb-ai-chat-message-content\"\n              message={message}\n              components={{\n                TextPart: (props) => (\n                  <TextPart {...props} components={components} />\n                ),\n              }}\n            />\n          )}\n        </div>\n      );\n    }\n  )\n);\n", "import {\n  type AiChatMessage,\n  type AiKnowledgeSource,\n  type CopilotId,\n  type MessageId,\n} from \"@liveblocks/core\";\nimport {\n  useSendAiMessage,\n  type UseSendAiMessageOptions,\n} from \"@liveblocks/react\";\nimport {\n  type ComponentProps,\n  type FormEvent,\n  forwardRef,\n  type SyntheticEvent,\n  useCallback,\n} from \"react\";\n\nimport { SendIcon } from \"../../icons/Send\";\nimport { StopIcon } from \"../../icons/Stop\";\nimport {\n  type AiComposerOverrides,\n  type GlobalOverrides,\n  useOverrides,\n} from \"../../overrides\";\nimport * as AiComposerPrimitive from \"../../primitives/AiComposer\";\nimport { useAiComposer } from \"../../primitives/AiComposer/contexts\";\nimport type {\n  AiComposerEditorProps,\n  AiComposerFormProps,\n  AiComposerSubmitMessage,\n} from \"../../primitives/AiComposer/types\";\nimport { cn } from \"../../utils/cn\";\nimport { Button } from \"./Button\";\nimport { ShortcutTooltip, TooltipProvider } from \"./Tooltip\";\n\n/* -------------------------------------------------------------------------------------------------\n * AiComposer\n * -----------------------------------------------------------------------------------------------*/\nexport interface AiComposerProps\n  extends Omit<ComponentProps<\"form\">, \"defaultValue\"> {\n  /**\n   * The composer's initial value.\n   */\n  defaultValue?: string;\n\n  /**\n   * The event handler called when the composer is submitted.\n   */\n  onComposerSubmit?: (\n    message: AiComposerSubmitMessage,\n    event: FormEvent<HTMLFormElement>\n  ) => void;\n\n  /**\n   * The event handler called after the composer is submitted.\n   *\n   * @internal This API will change, and is not considered stable. DO NOT RELY on it.\n   */\n  onComposerSubmitted?: (message: AiChatMessage) => void;\n\n  /**\n   * Whether the composer is disabled.\n   */\n  disabled?: AiComposerFormProps[\"disabled\"];\n\n  /**\n   * Whether to focus the composer on mount.\n   */\n  autoFocus?: AiComposerEditorProps[\"autoFocus\"];\n\n  /**\n   * Override the component's strings.\n   */\n  overrides?: Partial<GlobalOverrides & AiComposerOverrides>;\n\n  /**\n   * The ID of the chat the composer belongs to.\n   */\n  chatId: string;\n\n  /**\n   * The ID of the copilot to use to send the message.\n   */\n  copilotId?: CopilotId;\n\n  /**\n   * @internal\n   */\n  knowledge?: AiKnowledgeSource[];\n\n  /**\n   * @internal\n   */\n  branchId?: MessageId;\n\n  /**\n   * @internal\n   */\n  stream?: boolean;\n}\n\nfunction AiComposerAction({\n  overrides,\n}: {\n  overrides?: AiComposerProps[\"overrides\"];\n}) {\n  const { canAbort } = useAiComposer();\n  const $ = useOverrides(overrides);\n\n  const preventDefault = useCallback((event: SyntheticEvent) => {\n    event.preventDefault();\n  }, []);\n\n  const stopPropagation = useCallback((event: SyntheticEvent) => {\n    event.stopPropagation();\n  }, []);\n\n  return canAbort ? (\n    <ShortcutTooltip content={$.AI_COMPOSER_ABORT}>\n      <AiComposerPrimitive.Abort asChild>\n        <Button\n          onPointerDown={preventDefault}\n          onClick={stopPropagation}\n          className=\"lb-ai-composer-action\"\n          variant=\"secondary\"\n          aria-label={$.AI_COMPOSER_ABORT}\n          icon={<StopIcon />}\n        />\n      </AiComposerPrimitive.Abort>\n    </ShortcutTooltip>\n  ) : (\n    <ShortcutTooltip content={$.AI_COMPOSER_SEND} shortcut=\"Enter\">\n      <AiComposerPrimitive.Submit asChild>\n        <Button\n          onPointerDown={preventDefault}\n          onClick={stopPropagation}\n          className=\"lb-ai-composer-action\"\n          variant=\"primary\"\n          aria-label={$.AI_COMPOSER_SEND}\n          icon={<SendIcon />}\n        />\n      </AiComposerPrimitive.Submit>\n    </ShortcutTooltip>\n  );\n}\n\nexport const AiComposer = forwardRef<HTMLFormElement, AiComposerProps>(\n  (\n    {\n      defaultValue,\n      onComposerSubmit,\n      disabled,\n      autoFocus,\n      overrides,\n      className,\n      chatId,\n      knowledge: localKnowledge,\n      branchId,\n      copilotId,\n      stream = true,\n      onComposerSubmitted,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const $ = useOverrides(overrides);\n    const sendAiMessage = useSendAiMessage(chatId, {\n      stream,\n      copilotId,\n\n      // TODO: We shouldn't need to pass knowledge from AiChat to AiComposer\n      //       to useSendAiMessage, ideally it would be attached to a chat ID\n      //       behind the scenes inside AiChat.\n      knowledge: localKnowledge,\n    } as UseSendAiMessageOptions);\n\n    const handleComposerSubmit = useCallback(\n      (message: AiComposerSubmitMessage, event: FormEvent<HTMLFormElement>) => {\n        onComposerSubmit?.(message, event);\n\n        if (event.isDefaultPrevented()) return;\n\n        const newMessage = sendAiMessage(message.text);\n\n        onComposerSubmitted?.(newMessage);\n      },\n      [onComposerSubmit, sendAiMessage, onComposerSubmitted]\n    );\n\n    return (\n      <TooltipProvider>\n        <AiComposerPrimitive.Form\n          className={cn(\n            \"lb-root lb-ai-composer lb-ai-composer-form\",\n            className\n          )}\n          dir={$.dir}\n          {...props}\n          disabled={disabled}\n          ref={forwardedRef}\n          onComposerSubmit={handleComposerSubmit}\n          chatId={chatId}\n          branchId={branchId}\n        >\n          <div className=\"lb-ai-composer-editor-container\">\n            <AiComposerPrimitive.Editor\n              autoFocus={autoFocus}\n              className=\"lb-ai-composer-editor\"\n              placeholder={$.AI_COMPOSER_PLACEHOLDER}\n              defaultValue={defaultValue}\n            />\n\n            <div className=\"lb-ai-composer-footer\">\n              <div className=\"lb-ai-composer-editor-actions\">\n                {/* No actions for now but it makes sense to keep the DOM structure */}\n              </div>\n\n              <div className=\"lb-ai-composer-actions\">\n                <AiComposerAction overrides={overrides} />\n              </div>\n            </div>\n          </div>\n        </AiComposerPrimitive.Form>\n      </TooltipProvider>\n    );\n  }\n);\n", "import type {\n  AiKnowledgeSource,\n  AiOpaqueToolDefinition,\n  CopilotId,\n  MessageId,\n} from \"@liveblocks/core\";\nimport { RegisterAiTool, useAiChatMessages } from \"@liveblocks/react\";\nimport { useLatest } from \"@liveblocks/react/_private\";\nimport {\n  type ComponentProps,\n  type ComponentType,\n  forwardRef,\n  type MutableRefObject,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from \"react\";\n\nimport type { GlobalComponents } from \"../components\";\nimport { ArrowDownIcon } from \"../icons/ArrowDown\";\nimport { SpinnerIcon } from \"../icons/Spinner\";\nimport {\n  type AiChatMessageOverrides,\n  type AiChatOverrides,\n  type AiComposerOverrides,\n  type GlobalOverrides,\n  useOverrides,\n} from \"../overrides\";\nimport type { MarkdownComponents } from \"../primitives/Markdown\";\nimport { cn } from \"../utils/cn\";\nimport { useIntersectionCallback } from \"../utils/use-visible\";\nimport { AiChatAssistantMessage } from \"./internal/AiChatAssistantMessage\";\nimport { AiChatUserMessage } from \"./internal/AiChatUserMessage\";\nimport { AiComposer, type AiComposerProps } from \"./internal/AiComposer\";\n\n/**\n * The minimum number of pixels from the bottom of the scrollable area\n * before showing the scroll to bottom indicator.\n */\nconst MIN_DISTANCE_BOTTOM_SCROLL_INDICATOR = 60;\n\nexport type AiChatComponentsEmptyProps = {\n  /**\n   * The chat ID provided to the `AiChat` component.\n   */\n  chatId: string;\n\n  /**\n   * The copilot ID provided to the `AiChat` component.\n   */\n  copilotId?: string;\n};\n\nexport type AiChatComponentsLoadingProps = Record<string, never>;\n\nexport type AiChatComponents = {\n  /**\n   * The component used to render the empty state of the chat.\n   */\n  Empty: ComponentType<AiChatComponentsEmptyProps>;\n\n  /**\n   * The component used to render the loading state of the chat.\n   */\n  Loading: ComponentType<AiChatComponentsLoadingProps>;\n\n  /**\n   * The components used to render Markdown content.\n   */\n  markdown?: Partial<MarkdownComponents>;\n};\n\nexport interface AiChatProps extends ComponentProps<\"div\"> {\n  /**\n   * The ID of the chat the composer belongs to.\n   */\n  chatId: string;\n\n  /**\n   * Whether to focus the chat composer on mount.\n   */\n  autoFocus?: boolean;\n\n  /**\n   * The ID of the copilot to use to send the message.\n   */\n  copilotId?: string;\n\n  /**\n   * The contextual knowledge to include in the chat. May be used by the\n   * assistant when generating responses. In addition to the knowledge passed\n   * in via this prop, the AiChat instance will also have access to any\n   * globally registered knowledge via <RegisterAiKnowledge />.\n   */\n  knowledge?: AiKnowledgeSource[];\n\n  /**\n   * Tool definitions to make available within this chat. May be used by the assistant when generating responses.\n   */\n  tools?: Record<string, AiOpaqueToolDefinition>;\n\n  /**\n   * The event handler called when the composer is submitted.\n   */\n  onComposerSubmit?: AiComposerProps[\"onComposerSubmit\"];\n\n  /**\n   * The layout of the chat and its composer.\n   */\n  layout?: \"inset\" | \"compact\";\n\n  /**\n   * Override the component's strings.\n   */\n  overrides?: Partial<\n    GlobalOverrides &\n      AiComposerOverrides &\n      AiChatMessageOverrides &\n      AiChatOverrides\n  >;\n\n  /**\n   * Override the component's components.\n   */\n  components?: Partial<GlobalComponents & AiChatComponents>;\n}\n\ninterface AiChatMessagesProps extends ComponentProps<\"div\"> {\n  messages: NonNullable<ReturnType<typeof useAiChatMessages>[\"messages\"]>;\n  overrides: AiChatProps[\"overrides\"];\n  components: AiChatProps[\"components\"];\n  lastSentMessageId: MessageId | null;\n  scrollToBottom: MutableRefObject<\n    (behavior: \"instant\" | \"smooth\", includeTrailingSpace?: boolean) => void\n  >;\n  onScrollAtBottomChange: MutableRefObject<\n    (isScrollAtBottom: boolean | null) => void\n  >;\n  containerRef: MutableRefObject<HTMLDivElement | null>;\n  footerRef: MutableRefObject<HTMLDivElement | null>;\n  messagesRef: MutableRefObject<HTMLDivElement | null>;\n  bottomTrailingMarkerRef: MutableRefObject<HTMLDivElement | null>;\n  trailingSpacerRef: MutableRefObject<HTMLDivElement | null>;\n}\n\nconst defaultComponents: AiChatComponents = {\n  Empty: () => null,\n  Loading: () => (\n    <div className=\"lb-loading lb-ai-chat-loading\">\n      <SpinnerIcon />\n    </div>\n  ),\n};\n\nconst AiChatMessages = forwardRef<HTMLDivElement, AiChatMessagesProps>(\n  (\n    {\n      messages,\n      overrides,\n      components,\n      lastSentMessageId,\n      scrollToBottom,\n      onScrollAtBottomChange,\n      containerRef,\n      footerRef,\n      messagesRef,\n      bottomTrailingMarkerRef,\n      trailingSpacerRef,\n      className,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const hasLastSentMessage = lastSentMessageId !== null;\n\n    /**\n     * Every time the container, footer, or messages list change size,\n     * we calculate the trailing space that would allow the penultimate\n     * message to be at the top of the viewport, and apply it.\n     *\n     *      A = The `scroll-margin-top`\n     *                   value of the penultimate message\n     *                The penultimate message    \n     *                    B = The height from the top of\n     *                                               the penultimate message to the\n     *                    bottom of the messages list,\n     *     The last message                        including the messages' heights,\n     *                    and any padding, gap, etc\n     *                                             \n     *                        \n     *                                               The trailing space needed to\n     *       = container height - (A + B + C)        allow the penultimate message\n     *                                               to be at the top of the viewport\n     *     \n     *                                           \n     *                                             C = The footer's height,\n     *                                             including any padding\n     *      \n     *    \n     */\n    useEffect(\n      () => {\n        if (!hasLastSentMessage) {\n          return;\n        }\n\n        const container = containerRef.current;\n        const footer = footerRef.current;\n        const messages = messagesRef.current;\n\n        if (!container || !footer || !messages) {\n          return;\n        }\n\n        const trailingSpacer = trailingSpacerRef.current;\n        const bottomTrailingMarker = bottomTrailingMarkerRef.current;\n\n        let containerHeight: number | null = null;\n        let footerHeight: number | null = null;\n        let messagesHeight: number | null = null;\n\n        const resetTrailingSpace = () => {\n          trailingSpacer?.style.removeProperty(\"height\");\n          bottomTrailingMarker?.style.removeProperty(\"top\");\n        };\n\n        const resizeObserver = new ResizeObserver((entries) => {\n          if (!trailingSpacer || !bottomTrailingMarker) {\n            return;\n          }\n\n          const lastMessage = messages.lastElementChild;\n          const penultimateMessage = lastMessage?.previousElementSibling;\n\n          // If there's no last pair of messages, there's no need for any trailing space.\n          if (!lastMessage || !penultimateMessage) {\n            resetTrailingSpace();\n            return;\n          }\n\n          // If the container's height is based on its content, the container isn't scrollable and there's no need for any trailing space.\n          if (container.scrollHeight === container.clientHeight) {\n            resetTrailingSpace();\n            return;\n          }\n\n          let updatedContainerHeight: number | null = containerHeight;\n          let updatedFooterHeight: number | null = footerHeight;\n          let updatedMessagesHeight: number | null = messagesHeight;\n\n          for (const entry of entries) {\n            const entryHeight =\n              entry.borderBoxSize?.[0]?.blockSize ?? entry.contentRect.height;\n\n            if (entry.target === container) {\n              updatedContainerHeight = entryHeight ?? null;\n            } else if (entry.target === footer) {\n              updatedFooterHeight = entryHeight ?? null;\n            } else if (entry.target === messages) {\n              updatedMessagesHeight = entryHeight ?? null;\n            }\n          }\n\n          // If we don't have all the heights, we can't compute the trailing space.\n          if (\n            updatedContainerHeight === null ||\n            updatedFooterHeight === null ||\n            updatedMessagesHeight === null\n          ) {\n            resetTrailingSpace();\n            return;\n          }\n\n          // If none of the heights have changed, we don't need to do anything.\n          if (\n            updatedContainerHeight === containerHeight &&\n            updatedFooterHeight === footerHeight &&\n            updatedMessagesHeight === messagesHeight\n          ) {\n            return;\n          }\n\n          // Now that we have compared them, we can update the heights.\n          containerHeight = updatedContainerHeight;\n          footerHeight = updatedFooterHeight;\n          messagesHeight = updatedMessagesHeight;\n\n          // A\n          const penultimateMessageScrollMarginTop = Number.parseFloat(\n            getComputedStyle(penultimateMessage as HTMLElement).scrollMarginTop\n          );\n\n          // B\n          const messagesRect = messages.getBoundingClientRect();\n          const penultimateMessageRect =\n            penultimateMessage.getBoundingClientRect();\n          const heightFromPenultimateMessageTopToMessagesListBottom =\n            messagesRect.bottom - penultimateMessageRect.top;\n\n          // A + B + C\n          const differenceHeight =\n            penultimateMessageScrollMarginTop +\n            heightFromPenultimateMessageTopToMessagesListBottom +\n            (footerHeight ?? 0);\n\n          // = container height - (A + B + C)\n          const trailingSpace = Math.max(containerHeight - differenceHeight, 0);\n\n          // Update the trailing space.\n          trailingSpacer.style.height = `${trailingSpace}px`;\n\n          // Offset what \"the bottom\" is to the \"scroll at the bottom\" detection logic,\n          // so that it doesn't include the trailing space.\n          bottomTrailingMarker.style.top = `${-trailingSpace}px`;\n        });\n\n        resizeObserver.observe(container);\n        resizeObserver.observe(footer);\n        resizeObserver.observe(messages);\n\n        return () => {\n          resizeObserver.disconnect();\n          resetTrailingSpace();\n        };\n      },\n      // This effect only uses stable refs.\n      [hasLastSentMessage] // eslint-disable-line react-hooks/exhaustive-deps\n    );\n\n    /**\n     * Update the \"scroll at bottom\" state when needed.\n     */\n    useIntersectionCallback(\n      bottomTrailingMarkerRef,\n      (isIntersecting) => {\n        onScrollAtBottomChange.current(isIntersecting);\n      },\n      { root: containerRef, rootMargin: MIN_DISTANCE_BOTTOM_SCROLL_INDICATOR }\n    );\n\n    /**\n     * Instantly scroll to the bottom for the initial state.\n     */\n    useEffect(\n      () => {\n        scrollToBottom.current(\"instant\");\n      },\n      // `scrollToBottom` is a stable ref containing the callback.\n      [] // eslint-disable-line react-hooks/exhaustive-deps\n    );\n\n    /**\n     * Scroll to new messages when sending them.\n     */\n    useEffect(\n      () => {\n        if (lastSentMessageId) {\n          scrollToBottom.current(\"smooth\", true);\n        }\n      },\n      // `scrollToBottom` is a stable ref containing the callback.\n      [lastSentMessageId] // eslint-disable-line react-hooks/exhaustive-deps\n    );\n\n    /**\n     * Reset the \"scroll at bottom\" state when the component unmounts.\n     */\n    useEffect(\n      () => {\n        const onScrollAtBottomChangeCallback = onScrollAtBottomChange.current;\n\n        return () => {\n          onScrollAtBottomChangeCallback(null);\n        };\n      },\n      // `onScrollAtBottomChange` is a stable ref containing the callback.\n      [] // eslint-disable-line react-hooks/exhaustive-deps\n    );\n\n    return (\n      <div\n        className={cn(\"lb-ai-chat-messages\", className)}\n        ref={forwardedRef}\n        {...props}\n      >\n        {messages.map((message) => {\n          if (message.role === \"user\") {\n            return (\n              <AiChatUserMessage\n                key={message.id}\n                message={message}\n                overrides={overrides}\n                components={components}\n              />\n            );\n          } else if (message.role === \"assistant\") {\n            return (\n              <AiChatAssistantMessage\n                key={message.id}\n                message={message}\n                overrides={overrides}\n                components={components}\n              />\n            );\n          } else {\n            return null;\n          }\n        })}\n      </div>\n    );\n  }\n);\n\nexport const AiChat = forwardRef<HTMLDivElement, AiChatProps>(\n  (\n    {\n      chatId,\n      copilotId,\n      autoFocus,\n      overrides,\n      knowledge: localKnowledge,\n      tools = {},\n      onComposerSubmit,\n      layout = \"inset\",\n      components,\n      className,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const { messages, isLoading, error } = useAiChatMessages(chatId);\n    const [lastSentMessageId, setLastSentMessageId] =\n      useState<MessageId | null>(null);\n\n    const $ = useOverrides(overrides);\n    const Empty = components?.Empty ?? defaultComponents.Empty;\n    const Loading = components?.Loading ?? defaultComponents.Loading;\n\n    const containerRef = useRef<HTMLDivElement | null>(null);\n    const messagesRef = useRef<HTMLDivElement | null>(null);\n    const footerRef = useRef<HTMLDivElement | null>(null);\n    const bottomMarkerRef = useRef<HTMLDivElement | null>(null);\n    const bottomTrailingMarkerRef = useRef<HTMLDivElement | null>(null);\n    const trailingSpacerRef = useRef<HTMLDivElement | null>(null);\n\n    const [isScrollAtBottom, setScrollAtBottom] = useState<boolean | null>(\n      null\n    );\n    // `useState`'s setter is stable but this is for clarity in the places it's used.\n    const onScrollAtBottomChange = useLatest(setScrollAtBottom);\n    const isScrollIndicatorVisible =\n      messages && isScrollAtBottom !== null ? !isScrollAtBottom : false;\n\n    useImperativeHandle<HTMLDivElement | null, HTMLDivElement | null>(\n      forwardedRef,\n      () => containerRef.current,\n      []\n    );\n\n    const scrollToBottom = useLatest(\n      (behavior: \"instant\" | \"smooth\", includeTrailingSpace = false) => {\n        if (includeTrailingSpace) {\n          // Scroll to the bottom marker to include the trailing space,\n          // and wait for a frame in case the trailing space hasn't\n          // been updated yet. (e.g. when sending a new message)\n          requestAnimationFrame(() => {\n            bottomMarkerRef.current?.scrollIntoView({\n              behavior,\n              block: \"end\",\n            });\n          });\n        } else {\n          // Scroll to the trailing space marker to only scroll to the\n          // bottom of the messages, without including the trailing space.\n          bottomTrailingMarkerRef.current?.scrollIntoView({\n            behavior,\n            block: \"end\",\n          });\n        }\n      }\n    );\n\n    return (\n      <div\n        ref={containerRef}\n        {...props}\n        className={cn(\n          \"lb-root lb-ai-chat\",\n          `lb-ai-chat:layout-${layout}`,\n          className\n        )}\n      >\n        {Object.entries(tools).map(([name, tool]) => (\n          <RegisterAiTool key={name} chatId={chatId} name={name} tool={tool} />\n        ))}\n\n        <div className=\"lb-ai-chat-content\">\n          {isLoading ? (\n            <Loading />\n          ) : error !== undefined ? (\n            <div className=\"lb-error lb-ai-chat-error\">\n              {$.AI_CHAT_MESSAGES_ERROR(error)}\n            </div>\n          ) : messages.length === 0 ? (\n            <Empty chatId={chatId} copilotId={copilotId} />\n          ) : (\n            <>\n              <AiChatMessages\n                ref={messagesRef}\n                messages={messages}\n                overrides={overrides}\n                components={components}\n                lastSentMessageId={lastSentMessageId}\n                scrollToBottom={scrollToBottom}\n                onScrollAtBottomChange={onScrollAtBottomChange}\n                containerRef={containerRef}\n                footerRef={footerRef}\n                messagesRef={messagesRef}\n                bottomTrailingMarkerRef={bottomTrailingMarkerRef}\n                trailingSpacerRef={trailingSpacerRef}\n              />\n\n              {/**\n               * This trailing spacer is used to extend the scrollable area beyond its actual\n               * content, to allow messages to appear at the top of the viewport for example.\n               */}\n              <div\n                ref={trailingSpacerRef}\n                data-trailing-spacer=\"\"\n                style={{\n                  pointerEvents: \"none\",\n                }}\n                aria-hidden\n              />\n            </>\n          )}\n        </div>\n\n        <div className=\"lb-ai-chat-footer\" ref={footerRef}>\n          <div className=\"lb-ai-chat-footer-actions\">\n            <div\n              className=\"lb-root lb-elevation lb-elevation-moderate lb-ai-chat-scroll-indicator\"\n              data-visible={isScrollIndicatorVisible ? \"\" : undefined}\n            >\n              <button\n                className=\"lb-ai-chat-scroll-indicator-button\"\n                tabIndex={isScrollIndicatorVisible ? 0 : -1}\n                aria-hidden={!isScrollIndicatorVisible}\n                onClick={() => scrollToBottom.current(\"smooth\")}\n              >\n                <span className=\"lb-icon-container\">\n                  <ArrowDownIcon />\n                </span>\n              </button>\n            </div>\n          </div>\n          <AiComposer\n            key={chatId}\n            chatId={chatId}\n            copilotId={copilotId as CopilotId}\n            overrides={overrides}\n            autoFocus={autoFocus}\n            knowledge={localKnowledge}\n            onComposerSubmit={onComposerSubmit}\n            onComposerSubmitted={({ id }) => setLastSentMessageId(id)}\n            className={cn(\n              \"lb-ai-chat-composer\",\n              layout === \"inset\"\n                ? \"lb-elevation lb-elevation-moderate\"\n                : undefined\n            )}\n          />\n        </div>\n\n        {/**\n         * This invisible marker is a trick which allows us to use IntersectionObserver to detect when the\n         * scrollable area is fully scrolled to the bottom instead of manually tracking the scroll position\n         * and having to deal with resizes, etc.\n         *\n         * It's positioned at the bottom of the scrollable area and reliably only becomes \"visible\" to the\n         * IntersectionObserver when the scrollable area is scrolled to the bottom.\n         */}\n        {messages && messages.length > 0 ? (\n          <div\n            ref={bottomMarkerRef}\n            style={{ position: \"sticky\", height: 0 }}\n            aria-hidden\n            data-bottom-marker=\"\"\n          >\n            {/**\n             * This inner marker is absolutely offset by the same distance as the trailing space so its\n             * visibility means the scrollable area is at the bottom of the messages, not the full bottom.\n             */}\n            <div\n              ref={bottomTrailingMarkerRef}\n              style={{\n                position: \"absolute\",\n                height: 0,\n              }}\n              data-bottom-trailing-marker=\"\"\n            />\n          </div>\n        ) : null}\n      </div>\n    );\n  }\n);\n", "import type {\n  AiToolExecuteCallback,\n  AiToolTypePack,\n  JsonObject,\n  NoInfr,\n} from \"@liveblocks/core\";\nimport { kInternal } from \"@liveblocks/core\";\nimport type { ComponentProps, ReactNode } from \"react\";\nimport { Children, forwardRef, useCallback, useMemo } from \"react\";\n\nimport { Button } from \"../_private\";\nimport {\n  CheckCircleFillIcon,\n  ChevronRightIcon,\n  CrossCircleFillIcon,\n  MinusCircleIcon,\n  SpinnerIcon,\n} from \"../icons\";\nimport {\n  type AiToolConfirmationOverrides,\n  type GlobalOverrides,\n  useOverrides,\n} from \"../overrides\";\nimport { useAiToolInvocationContext } from \"../primitives/AiMessage/contexts\";\nimport * as Collapsible from \"../primitives/Collapsible\";\nimport { cn } from \"../utils/cn\";\nimport { useSemiControllableState } from \"../utils/use-controllable-state\";\nimport { CodeBlock } from \"./internal/CodeBlock\";\n\nexport interface AiToolProps\n  extends Omit<ComponentProps<\"div\">, \"title\" | \"children\"> {\n  /**\n   * The tool's title.\n   *\n   * By default, a human-readable version of the tool's name is used:\n   * - `\"showTodo\"`  \"Show todo\"\n   * - `\"get_weather\"`  \"Get weather\"\n   */\n  title?: string;\n\n  /**\n   * An optional icon displayed next to the title.\n   */\n  icon?: ReactNode;\n\n  /**\n   * The content shown in the tool.\n   */\n  children?: ReactNode;\n\n  /**\n   * The visual appearance of the tool.\n   */\n  variant?: \"block\" | \"minimal\";\n\n  /**\n   * Whether the content is currently collapsed.\n   * It is not a traditional controlled value, as in if you set it to `true` it would only stay expanded.\n   * Instead, it is \"semi-controlled\", meaning that setting it to `true` will expand it, but it\n   * can still be collapsed/expanded by clicking on it.\n   */\n  collapsed?: boolean;\n\n  /**\n   * The event handler called when the content is collapsed or expanded by clicking on it.\n   */\n  onCollapsedChange?: (collapsed: boolean) => void;\n\n  /**\n   * Whether the content can be collapsed/expanded.\n   * If set to `false`, clicking on it will have no effect.\n   * If there's no content, this prop has no effect.\n   */\n  collapsible?: boolean;\n}\n\nexport type AiToolIconProps = ComponentProps<\"div\">;\n\nexport type AiToolInspectorProps = ComponentProps<\"div\">;\n\nexport interface AiToolConfirmationProps<\n  A extends JsonObject,\n  R extends JsonObject,\n> extends ComponentProps<\"div\"> {\n  /**\n   * The callback invoked when the user clicks the confirm button.\n   */\n  confirm: AiToolExecuteCallback<A, R>;\n\n  /**\n   * The callback invoked when the user clicks the cancel button.\n   */\n  cancel?: AiToolExecuteCallback<A, R>;\n\n  /**\n   * The visual appearance.\n   */\n  variant?: \"default\" | \"destructive\";\n\n  /**\n   * Override the component's strings.\n   */\n  overrides?: Partial<GlobalOverrides & AiToolConfirmationOverrides>;\n\n  /**\n   * The tool's result type, to be used with the `types` prop in the `render` method.\n   *\n   * @example\n   * defineAiTool<{ value: number }>()({\n   *   // ...\n   *   render: ({ types }) => (\n   *     <AiTool.Confirmation\n   *       types={types}\n   *       confirm={() => {\n   *         return {\n   *           // Using `types` makes the result type-safe\n   *           // based on the tool's definition\n   *           data: { value: 123 },\n   *         };\n   *       }}\n   *     />\n   *   ),\n   * })\n   */\n  types?: NoInfr<AiToolTypePack<A, R>>;\n}\n\nfunction AiToolIcon({ className, ...props }: AiToolIconProps) {\n  return <div className={cn(\"lb-ai-tool-icon\", className)} {...props} />;\n}\n\nfunction AiToolInspector({ className, ...props }: AiToolInspectorProps) {\n  const { args, partialArgs, result } = useAiToolInvocationContext();\n\n  return (\n    <div className={cn(\"lb-ai-tool-inspector\", className)} {...props}>\n      <CodeBlock\n        title=\"Arguments\"\n        code={JSON.stringify(args ?? partialArgs, null, 2)}\n      />\n      {result !== undefined ? (\n        <CodeBlock title=\"Result\" code={JSON.stringify(result, null, 2)} />\n      ) : null}\n    </div>\n  );\n}\n\nfunction AiToolConfirmation<\n  TPack extends AiToolTypePack,\n  A extends JsonObject = TPack[\"A\"],\n  R extends JsonObject = TPack[\"R\"],\n>({\n  children,\n  variant = \"default\",\n  confirm,\n  cancel,\n  overrides,\n  className,\n  ...props\n}: AiToolConfirmationProps<A, R>) {\n  const { stage, args, respond, name, invocationId } =\n    useAiToolInvocationContext();\n  const $ = useOverrides(overrides);\n\n  const enabled = stage === \"executing\";\n\n  const context = useMemo(() => ({ name, invocationId }), [name, invocationId]);\n\n  const onConfirmClick = useCallback(async () => {\n    if (enabled) {\n      const result = await confirm(args as A, context);\n      respond(result ?? undefined);\n    }\n  }, [enabled, args, confirm, respond, context]);\n\n  const onCancelClick = useCallback(async () => {\n    if (enabled) {\n      if (cancel === undefined) {\n        respond({ cancel: true });\n      } else {\n        const result = await cancel(args as A, context);\n        respond(result ?? undefined);\n      }\n    }\n  }, [enabled, args, cancel, respond, context]);\n\n  // If there's no content and the tool has been executed (so there's no\n  // confirmation UI displayed either), don't render anything.\n  if (stage === \"executed\" && !children) {\n    return null;\n  }\n\n  return (\n    <div className={cn(\"lb-ai-tool-confirmation\", className)} {...props}>\n      {children ? (\n        <div className=\"lb-ai-tool-confirmation-content\">{children}</div>\n      ) : null}\n      {stage !== \"executed\" && (\n        <div className=\"lb-ai-tool-confirmation-footer\">\n          <div className=\"lb-ai-tool-confirmation-actions\">\n            <Button\n              disabled={!enabled}\n              onClick={onCancelClick}\n              variant=\"secondary\"\n            >\n              {$.AI_TOOL_CONFIRMATION_CANCEL}\n            </Button>\n            <Button\n              disabled={!enabled}\n              onClick={onConfirmClick}\n              variant={variant === \"destructive\" ? \"destructive\" : \"primary\"}\n            >\n              {$.AI_TOOL_CONFIRMATION_CONFIRM}\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction prettifyString(string: string) {\n  return (\n    string\n      // Convert camelCase to spaces\n      .replace(/([a-z])([A-Z])/g, \"$1 $2\")\n      // Convert snake_case and kebab-case to spaces\n      .replace(/[_-]+/g, \" \")\n      // Collapse multiple following spaces\n      .replace(/\\s+/g, \" \")\n      // Trim leading and trailing spaces\n      .trim()\n      // Capitalize first word\n      .toLowerCase()\n      .replace(/^\\w/, (character) => character.toUpperCase())\n  );\n}\n\n/**\n * A pre-built component which displays a tool call.\n *\n * By default, a human-readable version of the tool's name is used as a title:\n * - `\"showTodo\"`  \"Show todo\"\n * - `\"get_weather\"`  \"Get weather\"\n *\n * @example\n * defineAiTool()({\n *   // ...\n *   render: () => (\n *     <AiTool />\n *   ),\n * })\n *\n * It can be customized in various ways:\n * - adding an icon\n * - customizing the title (even dynamically)\n * - adding custom content inside it\n * - collapsing it conditionally\n * - etc.\n *\n * @example\n * defineAiTool()({\n *   // ...\n *   render: ({ stage, result }) => (\n *     <AiTool\n *       icon=\"\"\n *\n *       // Override the default title based on the tool's stage\n *       title={stage === \"executing\" ? \"Searching\" : \"Search results\"}\n *\n *       // Start open and automatically collapse after it is executed\n *       // The user can still expand/collapse it manually at any time\n *       collapsed={stage === \"executed\"}\n *     >\n *       <SearchResults data={result.data} />\n *     </AiTool>\n *   ),\n * })\n *\n * It also comes with a few built-in sub-components:\n * - `AiTool.Confirmation` to display a human-in-the-loop confirmation step\n *   which can be accepted or cancelled by the user.\n * - `AiTool.Inspector` to display the tool's arguments and result which can\n *   be useful during development.\n *\n * @example\n * defineAiTool()({\n *   // ...\n *   render: () => (\n *     <AiTool>\n *       <AiTool.Confirmation\n *         // Use a destructive visual appearance\n *         variant=\"destructive\"\n *\n *         // The tool's arguments can be directly accessed like in `execute`\n *         confirm={({ pageIds }) => {\n *           const deletedPageTitles = pages\n *             .filter((p) => pageIds.includes(p.id))\n *             .map((page) => page.title);\n *\n *           deletePages(pageIds);\n *\n *           // This result will be available as `result` in the tool's `render` props\n *           return { data: { deletedPageTitles } };\n *         }}\n *\n *         // If needed, `cancel={() => ...}` would work similarly\n *       >\n *         Do you want to delete these pages?\n *         <PagesPreviews />\n *       </AiTool.Confirmation>\n *     </AiTool>\n *   ),\n * })\n *\n * @example\n * defineAiTool()({\n *   // ...\n *   render: () => (\n *     <AiTool>\n *       <AiTool.Inspector />\n *     </AiTool>\n *   ),\n * })\n */\nexport const AiTool = Object.assign(\n  forwardRef<HTMLDivElement, AiToolProps>(\n    (\n      {\n        children,\n        title,\n        icon,\n        collapsible,\n        collapsed,\n        onCollapsedChange,\n        variant = \"block\",\n        className,\n        ...props\n      },\n      forwardedRef\n    ) => {\n      const {\n        stage,\n        result,\n        name,\n        [kInternal]: { execute, messageStatus },\n      } = useAiToolInvocationContext();\n      // Only mark the tool as pending visually (e.g. show a spinner, add a shimmer animation, etc.)\n      // if it has an `execute` method and it isn't in the \"executed\" stage.\n      const isVisuallyPending =\n        execute !== undefined &&\n        stage !== \"executed\" &&\n        // If it's in the \"receiving\" stage, we also check that the outer message is still generating.\n        (stage === \"receiving\" ? messageStatus === \"generating\" : true);\n      const [semiControlledCollapsed, onSemiControlledCollapsed] =\n        useSemiControllableState(collapsed ?? false, onCollapsedChange);\n      // TODO: This check won't work for cases like:\n      //         <AiTool>\n      //           <ComponentThatRendersNull />\n      //           <ComponentThatAlsoRendersNull />\n      //         </AiTool>\n      //       One solution could be to check the DOM on every render with `useLayoutEffect`\n      //       to see if there's any actual content.\n      //       For now we're limiting the visual issues caused by the above by using CSS's\n      //       `:empty` pseudo-class to make the content 0px high if it's actually empty.\n      const hasContent = Children.count(children) > 0;\n      // If there's no content, the tool is never collapsible.\n      const isCollapsible = hasContent ? (collapsible ?? true) : false;\n      const resolvedTitle = useMemo(() => {\n        return title ?? prettifyString(name);\n      }, [title, name]);\n\n      // `AiTool` uses \"collapsed\" instead of \"open\" (like the `Composer` component) because \"open\"\n      // makes sense next to something called \"Collapsible\" but less so for something called \"AiTool\".\n      const handleCollapsibleOpenChange = useCallback(\n        (open: boolean) => {\n          onSemiControlledCollapsed(!open);\n        },\n        [onSemiControlledCollapsed]\n      );\n\n      return (\n        <Collapsible.Root\n          ref={forwardedRef}\n          className={cn(\n            \"lb-collapsible lb-ai-tool\",\n            `lb-ai-tool:variant-${variant}`,\n            className\n          )}\n          {...props}\n          // Regardless of `semiControlledCollapsed`, the collapsible is closed if there's no content.\n          open={hasContent ? !semiControlledCollapsed : false}\n          onOpenChange={handleCollapsibleOpenChange}\n          disabled={!isCollapsible}\n          data-result={result?.type}\n          data-stage={stage}\n        >\n          <Collapsible.Trigger\n            className={cn(\n              \"lb-collapsible-trigger lb-ai-tool-header\",\n              variant === \"minimal\" && isVisuallyPending && \"lb-ai-chat-pending\"\n            )}\n          >\n            {icon ? (\n              <div className=\"lb-ai-tool-header-icon-container\">{icon}</div>\n            ) : null}\n            <span className=\"lb-ai-tool-header-title\">{resolvedTitle}</span>\n            {isCollapsible ? (\n              <span className=\"lb-collapsible-chevron lb-icon-container\">\n                <ChevronRightIcon />\n              </span>\n            ) : null}\n            {variant !== \"minimal\" ? (\n              <div className=\"lb-ai-tool-header-status\">\n                {stage === \"executed\" ? (\n                  result.type === \"success\" ? (\n                    <CheckCircleFillIcon />\n                  ) : result.type === \"error\" ? (\n                    <CrossCircleFillIcon />\n                  ) : result.type === \"cancelled\" ? (\n                    <MinusCircleIcon />\n                  ) : null\n                ) : isVisuallyPending ? (\n                  <SpinnerIcon />\n                ) : null}\n              </div>\n            ) : null}\n          </Collapsible.Trigger>\n\n          {hasContent ? (\n            <Collapsible.Content className=\"lb-collapsible-content lb-ai-tool-content-container\">\n              <div className=\"lb-ai-tool-content\">{children}</div>\n            </Collapsible.Content>\n          ) : null}\n        </Collapsible.Root>\n      );\n    }\n  ),\n  {\n    /**\n     * Display an icon in a container.\n     *\n     * @example\n     * <AiTool\n     *   icon={\n     *     <AiTool.Icon></AiTool.Icon>\n     *   }\n     * />\n     */\n    Icon: AiToolIcon,\n\n    /**\n     * Display the tool's arguments and result, which can be useful during\n     * development.\n     *\n     * @example\n     * <AiTool>\n     *   <AiTool.Inspector />\n     * </AiTool>\n     */\n    Inspector: AiToolInspector,\n\n    /**\n     * Display a human-in-the-loop confirmation step which can be accepted\n     * or cancelled by the user.\n     *\n     * The `confirm` and `cancel` callbacks work like `execute` in tool definitions: they can\n     * perform side-effects, be async if needed, and return a result. The tool call will stay\n     * pending until either `confirm` or `cancel` is called.\n     *\n     * @example\n     * <AiTool>\n     *   <AiTool.Confirmation\n     *     // Use a destructive visual appearance\n     *     variant=\"destructive\"\n     *\n     *     // The tool's arguments can be directly accessed like in `execute`\n     *     confirm={({ pageIds }) => {\n     *       const deletedPageTitles = pages\n     *         .filter((p) => pageIds.includes(p.id))\n     *         .map((page) => page.title);\n     *\n     *       deletePages(pageIds);\n     *\n     *       // This result will be available as `result` in the tool's `render` props\n     *       return { data: { deletedPageTitles } };\n     *     }}\n     *\n     *     // If needed, `cancel={() => ...}` would work similarly\n     *   >\n     *     Do you want to delete these pages?\n     *     <PagesPreviews />\n     *   </AiTool.Confirmation>\n     * </AiTool>\n     */\n    Confirmation: AiToolConfirmation,\n  }\n);\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { Primitive } from '@radix-ui/react-primitive';\n\n/* -------------------------------------------------------------------------------------------------\n * Toggle\n * -----------------------------------------------------------------------------------------------*/\n\nconst NAME = 'Toggle';\n\ntype ToggleElement = React.ComponentRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = React.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface ToggleProps extends PrimitiveButtonProps {\n  /**\n   * The controlled state of the toggle.\n   */\n  pressed?: boolean;\n  /**\n   * The state of the toggle when initially rendered. Use `defaultPressed`\n   * if you do not need to control the state of the toggle.\n   * @defaultValue false\n   */\n  defaultPressed?: boolean;\n  /**\n   * The callback that fires when the state of the toggle changes.\n   */\n  onPressedChange?(pressed: boolean): void;\n}\n\nconst Toggle = React.forwardRef<ToggleElement, ToggleProps>((props, forwardedRef) => {\n  const { pressed: pressedProp, defaultPressed, onPressedChange, ...buttonProps } = props;\n\n  const [pressed, setPressed] = useControllableState({\n    prop: pressedProp,\n    onChange: onPressedChange,\n    defaultProp: defaultPressed ?? false,\n    caller: NAME,\n  });\n\n  return (\n    <Primitive.button\n      type=\"button\"\n      aria-pressed={pressed}\n      data-state={pressed ? 'on' : 'off'}\n      data-disabled={props.disabled ? '' : undefined}\n      {...buttonProps}\n      ref={forwardedRef}\n      onClick={composeEventHandlers(props.onClick, () => {\n        if (!props.disabled) {\n          setPressed(!pressed);\n        }\n      })}\n    />\n  );\n});\n\nToggle.displayName = NAME;\n\n/* ---------------------------------------------------------------------------------------------- */\n\nconst Root = Toggle;\n\nexport {\n  Toggle,\n  //\n  Root,\n};\nexport type { ToggleProps };\n", "import {\n  isCommentBodyLink,\n  isCommentBodyMention,\n  MENTION_CHARACTER,\n  sanitizeUrl,\n} from \"@liveblocks/core\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport type { ReactNode } from \"react\";\nimport { forwardRef, useMemo } from \"react\";\n\nimport type {\n  CommentBodyComponents,\n  CommentBodyProps,\n  CommentLinkProps,\n  CommentMentionProps,\n} from \"./types\";\n\nconst COMMENT_MENTION_NAME = \"CommentMention\";\nconst COMMENT_BODY_NAME = \"CommentBody\";\nconst COMMENT_LINK_NAME = \"CommentLink\";\n\n/**\n * Displays mentions within `Comment.Body`.\n *\n * @example\n * <Comment.Mention>@{mention.id}</Comment.Mention>\n */\nconst CommentMention = forwardRef<HTMLSpanElement, CommentMentionProps>(\n  ({ children, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"span\";\n\n    return (\n      <Component {...props} ref={forwardedRef}>\n        {children}\n      </Component>\n    );\n  }\n);\n\n/**\n * Displays links within `Comment.Body`.\n *\n * @example\n * <Comment.Link href={href}>{children}</Comment.Link>\n */\nconst CommentLink = forwardRef<HTMLAnchorElement, CommentLinkProps>(\n  ({ children, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"a\";\n\n    return (\n      <Component\n        target=\"_blank\"\n        rel=\"noopener noreferrer nofollow\"\n        {...props}\n        ref={forwardedRef}\n      >\n        {children}\n      </Component>\n    );\n  }\n);\n\nconst defaultBodyComponents: CommentBodyComponents = {\n  Mention: ({ mention }) => {\n    return (\n      <CommentMention>\n        {MENTION_CHARACTER}\n        {mention.id}\n      </CommentMention>\n    );\n  },\n  Link: ({ href, children }) => {\n    return <CommentLink href={href}>{children}</CommentLink>;\n  },\n};\n\n/**\n * Displays a comment body.\n *\n * @example\n * <Comment.Body body={comment.body} />\n */\nconst CommentBody = forwardRef<HTMLDivElement, CommentBodyProps>(\n  ({ body, components, style, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"div\";\n    const { Mention, Link } = useMemo(\n      () => ({ ...defaultBodyComponents, ...components }),\n      [components]\n    );\n\n    if (!body || !body?.content) {\n      return null;\n    }\n\n    return (\n      <Component\n        {...props}\n        style={{ whiteSpace: \"break-spaces\", ...style }}\n        ref={forwardedRef}\n      >\n        {body.content.map((block, index) => {\n          switch (block.type) {\n            case \"paragraph\":\n              return (\n                <p key={index} style={{ minHeight: \"1lh\" }}>\n                  {block.children.map((inline, index) => {\n                    if (isCommentBodyMention(inline)) {\n                      const { type: _, ...mention } = inline;\n\n                      return mention.id ? (\n                        <Mention mention={mention} key={index} />\n                      ) : null;\n                    }\n\n                    if (isCommentBodyLink(inline)) {\n                      const href = sanitizeUrl(inline.url);\n\n                      // If the URL is invalid, its text/URL are used as plain text.\n                      if (href === null) {\n                        return (\n                          <span key={index}>{inline.text ?? inline.url}</span>\n                        );\n                      }\n\n                      return (\n                        <Link href={href} key={index}>\n                          {inline.text ?? inline.url}\n                        </Link>\n                      );\n                    }\n\n                    // <code><s><em><strong>text</strong></s></em></code>\n                    let children: ReactNode = inline.text;\n\n                    if (inline.bold) {\n                      children = <strong key={index}>{children}</strong>;\n                    }\n\n                    if (inline.italic) {\n                      children = <em key={index}>{children}</em>;\n                    }\n\n                    if (inline.strikethrough) {\n                      children = <s key={index}>{children}</s>;\n                    }\n\n                    if (inline.code) {\n                      children = <code key={index}>{children}</code>;\n                    }\n\n                    return <span key={index}>{children}</span>;\n                  })}\n                </p>\n              );\n            default:\n              return null;\n          }\n        })}\n      </Component>\n    );\n  }\n);\n\nif (process.env.NODE_ENV !== \"production\") {\n  CommentBody.displayName = COMMENT_BODY_NAME;\n  CommentMention.displayName = COMMENT_MENTION_NAME;\n  CommentLink.displayName = COMMENT_LINK_NAME;\n}\n\n// NOTE: Every export from this file will be available publicly as Comment.*\nexport { CommentBody as Body, CommentLink as Link, CommentMention as Mention };\n", "import type { KeyboardEvent as ReactKeyboardEvent } from \"react\";\n\nimport { isApple } from \"./is-apple\";\n\nconst MODIFIERS = {\n  alt: () => \"altKey\" as const,\n  ctrl: () => \"ctrlKey\" as const,\n  meta: () => \"metaKey\" as const,\n  mod: () => (isApple() ? (\"metaKey\" as const) : (\"ctrlKey\" as const)),\n  shift: () => \"shiftKey\" as const,\n} as const;\n\nexport function isKey(\n  event: KeyboardEvent | ReactKeyboardEvent,\n  key: string,\n  modifiers: Partial<Record<keyof typeof MODIFIERS, boolean>> = {}\n) {\n  if (event.key !== key) {\n    return false;\n  }\n\n  const explicitModifiers = Object.entries(modifiers).filter(\n    ([, value]) => typeof value === \"boolean\"\n  ) as [keyof typeof MODIFIERS, boolean][];\n\n  return explicitModifiers.every(([modifier, value]) => {\n    const property = MODIFIERS[modifier]();\n\n    return event[property] === value;\n  });\n}\n", "\"use client\";\n\nimport { nn } from \"@liveblocks/core\";\nimport { useLayoutEffect } from \"@liveblocks/react/_private\";\nimport type { ReactNode, RefObject } from \"react\";\nimport {\n  Children,\n  createContext,\n  isValidElement,\n  useCallback,\n  useContext,\n  useRef,\n  useState,\n} from \"react\";\nimport { flushSync } from \"react-dom\";\n\n// Persist is an overly simplified version of Framer Motion's AnimatePresence,\n// mostly mimicking its usePresence API: https://github.com/framer/motion/blob/main/packages/framer-motion/src/components/AnimatePresence/use-presence.ts\n\nconst PERSIST_NAME = \"Persist\";\n\ninterface PersistProps {\n  children: Exclude<ReactNode, Iterable<ReactNode>>;\n}\n\ntype PersistContext = [boolean, () => void];\n\nconst PersistContext = createContext<PersistContext | null>(null);\n\nexport function usePersist() {\n  const persistContext = useContext(PersistContext);\n\n  return nn(persistContext, \"Persist is missing from the React tree.\");\n}\n\nfunction getChild(children: ReactNode) {\n  const child: ReactNode = Array.isArray(children)\n    ? Children.only(children)\n    : children;\n\n  return isValidElement(child) ? child : undefined;\n}\n\nexport function useAnimationPersist(ref: RefObject<HTMLElement>) {\n  const [isPresent, unmount] = usePersist();\n  const previousAnimationName = useRef<string | null>(null);\n  const unmountAnimationName = useRef<string | null>(null);\n\n  useLayoutEffect(() => {\n    const element = ref.current;\n\n    if (!element) {\n      return;\n    }\n\n    /**\n     * Stop persisting at the end of the last animation.\n     *\n     * We keep track of all ending animations because animations stay\n     * on getComputedStyle(element).animationName even if they're over,\n     * so we need to keep track of previous animations to truly know if\n     * an animation should be waited on.\n     */\n    const handleAnimationEnd = (event: AnimationEvent) => {\n      if (event.animationName === unmountAnimationName.current) {\n        unmount();\n      }\n\n      previousAnimationName.current = event.animationName;\n    };\n\n    element.addEventListener(\"animationcancel\", handleAnimationEnd);\n    element.addEventListener(\"animationend\", handleAnimationEnd);\n\n    return () => {\n      element.removeEventListener(\"animationcancel\", handleAnimationEnd);\n      element.removeEventListener(\"animationend\", handleAnimationEnd);\n    };\n  }, [ref, unmount]);\n\n  useLayoutEffect(() => {\n    const element = ref.current;\n    let animationFrameId: number;\n\n    if (!element) {\n      return;\n    }\n\n    if (!isPresent) {\n      // If the element should be unmounting, wait for a repaint and check\n      // if it is visible and has an animation. If not, unmount immediately.\n      animationFrameId = requestAnimationFrame(() => {\n        const styles = getComputedStyle(element);\n        unmountAnimationName.current = styles.animationName;\n\n        if (\n          styles.animationName === \"none\" ||\n          styles.animationName === previousAnimationName.current ||\n          styles.display === \"none\"\n        ) {\n          unmount();\n        }\n      });\n    }\n\n    return () => {\n      cancelAnimationFrame(animationFrameId);\n    };\n  }, [isPresent, ref, unmount]);\n}\n\n/**\n * Persist a component until it decides to unmount by\n * itself (instead of orchestrating the unmount from the parent).\n */\nexport function Persist({ children }: PersistProps) {\n  const [isPersisting, setPersisting] = useState(true);\n  const lastPresentChild = useRef<ReactNode>(null);\n  const child = getChild(children);\n\n  const unmount = useCallback(() => {\n    flushSync(() => setPersisting(false));\n  }, []);\n\n  useLayoutEffect(() => {\n    if (child) {\n      setPersisting(true);\n      lastPresentChild.current = child;\n    }\n  }, [child]);\n\n  return (\n    <PersistContext.Provider value={[Boolean(child), unmount]}>\n      {child ?? (isPersisting ? lastPresentChild.current : null)}\n    </PersistContext.Provider>\n  );\n}\n\nif (process.env.NODE_ENV !== \"production\") {\n  Persist.displayName = PERSIST_NAME;\n}\n", "\"use client\";\n\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { forwardRef } from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport type { ComponentPropsWithSlot } from \"../types\";\n\nconst PORTAL_NAME = \"Portal\";\n\ninterface PortalProps extends ComponentPropsWithSlot<\"div\"> {\n  /**\n   * The container to render the portal into.\n   */\n  container?: HTMLElement | null;\n}\n\nconst Portal = forwardRef<HTMLDivElement, PortalProps>(\n  ({ container = document?.body, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"div\";\n\n    return container\n      ? createPortal(\n          <Component data-liveblocks-portal=\"\" {...props} ref={forwardedRef} />,\n          container\n        )\n      : null;\n  }\n);\n\nif (process.env.NODE_ENV !== \"production\") {\n  Portal.displayName = PORTAL_NAME;\n}\n\nexport { Portal };\n", "export function clamp(value: number, min: number, max: number) {\n  return Math.min(Math.max(value, min), max);\n}\n", "export function wrap(value: number, min: number, max: number) {\n  const range = max - min;\n\n  return range > 0 ? ((((value - min) % range) + range) % range) + min : 0;\n}\n", "import { useCallback, useEffect, useMemo, useState } from \"react\";\n\nimport { clamp } from \"./clamp\";\nimport { wrap } from \"./wrap\";\n\ntype Options = {\n  wrap: boolean;\n};\n\nconst defaultOptions: Options = {\n  wrap: true,\n};\n\nexport function useIndex(\n  initial: number,\n  length: number,\n  options?: Partial<Options>\n) {\n  const { wrap: shouldWrap } = useMemo(() => {\n    return {\n      ...defaultOptions,\n      ...options,\n    };\n  }, [options]);\n  const transform = useMemo(() => (shouldWrap ? wrap : clamp), [shouldWrap]);\n  const [index, setIndex] = useState(initial);\n\n  useEffect(() => {\n    setIndex((index) => clamp(index, 0, Math.max(length - 1, 0)));\n  }, [length]);\n\n  const previousIndex = useCallback(() => {\n    setIndex((index) => transform(index - 1, 0, Math.max(length, 0)));\n  }, [length, transform]);\n\n  const nextIndex = useCallback(() => {\n    setIndex((index) => transform(index + 1, 0, Math.max(length, 0)));\n  }, [length, transform]);\n\n  return [index, previousIndex, nextIndex, setIndex] as const;\n}\n", "import type { Observable } from \"@liveblocks/core\";\nimport { useLatest } from \"@liveblocks/react/_private\";\nimport { useEffect } from \"react\";\n\nexport function useObservable<T>(\n  observable: Observable<T>,\n  callback: () => void\n) {\n  const latestCallback = useLatest(callback);\n\n  useEffect(() => {\n    const unsubscribe = observable.subscribe(() => latestCallback.current());\n\n    return unsubscribe;\n  }, [observable, latestCallback]);\n}\n", "import type { Location as SlateLocation } from \"slate\";\nimport { Editor as SlateEditor, Range as SlateRange } from \"slate\";\n\ninterface Options {\n  filterVoids?: boolean;\n}\n\nexport function getCharacterBefore<T extends SlateEditor>(\n  editor: T,\n  at: SlateLocation,\n  options: Options = {}\n) {\n  const { filterVoids } = options;\n  const before = SlateEditor.before(editor, at, {\n    unit: \"character\",\n    voids: filterVoids,\n  });\n\n  if (before) {\n    const range = SlateEditor.range(\n      editor,\n      before,\n      SlateRange.isRange(at) ? SlateRange.start(at) : at\n    );\n    const text = SlateEditor.string(editor, range);\n\n    return {\n      range,\n      text,\n      void: text.length === 0,\n    };\n  }\n\n  return;\n}\n\nexport function getCharacterAfter<T extends SlateEditor>(\n  editor: T,\n  at: SlateLocation,\n  options: Options = {}\n) {\n  const { filterVoids } = options;\n  const after = SlateEditor.after(editor, at, {\n    unit: \"character\",\n    voids: filterVoids,\n  });\n\n  if (after) {\n    const range = SlateEditor.range(\n      editor,\n      after,\n      SlateRange.isRange(at) ? SlateRange.end(at) : at\n    );\n    const text = SlateEditor.string(editor, range);\n\n    return {\n      range,\n      text,\n      void: text.length === 0,\n    };\n  }\n\n  return;\n}\n", "import type { Text } from \"slate\";\nimport { Editor as SlateEditor, Range as SlateRange } from \"slate\";\n\nimport type { ComposerBodyMarks } from \"../../../types\";\nimport { getCharacterAfter, getCharacterBefore } from \"./get-character\";\n\nconst defaultComposerBodyMarks: Required<ComposerBodyMarks> = {\n  bold: false,\n  italic: false,\n  strikethrough: false,\n  code: false,\n};\n\nexport function getComposerBodyMarks(editor?: SlateEditor) {\n  if (!editor) {\n    return { ...defaultComposerBodyMarks };\n  }\n\n  const marks = SlateEditor.marks(editor);\n\n  return { ...defaultComposerBodyMarks, ...marks };\n}\n\nexport function isMarkActive<M = ComposerBodyMarks>(\n  editor: SlateEditor,\n  mark: keyof M\n) {\n  const marks = SlateEditor.marks(editor) as M | null;\n\n  return marks ? marks[mark] === true : false;\n}\n\nexport function filterActiveMarks(\n  value: Text | ComposerBodyMarks | null | undefined\n) {\n  return Object.keys(value ?? {}).filter(\n    (key) => key !== \"text\"\n  ) as (keyof ComposerBodyMarks)[];\n}\n\nexport function toggleMark(editor: SlateEditor, mark: keyof ComposerBodyMarks) {\n  const isActive = isMarkActive(editor, mark);\n\n  if (isActive) {\n    SlateEditor.removeMark(editor, mark);\n  } else {\n    SlateEditor.addMark(editor, mark, true);\n  }\n}\n\nexport function removeMarks(editor: SlateEditor) {\n  const marks = SlateEditor.marks(editor);\n\n  if (marks) {\n    for (const mark in marks) {\n      SlateEditor.removeMark(editor, mark);\n    }\n  }\n}\n\nexport function leaveMarkEdge(editor: SlateEditor, edge: \"start\" | \"end\") {\n  if (editor.selection && SlateRange.isCollapsed(editor.selection)) {\n    const marks = Object.keys(SlateEditor.marks(editor) ?? {});\n\n    if (marks.length > 0) {\n      const sibling =\n        edge === \"start\"\n          ? getCharacterBefore(editor, editor.selection)\n          : getCharacterAfter(editor, editor.selection);\n\n      if (!sibling) {\n        removeMarks(editor);\n      }\n    }\n  }\n}\n", "import type { Editor as SlateEditor } from \"slate\";\n\nimport { isEmpty } from \"../utils/is-empty\";\nimport { removeMarks } from \"../utils/marks\";\n\n// This plugins clears formatting on empty blocks\n// https://github.com/ianstormtaylor/slate/issues/2908\nexport function withEmptyClearFormatting<T extends SlateEditor>(editor: T): T {\n  const { onChange } = editor;\n\n  editor.onChange = (options) => {\n    if (isEmpty(editor, editor.children)) {\n      removeMarks(editor);\n    }\n\n    onChange(options);\n  };\n\n  return editor;\n}\n", "import type { Editor as SlateEditor, Range as SlateRange } from \"slate\";\nimport { ReactEditor } from \"slate-react\";\n\nexport function getDOMRange(\n  editor: SlateEditor,\n  range: SlateRange\n): Range | undefined {\n  try {\n    return ReactEditor.toDOMRange(editor, range);\n  } catch (error) {\n    return getDOMRange(editor, {\n      anchor: range.anchor,\n      focus: range.anchor,\n    });\n  }\n}\n", "import type { Placement } from \"@floating-ui/react-dom\";\nimport type { CommentMixedAttachment, EventSource } from \"@liveblocks/core\";\nimport { nn } from \"@liveblocks/core\";\nimport type { DropdownMenuProps } from \"@radix-ui/react-dropdown-menu\";\nimport type { Dispatch, Ref, SetStateAction } from \"react\";\nimport { createContext, useContext } from \"react\";\nimport type { Editor as SlateEditor, Element as SlateElement } from \"slate\";\n\nimport type { ComposerBodyMark, ComposerBodyMarks } from \"../../types\";\n\nexport type ComposerContext = {\n  /**\n   * Whether the composer is currently disabled.\n   */\n  isDisabled: boolean;\n\n  /**\n   * Whether the composer can currently be submitted.\n   */\n  canSubmit: boolean;\n\n  /**\n   * Whether the editor is currently focused.\n   */\n  isFocused: boolean;\n\n  /**\n   * Whether the editor is currently empty.\n   */\n  isEmpty: boolean;\n\n  /**\n   * Submit the composer programmatically.\n   */\n  submit: () => void;\n\n  /**\n   * Clear the composer programmatically.\n   */\n  clear: () => void;\n\n  /**\n   * Select the editor programmatically.\n   */\n  select: () => void;\n\n  /**\n   * Focus the editor programmatically.\n   */\n  focus: () => void;\n\n  /**\n   * Blur the editor programmatically.\n   */\n  blur: () => void;\n\n  /**\n   * Which text marks are currently active and which aren't.\n   */\n  marks: ComposerBodyMarks;\n\n  /**\n   * Toggle a specific text mark.\n   */\n  toggleMark: (mark: ComposerBodyMark) => void;\n\n  /**\n   * Start creating a mention at the current selection.\n   */\n  createMention: () => void;\n\n  /**\n   * Insert text at the current selection.\n   */\n  insertText: (text: string) => void;\n\n  /**\n   * Open a file picker programmatically to create attachments.\n   */\n  attachFiles: () => void;\n\n  /**\n   * The composer's current attachments.\n   */\n  attachments: CommentMixedAttachment[];\n\n  /**\n   * Remove an attachment by its ID.\n   */\n  removeAttachment: (attachmentId: string) => void;\n};\n\nexport type ComposerEditorContext = {\n  validate: (value: SlateElement[]) => void;\n  editor: SlateEditor;\n  setFocused: Dispatch<SetStateAction<boolean>>;\n  onEditorChange: EventSource<void>;\n  roomId: string;\n};\n\nexport type ComposerAttachmentsContext = {\n  hasMaxAttachments: boolean;\n  createAttachments: (files: File[]) => void;\n  isUploadingAttachments: boolean;\n  maxAttachments: number;\n  maxAttachmentSize: number;\n};\n\nexport type ComposerSuggestionsContext = {\n  dir?: DropdownMenuProps[\"dir\"];\n  id: string;\n  itemId: (value?: string) => string | undefined;\n  placement: Placement;\n  selectedValue?: string;\n  setSelectedValue: (value: string) => void;\n  onItemSelect: (value: string) => void;\n  ref: Ref<HTMLDivElement>;\n};\n\nexport type ComposerFloatingToolbarContext = {\n  dir?: DropdownMenuProps[\"dir\"];\n  id: string;\n  placement: Placement;\n  ref: Ref<HTMLDivElement>;\n};\n\nexport const ComposerContext = createContext<ComposerContext | null>(null);\nexport const ComposerEditorContext =\n  createContext<ComposerEditorContext | null>(null);\nexport const ComposerAttachmentsContext =\n  createContext<ComposerAttachmentsContext | null>(null);\nexport const ComposerSuggestionsContext =\n  createContext<ComposerSuggestionsContext | null>(null);\nexport const ComposerFloatingToolbarContext =\n  createContext<ComposerFloatingToolbarContext | null>(null);\n\nexport function useComposerEditorContext() {\n  const composerEditorContext = useContext(ComposerEditorContext);\n\n  return nn(\n    composerEditorContext,\n    \"Composer.Form is missing from the React tree.\"\n  );\n}\n\nexport function useComposerAttachmentsContextOrNull() {\n  return useContext(ComposerAttachmentsContext);\n}\n\nexport function useComposerAttachmentsContext() {\n  const composerAttachmentsContext = useComposerAttachmentsContextOrNull();\n\n  return nn(\n    composerAttachmentsContext,\n    \"Composer.Form is missing from the React tree.\"\n  );\n}\n\nexport function useComposerSuggestionsContext(\n  source = \"useComposerSuggestionsContext\"\n) {\n  const composerSuggestionsContext = useContext(ComposerSuggestionsContext);\n\n  return nn(\n    composerSuggestionsContext,\n    `${source} cant be used outside of Composer.Editor.`\n  );\n}\n\nexport function useComposerFloatingToolbarContext(\n  source = \"useComposerFloatingToolbarContext\"\n) {\n  const composerFloatingToolbarContext = useContext(\n    ComposerFloatingToolbarContext\n  );\n\n  return nn(\n    composerFloatingToolbarContext,\n    `${source} cant be used outside of Composer.Editor.`\n  );\n}\n\nexport function useComposer(): ComposerContext {\n  const composerContext = useContext(ComposerContext);\n\n  return nn(composerContext, \"Composer.Form is missing from the React tree.\");\n}\n", "const WHITESPACE_REGEX = /\\s/;\n\nexport function isWhitespaceCharacter(character?: string): boolean {\n  return character ? WHITESPACE_REGEX.test(character) : false;\n}\n", "import type { Point as SlatePoint } from \"slate\";\nimport {\n  Editor as SlateEditor,\n  Path as SlatePath,\n  Range as SlateRange,\n} from \"slate\";\n\nimport { isWhitespaceCharacter } from \"./is-whitespace-character\";\n\ninterface Options {\n  include?: boolean;\n  direction?: \"before\" | \"after\" | \"both\";\n  allowConsecutiveWhitespace?: boolean;\n  ignoreTerminator?: (\n    character: string,\n    point: SlatePoint,\n    direction: \"before\" | \"after\"\n  ) => boolean;\n}\n\nconst defaultOptions: Options = {\n  direction: \"before\",\n  allowConsecutiveWhitespace: true,\n};\n\nexport function getMatchRange(\n  editor: SlateEditor,\n  at: SlateRange,\n  terminators: string[] = [\" \"],\n  options: Options = defaultOptions\n): SlateRange | undefined {\n  const { include, direction, ignoreTerminator, allowConsecutiveWhitespace } = {\n    ...defaultOptions,\n    ...options,\n  };\n\n  let [start, end] = SlateRange.edges(at);\n  let point: SlatePoint = start;\n  let previousCharacterWasWhitespace = false;\n\n  function move(direction: \"before\" | \"after\"): boolean {\n    const nextPoint =\n      direction === \"after\"\n        ? SlateEditor.after(editor, point, { unit: \"character\" })\n        : SlateEditor.before(editor, point, { unit: \"character\" });\n\n    // Stop if we reached the end of a block\n    if (!nextPoint || SlatePath.compare(nextPoint.path, point.path) !== 0) {\n      return false;\n    }\n\n    const nextCharacter =\n      nextPoint &&\n      SlateEditor.string(\n        editor,\n        direction === \"after\"\n          ? { anchor: point, focus: nextPoint }\n          : { anchor: nextPoint, focus: point }\n      );\n    const lastCharacter =\n      nextCharacter &&\n      nextCharacter[direction === \"after\" ? 0 : nextCharacter.length - 1];\n\n    if (\n      !allowConsecutiveWhitespace &&\n      previousCharacterWasWhitespace &&\n      isWhitespaceCharacter(lastCharacter)\n    ) {\n      return false;\n    }\n\n    if (\n      nextPoint &&\n      lastCharacter &&\n      (!terminators.includes(lastCharacter) ||\n        ignoreTerminator?.(lastCharacter, nextPoint, direction))\n    ) {\n      previousCharacterWasWhitespace = isWhitespaceCharacter(lastCharacter);\n      point = nextPoint;\n\n      if (point.offset === 0) {\n        return false;\n      }\n    } else {\n      return false;\n    }\n\n    return true;\n  }\n\n  if (direction !== \"before\") {\n    point = end;\n    while (move(\"after\"));\n    end = point;\n  }\n\n  if (direction !== \"after\") {\n    point = start;\n    while (move(\"before\"));\n    start = point;\n  }\n\n  if (include) {\n    return {\n      anchor:\n        direction === \"before\" || direction === \"both\"\n          ? (SlateEditor.before(editor, start, { unit: \"offset\" }) ?? start)\n          : start,\n      focus:\n        direction === \"after\" || direction === \"both\"\n          ? (SlateEditor.after(editor, end, { unit: \"offset\" }) ?? end)\n          : end,\n    };\n  }\n\n  return { anchor: start, focus: end };\n}\n", "import {\n  Editor as SlateEditor,\n  Range as SlateRange,\n  Transforms as SlateTransforms,\n} from \"slate\";\n\nimport type { ComposerBodyMarks } from \"../../../../types\";\nimport { getCharacterBefore } from \"../../../slate/utils/get-character\";\nimport { getMatchRange } from \"../../../slate/utils/get-match-range\";\nimport { isEmptyString } from \"../../../slate/utils/is-empty-string\";\n\ninterface MarkFormatter {\n  type: \"mark\";\n  mark: keyof ComposerBodyMarks;\n  character: string;\n}\n\ntype Formatter = MarkFormatter;\n\nconst formatters: Formatter[] = [\n  {\n    type: \"mark\",\n    mark: \"bold\",\n    character: \"*\",\n  },\n  {\n    type: \"mark\",\n    mark: \"italic\",\n    character: \"_\",\n  },\n  {\n    type: \"mark\",\n    mark: \"strikethrough\",\n    character: \"~\",\n  },\n  {\n    type: \"mark\",\n    mark: \"code\",\n    character: \"`\",\n  },\n];\nconst markFormattingCharacters = formatters\n  .filter((formatter) => formatter.type === \"mark\")\n  .map((formatter) => formatter.character);\n\nfunction formatMark<T extends SlateEditor>(\n  editor: T,\n  text: string,\n  formatter: MarkFormatter\n): boolean {\n  if (text !== formatter.character) {\n    return false;\n  }\n\n  const match = getMatchRange(editor, editor.selection!, [formatter.character]);\n\n  // Check if the match exists and is not empty\n  if (!match || SlateRange.isCollapsed(match)) {\n    return false;\n  }\n\n  const formattingCharacter = getCharacterBefore(editor, match);\n\n  // Check if the match is preceded by the formatting character\n  if (\n    !formattingCharacter ||\n    formattingCharacter.text !== formatter.character\n  ) {\n    return false;\n  }\n\n  const beforeCharacter = getCharacterBefore(editor, formattingCharacter.range);\n\n  // Check if the formatting character is preceded by a non-whitespace character (or another formatting character)\n  if (\n    beforeCharacter &&\n    !markFormattingCharacters.includes(beforeCharacter.text) &&\n    !isEmptyString(beforeCharacter.text)\n  ) {\n    return false;\n  }\n\n  const matchText = SlateEditor.string(editor, match);\n\n  // Check if the match has leading/trailing whitespace\n  if (matchText.trim() !== matchText) {\n    return false;\n  }\n\n  // Set the match to the expected mark\n  SlateTransforms.select(editor, match);\n  editor.addMark(formatter.mark, true);\n\n  // Set the selection at the end of the match and reset formatting\n  SlateTransforms.collapse(editor, { edge: \"end\" });\n  editor.removeMark(formatter.mark);\n\n  // Delete the formatting character\n  SlateTransforms.delete(editor, {\n    at: formattingCharacter.range,\n  });\n\n  return true;\n}\n\nexport function withAutoFormatting<T extends SlateEditor>(editor: T): T {\n  const { insertText } = editor;\n\n  editor.insertText = (text, options) => {\n    if (!editor.selection || !SlateRange.isCollapsed(editor.selection)) {\n      return insertText(text, options);\n    }\n\n    let shouldInsertText = true;\n\n    for (const formatter of formatters) {\n      if (formatter.type === \"mark\") {\n        if (formatMark(editor, text, formatter)) {\n          shouldInsertText = false;\n        }\n      }\n    }\n\n    if (shouldInsertText) {\n      insertText(text, options);\n    }\n  };\n\n  return editor;\n}\n", "import type { Node as SlateNode } from \"slate\";\nimport {\n  Editor as SlateEditor,\n  Element as SlateElement,\n  Range as SlateRange,\n} from \"slate\";\n\nexport function selectionContainsInlines(\n  editor: SlateEditor,\n  match: (node: SlateNode) => boolean\n) {\n  const { selection } = editor;\n  if (!selection) {\n    return false;\n  }\n\n  const roots = Array.from(\n    SlateEditor.nodes(editor, {\n      at: selection,\n      match: (node) =>\n        SlateElement.isElement(node) && SlateEditor.isBlock(editor, node),\n      mode: \"lowest\",\n    })\n  );\n\n  for (const [, rootPath] of roots) {\n    const intersectingSelection = SlateRange.isRange(selection)\n      ? SlateRange.intersection(selection, SlateEditor.range(editor, rootPath))\n      : selection;\n\n    if (!intersectingSelection) {\n      continue;\n    }\n\n    const matches = Array.from(\n      SlateEditor.nodes(editor, {\n        at: intersectingSelection,\n        match: (node) =>\n          SlateEditor.isInline(editor, node as SlateElement) && match(node),\n      })\n    );\n\n    if (matches.length > 0) {\n      return true;\n    }\n  }\n\n  return false;\n}\n", "import { isUrl } from \"@liveblocks/core\";\nimport type { Editor as SlateEditor } from \"slate\";\nimport {\n  Element as SlateElement,\n  Node as SlateNode,\n  Range as SlateRange,\n  Transforms as SlateTransforms,\n} from \"slate\";\n\nimport type { ComposerBodyCustomLink } from \"../../../../types\";\nimport { isPlainText, isText } from \"../../../slate/utils/is-text\";\nimport { filterActiveMarks } from \"../../../slate/utils/marks\";\nimport { selectionContainsInlines } from \"../../../slate/utils/selection-contains-inlines\";\n\nexport function withCustomLinks(editor: SlateEditor): SlateEditor {\n  const { isInline, normalizeNode, insertData } = editor;\n\n  editor.isInline = (element) => {\n    return element.type === \"custom-link\" ? true : isInline(element);\n  };\n\n  editor.normalizeNode = (entry) => {\n    const [node, path] = entry;\n\n    // Prevent nested or empty custom links\n    if (SlateElement.isElement(node) && node.type === \"custom-link\") {\n      if (\n        node.children.length === 0 ||\n        (node.children.length === 1 && node.children[0]?.text === \"\")\n      ) {\n        SlateTransforms.removeNodes(editor, { at: path });\n      }\n    }\n\n    if (isText(node)) {\n      const parentNode = SlateNode.parent(editor, path);\n\n      // Prevent rich text within custom links by removing all marks of inner text nodes\n      if (isComposerBodyCustomLink(parentNode)) {\n        if (!isPlainText(node)) {\n          const marks = filterActiveMarks(node);\n\n          SlateTransforms.unsetNodes(editor, marks, { at: path });\n        }\n      }\n    }\n\n    normalizeNode(entry);\n  };\n\n  // Create custom links when pasting URLs while some text is selected\n  editor.insertData = (data) => {\n    const { selection } = editor;\n    const pastedText = data.getData(\"text/plain\");\n\n    // Keep track of whether the default behavior should be invoked\n    // This allows us to sequence multiple conditions in a performant way,\n    // ordering them by likelihood/cost and stopping early whenever possible\n    let shouldInvokeDefaultBehavior = true;\n\n    // Check if the selection is a range\n    if (selection && !SlateRange.isCollapsed(selection)) {\n      // Check if the selection is contained in a single block\n      if (selection.anchor.path[0] === selection.focus.path[0]) {\n        // Check if the pasted text is a valid URL\n        if (isUrl(pastedText)) {\n          // Check if the selection only contains (rich and/or plain) text nodes\n          if (!selectionContainsInlines(editor, (node) => !isText(node))) {\n            // If all conditions are met, wrap the selected nodes in a custom link\n            SlateTransforms.wrapNodes<ComposerBodyCustomLink>(\n              editor,\n              {\n                type: \"custom-link\",\n                url: pastedText,\n                children: [],\n              },\n              {\n                at: selection,\n                split: true,\n                match: isPlainText,\n              }\n            );\n            shouldInvokeDefaultBehavior = false;\n          }\n        }\n      }\n    }\n\n    if (shouldInvokeDefaultBehavior) {\n      insertData(data);\n    }\n  };\n\n  return editor;\n}\n\nexport function isComposerBodyCustomLink(\n  node: SlateNode\n): node is ComposerBodyCustomLink {\n  return SlateElement.isElement(node) && node.type === \"custom-link\";\n}\n", "import type { NodeEntry as SlateNodeEntry, Text as SlateText } from \"slate\";\nimport {\n  Editor as SlateEditor,\n  Element as SlateElement,\n  Node as SlateNode,\n  Path as SlatePath,\n  Range as SlateRange,\n  Transforms as SlateTransforms,\n} from \"slate\";\n\nimport type { ComposerBodyAutoLink } from \"../../../../types\";\nimport { isPlainText, isText } from \"../../../slate/utils/is-text\";\nimport { filterActiveMarks } from \"../../../slate/utils/marks\";\nimport { isComposerBodyCustomLink } from \"./custom-links\";\n\n/**\n * This implementation is inspired by Lexical's AutoLink plugin.\n * Additional modifications and features were added to adapt it to our specific needs.\n *\n * Original Lexical AutoLink plugin can be found at [Lexical's Github Repository](https://github.com/facebook/lexical/blob/main/packages/lexical-react/src/LexicalAutoLinkPlugin.ts)\n */\nexport function withAutoLinks(editor: SlateEditor): SlateEditor {\n  const { isInline, normalizeNode, deleteBackward } = editor;\n\n  editor.isInline = (element) => {\n    return element.type === \"auto-link\" ? true : isInline(element);\n  };\n\n  editor.normalizeNode = (entry) => {\n    const [node, path] = entry;\n\n    // Prevent auto links from being created inside custom links\n    if (isComposerBodyCustomLink(node)) {\n      return;\n    }\n\n    // Prevent nested or empty auto links\n    if (SlateElement.isElement(node) && node.type === \"auto-link\") {\n      if (\n        node.children.length === 0 ||\n        (node.children.length === 1 && node.children[0]?.text === \"\")\n      ) {\n        SlateTransforms.removeNodes(editor, { at: path });\n      }\n    }\n\n    if (isText(node)) {\n      const parentNode = SlateNode.parent(editor, path);\n\n      // Prevent auto links from being created inside custom links\n      if (isComposerBodyCustomLink(parentNode)) {\n        return;\n      } else if (isComposerBodyAutoLink(parentNode)) {\n        const parentPath = SlatePath.parent(path);\n        handleLinkEdit(editor, [parentNode, parentPath]);\n\n        // Prevent rich text within auto links by removing all marks of inner text nodes\n        if (!isPlainText(node)) {\n          const marks = filterActiveMarks(node);\n\n          SlateTransforms.unsetNodes(editor, marks, { at: path });\n        }\n      } else {\n        handleLinkCreate(editor, [node, path]);\n        handleNeighbours(editor, [node, path]);\n      }\n    }\n\n    normalizeNode(entry);\n  };\n\n  editor.deleteBackward = (unit) => {\n    deleteBackward(unit);\n    const { selection } = editor;\n    if (!selection) return;\n\n    if (!SlateRange.isCollapsed(selection)) return;\n\n    const [match] = SlateEditor.nodes(editor, {\n      at: selection,\n      match: isComposerBodyAutoLink,\n      mode: \"lowest\",\n    });\n\n    if (!match) return;\n\n    SlateTransforms.unwrapNodes(editor, {\n      match: isComposerBodyAutoLink,\n    });\n  };\n\n  return editor;\n}\n\nexport function isComposerBodyAutoLink(\n  node: SlateNode\n): node is ComposerBodyAutoLink {\n  return SlateElement.isElement(node) && node.type === \"auto-link\";\n}\n\n/**\n * 1. ((https?:\\/\\/(www\\.)?)|(www\\.))\n * - Matches 'http://' or 'https://' optionally followed by 'www.', or just 'www.'\n *\n * 2. [-a-zA-Z0-9@:%._+~#=]{1,256}\n * - Matches any character in the set [-a-zA-Z0-9@:%._+~#=] between 1 and 256 times, often found in the domain and subdomain part of the URL\n *\n * 3. \\.[a-zA-Z0-9()]{1,6}\n * - Matches a period followed by any character in the set [a-zA-Z0-9()] between 1 and 6 times, usually indicating the domain extension like .com, .org, etc.\n *\n * 4. \\b\n * - Represents a word boundary, ensuring that the characters following cannot be part of a different word\n *\n * 5. ([-a-zA-Z0-9().@:%_+~#?&//=]*)\n * - Matches any character in the set [-a-zA-Z0-9().@:%_+~#?&//=] between 0 and unlimited times, often found in the path, query parameters, or anchor part of the URL\n *\n * Matching URLs:\n * - http://www.example.com\n * - https://www.example.com\n * - www.example.com\n * - https://example.com/path?query=param#anchor\n *\n * Non-Matching URLs:\n * - http:/example.com (malformed scheme)\n * - example (missing scheme and domain extension)\n * - ftp://example.com (ftp scheme is not supported)\n * - example.com (missing scheme)\n */\nconst URL_REGEX =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9().@:%_+~#?&//=]*)/;\n\nconst PUNCTUATION_OR_SPACE = /[.,;!?\\s()]/;\n\nconst PERIOD_OR_QUESTION_MARK_FOLLOWED_BY_ALPHANUMERIC = /^[.?][a-zA-Z0-9]+/;\n\nconst PARENTHESES = /[()]/;\n\n/**\n * Helper function to check if a character is a separator (punctuation or space)\n * @param char The character to check\n * @returns Whether the character is a separator or not\n */\nfunction isSeparator(char: string): boolean {\n  return PUNCTUATION_OR_SPACE.test(char);\n}\n\n/**\n * Helper function to check if a text content ends with a separator (punctuation or space)\n * @param textContent The text content to check\n * @returns Whether the text content ends with a separator or not\n */\nfunction endsWithSeparator(textContent: string): boolean {\n  const lastCharacter = textContent[textContent.length - 1];\n\n  return lastCharacter !== undefined ? isSeparator(lastCharacter) : false;\n}\n\n/**\n * Helper function to check if a text content starts with a separator (punctuation or space)\n * @param textContent The text content to check\n * @returns Whether the text content starts with a separator or not\n */\nfunction startsWithSeparator(textContent: string): boolean {\n  const firstCharacter = textContent[0];\n\n  return firstCharacter !== undefined ? isSeparator(firstCharacter) : false;\n}\n\n/**\n * Helper function to check if a text content ends with a period or question mark\n * @param textContent The text content to check\n * @returns Whether the text content ends with a period or not\n */\nfunction endsWithPeriodOrQuestionMark(textContent: string): boolean {\n  return (\n    textContent[textContent.length - 1] === \".\" ||\n    textContent[textContent.length - 1] === \"?\"\n  );\n}\n\n/**\n * Helper function to get the \"logical length\" of a URL, taking into account things like opening/closing parentheses\n * @param url The URL to check\n * @returns The \"logical length\" of the URL\n */\nfunction getUrlLogicalLength(url: string): number {\n  if (!PARENTHESES.test(url)) {\n    return url.length;\n  }\n\n  let logicalLength = 0;\n  let parenthesesCount = 0;\n\n  for (const character of url) {\n    if (character === \"(\") {\n      parenthesesCount++;\n    }\n\n    if (character === \")\") {\n      parenthesesCount--;\n\n      if (parenthesesCount < 0) {\n        break;\n      }\n    }\n\n    logicalLength++;\n  }\n\n  return logicalLength;\n}\n\n/**\n * Helper function to check if the previous node is valid (text node that ends with a separator or is empty)\n */\nfunction isPreviousNodeValid(editor: SlateEditor, path: SlatePath): boolean {\n  const entry = SlateEditor.previous(editor, { at: path });\n  if (!entry) return true;\n\n  return (\n    isText(entry[0]) &&\n    (endsWithSeparator(entry[0].text) || entry[0].text === \"\")\n  );\n}\n\n/**\n * Helper function to check if the next node is valid (text node that starts with a separator or is empty)\n */\nfunction isNextNodeValid(editor: SlateEditor, path: SlatePath): boolean {\n  const entry = SlateEditor.next(editor, { at: path });\n  if (!entry) return true;\n\n  return (\n    isText(entry[0]) &&\n    (startsWithSeparator(entry[0].text) || entry[0].text === \"\")\n  );\n}\n\n/**\n * Helper function to check if the content around a text node is valid.\n * @param editor\n * @param entry\n * @param start\n * @param end\n * @returns\n */\nfunction isContentAroundValid(\n  editor: SlateEditor,\n  entry: SlateNodeEntry<SlateText>,\n  start: number,\n  end: number\n): boolean {\n  const [node, path] = entry;\n  const text = node.text;\n\n  const contentBefore = text[start - 1];\n  const contentBeforeIsValid =\n    start > 0 && contentBefore\n      ? isSeparator(contentBefore)\n      : isPreviousNodeValid(editor, path);\n\n  const contentAfter = text[end];\n  const contentAfterIsValid =\n    end < text.length && contentAfter\n      ? isSeparator(contentAfter)\n      : isNextNodeValid(editor, path);\n\n  return contentBeforeIsValid && contentAfterIsValid;\n}\n\nconst handleLinkEdit = (\n  editor: SlateEditor,\n  entry: SlateNodeEntry<ComposerBodyAutoLink>\n) => {\n  const [node, path] = entry;\n\n  // Step 1: Ensure that the Link node only contains text nodes as children\n  const children = SlateNode.children(editor, path);\n  for (const [child] of children) {\n    if (isText(child)) continue;\n    SlateTransforms.unwrapNodes(editor, { at: path });\n    return;\n  }\n  // Attempt to match the text content (of the Link node) against the URL regex\n  const text = SlateNode.string(node);\n  const match = URL_REGEX.exec(text);\n  const matchContent = match?.[0];\n\n  // Step 2: Ensure that the text content of the Link node matches the URL regex and is identical to the match\n  if (!match || matchContent !== text) {\n    SlateTransforms.unwrapNodes(editor, { at: path });\n    return;\n  }\n\n  // Step 3: Ensure that if the text content of the Link node ends with a period, we unwrap the Link node and wrap the text before the period in a new Link node\n  if (endsWithPeriodOrQuestionMark(text)) {\n    SlateTransforms.unwrapNodes(editor, { at: path });\n\n    const textBeforePeriod = text.slice(0, text.length - 1);\n\n    // Remove the last character from the link text and wrap the remaining text in a new link node\n    SlateTransforms.wrapNodes<ComposerBodyAutoLink>(\n      editor,\n      {\n        type: \"auto-link\",\n        url: textBeforePeriod,\n        children: [],\n      },\n      {\n        at: {\n          anchor: { path, offset: 0 },\n          focus: { path, offset: textBeforePeriod.length },\n        },\n        split: true,\n      }\n    );\n    return;\n  }\n\n  // Step 4: Allow some conditions to shorten the URL (e.g. supporting parentheses but only if they are balanced)\n  const logicalLength = getUrlLogicalLength(text);\n\n  if (logicalLength < text.length) {\n    SlateTransforms.unwrapNodes(editor, { at: path });\n\n    const logicalText = text.slice(0, logicalLength);\n\n    // Keep the \"logical\" text and wrap it in a new link node\n    SlateTransforms.wrapNodes<ComposerBodyAutoLink>(\n      editor,\n      {\n        type: \"auto-link\",\n        url: logicalText,\n        children: [],\n      },\n      {\n        at: {\n          anchor: { path, offset: 0 },\n          focus: { path, offset: logicalText.length },\n        },\n        split: true,\n      }\n    );\n    return;\n  }\n\n  // Step 5: Ensure that the text content of the Link node is surrounded by separators or the start/end of the text content\n  if (!isPreviousNodeValid(editor, path) || !isNextNodeValid(editor, path)) {\n    SlateTransforms.unwrapNodes(editor, { at: path });\n    return;\n  }\n\n  // Step 6: Ensure that the url attribute of the Link node is identical to its text content\n  if (node.url !== text) {\n    SlateTransforms.setNodes(editor, { url: matchContent }, { at: path });\n    return;\n  }\n};\n\nconst handleLinkCreate = (\n  editor: SlateEditor,\n  entry: SlateNodeEntry<SlateText>\n) => {\n  const [node, path] = entry;\n\n  // Step 1: Ensure that the text content of the node matches the URL regex\n  const match = URL_REGEX.exec(node.text);\n  const matchContent = match?.[0];\n\n  if (!match || matchContent === undefined) {\n    return;\n  }\n\n  const start = match.index;\n  const end = start + matchContent.length;\n\n  // Step 2: Ensure that the content around the node is valid\n  if (!isContentAroundValid(editor, entry, start, end)) return;\n\n  SlateTransforms.wrapNodes<ComposerBodyAutoLink>(\n    editor,\n    {\n      type: \"auto-link\",\n      url: matchContent,\n      children: [],\n    },\n    {\n      at: {\n        anchor: { path, offset: start },\n        focus: { path, offset: end },\n      },\n      split: true,\n    }\n  );\n  return;\n};\n\nconst handleNeighbours = (\n  editor: SlateEditor,\n  entry: SlateNodeEntry<SlateText>\n) => {\n  const [node, path] = entry;\n  const text = node.text;\n\n  const previousSibling = SlateEditor.previous(editor, { at: path });\n\n  if (previousSibling && isComposerBodyAutoLink(previousSibling[0])) {\n    if (PERIOD_OR_QUESTION_MARK_FOLLOWED_BY_ALPHANUMERIC.test(text)) {\n      SlateTransforms.unwrapNodes(editor, { at: previousSibling[1] });\n      SlateTransforms.mergeNodes(editor, { at: path });\n      return;\n    }\n\n    if (!startsWithSeparator(text)) {\n      SlateTransforms.unwrapNodes(editor, { at: previousSibling[1] });\n      return;\n    }\n  }\n\n  const nextSibling = SlateEditor.next(editor, { at: path });\n  if (\n    nextSibling &&\n    isComposerBodyAutoLink(nextSibling[0]) &&\n    !endsWithSeparator(text)\n  ) {\n    SlateTransforms.unwrapNodes(editor, { at: nextSibling[1] });\n    return;\n  }\n};\n", "import { MENTION_CHARACTER, type MentionData } from \"@liveblocks/core\";\nimport type { Node as SlateNode } from \"slate\";\nimport {\n  Editor as SlateEditor,\n  Element as SlateElement,\n  Range as SlateRange,\n  Transforms as SlateTransforms,\n} from \"slate\";\n\nimport type { ComposerBodyMention } from \"../../../../types\";\nimport {\n  getCharacterAfter,\n  getCharacterBefore,\n} from \"../../../slate/utils/get-character\";\nimport { getMatchRange } from \"../../../slate/utils/get-match-range\";\nimport { isEmptyString } from \"../../../slate/utils/is-empty-string\";\nimport { isWhitespaceCharacter } from \"../../../slate/utils/is-whitespace-character\";\n\nexport type MentionDraft = {\n  range: SlateRange;\n  text: string;\n};\n\nexport function getMentionDraftAtSelection(\n  editor: SlateEditor\n): MentionDraft | undefined {\n  const { selection } = editor;\n\n  if (!selection || !SlateRange.isCollapsed(selection)) {\n    return;\n  }\n\n  // Walk backwards from the selection until \"@\" is found, unless the character\n  // before isn't whitespace (or \"@\" is the block's first character)\n  const match = getMatchRange(editor, selection, [\"@\"], {\n    include: true,\n    allowConsecutiveWhitespace: false,\n    ignoreTerminator: (_, point) => {\n      const characterBefore = getCharacterBefore(editor, point);\n\n      // Ignore \"@\" if it's preceded by a non-whitespace character\n      if (characterBefore && !isWhitespaceCharacter(characterBefore.text)) {\n        return true;\n      }\n\n      return false;\n    },\n  });\n\n  if (!match) {\n    return;\n  }\n\n  const matchText = SlateEditor.string(editor, match);\n\n  // Check if the match starts with the mention character (not followed by a whitespace character)\n  if (\n    !matchText.startsWith(MENTION_CHARACTER) ||\n    (matchText.length > 1 && isWhitespaceCharacter(matchText[1]))\n  ) {\n    return;\n  }\n\n  return {\n    range: match,\n    // Exclude the mention character from the text\n    text: matchText.substring(1),\n  };\n}\n\nexport function isComposerBodyMention(\n  node: SlateNode\n): node is ComposerBodyMention {\n  return SlateElement.isElement(node) && node.type === \"mention\";\n}\n\nexport function insertMention(editor: SlateEditor, mention: MentionData) {\n  const mentionNode: ComposerBodyMention = {\n    type: \"mention\",\n    ...mention,\n    children: [{ text: \"\" }],\n  };\n\n  // Insert the mention\n  SlateTransforms.insertNodes(editor, mentionNode);\n  SlateTransforms.move(editor);\n\n  const afterCharacter = editor.selection\n    ? getCharacterAfter(editor, editor.selection)\n    : undefined;\n\n  if (!afterCharacter || afterCharacter.void) {\n    // Insert a following space if needed\n    SlateTransforms.insertText(editor, \" \");\n  } else if (isEmptyString(afterCharacter.text)) {\n    // Move the selection if it's already followed by a space\n    SlateTransforms.move(editor);\n  }\n}\n\nexport function insertMentionCharacter(editor: SlateEditor) {\n  if (!editor.selection) {\n    return;\n  }\n\n  // Check if the selection is preceded or followed by a non-whitespace character\n  const beforeCharacter = getCharacterBefore(editor, editor.selection, {\n    filterVoids: true,\n  });\n  const afterCharacter = getCharacterAfter(editor, editor.selection, {\n    filterVoids: true,\n  });\n  const shouldInsertSpaceBefore =\n    beforeCharacter && !isEmptyString(beforeCharacter.text);\n  const shouldInsertSpaceAfter =\n    afterCharacter && !isEmptyString(afterCharacter.text);\n\n  if (!SlateRange.isCollapsed(editor.selection)) {\n    const text =\n      (shouldInsertSpaceBefore ? \" \" : \"\") +\n      MENTION_CHARACTER +\n      (shouldInsertSpaceAfter ? \" \" : \"\");\n\n    // If the selection is collapsed, insert the mention character at the current selection\n    editor.insertText(text);\n\n    // If a following space was inserted, move the selection back by one\n    if (shouldInsertSpaceAfter) {\n      SlateTransforms.move(editor, {\n        distance: 1,\n        unit: \"character\",\n        reverse: true,\n      });\n    }\n  } else {\n    const beforeText = (shouldInsertSpaceBefore ? \" \" : \"\") + MENTION_CHARACTER;\n\n    // If the selection is not collapsed, insert the mention character before the selection\n    editor.insertText(beforeText, { at: SlateRange.start(editor.selection) });\n\n    if (shouldInsertSpaceAfter) {\n      editor.insertText(\" \", { at: SlateRange.end(editor.selection) });\n    }\n\n    // Collapse the selection at its end\n    SlateTransforms.collapse(editor, { edge: \"end\" });\n  }\n}\n\nexport function withMentions<T extends SlateEditor>(editor: T): T {\n  const { isInline, isVoid, markableVoid, deleteBackward } = editor;\n\n  editor.isInline = (element) => {\n    return isComposerBodyMention(element) || isInline(element);\n  };\n\n  editor.isVoid = (element) => {\n    return isComposerBodyMention(element) || isVoid(element);\n  };\n\n  editor.markableVoid = (element) => {\n    return isComposerBodyMention(element) || markableVoid(element);\n  };\n\n  editor.deleteBackward = (unit) => {\n    const { selection } = editor;\n\n    if (selection && SlateRange.isCollapsed(selection)) {\n      const [mention] = SlateEditor.nodes(editor, {\n        at:\n          unit === \"character\"\n            ? SlateEditor.before(editor, selection, { unit: \"character\" })\n            : selection,\n        match: isComposerBodyMention,\n      });\n\n      deleteBackward(unit);\n\n      if (mention) {\n        SlateTransforms.insertText(editor, MENTION_CHARACTER);\n      }\n    } else {\n      deleteBackward(unit);\n    }\n  };\n\n  return editor;\n}\n", "export default function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}", "import _typeof from \"./typeof.js\";\nexport default function _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}", "import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}", "import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}", "import { Node, Path, Text } from 'slate'\n\n/**\n * A weak map to hold anchor tokens.\n */\n\nconst ANCHOR: WeakMap<Node, [number, AnchorToken]> = new WeakMap()\n\n/**\n * A weak map to hold focus tokens.\n */\n\nconst FOCUS: WeakMap<Node, [number, FocusToken]> = new WeakMap()\n\n/**\n * All tokens inherit from a single constructor for `instanceof` checking.\n */\n\nexport class Token {}\n\n/**\n * Anchor tokens represent the selection's anchor point.\n */\n\nexport class AnchorToken extends Token {\n  offset?: number\n  path?: Path\n\n  constructor(\n    props: {\n      offset?: number\n      path?: Path\n    } = {}\n  ) {\n    super()\n    const { offset, path } = props\n    this.offset = offset\n    this.path = path\n  }\n}\n\n/**\n * Focus tokens represent the selection's focus point.\n */\n\nexport class FocusToken extends Token {\n  offset?: number\n  path?: Path\n\n  constructor(\n    props: {\n      offset?: number\n      path?: Path\n    } = {}\n  ) {\n    super()\n    const { offset, path } = props\n    this.offset = offset\n    this.path = path\n  }\n}\n\n/**\n * Add an anchor token to the end of a text node.\n */\n\nexport const addAnchorToken = (text: Text, token: AnchorToken) => {\n  const offset = text.text.length\n  ANCHOR.set(text, [offset, token])\n}\n\n/**\n * Get the offset if a text node has an associated anchor token.\n */\n\nexport const getAnchorOffset = (\n  text: Text\n): [number, AnchorToken] | undefined => {\n  return ANCHOR.get(text)\n}\n\n/**\n * Add a focus token to the end of a text node.\n */\n\nexport const addFocusToken = (text: Text, token: FocusToken) => {\n  const offset = text.text.length\n  FOCUS.set(text, [offset, token])\n}\n\n/**\n * Get the offset if a text node has an associated focus token.\n */\n\nexport const getFocusOffset = (\n  text: Text\n): [number, FocusToken] | undefined => {\n  return FOCUS.get(text)\n}\n", "import { Element, Descendant, Node, Range, Text, Editor } from 'slate'\nimport {\n  AnchorToken,\n  FocusToken,\n  Token,\n  addAnchorToken,\n  addFocusToken,\n  getAnchorOffset,\n  getFocusOffset,\n} from './tokens'\n\n/**\n * Resolve the descedants of a node by normalizing the children that can be\n * passed into a hyperscript creator function.\n */\n\nconst STRINGS: WeakSet<Text> = new WeakSet()\n\nconst resolveDescendants = (children: any[]): Descendant[] => {\n  const nodes: Node[] = []\n\n  const addChild = (child: Node | Token): void => {\n    if (child == null) {\n      return\n    }\n\n    const prev = nodes[nodes.length - 1]\n\n    if (typeof child === 'string') {\n      const text = { text: child }\n      STRINGS.add(text)\n      child = text\n    }\n\n    if (Text.isText(child)) {\n      const c = child // HACK: fix typescript complaining\n\n      if (\n        Text.isText(prev) &&\n        STRINGS.has(prev) &&\n        STRINGS.has(c) &&\n        Text.equals(prev, c, { loose: true })\n      ) {\n        prev.text += c.text\n      } else {\n        nodes.push(c)\n      }\n    } else if (Element.isElement(child)) {\n      nodes.push(child)\n    } else if (child instanceof Token) {\n      let n = nodes[nodes.length - 1]\n\n      if (!Text.isText(n)) {\n        addChild('')\n        n = nodes[nodes.length - 1] as Text\n      }\n\n      if (child instanceof AnchorToken) {\n        addAnchorToken(n, child)\n      } else if (child instanceof FocusToken) {\n        addFocusToken(n, child)\n      }\n    } else {\n      throw new Error(`Unexpected hyperscript child object: ${child}`)\n    }\n  }\n\n  for (const child of children.flat(Infinity)) {\n    addChild(child)\n  }\n\n  return nodes\n}\n\n/**\n * Create an anchor token.\n */\n\nexport function createAnchor(\n  tagName: string,\n  attributes: { [key: string]: any },\n  children: any[]\n): AnchorToken {\n  return new AnchorToken(attributes)\n}\n\n/**\n * Create an anchor and a focus token.\n */\n\nexport function createCursor(\n  tagName: string,\n  attributes: { [key: string]: any },\n  children: any[]\n): Token[] {\n  return [new AnchorToken(attributes), new FocusToken(attributes)]\n}\n\n/**\n * Create an `Element` object.\n */\n\nexport function createElement(\n  tagName: string,\n  attributes: { [key: string]: any },\n  children: any[]\n): Element {\n  return { ...attributes, children: resolveDescendants(children) }\n}\n\n/**\n * Create a focus token.\n */\n\nexport function createFocus(\n  tagName: string,\n  attributes: { [key: string]: any },\n  children: any[]\n): FocusToken {\n  return new FocusToken(attributes)\n}\n\n/**\n * Create a fragment.\n */\n\nexport function createFragment(\n  tagName: string,\n  attributes: { [key: string]: any },\n  children: any[]\n): Descendant[] {\n  return resolveDescendants(children)\n}\n\n/**\n * Create a `Selection` object.\n */\n\nexport function createSelection(\n  tagName: string,\n  attributes: { [key: string]: any },\n  children: any[]\n): Range {\n  const anchor: AnchorToken = children.find(c => c instanceof AnchorToken)\n  const focus: FocusToken = children.find(c => c instanceof FocusToken)\n\n  if (!anchor || anchor.offset == null || anchor.path == null) {\n    throw new Error(\n      `The <selection> hyperscript tag must have an <anchor> tag as a child with \\`path\\` and \\`offset\\` attributes defined.`\n    )\n  }\n\n  if (!focus || focus.offset == null || focus.path == null) {\n    throw new Error(\n      `The <selection> hyperscript tag must have a <focus> tag as a child with \\`path\\` and \\`offset\\` attributes defined.`\n    )\n  }\n\n  return {\n    anchor: {\n      offset: anchor.offset,\n      path: anchor.path,\n    },\n    focus: {\n      offset: focus.offset,\n      path: focus.path,\n    },\n    ...attributes,\n  }\n}\n\n/**\n * Create a `Text` object.\n */\n\nexport function createText(\n  tagName: string,\n  attributes: { [key: string]: any },\n  children: any[]\n): Text {\n  const nodes = resolveDescendants(children)\n\n  if (nodes.length > 1) {\n    throw new Error(\n      `The <text> hyperscript tag must only contain a single node's worth of children.`\n    )\n  }\n\n  let [node] = nodes\n\n  if (node == null) {\n    node = { text: '' }\n  }\n\n  if (!Text.isText(node)) {\n    throw new Error(`\n    The <text> hyperscript tag can only contain text content as children.`)\n  }\n\n  // COMPAT: If they used the <text> tag we want to guarantee that it won't be\n  // merge with other string children.\n  STRINGS.delete(node)\n\n  Object.assign(node, attributes)\n  return node\n}\n\n/**\n * Create a top-level `Editor` object.\n */\n\nexport const createEditor =\n  (makeEditor: () => Editor) =>\n  (\n    tagName: string,\n    attributes: { [key: string]: any },\n    children: any[]\n  ): Editor => {\n    const otherChildren: any[] = []\n    let selectionChild: Range | undefined\n\n    for (const child of children) {\n      if (Range.isRange(child)) {\n        selectionChild = child\n      } else {\n        otherChildren.push(child)\n      }\n    }\n\n    const descendants = resolveDescendants(otherChildren)\n    const selection: Partial<Range> = {}\n    const editor = makeEditor()\n    Object.assign(editor, attributes)\n    editor.children = descendants as Element[]\n\n    // Search the document's texts to see if any of them have tokens associated\n    // that need incorporated into the selection.\n    for (const [node, path] of Node.texts(editor)) {\n      const anchor = getAnchorOffset(node)\n      const focus = getFocusOffset(node)\n\n      if (anchor != null) {\n        const [offset] = anchor\n        selection.anchor = { path, offset }\n      }\n\n      if (focus != null) {\n        const [offset] = focus\n        selection.focus = { path, offset }\n      }\n    }\n\n    if (selection.anchor && !selection.focus) {\n      throw new Error(\n        `Slate hyperscript ranges must have both \\`<anchor />\\` and \\`<focus />\\` defined if one is defined, but you only defined \\`<anchor />\\`. For collapsed selections, use \\`<cursor />\\` instead.`\n      )\n    }\n\n    if (!selection.anchor && selection.focus) {\n      throw new Error(\n        `Slate hyperscript ranges must have both \\`<anchor />\\` and \\`<focus />\\` defined if one is defined, but you only defined \\`<focus />\\`. For collapsed selections, use \\`<cursor />\\` instead.`\n      )\n    }\n\n    if (selectionChild != null) {\n      editor.selection = selectionChild\n    } else if (Range.isRange(selection)) {\n      editor.selection = selection\n    }\n\n    return editor\n  }\n", "import { isPlainObject } from 'is-plain-object'\nimport { Element, createEditor as makeEditor } from 'slate'\nimport {\n  createAnchor,\n  createCursor,\n  createEditor,\n  createElement,\n  createFocus,\n  createFragment,\n  createSelection,\n  createText,\n} from './creators'\n\n/**\n * The default creators for Slate objects.\n */\n\nconst DEFAULT_CREATORS = {\n  anchor: createAnchor,\n  cursor: createCursor,\n  editor: createEditor(makeEditor),\n  element: createElement,\n  focus: createFocus,\n  fragment: createFragment,\n  selection: createSelection,\n  text: createText,\n}\n\n/**\n * `HyperscriptCreators` are dictionaries of `HyperscriptCreator` functions\n * keyed by tag name.\n */\n\ntype HyperscriptCreators<T = any> = Record<\n  string,\n  (tagName: string, attributes: { [key: string]: any }, children: any[]) => T\n>\n\n/**\n * `HyperscriptShorthands` are dictionaries of properties applied to specific\n * kind of object, keyed by tag name. They allow you to easily define custom\n * hyperscript tags for your domain.\n */\n\ntype HyperscriptShorthands = Record<string, Record<string, any>>\n\n/**\n * Create a Slate hyperscript function with `options`.\n */\n\nconst createHyperscript = (\n  options: {\n    creators?: HyperscriptCreators\n    elements?: HyperscriptShorthands\n  } = {}\n) => {\n  const { elements = {} } = options\n  const elementCreators = normalizeElements(elements)\n  const creators = {\n    ...DEFAULT_CREATORS,\n    ...elementCreators,\n    ...options.creators,\n  }\n\n  const jsx = createFactory(creators)\n  return jsx\n}\n\n/**\n * Create a Slate hyperscript function with `options`.\n */\n\nconst createFactory = <T extends HyperscriptCreators>(creators: T) => {\n  const jsx = <S extends keyof T & string>(\n    tagName: S,\n    attributes?: Object,\n    ...children: any[]\n  ): ReturnType<T[S]> => {\n    const creator = creators[tagName]\n\n    if (!creator) {\n      throw new Error(`No hyperscript creator found for tag: <${tagName}>`)\n    }\n\n    if (attributes == null) {\n      attributes = {}\n    }\n\n    if (!isPlainObject(attributes)) {\n      children = [attributes].concat(children)\n      attributes = {}\n    }\n\n    children = children.filter(child => Boolean(child)).flat()\n    const ret = creator(tagName, attributes, children)\n    return ret\n  }\n\n  return jsx\n}\n\n/**\n * Normalize a dictionary of element shorthands into creator functions.\n */\n\nconst normalizeElements = (elements: HyperscriptShorthands) => {\n  const creators: HyperscriptCreators<Element> = {}\n\n  for (const tagName in elements) {\n    const props = elements[tagName]\n\n    if (typeof props !== 'object') {\n      throw new Error(\n        `Properties specified for a hyperscript shorthand should be an object, but for the custom element <${tagName}>  tag you passed: ${props}`\n      )\n    }\n\n    creators[tagName] = (\n      tagName: string,\n      attributes: { [key: string]: any },\n      children: any[]\n    ) => {\n      return createElement('element', { ...props, ...attributes }, children)\n    }\n  }\n\n  return creators\n}\n\nexport { createHyperscript, HyperscriptCreators, HyperscriptShorthands }\n", "import {\n  createHyperscript,\n  HyperscriptCreators,\n  HyperscriptShorthands,\n} from './hyperscript'\nimport { createEditor, createText } from './creators'\n\n/**\n * The default hyperscript factory that ships with Slate, without custom tags.\n */\n\nconst jsx = createHyperscript()\n\nexport {\n  jsx,\n  createHyperscript,\n  createEditor,\n  createText,\n  HyperscriptCreators,\n  HyperscriptShorthands,\n}\n", "export function exists<T>(input: null | undefined | T): input is T {\n  return input !== null && input !== undefined;\n}\n", "import { exists } from \"./exists\";\n\nexport function getFiles(dataTransfer: DataTransfer) {\n  if (!dataTransfer.types.includes(\"Files\")) {\n    return [];\n  }\n\n  // We start by attempting to get files with `webkitGetAsEntry` as\n  // it allows us to filter out directories.\n  //\n  // Example: Copying a local file\n  let files = Array.from(dataTransfer.items)\n    .map((item) => {\n      const entry = item.webkitGetAsEntry();\n\n      return entry && entry.isFile ? item.getAsFile() : null;\n    })\n    .filter(exists);\n\n  // Then, since `dataTransfer.types` specifies that there are files\n  // but we couldn't get any with `webkitGetAsEntry`, we try to get\n  // them with `files`\n  //\n  // Example: Copying an image from a website\n  if (!files.length) {\n    files = Array.from(dataTransfer.files).filter((file) => file.type !== \"\");\n  }\n\n  return files;\n}\n", "import type {\n  Descendant as SlateDescendant,\n  Editor as SlateEditor,\n  Node as SlateNode,\n} from \"slate\";\nimport { Transforms as SlateTransforms } from \"slate\";\nimport type { HistoryEditor } from \"slate-history\";\nimport { jsx } from \"slate-hyperscript\";\nimport type { ReactEditor } from \"slate-react\";\n\nimport type {\n  ComposerBodyAutoLink,\n  ComposerBodyBlockElement,\n  ComposerBodyCustomLink,\n  ComposerBodyInlineElement,\n  ComposerBodyParagraph,\n  ComposerBodyText,\n} from \"../../../../types\";\nimport { getFiles } from \"../../../../utils/data-transfer\";\n\n// Based on: https://github.com/ianstormtaylor/slate/blob/main/site/examples/paste-html.tsx\n\nconst NEWLINE_REGEX = /[\\r\\n]/g;\nconst WHITESPACE_REGEX = /\\s+/g;\n\ntype OmitTextChildren<T> = Omit<T, \"text\" | \"children\">;\n\ntype ComposerBodyElementTag = OmitTextChildren<\n  ComposerBodyBlockElement | ComposerBodyInlineElement\n>;\ntype ComposerBodyTextTag = OmitTextChildren<ComposerBodyText>;\n\ntype DeserializedNode =\n  | null\n  | string\n  | SlateDescendant\n  | SlateDescendant[]\n  | DeserializedNode[];\n\nfunction areUrlsEqual(a: string, b: string) {\n  try {\n    const urlA = new URL(a);\n    const urlB = new URL(b);\n\n    return urlA.origin === urlB.origin && urlA.pathname === urlB.pathname;\n  } catch {\n    return false;\n  }\n}\n\nconst createParagraphElement = (): OmitTextChildren<ComposerBodyParagraph> => ({\n  type: \"paragraph\",\n});\n\nconst ELEMENT_TAGS = {\n  A: (\n    element\n  ): OmitTextChildren<ComposerBodyCustomLink | ComposerBodyAutoLink> => {\n    const href = element.getAttribute(\"href\");\n    const innerText = element.innerText;\n\n    return {\n      type: href && areUrlsEqual(href, innerText) ? \"auto-link\" : \"custom-link\",\n      url: href ?? \"\",\n    };\n  },\n  P: createParagraphElement,\n  // Falling back to paragraphs for unsupported elements\n  BLOCKQUOTE: createParagraphElement,\n  H1: createParagraphElement,\n  H2: createParagraphElement,\n  H3: createParagraphElement,\n  H4: createParagraphElement,\n  H5: createParagraphElement,\n  H6: createParagraphElement,\n  LI: createParagraphElement,\n} as Record<string, (node: HTMLElement) => ComposerBodyElementTag>;\n\nconst TEXT_TAGS = {\n  CODE: (): ComposerBodyTextTag => ({ code: true }),\n  DEL: (): ComposerBodyTextTag => ({ strikethrough: true }),\n  EM: (): ComposerBodyTextTag => ({ italic: true }),\n  I: (): ComposerBodyTextTag => ({ italic: true }),\n  S: (): ComposerBodyTextTag => ({ strikethrough: true }),\n  STRONG: (): ComposerBodyTextTag => ({ bold: true }),\n  B: (): ComposerBodyTextTag => ({ bold: true }),\n} as Record<string, (node: HTMLElement) => ComposerBodyTextTag>;\n\nfunction flattenListItems(node: HTMLElement): HTMLElement[] {\n  const listItems: HTMLElement[] = [];\n\n  if (node.nodeName === \"LI\") {\n    listItems.push(node);\n  }\n\n  node.childNodes.forEach((child) => {\n    if (child.nodeType === 1) {\n      listItems.push(...flattenListItems(child as HTMLElement));\n    }\n  });\n\n  return listItems;\n}\n\nfunction jsxTextChildren(\n  children: DeserializedNode[],\n  attrs?: ComposerBodyTextTag\n) {\n  return children.map((child) => jsx(\"text\", attrs, child));\n}\n\nfunction deserialize(node: Node): DeserializedNode {\n  if (node.nodeType === 3) {\n    let text = node.textContent;\n    const isMultiLine = text && NEWLINE_REGEX.test(text);\n\n    if (text && isMultiLine) {\n      text = text.replace(WHITESPACE_REGEX, \" \").trim();\n    }\n\n    return text ? { text } : null;\n  } else if (node.nodeType !== 1) {\n    return null;\n  } else if (node.nodeName === \"BR\") {\n    // Insert a new paragraph\n    return jsx(\"element\", createParagraphElement(), []);\n  }\n\n  const childNodes = Array.from(node.childNodes);\n  let children = childNodes.map(deserialize).flat();\n\n  // Lists aren't supported (yet), so we flatten them into paragraphs\n  if (node.nodeName === \"UL\" || node.nodeName === \"OL\") {\n    const listItems = flattenListItems(node as HTMLElement);\n\n    children = listItems.map((li) => deserialize(li)).flat();\n  }\n\n  if (children.length === 0) {\n    children = [{ text: \"\" }];\n  }\n\n  if (node.nodeName === \"BODY\") {\n    // If the body only contains text nodes, we wrap it in a paragraph\n    if (\n      children.length > 0 &&\n      children.every((child) => typeof child === \"string\")\n    ) {\n      children = [\n        { type: \"paragraph\", children: [{ text: children.join(\"\") }] },\n      ];\n    }\n\n    return jsx(\n      \"fragment\",\n      {},\n      children.filter((child) => typeof child !== \"string\")\n    );\n  }\n\n  if (ELEMENT_TAGS[node.nodeName]) {\n    const attrs = ELEMENT_TAGS[node.nodeName]!(node as HTMLElement);\n\n    return jsx(\"element\", attrs, children);\n  }\n\n  if (TEXT_TAGS[node.nodeName]) {\n    const attrs = TEXT_TAGS[node.nodeName]!(node as HTMLElement);\n\n    // If there is at least one non-text child, we skip this node\n    if (\n      children.some(\n        (child) => child && typeof child !== \"string\" && \"type\" in child\n      )\n    ) {\n      return jsx(\"fragment\", {}, children);\n    }\n\n    return jsxTextChildren(children, attrs);\n  }\n\n  // Guess inline marks based on styles\n  if (node.nodeName === \"SPAN\") {\n    const style = (node as HTMLElement).style;\n    const attrs: ComposerBodyTextTag = {};\n\n    if (\n      style.fontWeight === \"bold\" ||\n      style.fontWeight === \"700\" ||\n      style.fontWeight === \"800\" ||\n      style.fontWeight === \"900\"\n    ) {\n      attrs.bold = true;\n    }\n\n    if (style.fontStyle === \"italic\") {\n      attrs.italic = true;\n    }\n\n    if (style.textDecoration === \"line-through\") {\n      attrs.strikethrough = true;\n    }\n\n    return jsxTextChildren(children, attrs);\n  }\n\n  return children as DeserializedNode;\n}\n\nexport function withPaste(\n  editor: SlateEditor & ReactEditor & HistoryEditor,\n  {\n    createAttachments,\n    pasteFilesAsAttachments,\n  }: {\n    createAttachments: (files: File[]) => void;\n    pasteFilesAsAttachments?: boolean;\n  }\n) {\n  const { insertData } = editor;\n\n  editor.insertData = (data) => {\n    // Create attachments from files when pasting\n    if (data.types.includes(\"Files\") && pasteFilesAsAttachments) {\n      const files = getFiles(data);\n\n      if (files.length > 0) {\n        createAttachments(files);\n\n        return;\n      }\n    }\n\n    // Deserialize rich text from HTML when pasting (unless there's also Slate data)\n    if (\n      data.types.includes(\"text/html\") &&\n      !data.types.includes(\"application/x-slate-fragment\")\n    ) {\n      const html = data.getData(\"text/html\");\n\n      try {\n        const { body } = new DOMParser().parseFromString(html, \"text/html\");\n\n        // WebKit browsers can add a trailing `<br>`\n        body.querySelector(\"br.Apple-interchange-newline\")?.remove();\n\n        // Google Docs can use `<b>` as a wrapper for the entire document,\n        // it shouldn't be supported so we remove it\n        if (body.children.length === 1 && body.children[0]?.nodeName === \"B\") {\n          const wrapper = body.children[0] as HTMLElement;\n\n          while (wrapper.firstChild) {\n            body.insertBefore(wrapper.firstChild, wrapper);\n          }\n\n          body.removeChild(wrapper);\n        }\n\n        const fragment = deserialize(body);\n\n        if (fragment !== null && Array.isArray(fragment)) {\n          SlateTransforms.insertFragment(editor, fragment as SlateNode[]);\n\n          return;\n        }\n      } catch {\n        // Fallback to default `insertData` behavior\n      }\n    }\n\n    // Default `insertData` behavior\n    insertData(data);\n  };\n\n  return editor;\n}\n", "import type {\n  DetectOverflowOptions,\n  Placement,\n  UseFloatingOptions,\n} from \"@floating-ui/react-dom\";\nimport {\n  autoUpdate,\n  flip,\n  hide,\n  inline,\n  limitShift,\n  offset,\n  shift,\n  size,\n  useFloating,\n} from \"@floating-ui/react-dom\";\nimport type {\n  Client,\n  CommentAttachment,\n  CommentBody,\n  CommentBodyLink,\n  CommentBodyMention,\n  CommentLocalAttachment,\n  CommentMixedAttachment,\n} from \"@liveblocks/core\";\nimport {\n  HttpError,\n  isCommentBodyLink,\n  isCommentBodyMention,\n  isCommentBodyText,\n  kInternal,\n  makeEventSource,\n} from \"@liveblocks/core\";\nimport { useClient } from \"@liveblocks/react\";\nimport { useLatest, useLayoutEffect } from \"@liveblocks/react/_private\";\nimport type { DragEvent } from \"react\";\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n  useSyncExternalStore,\n} from \"react\";\n\nimport {\n  FLOATING_ELEMENT_COLLISION_PADDING,\n  FLOATING_ELEMENT_SIDE_OFFSET,\n} from \"../../constants\";\nimport type {\n  ComposerBody,\n  ComposerBodyAutoLink,\n  ComposerBodyCustomLink,\n  ComposerBodyMention,\n  ComposerBodyText,\n  Direction,\n} from \"../../types\";\nimport { getFiles } from \"../../utils/data-transfer\";\nimport { exists } from \"../../utils/exists\";\nimport { useInitial } from \"../../utils/use-initial\";\nimport { isText } from \"../slate/utils/is-text\";\nimport { useComposer, useComposerAttachmentsContext } from \"./contexts\";\nimport { isComposerBodyAutoLink } from \"./slate/plugins/auto-links\";\nimport { isComposerBodyCustomLink } from \"./slate/plugins/custom-links\";\nimport { isComposerBodyMention } from \"./slate/plugins/mentions\";\nimport type { FloatingAlignment, FloatingPosition } from \"./types\";\n\nexport function composerBodyMentionToCommentBodyMention(\n  mention: ComposerBodyMention\n): CommentBodyMention {\n  const { children: _, ...commentBodyMention } = mention;\n\n  return commentBodyMention;\n}\n\nexport function composerBodyAutoLinkToCommentBodyLink(\n  link: ComposerBodyAutoLink\n): CommentBodyLink {\n  return {\n    type: \"link\",\n    url: link.url,\n  };\n}\n\nexport function composerBodyCustomLinkToCommentBodyLink(\n  link: ComposerBodyCustomLink\n): CommentBodyLink {\n  return {\n    type: \"link\",\n    url: link.url,\n    text: link.children.map((child) => child.text).join(\"\"),\n  };\n}\n\nexport function commentBodyMentionToComposerBodyMention(\n  mention: CommentBodyMention\n): ComposerBodyMention {\n  return {\n    ...mention,\n    children: [{ text: \"\" }],\n  };\n}\n\nexport function commentBodyLinkToComposerBodyLink(\n  link: CommentBodyLink\n): ComposerBodyAutoLink | ComposerBodyCustomLink {\n  if (link.text) {\n    return {\n      type: \"custom-link\",\n      url: link.url,\n      children: [{ text: link.text }],\n    };\n  } else {\n    return {\n      type: \"auto-link\",\n      url: link.url,\n      children: [{ text: link.url }],\n    };\n  }\n}\n\nexport function composerBodyToCommentBody(body: ComposerBody): CommentBody {\n  return {\n    version: 1,\n    content: body\n      .map((block) => {\n        // All root blocks are paragraphs at the moment\n        if (block.type !== \"paragraph\") {\n          return null;\n        }\n\n        const children = block.children\n          .map((inline) => {\n            if (isComposerBodyMention(inline)) {\n              return composerBodyMentionToCommentBodyMention(inline);\n            }\n\n            if (isComposerBodyAutoLink(inline)) {\n              return composerBodyAutoLinkToCommentBodyLink(inline);\n            }\n\n            if (isComposerBodyCustomLink(inline)) {\n              return composerBodyCustomLinkToCommentBodyLink(inline);\n            }\n\n            if (isText(inline)) {\n              return inline;\n            }\n\n            return null;\n          })\n          .filter(exists);\n\n        return {\n          ...block,\n          children,\n        };\n      })\n      .filter(exists),\n  };\n}\n\nconst emptyComposerBody: ComposerBody = [];\n\nexport function commentBodyToComposerBody(body: CommentBody): ComposerBody {\n  if (!body || !body?.content) {\n    return emptyComposerBody;\n  }\n\n  return body.content\n    .map((block) => {\n      // All root blocks are paragraphs at the moment\n      if (block.type !== \"paragraph\") {\n        return null;\n      }\n\n      const children = block.children\n        .map((inline) => {\n          if (isCommentBodyMention(inline)) {\n            return commentBodyMentionToComposerBodyMention(inline);\n          }\n\n          if (isCommentBodyLink(inline)) {\n            return commentBodyLinkToComposerBodyLink(inline);\n          }\n\n          if (isCommentBodyText(inline)) {\n            return inline as ComposerBodyText;\n          }\n\n          return null;\n        })\n        .filter(exists);\n\n      return {\n        ...block,\n        children,\n      };\n    })\n    .filter(exists);\n}\n\nexport function getRtlFloatingAlignment(\n  alignment: FloatingAlignment\n): FloatingAlignment {\n  switch (alignment) {\n    case \"start\":\n      return \"end\";\n    case \"end\":\n      return \"start\";\n    default:\n      return \"center\";\n  }\n}\n\nexport function getSideAndAlignFromFloatingPlacement(placement: Placement) {\n  const [side, align = \"center\"] = placement.split(\"-\");\n\n  return [side, align] as const;\n}\n\n// Copy `z-index` from content to wrapper.\n// Inspired by https://github.com/radix-ui/primitives/blob/main/packages/react/popper/src/Popper.tsx\nexport function useContentZIndex() {\n  const [content, setContent] = useState<HTMLDivElement | null>(null);\n  const contentRef = useCallback(setContent, [setContent]);\n  const [contentZIndex, setContentZIndex] = useState<string>();\n\n  useLayoutEffect(() => {\n    if (content) {\n      setContentZIndex(window.getComputedStyle(content).zIndex);\n    }\n  }, [content]);\n\n  return [contentRef, contentZIndex] as const;\n}\n\nexport function useFloatingWithOptions({\n  type = \"bounds\",\n  position,\n  alignment,\n  dir,\n  open,\n}: {\n  type?: \"bounds\" | \"range\";\n  position: FloatingPosition;\n  alignment: FloatingAlignment;\n  dir: Direction | undefined;\n  open: boolean;\n}) {\n  const floatingOptions: UseFloatingOptions = useMemo(() => {\n    const detectOverflowOptions: DetectOverflowOptions = {\n      padding: FLOATING_ELEMENT_COLLISION_PADDING,\n    };\n\n    const middleware = [\n      type === \"range\" ? inline(detectOverflowOptions) : null,\n      flip({ ...detectOverflowOptions, crossAxis: false }),\n      hide(detectOverflowOptions),\n      shift({\n        ...detectOverflowOptions,\n        limiter: limitShift(),\n      }),\n      type === \"range\" ? offset(FLOATING_ELEMENT_SIDE_OFFSET) : null,\n      size({\n        ...detectOverflowOptions,\n        apply({ availableWidth, availableHeight, elements }) {\n          elements.floating.style.setProperty(\n            \"--lb-composer-floating-available-width\",\n            `${availableWidth}px`\n          );\n          elements.floating.style.setProperty(\n            \"--lb-composer-floating-available-height\",\n            `${availableHeight}px`\n          );\n        },\n      }),\n    ];\n\n    return {\n      strategy: \"fixed\",\n      placement:\n        alignment === \"center\"\n          ? position\n          : (`${position}-${dir === \"rtl\" ? getRtlFloatingAlignment(alignment) : alignment}` as Placement),\n      middleware,\n      whileElementsMounted: (...args) => {\n        return autoUpdate(...args, {\n          animationFrame: true,\n        });\n      },\n    };\n  }, [alignment, position, dir, type]);\n\n  return useFloating({\n    ...floatingOptions,\n    open,\n  });\n}\n\nexport function useComposerAttachmentsDropArea<\n  T extends HTMLElement = HTMLElement,\n>({\n  onDragEnter,\n  onDragLeave,\n  onDragOver,\n  onDrop,\n  disabled,\n}: {\n  onDragEnter?: (event: DragEvent<T>) => void;\n  onDragLeave?: (event: DragEvent<T>) => void;\n  onDragOver?: (event: DragEvent<T>) => void;\n  onDrop?: (event: DragEvent<T>) => void;\n  disabled?: boolean;\n}) {\n  const { isDisabled: isComposerDisabled } = useComposer();\n  const isDisabled = isComposerDisabled || disabled;\n  const { createAttachments } = useComposerAttachmentsContext();\n  const [isDraggingOver, setDraggingOver] = useState(false);\n  const latestIsDraggingOver = useLatest(isDraggingOver);\n\n  const handleDragEnter = useCallback(\n    (event: DragEvent<T>) => {\n      onDragEnter?.(event);\n\n      if (\n        latestIsDraggingOver.current ||\n        isDisabled ||\n        event.isDefaultPrevented()\n      ) {\n        return;\n      }\n\n      const dataTransfer = event.dataTransfer;\n\n      if (!dataTransfer.types.includes(\"Files\")) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      setDraggingOver(true);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [onDragEnter, isDisabled]\n  );\n\n  const handleDragLeave = useCallback(\n    (event: DragEvent<T>) => {\n      onDragLeave?.(event);\n\n      if (\n        !latestIsDraggingOver.current ||\n        isDisabled ||\n        event.isDefaultPrevented()\n      ) {\n        return;\n      }\n\n      // Ignore drag leave events that are not actually leaving the drop area\n      if (\n        event.relatedTarget\n          ? event.relatedTarget === event.currentTarget ||\n            event.currentTarget.contains(event.relatedTarget as HTMLElement)\n          : event.currentTarget !== event.target\n      ) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      setDraggingOver(false);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [onDragLeave, isDisabled]\n  );\n\n  const handleDragOver = useCallback(\n    (event: DragEvent<T>) => {\n      onDragOver?.(event);\n\n      if (isDisabled || event.isDefaultPrevented()) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n    },\n    [onDragOver, isDisabled]\n  );\n\n  const handleDrop = useCallback(\n    (event: DragEvent<T>) => {\n      onDrop?.(event);\n\n      if (\n        !latestIsDraggingOver.current ||\n        isDisabled ||\n        event.isDefaultPrevented()\n      ) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      setDraggingOver(false);\n\n      const files = getFiles(event.dataTransfer);\n\n      createAttachments(files);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [onDrop, isDisabled, createAttachments]\n  );\n\n  return [\n    isDraggingOver,\n    {\n      onDragEnter: handleDragEnter,\n      onDragLeave: handleDragLeave,\n      onDragOver: handleDragOver,\n      onDrop: handleDrop,\n      \"data-drop\": isDraggingOver ? \"\" : undefined,\n      \"data-disabled\": isDisabled ? \"\" : undefined,\n    } as const,\n  ] as const;\n}\n\ninterface ComposerAttachmentsManagerOptions {\n  maxFileSize: number;\n  roomId: string;\n}\n\nexport class AttachmentTooLargeError extends Error {\n  origin: \"client\" | \"server\";\n  name = \"AttachmentTooLargeError\";\n\n  constructor(message: string, origin: \"client\" | \"server\" = \"client\") {\n    super(message);\n    this.origin = origin;\n  }\n}\n\nfunction createComposerAttachmentsManager(\n  client: Client,\n  roomId: string,\n  options: ComposerAttachmentsManagerOptions\n) {\n  const attachments: Map<string, CommentMixedAttachment> = new Map();\n  const abortControllers: Map<string, AbortController> = new Map();\n  const eventSource = makeEventSource<void>();\n  let cachedSnapshot: CommentMixedAttachment[] | null = null;\n\n  function notifySubscribers() {\n    // Invalidate the cached snapshot\n    cachedSnapshot = null;\n    eventSource.notify();\n  }\n\n  function uploadAttachment(attachment: CommentLocalAttachment) {\n    const abortController = new AbortController();\n    abortControllers.set(attachment.id, abortController);\n\n    client[kInternal].httpClient\n      .uploadAttachment({\n        roomId,\n        attachment,\n        signal: abortController.signal,\n      })\n      .then(() => {\n        attachments.set(attachment.id, {\n          ...attachment,\n          status: \"uploaded\",\n        });\n        notifySubscribers();\n      })\n      .catch((error) => {\n        if (\n          error instanceof Error &&\n          error.name !== \"AbortError\" &&\n          error.name !== \"TimeoutError\"\n        ) {\n          attachments.set(attachment.id, {\n            ...attachment,\n            status: \"error\",\n            error:\n              error instanceof HttpError && error.status === 413\n                ? new AttachmentTooLargeError(\"File is too large.\", \"server\")\n                : error,\n          });\n          notifySubscribers();\n        }\n      });\n  }\n\n  function addAttachments(addedAttachments: CommentMixedAttachment[]) {\n    if (addedAttachments.length === 0) {\n      return;\n    }\n\n    // Ignore attachments that are already in the manager\n    const newAttachments = addedAttachments.filter(\n      (attachment) => !attachments.has(attachment.id)\n    );\n\n    const attachmentsToUpload: CommentLocalAttachment[] = [];\n\n    // Add all the new attachments to the manager\n    for (const attachment of newAttachments) {\n      if (attachment.type === \"localAttachment\") {\n        // The file is too large to be uploaded\n        if (attachment.file.size > options.maxFileSize) {\n          attachments.set(attachment.id, {\n            ...attachment,\n            status: \"error\",\n            error: new AttachmentTooLargeError(\"File is too large.\", \"client\"),\n          });\n\n          continue;\n        }\n\n        // Otherwise, mark the attachment to be uploaded\n        attachments.set(attachment.id, {\n          ...attachment,\n          status: \"uploading\",\n        });\n        attachmentsToUpload.push(attachment);\n      } else {\n        attachments.set(attachment.id, attachment);\n      }\n    }\n\n    // Notify subscribers about the new attachments that were added\n    if (newAttachments.length > 0) {\n      notifySubscribers();\n    }\n\n    // Upload all the new local attachments\n    for (const attachment of attachmentsToUpload) {\n      uploadAttachment(attachment);\n    }\n  }\n\n  function removeAttachment(attachmentId: string) {\n    const abortController = abortControllers.get(attachmentId);\n\n    abortController?.abort();\n\n    attachments.delete(attachmentId);\n    abortControllers.delete(attachmentId);\n\n    notifySubscribers();\n  }\n\n  function getSnapshot() {\n    if (!cachedSnapshot) {\n      cachedSnapshot = Array.from(attachments.values());\n    }\n\n    return cachedSnapshot;\n  }\n\n  // Clear all attachments and abort all ongoing uploads\n  function clear() {\n    abortControllers.forEach((controller) => controller.abort());\n    abortControllers.clear();\n    attachments.clear();\n\n    notifySubscribers();\n  }\n\n  return {\n    addAttachments,\n    removeAttachment,\n    getSnapshot,\n    subscribe: eventSource.subscribe,\n    clear,\n  };\n}\n\nfunction preventBeforeUnloadDefault(event: BeforeUnloadEvent) {\n  event.preventDefault();\n}\n\nexport function useComposerAttachmentsManager(\n  defaultAttachments: CommentAttachment[],\n  options: ComposerAttachmentsManagerOptions\n) {\n  const client = useClient();\n  const frozenDefaultAttachments = useInitial(defaultAttachments);\n  const frozenAttachmentsManager = useInitial(() =>\n    createComposerAttachmentsManager(client, options.roomId, options)\n  );\n\n  // Initialize default attachments on mount\n  useEffect(() => {\n    frozenAttachmentsManager.addAttachments(frozenDefaultAttachments);\n  }, [frozenDefaultAttachments, frozenAttachmentsManager]);\n\n  // Clear on unmount\n  useEffect(() => {\n    return () => {\n      frozenAttachmentsManager.clear();\n    };\n  }, [frozenAttachmentsManager]);\n\n  const attachments = useSyncExternalStore(\n    frozenAttachmentsManager.subscribe,\n    frozenAttachmentsManager.getSnapshot,\n    frozenAttachmentsManager.getSnapshot\n  );\n\n  const isUploadingAttachments = useMemo(() => {\n    return attachments.some(\n      (attachment) =>\n        attachment.type === \"localAttachment\" &&\n        attachment.status === \"uploading\"\n    );\n  }, [attachments]);\n\n  useEffect(() => {\n    if (!isUploadingAttachments) {\n      return;\n    }\n\n    window.addEventListener(\"beforeunload\", preventBeforeUnloadDefault);\n\n    return () => {\n      window.removeEventListener(\"beforeunload\", preventBeforeUnloadDefault);\n    };\n  }, [isUploadingAttachments]);\n\n  return {\n    attachments,\n    isUploadingAttachments,\n    addAttachments: frozenAttachmentsManager.addAttachments,\n    removeAttachment: frozenAttachmentsManager.removeAttachment,\n    clearAttachments: frozenAttachmentsManager.clear,\n  };\n}\n", "\"use client\";\n\nimport {\n  type CommentAttachment,\n  type CommentBody,\n  type CommentLocalAttachment,\n  createCommentAttachmentId,\n  type EventSource,\n  makeEventSource,\n  MENTION_CHARACTER,\n  type MentionData,\n  sanitizeUrl,\n} from \"@liveblocks/core\";\nimport { useRoom } from \"@liveblocks/react\";\nimport {\n  useClientOrNull,\n  useLayoutEffect,\n  useMentionSuggestions,\n  useResolveMentionSuggestions,\n  useSyncSource,\n} from \"@liveblocks/react/_private\";\nimport { Slot, Slottable } from \"@radix-ui/react-slot\";\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\";\nimport type {\n  AriaAttributes,\n  ChangeEvent,\n  FocusEvent,\n  FormEvent,\n  KeyboardEvent,\n  MouseEvent,\n  PointerEvent,\n  SyntheticEvent,\n} from \"react\";\nimport {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useId,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport type {\n  Descendant as SlateDescendant,\n  Element as SlateElement,\n} from \"slate\";\nimport {\n  createEditor,\n  Editor as SlateEditor,\n  insertText as insertSlateText,\n  Range as SlateRange,\n  Transforms as SlateTransforms,\n} from \"slate\";\nimport { withHistory } from \"slate-history\";\nimport type {\n  RenderElementProps,\n  RenderElementSpecificProps,\n  RenderLeafSpecificProps,\n  RenderPlaceholderProps,\n} from \"slate-react\";\nimport {\n  Editable,\n  ReactEditor,\n  Slate,\n  useSelected,\n  useSlateStatic,\n  withReact,\n} from \"slate-react\";\n\nimport { useLiveblocksUiConfig } from \"../../config\";\nimport type {\n  ComposerBody as ComposerBodyData,\n  ComposerBodyAutoLink,\n  ComposerBodyCustomLink,\n  ComposerBodyMark,\n  ComposerBodyMarks,\n  ComposerBodyMention,\n  ComposerBodyText,\n} from \"../../types\";\nimport { isKey } from \"../../utils/is-key\";\nimport { Persist, useAnimationPersist, usePersist } from \"../../utils/Persist\";\nimport { Portal } from \"../../utils/Portal\";\nimport { requestSubmit } from \"../../utils/request-submit\";\nimport { useIndex } from \"../../utils/use-index\";\nimport { useInitial } from \"../../utils/use-initial\";\nimport { useObservable } from \"../../utils/use-observable\";\nimport { useRefs } from \"../../utils/use-refs\";\nimport { withEmptyClearFormatting } from \"../slate/plugins/empty-clear-formatting\";\nimport { withNormalize } from \"../slate/plugins/normalize\";\nimport { getDOMRange } from \"../slate/utils/get-dom-range\";\nimport { isEmpty as isEditorEmpty } from \"../slate/utils/is-empty\";\nimport {\n  getComposerBodyMarks,\n  leaveMarkEdge,\n  toggleMark as toggleEditorMark,\n} from \"../slate/utils/marks\";\nimport {\n  ComposerAttachmentsContext,\n  ComposerContext,\n  ComposerEditorContext,\n  ComposerFloatingToolbarContext,\n  ComposerSuggestionsContext,\n  useComposer,\n  useComposerAttachmentsContext,\n  useComposerEditorContext,\n  useComposerFloatingToolbarContext,\n  useComposerSuggestionsContext,\n} from \"./contexts\";\nimport { withAutoFormatting } from \"./slate/plugins/auto-formatting\";\nimport { withAutoLinks } from \"./slate/plugins/auto-links\";\nimport { withCustomLinks } from \"./slate/plugins/custom-links\";\nimport type { MentionDraft } from \"./slate/plugins/mentions\";\nimport {\n  getMentionDraftAtSelection,\n  insertMention,\n  insertMentionCharacter,\n  withMentions,\n} from \"./slate/plugins/mentions\";\nimport { withPaste } from \"./slate/plugins/paste\";\nimport type {\n  ComposerAttachFilesProps,\n  ComposerAttachmentsDropAreaProps,\n  ComposerEditorComponents,\n  ComposerEditorElementProps,\n  ComposerEditorFloatingToolbarWrapperProps,\n  ComposerEditorLinkWrapperProps,\n  ComposerEditorMentionSuggestionsWrapperProps,\n  ComposerEditorMentionWrapperProps,\n  ComposerEditorProps,\n  ComposerFloatingToolbarProps,\n  ComposerFormProps,\n  ComposerLinkProps,\n  ComposerMarkToggleProps,\n  ComposerMentionProps,\n  ComposerSubmitProps,\n  ComposerSuggestionsListItemProps,\n  ComposerSuggestionsListProps,\n  ComposerSuggestionsProps,\n  FloatingPosition,\n} from \"./types\";\nimport {\n  commentBodyToComposerBody,\n  composerBodyToCommentBody,\n  getSideAndAlignFromFloatingPlacement,\n  useComposerAttachmentsDropArea,\n  useComposerAttachmentsManager,\n  useContentZIndex,\n  useFloatingWithOptions,\n} from \"./utils\";\n\nconst MENTION_SUGGESTIONS_POSITION: FloatingPosition = \"top\";\n\nconst FLOATING_TOOLBAR_POSITION: FloatingPosition = \"top\";\n\nconst COMPOSER_MENTION_NAME = \"ComposerMention\";\nconst COMPOSER_LINK_NAME = \"ComposerLink\";\nconst COMPOSER_FLOATING_TOOLBAR_NAME = \"ComposerFloatingToolbar\";\nconst COMPOSER_SUGGESTIONS_NAME = \"ComposerSuggestions\";\nconst COMPOSER_SUGGESTIONS_LIST_NAME = \"ComposerSuggestionsList\";\nconst COMPOSER_SUGGESTIONS_LIST_ITEM_NAME = \"ComposerSuggestionsListItem\";\nconst COMPOSER_SUBMIT_NAME = \"ComposerSubmit\";\nconst COMPOSER_EDITOR_NAME = \"ComposerEditor\";\nconst COMPOSER_ATTACH_FILES_NAME = \"ComposerAttachFiles\";\nconst COMPOSER_ATTACHMENTS_DROP_AREA_NAME = \"ComposerAttachmentsDropArea\";\nconst COMPOSER_MARK_TOGGLE_NAME = \"ComposerMarkToggle\";\nconst COMPOSER_FORM_NAME = \"ComposerForm\";\n\nconst emptyCommentBody: CommentBody = {\n  version: 1,\n  content: [{ type: \"paragraph\", children: [{ text: \"\" }] }],\n};\n\nfunction createComposerEditor({\n  createAttachments,\n  pasteFilesAsAttachments,\n}: {\n  createAttachments: (files: File[]) => void;\n  pasteFilesAsAttachments?: boolean;\n}) {\n  return withNormalize(\n    withMentions(\n      withCustomLinks(\n        withAutoLinks(\n          withAutoFormatting(\n            withEmptyClearFormatting(\n              withPaste(withHistory(withReact(createEditor())), {\n                createAttachments,\n                pasteFilesAsAttachments,\n              })\n            )\n          )\n        )\n      )\n    )\n  );\n}\n\nfunction ComposerEditorMentionWrapper({\n  Mention,\n  attributes,\n  children,\n  element,\n}: ComposerEditorMentionWrapperProps) {\n  const isSelected = useSelected();\n  const { children: _, ...mention } = element;\n\n  return (\n    <span {...attributes}>\n      {element.id ? (\n        <Mention mention={mention} isSelected={isSelected} />\n      ) : null}\n      {children}\n    </span>\n  );\n}\n\nfunction ComposerEditorLinkWrapper({\n  Link,\n  attributes,\n  element,\n  children,\n}: ComposerEditorLinkWrapperProps) {\n  const href = useMemo(() => sanitizeUrl(element.url) ?? \"\", [element.url]);\n\n  return (\n    <span {...attributes}>\n      <Link href={href}>{children}</Link>\n    </span>\n  );\n}\n\nfunction ComposerEditorMentionSuggestionsWrapper({\n  id,\n  itemId,\n  mentions,\n  selectedMentionId,\n  setSelectedMentionId,\n  mentionDraft,\n  setMentionDraft,\n  onItemSelect,\n  position = MENTION_SUGGESTIONS_POSITION,\n  dir,\n  MentionSuggestions,\n}: ComposerEditorMentionSuggestionsWrapperProps) {\n  const editor = useSlateStatic();\n  const { onEditorChange } = useComposerEditorContext();\n  const { isFocused } = useComposer();\n  const { portalContainer } = useLiveblocksUiConfig();\n  const [contentRef, contentZIndex] = useContentZIndex();\n  const isOpen =\n    isFocused && mentionDraft?.range !== undefined && mentions !== undefined;\n  const {\n    refs: { setReference, setFloating },\n    strategy,\n    isPositioned,\n    placement,\n    x,\n    y,\n    update,\n    elements,\n  } = useFloatingWithOptions({\n    position,\n    dir,\n    alignment: \"start\",\n    open: isOpen,\n  });\n\n  useObservable(onEditorChange, () => {\n    setMentionDraft(getMentionDraftAtSelection(editor));\n  });\n\n  useLayoutEffect(() => {\n    if (!mentionDraft) {\n      setReference(null);\n\n      return;\n    }\n\n    const domRange = getDOMRange(editor, mentionDraft.range);\n    setReference(domRange ?? null);\n  }, [setReference, editor, mentionDraft]);\n\n  // Manually update the placement when the number of suggestions changes\n  // This can prevent the list of suggestions from scrolling instead of moving to the other placement\n  useLayoutEffect(() => {\n    if (!isOpen) return;\n\n    const mentionSuggestions = elements.floating?.firstChild as\n      | HTMLElement\n      | undefined;\n\n    if (!mentionSuggestions) {\n      return;\n    }\n\n    // Force the mention suggestions to grow instead of scrolling\n    mentionSuggestions.style.overflowY = \"visible\";\n    mentionSuggestions.style.maxHeight = \"none\";\n\n    // Trigger a placement update\n    update();\n\n    // Reset the mention suggestions after the placement update\n    const animationFrame = requestAnimationFrame(() => {\n      mentionSuggestions.style.overflowY = \"auto\";\n      mentionSuggestions.style.maxHeight =\n        \"var(--lb-composer-floating-available-height)\";\n    });\n\n    return () => {\n      cancelAnimationFrame(animationFrame);\n    };\n  }, [mentions?.length, isOpen, elements.floating, update]);\n\n  return (\n    <Persist>\n      {isOpen ? (\n        <ComposerSuggestionsContext.Provider\n          value={{\n            id,\n            itemId,\n            selectedValue: selectedMentionId,\n            setSelectedValue: setSelectedMentionId,\n            onItemSelect,\n            placement,\n            dir,\n            ref: contentRef,\n          }}\n        >\n          <Portal\n            ref={setFloating}\n            container={portalContainer}\n            style={{\n              position: strategy,\n              top: 0,\n              left: 0,\n              transform: isPositioned\n                ? `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`\n                : \"translate3d(0, -200%, 0)\",\n              minWidth: \"max-content\",\n              zIndex: contentZIndex,\n            }}\n          >\n            <MentionSuggestions\n              mentions={mentions}\n              selectedMentionId={selectedMentionId}\n            />\n          </Portal>\n        </ComposerSuggestionsContext.Provider>\n      ) : null}\n    </Persist>\n  );\n}\n\nfunction ComposerEditorFloatingToolbarWrapper({\n  id,\n  position = FLOATING_TOOLBAR_POSITION,\n  dir,\n  FloatingToolbar,\n  hasFloatingToolbarRange,\n  setHasFloatingToolbarRange,\n}: ComposerEditorFloatingToolbarWrapperProps) {\n  const editor = useSlateStatic();\n  const { onEditorChange } = useComposerEditorContext();\n  const { isFocused } = useComposer();\n  const { portalContainer } = useLiveblocksUiConfig();\n  const [contentRef, contentZIndex] = useContentZIndex();\n  const [isPointerDown, setPointerDown] = useState(false);\n  const isOpen = isFocused && !isPointerDown && hasFloatingToolbarRange;\n  const {\n    refs: { setReference, setFloating },\n    strategy,\n    isPositioned,\n    placement,\n    x,\n    y,\n  } = useFloatingWithOptions({\n    type: \"range\",\n    position,\n    dir,\n    alignment: \"center\",\n    open: isOpen,\n  });\n\n  useLayoutEffect(() => {\n    if (!isFocused) {\n      return;\n    }\n\n    const handlePointerDown = () => setPointerDown(true);\n    const handlePointerUp = () => setPointerDown(false);\n\n    document.addEventListener(\"pointerdown\", handlePointerDown);\n    document.addEventListener(\"pointerup\", handlePointerUp);\n\n    return () => {\n      document.removeEventListener(\"pointerdown\", handlePointerDown);\n      document.removeEventListener(\"pointerup\", handlePointerUp);\n    };\n  }, [isFocused]);\n\n  useObservable(onEditorChange, () => {\n    // Detach from previous selection range (if any) to avoid sudden jumps\n    setReference(null);\n\n    // Then, wait for the next render to ensure the selection is updated\n    requestAnimationFrame(() => {\n      const domSelection = window.getSelection();\n\n      // Finally, show the toolbar if there's a selection range\n      if (\n        !editor.selection ||\n        SlateRange.isCollapsed(editor.selection) ||\n        !domSelection ||\n        !domSelection.rangeCount\n      ) {\n        setHasFloatingToolbarRange(false);\n        setReference(null);\n      } else {\n        setHasFloatingToolbarRange(true);\n\n        const domRange = domSelection.getRangeAt(0);\n        setReference(domRange);\n      }\n    });\n  });\n\n  return (\n    <Persist>\n      {isOpen ? (\n        <ComposerFloatingToolbarContext.Provider\n          value={{\n            id,\n            placement,\n            dir,\n            ref: contentRef,\n          }}\n        >\n          <Portal\n            ref={setFloating}\n            container={portalContainer}\n            style={{\n              position: strategy,\n              top: 0,\n              left: 0,\n              transform: isPositioned\n                ? `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`\n                : \"translate3d(0, -200%, 0)\",\n              minWidth: \"max-content\",\n              zIndex: contentZIndex,\n            }}\n          >\n            <FloatingToolbar />\n          </Portal>\n        </ComposerFloatingToolbarContext.Provider>\n      ) : null}\n    </Persist>\n  );\n}\n\n/**\n * Displays a floating toolbar attached to the selection within `Composer.Editor`.\n *\n * @example\n * <Composer.FloatingToolbar>\n *   <Composer.MarkToggle mark=\"bold\">Bold</Composer.MarkToggle>\n *   <Composer.MarkToggle mark=\"italic\">Italic</Composer.MarkToggle>\n * </Composer.FloatingToolbar>\n */\nconst ComposerFloatingToolbar = forwardRef<\n  HTMLDivElement,\n  ComposerFloatingToolbarProps\n>(({ children, onPointerDown, style, asChild, ...props }, forwardedRef) => {\n  const [isPresent] = usePersist();\n  const ref = useRef<HTMLDivElement>(null);\n  const {\n    id,\n    ref: contentRef,\n    placement,\n    dir,\n  } = useComposerFloatingToolbarContext(COMPOSER_FLOATING_TOOLBAR_NAME);\n  const mergedRefs = useRefs(forwardedRef, contentRef, ref);\n  const [side, align] = useMemo(\n    () => getSideAndAlignFromFloatingPlacement(placement),\n    [placement]\n  );\n  const Component = asChild ? Slot : \"div\";\n  useAnimationPersist(ref);\n\n  const handlePointerDown = useCallback(\n    (event: PointerEvent<HTMLDivElement>) => {\n      onPointerDown?.(event);\n\n      event.preventDefault();\n      event.stopPropagation();\n    },\n    [onPointerDown]\n  );\n\n  return (\n    <Component\n      dir={dir}\n      role=\"toolbar\"\n      id={id}\n      aria-label=\"Floating toolbar\"\n      {...props}\n      onPointerDown={handlePointerDown}\n      data-state={isPresent ? \"open\" : \"closed\"}\n      data-side={side}\n      data-align={align}\n      style={{\n        display: \"flex\",\n        flexDirection: \"row\",\n        maxWidth: \"var(--lb-composer-floating-available-width)\",\n        overflowX: \"auto\",\n        ...style,\n      }}\n      ref={mergedRefs}\n    >\n      {children}\n    </Component>\n  );\n});\n\nfunction ComposerEditorElement({\n  Mention,\n  Link,\n  ...props\n}: ComposerEditorElementProps) {\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n  const { attributes, children, element } = props;\n\n  switch (element.type) {\n    case \"mention\":\n      return (\n        <ComposerEditorMentionWrapper\n          Mention={Mention}\n          {...(props as RenderElementSpecificProps<ComposerBodyMention>)}\n        />\n      );\n    case \"auto-link\":\n    case \"custom-link\":\n      return (\n        <ComposerEditorLinkWrapper\n          Link={Link}\n          {...(props as RenderElementSpecificProps<\n            ComposerBodyAutoLink | ComposerBodyCustomLink\n          >)}\n        />\n      );\n    case \"paragraph\":\n      return (\n        <p {...attributes} style={{ position: \"relative\" }}>\n          {children}\n        </p>\n      );\n    default:\n      return null;\n  }\n}\n\n// <code><s><em><strong>text</strong></s></em></code>\nfunction ComposerEditorLeaf({\n  attributes,\n  children,\n  leaf,\n}: RenderLeafSpecificProps<ComposerBodyText>) {\n  if (leaf.bold) {\n    children = <strong>{children}</strong>;\n  }\n\n  if (leaf.italic) {\n    children = <em>{children}</em>;\n  }\n\n  if (leaf.strikethrough) {\n    children = <s>{children}</s>;\n  }\n\n  if (leaf.code) {\n    children = <code>{children}</code>;\n  }\n\n  return <span {...attributes}>{children}</span>;\n}\n\nfunction ComposerEditorPlaceholder({\n  attributes,\n  children,\n}: RenderPlaceholderProps) {\n  const { opacity: _opacity, ...style } = attributes.style;\n\n  return (\n    <span {...attributes} style={style} data-placeholder=\"\">\n      {children}\n    </span>\n  );\n}\n\n/**\n * Displays mentions within `Composer.Editor`.\n *\n * @example\n * <Composer.Mention>@{mention.id}</Composer.Mention>\n */\nconst ComposerMention = forwardRef<HTMLSpanElement, ComposerMentionProps>(\n  ({ children, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"span\";\n    const isSelected = useSelected();\n\n    return (\n      <Component\n        data-selected={isSelected || undefined}\n        {...props}\n        ref={forwardedRef}\n      >\n        {children}\n      </Component>\n    );\n  }\n);\n\n/**\n * Displays links within `Composer.Editor`.\n *\n * @example\n * <Composer.Link href={href}>{children}</Composer.Link>\n */\nconst ComposerLink = forwardRef<HTMLAnchorElement, ComposerLinkProps>(\n  ({ children, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"a\";\n\n    return (\n      <Component\n        target=\"_blank\"\n        rel=\"noopener noreferrer nofollow\"\n        {...props}\n        ref={forwardedRef}\n      >\n        {children}\n      </Component>\n    );\n  }\n);\n\n/**\n * Contains suggestions within `Composer.Editor`.\n */\nconst ComposerSuggestions = forwardRef<\n  HTMLDivElement,\n  ComposerSuggestionsProps\n>(({ children, style, asChild, ...props }, forwardedRef) => {\n  const [isPresent] = usePersist();\n  const ref = useRef<HTMLDivElement>(null);\n  const {\n    ref: contentRef,\n    placement,\n    dir,\n  } = useComposerSuggestionsContext(COMPOSER_SUGGESTIONS_NAME);\n  const mergedRefs = useRefs(forwardedRef, contentRef, ref);\n  const [side, align] = useMemo(\n    () => getSideAndAlignFromFloatingPlacement(placement),\n    [placement]\n  );\n  const Component = asChild ? Slot : \"div\";\n  useAnimationPersist(ref);\n\n  return (\n    <Component\n      dir={dir}\n      {...props}\n      data-state={isPresent ? \"open\" : \"closed\"}\n      data-side={side}\n      data-align={align}\n      style={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        maxHeight: \"var(--lb-composer-floating-available-height)\",\n        overflowY: \"auto\",\n        ...style,\n      }}\n      ref={mergedRefs}\n    >\n      {children}\n    </Component>\n  );\n});\n\n/**\n * Displays a list of suggestions within `Composer.Editor`.\n *\n * @example\n * <Composer.SuggestionsList>\n *   {mentions.map((mention) => (\n *     <Composer.SuggestionsListItem key={mention.id} value={mention.id}>\n *       @{mention.id}\n *     </Composer.SuggestionsListItem>\n *   ))}\n * </Composer.SuggestionsList>\n */\nconst ComposerSuggestionsList = forwardRef<\n  HTMLUListElement,\n  ComposerSuggestionsListProps\n>(({ children, asChild, ...props }, forwardedRef) => {\n  const { id } = useComposerSuggestionsContext(COMPOSER_SUGGESTIONS_LIST_NAME);\n  const Component = asChild ? Slot : \"ul\";\n\n  return (\n    <Component\n      role=\"listbox\"\n      id={id}\n      aria-label=\"Suggestions list\"\n      {...props}\n      ref={forwardedRef}\n    >\n      {children}\n    </Component>\n  );\n});\n\n/**\n * Displays a suggestion within `Composer.SuggestionsList`.\n *\n * @example\n * <Composer.SuggestionsListItem key={mention.id} value={mention.id}>\n *   @{mention.id}\n * </Composer.SuggestionsListItem>\n */\nconst ComposerSuggestionsListItem = forwardRef<\n  HTMLLIElement,\n  ComposerSuggestionsListItemProps\n>(\n  (\n    {\n      value,\n      children,\n      onPointerMove,\n      onPointerDown,\n      onClick,\n      asChild,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const ref = useRef<HTMLLIElement>(null);\n    const mergedRefs = useRefs(forwardedRef, ref);\n    const { selectedValue, setSelectedValue, itemId, onItemSelect } =\n      useComposerSuggestionsContext(COMPOSER_SUGGESTIONS_LIST_ITEM_NAME);\n    const Component = asChild ? Slot : \"li\";\n    const isSelected = useMemo(\n      () => selectedValue === value,\n      [selectedValue, value]\n    );\n    // TODO: Support props.id if provided, it will need to be sent up to Composer.Editor to use it in aria-activedescendant\n    const id = useMemo(() => itemId(value), [itemId, value]);\n\n    useEffect(() => {\n      if (ref?.current && isSelected) {\n        ref.current.scrollIntoView({ block: \"nearest\" });\n      }\n    }, [isSelected]);\n\n    const handlePointerMove = useCallback(\n      (event: PointerEvent<HTMLLIElement>) => {\n        onPointerMove?.(event);\n\n        if (!event.isDefaultPrevented()) {\n          setSelectedValue(value);\n        }\n      },\n      [onPointerMove, setSelectedValue, value]\n    );\n\n    const handlePointerDown = useCallback(\n      (event: PointerEvent<HTMLLIElement>) => {\n        onPointerDown?.(event);\n\n        event.preventDefault();\n        event.stopPropagation();\n      },\n      [onPointerDown]\n    );\n\n    const handleClick = useCallback(\n      (event: MouseEvent<HTMLLIElement>) => {\n        onClick?.(event);\n\n        const wasDefaultPrevented = event.isDefaultPrevented();\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (!wasDefaultPrevented) {\n          onItemSelect(value);\n        }\n      },\n      [onClick, onItemSelect, value]\n    );\n\n    return (\n      <Component\n        role=\"option\"\n        id={id}\n        data-selected={isSelected || undefined}\n        aria-selected={isSelected || undefined}\n        onPointerMove={handlePointerMove}\n        onPointerDown={handlePointerDown}\n        onClick={handleClick}\n        {...props}\n        ref={mergedRefs}\n      >\n        {children}\n      </Component>\n    );\n  }\n);\n\nconst defaultEditorComponents: ComposerEditorComponents = {\n  Link: ({ href, children }) => {\n    return <ComposerLink href={href}>{children}</ComposerLink>;\n  },\n  Mention: ({ mention }) => {\n    return (\n      <ComposerMention>\n        {MENTION_CHARACTER}\n        {mention.id}\n      </ComposerMention>\n    );\n  },\n  MentionSuggestions: ({ mentions }) => {\n    return mentions.length > 0 ? (\n      <ComposerSuggestions>\n        <ComposerSuggestionsList>\n          {mentions.map((mention) => (\n            <ComposerSuggestionsListItem key={mention.id} value={mention.id}>\n              {mention.id}\n            </ComposerSuggestionsListItem>\n          ))}\n        </ComposerSuggestionsList>\n      </ComposerSuggestions>\n    ) : null;\n  },\n};\n\n/**\n * Displays the composer's editor.\n *\n * @example\n * <Composer.Editor placeholder=\"Write a comment\" />\n */\nconst ComposerEditor = forwardRef<HTMLDivElement, ComposerEditorProps>(\n  (\n    {\n      defaultValue,\n      onKeyDown,\n      onFocus,\n      onBlur,\n      disabled,\n      autoFocus,\n      components,\n      dir,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const client = useClientOrNull();\n    const { editor, validate, setFocused, onEditorChange, roomId } =\n      useComposerEditorContext();\n    const {\n      submit,\n      focus,\n      blur,\n      select,\n      canSubmit,\n      isDisabled: isComposerDisabled,\n      isFocused,\n    } = useComposer();\n    const isDisabled = isComposerDisabled || disabled;\n    const initialBody = useInitial(defaultValue ?? emptyCommentBody);\n    const initialEditorValue = useMemo(() => {\n      return commentBodyToComposerBody(initialBody);\n    }, [initialBody]);\n    const { Link, Mention, MentionSuggestions, FloatingToolbar } = useMemo(\n      () => ({ ...defaultEditorComponents, ...components }),\n      [components]\n    );\n\n    const [hasFloatingToolbarRange, setHasFloatingToolbarRange] =\n      useState(false);\n    // If used with LiveblocksProvider but without resolveMentionSuggestions,\n    // we can skip the mention suggestions logic entirely\n    const resolveMentionSuggestions = useResolveMentionSuggestions();\n    const hasResolveMentionSuggestions = client\n      ? resolveMentionSuggestions\n      : true;\n    const [mentionDraft, setMentionDraft] = useState<MentionDraft>();\n    const mentionSuggestions = useMentionSuggestions(\n      roomId,\n      mentionDraft?.text\n    );\n    const [\n      selectedMentionSuggestionIndex,\n      setPreviousSelectedMentionSuggestionIndex,\n      setNextSelectedMentionSuggestionIndex,\n      setSelectedMentionSuggestionIndex,\n    ] = useIndex(0, mentionSuggestions?.length ?? 0);\n    const id = useId();\n    const floatingToolbarId = `liveblocks-floating-toolbar-${id}`;\n    const suggestionsListId = `liveblocks-suggestions-list-${id}`;\n    const suggestionsListItemId = useCallback(\n      (mentionId?: string) =>\n        mentionId\n          ? `liveblocks-suggestions-list-item-${id}-${mentionId}`\n          : undefined,\n      [id]\n    );\n\n    const renderElement = useCallback(\n      (props: RenderElementProps) => {\n        return (\n          <ComposerEditorElement Mention={Mention} Link={Link} {...props} />\n        );\n      },\n      [Link, Mention]\n    );\n\n    const handleChange = useCallback(\n      (value: SlateDescendant[]) => {\n        validate(value as SlateElement[]);\n\n        // Our multi-component setup requires us to instantiate the editor in `Composer.Form`\n        // but we can only listen to changes here in `Composer.Editor` via `Slate`, so we use\n        // an event source to notify `Composer.Form` of changes.\n        onEditorChange.notify();\n      },\n      [validate, onEditorChange]\n    );\n\n    const createMention = useCallback(\n      (mention?: MentionData) => {\n        if (!mentionDraft || !mention) {\n          return;\n        }\n\n        SlateTransforms.select(editor, mentionDraft.range);\n        insertMention(editor, mention);\n        setMentionDraft(undefined);\n        setSelectedMentionSuggestionIndex(0);\n      },\n      [editor, mentionDraft, setSelectedMentionSuggestionIndex]\n    );\n\n    const handleKeyDown = useCallback(\n      (event: KeyboardEvent<HTMLDivElement>) => {\n        onKeyDown?.(event);\n\n        if (event.isDefaultPrevented()) {\n          return;\n        }\n\n        // Allow leaving marks with ArrowLeft\n        if (isKey(event, \"ArrowLeft\")) {\n          leaveMarkEdge(editor, \"start\");\n        }\n\n        // Allow leaving marks with ArrowRight\n        if (isKey(event, \"ArrowRight\")) {\n          leaveMarkEdge(editor, \"end\");\n        }\n\n        if (mentionDraft && mentionSuggestions?.length) {\n          // Select the next mention suggestion on ArrowDown\n          if (isKey(event, \"ArrowDown\")) {\n            event.preventDefault();\n            setNextSelectedMentionSuggestionIndex();\n          }\n\n          // Select the previous mention suggestion on ArrowUp\n          if (isKey(event, \"ArrowUp\")) {\n            event.preventDefault();\n            setPreviousSelectedMentionSuggestionIndex();\n          }\n\n          // Create a mention on Enter/Tab\n          if (isKey(event, \"Enter\") || isKey(event, \"Tab\")) {\n            event.preventDefault();\n\n            const mention =\n              mentionSuggestions?.[selectedMentionSuggestionIndex];\n            createMention(mention);\n          }\n\n          // Close the suggestions on Escape\n          if (isKey(event, \"Escape\")) {\n            event.preventDefault();\n            setMentionDraft(undefined);\n            setSelectedMentionSuggestionIndex(0);\n          }\n        } else {\n          if (hasFloatingToolbarRange) {\n            // Close the floating toolbar on Escape\n            if (isKey(event, \"Escape\")) {\n              event.preventDefault();\n              setHasFloatingToolbarRange(false);\n            }\n          }\n\n          // Blur the editor on Escape\n          if (isKey(event, \"Escape\")) {\n            blur();\n          }\n\n          // Submit the editor on Enter\n          if (isKey(event, \"Enter\", { shift: false })) {\n            // Even if submitting is not possible, don't do anything else on Enter. (e.g. creating a new line)\n            event.preventDefault();\n\n            if (canSubmit) {\n              submit();\n            }\n          }\n\n          // Create a new line on Shift + Enter\n          if (isKey(event, \"Enter\", { shift: true })) {\n            event.preventDefault();\n            editor.insertBreak();\n          }\n\n          // Toggle bold on Command/Control + B\n          if (isKey(event, \"b\", { mod: true })) {\n            event.preventDefault();\n            toggleEditorMark(editor, \"bold\");\n          }\n\n          // Toggle italic on Command/Control + I\n          if (isKey(event, \"i\", { mod: true })) {\n            event.preventDefault();\n            toggleEditorMark(editor, \"italic\");\n          }\n\n          // Toggle strikethrough on Command/Control + Shift + S\n          if (isKey(event, \"s\", { mod: true, shift: true })) {\n            event.preventDefault();\n            toggleEditorMark(editor, \"strikethrough\");\n          }\n\n          // Toggle code on Command/Control + E\n          if (isKey(event, \"e\", { mod: true })) {\n            event.preventDefault();\n            toggleEditorMark(editor, \"code\");\n          }\n        }\n      },\n      [\n        onKeyDown,\n        mentionDraft,\n        mentionSuggestions,\n        hasFloatingToolbarRange,\n        editor,\n        setNextSelectedMentionSuggestionIndex,\n        setPreviousSelectedMentionSuggestionIndex,\n        selectedMentionSuggestionIndex,\n        createMention,\n        setSelectedMentionSuggestionIndex,\n        blur,\n        canSubmit,\n        submit,\n      ]\n    );\n\n    const handleFocus = useCallback(\n      (event: FocusEvent<HTMLDivElement>) => {\n        onFocus?.(event);\n\n        if (!event.isDefaultPrevented()) {\n          setFocused(true);\n        }\n      },\n      [onFocus, setFocused]\n    );\n\n    const handleBlur = useCallback(\n      (event: FocusEvent<HTMLDivElement>) => {\n        onBlur?.(event);\n\n        if (!event.isDefaultPrevented()) {\n          setFocused(false);\n        }\n      },\n      [onBlur, setFocused]\n    );\n\n    const selectedMention =\n      mentionSuggestions?.[selectedMentionSuggestionIndex];\n    const selectedMentionId = selectedMention?.id;\n    const setSelectedMentionId = useCallback(\n      (mentionId: string) => {\n        const index = mentionSuggestions?.findIndex(\n          (mention) => mention.id === mentionId\n        );\n\n        if (index !== undefined && index >= 0) {\n          setSelectedMentionSuggestionIndex(index);\n        }\n      },\n      [setSelectedMentionSuggestionIndex, mentionSuggestions]\n    );\n\n    const additionalProps: AriaAttributes = useMemo(\n      () =>\n        mentionDraft\n          ? {\n              role: \"combobox\",\n              \"aria-autocomplete\": \"list\",\n              \"aria-expanded\": true,\n              \"aria-controls\": suggestionsListId,\n              \"aria-activedescendant\": suggestionsListItemId(selectedMentionId),\n            }\n          : hasFloatingToolbarRange\n            ? {\n                \"aria-haspopup\": true,\n                \"aria-controls\": floatingToolbarId,\n              }\n            : {},\n      [\n        mentionDraft,\n        suggestionsListId,\n        suggestionsListItemId,\n        selectedMentionId,\n        hasFloatingToolbarRange,\n        floatingToolbarId,\n      ]\n    );\n\n    useImperativeHandle(forwardedRef, () => {\n      return ReactEditor.toDOMNode(editor, editor) as HTMLDivElement;\n    }, [editor]);\n\n    // Manually focus the editor when `autoFocus` is true\n    useLayoutEffect(() => {\n      if (autoFocus) {\n        focus();\n      }\n    }, [autoFocus, editor, focus]);\n\n    // Manually add a selection in the editor if the selection\n    // is still empty after being focused\n    useLayoutEffect(() => {\n      if (isFocused && editor.selection === null) {\n        select();\n      }\n    }, [editor, select, isFocused]);\n\n    const handleMentionSelect = useCallback(\n      (mentionId: string) => {\n        const mention = mentionSuggestions?.find(\n          (mention) => mention.id === mentionId\n        );\n\n        createMention(mention);\n      },\n      [createMention, mentionSuggestions]\n    );\n\n    return (\n      <Slate\n        editor={editor}\n        initialValue={initialEditorValue}\n        onChange={handleChange}\n      >\n        <Editable\n          dir={dir}\n          enterKeyHint={mentionDraft ? \"enter\" : \"send\"}\n          autoCapitalize=\"sentences\"\n          aria-label=\"Composer editor\"\n          data-focused={isFocused || undefined}\n          data-disabled={isDisabled || undefined}\n          {...additionalProps}\n          {...props}\n          readOnly={isDisabled}\n          disabled={isDisabled}\n          onKeyDown={handleKeyDown}\n          onFocus={handleFocus}\n          onBlur={handleBlur}\n          renderElement={renderElement}\n          renderLeaf={ComposerEditorLeaf}\n          renderPlaceholder={ComposerEditorPlaceholder}\n        />\n        {hasResolveMentionSuggestions && (\n          <ComposerEditorMentionSuggestionsWrapper\n            dir={dir}\n            mentionDraft={mentionDraft}\n            setMentionDraft={setMentionDraft}\n            selectedMentionId={selectedMentionId}\n            setSelectedMentionId={setSelectedMentionId}\n            mentions={mentionSuggestions}\n            id={suggestionsListId}\n            itemId={suggestionsListItemId}\n            onItemSelect={handleMentionSelect}\n            MentionSuggestions={MentionSuggestions}\n          />\n        )}\n        {FloatingToolbar && (\n          <ComposerEditorFloatingToolbarWrapper\n            dir={dir}\n            id={floatingToolbarId}\n            hasFloatingToolbarRange={hasFloatingToolbarRange}\n            setHasFloatingToolbarRange={setHasFloatingToolbarRange}\n            FloatingToolbar={FloatingToolbar}\n          />\n        )}\n      </Slate>\n    );\n  }\n);\n\nconst MAX_ATTACHMENTS = 10;\nconst MAX_ATTACHMENT_SIZE = 1024 * 1024 * 1024; // 1 GB\n\nfunction prepareAttachment(file: File): CommentLocalAttachment {\n  return {\n    type: \"localAttachment\",\n    status: \"idle\",\n    id: createCommentAttachmentId(),\n    name: file.name,\n    size: file.size,\n    mimeType: file.type,\n    file,\n  };\n}\n\n/**\n * Surrounds the composer's content and handles submissions.\n *\n * @example\n * <Composer.Form onComposerSubmit={({ body }) => {}}>\n *\t <Composer.Editor />\n *   <Composer.Submit />\n * </Composer.Form>\n */\nconst ComposerForm = forwardRef<HTMLFormElement, ComposerFormProps>(\n  (\n    {\n      children,\n      onSubmit,\n      onComposerSubmit,\n      defaultAttachments = [],\n      pasteFilesAsAttachments,\n      blurOnSubmit = true,\n      preventUnsavedChanges = true,\n      disabled,\n      asChild,\n      roomId: _roomId,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const Component = asChild ? Slot : \"form\";\n    const [isEmpty, setEmpty] = useState(true);\n    const [isSubmitting, setSubmitting] = useState(false);\n    const [isFocused, setFocused] = useState(false);\n    const room = useRoom({ allowOutsideRoom: true });\n\n    const roomId = _roomId !== undefined ? _roomId : room?.id;\n    if (roomId === undefined) {\n      throw new Error(\"Composer.Form must be a descendant of RoomProvider.\");\n    }\n\n    // Later: Offer as Composer.Form props: { maxAttachments: number; maxAttachmentSize: number; supportedAttachmentMimeTypes: string[]; }\n    const maxAttachments = MAX_ATTACHMENTS;\n    const maxAttachmentSize = MAX_ATTACHMENT_SIZE;\n\n    const {\n      attachments,\n      isUploadingAttachments,\n      addAttachments,\n      removeAttachment,\n      clearAttachments,\n    } = useComposerAttachmentsManager(defaultAttachments, {\n      maxFileSize: maxAttachmentSize,\n      roomId,\n    });\n    const numberOfAttachments = attachments.length;\n    const hasMaxAttachments = numberOfAttachments >= maxAttachments;\n\n    const isDisabled = useMemo(() => {\n      return isSubmitting || disabled === true;\n    }, [isSubmitting, disabled]);\n    const canSubmit = useMemo(() => {\n      return !isEmpty && !isUploadingAttachments;\n    }, [isEmpty, isUploadingAttachments]);\n    const [marks, setMarks] = useState<ComposerBodyMarks>(getComposerBodyMarks);\n\n    const ref = useRef<HTMLFormElement>(null);\n    const mergedRefs = useRefs(forwardedRef, ref);\n    const fileInputRef = useRef<HTMLInputElement>(null);\n    const syncSource = useSyncSource();\n\n    // Mark the composer as a pending update when it has unsubmitted (draft)\n    // text or attachments\n    const isPending = !preventUnsavedChanges\n      ? false\n      : !isEmpty || isUploadingAttachments || attachments.length > 0;\n\n    useEffect(() => {\n      syncSource?.setSyncStatus(\n        isPending ? \"has-local-changes\" : \"synchronized\"\n      );\n    }, [syncSource, isPending]);\n\n    const createAttachments = useCallback(\n      (files: File[]) => {\n        if (!files.length) {\n          return;\n        }\n\n        const numberOfAcceptedFiles = Math.max(\n          0,\n          maxAttachments - numberOfAttachments\n        );\n\n        files.splice(numberOfAcceptedFiles);\n\n        const attachments = files.map((file) => prepareAttachment(file));\n\n        addAttachments(attachments);\n      },\n      [addAttachments, maxAttachments, numberOfAttachments]\n    );\n\n    const createAttachmentsRef = useRef(createAttachments);\n\n    useEffect(() => {\n      createAttachmentsRef.current = createAttachments;\n    }, [createAttachments]);\n\n    const stableCreateAttachments = useCallback((files: File[]) => {\n      createAttachmentsRef.current(files);\n    }, []);\n\n    const editor = useInitial(() =>\n      createComposerEditor({\n        createAttachments: stableCreateAttachments,\n        pasteFilesAsAttachments,\n      })\n    );\n    const onEditorChange = useInitial(makeEventSource) as EventSource<void>;\n\n    const validate = useCallback(\n      (value: SlateElement[]) => {\n        setEmpty(isEditorEmpty(editor, value));\n      },\n      [editor]\n    );\n\n    const submit = useCallback(() => {\n      if (!canSubmit) {\n        return;\n      }\n\n      // We need to wait for the next frame in some cases like when composing diacritics,\n      // we want any native handling to be done first while still being handled on `keydown`.\n      requestAnimationFrame(() => {\n        if (ref.current) {\n          requestSubmit(ref.current);\n        }\n      });\n    }, [canSubmit]);\n\n    const clear = useCallback(() => {\n      SlateTransforms.delete(editor, {\n        at: {\n          anchor: SlateEditor.start(editor, []),\n          focus: SlateEditor.end(editor, []),\n        },\n      });\n    }, [editor]);\n\n    const select = useCallback(() => {\n      SlateTransforms.select(editor, SlateEditor.end(editor, []));\n    }, [editor]);\n\n    const focus = useCallback(\n      (resetSelection = true) => {\n        try {\n          if (!ReactEditor.isFocused(editor)) {\n            SlateTransforms.select(\n              editor,\n              resetSelection || !editor.selection\n                ? SlateEditor.end(editor, [])\n                : editor.selection\n            );\n            ReactEditor.focus(editor);\n          }\n        } catch {\n          // Slate's DOM-specific methods will throw if the editor's DOM\n          // node no longer exists. This action doesn't make sense on an\n          // unmounted editor so we can safely ignore it.\n        }\n      },\n      [editor]\n    );\n\n    const blur = useCallback(() => {\n      try {\n        ReactEditor.blur(editor);\n      } catch {\n        // Slate's DOM-specific methods will throw if the editor's DOM\n        // node no longer exists. This action doesn't make sense on an\n        // unmounted editor so we can safely ignore it.\n      }\n    }, [editor]);\n\n    const createMention = useCallback(() => {\n      if (disabled) {\n        return;\n      }\n\n      focus();\n      insertMentionCharacter(editor);\n    }, [disabled, editor, focus]);\n\n    const insertText = useCallback(\n      (text: string) => {\n        if (disabled) {\n          return;\n        }\n\n        focus(false);\n        insertSlateText(editor, text);\n      },\n      [disabled, editor, focus]\n    );\n\n    const attachFiles = useCallback(() => {\n      if (disabled) {\n        return;\n      }\n\n      if (fileInputRef.current) {\n        fileInputRef.current.click();\n      }\n    }, [disabled]);\n\n    const handleAttachmentsInputChange = useCallback(\n      (event: ChangeEvent<HTMLInputElement>) => {\n        if (disabled) {\n          return;\n        }\n\n        if (event.target.files) {\n          createAttachments(Array.from(event.target.files));\n\n          // Reset the input value to allow selecting the same file(s) again\n          event.target.value = \"\";\n        }\n      },\n      [createAttachments, disabled]\n    );\n\n    const onSubmitEnd = useCallback(() => {\n      clear();\n      clearAttachments();\n      setSubmitting(false);\n\n      if (blurOnSubmit) {\n        blur();\n      }\n    }, [blur, blurOnSubmit, clear, clearAttachments]);\n\n    const handleSubmit = useCallback(\n      (event: FormEvent<HTMLFormElement>) => {\n        if (disabled) {\n          return;\n        }\n\n        // In some situations (e.g. pressing Enter while composing diacritics), it's possible\n        // for the form to be submitted as empty even though we already checked whether the\n        // editor was empty when handling the key press.\n        const isEmpty = isEditorEmpty(editor, editor.children);\n\n        // We even prevent the user's `onSubmit` handler from being called if the editor is empty.\n        if (isEmpty) {\n          event.preventDefault();\n\n          return;\n        }\n\n        onSubmit?.(event);\n\n        if (!onComposerSubmit || event.isDefaultPrevented()) {\n          event.preventDefault();\n\n          return;\n        }\n\n        const body = composerBodyToCommentBody(\n          editor.children as ComposerBodyData\n        );\n        // Only non-local attachments are included to be submitted.\n        const commentAttachments: CommentAttachment[] = attachments\n          .filter(\n            (attachment) =>\n              attachment.type === \"attachment\" ||\n              (attachment.type === \"localAttachment\" &&\n                attachment.status === \"uploaded\")\n          )\n          .map((attachment) => {\n            return {\n              id: attachment.id,\n              type: \"attachment\",\n              mimeType: attachment.mimeType,\n              size: attachment.size,\n              name: attachment.name,\n            };\n          });\n\n        const promise = onComposerSubmit(\n          { body, attachments: commentAttachments },\n          event\n        );\n\n        event.preventDefault();\n\n        if (promise) {\n          setSubmitting(true);\n          promise.then(onSubmitEnd);\n        } else {\n          onSubmitEnd();\n        }\n      },\n      [disabled, editor, attachments, onComposerSubmit, onSubmit, onSubmitEnd]\n    );\n\n    const stopPropagation = useCallback((event: SyntheticEvent) => {\n      event.stopPropagation();\n    }, []);\n\n    const toggleMark = useCallback(\n      (mark: ComposerBodyMark) => {\n        toggleEditorMark(editor, mark);\n      },\n      [editor]\n    );\n\n    useObservable(onEditorChange, () => {\n      setMarks(getComposerBodyMarks(editor));\n    });\n\n    return (\n      <ComposerEditorContext.Provider\n        value={{\n          editor,\n          validate,\n          setFocused,\n          onEditorChange,\n          roomId,\n        }}\n      >\n        <ComposerAttachmentsContext.Provider\n          value={{\n            createAttachments,\n            isUploadingAttachments,\n            hasMaxAttachments,\n            maxAttachments,\n            maxAttachmentSize,\n          }}\n        >\n          <ComposerContext.Provider\n            value={{\n              isDisabled,\n              isFocused,\n              isEmpty,\n              canSubmit,\n              submit,\n              clear,\n              select,\n              focus,\n              blur,\n              createMention,\n              insertText,\n              attachments,\n              attachFiles,\n              removeAttachment,\n              toggleMark,\n              marks,\n            }}\n          >\n            <Component {...props} onSubmit={handleSubmit} ref={mergedRefs}>\n              <input\n                type=\"file\"\n                multiple\n                ref={fileInputRef}\n                onChange={handleAttachmentsInputChange}\n                onClick={stopPropagation}\n                tabIndex={-1}\n                style={{ display: \"none\" }}\n              />\n              <Slottable>{children}</Slottable>\n            </Component>\n          </ComposerContext.Provider>\n        </ComposerAttachmentsContext.Provider>\n      </ComposerEditorContext.Provider>\n    );\n  }\n);\n\n/**\n * A button to submit the composer.\n *\n * @example\n * <Composer.Submit>Send</Composer.Submit>\n */\nconst ComposerSubmit = forwardRef<HTMLButtonElement, ComposerSubmitProps>(\n  ({ children, disabled, asChild, ...props }, forwardedRef) => {\n    const Component = asChild ? Slot : \"button\";\n    const { canSubmit, isDisabled: isComposerDisabled } = useComposer();\n    const isDisabled = isComposerDisabled || disabled || !canSubmit;\n\n    return (\n      <Component\n        type=\"submit\"\n        {...props}\n        ref={forwardedRef}\n        disabled={isDisabled}\n      >\n        {children}\n      </Component>\n    );\n  }\n);\n\n/**\n * A button which opens a file picker to create attachments.\n *\n * @example\n * <Composer.AttachFiles>Attach files</Composer.AttachFiles>\n */\nconst ComposerAttachFiles = forwardRef<\n  HTMLButtonElement,\n  ComposerAttachFilesProps\n>(({ children, onClick, disabled, asChild, ...props }, forwardedRef) => {\n  const Component = asChild ? Slot : \"button\";\n  const { hasMaxAttachments } = useComposerAttachmentsContext();\n  const { isDisabled: isComposerDisabled, attachFiles } = useComposer();\n  const isDisabled = isComposerDisabled || hasMaxAttachments || disabled;\n\n  const handleClick = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      onClick?.(event);\n\n      if (!event.isDefaultPrevented()) {\n        attachFiles();\n      }\n    },\n    [attachFiles, onClick]\n  );\n\n  return (\n    <Component\n      type=\"button\"\n      {...props}\n      onClick={handleClick}\n      ref={forwardedRef}\n      disabled={isDisabled}\n    >\n      {children}\n    </Component>\n  );\n});\n\n/**\n * A drop area which accepts files to create attachments.\n *\n * @example\n * <Composer.AttachmentsDropArea>\n *   Drop files here\n * </Composer.AttachmentsDropArea>\n */\nconst ComposerAttachmentsDropArea = forwardRef<\n  HTMLDivElement,\n  ComposerAttachmentsDropAreaProps\n>(\n  (\n    {\n      onDragEnter,\n      onDragLeave,\n      onDragOver,\n      onDrop,\n      disabled,\n      asChild,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const Component = asChild ? Slot : \"div\";\n    const { isDisabled: isComposerDisabled } = useComposer();\n    const isDisabled = isComposerDisabled || disabled;\n    const [, dropAreaProps] = useComposerAttachmentsDropArea({\n      onDragEnter,\n      onDragLeave,\n      onDragOver,\n      onDrop,\n      disabled: isDisabled,\n    });\n\n    return (\n      <Component\n        {...dropAreaProps}\n        data-disabled={isDisabled ? \"\" : undefined}\n        {...props}\n        ref={forwardedRef}\n      />\n    );\n  }\n);\n\n/**\n * A toggle button which toggles a specific text mark.\n *\n * @example\n * <Composer.MarkToggle mark=\"bold\">\n *   Bold\n * </Composer.MarkToggle>\n */\nconst ComposerMarkToggle = forwardRef<\n  HTMLButtonElement,\n  ComposerMarkToggleProps\n>(\n  (\n    {\n      children,\n      mark,\n      onValueChange,\n      onClick,\n      onPointerDown,\n      asChild,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const Component = asChild ? Slot : \"button\";\n    const { marks, toggleMark } = useComposer();\n\n    const handlePointerDown = useCallback(\n      (event: PointerEvent<HTMLButtonElement>) => {\n        onPointerDown?.(event);\n\n        event.preventDefault();\n        event.stopPropagation();\n      },\n      [onPointerDown]\n    );\n\n    const handleClick = useCallback(\n      (event: MouseEvent<HTMLButtonElement>) => {\n        onClick?.(event);\n\n        if (!event.isDefaultPrevented()) {\n          event.preventDefault();\n          event.stopPropagation();\n\n          toggleMark(mark);\n          onValueChange?.(mark);\n        }\n      },\n      [mark, onClick, onValueChange, toggleMark]\n    );\n\n    return (\n      <TogglePrimitive.Root\n        asChild\n        pressed={marks[mark]}\n        onClick={handleClick}\n        onPointerDown={handlePointerDown}\n        {...props}\n      >\n        <Component {...props} ref={forwardedRef}>\n          {children}\n        </Component>\n      </TogglePrimitive.Root>\n    );\n  }\n);\n\nif (process.env.NODE_ENV !== \"production\") {\n  ComposerAttachFiles.displayName = COMPOSER_ATTACH_FILES_NAME;\n  ComposerAttachmentsDropArea.displayName = COMPOSER_ATTACHMENTS_DROP_AREA_NAME;\n  ComposerEditor.displayName = COMPOSER_EDITOR_NAME;\n  ComposerFloatingToolbar.displayName = COMPOSER_FLOATING_TOOLBAR_NAME;\n  ComposerForm.displayName = COMPOSER_FORM_NAME;\n  ComposerMention.displayName = COMPOSER_MENTION_NAME;\n  ComposerLink.displayName = COMPOSER_LINK_NAME;\n  ComposerSubmit.displayName = COMPOSER_SUBMIT_NAME;\n  ComposerSuggestions.displayName = COMPOSER_SUGGESTIONS_NAME;\n  ComposerSuggestionsList.displayName = COMPOSER_SUGGESTIONS_LIST_NAME;\n  ComposerSuggestionsListItem.displayName = COMPOSER_SUGGESTIONS_LIST_ITEM_NAME;\n  ComposerMarkToggle.displayName = COMPOSER_MARK_TOGGLE_NAME;\n}\n\n// NOTE: Every export from this file will be available publicly as Composer.*\nexport {\n  ComposerAttachFiles as AttachFiles,\n  ComposerAttachmentsDropArea as AttachmentsDropArea,\n  ComposerEditor as Editor,\n  ComposerFloatingToolbar as FloatingToolbar,\n  ComposerForm as Form,\n  ComposerLink as Link,\n  ComposerMarkToggle as MarkToggle,\n  ComposerMention as Mention,\n  ComposerSubmit as Submit,\n  ComposerSuggestions as Suggestions,\n  ComposerSuggestionsList as SuggestionsList,\n  ComposerSuggestionsListItem as SuggestionsListItem,\n};\n", "\"use client\";\n\nimport { Slot } from \"@radix-ui/react-slot\";\nimport type { ReactNode } from \"react\";\nimport { forwardRef, useMemo } from \"react\";\n\nimport type { ComponentPropsWithSlot } from \"../types\";\nimport { capitalize } from \"../utils/capitalize\";\nimport { dateTimeFormat, relativeTimeFormat } from \"../utils/intl\";\nimport { useInterval } from \"../utils/use-interval\";\nimport { useRerender } from \"../utils/use-rerender\";\n\nconst DYNAMIC_DATE_THRESHOLD = 3 * 24 * 60 * 60 * 1000; // 3 days\nconst RENDER_INTERVAL = 30 * 1000; // 30 seconds\n\nconst TIMESTAMP_NAME = \"Timestamp\";\n\nexport interface TimestampProps\n  extends Omit<ComponentPropsWithSlot<\"time\">, \"children\" | \"title\"> {\n  /**\n   * The date to display.\n   */\n  date: Date | string | number;\n\n  /**\n   * A function to format the displayed date.\n   */\n  children?: (date: Date, locale?: string) => ReactNode;\n\n  /**\n   * The `title` attribute's value or a function to format it.\n   */\n  title?: string | ((date: Date, locale?: string) => string);\n\n  /**\n   * The interval in milliseconds at which the component will re-render.\n   * Can be set to `false` to disable re-rendering.\n   */\n  interval?: number | false;\n\n  /**\n   * The locale used when formatting the date.\n   */\n  locale?: string;\n}\n\nconst relativeUnits = {\n  seconds: 60,\n  minutes: 60,\n  hours: 24,\n  days: 7,\n  weeks: 4.34524,\n  months: 12,\n};\n\n/**\n * Formats a date absolutely.\n */\nfunction formatVerboseDate(date: Date, locale?: string) {\n  const formatter = dateTimeFormat(locale, {\n    year: \"numeric\",\n    month: \"numeric\",\n    day: \"numeric\",\n    hour: \"numeric\",\n    minute: \"numeric\",\n  });\n\n  return capitalize(formatter.format(date));\n}\n\n/**\n * Formats a date absolutely with only the day and month.\n */\nfunction formatShortDate(date: Date, locale?: string) {\n  const formatter = dateTimeFormat(locale, {\n    month: \"short\",\n    day: \"numeric\",\n  });\n\n  return capitalize(formatter.format(date));\n}\n\n// Some locales' relative formatting can be broken (e.g. \"-1h\") when using the narrow style.\nconst localesWithBrokenNarrowRelativeFormatting = [\n  \"br\",\n  \"fr\",\n  \"nb\",\n  \"nn\",\n  \"no\",\n  \"ro\",\n  \"sv\",\n];\n\n/**\n * Formats a date relatively.\n */\nexport function formatRelativeDate(date: Date, locale?: string) {\n  let resolvedLocale: string;\n\n  if (locale) {\n    resolvedLocale = locale;\n  } else {\n    const formatter = relativeTimeFormat();\n\n    resolvedLocale = formatter.resolvedOptions().locale;\n  }\n\n  const isBrokenWhenNarrow = localesWithBrokenNarrowRelativeFormatting.some(\n    (locale) =>\n      resolvedLocale === locale || resolvedLocale.startsWith(`${locale}-`)\n  );\n\n  const formatter = relativeTimeFormat(resolvedLocale, {\n    style: isBrokenWhenNarrow ? \"short\" : \"narrow\",\n    numeric: \"auto\",\n  });\n\n  let difference = (date.getTime() - Date.now()) / 1000;\n\n  if (\n    difference > -relativeUnits.seconds &&\n    difference < relativeUnits.seconds\n  ) {\n    return formatter.format(0, \"seconds\");\n  }\n\n  for (const [unit, length] of Object.entries(relativeUnits)) {\n    if (Math.abs(difference) < length) {\n      return formatter.format(\n        Math.round(difference),\n        unit as Intl.RelativeTimeFormatUnit\n      );\n    }\n\n    difference /= length;\n  }\n\n  return capitalize(formatter.format(Math.round(difference), \"years\"));\n}\n\n/**\n * Formats a date relatively if it's recent or soon,\n * otherwise absolutely with only the day and month.\n */\nfunction formatDynamicDate(date: Date, locale?: string) {\n  return Math.abs(date.getTime() - Date.now()) <= DYNAMIC_DATE_THRESHOLD\n    ? formatRelativeDate(date, locale)\n    : formatShortDate(date, locale);\n}\n\n/**\n * Displays a formatted date, and automatically re-renders to support relative\n * formatting. Defaults to relative formatting for nearby dates and a short\n * absolute formatting for more distant ones.\n *\n * @example\n * <Timestamp date={new Date()} />\n *\n * @example\n * <Timestamp date={new Date()} title={(date) => date.toISOString()} interval={false}>\n *   {(date) => date.toLocaleDateString()}\n * </Timestamp>\n */\nexport const Timestamp = forwardRef<HTMLTimeElement, TimestampProps>(\n  (\n    {\n      date,\n      locale,\n      children: renderChildren = formatDynamicDate,\n      title: renderTitle = formatVerboseDate,\n      dateTime,\n      interval = RENDER_INTERVAL,\n      asChild,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const Component = asChild ? Slot : \"time\";\n    const [rerender, key] = useRerender();\n    const parsedDate = useMemo(() => new Date(date), [date]);\n    const normalizedDate = useMemo(\n      () => parsedDate.toISOString(),\n      [parsedDate]\n    );\n    const title = useMemo(\n      () =>\n        typeof renderTitle === \"function\"\n          ? renderTitle(parsedDate, locale)\n          : renderTitle,\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [renderTitle, parsedDate, locale, key]\n    );\n    const children = useMemo(\n      () =>\n        typeof renderChildren === \"function\"\n          ? renderChildren(parsedDate, locale)\n          : renderChildren,\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [renderChildren, parsedDate, locale, key]\n    );\n\n    useInterval(rerender, interval);\n\n    return (\n      <Component\n        {...props}\n        ref={forwardedRef}\n        dateTime={dateTime ?? normalizedDate}\n        title={title}\n      >\n        {children}\n      </Component>\n    );\n  }\n);\n\nif (process.env.NODE_ENV !== \"production\") {\n  Timestamp.displayName = TIMESTAMP_NAME;\n}\n", "export function download(url: string, name: string) {\n  const a = document.createElement(\"a\");\n  a.href = url;\n  a.download = name;\n  a.style.display = \"none\";\n\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n}\n", "import type { GroupMentionData } from \"@liveblocks/core\";\nimport { useGroup } from \"@liveblocks/react/_private\";\nimport { useMemo } from \"react\";\n\nimport { useCurrentUserId } from \"../shared\";\nimport { useInitial } from \"./use-initial\";\n\nexport function useIsGroupMentionMember(mention: GroupMentionData): boolean {\n  // Changing the contents of a group mention is not supported\n  // to support the Rules of Hooks.\n  const frozenMention = useInitial(mention);\n  const frozenUserIds = frozenMention.userIds;\n\n  // This is enforced at the type level, but just in case.\n  if (frozenMention.kind !== \"group\") {\n    return false;\n  } else if (Array.isArray(frozenUserIds)) {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const currentId = useCurrentUserId();\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const isMember = useMemo(() => {\n      return frozenUserIds.some((userId) => userId === currentId);\n    }, [frozenUserIds, currentId]);\n\n    return isMember;\n  } else {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const currentId = useCurrentUserId();\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const { group } = useGroup(frozenMention.id);\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const isMember = useMemo(() => {\n      return Boolean(group?.members.some((member) => member.id === currentId));\n    }, [group, currentId]);\n\n    return isMember;\n  }\n}\n", "import { useSyncExternalStore } from \"react\";\n\nfunction subscribe(callback: () => void) {\n  window.addEventListener(\"blur\", callback);\n  window.addEventListener(\"focus\", callback);\n\n  return () => {\n    window.removeEventListener(\"blur\", callback);\n    window.removeEventListener(\"focus\", callback);\n  };\n}\n\nfunction getSnapshot() {\n  return document.hasFocus();\n}\n\nfunction getServerSnapshot() {\n  return true;\n}\n\nexport function useWindowFocus() {\n  return useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot);\n}\n", "import { numberFormat } from \"./intl\";\n\nconst BASE = 1000;\nconst UNITS = [\"B\", \"KB\", \"MB\", \"GB\"] as const;\n\nexport function formatFileSize(bytes: number, locale?: string) {\n  if (bytes === 0) {\n    return `0 ${UNITS[1]}`;\n  }\n\n  let unit: number;\n\n  if (bytes === 0) {\n    unit = 1;\n  } else {\n    unit = Math.max(\n      1,\n      Math.min(\n        Math.floor(Math.log(Math.abs(bytes)) / Math.log(BASE)),\n        UNITS.length - 1\n      )\n    );\n  }\n\n  let value = bytes / BASE ** unit;\n  let maximumDecimals = 1;\n\n  if (unit === 1) {\n    // Hide decimals for KB values above 10\n    if (value >= 10) {\n      maximumDecimals = 0;\n    }\n\n    // Allow 2 decimals instead of 1 for KB values below 0.1\n    if (value < 0.1 && value > 0) {\n      maximumDecimals = 2;\n    }\n\n    // Display tiny KB values as 0.01 KB instead of 0 KB\n    if (value < 0.01) {\n      value = 0.01;\n    }\n  }\n\n  const formattedUnit = UNITS[unit];\n  const formattedValue = numberFormat(locale, {\n    minimumFractionDigits: 0,\n    maximumFractionDigits: maximumDecimals,\n  }).format(value);\n\n  return `${formattedValue} ${formattedUnit}`;\n}\n", "\"use client\";\n\nimport { Slot } from \"@radix-ui/react-slot\";\nimport type { ReactNode } from \"react\";\nimport { forwardRef, useMemo } from \"react\";\n\nimport type { ComponentPropsWithSlot } from \"../types\";\nimport { formatFileSize } from \"../utils/format-file-size\";\n\nconst FILE_SIZE_NAME = \"FileSize\";\n\nexport interface FileSizeProps\n  extends Omit<ComponentPropsWithSlot<\"span\">, \"children\"> {\n  /**\n   * The file size to display.\n   */\n  size: number;\n\n  /**\n   * A function to format the displayed file size.\n   */\n  children?: (size: number, locale?: string) => ReactNode;\n\n  /**\n   * The locale used when formatting the file size.\n   */\n  locale?: string;\n}\n\n/**\n * Displays a formatted file size.\n *\n * @example\n * <FileSize size={100000} />\n */\nexport const FileSize = forwardRef<HTMLSpanElement, FileSizeProps>(\n  (\n    {\n      size,\n      locale,\n      children: renderChildren = formatFileSize,\n      asChild,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const Component = asChild ? Slot : \"span\";\n    const children = useMemo(\n      () =>\n        typeof renderChildren === \"function\"\n          ? renderChildren(size, locale)\n          : renderChildren,\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [renderChildren, size]\n    );\n\n    return (\n      <Component {...props} ref={forwardedRef}>\n        {children}\n      </Component>\n    );\n  }\n);\n\nif (process.env.NODE_ENV !== \"production\") {\n  FileSize.displayName = FILE_SIZE_NAME;\n}\n", "\"use client\";\n\nimport type { CommentMixedAttachment } from \"@liveblocks/core\";\nimport { useRoomAttachmentUrl } from \"@liveblocks/react/_private\";\nimport type {\n  ComponentPropsWithoutRef,\n  KeyboardEvent,\n  MouseEventHandler,\n  PointerEvent,\n} from \"react\";\nimport { memo, useCallback, useMemo, useState } from \"react\";\n\nimport { CrossIcon } from \"../../icons/Cross\";\nimport { SpinnerIcon } from \"../../icons/Spinner\";\nimport { WarningIcon } from \"../../icons/Warning\";\nimport type { Overrides } from \"../../overrides\";\nimport { useOverrides } from \"../../overrides\";\nimport { AttachmentTooLargeError } from \"../../primitives\";\nimport { useComposerAttachmentsContextOrNull } from \"../../primitives/Composer/contexts\";\nimport { cn } from \"../../utils/cn\";\nimport { formatFileSize } from \"../../utils/format-file-size\";\nimport { Tooltip } from \"./Tooltip\";\n\nconst MAX_DISPLAYED_MEDIA_SIZE = 60 * 1024 * 1024; // 60 MB\n\ninterface AttachmentProps extends ComponentPropsWithoutRef<\"div\"> {\n  attachment: CommentMixedAttachment;\n  onDeleteClick?: MouseEventHandler<HTMLButtonElement>;\n  preventFocusOnDelete?: boolean;\n  roomId: string;\n  overrides?: Partial<Overrides>;\n  allowMediaPreview?: boolean;\n}\n\nconst fileExtensionRegex = /^(.+?)(\\.[^.]+)?$/;\n\nfunction splitFileName(name: string) {\n  const match = name.match(fileExtensionRegex);\n\n  return { base: match?.[1] ?? name, extension: match?.[2] };\n}\n\nfunction getAttachmentIconGlyph(mimeType: string) {\n  if (\n    mimeType === \"application/zip\" ||\n    mimeType === \"application/gzip\" ||\n    mimeType === \"application/vnd.rar\" ||\n    mimeType === \"application/x-rar-compressed\" ||\n    mimeType === \"application/x-7z-compressed\" ||\n    mimeType === \"application/x-zip-compressed\" ||\n    mimeType === \"application/x-tar\" ||\n    mimeType === \"application/x-bzip\" ||\n    mimeType === \"application/x-bzip2\"\n  ) {\n    return (\n      <path d=\"M13 15h2v1h-1.5a.5.5 0 0 0 0 1H15v1h-1.5a.5.5 0 0 0 0 1H15v1h-1.5a.5.5 0 0 0 0 1h1a.5.5 0 0 0 .5-.5V20h1.5a.5.5 0 0 0 0-1H15v-1h1.5a.5.5 0 0 0 0-1H15v-1h1.5a.5.5 0 0 0 .5-.5V15a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2Z\" />\n    );\n  }\n\n  if (\n    mimeType.startsWith(\"text/\") ||\n    mimeType.startsWith(\"font/\") ||\n    mimeType.startsWith(\"application/\")\n  ) {\n    return (\n      <path d=\"M10 16a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Z\" />\n    );\n  }\n\n  if (mimeType.startsWith(\"image/\")) {\n    return (\n      <path d=\"M12 16h6a1 1 0 0 1 1 1v3l-1.293-1.293a1 1 0 0 0-1.414 0L14.09 20.91l-.464-.386a1 1 0 0 0-1.265-.013l-1.231.985A.995.995 0 0 1 11 21v-4a1 1 0 0 1 1-1Zm-2 1a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-4Zm3 2a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z\" />\n    );\n  }\n\n  if (mimeType.startsWith(\"video/\")) {\n    return (\n      <path d=\"M12 15.71a1 1 0 0 1 1.49-.872l4.96 2.79a1 1 0 0 1 0 1.744l-4.96 2.79A1 1 0 0 1 12 21.29v-5.58Z\" />\n    );\n  }\n\n  if (mimeType.startsWith(\"audio/\")) {\n    return (\n      <path d=\"M15 15a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 1 0v-7a.5.5 0 0 0-.5-.5Zm-2.5 2.5a.5.5 0 0 1 1 0v3a.5.5 0 0 1-1 0v-3Zm-2 1a.5.5 0 0 1 1 0v1a.5.5 0 0 1-1 0v-1Zm6-1a.5.5 0 0 1 1 0v3a.5.5 0 0 1-1 0v-3ZM19 16a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5Z\" />\n    );\n  }\n\n  return null;\n}\n\nconst AttachmentFileIcon = memo(({ mimeType }: { mimeType: string }) => {\n  const iconGlyph = useMemo(() => getAttachmentIconGlyph(mimeType), [mimeType]);\n\n  return (\n    <svg\n      className=\"lb-attachment-icon\"\n      width={30}\n      height={30}\n      viewBox=\"0 0 30 30\"\n      fill=\"currentColor\"\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M6 5a2 2 0 0 1 2-2h5.843a4 4 0 0 1 2.829 1.172l6.156 6.156A4 4 0 0 1 24 13.157V25a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V5Z\"\n        className=\"lb-attachment-icon-shadow\"\n      />\n      <path\n        d=\"M6 5a2 2 0 0 1 2-2h5.843a4 4 0 0 1 2.829 1.172l6.156 6.156A4 4 0 0 1 24 13.157V25a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V5Z\"\n        className=\"lb-attachment-icon-background\"\n      />\n      <path\n        d=\"M14.382 3.037a4 4 0 0 1 2.29 1.135l6.156 6.157a4 4 0 0 1 1.136 2.289A2 2 0 0 0 22 11h-4a2 2 0 0 1-2-2V5a2 2 0 0 0-1.618-1.963Z\"\n        className=\"lb-attachment-icon-fold\"\n      />\n\n      {iconGlyph && <g className=\"lb-attachment-icon-glyph\">{iconGlyph}</g>}\n    </svg>\n  );\n});\n\nfunction AttachmentImagePreview({\n  attachment,\n  markPreviewAsUnsupported,\n  roomId,\n}: {\n  attachment: CommentMixedAttachment;\n  markPreviewAsUnsupported: () => void;\n  roomId: string;\n}) {\n  const { url } = useRoomAttachmentUrl(attachment.id, roomId);\n  const [isLoaded, setLoaded] = useState(false);\n\n  const handleLoad = useCallback(() => {\n    setLoaded(true);\n  }, []);\n\n  return (\n    <>\n      {!isLoaded ? <SpinnerIcon /> : null}\n      {url ? (\n        <div\n          className=\"lb-attachment-preview-media\"\n          data-hidden={!isLoaded ? \"\" : undefined}\n        >\n          <img\n            src={url}\n            loading=\"lazy\"\n            onLoad={handleLoad}\n            onError={markPreviewAsUnsupported}\n          />\n        </div>\n      ) : null}\n    </>\n  );\n}\n\nfunction AttachmentVideoPreview({\n  attachment,\n  markPreviewAsUnsupported,\n  roomId,\n}: {\n  attachment: CommentMixedAttachment;\n  markPreviewAsUnsupported: () => void;\n  roomId: string;\n}) {\n  const { url } = useRoomAttachmentUrl(attachment.id, roomId);\n  const [isLoaded, setLoaded] = useState(false);\n\n  const handleLoad = useCallback(() => {\n    setLoaded(true);\n  }, []);\n\n  return (\n    <>\n      {!isLoaded ? <SpinnerIcon /> : null}\n      {url ? (\n        <div\n          className=\"lb-attachment-preview-media\"\n          data-hidden={!isLoaded ? \"\" : undefined}\n        >\n          <video\n            src={url}\n            onLoadedData={handleLoad}\n            onError={markPreviewAsUnsupported}\n          />\n        </div>\n      ) : null}\n    </>\n  );\n}\n\nfunction AttachmentPreview({\n  attachment,\n  allowMediaPreview = true,\n  roomId,\n}: {\n  attachment: CommentMixedAttachment;\n  allowMediaPreview?: boolean;\n  roomId: string;\n}) {\n  const [isUnsupportedPreview, setUnsupportedPreview] = useState(false);\n  const isUploaded =\n    attachment.type === \"attachment\" || attachment.status === \"uploaded\";\n\n  function markPreviewAsUnsupported() {\n    setUnsupportedPreview(true);\n  }\n\n  if (\n    !isUnsupportedPreview &&\n    allowMediaPreview &&\n    isUploaded &&\n    attachment.size <= MAX_DISPLAYED_MEDIA_SIZE\n  ) {\n    if (attachment.mimeType.startsWith(\"image/\")) {\n      return (\n        <AttachmentImagePreview\n          attachment={attachment}\n          markPreviewAsUnsupported={markPreviewAsUnsupported}\n          roomId={roomId}\n        />\n      );\n    }\n\n    if (attachment.mimeType.startsWith(\"video/\")) {\n      return (\n        <AttachmentVideoPreview\n          attachment={attachment}\n          markPreviewAsUnsupported={markPreviewAsUnsupported}\n          roomId={roomId}\n        />\n      );\n    }\n  }\n\n  return <AttachmentFileIcon mimeType={attachment.mimeType} />;\n}\n\nfunction AttachmentName({\n  attachment,\n}: {\n  attachment: CommentMixedAttachment;\n}) {\n  const { base: fileBaseName, extension: fileExtension } = useMemo(() => {\n    return splitFileName(attachment.name);\n  }, [attachment.name]);\n\n  return (\n    <span className=\"lb-attachment-name\" title={attachment.name}>\n      <span className=\"lb-attachment-name-base\">{fileBaseName}</span>\n      {fileExtension && (\n        <span className=\"lb-attachment-name-extension\">{fileExtension}</span>\n      )}\n    </span>\n  );\n}\n\nfunction useClickOnKeyDown(\n  onKeyDown?: (event: KeyboardEvent<HTMLDivElement>) => void\n) {\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLDivElement>) => {\n      onKeyDown?.(event);\n\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n\n      // Simulate a click event on Enter or Space because it's a div\n      if (event.key === \"Enter\" || event.key === \" \") {\n        event.preventDefault();\n\n        const clickEvent = new MouseEvent(\"click\", {\n          bubbles: true,\n          cancelable: true,\n          view: window,\n        });\n        event.target.dispatchEvent(clickEvent);\n      }\n    },\n    [onKeyDown]\n  );\n\n  return handleKeyDown;\n}\n\nfunction useAttachmentContent(\n  attachment: CommentMixedAttachment,\n  overrides?: Partial<Overrides>\n) {\n  const $ = useOverrides(overrides);\n  const composerAttachmentsContext = useComposerAttachmentsContextOrNull();\n  const isInComposer = Boolean(composerAttachmentsContext);\n  const maxAttachmentSize = composerAttachmentsContext?.maxAttachmentSize;\n\n  const status =\n    attachment.type === \"localAttachment\" ? attachment.status : undefined;\n  const isUploading = status === \"uploading\";\n  const isError = status === \"error\";\n\n  let description: string;\n\n  if (attachment.type === \"localAttachment\" && attachment.status === \"error\") {\n    if (attachment.error instanceof AttachmentTooLargeError) {\n      if (attachment.error.origin === \"server\") {\n        description = $.ATTACHMENT_TOO_LARGE();\n      } else {\n        description = $.ATTACHMENT_TOO_LARGE(\n          maxAttachmentSize\n            ? formatFileSize(maxAttachmentSize, $.locale)\n            : undefined\n        );\n      }\n    } else {\n      description = $.ATTACHMENT_ERROR(attachment.error);\n    }\n  } else {\n    description = formatFileSize(attachment.size, $.locale);\n  }\n\n  const deleteLabel = isInComposer\n    ? $.COMPOSER_REMOVE_ATTACHMENT\n    : $.COMMENT_DELETE_ATTACHMENT;\n\n  return {\n    isUploading,\n    isError,\n    description,\n    deleteLabel,\n  };\n}\n\nexport function MediaAttachment({\n  attachment,\n  overrides,\n  onClick,\n  onDeleteClick,\n  preventFocusOnDelete,\n  allowMediaPreview = true,\n  roomId,\n  className,\n  onKeyDown,\n  ...props\n}: AttachmentProps) {\n  const { isUploading, isError, description, deleteLabel } =\n    useAttachmentContent(attachment, overrides);\n\n  const handleDeletePointerDown = useCallback(\n    (event: PointerEvent<HTMLButtonElement>) => {\n      if (preventFocusOnDelete) {\n        event.preventDefault();\n      }\n    },\n    [preventFocusOnDelete]\n  );\n\n  const handleKeyDown = useClickOnKeyDown(onKeyDown);\n\n  return (\n    <div\n      className={cn(\"lb-attachment lb-media-attachment\", className)}\n      data-error={isError ? \"\" : undefined}\n      {...props}\n      role={onClick ? \"button\" : undefined}\n      onClick={onClick}\n      tabIndex={onClick ? 0 : -1}\n      onKeyDown={onClick ? handleKeyDown : undefined}\n    >\n      <div className=\"lb-attachment-preview\">\n        {isUploading ? (\n          <SpinnerIcon />\n        ) : isError ? (\n          <WarningIcon />\n        ) : (\n          <AttachmentPreview\n            attachment={attachment}\n            allowMediaPreview={allowMediaPreview}\n            roomId={roomId}\n          />\n        )}\n      </div>\n      <div className=\"lb-attachment-details\">\n        <AttachmentName attachment={attachment} />\n        <span className=\"lb-attachment-description\" title={description}>\n          {description}\n        </span>\n      </div>\n      {onDeleteClick && (\n        <Tooltip content={deleteLabel}>\n          <button\n            type=\"button\"\n            className=\"lb-attachment-delete\"\n            onClick={onDeleteClick}\n            onPointerDown={handleDeletePointerDown}\n            aria-label={deleteLabel}\n          >\n            <CrossIcon />\n          </button>\n        </Tooltip>\n      )}\n    </div>\n  );\n}\n\nexport function FileAttachment({\n  attachment,\n  overrides,\n  onClick,\n  onDeleteClick,\n  preventFocusOnDelete,\n  allowMediaPreview = true,\n  roomId,\n  className,\n  onKeyDown,\n  ...props\n}: AttachmentProps) {\n  const { isUploading, isError, description, deleteLabel } =\n    useAttachmentContent(attachment, overrides);\n\n  const handleDeletePointerDown = useCallback(\n    (event: PointerEvent<HTMLButtonElement>) => {\n      if (preventFocusOnDelete) {\n        event.preventDefault();\n      }\n    },\n    [preventFocusOnDelete]\n  );\n\n  const handleKeyDown = useClickOnKeyDown(onKeyDown);\n\n  return (\n    <div\n      className={cn(\"lb-attachment lb-file-attachment\", className)}\n      data-error={isError ? \"\" : undefined}\n      {...props}\n      role={onClick ? \"button\" : undefined}\n      onClick={onClick}\n      tabIndex={onClick ? 0 : -1}\n      onKeyDown={onClick ? handleKeyDown : undefined}\n    >\n      <div className=\"lb-attachment-preview\">\n        {isUploading ? (\n          <SpinnerIcon />\n        ) : isError ? (\n          <WarningIcon />\n        ) : (\n          <AttachmentPreview\n            attachment={attachment}\n            allowMediaPreview={allowMediaPreview}\n            roomId={roomId}\n          />\n        )}\n      </div>\n      <div className=\"lb-attachment-details\">\n        <AttachmentName attachment={attachment} />\n        <span className=\"lb-attachment-description\" title={description}>\n          {description}\n        </span>\n      </div>\n      {onDeleteClick && (\n        <Tooltip content={deleteLabel}>\n          <button\n            type=\"button\"\n            className=\"lb-attachment-delete\"\n            onClick={onDeleteClick}\n            onPointerDown={handleDeletePointerDown}\n            aria-label={deleteLabel}\n          >\n            <CrossIcon />\n          </button>\n        </Tooltip>\n      )}\n    </div>\n  );\n}\n\nexport function separateMediaAttachments<T extends CommentMixedAttachment>(\n  attachments: T[]\n) {\n  const mediaAttachments: T[] = [];\n  const fileAttachments: T[] = [];\n\n  for (const attachment of attachments) {\n    if (\n      (attachment.mimeType.startsWith(\"image/\") ||\n        attachment.mimeType.startsWith(\"video/\")) &&\n      attachment.size <= MAX_DISPLAYED_MEDIA_SIZE\n    ) {\n      mediaAttachments.push(attachment);\n    } else {\n      fileAttachments.push(attachment);\n    }\n  }\n\n  return {\n    mediaAttachments,\n    fileAttachments,\n  };\n}\n", "import type { ComponentProps } from \"react\";\n\nimport { cn } from \"../../utils/cn\";\n\nexport function Attribution({ className, ...props }: ComponentProps<\"a\">) {\n  return (\n    <a\n      href=\"https://liveblocks.io\"\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className={cn(\"lb-composer-attribution\", className)}\n      {...props}\n    >\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 384 72\"\n        aria-label=\"Made with Liveblocks\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M86 10h-8v50h8V10Zm16 14h-8v36h8V24Zm0-15h-8v9h8V9Zm13 15h-9l12 36h10l13-36h-9l-9 28-8-28Zm44-1c-11 0-18 8-18 19s7 19 18 19c8 0 15-4 17-13h-8c-1 4-5 6-9 6-6 0-9-3-9-10h27c0-10-6-21-18-21Zm0 7c5 0 9 3 9 8h-18c0-5 4-8 9-8Zm42-7c-4 0-8 2-11 6V10h-8v50h8v-5c3 4 7 6 11 6 11 0 16-9 16-19s-5-19-16-19Zm-2 32c-7 0-9-7-9-13s2-13 9-13 9 7 9 13-2 13-9 13Zm32-45h-8v50h8V10Zm24 51c11 0 18-8 18-19s-8-19-18-19c-11 0-19 8-19 19s7 19 19 19Zm0-6c-8 0-10-7-10-13s2-13 10-13c7 0 9 7 9 13s-2 13-9 13Zm39 6c8 0 15-4 17-12l-8-1c-2 4-4 6-9 6-7 0-9-6-9-12s2-12 9-12c5 0 8 3 8 7l9-1c-2-8-9-13-17-13-11 0-18 9-18 19 0 11 7 19 18 19Zm30-14 4-4 10 17h10l-15-23 15-13h-11l-13 13V10h-9v50h9V47Zm39 14c8 0 16-3 16-12 0-8-8-10-15-11-2-1-7-1-7-5 0-3 3-4 6-4 4 0 7 3 7 7l8-1c-1-9-8-12-15-12s-15 3-15 11 9 10 15 11c3 1 8 2 8 5 0 4-4 5-7 5-5 0-8-3-9-7l-8 1c1 8 9 12 16 12ZM41 27H0l12 12v17l29-29ZM20 60h40L48 48V32L20 60Z\"\n          fill=\"currentColor\"\n        />\n      </svg>\n    </a>\n  );\n}\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { DismissableLayer } from '@radix-ui/react-dismissable-layer';\nimport { useFocusGuards } from '@radix-ui/react-focus-guards';\nimport { FocusScope } from '@radix-ui/react-focus-scope';\nimport { useId } from '@radix-ui/react-id';\nimport * as PopperPrimitive from '@radix-ui/react-popper';\nimport { createPopperScope } from '@radix-ui/react-popper';\nimport { Portal as PortalPrimitive } from '@radix-ui/react-portal';\nimport { Presence } from '@radix-ui/react-presence';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { createSlot } from '@radix-ui/react-slot';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { hideOthers } from 'aria-hidden';\nimport { RemoveScroll } from 'react-remove-scroll';\n\nimport type { Scope } from '@radix-ui/react-context';\n\n/* -------------------------------------------------------------------------------------------------\n * Popover\n * -----------------------------------------------------------------------------------------------*/\n\nconst POPOVER_NAME = 'Popover';\n\ntype ScopedProps<P> = P & { __scopePopover?: Scope };\nconst [createPopoverContext, createPopoverScope] = createContextScope(POPOVER_NAME, [\n  createPopperScope,\n]);\nconst usePopperScope = createPopperScope();\n\ntype PopoverContextValue = {\n  triggerRef: React.RefObject<HTMLButtonElement | null>;\n  contentId: string;\n  open: boolean;\n  onOpenChange(open: boolean): void;\n  onOpenToggle(): void;\n  hasCustomAnchor: boolean;\n  onCustomAnchorAdd(): void;\n  onCustomAnchorRemove(): void;\n  modal: boolean;\n};\n\nconst [PopoverProvider, usePopoverContext] =\n  createPopoverContext<PopoverContextValue>(POPOVER_NAME);\n\ninterface PopoverProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  modal?: boolean;\n}\n\nconst Popover: React.FC<PopoverProps> = (props: ScopedProps<PopoverProps>) => {\n  const {\n    __scopePopover,\n    children,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    modal = false,\n  } = props;\n  const popperScope = usePopperScope(__scopePopover);\n  const triggerRef = React.useRef<HTMLButtonElement>(null);\n  const [hasCustomAnchor, setHasCustomAnchor] = React.useState(false);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen ?? false,\n    onChange: onOpenChange,\n    caller: POPOVER_NAME,\n  });\n\n  return (\n    <PopperPrimitive.Root {...popperScope}>\n      <PopoverProvider\n        scope={__scopePopover}\n        contentId={useId()}\n        triggerRef={triggerRef}\n        open={open}\n        onOpenChange={setOpen}\n        onOpenToggle={React.useCallback(() => setOpen((prevOpen) => !prevOpen), [setOpen])}\n        hasCustomAnchor={hasCustomAnchor}\n        onCustomAnchorAdd={React.useCallback(() => setHasCustomAnchor(true), [])}\n        onCustomAnchorRemove={React.useCallback(() => setHasCustomAnchor(false), [])}\n        modal={modal}\n      >\n        {children}\n      </PopoverProvider>\n    </PopperPrimitive.Root>\n  );\n};\n\nPopover.displayName = POPOVER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverAnchor\n * -----------------------------------------------------------------------------------------------*/\n\nconst ANCHOR_NAME = 'PopoverAnchor';\n\ntype PopoverAnchorElement = React.ComponentRef<typeof PopperPrimitive.Anchor>;\ntype PopperAnchorProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Anchor>;\ninterface PopoverAnchorProps extends PopperAnchorProps {}\n\nconst PopoverAnchor = React.forwardRef<PopoverAnchorElement, PopoverAnchorProps>(\n  (props: ScopedProps<PopoverAnchorProps>, forwardedRef) => {\n    const { __scopePopover, ...anchorProps } = props;\n    const context = usePopoverContext(ANCHOR_NAME, __scopePopover);\n    const popperScope = usePopperScope(__scopePopover);\n    const { onCustomAnchorAdd, onCustomAnchorRemove } = context;\n\n    React.useEffect(() => {\n      onCustomAnchorAdd();\n      return () => onCustomAnchorRemove();\n    }, [onCustomAnchorAdd, onCustomAnchorRemove]);\n\n    return <PopperPrimitive.Anchor {...popperScope} {...anchorProps} ref={forwardedRef} />;\n  }\n);\n\nPopoverAnchor.displayName = ANCHOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRIGGER_NAME = 'PopoverTrigger';\n\ntype PopoverTriggerElement = React.ComponentRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = React.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface PopoverTriggerProps extends PrimitiveButtonProps {}\n\nconst PopoverTrigger = React.forwardRef<PopoverTriggerElement, PopoverTriggerProps>(\n  (props: ScopedProps<PopoverTriggerProps>, forwardedRef) => {\n    const { __scopePopover, ...triggerProps } = props;\n    const context = usePopoverContext(TRIGGER_NAME, __scopePopover);\n    const popperScope = usePopperScope(__scopePopover);\n    const composedTriggerRef = useComposedRefs(forwardedRef, context.triggerRef);\n\n    const trigger = (\n      <Primitive.button\n        type=\"button\"\n        aria-haspopup=\"dialog\"\n        aria-expanded={context.open}\n        aria-controls={context.contentId}\n        data-state={getState(context.open)}\n        {...triggerProps}\n        ref={composedTriggerRef}\n        onClick={composeEventHandlers(props.onClick, context.onOpenToggle)}\n      />\n    );\n\n    return context.hasCustomAnchor ? (\n      trigger\n    ) : (\n      <PopperPrimitive.Anchor asChild {...popperScope}>\n        {trigger}\n      </PopperPrimitive.Anchor>\n    );\n  }\n);\n\nPopoverTrigger.displayName = TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'PopoverPortal';\n\ntype PortalContextValue = { forceMount?: true };\nconst [PortalProvider, usePortalContext] = createPopoverContext<PortalContextValue>(PORTAL_NAME, {\n  forceMount: undefined,\n});\n\ntype PortalProps = React.ComponentPropsWithoutRef<typeof PortalPrimitive>;\ninterface PopoverPortalProps {\n  children?: React.ReactNode;\n  /**\n   * Specify a container element to portal the content into.\n   */\n  container?: PortalProps['container'];\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst PopoverPortal: React.FC<PopoverPortalProps> = (props: ScopedProps<PopoverPortalProps>) => {\n  const { __scopePopover, forceMount, children, container } = props;\n  const context = usePopoverContext(PORTAL_NAME, __scopePopover);\n  return (\n    <PortalProvider scope={__scopePopover} forceMount={forceMount}>\n      <Presence present={forceMount || context.open}>\n        <PortalPrimitive asChild container={container}>\n          {children}\n        </PortalPrimitive>\n      </Presence>\n    </PortalProvider>\n  );\n};\n\nPopoverPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'PopoverContent';\n\ninterface PopoverContentProps extends PopoverContentTypeProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst PopoverContent = React.forwardRef<PopoverContentTypeElement, PopoverContentProps>(\n  (props: ScopedProps<PopoverContentProps>, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopePopover);\n    const { forceMount = portalContext.forceMount, ...contentProps } = props;\n    const context = usePopoverContext(CONTENT_NAME, props.__scopePopover);\n    return (\n      <Presence present={forceMount || context.open}>\n        {context.modal ? (\n          <PopoverContentModal {...contentProps} ref={forwardedRef} />\n        ) : (\n          <PopoverContentNonModal {...contentProps} ref={forwardedRef} />\n        )}\n      </Presence>\n    );\n  }\n);\n\nPopoverContent.displayName = CONTENT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Slot = createSlot('PopoverContent.RemoveScroll');\n\ntype PopoverContentTypeElement = PopoverContentImplElement;\ninterface PopoverContentTypeProps\n  extends Omit<PopoverContentImplProps, 'trapFocus' | 'disableOutsidePointerEvents'> {}\n\nconst PopoverContentModal = React.forwardRef<PopoverContentTypeElement, PopoverContentTypeProps>(\n  (props: ScopedProps<PopoverContentTypeProps>, forwardedRef) => {\n    const context = usePopoverContext(CONTENT_NAME, props.__scopePopover);\n    const contentRef = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef);\n    const isRightClickOutsideRef = React.useRef(false);\n\n    // aria-hide everything except the content (better supported equivalent to setting aria-modal)\n    React.useEffect(() => {\n      const content = contentRef.current;\n      if (content) return hideOthers(content);\n    }, []);\n\n    return (\n      <RemoveScroll as={Slot} allowPinchZoom>\n        <PopoverContentImpl\n          {...props}\n          ref={composedRefs}\n          // we make sure we're not trapping once it's been closed\n          // (closed !== unmounted when animating out)\n          trapFocus={context.open}\n          disableOutsidePointerEvents\n          onCloseAutoFocus={composeEventHandlers(props.onCloseAutoFocus, (event) => {\n            event.preventDefault();\n            if (!isRightClickOutsideRef.current) context.triggerRef.current?.focus();\n          })}\n          onPointerDownOutside={composeEventHandlers(\n            props.onPointerDownOutside,\n            (event) => {\n              const originalEvent = event.detail.originalEvent;\n              const ctrlLeftClick = originalEvent.button === 0 && originalEvent.ctrlKey === true;\n              const isRightClick = originalEvent.button === 2 || ctrlLeftClick;\n\n              isRightClickOutsideRef.current = isRightClick;\n            },\n            { checkForDefaultPrevented: false }\n          )}\n          // When focus is trapped, a `focusout` event may still happen.\n          // We make sure we don't trigger our `onDismiss` in such case.\n          onFocusOutside={composeEventHandlers(\n            props.onFocusOutside,\n            (event) => event.preventDefault(),\n            { checkForDefaultPrevented: false }\n          )}\n        />\n      </RemoveScroll>\n    );\n  }\n);\n\nconst PopoverContentNonModal = React.forwardRef<PopoverContentTypeElement, PopoverContentTypeProps>(\n  (props: ScopedProps<PopoverContentTypeProps>, forwardedRef) => {\n    const context = usePopoverContext(CONTENT_NAME, props.__scopePopover);\n    const hasInteractedOutsideRef = React.useRef(false);\n    const hasPointerDownOutsideRef = React.useRef(false);\n\n    return (\n      <PopoverContentImpl\n        {...props}\n        ref={forwardedRef}\n        trapFocus={false}\n        disableOutsidePointerEvents={false}\n        onCloseAutoFocus={(event) => {\n          props.onCloseAutoFocus?.(event);\n\n          if (!event.defaultPrevented) {\n            if (!hasInteractedOutsideRef.current) context.triggerRef.current?.focus();\n            // Always prevent auto focus because we either focus manually or want user agent focus\n            event.preventDefault();\n          }\n\n          hasInteractedOutsideRef.current = false;\n          hasPointerDownOutsideRef.current = false;\n        }}\n        onInteractOutside={(event) => {\n          props.onInteractOutside?.(event);\n\n          if (!event.defaultPrevented) {\n            hasInteractedOutsideRef.current = true;\n            if (event.detail.originalEvent.type === 'pointerdown') {\n              hasPointerDownOutsideRef.current = true;\n            }\n          }\n\n          // Prevent dismissing when clicking the trigger.\n          // As the trigger is already setup to close, without doing so would\n          // cause it to close and immediately open.\n          const target = event.target as HTMLElement;\n          const targetIsTrigger = context.triggerRef.current?.contains(target);\n          if (targetIsTrigger) event.preventDefault();\n\n          // On Safari if the trigger is inside a container with tabIndex={0}, when clicked\n          // we will get the pointer down outside event on the trigger, but then a subsequent\n          // focus outside event on the container, we ignore any focus outside event when we've\n          // already had a pointer down outside event.\n          if (event.detail.originalEvent.type === 'focusin' && hasPointerDownOutsideRef.current) {\n            event.preventDefault();\n          }\n        }}\n      />\n    );\n  }\n);\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype PopoverContentImplElement = React.ComponentRef<typeof PopperPrimitive.Content>;\ntype FocusScopeProps = React.ComponentPropsWithoutRef<typeof FocusScope>;\ntype DismissableLayerProps = React.ComponentPropsWithoutRef<typeof DismissableLayer>;\ntype PopperContentProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Content>;\ninterface PopoverContentImplProps\n  extends Omit<PopperContentProps, 'onPlaced'>,\n    Omit<DismissableLayerProps, 'onDismiss'> {\n  /**\n   * Whether focus should be trapped within the `Popover`\n   * (default: false)\n   */\n  trapFocus?: FocusScopeProps['trapped'];\n\n  /**\n   * Event handler called when auto-focusing on open.\n   * Can be prevented.\n   */\n  onOpenAutoFocus?: FocusScopeProps['onMountAutoFocus'];\n\n  /**\n   * Event handler called when auto-focusing on close.\n   * Can be prevented.\n   */\n  onCloseAutoFocus?: FocusScopeProps['onUnmountAutoFocus'];\n}\n\nconst PopoverContentImpl = React.forwardRef<PopoverContentImplElement, PopoverContentImplProps>(\n  (props: ScopedProps<PopoverContentImplProps>, forwardedRef) => {\n    const {\n      __scopePopover,\n      trapFocus,\n      onOpenAutoFocus,\n      onCloseAutoFocus,\n      disableOutsidePointerEvents,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      onFocusOutside,\n      onInteractOutside,\n      ...contentProps\n    } = props;\n    const context = usePopoverContext(CONTENT_NAME, __scopePopover);\n    const popperScope = usePopperScope(__scopePopover);\n\n    // Make sure the whole tree has focus guards as our `Popover` may be\n    // the last element in the DOM (because of the `Portal`)\n    useFocusGuards();\n\n    return (\n      <FocusScope\n        asChild\n        loop\n        trapped={trapFocus}\n        onMountAutoFocus={onOpenAutoFocus}\n        onUnmountAutoFocus={onCloseAutoFocus}\n      >\n        <DismissableLayer\n          asChild\n          disableOutsidePointerEvents={disableOutsidePointerEvents}\n          onInteractOutside={onInteractOutside}\n          onEscapeKeyDown={onEscapeKeyDown}\n          onPointerDownOutside={onPointerDownOutside}\n          onFocusOutside={onFocusOutside}\n          onDismiss={() => context.onOpenChange(false)}\n        >\n          <PopperPrimitive.Content\n            data-state={getState(context.open)}\n            role=\"dialog\"\n            id={context.contentId}\n            {...popperScope}\n            {...contentProps}\n            ref={forwardedRef}\n            style={{\n              ...contentProps.style,\n              // re-namespace exposed content custom properties\n              ...{\n                '--radix-popover-content-transform-origin': 'var(--radix-popper-transform-origin)',\n                '--radix-popover-content-available-width': 'var(--radix-popper-available-width)',\n                '--radix-popover-content-available-height': 'var(--radix-popper-available-height)',\n                '--radix-popover-trigger-width': 'var(--radix-popper-anchor-width)',\n                '--radix-popover-trigger-height': 'var(--radix-popper-anchor-height)',\n              },\n            }}\n          />\n        </DismissableLayer>\n      </FocusScope>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverClose\n * -----------------------------------------------------------------------------------------------*/\n\nconst CLOSE_NAME = 'PopoverClose';\n\ntype PopoverCloseElement = React.ComponentRef<typeof Primitive.button>;\ninterface PopoverCloseProps extends PrimitiveButtonProps {}\n\nconst PopoverClose = React.forwardRef<PopoverCloseElement, PopoverCloseProps>(\n  (props: ScopedProps<PopoverCloseProps>, forwardedRef) => {\n    const { __scopePopover, ...closeProps } = props;\n    const context = usePopoverContext(CLOSE_NAME, __scopePopover);\n    return (\n      <Primitive.button\n        type=\"button\"\n        {...closeProps}\n        ref={forwardedRef}\n        onClick={composeEventHandlers(props.onClick, () => context.onOpenChange(false))}\n      />\n    );\n  }\n);\n\nPopoverClose.displayName = CLOSE_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'PopoverArrow';\n\ntype PopoverArrowElement = React.ComponentRef<typeof PopperPrimitive.Arrow>;\ntype PopperArrowProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Arrow>;\ninterface PopoverArrowProps extends PopperArrowProps {}\n\nconst PopoverArrow = React.forwardRef<PopoverArrowElement, PopoverArrowProps>(\n  (props: ScopedProps<PopoverArrowProps>, forwardedRef) => {\n    const { __scopePopover, ...arrowProps } = props;\n    const popperScope = usePopperScope(__scopePopover);\n    return <PopperPrimitive.Arrow {...popperScope} {...arrowProps} ref={forwardedRef} />;\n  }\n);\n\nPopoverArrow.displayName = ARROW_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction getState(open: boolean) {\n  return open ? 'open' : 'closed';\n}\n\nconst Root = Popover;\nconst Anchor = PopoverAnchor;\nconst Trigger = PopoverTrigger;\nconst Portal = PopoverPortal;\nconst Content = PopoverContent;\nconst Close = PopoverClose;\nconst Arrow = PopoverArrow;\n\nexport {\n  createPopoverScope,\n  //\n  Popover,\n  PopoverAnchor,\n  PopoverTrigger,\n  PopoverPortal,\n  PopoverContent,\n  PopoverClose,\n  PopoverArrow,\n  //\n  Root,\n  Anchor,\n  Trigger,\n  Portal,\n  Content,\n  Close,\n  Arrow,\n};\nexport type {\n  PopoverProps,\n  PopoverAnchorProps,\n  PopoverTriggerProps,\n  PopoverPortalProps,\n  PopoverContentProps,\n  PopoverCloseProps,\n  PopoverArrowProps,\n};\n", "import {\n  type CSSProperties,\n  type ComponentProps,\n  Fragment,\n  type ChangeEvent as ReactChangeEvent,\n  type FocusEvent as ReactFocusEvent,\n  type MouseEvent as ReactMouseEvent,\n  type ReactNode,\n  type SyntheticEvent as ReactSyntheticEvent,\n  type UIEvent as ReactUIEvent,\n  forwardRef,\n  memo,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { EMOJI_FONT_FAMILY } from \"../constants\";\nimport { getEmojiData, validateLocale, validateSkinTone } from \"../data/emoji\";\nimport { getEmojiPickerData } from \"../data/emoji-picker\";\nimport { useActiveEmoji, useSkinTone } from \"../hooks\";\nimport {\n  $activeEmoji,\n  $categoriesCount,\n  $categoriesRowsStartIndices,\n  $isEmpty,\n  $isLoading,\n  $rowsCount,\n  $search,\n  $skinTones,\n  type EmojiPickerStore,\n  EmojiPickerStoreProvider,\n  createEmojiPickerStore,\n  sameEmojiPickerRow,\n  useEmojiPickerStore,\n} from \"../store\";\nimport type {\n  EmojiData,\n  EmojiPickerActiveEmojiProps,\n  EmojiPickerCategory,\n  EmojiPickerDataCategory,\n  EmojiPickerEmoji,\n  EmojiPickerEmptyProps,\n  EmojiPickerListCategoryHeaderProps,\n  EmojiPickerListComponents,\n  EmojiPickerListEmojiProps,\n  EmojiPickerListProps,\n  EmojiPickerListRowProps,\n  EmojiPickerLoadingProps,\n  EmojiPickerRootProps,\n  EmojiPickerSearchProps,\n  EmojiPickerSkinToneProps,\n  EmojiPickerSkinToneSelectorProps,\n  EmojiPickerViewportProps,\n  WithAttributes,\n} from \"../types\";\nimport { shallow } from \"../utils/compare\";\nimport { noop } from \"../utils/noop\";\nimport { requestIdleCallback } from \"../utils/request-idle-callback\";\nimport { useCreateStore, useSelector, useSelectorKey } from \"../utils/store\";\nimport { useLayoutEffect } from \"../utils/use-layout-effect\";\nimport { useStableCallback } from \"../utils/use-stable-callback\";\n\nfunction EmojiPickerDataHandler({\n  emojiVersion,\n  emojibaseUrl,\n}: Pick<EmojiPickerRootProps, \"emojiVersion\" | \"emojibaseUrl\">) {\n  const [emojiData, setEmojiData] = useState<EmojiData | undefined>(undefined);\n  const store = useEmojiPickerStore();\n  const locale = useSelectorKey(store, \"locale\");\n  const columns = useSelectorKey(store, \"columns\");\n  const skinTone = useSelectorKey(store, \"skinTone\");\n  const search = useSelectorKey(store, \"search\");\n\n  useEffect(() => {\n    const controller = new AbortController();\n    const signal = controller.signal;\n\n    getEmojiData({ locale, emojiVersion, emojibaseUrl, signal })\n      .then((data) => {\n        setEmojiData(data);\n      })\n      .catch((error) => {\n        if (!signal.aborted) {\n          console.error(error);\n        }\n      });\n\n    return () => {\n      controller.abort();\n    };\n  }, [emojiVersion, emojibaseUrl, locale]);\n\n  useEffect(() => {\n    if (!emojiData) {\n      return;\n    }\n\n    return requestIdleCallback(\n      () => {\n        store\n          .get()\n          .onDataChange(\n            getEmojiPickerData(emojiData, columns, skinTone, search),\n          );\n      },\n      { timeout: 100 },\n    );\n  }, [emojiData, columns, skinTone, search]);\n\n  return null;\n}\n\n/**\n * Surrounds all the emoji picker parts.\n *\n * @example\n * ```tsx\n * <EmojiPicker.Root onEmojiSelect={({ emoji }) => console.log(emoji)}>\n *   <EmojiPicker.Search />\n *   <EmojiPicker.Viewport>\n *     <EmojiPicker.List />\n *   </EmojiPicker.Viewport>\n * </EmojiPicker.Root>\n * ```\n *\n * Options affecting the entire emoji picker are available on this\n * component as props.\n *\n * @example\n * ```tsx\n * <EmojiPicker.Root locale=\"fr\" columns={10} skinTone=\"medium\">\n *   {\\/* ... *\\/}\n * </EmojiPicker.Root>\n * ```\n */\nconst EmojiPickerRoot = forwardRef<HTMLDivElement, EmojiPickerRootProps>(\n  (\n    {\n      locale = \"en\",\n      columns = 9,\n      skinTone = \"none\",\n      onEmojiSelect = noop,\n      emojiVersion,\n      emojibaseUrl,\n      onFocusCapture,\n      onBlurCapture,\n      children,\n      style,\n      ...props\n    },\n    forwardedRef,\n  ) => {\n    const stableOnEmojiSelect = useStableCallback(onEmojiSelect);\n    const store = useCreateStore(() =>\n      createEmojiPickerStore(\n        stableOnEmojiSelect,\n        validateLocale(locale),\n        columns,\n        validateSkinTone(skinTone),\n      ),\n    );\n    const [isFocusedWithin, setFocusedWithin] = useState(false);\n    const ref = useRef<HTMLDivElement>(null!);\n    const callbackRef = useCallback((element: HTMLDivElement | null) => {\n      if (element) {\n        ref.current = element;\n        store.set({ rootRef: ref });\n      }\n    }, []);\n\n    useLayoutEffect(() => {\n      store.set({ locale: validateLocale(locale) });\n    }, [locale]);\n\n    useLayoutEffect(() => {\n      store.set({ columns });\n    }, [columns]);\n\n    useLayoutEffect(() => {\n      store.set({ skinTone: validateSkinTone(skinTone) });\n    }, [skinTone]);\n\n    const handleFocusCapture = useCallback(\n      (event: ReactFocusEvent<HTMLDivElement>) => {\n        onFocusCapture?.(event);\n\n        const { searchRef, viewportRef } = store.get();\n\n        const isSearch =\n          event.target === searchRef?.current ||\n          event.target.hasAttribute(\"frimousse-search\");\n\n        const isViewport =\n          event.target === viewportRef?.current ||\n          event.target.hasAttribute(\"frimousse-viewport\");\n\n        if (!event.isDefaultPrevented()) {\n          setFocusedWithin(isSearch || isViewport);\n\n          if (!event.isDefaultPrevented()) {\n            setFocusedWithin(isSearch || isViewport);\n\n            if (isViewport) {\n              store.get().onActiveEmojiChange(\"keyboard\", 0, 0);\n            } else if (isSearch && store.get().search === \"\") {\n              store.set({ interaction: \"none\" });\n            }\n          }\n        }\n      },\n      [onFocusCapture],\n    );\n\n    const handleBlurCapture = useCallback(\n      (event: ReactFocusEvent<HTMLDivElement>) => {\n        onBlurCapture?.(event);\n\n        if (\n          !event.isDefaultPrevented() &&\n          !event.currentTarget.contains(event.relatedTarget)\n        ) {\n          setFocusedWithin(false);\n        }\n      },\n      [onBlurCapture],\n    );\n\n    useLayoutEffect(() => {\n      if (!isFocusedWithin) {\n        store.get().onActiveEmojiReset();\n      }\n    }, [isFocusedWithin]);\n\n    useImperativeHandle(forwardedRef, () => ref.current);\n\n    useEffect(() => {\n      if (!isFocusedWithin) {\n        return;\n      }\n\n      function handleKeyDown(event: KeyboardEvent) {\n        if (\n          event.defaultPrevented ||\n          (!event.key.startsWith(\"Arrow\") && event.key !== \"Enter\")\n        ) {\n          return;\n        }\n\n        const {\n          data,\n          onEmojiSelect,\n          onActiveEmojiChange,\n          interaction,\n          activeColumnIndex,\n          activeRowIndex,\n        } = store.get();\n\n        // Select the active emoji with enter if it exists\n        if (event.key === \"Enter\") {\n          const activeEmoji = $activeEmoji(store.get());\n\n          if (activeEmoji) {\n            event.preventDefault();\n\n            onEmojiSelect(activeEmoji);\n          }\n        }\n\n        // Move the active emoji with arrow keys\n        if (event.key.startsWith(\"Arrow\")) {\n          let columnIndex = activeColumnIndex;\n          let rowIndex = activeRowIndex;\n\n          event.preventDefault();\n\n          if (interaction !== \"none\") {\n            if (data?.rows && data.rows.length > 0) {\n              switch (event.key) {\n                case \"ArrowLeft\": {\n                  if (columnIndex === 0) {\n                    const previousRowIndex = rowIndex - 1;\n                    const previousRow = data.rows[previousRowIndex];\n\n                    // If first column, move to last column of previous row (if available)\n                    if (previousRow) {\n                      rowIndex = previousRowIndex;\n                      columnIndex = previousRow.emojis.length - 1;\n                    }\n                  } else {\n                    // Otherwise, move to previous column\n                    columnIndex -= 1;\n                  }\n\n                  break;\n                }\n\n                case \"ArrowRight\": {\n                  if (columnIndex === data.rows[rowIndex]!.emojis.length - 1) {\n                    const nextRowIndex = rowIndex + 1;\n                    const nextRow = data.rows[nextRowIndex];\n\n                    // If last column, move to first column of next row (if available)\n                    if (nextRow) {\n                      rowIndex = nextRowIndex;\n                      columnIndex = 0;\n                    }\n                  } else {\n                    // Otherwise, move to next column\n                    columnIndex += 1;\n                  }\n\n                  break;\n                }\n\n                case \"ArrowUp\": {\n                  const previousRow = data.rows[rowIndex - 1];\n\n                  // If not first row, move to previous row\n                  if (previousRow) {\n                    rowIndex -= 1;\n\n                    // If previous row doesn't have the same column, move to last column of previous row\n                    if (!previousRow.emojis[columnIndex]) {\n                      columnIndex = previousRow.emojis.length - 1;\n                    }\n                  }\n\n                  break;\n                }\n\n                case \"ArrowDown\": {\n                  const nextRow = data.rows[rowIndex + 1];\n\n                  // If not last row, move to next row\n                  if (nextRow) {\n                    rowIndex += 1;\n\n                    // If next row doesn't have the same column, move to last column of next row\n                    if (!nextRow.emojis[columnIndex]) {\n                      columnIndex = nextRow.emojis.length - 1;\n                    }\n                  }\n\n                  break;\n                }\n              }\n            }\n\n            onActiveEmojiChange(\"keyboard\", columnIndex, rowIndex);\n          } else {\n            onActiveEmojiChange(\"keyboard\", 0, 0);\n          }\n        }\n      }\n\n      document.addEventListener(\"keydown\", handleKeyDown);\n\n      return () => {\n        document.removeEventListener(\"keydown\", handleKeyDown);\n      };\n    }, [isFocusedWithin]);\n\n    useLayoutEffect(() => {\n      let previousViewportWidth: EmojiPickerStore[\"viewportWidth\"] = null;\n      let previousViewportHeight: EmojiPickerStore[\"viewportHeight\"] = null;\n      let previousRowHeight: EmojiPickerStore[\"rowHeight\"] = null;\n      let previousCategoryHeaderHeight: EmojiPickerStore[\"categoryHeaderHeight\"] =\n        null;\n\n      const unsubscribe = store.subscribe((state) => {\n        /* v8 ignore next 3 */\n        if (!ref.current) {\n          return;\n        }\n\n        if (previousViewportWidth !== state.viewportWidth) {\n          previousViewportWidth = state.viewportWidth;\n\n          ref.current.style.setProperty(\n            \"--frimousse-viewport-width\",\n            `${state.viewportWidth}px`,\n          );\n        }\n\n        if (previousViewportHeight !== state.viewportHeight) {\n          previousViewportHeight = state.viewportHeight;\n\n          ref.current.style.setProperty(\n            \"--frimousse-viewport-height\",\n            `${state.viewportHeight}px`,\n          );\n        }\n\n        if (previousRowHeight !== state.rowHeight) {\n          previousRowHeight = state.rowHeight;\n\n          ref.current.style.setProperty(\n            \"--frimousse-row-height\",\n            `${state.rowHeight}px`,\n          );\n        }\n\n        if (previousCategoryHeaderHeight !== state.categoryHeaderHeight) {\n          previousCategoryHeaderHeight = state.categoryHeaderHeight;\n\n          ref.current.style.setProperty(\n            \"--frimousse-category-header-height\",\n            `${state.categoryHeaderHeight}px`,\n          );\n        }\n      });\n\n      const { viewportWidth, viewportHeight, rowHeight, categoryHeaderHeight } =\n        store.get();\n\n      if (viewportWidth) {\n        ref.current.style.setProperty(\n          \"--frimousse-viewport-width\",\n          `${viewportWidth}px`,\n        );\n      }\n\n      if (viewportHeight) {\n        ref.current.style.setProperty(\n          \"--frimousse-viewport-height\",\n          `${viewportHeight}px`,\n        );\n      }\n\n      if (rowHeight) {\n        ref.current.style.setProperty(\n          \"--frimousse-row-height\",\n          `${rowHeight}px`,\n        );\n      }\n\n      if (categoryHeaderHeight) {\n        ref.current.style.setProperty(\n          \"--frimousse-category-header-height\",\n          `${categoryHeaderHeight}px`,\n        );\n      }\n\n      return unsubscribe;\n    }, []);\n\n    return (\n      <div\n        data-focused={isFocusedWithin ? \"\" : undefined}\n        frimousse-root=\"\"\n        onBlurCapture={handleBlurCapture}\n        onFocusCapture={handleFocusCapture}\n        {...props}\n        ref={callbackRef}\n        style={\n          {\n            \"--frimousse-emoji-font\": EMOJI_FONT_FAMILY,\n            ...style,\n          } as CSSProperties\n        }\n      >\n        <EmojiPickerStoreProvider store={store}>\n          <EmojiPickerDataHandler\n            emojiVersion={emojiVersion}\n            emojibaseUrl={emojibaseUrl}\n          />\n          {children}\n        </EmojiPickerStoreProvider>\n      </div>\n    );\n  },\n);\n\n/**\n * A search input to filter the list of emojis.\n *\n * @example\n * ```tsx\n * <EmojiPicker.Root>\n *   <EmojiPicker.Search />\n *   <EmojiPicker.Viewport>\n *     <EmojiPicker.List />\n *   </EmojiPicker.Viewport>\n * </EmojiPicker.Root>\n * ```\n *\n * It can be controlled or uncontrolled.\n *\n * @example\n * ```tsx\n * const [search, setSearch] = useState(\"\");\n *\n * return (\n *   <EmojiPicker.Root>\n *     <EmojiPicker.Search\n *       value={search}\n *       onChange={(event) => setSearch(event.target.value)}\n *     />\n *     {\\/* ... *\\/}\n *   </EmojiPicker.Root>\n * );\n * ```\n */\nconst EmojiPickerSearch = forwardRef<HTMLInputElement, EmojiPickerSearchProps>(\n  ({ value, defaultValue, onChange, ...props }, forwardedRef) => {\n    const store = useEmojiPickerStore();\n    const ref = useRef<HTMLInputElement>(null!);\n    const callbackRef = useCallback((element: HTMLInputElement | null) => {\n      if (element) {\n        ref.current = element;\n        store.set({ searchRef: ref });\n      }\n    }, []);\n    const isControlled = typeof value === \"string\";\n    const wasControlled = useRef(isControlled);\n\n    useEffect(() => {\n      if (\n        process.env.NODE_ENV !== \"production\" &&\n        wasControlled.current !== isControlled\n      ) {\n        console.warn(\n          `EmojiPicker.Search is changing from ${\n            wasControlled ? \"controlled\" : \"uncontrolled\"\n          } to ${isControlled ? \"controlled\" : \"uncontrolled\"}.`,\n        );\n      }\n\n      wasControlled.current = isControlled;\n    }, [isControlled]);\n\n    // Initialize search with a controlled or uncontrolled value\n    useLayoutEffect(() => {\n      store.set({\n        search:\n          typeof value === \"string\"\n            ? value\n            : typeof defaultValue === \"string\"\n              ? defaultValue\n              : \"\",\n      });\n    }, []);\n\n    // Handle controlled value changes\n    useLayoutEffect(() => {\n      if (typeof value === \"string\") {\n        store.get().onSearchChange(value);\n      }\n    }, [value]);\n\n    const handleChange = useCallback(\n      (event: ReactChangeEvent<HTMLInputElement>) => {\n        onChange?.(event);\n\n        if (!event.isDefaultPrevented()) {\n          store.get().onSearchChange(event.target.value);\n        }\n      },\n      [onChange],\n    );\n\n    useImperativeHandle(forwardedRef, () => ref.current);\n\n    return (\n      <input\n        autoCapitalize=\"off\"\n        autoComplete=\"off\"\n        autoCorrect=\"off\"\n        enterKeyHint=\"done\"\n        frimousse-search=\"\"\n        placeholder=\"Search\"\n        spellCheck={false}\n        type=\"search\"\n        {...props}\n        defaultValue={defaultValue}\n        onChange={handleChange}\n        ref={callbackRef}\n        value={value}\n      />\n    );\n  },\n);\n\nconst ActiveEmojiAnnouncer = memo(() => {\n  const activeEmoji = useActiveEmoji();\n\n  if (!activeEmoji) {\n    return null;\n  }\n\n  return (\n    <div\n      aria-live=\"polite\"\n      style={{\n        border: 0,\n        clip: \"rect(0, 0, 0, 0)\",\n        height: 1,\n        margin: -1,\n        overflow: \"hidden\",\n        padding: 0,\n        position: \"absolute\",\n        whiteSpace: \"nowrap\",\n        width: 1,\n        wordWrap: \"normal\",\n      }}\n    >\n      {activeEmoji.label}\n    </div>\n  );\n});\n\n/**\n * The scrolling container of the emoji picker.\n *\n * @example\n * ```tsx\n * <EmojiPicker.Root>\n *   <EmojiPicker.Search />\n *   <EmojiPicker.Viewport>\n *     <EmojiPicker.Loading>Loading</EmojiPicker.Loading>\n *     <EmojiPicker.Empty>No emoji found.</EmojiPicker.Empty>\n *     <EmojiPicker.List />\n *   </EmojiPicker.Viewport>\n * </EmojiPicker.Root>\n * ```\n */\nconst EmojiPickerViewport = forwardRef<\n  HTMLDivElement,\n  EmojiPickerViewportProps\n>(({ children, onScroll, onKeyDown, style, ...props }, forwardedRef) => {\n  const store = useEmojiPickerStore();\n  const ref = useRef<HTMLDivElement>(null!);\n  const callbackRef = useCallback((element: HTMLDivElement | null) => {\n    if (element) {\n      ref.current = element;\n      store.set({ viewportRef: ref });\n    }\n  }, []);\n  const rowsCount = useSelector(store, $rowsCount);\n  const categoriesCount = useSelector(store, $categoriesCount);\n\n  const handleScroll = useCallback(\n    (event: ReactUIEvent<HTMLDivElement>) => {\n      onScroll?.(event);\n\n      store.get().onViewportScroll(event.currentTarget.scrollTop);\n    },\n    [onScroll],\n  );\n\n  useLayoutEffect(() => {\n    /* v8 ignore next 3 */\n    if (!ref.current) {\n      return;\n    }\n\n    const resizeObserver = new ResizeObserver(([entry]) => {\n      const width = entry?.borderBoxSize[0]?.inlineSize ?? 0;\n      const height = entry?.borderBoxSize[0]?.blockSize ?? 0;\n\n      const { onViewportSizeChange, viewportHeight, viewportWidth } =\n        store.get();\n\n      if (viewportHeight !== height || viewportWidth !== width) {\n        onViewportSizeChange(width, height);\n      }\n    });\n\n    resizeObserver.observe(ref.current);\n\n    store\n      .get()\n      .onViewportSizeChange(ref.current.offsetWidth, ref.current.clientHeight);\n\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, []);\n\n  useImperativeHandle(forwardedRef, () => ref.current);\n\n  return (\n    <div\n      frimousse-viewport=\"\"\n      {...props}\n      onScroll={handleScroll}\n      ref={callbackRef}\n      style={{\n        position: \"relative\",\n        boxSizing: \"border-box\",\n        contain: \"layout paint\",\n        containIntrinsicSize:\n          typeof rowsCount === \"number\" && typeof categoriesCount === \"number\"\n            ? `var(--frimousse-viewport-width, auto) calc(${rowsCount} * var(--frimousse-row-height) + ${categoriesCount} * var(--frimousse-category-header-height))`\n            : undefined,\n        overflowY: \"auto\",\n        overscrollBehavior: \"contain\",\n        scrollbarGutter: \"stable\",\n        willChange: \"scroll-position\",\n        ...style,\n      }}\n    >\n      <ActiveEmojiAnnouncer />\n      {children}\n    </div>\n  );\n});\n\nfunction listEmojiProps(\n  emoji: EmojiPickerEmoji,\n  columnIndex: number,\n  isActive: boolean,\n): WithAttributes<EmojiPickerListEmojiProps> {\n  return {\n    emoji: { ...emoji, isActive },\n    role: \"gridcell\",\n    \"aria-colindex\": columnIndex,\n    \"aria-selected\": isActive || undefined,\n    \"aria-label\": emoji.label,\n    \"data-active\": isActive ? \"\" : undefined,\n    \"frimousse-emoji\": \"\",\n    style: {\n      fontFamily: \"var(--frimousse-emoji-font)\",\n    },\n    tabIndex: -1,\n  };\n}\n\nfunction listRowProps(\n  rowIndex: number,\n  sizer = false,\n): WithAttributes<EmojiPickerListRowProps> {\n  return {\n    role: !sizer ? \"row\" : undefined,\n    \"aria-rowindex\": !sizer ? rowIndex : undefined,\n    \"frimousse-row\": \"\",\n    style: {\n      contain: !sizer ? \"content\" : undefined,\n      height: !sizer ? \"var(--frimousse-row-height)\" : undefined,\n      display: \"flex\",\n    },\n  };\n}\n\nfunction listCategoryProps(\n  categoryIndex: number,\n  category?: EmojiPickerDataCategory,\n): WithAttributes<ComponentProps<\"div\">> {\n  return {\n    \"frimousse-category\": \"\",\n    style: {\n      contain: \"content\",\n      top: category\n        ? `calc(${categoryIndex} * var(--frimousse-category-header-height) + ${category.startRowIndex} * var(--frimousse-row-height))`\n        : undefined,\n      height: category\n        ? `calc(var(--frimousse-category-header-height) + ${category.rowsCount} * var(--frimousse-row-height))`\n        : undefined,\n      width: \"100%\",\n      pointerEvents: \"none\",\n      position: \"absolute\",\n    },\n  };\n}\n\nfunction listCategoryHeaderProps(\n  category: EmojiPickerCategory,\n  sizer = false,\n): WithAttributes<EmojiPickerListCategoryHeaderProps> {\n  return {\n    category,\n    \"frimousse-category-header\": \"\",\n    style: {\n      contain: !sizer ? \"layout paint\" : undefined,\n      height: !sizer ? \"var(--frimousse-category-header-height)\" : undefined,\n      pointerEvents: \"auto\",\n      position: \"sticky\",\n      top: 0,\n    },\n  };\n}\n\nfunction listSizerProps(\n  rowsCount: number,\n  categoriesCount: number,\n  viewportStartRowIndex: number,\n  previousHeadersCount: number,\n): WithAttributes<ComponentProps<\"div\">> {\n  return {\n    \"frimousse-list-sizer\": \"\",\n    style: {\n      position: \"relative\",\n      boxSizing: \"border-box\",\n      height: `calc(${rowsCount} * var(--frimousse-row-height) + ${categoriesCount} * var(--frimousse-category-header-height))`,\n      paddingTop: `calc(${viewportStartRowIndex} * var(--frimousse-row-height) + ${previousHeadersCount} * var(--frimousse-category-header-height))`,\n    },\n  };\n}\n\nfunction listProps(\n  columns: number,\n  rowsCount: number,\n  style: CSSProperties | undefined,\n): WithAttributes<EmojiPickerListProps> {\n  return {\n    \"aria-colcount\": columns,\n    \"aria-rowcount\": rowsCount,\n    \"frimousse-list\": \"\",\n    style: {\n      \"--frimousse-list-columns\": columns,\n      ...style,\n    } as CSSProperties,\n    role: \"grid\",\n  };\n}\n\nfunction preventDefault(event: ReactSyntheticEvent) {\n  event.preventDefault();\n}\n\nconst EmojiPickerListEmoji = memo(\n  ({\n    Emoji,\n    emoji,\n    columnIndex,\n    rowIndex,\n  }: {\n    emoji: EmojiPickerEmoji;\n    columnIndex: number;\n    rowIndex: number;\n  } & Pick<EmojiPickerListComponents, \"Emoji\">) => {\n    const store = useEmojiPickerStore();\n    const isActive = useSelector(\n      store,\n      (state) => $activeEmoji(state)?.emoji === emoji.emoji,\n    );\n\n    const handleSelect = useCallback(() => {\n      store.get().onEmojiSelect(emoji);\n    }, [emoji]);\n\n    const handlePointerEnter = useCallback(() => {\n      store.get().onActiveEmojiChange(\"pointer\", columnIndex, rowIndex);\n    }, [columnIndex, rowIndex]);\n\n    const handlePointerLeave = useCallback(() => {\n      store.get().onActiveEmojiReset();\n    }, []);\n\n    return (\n      <Emoji\n        {...listEmojiProps(emoji, columnIndex, isActive)}\n        onClick={handleSelect}\n        onPointerDown={preventDefault}\n        onPointerEnter={handlePointerEnter}\n        onPointerLeave={handlePointerLeave}\n      />\n    );\n  },\n);\n\nconst EmojiPickerListRow = memo(\n  ({\n    Row,\n    Emoji,\n    rowIndex,\n  }: { rowIndex: number } & Pick<\n    EmojiPickerListComponents,\n    \"Emoji\" | \"Row\"\n  >) => {\n    const store = useEmojiPickerStore();\n    const row = useSelector(\n      store,\n      (state) => state.data?.rows[rowIndex],\n      sameEmojiPickerRow,\n    );\n\n    /* v8 ignore next 3 */\n    if (!row) {\n      return null;\n    }\n\n    return (\n      <Row {...listRowProps(rowIndex)}>\n        {row.emojis.map((emoji, columnIndex) => (\n          <EmojiPickerListEmoji\n            Emoji={Emoji}\n            columnIndex={columnIndex}\n            emoji={emoji}\n            key={emoji.label}\n            rowIndex={rowIndex}\n          />\n        ))}\n      </Row>\n    );\n  },\n);\n\nconst EmojiPickerListCategory = memo(\n  ({\n    CategoryHeader,\n    categoryIndex,\n  }: { categoryIndex: number } & Pick<\n    EmojiPickerListComponents,\n    \"CategoryHeader\"\n  >) => {\n    const store = useEmojiPickerStore();\n    const category = useSelector(\n      store,\n      (state) => state.data?.categories[categoryIndex],\n      shallow,\n    );\n\n    /* v8 ignore next 3 */\n    if (!category) {\n      return null;\n    }\n\n    return (\n      <div {...listCategoryProps(categoryIndex, category)}>\n        <CategoryHeader\n          {...listCategoryHeaderProps({ label: category.label })}\n        />\n      </div>\n    );\n  },\n);\n\nconst EmojiPickerListSizers = memo(\n  ({\n    CategoryHeader,\n    Row,\n    Emoji,\n  }: Pick<EmojiPickerListComponents, \"CategoryHeader\" | \"Row\" | \"Emoji\">) => {\n    const ref = useRef<HTMLDivElement>(null!);\n    const store = useEmojiPickerStore();\n    const columns = useSelectorKey(store, \"columns\");\n    const emojis = useMemo(\n      () =>\n        Array<EmojiPickerEmoji>(columns).fill({\n          emoji: \"\",\n          label: \"\",\n        }),\n      [columns],\n    );\n    const category: EmojiPickerCategory = useMemo(\n      () => ({\n        label: \"Category\",\n      }),\n      [],\n    );\n    const rowRef = useRef<HTMLDivElement>(null!);\n    const categoryHeaderRef = useRef<HTMLDivElement>(null!);\n\n    useLayoutEffect(() => {\n      const list = ref.current?.parentElement?.parentElement;\n\n      /* v8 ignore next 3 */\n      if (!list || !rowRef.current || !categoryHeaderRef.current) {\n        return;\n      }\n\n      const resizeObserver = new ResizeObserver((entries) => {\n        for (const entry of entries) {\n          const height = entry.contentRect.height;\n\n          const {\n            onRowHeightChange,\n            onCategoryHeaderHeightChange,\n            rowHeight,\n            categoryHeaderHeight,\n          } = store.get();\n\n          if (entry.target === rowRef.current && rowHeight !== height) {\n            onRowHeightChange(height);\n          }\n\n          if (\n            entry.target === categoryHeaderRef.current &&\n            categoryHeaderHeight !== height\n          ) {\n            onCategoryHeaderHeightChange(height);\n          }\n        }\n      });\n\n      resizeObserver.observe(list);\n      resizeObserver.observe(rowRef.current);\n      resizeObserver.observe(categoryHeaderRef.current);\n\n      const { onRowHeightChange, onCategoryHeaderHeightChange } = store.get();\n\n      onRowHeightChange(rowRef.current.clientHeight);\n      onCategoryHeaderHeightChange(categoryHeaderRef.current.clientHeight);\n\n      return () => {\n        resizeObserver.disconnect();\n      };\n    }, []);\n\n    return (\n      <div\n        aria-hidden\n        ref={ref}\n        style={{\n          height: 0,\n          visibility: \"hidden\",\n        }}\n      >\n        <div frimousse-row-sizer=\"\" ref={rowRef}>\n          <Row {...listRowProps(-1, true)}>\n            {emojis.map((emoji, index) => (\n              <Emoji key={index} {...listEmojiProps(emoji, index, false)} />\n            ))}\n          </Row>\n        </div>\n        <div {...listCategoryProps(-1)}>\n          <div frimousse-category-header-sizer=\"\" ref={categoryHeaderRef}>\n            <CategoryHeader {...listCategoryHeaderProps(category, true)} />\n          </div>\n        </div>\n      </div>\n    );\n  },\n);\n\nfunction DefaultEmojiPickerListCategoryHeader({\n  category,\n  ...props\n}: EmojiPickerListCategoryHeaderProps) {\n  return <div {...props}>{category.label}</div>;\n}\n\nfunction DefaultEmojiPickerListEmoji({\n  emoji,\n  ...props\n}: EmojiPickerListEmojiProps) {\n  return (\n    <button type=\"button\" {...props}>\n      {emoji.emoji}\n    </button>\n  );\n}\n\nfunction DefaultEmojiPickerListRow({ ...props }: EmojiPickerListRowProps) {\n  return <div {...props} />;\n}\n\n/**\n * The list of emojis.\n *\n * @example\n * ```tsx\n * <EmojiPicker.Root>\n *   <EmojiPicker.Search />\n *   <EmojiPicker.Viewport>\n *     <EmojiPicker.List />\n *   </EmojiPicker.Viewport>\n * </EmojiPicker.Root>\n * ```\n *\n * Inner components within the list can be customized via the `components` prop.\n *\n * @example\n * ```tsx\n * <EmojiPicker.List\n *   components={{\n *     CategoryHeader: ({ category, ...props }) => (\n *       <div {...props}>{category.label}</div>\n *     ),\n *     Emoji: ({ emoji, ...props }) => (\n *       <button {...props}>\n *         {emoji.emoji}\n *       </button>\n *     ),\n *     Row: ({ children, ...props }) => <div {...props}>{children}</div>,\n *   }}\n * />\n * ```\n */\nconst EmojiPickerList = forwardRef<HTMLDivElement, EmojiPickerListProps>(\n  ({ style, components, ...props }, forwardedRef) => {\n    const store = useEmojiPickerStore();\n    const ref = useRef<HTMLDivElement>(null!);\n    const callbackRef = useCallback((element: HTMLDivElement | null) => {\n      if (element) {\n        ref.current = element;\n        store.set({ listRef: ref });\n      }\n    }, []);\n    const CategoryHeader =\n      components?.CategoryHeader ?? DefaultEmojiPickerListCategoryHeader;\n    const Emoji = components?.Emoji ?? DefaultEmojiPickerListEmoji;\n    const Row = components?.Row ?? DefaultEmojiPickerListRow;\n    const columns = useSelectorKey(store, \"columns\");\n    const viewportStartRowIndex = useSelectorKey(\n      store,\n      \"viewportStartRowIndex\",\n    );\n    const viewportEndRowIndex = useSelectorKey(store, \"viewportEndRowIndex\");\n    const rowsCount = useSelector(store, $rowsCount);\n    const categoriesRowsStartIndices = useSelector(\n      store,\n      $categoriesRowsStartIndices,\n      shallow,\n    );\n    const previousHeadersCount = useMemo(() => {\n      return (\n        categoriesRowsStartIndices?.filter(\n          (index) => index < viewportStartRowIndex,\n        ).length ?? 0\n      );\n    }, [categoriesRowsStartIndices, viewportStartRowIndex]);\n    const categoriesCount = categoriesRowsStartIndices?.length ?? 0;\n\n    useImperativeHandle(forwardedRef, () => ref.current);\n\n    if (!rowsCount || !categoriesRowsStartIndices || categoriesCount === 0) {\n      return (\n        <div {...listProps(columns, 0, style)} {...props}>\n          <div {...listSizerProps(0, 0, 0, 0)}>\n            <EmojiPickerListSizers\n              CategoryHeader={CategoryHeader}\n              Emoji={Emoji}\n              Row={Row}\n            />\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div\n        {...listProps(columns, rowsCount, style)}\n        {...props}\n        ref={callbackRef}\n      >\n        <div\n          {...listSizerProps(\n            rowsCount,\n            categoriesCount,\n            viewportStartRowIndex,\n            previousHeadersCount,\n          )}\n        >\n          <EmojiPickerListSizers\n            CategoryHeader={CategoryHeader}\n            Emoji={Emoji}\n            Row={Row}\n          />\n          {Array.from(\n            { length: viewportEndRowIndex - viewportStartRowIndex + 1 },\n            (_, index) => {\n              const rowIndex = viewportStartRowIndex + index;\n              const categoryIndex =\n                categoriesRowsStartIndices.indexOf(rowIndex);\n\n              return (\n                <Fragment key={rowIndex}>\n                  {categoryIndex >= 0 && (\n                    <div\n                      style={{\n                        height: \"var(--frimousse-category-header-height)\",\n                      }}\n                    />\n                  )}\n                  <EmojiPickerListRow\n                    Emoji={Emoji}\n                    Row={Row}\n                    rowIndex={rowIndex}\n                  />\n                </Fragment>\n              );\n            },\n          )}\n          {Array.from({ length: categoriesCount }, (_, index) => (\n            <EmojiPickerListCategory\n              CategoryHeader={CategoryHeader}\n              categoryIndex={index}\n              key={index}\n            />\n          ))}\n        </div>\n      </div>\n    );\n  },\n);\n\n/**\n * A button to change the current skin tone by cycling through the\n * available skin tones.\n *\n * @example\n * ```tsx\n * <EmojiPicker.SkinToneSelector />\n * ```\n *\n * The emoji used as visual can be customized (by default, ).\n *\n * @example\n * ```tsx\n * <EmojiPicker.SkinToneSelector emoji=\"\" />\n * ```\n *\n * @see\n * If you want to build a custom skin tone selector, you can use the\n * {@link EmojiPickerSkinTone|`<EmojiPicker.SkinTone />`} component or\n * {@link useSkinTone|`useSkinTone`} hook.\n */\nconst EmojiPickerSkinToneSelector = forwardRef<\n  HTMLButtonElement,\n  EmojiPickerSkinToneSelectorProps\n>(\n  (\n    { emoji, onClick, \"aria-label\": ariaLabel = \"Change skin tone\", ...props },\n    forwardedRef,\n  ) => {\n    const store = useEmojiPickerStore();\n    const skinTones = useSelector(store, $skinTones, shallow);\n    const [skinTone, setSkinTone, skinToneVariations] = useSkinTone(emoji);\n\n    const skinToneVariationIndex = useMemo(\n      () =>\n        Math.max(\n          0,\n          skinToneVariations.findIndex(\n            (variation) => variation.skinTone === skinTone,\n          ),\n        ),\n      [skinTone, skinToneVariations],\n    );\n\n    const skinToneVariation = skinToneVariations[skinToneVariationIndex]!;\n    const nextSkinToneVariation =\n      skinToneVariations[\n        (skinToneVariationIndex + 1) % skinToneVariations.length\n      ]!;\n    const nextSkinTone = nextSkinToneVariation.skinTone;\n\n    const skinToneLabel =\n      skinTone === \"none\" ? undefined : skinTones?.[skinTone];\n    const nextSkinToneLabel =\n      nextSkinTone === \"none\" ? undefined : skinTones?.[nextSkinTone];\n\n    const handleClick = useCallback(\n      (event: ReactMouseEvent<HTMLButtonElement>) => {\n        onClick?.(event);\n\n        if (!event.isDefaultPrevented()) {\n          setSkinTone(nextSkinTone);\n        }\n      },\n      [onClick, setSkinTone, nextSkinTone],\n    );\n\n    return (\n      <button\n        type=\"button\"\n        {...props}\n        aria-label={\n          ariaLabel + (nextSkinToneLabel ? ` (${nextSkinToneLabel})` : \"\")\n        }\n        aria-live=\"polite\"\n        aria-valuetext={skinToneLabel}\n        frimousse-skin-tone-selector=\"\"\n        onClick={handleClick}\n        ref={forwardedRef}\n      >\n        {skinToneVariation.emoji}\n      </button>\n    );\n  },\n);\n\n/**\n * Only renders when the emoji data is loading.\n *\n * @example\n * ```tsx\n * <EmojiPicker.Root>\n *   <EmojiPicker.Search />\n *   <EmojiPicker.Viewport>\n *     <EmojiPicker.Loading>Loading</EmojiPicker.Loading>\n *     <EmojiPicker.List />\n *   </EmojiPicker.Viewport>\n * </EmojiPicker.Root>\n * ```\n */\nfunction EmojiPickerLoading({\n  children,\n  ...props\n}: EmojiPickerLoadingProps): ReactNode {\n  const store = useEmojiPickerStore();\n  const isLoading = useSelector(store, $isLoading);\n\n  if (!isLoading) {\n    return null;\n  }\n\n  return (\n    <span frimousse-loading=\"\" {...props}>\n      {children}\n    </span>\n  );\n}\n\nfunction EmojiPickerEmptyWithSearch({\n  children,\n}: { children: (props: { search: string }) => ReactNode }) {\n  const store = useEmojiPickerStore();\n  const search = useSelector(store, $search);\n\n  return children({ search });\n}\n\n/**\n * Only renders when no emoji is found for the current search. The content is\n * rendered without any surrounding DOM element.\n *\n * @example\n * ```tsx\n * <EmojiPicker.Root>\n *   <EmojiPicker.Search />\n *   <EmojiPicker.Viewport>\n *     <EmojiPicker.Empty>No emoji found.</EmojiPicker.Empty>\n *     <EmojiPicker.List />\n *   </EmojiPicker.Viewport>\n * </EmojiPicker.Root>\n * ```\n *\n * It can also expose the current search via a render callback to build\n * a more detailed empty state.\n *\n *  @example\n * ```tsx\n * <EmojiPicker.Empty>\n *   {({ search }) => <>No emoji found for \"{search}\"</>}\n * </EmojiPicker.Empty>\n * ```\n */\nfunction EmojiPickerEmpty({\n  children,\n  ...props\n}: EmojiPickerEmptyProps): ReactNode {\n  const store = useEmojiPickerStore();\n  const isEmpty = useSelector(store, $isEmpty);\n\n  if (!isEmpty) {\n    return null;\n  }\n\n  return (\n    <span frimousse-empty=\"\" {...props}>\n      {typeof children === \"function\" ? (\n        <EmojiPickerEmptyWithSearch>{children}</EmojiPickerEmptyWithSearch>\n      ) : (\n        children\n      )}\n    </span>\n  );\n}\n\n/**\n * Exposes the currently active emoji (either hovered or selected\n * via keyboard navigation) via a render callback.\n *\n * @example\n * ```tsx\n * <EmojiPicker.ActiveEmoji>\n *   {({ emoji }) => <span>{emoji}</span>}\n * </EmojiPicker.ActiveEmoji>\n * ```\n *\n * It can be used to build a preview area next to the list.\n *\n * @example\n * ```tsx\n * <EmojiPicker.ActiveEmoji>\n *   {({ emoji }) => (\n *     <div>\n *       {emoji ? (\n *         <span>{emoji.emoji} {emoji.label}</span>\n *       ) : (\n *         <span>Select an emoji</span>\n *       )}\n *     </div>\n *   )}\n * </EmojiPicker.ActiveEmoji>\n * ```\n *\n * @see\n * If you prefer to use a hook rather than a component,\n * {@link useActiveEmoji} is also available.\n */\nfunction EmojiPickerActiveEmoji({\n  children,\n}: EmojiPickerActiveEmojiProps): ReactNode {\n  const activeEmoji = useActiveEmoji();\n\n  return children({ emoji: activeEmoji });\n}\n\n/**\n * Exposes the current skin tone and a function to change it via a render\n * callback.\n *\n * @example\n * ```tsx\n * <EmojiPicker.SkinTone>\n *   {({ skinTone, setSkinTone }) => (\n *     <div>\n *       <span>{skinTone}</span>\n *       <button onClick={() => setSkinTone(\"none\")}>Reset skin tone</button>\n *     </div>\n *   )}\n * </EmojiPicker.SkinTone>\n * ```\n *\n * It can be used to build a custom skin tone selector: pass an emoji\n * you want to use as visual (by default, ) and it will return its skin tone\n * variations.\n *\n * @example\n * ```tsx\n * const [skinTone, setSkinTone, skinToneVariations] = useSkinTone(\"\");\n *\n * // () () () () () ()\n * <EmojiPicker.SkinTone emoji=\"\">\n *   {({ skinTone, setSkinTone, skinToneVariations }) => (\n *     skinToneVariations.map(({ skinTone, emoji }) => (\n *       <button key={skinTone} onClick={() => setSkinTone(skinTone)}>\n *         {emoji}\n *       </button>\n *     ))\n *   )}\n * </EmojiPicker.SkinTone>\n * ```\n *\n * @see\n * If you prefer to use a hook rather than a component,\n * {@link useSkinTone} is also available.\n *\n * @see\n * An already-built skin tone selector is also available,\n * {@link EmojiPicker.SkinToneSelector|`<EmojiPicker.SkinToneSelector />`}.\n */\nfunction EmojiPickerSkinTone({\n  children,\n  emoji,\n}: EmojiPickerSkinToneProps): ReactNode {\n  const [skinTone, setSkinTone, skinToneVariations] = useSkinTone(emoji);\n\n  return children({ skinTone, setSkinTone, skinToneVariations });\n}\n\nEmojiPickerRoot.displayName = \"EmojiPicker.Root\";\nEmojiPickerSearch.displayName = \"EmojiPicker.Search\";\nEmojiPickerViewport.displayName = \"EmojiPicker.Viewport\";\nEmojiPickerList.displayName = \"EmojiPicker.List\";\nEmojiPickerLoading.displayName = \"EmojiPicker.Loading\";\nEmojiPickerEmpty.displayName = \"EmojiPicker.Empty\";\nEmojiPickerSkinToneSelector.displayName = \"EmojiPicker.SkinToneSelector\";\nEmojiPickerActiveEmoji.displayName = \"EmojiPicker.ActiveEmoji\";\nEmojiPickerSkinTone.displayName = \"EmojiPicker.SkinTone\";\n\nexport {\n  EmojiPickerRoot as Root, //                         <EmojiPicker.Root />\n  EmojiPickerSearch as Search, //                     <EmojiPicker.Search />\n  EmojiPickerViewport as Viewport, //                 <EmojiPicker.Viewport />\n  EmojiPickerList as List, //                         <EmojiPicker.List />\n  EmojiPickerLoading as Loading, //                   <EmojiPicker.Loading />\n  EmojiPickerEmpty as Empty, //                       <EmojiPicker.Empty />\n  EmojiPickerSkinToneSelector as SkinToneSelector, // <EmojiPicker.SkinToneSelector />\n  EmojiPickerActiveEmoji as ActiveEmoji, //           <EmojiPicker.ActiveEmoji />\n  EmojiPickerSkinTone as SkinTone, //                 <EmojiPicker.SkinTone />\n};\n", "import type { SkinTone } from \"./types\";\n\nexport const EMOJI_FONT_FAMILY =\n  \"'Apple Color Emoji', 'Noto Color Emoji', 'Twemoji Mozilla', 'Android Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', EmojiSymbols, sans-serif\";\n\nexport const SKIN_TONES: SkinTone[] = [\n  \"none\",\n  \"light\",\n  \"medium-light\",\n  \"medium\",\n  \"medium-dark\",\n  \"dark\",\n];\n", "export function capitalize(string: string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\n", "import { EMOJI_FONT_FAMILY } from \"../constants\";\n\nconst CANVAS_SIZE = 2;\n\nlet context: CanvasRenderingContext2D | null = null;\n\nexport function isEmojiSupported(emoji: string): boolean {\n  try {\n    context ??= document\n      .createElement(\"canvas\")\n      .getContext(\"2d\", { willReadFrequently: true });\n    /* v8 ignore next */\n  } catch {}\n\n  // Non-browser environments are not supported\n  if (!context) {\n    return false;\n  }\n\n  // Schedule to dispose of the context\n  queueMicrotask(() => {\n    if (context) {\n      context = null;\n    }\n  });\n\n  context.canvas.width = CANVAS_SIZE;\n  context.canvas.height = CANVAS_SIZE;\n  context.font = `2px ${EMOJI_FONT_FAMILY}`;\n  context.textBaseline = \"middle\";\n\n  // Unsupported ZWJ sequence emojis show up as separate emojis\n  if (context.measureText(emoji).width >= CANVAS_SIZE * 2) {\n    return false;\n  }\n\n  context.fillStyle = \"#00f\";\n  context.fillText(emoji, 0, 0);\n\n  const blue = context.getImageData(0, 0, CANVAS_SIZE, CANVAS_SIZE).data;\n\n  context.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);\n\n  context.fillStyle = \"#f00\";\n  context.fillText(emoji, 0, 0);\n\n  const red = context.getImageData(0, 0, CANVAS_SIZE, CANVAS_SIZE).data;\n\n  // Emojis have an immutable color so they should look the same regardless of the text color\n  for (let i = 0; i < CANVAS_SIZE * CANVAS_SIZE * 4; i += 4) {\n    if (\n      blue[i] !== red[i] || //         R\n      blue[i + 1] !== red[i + 1] || // G\n      blue[i + 2] !== red[i + 2] //    B\n    ) {\n      return false;\n    }\n  }\n\n  return true;\n}\n", "export function getStorage<T>(\n  storage: Storage,\n  key: string,\n  validate: (value: unknown) => T,\n) {\n  try {\n    const item = storage.getItem(key);\n\n    if (!item) {\n      throw new Error(`No value found for \"${key}\".`);\n    }\n\n    const value = JSON.parse(item) as T;\n\n    return validate(value);\n  } catch {\n    return null;\n  }\n}\n\nexport function setStorage<T>(storage: Storage, key: string, value: T) {\n  storage.setItem(key, JSON.stringify(value));\n}\n", "// A suite of tiny validators.\n// They are only meant to be used internally, so they don't throw human-friendly errors.\n\nexport type Validator<T> = (data: unknown) => T;\n\nexport function optional<T>(\n  validate: Validator<T>,\n): (data: unknown) => T | undefined {\n  return (data: unknown): T | undefined =>\n    data === undefined ? undefined : validate(data);\n}\n\nexport function nullable<T>(validate: Validator<T>): Validator<T | null> {\n  return (data: unknown): T | null => (data === null ? null : validate(data));\n}\n\nexport function string(data: unknown): string {\n  if (typeof data !== \"string\") {\n    throw new Error();\n  }\n\n  return data;\n}\n\nexport function number(data: unknown): number {\n  if (typeof data !== \"number\") {\n    throw new Error();\n  }\n\n  return data;\n}\n\nexport function boolean(data: unknown): boolean {\n  if (typeof data !== \"boolean\") {\n    throw new Error();\n  }\n\n  return data;\n}\n\nexport function object<T>(\n  keys: {\n    [K in keyof T]: Validator<T[K]>;\n  },\n): (data: unknown) => T {\n  return (data: unknown): T => {\n    if (typeof data !== \"object\" || data === null) {\n      throw new Error();\n    }\n\n    const result = {} as T;\n\n    for (const key in keys) {\n      const value = (data as Record<keyof T, unknown>)[key];\n\n      if (value === undefined) {\n        // If the value is undefined, verify whether the validator allows it\n        keys[key](undefined);\n      }\n\n      result[key as keyof T] = keys[key](value);\n    }\n\n    return result;\n  };\n}\n\nexport function naiveArray<T>(validate: Validator<T>): Validator<T[]> {\n  return (data: unknown): T[] => {\n    if (!Array.isArray(data)) {\n      throw new Error();\n    }\n\n    // Naively only validate the first item\n    if (data.length > 0) {\n      validate(data[0]);\n    }\n\n    return data;\n  };\n}\n", "import { SKIN_TONES } from \"../constants\";\nimport type {\n  EmojiData,\n  EmojiDataEmoji,\n  EmojibaseEmoji,\n  EmojibaseEmojiWithGroup,\n  EmojibaseMessagesDataset,\n  Locale,\n  SkinTone,\n} from \"../types\";\nimport { capitalize } from \"../utils/capitalize\";\nimport { isEmojiSupported } from \"../utils/is-emoji-supported\";\nimport { getStorage, setStorage } from \"../utils/storage\";\nimport * as $ from \"../utils/validate\";\n\nconst EMOJIBASE_EMOJIS_URL = (baseUrl: string, locale: Locale) =>\n  `${baseUrl}/${locale}/data.json`;\nconst EMOJIBASE_MESSAGES_URL = (baseUrl: string, locale: Locale) =>\n  `${baseUrl}/${locale}/messages.json`;\n\nconst EMOJIBASE_LOCALES = [\n  \"bn\",\n  \"da\",\n  \"de\",\n  \"en-gb\",\n  \"en\",\n  \"es-mx\",\n  \"es\",\n  \"et\",\n  \"fi\",\n  \"fr\",\n  \"hi\",\n  \"hu\",\n  \"it\",\n  \"ja\",\n  \"ko\",\n  \"lt\",\n  \"ms\",\n  \"nb\",\n  \"nl\",\n  \"pl\",\n  \"pt\",\n  \"ru\",\n  \"sv\",\n  \"th\",\n  \"uk\",\n  \"vi\",\n  \"zh-hant\",\n  \"zh\",\n] satisfies Locale[];\nconst EMOJIBASE_DEFAULT_LOCALE: Locale = \"en\";\n\nexport const LOCAL_DATA_KEY = (locale: string) => `frimousse/data/${locale}`;\nexport const SESSION_METADATA_KEY = \"frimousse/metadata\";\n\n// Prevent EMOJIBASE_LOCALES to be out of sync with Locale\n{\n  type MissingLocales = Exclude<Locale, (typeof EMOJIBASE_LOCALES)[number]>;\n  type AllLocalesPresent = MissingLocales extends never\n    ? true\n    : `Missing locales: ${MissingLocales}`;\n  const _allLocalesPresent: AllLocalesPresent = true;\n  _allLocalesPresent;\n}\n\ntype GetEmojiDataOptions = {\n  locale: Locale;\n  emojiVersion?: number;\n  emojibaseUrl?: string;\n  signal?: AbortSignal;\n};\n\ntype LocalData = {\n  data: EmojiData;\n  metadata: {\n    emojisEtag: string | null;\n    messagesEtag: string | null;\n  };\n};\n\ntype SessionMetadata = {\n  emojiVersion: number;\n  countryFlags: boolean;\n};\n\nasync function fetchEtag(url: string, signal?: AbortSignal) {\n  try {\n    const response = await fetch(url, { method: \"HEAD\", signal });\n\n    return response.headers.get(\"etag\");\n  } catch (_) {\n    return null;\n  }\n}\n\nasync function fetchEmojibaseData(\n  baseUrl: string,\n  locale: Locale,\n  signal?: AbortSignal,\n) {\n  const [{ emojis, emojisEtag }, { messages, messagesEtag }] =\n    await Promise.all([\n      fetch(EMOJIBASE_EMOJIS_URL(baseUrl, locale), { signal }).then(\n        async (response) => {\n          return {\n            emojis: (await response.json()) as EmojibaseEmoji[],\n            emojisEtag: response.headers.get(\"etag\"),\n          };\n        },\n      ),\n      fetch(EMOJIBASE_MESSAGES_URL(baseUrl, locale), { signal }).then(\n        async (response) => {\n          return {\n            messages: (await response.json()) as EmojibaseMessagesDataset,\n            messagesEtag: response.headers.get(\"etag\"),\n          };\n        },\n      ),\n    ]);\n\n  return {\n    emojis,\n    messages,\n    emojisEtag,\n    messagesEtag,\n  };\n}\n\nasync function fetchEmojibaseEtags(\n  baseUrl: string,\n  locale: Locale,\n  signal?: AbortSignal,\n) {\n  const [emojisEtag, messagesEtag] = await Promise.all([\n    fetchEtag(EMOJIBASE_EMOJIS_URL(baseUrl, locale), signal),\n    fetchEtag(EMOJIBASE_MESSAGES_URL(baseUrl, locale), signal),\n  ]);\n\n  return {\n    emojisEtag,\n    messagesEtag,\n  };\n}\n\nexport function getEmojibaseSkinToneVariations(\n  emoji: EmojibaseEmojiWithGroup,\n): Record<Exclude<SkinTone, \"none\">, string> | undefined {\n  if (!emoji.skins) {\n    return;\n  }\n\n  const skinToneVariations = emoji.skins.filter(\n    (emoji) => typeof emoji.tone === \"number\",\n  );\n\n  return skinToneVariations.reduce(\n    (result, emoji) => {\n      const skinTone = SKIN_TONES[emoji.tone as number]!;\n\n      result[skinTone as Exclude<SkinTone, \"none\">] = emoji.emoji;\n\n      return result;\n    },\n    {} as Record<Exclude<SkinTone, \"none\">, string>,\n  );\n}\n\nasync function fetchEmojiData(\n  baseUrl: string,\n  locale: Locale,\n  signal?: AbortSignal,\n): Promise<EmojiData> {\n  const { emojis, emojisEtag, messages, messagesEtag } =\n    await fetchEmojibaseData(baseUrl, locale, signal);\n  const countryFlagsSubgroup = messages.subgroups.find(\n    (subgroup) =>\n      subgroup.key === \"country-flag\" || subgroup.key === \"subdivision-flag\",\n  );\n\n  // Filter out the component/modifier category and its emojis\n  const filteredGroups = messages.groups.filter(\n    (group) => group.key !== \"component\",\n  );\n  const filteredEmojis = emojis.filter((emoji) => {\n    return \"group\" in emoji;\n  }) as EmojibaseEmojiWithGroup[];\n\n  const categories = filteredGroups.map((group) => ({\n    index: group.order,\n    label: capitalize(group.message),\n  }));\n  const skinTones = messages.skinTones.reduce(\n    (skinTones, skinTone) => {\n      skinTones[skinTone.key] = capitalize(skinTone.message);\n\n      return skinTones;\n    },\n    {} as Record<SkinTone, string>,\n  );\n\n  const formattedEmojis = filteredEmojis.map((emoji) => {\n    return {\n      emoji: emoji.emoji,\n      category: emoji.group,\n      version: emoji.version,\n      label: capitalize(emoji.label),\n      tags: emoji.tags ?? [],\n      countryFlag:\n        (countryFlagsSubgroup &&\n          emoji.subgroup === countryFlagsSubgroup.order) ||\n        undefined,\n      skins: getEmojibaseSkinToneVariations(emoji),\n    } satisfies EmojiDataEmoji;\n  });\n\n  const emojiData: EmojiData = {\n    locale,\n    emojis: formattedEmojis,\n    categories,\n    skinTones,\n  };\n\n  setStorage(localStorage, LOCAL_DATA_KEY(locale), {\n    data: emojiData,\n    metadata: {\n      emojisEtag,\n      messagesEtag,\n    },\n  });\n\n  return emojiData;\n}\n\nfunction getSessionMetadata(\n  emojis: EmojiDataEmoji[],\n  emojiVersion?: number,\n): SessionMetadata {\n  const versionEmojis = new Map<number, string>();\n\n  for (const emoji of emojis) {\n    if (!versionEmojis.has(emoji.version)) {\n      versionEmojis.set(emoji.version, emoji.emoji);\n    }\n  }\n\n  const descendingVersions = [...versionEmojis.keys()].sort((a, b) => b - a);\n  const highestVersion = descendingVersions[0] ?? 0;\n\n  const supportsCountryFlags = isEmojiSupported(\"\");\n\n  if (typeof emojiVersion === \"number\") {\n    return {\n      emojiVersion,\n      countryFlags: supportsCountryFlags,\n    };\n  }\n\n  for (const version of descendingVersions) {\n    const emoji = versionEmojis.get(version)!;\n\n    if (isEmojiSupported(emoji)) {\n      return {\n        emojiVersion: version,\n        countryFlags: supportsCountryFlags,\n      };\n    }\n  }\n\n  return {\n    emojiVersion: highestVersion,\n    countryFlags: supportsCountryFlags,\n  };\n}\n\nconst validateSessionMetadata = $.object<SessionMetadata>({\n  emojiVersion: $.number,\n  countryFlags: $.boolean,\n});\n\nconst validateLocalData = $.object<LocalData>({\n  data: $.object({\n    locale: $.string as $.Validator<Locale>,\n    emojis: $.naiveArray(\n      $.object({\n        emoji: $.string,\n        category: $.number,\n        label: $.string,\n        version: $.number,\n        tags: $.naiveArray($.string),\n        countryFlag: $.optional($.boolean as $.Validator<true>),\n        skins: $.optional(\n          $.object({\n            light: $.string,\n            \"medium-light\": $.string,\n            medium: $.string,\n            \"medium-dark\": $.string,\n            dark: $.string,\n          }),\n        ),\n      }),\n    ),\n    categories: $.naiveArray(\n      $.object({\n        index: $.number,\n        label: $.string,\n      }),\n    ),\n    skinTones: $.object({\n      light: $.string,\n      \"medium-light\": $.string,\n      medium: $.string,\n      \"medium-dark\": $.string,\n      dark: $.string,\n    }),\n  }),\n  metadata: $.object({\n    emojisEtag: $.nullable($.string),\n    messagesEtag: $.nullable($.string),\n  }),\n});\n\nexport async function getEmojiData({\n  locale,\n  emojiVersion,\n  emojibaseUrl,\n  signal,\n}: GetEmojiDataOptions): Promise<EmojiData> {\n  const baseUrl =\n    typeof emojibaseUrl === \"string\"\n      ? emojibaseUrl\n      : `https://cdn.jsdelivr.net/npm/emojibase-data@${typeof emojiVersion === \"number\" ? Math.floor(emojiVersion) : \"latest\"}`;\n  let sessionMetadata = getStorage<SessionMetadata>(\n    sessionStorage,\n    SESSION_METADATA_KEY,\n    validateSessionMetadata,\n  );\n  const localData = getStorage<LocalData>(\n    localStorage,\n    LOCAL_DATA_KEY(locale),\n    validateLocalData,\n  );\n\n  let data: EmojiData;\n\n  if (!localData) {\n    // No local data\n    data = await fetchEmojiData(baseUrl, locale, signal);\n  } else if (sessionMetadata) {\n    // ETags are used to check if the data is up-to-date but only\n    // once per session, so if the session metadata is already set,\n    // the local data can be used\n    data = localData.data;\n  } else {\n    // Check ETags to see if the local data is up-to-date,\n    // but if that fails, the possibly-stale local data is used\n    try {\n      const { emojisEtag, messagesEtag } = await fetchEmojibaseEtags(\n        baseUrl,\n        locale,\n        signal,\n      );\n\n      data =\n        !emojisEtag ||\n        !messagesEtag ||\n        emojisEtag !== localData.metadata.emojisEtag ||\n        messagesEtag !== localData.metadata.messagesEtag\n          ? await fetchEmojiData(baseUrl, locale, signal)\n          : localData.data;\n    } catch {\n      data = localData.data;\n    }\n  }\n\n  // Set the session metadata if needed\n  sessionMetadata ??= getSessionMetadata(data.emojis, emojiVersion);\n  setStorage(sessionStorage, SESSION_METADATA_KEY, sessionMetadata);\n\n  // Filter out unsupported emojis\n  const filteredEmojis = data.emojis.filter((emoji) => {\n    const isSupportedVersion = emoji.version <= sessionMetadata.emojiVersion;\n\n    return emoji.countryFlag\n      ? isSupportedVersion && sessionMetadata.countryFlags\n      : isSupportedVersion;\n  });\n\n  return {\n    locale,\n    emojis: filteredEmojis,\n    categories: data.categories,\n    skinTones: data.skinTones,\n  };\n}\n\nexport function validateLocale(locale: string): Locale {\n  if (!EMOJIBASE_LOCALES.includes(locale as Locale)) {\n    console.warn(\n      `Locale \"${locale}\" is not supported, using \"${EMOJIBASE_DEFAULT_LOCALE}\" instead.`,\n    );\n\n    return EMOJIBASE_DEFAULT_LOCALE;\n  }\n\n  return locale as Locale;\n}\n\nexport function validateSkinTone(skinTone: string): SkinTone {\n  if (!SKIN_TONES.includes(skinTone as SkinTone)) {\n    console.warn(`Skin tone \"${skinTone}\" is not valid, using \"none\" instead.`);\n\n    return \"none\";\n  }\n\n  return skinTone as SkinTone;\n}\n", "export function chunk<T>(array: T[], size: number): T[][] {\n  const chunks: T[][] = [];\n\n  if (size <= 0) {\n    return chunks;\n  }\n\n  for (let i = 0, j = array.length; i < j; i += size) {\n    chunks.push(array.slice(i, i + size));\n  }\n\n  return chunks;\n}\n", "import type {\n  Emoji,\n  EmojiData,\n  EmojiDataEmoji,\n  EmojiPickerData,\n  EmojiPickerDataCategory,\n  EmojiPickerDataRow,\n  EmojiPickerEmoji,\n  SkinTone,\n} from \"../types\";\nimport { chunk } from \"../utils/chunk\";\n\nexport function searchEmojis(emojis: EmojiDataEmoji[], search?: string) {\n  if (!search) {\n    return emojis;\n  }\n\n  const searchText = search.toLowerCase().trim();\n  const scores = new WeakMap<Emoji, number>();\n\n  return emojis\n    .filter((emoji) => {\n      let score = 0;\n\n      if (emoji.label.toLowerCase().includes(searchText)) {\n        score += 10;\n      }\n\n      for (const tag of emoji.tags) {\n        if (tag.toLowerCase().includes(searchText)) {\n          score += 1;\n        }\n      }\n\n      if (score > 0) {\n        scores.set(emoji, score);\n\n        return true;\n      }\n\n      return false;\n    })\n    .sort((a, b) => (scores.get(b) ?? 0) - (scores.get(a) ?? 0));\n}\n\nexport function getEmojiPickerData(\n  data: EmojiData,\n  columns: number,\n  skinTone: SkinTone | undefined,\n  search: string,\n): EmojiPickerData {\n  const emojis = searchEmojis(data.emojis, search);\n  const rows: EmojiPickerDataRow[] = [];\n  const categories: EmojiPickerDataCategory[] = [];\n  const categoriesStartRowIndices: number[] = [];\n  const emojisByCategory: Record<number, EmojiPickerEmoji[]> = {};\n  let categoryIndex = 0;\n  let startRowIndex = 0;\n\n  for (const emoji of emojis) {\n    if (!emojisByCategory[emoji.category]) {\n      emojisByCategory[emoji.category] = [];\n    }\n\n    emojisByCategory[emoji.category]!.push({\n      emoji:\n        skinTone && skinTone !== \"none\" && emoji.skins\n          ? emoji.skins[skinTone]\n          : emoji.emoji,\n      label: emoji.label,\n    });\n  }\n\n  for (const category of data.categories) {\n    const categoryEmojis = emojisByCategory[category.index];\n\n    if (!categoryEmojis || categoryEmojis.length === 0) {\n      continue;\n    }\n\n    const categoryRows = chunk(Array.from(categoryEmojis), columns).map(\n      (emojis) => ({\n        categoryIndex,\n        emojis,\n      }),\n    );\n\n    rows.push(...categoryRows);\n    categories.push({\n      label: category.label,\n      rowsCount: categoryRows.length,\n      startRowIndex,\n    });\n\n    categoriesStartRowIndices.push(startRowIndex);\n\n    categoryIndex++;\n    startRowIndex += categoryRows.length;\n  }\n\n  return {\n    count: emojis.length,\n    categories,\n    categoriesStartRowIndices,\n    rows,\n    skinTones: data.skinTones,\n  };\n}\n", "import { useCallback, useDeferredValue, useMemo } from \"react\";\nimport { $activeEmoji, sameEmojiPickerEmoji } from \"./store\";\n\nimport { useEmojiPickerStore } from \"./store\";\nimport type { Emoji, SkinTone, SkinToneVariation } from \"./types\";\nimport { getSkinToneVariations } from \"./utils/get-skin-tone-variations\";\nimport { useSelector, useSelectorKey } from \"./utils/store\";\n\n// biome-ignore lint/correctness/noUnusedImports: This import is only used to create @link tags in JSDoc comments\nimport type * as EmojiPicker from \"./components/emoji-picker\";\n\n/**\n * Returns the currently active emoji (either hovered or selected\n * via keyboard navigation).\n *\n * @example\n * ```tsx\n * const activeEmoji = useActiveEmoji();\n * ```\n *\n * It can be used to build a preview area next to the list.\n *\n * @example\n * ```tsx\n * const activeEmoji = useActiveEmoji();\n *\n * <div>\n *   {activeEmoji ? (\n *     <span>{activeEmoji.emoji} {activeEmoji.label}</span>\n *   ) : (\n *     <span>Select an emoji</span>\n *   )}\n * </div>\n * ```\n *\n * @see\n * If you prefer to use a component rather than a hook,\n * {@link EmojiPicker.ActiveEmoji|`<EmojiPicker.ActiveEmoji />`} is also available.\n */\nexport function useActiveEmoji(): Emoji | undefined {\n  const store = useEmojiPickerStore();\n  const activeEmoji = useSelector(store, $activeEmoji, sameEmojiPickerEmoji);\n\n  return useDeferredValue(activeEmoji);\n}\n\n/**\n * Returns the current skin tone and a function to change it.\n *\n * @example\n * ```tsx\n * const [skinTone, setSkinTone] = useSkinTone();\n * ```\n *\n * It can be used to build a custom skin tone selector: pass an emoji\n * you want to use as visual (by default, ) and it will return its skin tone\n * variations.\n *\n * @example\n * ```tsx\n * const [skinTone, setSkinTone, skinToneVariations] = useSkinTone(\"\");\n *\n * // () () () () () ()\n * skinToneVariations.map(({ skinTone, emoji }) => (\n *   <button key={skinTone} onClick={() => setSkinTone(skinTone)}>\n *     {emoji}\n *   </button>\n * ));\n * ```\n *\n * @see\n * If you prefer to use a component rather than a hook,\n * {@link EmojiPicker.SkinTone|`<EmojiPicker.SkinTone />`} is also available.\n *\n * @see\n * An already-built skin tone selector is also available,\n * {@link EmojiPicker.SkinToneSelector|`<EmojiPicker.SkinToneSelector />`}.\n */\nexport function useSkinTone(\n  emoji = \"\",\n): [SkinTone, (skinTone: SkinTone) => void, SkinToneVariation[]] {\n  const store = useEmojiPickerStore();\n  const skinTone = useSelectorKey(store, \"skinTone\");\n  const skinToneVariations = useMemo(\n    () => getSkinToneVariations(emoji),\n    [emoji],\n  );\n\n  const setSkinTone = useCallback((skinTone: SkinTone) => {\n    store.set({ skinTone });\n  }, []);\n\n  return [skinTone, setSkinTone, skinToneVariations] as const;\n}\n", "import {\n  type PropsWithChildren,\n  createContext,\n  useCallback,\n  useContext,\n  useDebugValue,\n  useEffect,\n  useState,\n} from \"react\";\n\n// A tiny store with batched updates, context support, and selectors.\n\nexport type Store<T> = {\n  get: () => T;\n  set: (partial: Partial<T> | ((state: T) => Partial<T>)) => void;\n  subscribe: (subscriber: (state: T) => void) => () => void;\n};\n\nexport function createStore<T extends object>(\n  createInitialState: (set: Store<T>[\"set\"], get: Store<T>[\"get\"]) => T,\n): Store<T> {\n  let state = {} as T;\n  let pending: T | null = null;\n  let frameId: number | null = null;\n  const subscribers = new Set<(store: T) => void>();\n\n  const flush = () => {\n    if (pending) {\n      state = pending;\n      pending = null;\n\n      for (const subscriber of subscribers) {\n        subscriber(state);\n      }\n    }\n\n    frameId = null;\n  };\n\n  const get = () => pending ?? state;\n\n  const set: Store<T>[\"set\"] = (partial) => {\n    pending ??= state;\n    Object.assign(\n      pending as T,\n      typeof partial === \"function\"\n        ? (partial as (state: T) => Partial<T>)(get())\n        : partial,\n    );\n\n    if (!frameId) {\n      frameId = requestAnimationFrame(flush);\n    }\n  };\n\n  const subscribe = (subscriber: (state: T) => void) => {\n    subscribers.add(subscriber);\n\n    return () => subscribers.delete(subscriber);\n  };\n\n  state = createInitialState(set, get);\n\n  return { get, set, subscribe };\n}\n\nexport function useCreateStore<T>(createStore: () => Store<T>) {\n  const [store] = useState(createStore);\n\n  return store;\n}\n\nexport function useCreateStoreContext<T>(missingProviderError?: string) {\n  const Context = createContext<Store<T> | null>(null);\n\n  const useStore = () => {\n    const store = useContext(Context);\n\n    if (!store) {\n      throw new Error(missingProviderError);\n    }\n\n    return store as Store<T>;\n  };\n\n  const Provider = ({\n    store,\n    children,\n  }: PropsWithChildren<{ store: Store<T> }>) => {\n    return <Context.Provider value={store}>{children}</Context.Provider>;\n  };\n\n  return { useStore, Provider };\n}\n\nexport function useSelector<T, S>(\n  store: Store<T>,\n  selector: (state: T) => S,\n  compare: (a: S, b: S) => boolean = Object.is,\n) {\n  const [slice, setSlice] = useState(() => selector(store.get()));\n\n  useEffect(() => {\n    return store.subscribe(() => {\n      const nextSlice = selector(store.get());\n\n      setSlice((previousSlice) =>\n        compare(previousSlice, nextSlice) ? previousSlice : nextSlice,\n      );\n    });\n  }, [store, selector, compare]);\n\n  useDebugValue(slice);\n\n  return slice;\n}\n\nexport function useSelectorKey<T, K extends keyof T>(\n  store: Store<T>,\n  key: K,\n  compare?: (a: T[K], b: T[K]) => boolean,\n) {\n  const selector = useCallback((state: T) => state[key], [key]);\n\n  return useSelector(store, selector, compare);\n}\n", "import type { RefObject } from \"react\";\nimport type {\n  EmojiPickerData,\n  EmojiPickerDataRow,\n  EmojiPickerEmoji,\n  EmojiPickerRootProps,\n  Locale,\n  SkinTone,\n} from \"./types\";\nimport { createStore, useCreateStoreContext } from \"./utils/store\";\n\nconst VIEWPORT_OVERSCAN = 2;\n\ntype Interaction = \"keyboard\" | \"pointer\" | \"none\";\n\nexport type EmojiPickerStore = {\n  locale: Locale;\n  columns: number;\n  skinTone: SkinTone;\n  onEmojiSelect: NonNullable<EmojiPickerRootProps[\"onEmojiSelect\"]>;\n\n  data: EmojiPickerData | null | undefined;\n  search: string;\n  interaction: Interaction;\n  activeColumnIndex: number;\n  activeRowIndex: number;\n\n  rowHeight: number | null;\n  categoryHeaderHeight: number | null;\n  viewportWidth: number | null;\n  viewportHeight: number | null;\n\n  viewportStartCategoryIndex: number;\n  viewportStartRowIndex: number;\n  viewportEndRowIndex: number;\n\n  rootRef: RefObject<HTMLDivElement> | null;\n  searchRef: RefObject<HTMLInputElement> | null;\n  viewportRef: RefObject<HTMLDivElement> | null;\n  listRef: RefObject<HTMLDivElement> | null;\n\n  updateViewportState: (changes?: Partial<EmojiPickerStore>) => void;\n\n  onDataChange: (data: EmojiPickerData) => void;\n  onSearchChange: (search: string) => void;\n  onActiveEmojiChange: (\n    interaction: Exclude<Interaction, \"none\">,\n    activeColumnIndex: number,\n    activeRowIndex: number,\n  ) => void;\n  onActiveEmojiReset: () => void;\n  onRowHeightChange: (rowHeight: number) => void;\n  onCategoryHeaderHeightChange: (categoryHeaderHeight: number) => void;\n  onViewportSizeChange: (viewportWidth: number, viewportHeight: number) => void;\n  onViewportScroll: (scrollY: number) => void;\n};\n\nexport function createEmojiPickerStore(\n  onEmojiSelect: NonNullable<EmojiPickerRootProps[\"onEmojiSelect\"]>,\n  initialLocale: Locale,\n  initialColumns: number,\n  initialSkinTone: SkinTone,\n) {\n  let viewportScrollY = 0;\n\n  return createStore<EmojiPickerStore>((set, get) => ({\n    locale: initialLocale,\n    columns: initialColumns,\n    skinTone: initialSkinTone,\n    onEmojiSelect,\n\n    data: null,\n    search: \"\",\n    interaction: \"none\",\n    activeColumnIndex: 0,\n    activeRowIndex: 0,\n\n    rowHeight: null,\n    categoryHeaderHeight: null,\n    viewportWidth: null,\n    viewportHeight: null,\n\n    viewportCurrentCategoryIndex: null,\n    viewportStartCategoryIndex: 0,\n    viewportStartRowIndex: 0,\n    viewportEndRowIndex: 0,\n\n    rootRef: null,\n    searchRef: null,\n    viewportRef: null,\n    listRef: null,\n\n    updateViewportState: (partial?: Partial<EmojiPickerStore>) => {\n      const state = get();\n\n      const data = partial?.data ?? state.data;\n      const categoryHeaderHeight =\n        partial?.categoryHeaderHeight ?? state.categoryHeaderHeight;\n      const rowHeight = partial?.rowHeight ?? state.rowHeight;\n      const viewportHeight = partial?.viewportHeight ?? state.viewportHeight;\n\n      if (\n        !data ||\n        data.rows.length === 0 ||\n        !categoryHeaderHeight ||\n        !rowHeight ||\n        !viewportHeight\n      ) {\n        return set({\n          ...partial,\n          viewportStartCategoryIndex: 0,\n          viewportStartRowIndex: 0,\n          viewportEndRowIndex: 0,\n        });\n      }\n\n      let previousCategoryHeadersHeight = 0;\n      let categoryIndex = 0;\n\n      for (const category of data.categories) {\n        const categoryY =\n          categoryIndex++ * categoryHeaderHeight +\n          category.startRowIndex * rowHeight;\n\n        if (categoryY < viewportScrollY) {\n          previousCategoryHeadersHeight += categoryHeaderHeight;\n        } else {\n          break;\n        }\n      }\n\n      const totalHeight =\n        data.categories.length * categoryHeaderHeight +\n        data.rows.length * rowHeight;\n\n      const overscanStart = Math.floor((VIEWPORT_OVERSCAN * rowHeight) / 2);\n      const overscanEnd = Math.ceil((VIEWPORT_OVERSCAN * rowHeight) / 2);\n\n      // Adjust the scroll position to account for previous category headers\n      const viewportStartY = Math.min(\n        viewportScrollY - previousCategoryHeadersHeight - overscanStart,\n        totalHeight - viewportHeight,\n      );\n\n      const viewportEndY = viewportStartY + viewportHeight + overscanEnd;\n\n      const viewportStartRowIndex = Math.max(\n        0,\n        Math.floor(viewportStartY / rowHeight),\n      );\n      const viewportEndRowIndex = Math.min(\n        data.rows.length - 1,\n        Math.ceil(viewportEndY / rowHeight),\n      );\n      const viewportStartCategoryIndex =\n        data.rows[viewportStartRowIndex]?.categoryIndex;\n\n      if (viewportStartCategoryIndex === undefined && partial) {\n        return set(partial);\n      }\n\n      return set({\n        ...partial,\n        viewportStartCategoryIndex,\n        viewportStartRowIndex,\n        viewportEndRowIndex,\n      });\n    },\n\n    onDataChange: (data: EmojiPickerData) => {\n      get().updateViewportState({\n        data,\n\n        // Reset active emoji when data changes\n        activeColumnIndex: 0,\n        activeRowIndex: 0,\n      });\n    },\n    onSearchChange: (search: string) => {\n      set({ search, interaction: search ? \"keyboard\" : \"none\" });\n    },\n    onActiveEmojiChange: (\n      interaction: Exclude<Interaction, \"none\">,\n      activeColumnIndex: number,\n      activeRowIndex: number,\n    ) => {\n      set({\n        interaction,\n        activeColumnIndex,\n        activeRowIndex,\n      });\n\n      if (interaction !== \"keyboard\") {\n        return;\n      }\n\n      const {\n        listRef,\n        viewportRef,\n        rowHeight,\n        viewportHeight,\n        categoryHeaderHeight,\n      } = get();\n\n      const list = listRef?.current;\n      const viewport = viewportRef?.current;\n\n      if (\n        !list ||\n        !viewport ||\n        !rowHeight ||\n        !categoryHeaderHeight ||\n        !viewportHeight\n      ) {\n        return;\n      }\n\n      const rowIndex = activeRowIndex;\n\n      if (rowIndex === 0) {\n        viewport.scrollTo({\n          top: 0,\n          behavior: \"instant\",\n        });\n      }\n\n      const row = list.querySelector(`[aria-rowindex=\"${rowIndex}\"]`);\n\n      if (!(row instanceof HTMLElement)) {\n        return;\n      }\n\n      const rowY = row.offsetTop;\n      const rowComputedStyle = getComputedStyle(row);\n      const rowScrollMarginTop = Number.parseFloat(\n        rowComputedStyle.scrollMarginTop,\n      );\n      const rowScrollMarginBottom = Number.parseFloat(\n        rowComputedStyle.scrollMarginBottom,\n      );\n\n      let viewportStartY = viewportScrollY + rowScrollMarginTop;\n\n      // Account for sticky headers if the row is in the upper half of the viewport\n      if (rowY < viewportScrollY + viewportHeight / 2) {\n        viewportStartY += categoryHeaderHeight;\n      }\n\n      const viewportEndY =\n        viewportStartY + viewportHeight - rowScrollMarginBottom;\n\n      if (rowY < viewportStartY || rowY + rowHeight > viewportEndY) {\n        viewport.scrollTo({\n          // Align to the viewport's top or bottom based on the row's position\n          top: Math.max(\n            rowY < viewportStartY + categoryHeaderHeight\n              ? rowY - Math.max(categoryHeaderHeight, rowScrollMarginTop)\n              : rowY - viewportHeight + rowHeight + rowScrollMarginBottom,\n            0,\n          ),\n          behavior: \"instant\",\n        });\n      }\n    },\n    onActiveEmojiReset: () => {\n      set({\n        interaction: \"none\",\n\n        // Reset active emoji when interaction goes back to none\n        activeColumnIndex: 0,\n        activeRowIndex: 0,\n      });\n    },\n    onRowHeightChange: (rowHeight: number) => {\n      get().updateViewportState({ rowHeight });\n    },\n    onCategoryHeaderHeightChange: (categoryHeaderHeight: number) => {\n      get().updateViewportState({ categoryHeaderHeight });\n    },\n    onViewportSizeChange: (viewportWidth: number, viewportHeight: number) => {\n      get().updateViewportState({ viewportWidth, viewportHeight });\n    },\n    onViewportScroll: (scrollY: number) => {\n      viewportScrollY = scrollY;\n\n      get().updateViewportState();\n    },\n  }));\n}\n\nexport const {\n  useStore: useEmojiPickerStore,\n  Provider: EmojiPickerStoreProvider,\n} = useCreateStoreContext<EmojiPickerStore>(\"EmojiPicker.Root is missing.\");\n\nexport function $search(state: EmojiPickerStore) {\n  return state.search;\n}\n\nexport function $activeEmoji(\n  state: EmojiPickerStore,\n): EmojiPickerEmoji | undefined {\n  if (state.interaction === \"none\") {\n    return undefined;\n  }\n\n  const activeEmoji =\n    state.data?.rows[state.activeRowIndex]?.emojis[state.activeColumnIndex];\n\n  return activeEmoji;\n}\n\nexport function $isEmpty(state: EmojiPickerStore) {\n  return (\n    state.data === undefined ||\n    (typeof state.data?.count === \"number\" && state.data.count === 0)\n  );\n}\n\nexport function $isLoading(state: EmojiPickerStore) {\n  return (\n    state.data === null ||\n    state.viewportHeight === null ||\n    state.rowHeight === null ||\n    state.categoryHeaderHeight === null\n  );\n}\n\nexport function $rowsCount(state: EmojiPickerStore) {\n  return state.data?.rows.length;\n}\n\nexport function $categoriesCount(state: EmojiPickerStore) {\n  return state.data?.categories.length;\n}\n\nexport function $categoriesRowsStartIndices(state: EmojiPickerStore) {\n  return state.data?.categoriesStartRowIndices;\n}\n\nexport function $skinTones(state: EmojiPickerStore) {\n  return state.data?.skinTones;\n}\n\nexport function sameEmojiPickerEmoji(\n  a: EmojiPickerEmoji | undefined,\n  b: EmojiPickerEmoji | undefined,\n) {\n  return a?.emoji === b?.emoji;\n}\n\nexport function sameEmojiPickerRow(\n  a: EmojiPickerDataRow | undefined,\n  b: EmojiPickerDataRow | undefined,\n) {\n  if (a?.categoryIndex !== b?.categoryIndex) {\n    return false;\n  }\n\n  if (a?.emojis.length !== b?.emojis.length) {\n    return false;\n  }\n\n  return Boolean(\n    a?.emojis.every((emoji, index) =>\n      sameEmojiPickerEmoji(emoji, b?.emojis[index]),\n    ),\n  );\n}\n", "import { SKIN_TONES } from \"../constants\";\nimport type { SkinTone, SkinToneVariation } from \"../types\";\n\nconst ZWJ = \"\\u200D\";\nconst EMOJI_MODIFIER_BASE = /\\p{Emoji_Modifier_Base}/u;\nconst ENDING_VARIATION_SELECTOR = /\\uFE0F$/;\nconst SKIN_TONE_MODIFIERS =\n  /\\u{1F3FB}|\\u{1F3FC}|\\u{1F3FD}|\\u{1F3FE}|\\u{1F3FF}/gu;\n\nconst skinToneModifiers: Record<Exclude<SkinTone, \"none\">, string> = {\n  light: \"\\u{1F3FB}\",\n  \"medium-light\": \"\\u{1F3FC}\",\n  medium: \"\\u{1F3FD}\",\n  \"medium-dark\": \"\\u{1F3FE}\",\n  dark: \"\\u{1F3FF}\",\n};\n\nexport function getSkinToneVariation(emoji: string, skinTone: SkinTone) {\n  // The emoji does not support skin tones\n  if (!emoji.split(ZWJ).some((segment) => EMOJI_MODIFIER_BASE.test(segment))) {\n    return emoji;\n  }\n\n  const baseEmoji = emoji\n    .split(ZWJ)\n    .map((segment) => segment.replace(SKIN_TONE_MODIFIERS, \"\"))\n    .join(ZWJ);\n\n  if (skinTone === \"none\") {\n    return baseEmoji;\n  }\n\n  return baseEmoji\n    .split(ZWJ)\n    .map((segment, _, segments) => {\n      const isZwjSequence = segments.length > 1;\n\n      if (\n        !EMOJI_MODIFIER_BASE.test(segment) ||\n        // The  emoji should not be toned within a ZWJ sequence (e.g. )\n        (isZwjSequence && segment === \"\")\n      ) {\n        return segment;\n      }\n\n      return (\n        segment.replace(ENDING_VARIATION_SELECTOR, \"\") +\n        skinToneModifiers[skinTone]\n      );\n    })\n    .join(ZWJ);\n}\n\nexport function getSkinToneVariations(emoji: string): SkinToneVariation[] {\n  return SKIN_TONES.map((skinTone) => ({\n    skinTone,\n    emoji: getSkinToneVariation(emoji, skinTone),\n  }));\n}\n", "export function shallow(a: unknown, b: unknown): boolean {\n  if (Object.is(a, b)) {\n    return true;\n  }\n\n  if (\n    typeof a !== \"object\" ||\n    typeof b !== \"object\" ||\n    a === null ||\n    b === null\n  ) {\n    return false;\n  }\n\n  if (Array.isArray(a) !== Array.isArray(b)) {\n    return false;\n  }\n\n  const keysA = Object.keys(a);\n  const keysB = Object.keys(b);\n\n  if (keysA.length !== keysB.length) {\n    return false;\n  }\n\n  return keysA.every(\n    (key) => key in b && a[key as keyof typeof a] === b[key as keyof typeof b],\n  );\n}\n", "export function noop(..._: unknown[]) {\n  return;\n}\n\nexport async function noopAsync(..._: unknown[]) {\n  return;\n}\n", "const DEFAULT_TIMEOUT = 10;\nconst DEFAULT_MAX_TIMEOUT = 50;\n\n// Safari doesn't support requestIdleCallback yet\nexport function requestIdleCallback(\n  callback: IdleRequestCallback,\n  options?: IdleRequestOptions,\n) {\n  let id: ReturnType<typeof window.requestIdleCallback> | null = null;\n\n  if (typeof window.requestIdleCallback === \"function\") {\n    id = window.requestIdleCallback(callback, options);\n  } else {\n    const start = Date.now();\n\n    id = window.setTimeout(() => {\n      callback({\n        didTimeout: false,\n        timeRemaining: () =>\n          Math.max(\n            0,\n            (options?.timeout ?? DEFAULT_MAX_TIMEOUT) - (Date.now() - start),\n          ),\n      });\n    }, DEFAULT_TIMEOUT);\n  }\n\n  return () => {\n    if (typeof window.cancelIdleCallback === \"function\") {\n      window.cancelIdleCallback(id);\n    } else {\n      window.clearTimeout(id);\n    }\n  };\n}\n", "import { useEffect, useLayoutEffect as useOriginalLayoutEffect } from \"react\";\n\n// On React 18.2.0 and earlier, useLayoutEffect triggers a warning when executed on the server\nexport const useLayoutEffect =\n  /* v8 ignore next */\n  typeof window !== \"undefined\" ? useOriginalLayoutEffect : useEffect;\n", "import { useCallback, useRef } from \"react\";\nimport { useLayoutEffect } from \"./use-layout-effect\";\n\nexport function useStableCallback<A extends unknown[], R>(\n  callback: (...args: A) => R,\n): (...args: A) => R {\n  const callbackRef = useRef(callback);\n\n  useLayoutEffect(() => {\n    callbackRef.current = callback;\n  });\n\n  return useCallback((...args: A): R => {\n    return callbackRef.current(...args);\n  }, []);\n}\n", "import * as PopoverPrimitive from \"@radix-ui/react-popover\";\nimport {\n  type Emoji as FrimousseEmoji,\n  EmojiPicker as EmojiPickerPrimitive,\n  type EmojiPickerListCategoryHeaderProps,\n  type EmojiPickerListEmojiProps,\n  type EmojiPickerListRowProps,\n  type Locale,\n} from \"frimousse\";\nimport type { ComponentPropsWithoutRef, SyntheticEvent } from \"react\";\nimport { forwardRef, useCallback, useState } from \"react\";\n\nimport { useLiveblocksUiConfig } from \"../../config\";\nimport {\n  FLOATING_ELEMENT_COLLISION_PADDING,\n  FLOATING_ELEMENT_SIDE_OFFSET,\n} from \"../../constants\";\nimport { SearchIcon } from \"../../icons/Search\";\nimport { SpinnerIcon } from \"../../icons/Spinner\";\nimport { useOverrides } from \"../../overrides\";\nimport { cn } from \"../../utils/cn\";\nimport { Emoji } from \"./Emoji\";\nimport { Tooltip } from \"./Tooltip\";\n\nexport interface EmojiPickerProps extends ComponentPropsWithoutRef<\"div\"> {\n  onOpenChange?: (open: boolean) => void;\n  onEmojiSelect?: (emoji: string) => void;\n}\n\nfunction EmojiPickerListEmoji({\n  emoji,\n  className,\n  ...props\n}: EmojiPickerListEmojiProps) {\n  return (\n    <button className={cn(\"lb-emoji-picker-emoji\", className)} {...props}>\n      <Emoji emoji={emoji.emoji} />\n    </button>\n  );\n}\n\nfunction EmojiPickerListRow({\n  children,\n  className,\n  ...props\n}: EmojiPickerListRowProps) {\n  return (\n    <div className={cn(\"lb-emoji-picker-row\", className)} {...props}>\n      {children}\n    </div>\n  );\n}\n\nfunction EmojiPickerListCategoryHeader({\n  category,\n  className,\n  ...props\n}: EmojiPickerListCategoryHeaderProps) {\n  return (\n    <div\n      className={cn(\"lb-emoji-picker-category-header\", className)}\n      {...props}\n    >\n      <span className=\"lb-emoji-picker-category-header-title\">\n        {category.label}\n      </span>\n    </div>\n  );\n}\n\nexport const EmojiPicker = forwardRef<HTMLDivElement, EmojiPickerProps>(\n  (\n    { onEmojiSelect, onOpenChange, children, className, ...props },\n    forwardedRef\n  ) => {\n    const [isOpen, setOpen] = useState(false);\n    const { portalContainer, emojibaseUrl } = useLiveblocksUiConfig();\n    const $ = useOverrides();\n\n    const handleOpenChange = useCallback(\n      (isOpen: boolean) => {\n        setOpen(isOpen);\n        onOpenChange?.(isOpen);\n      },\n      [onOpenChange]\n    );\n\n    const handleEmojiSelect = useCallback(\n      ({ emoji }: FrimousseEmoji) => {\n        setOpen(false);\n        onEmojiSelect?.(emoji);\n      },\n      [onEmojiSelect]\n    );\n\n    const stopPropagation = useCallback((event: SyntheticEvent) => {\n      event.stopPropagation();\n    }, []);\n\n    return (\n      <PopoverPrimitive.Root open={isOpen} onOpenChange={handleOpenChange}>\n        {children}\n        <PopoverPrimitive.Portal container={portalContainer}>\n          <PopoverPrimitive.Content\n            side=\"top\"\n            align=\"center\"\n            sideOffset={FLOATING_ELEMENT_SIDE_OFFSET}\n            collisionPadding={FLOATING_ELEMENT_COLLISION_PADDING}\n            className={cn(\n              \"lb-root lb-portal lb-elevation lb-emoji-picker\",\n              className\n            )}\n            {...props}\n            ref={forwardedRef}\n            asChild\n          >\n            <EmojiPickerPrimitive.Root\n              onEmojiSelect={handleEmojiSelect}\n              locale={$.locale as Locale}\n              columns={10}\n              emojiVersion={15.1}\n              emojibaseUrl={emojibaseUrl}\n              onClick={stopPropagation}\n            >\n              <div className=\"lb-emoji-picker-header\">\n                <div className=\"lb-emoji-picker-search-container\">\n                  <EmojiPickerPrimitive.Search\n                    className=\"lb-emoji-picker-search\"\n                    placeholder={$.EMOJI_PICKER_SEARCH_PLACEHOLDER}\n                    autoFocus\n                  />\n                  <SearchIcon />\n                </div>\n              </div>\n              <EmojiPickerPrimitive.Viewport className=\"lb-emoji-picker-content\">\n                <EmojiPickerPrimitive.Loading className=\"lb-loading lb-emoji-picker-loading\">\n                  <SpinnerIcon />\n                </EmojiPickerPrimitive.Loading>\n                <EmojiPickerPrimitive.Empty className=\"lb-empty lb-emoji-picker-empty\">\n                  {$.EMOJI_PICKER_EMPTY}\n                </EmojiPickerPrimitive.Empty>\n                <EmojiPickerPrimitive.List\n                  className=\"lb-emoji-picker-list\"\n                  components={{\n                    CategoryHeader: EmojiPickerListCategoryHeader,\n                    Row: EmojiPickerListRow,\n                    Emoji: EmojiPickerListEmoji,\n                  }}\n                />\n              </EmojiPickerPrimitive.Viewport>\n              <div className=\"lb-emoji-picker-footer\">\n                <EmojiPickerPrimitive.ActiveEmoji>\n                  {({ emoji }) =>\n                    emoji ? (\n                      <>\n                        <div className=\"lb-emoji-picker-active-emoji\">\n                          {emoji.emoji}\n                        </div>\n                        <span className=\"lb-emoji-picker-active-emoji-label\">\n                          {emoji.label}\n                        </span>\n                      </>\n                    ) : (\n                      <span className=\"lb-emoji-picker-active-emoji-label lb-emoji-picker-active-emoji-label-placeholder\">\n                        Select an emoji\n                      </span>\n                    )\n                  }\n                </EmojiPickerPrimitive.ActiveEmoji>\n                <Tooltip content={$.EMOJI_PICKER_CHANGE_SKIN_TONE}>\n                  <EmojiPickerPrimitive.SkinToneSelector className=\"lb-button lb-emoji-picker-skin-tone-selector\" />\n                </Tooltip>\n              </div>\n            </EmojiPickerPrimitive.Root>\n          </PopoverPrimitive.Content>\n        </PopoverPrimitive.Portal>\n      </PopoverPrimitive.Root>\n    );\n  }\n);\n\nexport { PopoverTrigger as EmojiPickerTrigger } from \"@radix-ui/react-popover\";\n", "\"use client\";\n\nimport type {\n  BaseMetadata,\n  CommentAttachment,\n  CommentMixedAttachment,\n  DM,\n  GroupMentionData,\n} from \"@liveblocks/core\";\nimport { assertNever, MENTION_CHARACTER, Permission } from \"@liveblocks/core\";\nimport { useRoom } from \"@liveblocks/react\";\nimport {\n  useCreateRoomComment,\n  useCreateRoomThread,\n  useEditRoomComment,\n  useLayoutEffect,\n  useResolveMentionSuggestions,\n  useRoomPermissions,\n} from \"@liveblocks/react/_private\";\nimport type {\n  ComponentPropsWithoutRef,\n  ComponentType,\n  FocusEvent,\n  FormEvent,\n  ForwardedRef,\n  MouseEvent,\n  PropsWithChildren,\n  ReactNode,\n  RefAttributes,\n  SyntheticEvent,\n} from \"react\";\nimport {\n  createContext,\n  forwardRef,\n  useCallback,\n  useMemo,\n  useRef,\n  useSyncExternalStore,\n} from \"react\";\n\nimport { useLiveblocksUiConfig } from \"../config\";\nimport { FLOATING_ELEMENT_SIDE_OFFSET } from \"../constants\";\nimport { UsersIcon } from \"../icons\";\nimport { AttachmentIcon } from \"../icons/Attachment\";\nimport { BoldIcon } from \"../icons/Bold\";\nimport { CodeIcon } from \"../icons/Code\";\nimport { EmojiIcon } from \"../icons/Emoji\";\nimport { ItalicIcon } from \"../icons/Italic\";\nimport { MentionIcon } from \"../icons/Mention\";\nimport { SendIcon } from \"../icons/Send\";\nimport { StrikethroughIcon } from \"../icons/Strikethrough\";\nimport type { ComposerOverrides, GlobalOverrides } from \"../overrides\";\nimport { useOverrides } from \"../overrides\";\nimport * as ComposerPrimitive from \"../primitives/Composer\";\nimport {\n  useComposer,\n  useComposerAttachmentsContext,\n  useComposerEditorContext,\n} from \"../primitives/Composer/contexts\";\nimport type {\n  ComposerEditorComponents,\n  ComposerEditorLinkProps,\n  ComposerEditorMentionProps,\n  ComposerEditorMentionSuggestionsProps,\n  ComposerEditorProps,\n  ComposerFormProps,\n  ComposerMarkToggleProps,\n  ComposerSubmitComment,\n} from \"../primitives/Composer/types\";\nimport { useComposerAttachmentsDropArea } from \"../primitives/Composer/utils\";\nimport type { ComposerBodyMark } from \"../types\";\nimport { cn } from \"../utils/cn\";\nimport { useControllableState } from \"../utils/use-controllable-state\";\nimport { useIsGroupMentionMember } from \"../utils/use-group-mention\";\nimport { FileAttachment } from \"./internal/Attachment\";\nimport { Attribution } from \"./internal/Attribution\";\nimport { Avatar } from \"./internal/Avatar\";\nimport { Button } from \"./internal/Button\";\nimport type { EmojiPickerProps } from \"./internal/EmojiPicker\";\nimport { EmojiPicker, EmojiPickerTrigger } from \"./internal/EmojiPicker\";\nimport { Group } from \"./internal/Group\";\nimport { GroupDescription } from \"./internal/GroupDescription\";\nimport { ShortcutTooltip, Tooltip, TooltipProvider } from \"./internal/Tooltip\";\nimport { User } from \"./internal/User\";\n\ninterface EditorActionProps extends ComponentPropsWithoutRef<\"button\"> {\n  label: string;\n  tooltipLabel?: string;\n}\n\ninterface EmojiEditorActionProps extends EditorActionProps {\n  onPickerOpenChange?: EmojiPickerProps[\"onOpenChange\"];\n}\n\ninterface MarkToggleProps extends ComposerMarkToggleProps {\n  icon?: ReactNode;\n  shortcut?: string;\n}\n\ntype ComposerCreateThreadProps<M extends BaseMetadata> = {\n  threadId?: never;\n  commentId?: never;\n\n  /**\n   * The metadata of the thread to create.\n   */\n  metadata?: M;\n};\n\ntype ComposerCreateCommentProps = {\n  /**\n   * The ID of the thread to reply to.\n   */\n  threadId: string;\n  commentId?: never;\n  metadata?: never;\n};\n\ntype ComposerEditCommentProps = {\n  /**\n   * The ID of the thread to edit a comment in.\n   */\n  threadId: string;\n\n  /**\n   * The ID of the comment to edit.\n   */\n  commentId: string;\n  metadata?: never;\n};\n\nexport type ComposerProps<M extends BaseMetadata = DM> = Omit<\n  ComponentPropsWithoutRef<\"form\">,\n  \"defaultValue\"\n> &\n  (\n    | ComposerCreateThreadProps<M>\n    | ComposerCreateCommentProps\n    | ComposerEditCommentProps\n  ) & {\n    /**\n     * The event handler called when the composer is submitted.\n     */\n    onComposerSubmit?: (\n      comment: ComposerSubmitComment,\n      event: FormEvent<HTMLFormElement>\n    ) => Promise<void> | void;\n\n    /**\n     * The composer's initial value.\n     */\n    defaultValue?: ComposerEditorProps[\"defaultValue\"];\n\n    /**\n     * The composer's initial attachments.\n     */\n    defaultAttachments?: CommentAttachment[];\n\n    /**\n     * Whether the composer is collapsed. Setting a value will make the composer controlled.\n     */\n    collapsed?: boolean;\n\n    /**\n     * The event handler called when the collapsed state of the composer changes.\n     */\n    onCollapsedChange?: (collapsed: boolean) => void;\n\n    /**\n     * Whether the composer is initially collapsed. Setting a value will make the composer uncontrolled.\n     */\n    defaultCollapsed?: boolean;\n\n    /**\n     * Whether to show and allow adding attachments.\n     */\n    showAttachments?: boolean;\n\n    /**\n     * Whether to show formatting controls (e.g. a floating toolbar with formatting toggles when selecting text)\n     */\n    showFormattingControls?: boolean;\n\n    /**\n     * Whether the composer is disabled.\n     */\n    disabled?: ComposerFormProps[\"disabled\"];\n\n    /**\n     * Whether to focus the composer on mount.\n     */\n    autoFocus?: ComposerEditorProps[\"autoFocus\"];\n\n    /**\n     * Whether to blur the composer editor when the composer is submitted.\n     */\n    blurOnSubmit?: boolean;\n\n    /**\n     * Override the component's strings.\n     */\n    overrides?: Partial<GlobalOverrides & ComposerOverrides>;\n\n    /**\n     * @internal\n     */\n    actions?: ReactNode;\n\n    /**\n     * @internal\n     */\n    showAttribution?: boolean;\n\n    /**\n     * @internal\n     */\n    roomId?: string;\n  };\n\ninterface ComposerEditorContainerProps\n  extends Pick<\n    ComposerProps,\n    | \"defaultValue\"\n    | \"showAttachments\"\n    | \"showFormattingControls\"\n    | \"showAttribution\"\n    | \"overrides\"\n    | \"actions\"\n    | \"autoFocus\"\n    | \"disabled\"\n  > {\n  isCollapsed: boolean | undefined;\n  onEmptyChange: (isEmpty: boolean) => void;\n  hasResolveMentionSuggestions: boolean;\n  onEmojiPickerOpenChange: (isOpen: boolean) => void;\n  onEditorClick: (event: MouseEvent<HTMLDivElement>) => void;\n}\n\ninterface ComposerMentionProps extends ComposerEditorMentionProps {\n  overrides?: ComposerProps[\"overrides\"];\n}\n\nfunction ComposerInsertMentionEditorAction({\n  label,\n  tooltipLabel,\n  className,\n  onClick,\n  ...props\n}: EditorActionProps) {\n  const { createMention } = useComposer();\n\n  const preventDefault = useCallback((event: SyntheticEvent) => {\n    event.preventDefault();\n  }, []);\n\n  const handleClick = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      onClick?.(event);\n\n      if (!event.isDefaultPrevented()) {\n        event.stopPropagation();\n        createMention();\n      }\n    },\n    [createMention, onClick]\n  );\n\n  return (\n    <Tooltip content={tooltipLabel ?? label}>\n      <Button\n        className={cn(\"lb-composer-editor-action\", className)}\n        onPointerDown={preventDefault}\n        onClick={handleClick}\n        aria-label={label}\n        icon={<MentionIcon />}\n        {...props}\n      />\n    </Tooltip>\n  );\n}\n\nfunction ComposerInsertEmojiEditorAction({\n  label,\n  tooltipLabel,\n  onPickerOpenChange,\n  className,\n  ...props\n}: EmojiEditorActionProps) {\n  const { insertText } = useComposer();\n\n  const preventDefault = useCallback((event: SyntheticEvent) => {\n    event.preventDefault();\n  }, []);\n\n  const stopPropagation = useCallback((event: SyntheticEvent) => {\n    event.stopPropagation();\n  }, []);\n\n  return (\n    <EmojiPicker onEmojiSelect={insertText} onOpenChange={onPickerOpenChange}>\n      <Tooltip content={tooltipLabel ?? label}>\n        <EmojiPickerTrigger asChild>\n          <Button\n            className={cn(\"lb-composer-editor-action\", className)}\n            onPointerDown={preventDefault}\n            onClick={stopPropagation}\n            aria-label={label}\n            icon={<EmojiIcon />}\n            {...props}\n          />\n        </EmojiPickerTrigger>\n      </Tooltip>\n    </EmojiPicker>\n  );\n}\n\nfunction ComposerAttachFilesEditorAction({\n  label,\n  tooltipLabel,\n  className,\n  ...props\n}: EditorActionProps) {\n  const preventDefault = useCallback((event: SyntheticEvent) => {\n    event.preventDefault();\n  }, []);\n\n  const stopPropagation = useCallback((event: SyntheticEvent) => {\n    event.stopPropagation();\n  }, []);\n\n  return (\n    <Tooltip content={tooltipLabel ?? label}>\n      <ComposerPrimitive.AttachFiles asChild>\n        <Button\n          className={cn(\"lb-composer-editor-action\", className)}\n          onPointerDown={preventDefault}\n          onClick={stopPropagation}\n          aria-label={label}\n          icon={<AttachmentIcon />}\n          {...props}\n        />\n      </ComposerPrimitive.AttachFiles>\n    </Tooltip>\n  );\n}\n\nfunction ComposerUserMention({ mention }: ComposerMentionProps) {\n  return (\n    <ComposerPrimitive.Mention className=\"lb-mention lb-composer-mention\">\n      <span className=\"lb-mention-symbol\">{MENTION_CHARACTER}</span>\n      <User userId={mention.id} />\n    </ComposerPrimitive.Mention>\n  );\n}\n\nfunction ComposerGroupMention({ mention }: ComposerMentionProps) {\n  const isMember = useIsGroupMentionMember(mention as GroupMentionData);\n\n  return (\n    <ComposerPrimitive.Mention\n      className=\"lb-mention lb-composer-mention\"\n      data-self={isMember ? \"\" : undefined}\n    >\n      <span className=\"lb-mention-symbol\">{MENTION_CHARACTER}</span>\n      <Group groupId={mention.id} />\n    </ComposerPrimitive.Mention>\n  );\n}\n\nexport function ComposerMention({ mention, ...props }: ComposerMentionProps) {\n  switch (mention.kind) {\n    case \"user\":\n      return <ComposerUserMention mention={mention} {...props} />;\n\n    case \"group\":\n      return <ComposerGroupMention mention={mention} {...props} />;\n\n    default:\n      return assertNever(mention, \"Unhandled mention kind\");\n  }\n}\n\nfunction ComposerMentionSuggestions({\n  mentions,\n}: ComposerEditorMentionSuggestionsProps) {\n  return mentions.length > 0 ? (\n    <ComposerPrimitive.Suggestions className=\"lb-root lb-portal lb-elevation lb-composer-suggestions lb-composer-mention-suggestions\">\n      <ComposerPrimitive.SuggestionsList className=\"lb-composer-suggestions-list lb-composer-mention-suggestions-list\">\n        {mentions.map((mention) => {\n          return (\n            <ComposerPrimitive.SuggestionsListItem\n              key={mention.id}\n              className=\"lb-composer-suggestions-list-item lb-composer-mention-suggestion\"\n              value={mention.id}\n            >\n              {mention.kind === \"user\" ? (\n                <>\n                  <Avatar\n                    userId={mention.id}\n                    className=\"lb-composer-mention-suggestion-avatar\"\n                  />\n                  <User\n                    userId={mention.id}\n                    className=\"lb-composer-mention-suggestion-user\"\n                  />\n                </>\n              ) : mention.kind === \"group\" ? (\n                <>\n                  <Avatar\n                    groupId={mention.id}\n                    className=\"lb-composer-mention-suggestion-avatar\"\n                    icon={<UsersIcon />}\n                  />\n                  <Group\n                    groupId={mention.id}\n                    className=\"lb-composer-mention-suggestion-group\"\n                  >\n                    <GroupDescription\n                      groupId={mention.id}\n                      className=\"lb-composer-mention-suggestion-group-description\"\n                    />\n                  </Group>\n                </>\n              ) : (\n                assertNever(mention, \"Unhandled mention kind\")\n              )}\n            </ComposerPrimitive.SuggestionsListItem>\n          );\n        })}\n      </ComposerPrimitive.SuggestionsList>\n    </ComposerPrimitive.Suggestions>\n  ) : null;\n}\n\nfunction MarkToggle({\n  mark,\n  icon,\n  shortcut,\n  children,\n  ...props\n}: MarkToggleProps) {\n  const $ = useOverrides();\n  const label = useMemo(() => {\n    return $.COMPOSER_TOGGLE_MARK(mark);\n  }, [$, mark]);\n\n  return (\n    <ShortcutTooltip\n      content={label}\n      shortcut={shortcut}\n      sideOffset={FLOATING_ELEMENT_SIDE_OFFSET + 2}\n    >\n      <ComposerPrimitive.MarkToggle mark={mark} asChild {...props}>\n        <Button aria-label={label} variant=\"toolbar\" icon={icon}>\n          {children}\n        </Button>\n      </ComposerPrimitive.MarkToggle>\n    </ShortcutTooltip>\n  );\n}\n\ntype MarkToggles = {\n  [K in ComposerBodyMark]: ComponentType<PropsWithChildren>;\n};\n\nconst markToggles: MarkToggles = {\n  bold: () => <MarkToggle mark=\"bold\" shortcut=\"Mod-B\" icon={<BoldIcon />} />,\n  italic: () => (\n    <MarkToggle mark=\"italic\" shortcut=\"Mod-I\" icon={<ItalicIcon />} />\n  ),\n  strikethrough: () => (\n    <MarkToggle\n      mark=\"strikethrough\"\n      shortcut=\"Mod-Shift-S\"\n      icon={<StrikethroughIcon />}\n    />\n  ),\n  code: () => <MarkToggle mark=\"code\" shortcut=\"Mod-E\" icon={<CodeIcon />} />,\n};\n\nconst markTogglesList = Object.entries(markToggles).map(([mark, Toggle]) => (\n  <Toggle key={mark} />\n));\n\nfunction ComposerFloatingToolbar() {\n  return (\n    <ComposerPrimitive.FloatingToolbar className=\"lb-root lb-portal lb-elevation lb-composer-floating-toolbar\">\n      {markTogglesList}\n    </ComposerPrimitive.FloatingToolbar>\n  );\n}\n\nfunction ComposerLink({ href, children }: ComposerEditorLinkProps) {\n  return (\n    <ComposerPrimitive.Link href={href} className=\"lb-composer-link\">\n      {children}\n    </ComposerPrimitive.Link>\n  );\n}\n\ninterface ComposerAttachmentsProps extends ComponentPropsWithoutRef<\"div\"> {\n  overrides?: Partial<GlobalOverrides & ComposerOverrides>;\n}\n\ninterface ComposerFileAttachmentProps extends ComponentPropsWithoutRef<\"div\"> {\n  attachment: CommentMixedAttachment;\n  overrides?: Partial<GlobalOverrides & ComposerOverrides>;\n}\n\nfunction ComposerFileAttachment({\n  attachment,\n  className,\n  overrides,\n  ...props\n}: ComposerFileAttachmentProps) {\n  const { removeAttachment } = useComposer();\n  const { roomId } = useComposerEditorContext();\n\n  const handleDeleteClick = useCallback(() => {\n    removeAttachment(attachment.id);\n  }, [attachment.id, removeAttachment]);\n\n  return (\n    <FileAttachment\n      className={cn(\"lb-composer-attachment\", className)}\n      {...props}\n      attachment={attachment}\n      onDeleteClick={handleDeleteClick}\n      preventFocusOnDelete\n      overrides={overrides}\n      roomId={roomId}\n    />\n  );\n}\n\nfunction ComposerAttachments({\n  overrides,\n  className,\n  ...props\n}: ComposerAttachmentsProps) {\n  const { attachments } = useComposer();\n\n  if (attachments.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className={cn(\"lb-composer-attachments\", className)} {...props}>\n      <div className=\"lb-attachments\">\n        {attachments.map((attachment) => {\n          return (\n            <ComposerFileAttachment\n              key={attachment.id}\n              attachment={attachment}\n              overrides={overrides}\n            />\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nconst editorRequiredComponents: ComposerEditorComponents = {\n  Mention: ComposerMention,\n  MentionSuggestions: ComposerMentionSuggestions,\n  Link: ComposerLink,\n};\n\nfunction ComposerEditorContainer({\n  showAttachments = true,\n  showFormattingControls = true,\n  showAttribution,\n  defaultValue,\n  isCollapsed,\n  overrides,\n  actions,\n  autoFocus,\n  disabled,\n  hasResolveMentionSuggestions,\n  onEmojiPickerOpenChange,\n  onEmptyChange,\n  onEditorClick,\n}: ComposerEditorContainerProps) {\n  const { isEmpty } = useComposer();\n  const { hasMaxAttachments } = useComposerAttachmentsContext();\n  const $ = useOverrides(overrides);\n  const components = useMemo(() => {\n    return {\n      ...editorRequiredComponents,\n      FloatingToolbar: showFormattingControls\n        ? ComposerFloatingToolbar\n        : undefined,\n    };\n  }, [showFormattingControls]);\n\n  const [isDraggingOver, dropAreaProps] = useComposerAttachmentsDropArea({\n    disabled: disabled || !showAttachments || hasMaxAttachments,\n  });\n\n  useLayoutEffect(() => {\n    onEmptyChange(isEmpty);\n  }, [isEmpty, onEmptyChange]);\n\n  const preventDefault = useCallback((event: SyntheticEvent) => {\n    event.preventDefault();\n  }, []);\n\n  const stopPropagation = useCallback((event: SyntheticEvent) => {\n    event.stopPropagation();\n  }, []);\n\n  return (\n    <div className=\"lb-composer-editor-container\" {...dropAreaProps}>\n      <ComposerPrimitive.Editor\n        className=\"lb-composer-editor\"\n        onClick={onEditorClick}\n        placeholder={$.COMPOSER_PLACEHOLDER}\n        defaultValue={defaultValue}\n        autoFocus={autoFocus}\n        components={components}\n        disabled={disabled}\n        dir={$.dir}\n      />\n      {showAttachments && <ComposerAttachments overrides={overrides} />}\n      {(!isCollapsed || isDraggingOver) && (\n        <div className=\"lb-composer-footer\">\n          <div className=\"lb-composer-editor-actions\">\n            {hasResolveMentionSuggestions && (\n              <ComposerInsertMentionEditorAction\n                label={$.COMPOSER_INSERT_MENTION}\n                disabled={disabled}\n              />\n            )}\n            <ComposerInsertEmojiEditorAction\n              label={$.COMPOSER_INSERT_EMOJI}\n              onPickerOpenChange={onEmojiPickerOpenChange}\n              disabled={disabled}\n            />\n            {showAttachments && (\n              <ComposerAttachFilesEditorAction\n                label={$.COMPOSER_ATTACH_FILES}\n                disabled={disabled}\n              />\n            )}\n          </div>\n          {showAttribution && <Attribution />}\n          <div className=\"lb-composer-actions\">\n            {actions ?? (\n              <>\n                <ShortcutTooltip content={$.COMPOSER_SEND} shortcut=\"Enter\">\n                  <ComposerPrimitive.Submit asChild>\n                    <Button\n                      onPointerDown={preventDefault}\n                      onClick={stopPropagation}\n                      className=\"lb-composer-action\"\n                      variant=\"primary\"\n                      aria-label={$.COMPOSER_SEND}\n                      icon={<SendIcon />}\n                    />\n                  </ComposerPrimitive.Submit>\n                </ShortcutTooltip>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n      {showAttachments && isDraggingOver && (\n        <div className=\"lb-composer-attachments-drop-area\">\n          <div className=\"lb-composer-attachments-drop-area-label\">\n            <AttachmentIcon />\n            {$.COMPOSER_ATTACH_FILES}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport const ComposerRoomIdContext = createContext<string | null>(null);\n\n/**\n * Displays a composer to create comments.\n *\n * @example\n * <Composer />\n */\nexport const Composer = forwardRef(\n  <M extends BaseMetadata = DM>(\n    {\n      threadId,\n      commentId,\n      metadata,\n      defaultValue,\n      defaultAttachments,\n      onComposerSubmit,\n      collapsed: controlledCollapsed,\n      defaultCollapsed,\n      onCollapsedChange: controlledOnCollapsedChange,\n      overrides,\n      actions,\n      onBlur,\n      className,\n      onFocus,\n      autoFocus,\n      disabled,\n      blurOnSubmit = true,\n      showAttachments = true,\n      showFormattingControls = true,\n      showAttribution,\n      roomId: _roomId,\n      ...props\n    }: ComposerProps<M>,\n    forwardedRef: ForwardedRef<HTMLFormElement>\n  ) => {\n    const room = useRoom({ allowOutsideRoom: true });\n\n    const roomId = _roomId !== undefined ? _roomId : room?.id;\n    if (roomId === undefined) {\n      throw new Error(\n        \"Composer must be a descendant of RoomProvider component\"\n      );\n    }\n\n    const createThread = useCreateRoomThread(roomId);\n    const createComment = useCreateRoomComment(roomId);\n    const editComment = useEditRoomComment(roomId);\n    const { preventUnsavedComposerChanges } = useLiveblocksUiConfig();\n    const hasResolveMentionSuggestions =\n      useResolveMentionSuggestions() !== undefined;\n    const isEmptyRef = useRef(true);\n    const isEmojiPickerOpenRef = useRef(false);\n    const $ = useOverrides(overrides);\n    const [isCollapsed, onCollapsedChange] = useControllableState(\n      defaultCollapsed ?? false,\n      controlledCollapsed,\n      controlledOnCollapsedChange\n    );\n\n    const canCommentFallback = useSyncExternalStore(\n      useCallback(\n        (callback) => {\n          if (room === null) return () => {};\n          return room.events.self.subscribeOnce(callback);\n        },\n        [room]\n      ),\n      useCallback(() => {\n        return room?.getSelf()?.canComment ?? true;\n      }, [room]),\n      useCallback(() => true, [])\n    );\n\n    const permissions = useRoomPermissions(roomId);\n    const canComment =\n      permissions.size > 0\n        ? permissions.has(Permission.CommentsWrite) ||\n          permissions.has(Permission.Write)\n        : canCommentFallback;\n\n    const setEmptyRef = useCallback((isEmpty: boolean) => {\n      isEmptyRef.current = isEmpty;\n    }, []);\n\n    const setEmojiPickerOpenRef = useCallback((isEmojiPickerOpen: boolean) => {\n      isEmojiPickerOpenRef.current = isEmojiPickerOpen;\n    }, []);\n\n    const handleFocus = useCallback(\n      (event: FocusEvent<HTMLFormElement>) => {\n        onFocus?.(event);\n\n        if (event.isDefaultPrevented()) {\n          return;\n        }\n\n        if (isEmptyRef.current && canComment) {\n          onCollapsedChange?.(false);\n        }\n      },\n      [onCollapsedChange, onFocus, canComment]\n    );\n\n    const handleBlur = useCallback(\n      (event: FocusEvent<HTMLFormElement>) => {\n        onBlur?.(event);\n\n        if (event.isDefaultPrevented()) {\n          return;\n        }\n\n        const isOutside = !event.currentTarget.contains(\n          event.relatedTarget ?? document.activeElement\n        );\n\n        if (isOutside && isEmptyRef.current && !isEmojiPickerOpenRef.current) {\n          onCollapsedChange?.(true);\n        }\n      },\n      [onBlur, onCollapsedChange]\n    );\n\n    const handleEditorClick = useCallback(\n      (event: MouseEvent<HTMLDivElement>) => {\n        event.stopPropagation();\n\n        if (isEmptyRef.current && canComment) {\n          onCollapsedChange?.(false);\n        }\n      },\n      [onCollapsedChange, canComment]\n    );\n\n    const handleComposerSubmit = useCallback(\n      (comment: ComposerSubmitComment, event: FormEvent<HTMLFormElement>) => {\n        onComposerSubmit?.(comment, event);\n\n        if (event.isDefaultPrevented()) {\n          return;\n        }\n\n        event.stopPropagation();\n\n        if (commentId && threadId) {\n          editComment({\n            commentId,\n            threadId,\n            body: comment.body,\n            attachments: comment.attachments,\n          });\n        } else if (threadId) {\n          createComment({\n            threadId,\n            body: comment.body,\n            attachments: comment.attachments,\n          });\n        } else {\n          createThread({\n            body: comment.body,\n            metadata: metadata ?? {},\n            attachments: comment.attachments,\n          });\n        }\n      },\n      [\n        commentId,\n        createComment,\n        createThread,\n        editComment,\n        metadata,\n        onComposerSubmit,\n        threadId,\n      ]\n    );\n\n    return (\n      <TooltipProvider>\n        <ComposerPrimitive.Form\n          onComposerSubmit={handleComposerSubmit}\n          className={cn(\"lb-root lb-composer lb-composer-form\", className)}\n          dir={$.dir}\n          {...props}\n          ref={forwardedRef}\n          data-collapsed={isCollapsed ? \"\" : undefined}\n          onFocus={handleFocus}\n          onBlur={handleBlur}\n          disabled={disabled || !canComment}\n          defaultAttachments={defaultAttachments}\n          pasteFilesAsAttachments={showAttachments}\n          preventUnsavedChanges={preventUnsavedComposerChanges}\n          blurOnSubmit={blurOnSubmit}\n          roomId={roomId}\n        >\n          <ComposerEditorContainer\n            defaultValue={defaultValue}\n            actions={actions}\n            overrides={overrides}\n            isCollapsed={isCollapsed}\n            showAttachments={showAttachments}\n            showAttribution={showAttribution}\n            showFormattingControls={showFormattingControls}\n            hasResolveMentionSuggestions={hasResolveMentionSuggestions}\n            onEmptyChange={setEmptyRef}\n            onEmojiPickerOpenChange={setEmojiPickerOpenRef}\n            onEditorClick={handleEditorClick}\n            autoFocus={autoFocus}\n            disabled={disabled}\n          />\n        </ComposerPrimitive.Form>\n      </TooltipProvider>\n    );\n  }\n) as <M extends BaseMetadata = DM>(\n  props: ComposerProps<M> & RefAttributes<HTMLFormElement>\n) => JSX.Element;\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { composeRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport * as MenuPrimitive from '@radix-ui/react-menu';\nimport { createMenuScope } from '@radix-ui/react-menu';\nimport { useId } from '@radix-ui/react-id';\n\nimport type { Scope } from '@radix-ui/react-context';\n\ntype Direction = 'ltr' | 'rtl';\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenu\n * -----------------------------------------------------------------------------------------------*/\n\nconst DROPDOWN_MENU_NAME = 'DropdownMenu';\n\ntype ScopedProps<P> = P & { __scopeDropdownMenu?: Scope };\nconst [createDropdownMenuContext, createDropdownMenuScope] = createContextScope(\n  DROPDOWN_MENU_NAME,\n  [createMenuScope]\n);\nconst useMenuScope = createMenuScope();\n\ntype DropdownMenuContextValue = {\n  triggerId: string;\n  triggerRef: React.RefObject<HTMLButtonElement | null>;\n  contentId: string;\n  open: boolean;\n  onOpenChange(open: boolean): void;\n  onOpenToggle(): void;\n  modal: boolean;\n};\n\nconst [DropdownMenuProvider, useDropdownMenuContext] =\n  createDropdownMenuContext<DropdownMenuContextValue>(DROPDOWN_MENU_NAME);\n\ninterface DropdownMenuProps {\n  children?: React.ReactNode;\n  dir?: Direction;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?(open: boolean): void;\n  modal?: boolean;\n}\n\nconst DropdownMenu: React.FC<DropdownMenuProps> = (props: ScopedProps<DropdownMenuProps>) => {\n  const {\n    __scopeDropdownMenu,\n    children,\n    dir,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    modal = true,\n  } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  const triggerRef = React.useRef<HTMLButtonElement>(null);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen ?? false,\n    onChange: onOpenChange,\n    caller: DROPDOWN_MENU_NAME,\n  });\n\n  return (\n    <DropdownMenuProvider\n      scope={__scopeDropdownMenu}\n      triggerId={useId()}\n      triggerRef={triggerRef}\n      contentId={useId()}\n      open={open}\n      onOpenChange={setOpen}\n      onOpenToggle={React.useCallback(() => setOpen((prevOpen) => !prevOpen), [setOpen])}\n      modal={modal}\n    >\n      <MenuPrimitive.Root {...menuScope} open={open} onOpenChange={setOpen} dir={dir} modal={modal}>\n        {children}\n      </MenuPrimitive.Root>\n    </DropdownMenuProvider>\n  );\n};\n\nDropdownMenu.displayName = DROPDOWN_MENU_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRIGGER_NAME = 'DropdownMenuTrigger';\n\ntype DropdownMenuTriggerElement = React.ComponentRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = React.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface DropdownMenuTriggerProps extends PrimitiveButtonProps {}\n\nconst DropdownMenuTrigger = React.forwardRef<DropdownMenuTriggerElement, DropdownMenuTriggerProps>(\n  (props: ScopedProps<DropdownMenuTriggerProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, disabled = false, ...triggerProps } = props;\n    const context = useDropdownMenuContext(TRIGGER_NAME, __scopeDropdownMenu);\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return (\n      <MenuPrimitive.Anchor asChild {...menuScope}>\n        <Primitive.button\n          type=\"button\"\n          id={context.triggerId}\n          aria-haspopup=\"menu\"\n          aria-expanded={context.open}\n          aria-controls={context.open ? context.contentId : undefined}\n          data-state={context.open ? 'open' : 'closed'}\n          data-disabled={disabled ? '' : undefined}\n          disabled={disabled}\n          {...triggerProps}\n          ref={composeRefs(forwardedRef, context.triggerRef)}\n          onPointerDown={composeEventHandlers(props.onPointerDown, (event) => {\n            // only call handler if it's the left button (mousedown gets triggered by all mouse buttons)\n            // but not when the control key is pressed (avoiding MacOS right click)\n            if (!disabled && event.button === 0 && event.ctrlKey === false) {\n              context.onOpenToggle();\n              // prevent trigger focusing when opening\n              // this allows the content to be given focus without competition\n              if (!context.open) event.preventDefault();\n            }\n          })}\n          onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n            if (disabled) return;\n            if (['Enter', ' '].includes(event.key)) context.onOpenToggle();\n            if (event.key === 'ArrowDown') context.onOpenChange(true);\n            // prevent keydown from scrolling window / first focused item to execute\n            // that keydown (inadvertently closing the menu)\n            if (['Enter', ' ', 'ArrowDown'].includes(event.key)) event.preventDefault();\n          })}\n        />\n      </MenuPrimitive.Anchor>\n    );\n  }\n);\n\nDropdownMenuTrigger.displayName = TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'DropdownMenuPortal';\n\ntype MenuPortalProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.Portal>;\ninterface DropdownMenuPortalProps extends MenuPortalProps {}\n\nconst DropdownMenuPortal: React.FC<DropdownMenuPortalProps> = (\n  props: ScopedProps<DropdownMenuPortalProps>\n) => {\n  const { __scopeDropdownMenu, ...portalProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.Portal {...menuScope} {...portalProps} />;\n};\n\nDropdownMenuPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'DropdownMenuContent';\n\ntype DropdownMenuContentElement = React.ComponentRef<typeof MenuPrimitive.Content>;\ntype MenuContentProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.Content>;\ninterface DropdownMenuContentProps extends Omit<MenuContentProps, 'onEntryFocus'> {}\n\nconst DropdownMenuContent = React.forwardRef<DropdownMenuContentElement, DropdownMenuContentProps>(\n  (props: ScopedProps<DropdownMenuContentProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...contentProps } = props;\n    const context = useDropdownMenuContext(CONTENT_NAME, __scopeDropdownMenu);\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    const hasInteractedOutsideRef = React.useRef(false);\n\n    return (\n      <MenuPrimitive.Content\n        id={context.contentId}\n        aria-labelledby={context.triggerId}\n        {...menuScope}\n        {...contentProps}\n        ref={forwardedRef}\n        onCloseAutoFocus={composeEventHandlers(props.onCloseAutoFocus, (event) => {\n          if (!hasInteractedOutsideRef.current) context.triggerRef.current?.focus();\n          hasInteractedOutsideRef.current = false;\n          // Always prevent auto focus because we either focus manually or want user agent focus\n          event.preventDefault();\n        })}\n        onInteractOutside={composeEventHandlers(props.onInteractOutside, (event) => {\n          const originalEvent = event.detail.originalEvent as PointerEvent;\n          const ctrlLeftClick = originalEvent.button === 0 && originalEvent.ctrlKey === true;\n          const isRightClick = originalEvent.button === 2 || ctrlLeftClick;\n          if (!context.modal || isRightClick) hasInteractedOutsideRef.current = true;\n        })}\n        style={{\n          ...props.style,\n          // re-namespace exposed content custom properties\n          ...{\n            '--radix-dropdown-menu-content-transform-origin':\n              'var(--radix-popper-transform-origin)',\n            '--radix-dropdown-menu-content-available-width': 'var(--radix-popper-available-width)',\n            '--radix-dropdown-menu-content-available-height':\n              'var(--radix-popper-available-height)',\n            '--radix-dropdown-menu-trigger-width': 'var(--radix-popper-anchor-width)',\n            '--radix-dropdown-menu-trigger-height': 'var(--radix-popper-anchor-height)',\n          },\n        }}\n      />\n    );\n  }\n);\n\nDropdownMenuContent.displayName = CONTENT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst GROUP_NAME = 'DropdownMenuGroup';\n\ntype DropdownMenuGroupElement = React.ComponentRef<typeof MenuPrimitive.Group>;\ntype MenuGroupProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.Group>;\ninterface DropdownMenuGroupProps extends MenuGroupProps {}\n\nconst DropdownMenuGroup = React.forwardRef<DropdownMenuGroupElement, DropdownMenuGroupProps>(\n  (props: ScopedProps<DropdownMenuGroupProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...groupProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return <MenuPrimitive.Group {...menuScope} {...groupProps} ref={forwardedRef} />;\n  }\n);\n\nDropdownMenuGroup.displayName = GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuLabel\n * -----------------------------------------------------------------------------------------------*/\n\nconst LABEL_NAME = 'DropdownMenuLabel';\n\ntype DropdownMenuLabelElement = React.ComponentRef<typeof MenuPrimitive.Label>;\ntype MenuLabelProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.Label>;\ninterface DropdownMenuLabelProps extends MenuLabelProps {}\n\nconst DropdownMenuLabel = React.forwardRef<DropdownMenuLabelElement, DropdownMenuLabelProps>(\n  (props: ScopedProps<DropdownMenuLabelProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...labelProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return <MenuPrimitive.Label {...menuScope} {...labelProps} ref={forwardedRef} />;\n  }\n);\n\nDropdownMenuLabel.displayName = LABEL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_NAME = 'DropdownMenuItem';\n\ntype DropdownMenuItemElement = React.ComponentRef<typeof MenuPrimitive.Item>;\ntype MenuItemProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.Item>;\ninterface DropdownMenuItemProps extends MenuItemProps {}\n\nconst DropdownMenuItem = React.forwardRef<DropdownMenuItemElement, DropdownMenuItemProps>(\n  (props: ScopedProps<DropdownMenuItemProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...itemProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return <MenuPrimitive.Item {...menuScope} {...itemProps} ref={forwardedRef} />;\n  }\n);\n\nDropdownMenuItem.displayName = ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuCheckboxItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst CHECKBOX_ITEM_NAME = 'DropdownMenuCheckboxItem';\n\ntype DropdownMenuCheckboxItemElement = React.ComponentRef<typeof MenuPrimitive.CheckboxItem>;\ntype MenuCheckboxItemProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.CheckboxItem>;\ninterface DropdownMenuCheckboxItemProps extends MenuCheckboxItemProps {}\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  DropdownMenuCheckboxItemElement,\n  DropdownMenuCheckboxItemProps\n>((props: ScopedProps<DropdownMenuCheckboxItemProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...checkboxItemProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.CheckboxItem {...menuScope} {...checkboxItemProps} ref={forwardedRef} />;\n});\n\nDropdownMenuCheckboxItem.displayName = CHECKBOX_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuRadioGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_GROUP_NAME = 'DropdownMenuRadioGroup';\n\ntype DropdownMenuRadioGroupElement = React.ComponentRef<typeof MenuPrimitive.RadioGroup>;\ntype MenuRadioGroupProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.RadioGroup>;\ninterface DropdownMenuRadioGroupProps extends MenuRadioGroupProps {}\n\nconst DropdownMenuRadioGroup = React.forwardRef<\n  DropdownMenuRadioGroupElement,\n  DropdownMenuRadioGroupProps\n>((props: ScopedProps<DropdownMenuRadioGroupProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...radioGroupProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.RadioGroup {...menuScope} {...radioGroupProps} ref={forwardedRef} />;\n});\n\nDropdownMenuRadioGroup.displayName = RADIO_GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuRadioItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_ITEM_NAME = 'DropdownMenuRadioItem';\n\ntype DropdownMenuRadioItemElement = React.ComponentRef<typeof MenuPrimitive.RadioItem>;\ntype MenuRadioItemProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.RadioItem>;\ninterface DropdownMenuRadioItemProps extends MenuRadioItemProps {}\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  DropdownMenuRadioItemElement,\n  DropdownMenuRadioItemProps\n>((props: ScopedProps<DropdownMenuRadioItemProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...radioItemProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.RadioItem {...menuScope} {...radioItemProps} ref={forwardedRef} />;\n});\n\nDropdownMenuRadioItem.displayName = RADIO_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuItemIndicator\n * -----------------------------------------------------------------------------------------------*/\n\nconst INDICATOR_NAME = 'DropdownMenuItemIndicator';\n\ntype DropdownMenuItemIndicatorElement = React.ComponentRef<typeof MenuPrimitive.ItemIndicator>;\ntype MenuItemIndicatorProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.ItemIndicator>;\ninterface DropdownMenuItemIndicatorProps extends MenuItemIndicatorProps {}\n\nconst DropdownMenuItemIndicator = React.forwardRef<\n  DropdownMenuItemIndicatorElement,\n  DropdownMenuItemIndicatorProps\n>((props: ScopedProps<DropdownMenuItemIndicatorProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...itemIndicatorProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.ItemIndicator {...menuScope} {...itemIndicatorProps} ref={forwardedRef} />;\n});\n\nDropdownMenuItemIndicator.displayName = INDICATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuSeparator\n * -----------------------------------------------------------------------------------------------*/\n\nconst SEPARATOR_NAME = 'DropdownMenuSeparator';\n\ntype DropdownMenuSeparatorElement = React.ComponentRef<typeof MenuPrimitive.Separator>;\ntype MenuSeparatorProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.Separator>;\ninterface DropdownMenuSeparatorProps extends MenuSeparatorProps {}\n\nconst DropdownMenuSeparator = React.forwardRef<\n  DropdownMenuSeparatorElement,\n  DropdownMenuSeparatorProps\n>((props: ScopedProps<DropdownMenuSeparatorProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...separatorProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.Separator {...menuScope} {...separatorProps} ref={forwardedRef} />;\n});\n\nDropdownMenuSeparator.displayName = SEPARATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'DropdownMenuArrow';\n\ntype DropdownMenuArrowElement = React.ComponentRef<typeof MenuPrimitive.Arrow>;\ntype MenuArrowProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.Arrow>;\ninterface DropdownMenuArrowProps extends MenuArrowProps {}\n\nconst DropdownMenuArrow = React.forwardRef<DropdownMenuArrowElement, DropdownMenuArrowProps>(\n  (props: ScopedProps<DropdownMenuArrowProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...arrowProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return <MenuPrimitive.Arrow {...menuScope} {...arrowProps} ref={forwardedRef} />;\n  }\n);\n\nDropdownMenuArrow.displayName = ARROW_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuSub\n * -----------------------------------------------------------------------------------------------*/\n\ninterface DropdownMenuSubProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?(open: boolean): void;\n}\n\nconst DropdownMenuSub: React.FC<DropdownMenuSubProps> = (\n  props: ScopedProps<DropdownMenuSubProps>\n) => {\n  const { __scopeDropdownMenu, children, open: openProp, onOpenChange, defaultOpen } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen ?? false,\n    onChange: onOpenChange,\n    caller: 'DropdownMenuSub',\n  });\n\n  return (\n    <MenuPrimitive.Sub {...menuScope} open={open} onOpenChange={setOpen}>\n      {children}\n    </MenuPrimitive.Sub>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuSubTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_TRIGGER_NAME = 'DropdownMenuSubTrigger';\n\ntype DropdownMenuSubTriggerElement = React.ComponentRef<typeof MenuPrimitive.SubTrigger>;\ntype MenuSubTriggerProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.SubTrigger>;\ninterface DropdownMenuSubTriggerProps extends MenuSubTriggerProps {}\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  DropdownMenuSubTriggerElement,\n  DropdownMenuSubTriggerProps\n>((props: ScopedProps<DropdownMenuSubTriggerProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...subTriggerProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.SubTrigger {...menuScope} {...subTriggerProps} ref={forwardedRef} />;\n});\n\nDropdownMenuSubTrigger.displayName = SUB_TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuSubContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_CONTENT_NAME = 'DropdownMenuSubContent';\n\ntype DropdownMenuSubContentElement = React.ComponentRef<typeof MenuPrimitive.Content>;\ntype MenuSubContentProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.SubContent>;\ninterface DropdownMenuSubContentProps extends MenuSubContentProps {}\n\nconst DropdownMenuSubContent = React.forwardRef<\n  DropdownMenuSubContentElement,\n  DropdownMenuSubContentProps\n>((props: ScopedProps<DropdownMenuSubContentProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...subContentProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n\n  return (\n    <MenuPrimitive.SubContent\n      {...menuScope}\n      {...subContentProps}\n      ref={forwardedRef}\n      style={{\n        ...props.style,\n        // re-namespace exposed content custom properties\n        ...{\n          '--radix-dropdown-menu-content-transform-origin': 'var(--radix-popper-transform-origin)',\n          '--radix-dropdown-menu-content-available-width': 'var(--radix-popper-available-width)',\n          '--radix-dropdown-menu-content-available-height': 'var(--radix-popper-available-height)',\n          '--radix-dropdown-menu-trigger-width': 'var(--radix-popper-anchor-width)',\n          '--radix-dropdown-menu-trigger-height': 'var(--radix-popper-anchor-height)',\n        },\n      }}\n    />\n  );\n});\n\nDropdownMenuSubContent.displayName = SUB_CONTENT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = DropdownMenu;\nconst Trigger = DropdownMenuTrigger;\nconst Portal = DropdownMenuPortal;\nconst Content = DropdownMenuContent;\nconst Group = DropdownMenuGroup;\nconst Label = DropdownMenuLabel;\nconst Item = DropdownMenuItem;\nconst CheckboxItem = DropdownMenuCheckboxItem;\nconst RadioGroup = DropdownMenuRadioGroup;\nconst RadioItem = DropdownMenuRadioItem;\nconst ItemIndicator = DropdownMenuItemIndicator;\nconst Separator = DropdownMenuSeparator;\nconst Arrow = DropdownMenuArrow;\nconst Sub = DropdownMenuSub;\nconst SubTrigger = DropdownMenuSubTrigger;\nconst SubContent = DropdownMenuSubContent;\n\nexport {\n  createDropdownMenuScope,\n  //\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuPortal,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuLabel,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioGroup,\n  DropdownMenuRadioItem,\n  DropdownMenuItemIndicator,\n  DropdownMenuSeparator,\n  DropdownMenuArrow,\n  DropdownMenuSub,\n  DropdownMenuSubTrigger,\n  DropdownMenuSubContent,\n  //\n  Root,\n  Trigger,\n  Portal,\n  Content,\n  Group,\n  Label,\n  Item,\n  CheckboxItem,\n  RadioGroup,\n  RadioItem,\n  ItemIndicator,\n  Separator,\n  Arrow,\n  Sub,\n  SubTrigger,\n  SubContent,\n};\nexport type {\n  DropdownMenuProps,\n  DropdownMenuTriggerProps,\n  DropdownMenuPortalProps,\n  DropdownMenuContentProps,\n  DropdownMenuGroupProps,\n  DropdownMenuLabelProps,\n  DropdownMenuItemProps,\n  DropdownMenuCheckboxItemProps,\n  DropdownMenuRadioGroupProps,\n  DropdownMenuRadioItemProps,\n  DropdownMenuItemIndicatorProps,\n  DropdownMenuSeparatorProps,\n  DropdownMenuArrowProps,\n  DropdownMenuSubProps,\n  DropdownMenuSubTriggerProps,\n  DropdownMenuSubContentProps,\n};\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { createCollection } from '@radix-ui/react-collection';\nimport { useComposedRefs, composeRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useDirection } from '@radix-ui/react-direction';\nimport { DismissableLayer } from '@radix-ui/react-dismissable-layer';\nimport { useFocusGuards } from '@radix-ui/react-focus-guards';\nimport { FocusScope } from '@radix-ui/react-focus-scope';\nimport { useId } from '@radix-ui/react-id';\nimport * as PopperPrimitive from '@radix-ui/react-popper';\nimport { createPopperScope } from '@radix-ui/react-popper';\nimport { Portal as PortalPrimitive } from '@radix-ui/react-portal';\nimport { Presence } from '@radix-ui/react-presence';\nimport { Primitive, dispatchDiscreteCustomEvent } from '@radix-ui/react-primitive';\nimport * as RovingFocusGroup from '@radix-ui/react-roving-focus';\nimport { createRovingFocusGroupScope } from '@radix-ui/react-roving-focus';\nimport { createSlot } from '@radix-ui/react-slot';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { hideOthers } from 'aria-hidden';\nimport { RemoveScroll } from 'react-remove-scroll';\n\nimport type { Scope } from '@radix-ui/react-context';\n\ntype Direction = 'ltr' | 'rtl';\n\nconst SELECTION_KEYS = ['Enter', ' '];\nconst FIRST_KEYS = ['ArrowDown', 'PageUp', 'Home'];\nconst LAST_KEYS = ['ArrowUp', 'PageDown', 'End'];\nconst FIRST_LAST_KEYS = [...FIRST_KEYS, ...LAST_KEYS];\nconst SUB_OPEN_KEYS: Record<Direction, string[]> = {\n  ltr: [...SELECTION_KEYS, 'ArrowRight'],\n  rtl: [...SELECTION_KEYS, 'ArrowLeft'],\n};\nconst SUB_CLOSE_KEYS: Record<Direction, string[]> = {\n  ltr: ['ArrowLeft'],\n  rtl: ['ArrowRight'],\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Menu\n * -----------------------------------------------------------------------------------------------*/\n\nconst MENU_NAME = 'Menu';\n\ntype ItemData = { disabled: boolean; textValue: string };\nconst [Collection, useCollection, createCollectionScope] = createCollection<\n  MenuItemElement,\n  ItemData\n>(MENU_NAME);\n\ntype ScopedProps<P> = P & { __scopeMenu?: Scope };\nconst [createMenuContext, createMenuScope] = createContextScope(MENU_NAME, [\n  createCollectionScope,\n  createPopperScope,\n  createRovingFocusGroupScope,\n]);\nconst usePopperScope = createPopperScope();\nconst useRovingFocusGroupScope = createRovingFocusGroupScope();\n\ntype MenuContextValue = {\n  open: boolean;\n  onOpenChange(open: boolean): void;\n  content: MenuContentElement | null;\n  onContentChange(content: MenuContentElement | null): void;\n};\n\nconst [MenuProvider, useMenuContext] = createMenuContext<MenuContextValue>(MENU_NAME);\n\ntype MenuRootContextValue = {\n  onClose(): void;\n  isUsingKeyboardRef: React.RefObject<boolean>;\n  dir: Direction;\n  modal: boolean;\n};\n\nconst [MenuRootProvider, useMenuRootContext] = createMenuContext<MenuRootContextValue>(MENU_NAME);\n\ninterface MenuProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  onOpenChange?(open: boolean): void;\n  dir?: Direction;\n  modal?: boolean;\n}\n\nconst Menu: React.FC<MenuProps> = (props: ScopedProps<MenuProps>) => {\n  const { __scopeMenu, open = false, children, dir, onOpenChange, modal = true } = props;\n  const popperScope = usePopperScope(__scopeMenu);\n  const [content, setContent] = React.useState<MenuContentElement | null>(null);\n  const isUsingKeyboardRef = React.useRef(false);\n  const handleOpenChange = useCallbackRef(onOpenChange);\n  const direction = useDirection(dir);\n\n  React.useEffect(() => {\n    // Capture phase ensures we set the boolean before any side effects execute\n    // in response to the key or pointer event as they might depend on this value.\n    const handleKeyDown = () => {\n      isUsingKeyboardRef.current = true;\n      document.addEventListener('pointerdown', handlePointer, { capture: true, once: true });\n      document.addEventListener('pointermove', handlePointer, { capture: true, once: true });\n    };\n    const handlePointer = () => (isUsingKeyboardRef.current = false);\n    document.addEventListener('keydown', handleKeyDown, { capture: true });\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown, { capture: true });\n      document.removeEventListener('pointerdown', handlePointer, { capture: true });\n      document.removeEventListener('pointermove', handlePointer, { capture: true });\n    };\n  }, []);\n\n  return (\n    <PopperPrimitive.Root {...popperScope}>\n      <MenuProvider\n        scope={__scopeMenu}\n        open={open}\n        onOpenChange={handleOpenChange}\n        content={content}\n        onContentChange={setContent}\n      >\n        <MenuRootProvider\n          scope={__scopeMenu}\n          onClose={React.useCallback(() => handleOpenChange(false), [handleOpenChange])}\n          isUsingKeyboardRef={isUsingKeyboardRef}\n          dir={direction}\n          modal={modal}\n        >\n          {children}\n        </MenuRootProvider>\n      </MenuProvider>\n    </PopperPrimitive.Root>\n  );\n};\n\nMenu.displayName = MENU_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuAnchor\n * -----------------------------------------------------------------------------------------------*/\n\nconst ANCHOR_NAME = 'MenuAnchor';\n\ntype MenuAnchorElement = React.ComponentRef<typeof PopperPrimitive.Anchor>;\ntype PopperAnchorProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Anchor>;\ninterface MenuAnchorProps extends PopperAnchorProps {}\n\nconst MenuAnchor = React.forwardRef<MenuAnchorElement, MenuAnchorProps>(\n  (props: ScopedProps<MenuAnchorProps>, forwardedRef) => {\n    const { __scopeMenu, ...anchorProps } = props;\n    const popperScope = usePopperScope(__scopeMenu);\n    return <PopperPrimitive.Anchor {...popperScope} {...anchorProps} ref={forwardedRef} />;\n  }\n);\n\nMenuAnchor.displayName = ANCHOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'MenuPortal';\n\ntype PortalContextValue = { forceMount?: true };\nconst [PortalProvider, usePortalContext] = createMenuContext<PortalContextValue>(PORTAL_NAME, {\n  forceMount: undefined,\n});\n\ntype PortalProps = React.ComponentPropsWithoutRef<typeof PortalPrimitive>;\ninterface MenuPortalProps {\n  children?: React.ReactNode;\n  /**\n   * Specify a container element to portal the content into.\n   */\n  container?: PortalProps['container'];\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst MenuPortal: React.FC<MenuPortalProps> = (props: ScopedProps<MenuPortalProps>) => {\n  const { __scopeMenu, forceMount, children, container } = props;\n  const context = useMenuContext(PORTAL_NAME, __scopeMenu);\n  return (\n    <PortalProvider scope={__scopeMenu} forceMount={forceMount}>\n      <Presence present={forceMount || context.open}>\n        <PortalPrimitive asChild container={container}>\n          {children}\n        </PortalPrimitive>\n      </Presence>\n    </PortalProvider>\n  );\n};\n\nMenuPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'MenuContent';\n\ntype MenuContentContextValue = {\n  onItemEnter(event: React.PointerEvent): void;\n  onItemLeave(event: React.PointerEvent): void;\n  onTriggerLeave(event: React.PointerEvent): void;\n  searchRef: React.RefObject<string>;\n  pointerGraceTimerRef: React.MutableRefObject<number>;\n  onPointerGraceIntentChange(intent: GraceIntent | null): void;\n};\nconst [MenuContentProvider, useMenuContentContext] =\n  createMenuContext<MenuContentContextValue>(CONTENT_NAME);\n\ntype MenuContentElement = MenuRootContentTypeElement;\n/**\n * We purposefully don't union MenuRootContent and MenuSubContent props here because\n * they have conflicting prop types. We agreed that we would allow MenuSubContent to\n * accept props that it would just ignore.\n */\ninterface MenuContentProps extends MenuRootContentTypeProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst MenuContent = React.forwardRef<MenuContentElement, MenuContentProps>(\n  (props: ScopedProps<MenuContentProps>, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopeMenu);\n    const { forceMount = portalContext.forceMount, ...contentProps } = props;\n    const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n    const rootContext = useMenuRootContext(CONTENT_NAME, props.__scopeMenu);\n\n    return (\n      <Collection.Provider scope={props.__scopeMenu}>\n        <Presence present={forceMount || context.open}>\n          <Collection.Slot scope={props.__scopeMenu}>\n            {rootContext.modal ? (\n              <MenuRootContentModal {...contentProps} ref={forwardedRef} />\n            ) : (\n              <MenuRootContentNonModal {...contentProps} ref={forwardedRef} />\n            )}\n          </Collection.Slot>\n        </Presence>\n      </Collection.Provider>\n    );\n  }\n);\n\n/* ---------------------------------------------------------------------------------------------- */\n\ntype MenuRootContentTypeElement = MenuContentImplElement;\ninterface MenuRootContentTypeProps\n  extends Omit<MenuContentImplProps, keyof MenuContentImplPrivateProps> {}\n\nconst MenuRootContentModal = React.forwardRef<MenuRootContentTypeElement, MenuRootContentTypeProps>(\n  (props: ScopedProps<MenuRootContentTypeProps>, forwardedRef) => {\n    const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n    const ref = React.useRef<MenuRootContentTypeElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n\n    // Hide everything from ARIA except the `MenuContent`\n    React.useEffect(() => {\n      const content = ref.current;\n      if (content) return hideOthers(content);\n    }, []);\n\n    return (\n      <MenuContentImpl\n        {...props}\n        ref={composedRefs}\n        // we make sure we're not trapping once it's been closed\n        // (closed !== unmounted when animating out)\n        trapFocus={context.open}\n        // make sure to only disable pointer events when open\n        // this avoids blocking interactions while animating out\n        disableOutsidePointerEvents={context.open}\n        disableOutsideScroll\n        // When focus is trapped, a `focusout` event may still happen.\n        // We make sure we don't trigger our `onDismiss` in such case.\n        onFocusOutside={composeEventHandlers(\n          props.onFocusOutside,\n          (event) => event.preventDefault(),\n          { checkForDefaultPrevented: false }\n        )}\n        onDismiss={() => context.onOpenChange(false)}\n      />\n    );\n  }\n);\n\nconst MenuRootContentNonModal = React.forwardRef<\n  MenuRootContentTypeElement,\n  MenuRootContentTypeProps\n>((props: ScopedProps<MenuRootContentTypeProps>, forwardedRef) => {\n  const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n  return (\n    <MenuContentImpl\n      {...props}\n      ref={forwardedRef}\n      trapFocus={false}\n      disableOutsidePointerEvents={false}\n      disableOutsideScroll={false}\n      onDismiss={() => context.onOpenChange(false)}\n    />\n  );\n});\n\n/* ---------------------------------------------------------------------------------------------- */\n\ntype MenuContentImplElement = React.ComponentRef<typeof PopperPrimitive.Content>;\ntype FocusScopeProps = React.ComponentPropsWithoutRef<typeof FocusScope>;\ntype DismissableLayerProps = React.ComponentPropsWithoutRef<typeof DismissableLayer>;\ntype RovingFocusGroupProps = React.ComponentPropsWithoutRef<typeof RovingFocusGroup.Root>;\ntype PopperContentProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Content>;\ntype MenuContentImplPrivateProps = {\n  onOpenAutoFocus?: FocusScopeProps['onMountAutoFocus'];\n  onDismiss?: DismissableLayerProps['onDismiss'];\n  disableOutsidePointerEvents?: DismissableLayerProps['disableOutsidePointerEvents'];\n\n  /**\n   * Whether scrolling outside the `MenuContent` should be prevented\n   * (default: `false`)\n   */\n  disableOutsideScroll?: boolean;\n\n  /**\n   * Whether focus should be trapped within the `MenuContent`\n   * (default: false)\n   */\n  trapFocus?: FocusScopeProps['trapped'];\n};\ninterface MenuContentImplProps\n  extends MenuContentImplPrivateProps,\n    Omit<PopperContentProps, 'dir' | 'onPlaced'> {\n  /**\n   * Event handler called when auto-focusing on close.\n   * Can be prevented.\n   */\n  onCloseAutoFocus?: FocusScopeProps['onUnmountAutoFocus'];\n\n  /**\n   * Whether keyboard navigation should loop around\n   * @defaultValue false\n   */\n  loop?: RovingFocusGroupProps['loop'];\n\n  onEntryFocus?: RovingFocusGroupProps['onEntryFocus'];\n  onEscapeKeyDown?: DismissableLayerProps['onEscapeKeyDown'];\n  onPointerDownOutside?: DismissableLayerProps['onPointerDownOutside'];\n  onFocusOutside?: DismissableLayerProps['onFocusOutside'];\n  onInteractOutside?: DismissableLayerProps['onInteractOutside'];\n}\n\nconst Slot = createSlot('MenuContent.ScrollLock');\n\nconst MenuContentImpl = React.forwardRef<MenuContentImplElement, MenuContentImplProps>(\n  (props: ScopedProps<MenuContentImplProps>, forwardedRef) => {\n    const {\n      __scopeMenu,\n      loop = false,\n      trapFocus,\n      onOpenAutoFocus,\n      onCloseAutoFocus,\n      disableOutsidePointerEvents,\n      onEntryFocus,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      onFocusOutside,\n      onInteractOutside,\n      onDismiss,\n      disableOutsideScroll,\n      ...contentProps\n    } = props;\n    const context = useMenuContext(CONTENT_NAME, __scopeMenu);\n    const rootContext = useMenuRootContext(CONTENT_NAME, __scopeMenu);\n    const popperScope = usePopperScope(__scopeMenu);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenu);\n    const getItems = useCollection(__scopeMenu);\n    const [currentItemId, setCurrentItemId] = React.useState<string | null>(null);\n    const contentRef = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef, context.onContentChange);\n    const timerRef = React.useRef(0);\n    const searchRef = React.useRef('');\n    const pointerGraceTimerRef = React.useRef(0);\n    const pointerGraceIntentRef = React.useRef<GraceIntent | null>(null);\n    const pointerDirRef = React.useRef<Side>('right');\n    const lastPointerXRef = React.useRef(0);\n\n    const ScrollLockWrapper = disableOutsideScroll ? RemoveScroll : React.Fragment;\n    const scrollLockWrapperProps = disableOutsideScroll\n      ? { as: Slot, allowPinchZoom: true }\n      : undefined;\n\n    const handleTypeaheadSearch = (key: string) => {\n      const search = searchRef.current + key;\n      const items = getItems().filter((item) => !item.disabled);\n      const currentItem = document.activeElement;\n      const currentMatch = items.find((item) => item.ref.current === currentItem)?.textValue;\n      const values = items.map((item) => item.textValue);\n      const nextMatch = getNextMatch(values, search, currentMatch);\n      const newItem = items.find((item) => item.textValue === nextMatch)?.ref.current;\n\n      // Reset `searchRef` 1 second after it was last updated\n      (function updateSearch(value: string) {\n        searchRef.current = value;\n        window.clearTimeout(timerRef.current);\n        if (value !== '') timerRef.current = window.setTimeout(() => updateSearch(''), 1000);\n      })(search);\n\n      if (newItem) {\n        /**\n         * Imperative focus during keydown is risky so we prevent React's batching updates\n         * to avoid potential bugs. See: https://github.com/facebook/react/issues/20332\n         */\n        setTimeout(() => (newItem as HTMLElement).focus());\n      }\n    };\n\n    React.useEffect(() => {\n      return () => window.clearTimeout(timerRef.current);\n    }, []);\n\n    // Make sure the whole tree has focus guards as our `MenuContent` may be\n    // the last element in the DOM (because of the `Portal`)\n    useFocusGuards();\n\n    const isPointerMovingToSubmenu = React.useCallback((event: React.PointerEvent) => {\n      const isMovingTowards = pointerDirRef.current === pointerGraceIntentRef.current?.side;\n      return isMovingTowards && isPointerInGraceArea(event, pointerGraceIntentRef.current?.area);\n    }, []);\n\n    return (\n      <MenuContentProvider\n        scope={__scopeMenu}\n        searchRef={searchRef}\n        onItemEnter={React.useCallback(\n          (event) => {\n            if (isPointerMovingToSubmenu(event)) event.preventDefault();\n          },\n          [isPointerMovingToSubmenu]\n        )}\n        onItemLeave={React.useCallback(\n          (event) => {\n            if (isPointerMovingToSubmenu(event)) return;\n            contentRef.current?.focus();\n            setCurrentItemId(null);\n          },\n          [isPointerMovingToSubmenu]\n        )}\n        onTriggerLeave={React.useCallback(\n          (event) => {\n            if (isPointerMovingToSubmenu(event)) event.preventDefault();\n          },\n          [isPointerMovingToSubmenu]\n        )}\n        pointerGraceTimerRef={pointerGraceTimerRef}\n        onPointerGraceIntentChange={React.useCallback((intent) => {\n          pointerGraceIntentRef.current = intent;\n        }, [])}\n      >\n        <ScrollLockWrapper {...scrollLockWrapperProps}>\n          <FocusScope\n            asChild\n            trapped={trapFocus}\n            onMountAutoFocus={composeEventHandlers(onOpenAutoFocus, (event) => {\n              // when opening, explicitly focus the content area only and leave\n              // `onEntryFocus` in  control of focusing first item\n              event.preventDefault();\n              contentRef.current?.focus({ preventScroll: true });\n            })}\n            onUnmountAutoFocus={onCloseAutoFocus}\n          >\n            <DismissableLayer\n              asChild\n              disableOutsidePointerEvents={disableOutsidePointerEvents}\n              onEscapeKeyDown={onEscapeKeyDown}\n              onPointerDownOutside={onPointerDownOutside}\n              onFocusOutside={onFocusOutside}\n              onInteractOutside={onInteractOutside}\n              onDismiss={onDismiss}\n            >\n              <RovingFocusGroup.Root\n                asChild\n                {...rovingFocusGroupScope}\n                dir={rootContext.dir}\n                orientation=\"vertical\"\n                loop={loop}\n                currentTabStopId={currentItemId}\n                onCurrentTabStopIdChange={setCurrentItemId}\n                onEntryFocus={composeEventHandlers(onEntryFocus, (event) => {\n                  // only focus first item when using keyboard\n                  if (!rootContext.isUsingKeyboardRef.current) event.preventDefault();\n                })}\n                preventScrollOnEntryFocus\n              >\n                <PopperPrimitive.Content\n                  role=\"menu\"\n                  aria-orientation=\"vertical\"\n                  data-state={getOpenState(context.open)}\n                  data-radix-menu-content=\"\"\n                  dir={rootContext.dir}\n                  {...popperScope}\n                  {...contentProps}\n                  ref={composedRefs}\n                  style={{ outline: 'none', ...contentProps.style }}\n                  onKeyDown={composeEventHandlers(contentProps.onKeyDown, (event) => {\n                    // submenu key events bubble through portals. We only care about keys in this menu.\n                    const target = event.target as HTMLElement;\n                    const isKeyDownInside =\n                      target.closest('[data-radix-menu-content]') === event.currentTarget;\n                    const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;\n                    const isCharacterKey = event.key.length === 1;\n                    if (isKeyDownInside) {\n                      // menus should not be navigated using tab key so we prevent it\n                      if (event.key === 'Tab') event.preventDefault();\n                      if (!isModifierKey && isCharacterKey) handleTypeaheadSearch(event.key);\n                    }\n                    // focus first/last item based on key pressed\n                    const content = contentRef.current;\n                    if (event.target !== content) return;\n                    if (!FIRST_LAST_KEYS.includes(event.key)) return;\n                    event.preventDefault();\n                    const items = getItems().filter((item) => !item.disabled);\n                    const candidateNodes = items.map((item) => item.ref.current!);\n                    if (LAST_KEYS.includes(event.key)) candidateNodes.reverse();\n                    focusFirst(candidateNodes);\n                  })}\n                  onBlur={composeEventHandlers(props.onBlur, (event) => {\n                    // clear search buffer when leaving the menu\n                    if (!event.currentTarget.contains(event.target)) {\n                      window.clearTimeout(timerRef.current);\n                      searchRef.current = '';\n                    }\n                  })}\n                  onPointerMove={composeEventHandlers(\n                    props.onPointerMove,\n                    whenMouse((event) => {\n                      const target = event.target as HTMLElement;\n                      const pointerXHasChanged = lastPointerXRef.current !== event.clientX;\n\n                      // We don't use `event.movementX` for this check because Safari will\n                      // always return `0` on a pointer event.\n                      if (event.currentTarget.contains(target) && pointerXHasChanged) {\n                        const newDir = event.clientX > lastPointerXRef.current ? 'right' : 'left';\n                        pointerDirRef.current = newDir;\n                        lastPointerXRef.current = event.clientX;\n                      }\n                    })\n                  )}\n                />\n              </RovingFocusGroup.Root>\n            </DismissableLayer>\n          </FocusScope>\n        </ScrollLockWrapper>\n      </MenuContentProvider>\n    );\n  }\n);\n\nMenuContent.displayName = CONTENT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst GROUP_NAME = 'MenuGroup';\n\ntype MenuGroupElement = React.ComponentRef<typeof Primitive.div>;\ntype PrimitiveDivProps = React.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface MenuGroupProps extends PrimitiveDivProps {}\n\nconst MenuGroup = React.forwardRef<MenuGroupElement, MenuGroupProps>(\n  (props: ScopedProps<MenuGroupProps>, forwardedRef) => {\n    const { __scopeMenu, ...groupProps } = props;\n    return <Primitive.div role=\"group\" {...groupProps} ref={forwardedRef} />;\n  }\n);\n\nMenuGroup.displayName = GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuLabel\n * -----------------------------------------------------------------------------------------------*/\n\nconst LABEL_NAME = 'MenuLabel';\n\ntype MenuLabelElement = React.ComponentRef<typeof Primitive.div>;\ninterface MenuLabelProps extends PrimitiveDivProps {}\n\nconst MenuLabel = React.forwardRef<MenuLabelElement, MenuLabelProps>(\n  (props: ScopedProps<MenuLabelProps>, forwardedRef) => {\n    const { __scopeMenu, ...labelProps } = props;\n    return <Primitive.div {...labelProps} ref={forwardedRef} />;\n  }\n);\n\nMenuLabel.displayName = LABEL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_NAME = 'MenuItem';\nconst ITEM_SELECT = 'menu.itemSelect';\n\ntype MenuItemElement = MenuItemImplElement;\ninterface MenuItemProps extends Omit<MenuItemImplProps, 'onSelect'> {\n  onSelect?: (event: Event) => void;\n}\n\nconst MenuItem = React.forwardRef<MenuItemElement, MenuItemProps>(\n  (props: ScopedProps<MenuItemProps>, forwardedRef) => {\n    const { disabled = false, onSelect, ...itemProps } = props;\n    const ref = React.useRef<HTMLDivElement>(null);\n    const rootContext = useMenuRootContext(ITEM_NAME, props.__scopeMenu);\n    const contentContext = useMenuContentContext(ITEM_NAME, props.__scopeMenu);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    const isPointerDownRef = React.useRef(false);\n\n    const handleSelect = () => {\n      const menuItem = ref.current;\n      if (!disabled && menuItem) {\n        const itemSelectEvent = new CustomEvent(ITEM_SELECT, { bubbles: true, cancelable: true });\n        menuItem.addEventListener(ITEM_SELECT, (event) => onSelect?.(event), { once: true });\n        dispatchDiscreteCustomEvent(menuItem, itemSelectEvent);\n        if (itemSelectEvent.defaultPrevented) {\n          isPointerDownRef.current = false;\n        } else {\n          rootContext.onClose();\n        }\n      }\n    };\n\n    return (\n      <MenuItemImpl\n        {...itemProps}\n        ref={composedRefs}\n        disabled={disabled}\n        onClick={composeEventHandlers(props.onClick, handleSelect)}\n        onPointerDown={(event) => {\n          props.onPointerDown?.(event);\n          isPointerDownRef.current = true;\n        }}\n        onPointerUp={composeEventHandlers(props.onPointerUp, (event) => {\n          // Pointer down can move to a different menu item which should activate it on pointer up.\n          // We dispatch a click for selection to allow composition with click based triggers and to\n          // prevent Firefox from getting stuck in text selection mode when the menu closes.\n          if (!isPointerDownRef.current) event.currentTarget?.click();\n        })}\n        onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n          const isTypingAhead = contentContext.searchRef.current !== '';\n          if (disabled || (isTypingAhead && event.key === ' ')) return;\n          if (SELECTION_KEYS.includes(event.key)) {\n            event.currentTarget.click();\n            /**\n             * We prevent default browser behaviour for selection keys as they should trigger\n             * a selection only:\n             * - prevents space from scrolling the page.\n             * - if keydown causes focus to move, prevents keydown from firing on the new target.\n             */\n            event.preventDefault();\n          }\n        })}\n      />\n    );\n  }\n);\n\nMenuItem.displayName = ITEM_NAME;\n\n/* ---------------------------------------------------------------------------------------------- */\n\ntype MenuItemImplElement = React.ComponentRef<typeof Primitive.div>;\ninterface MenuItemImplProps extends PrimitiveDivProps {\n  disabled?: boolean;\n  textValue?: string;\n}\n\nconst MenuItemImpl = React.forwardRef<MenuItemImplElement, MenuItemImplProps>(\n  (props: ScopedProps<MenuItemImplProps>, forwardedRef) => {\n    const { __scopeMenu, disabled = false, textValue, ...itemProps } = props;\n    const contentContext = useMenuContentContext(ITEM_NAME, __scopeMenu);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenu);\n    const ref = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    const [isFocused, setIsFocused] = React.useState(false);\n\n    // get the item's `.textContent` as default strategy for typeahead `textValue`\n    const [textContent, setTextContent] = React.useState('');\n    React.useEffect(() => {\n      const menuItem = ref.current;\n      if (menuItem) {\n        setTextContent((menuItem.textContent ?? '').trim());\n      }\n    }, [itemProps.children]);\n\n    return (\n      <Collection.ItemSlot\n        scope={__scopeMenu}\n        disabled={disabled}\n        textValue={textValue ?? textContent}\n      >\n        <RovingFocusGroup.Item asChild {...rovingFocusGroupScope} focusable={!disabled}>\n          <Primitive.div\n            role=\"menuitem\"\n            data-highlighted={isFocused ? '' : undefined}\n            aria-disabled={disabled || undefined}\n            data-disabled={disabled ? '' : undefined}\n            {...itemProps}\n            ref={composedRefs}\n            /**\n             * We focus items on `pointerMove` to achieve the following:\n             *\n             * - Mouse over an item (it focuses)\n             * - Leave mouse where it is and use keyboard to focus a different item\n             * - Wiggle mouse without it leaving previously focused item\n             * - Previously focused item should re-focus\n             *\n             * If we used `mouseOver`/`mouseEnter` it would not re-focus when the mouse\n             * wiggles. This is to match native menu implementation.\n             */\n            onPointerMove={composeEventHandlers(\n              props.onPointerMove,\n              whenMouse((event) => {\n                if (disabled) {\n                  contentContext.onItemLeave(event);\n                } else {\n                  contentContext.onItemEnter(event);\n                  if (!event.defaultPrevented) {\n                    const item = event.currentTarget;\n                    item.focus({ preventScroll: true });\n                  }\n                }\n              })\n            )}\n            onPointerLeave={composeEventHandlers(\n              props.onPointerLeave,\n              whenMouse((event) => contentContext.onItemLeave(event))\n            )}\n            onFocus={composeEventHandlers(props.onFocus, () => setIsFocused(true))}\n            onBlur={composeEventHandlers(props.onBlur, () => setIsFocused(false))}\n          />\n        </RovingFocusGroup.Item>\n      </Collection.ItemSlot>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * MenuCheckboxItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst CHECKBOX_ITEM_NAME = 'MenuCheckboxItem';\n\ntype MenuCheckboxItemElement = MenuItemElement;\n\ntype CheckedState = boolean | 'indeterminate';\n\ninterface MenuCheckboxItemProps extends MenuItemProps {\n  checked?: CheckedState;\n  // `onCheckedChange` can never be called with `\"indeterminate\"` from the inside\n  onCheckedChange?: (checked: boolean) => void;\n}\n\nconst MenuCheckboxItem = React.forwardRef<MenuCheckboxItemElement, MenuCheckboxItemProps>(\n  (props: ScopedProps<MenuCheckboxItemProps>, forwardedRef) => {\n    const { checked = false, onCheckedChange, ...checkboxItemProps } = props;\n    return (\n      <ItemIndicatorProvider scope={props.__scopeMenu} checked={checked}>\n        <MenuItem\n          role=\"menuitemcheckbox\"\n          aria-checked={isIndeterminate(checked) ? 'mixed' : checked}\n          {...checkboxItemProps}\n          ref={forwardedRef}\n          data-state={getCheckedState(checked)}\n          onSelect={composeEventHandlers(\n            checkboxItemProps.onSelect,\n            () => onCheckedChange?.(isIndeterminate(checked) ? true : !checked),\n            { checkForDefaultPrevented: false }\n          )}\n        />\n      </ItemIndicatorProvider>\n    );\n  }\n);\n\nMenuCheckboxItem.displayName = CHECKBOX_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuRadioGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_GROUP_NAME = 'MenuRadioGroup';\n\nconst [RadioGroupProvider, useRadioGroupContext] = createMenuContext<MenuRadioGroupProps>(\n  RADIO_GROUP_NAME,\n  { value: undefined, onValueChange: () => {} }\n);\n\ntype MenuRadioGroupElement = React.ComponentRef<typeof MenuGroup>;\ninterface MenuRadioGroupProps extends MenuGroupProps {\n  value?: string;\n  onValueChange?: (value: string) => void;\n}\n\nconst MenuRadioGroup = React.forwardRef<MenuRadioGroupElement, MenuRadioGroupProps>(\n  (props: ScopedProps<MenuRadioGroupProps>, forwardedRef) => {\n    const { value, onValueChange, ...groupProps } = props;\n    const handleValueChange = useCallbackRef(onValueChange);\n    return (\n      <RadioGroupProvider scope={props.__scopeMenu} value={value} onValueChange={handleValueChange}>\n        <MenuGroup {...groupProps} ref={forwardedRef} />\n      </RadioGroupProvider>\n    );\n  }\n);\n\nMenuRadioGroup.displayName = RADIO_GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuRadioItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_ITEM_NAME = 'MenuRadioItem';\n\ntype MenuRadioItemElement = React.ComponentRef<typeof MenuItem>;\ninterface MenuRadioItemProps extends MenuItemProps {\n  value: string;\n}\n\nconst MenuRadioItem = React.forwardRef<MenuRadioItemElement, MenuRadioItemProps>(\n  (props: ScopedProps<MenuRadioItemProps>, forwardedRef) => {\n    const { value, ...radioItemProps } = props;\n    const context = useRadioGroupContext(RADIO_ITEM_NAME, props.__scopeMenu);\n    const checked = value === context.value;\n    return (\n      <ItemIndicatorProvider scope={props.__scopeMenu} checked={checked}>\n        <MenuItem\n          role=\"menuitemradio\"\n          aria-checked={checked}\n          {...radioItemProps}\n          ref={forwardedRef}\n          data-state={getCheckedState(checked)}\n          onSelect={composeEventHandlers(\n            radioItemProps.onSelect,\n            () => context.onValueChange?.(value),\n            { checkForDefaultPrevented: false }\n          )}\n        />\n      </ItemIndicatorProvider>\n    );\n  }\n);\n\nMenuRadioItem.displayName = RADIO_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuItemIndicator\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_INDICATOR_NAME = 'MenuItemIndicator';\n\ntype CheckboxContextValue = { checked: CheckedState };\n\nconst [ItemIndicatorProvider, useItemIndicatorContext] = createMenuContext<CheckboxContextValue>(\n  ITEM_INDICATOR_NAME,\n  { checked: false }\n);\n\ntype MenuItemIndicatorElement = React.ComponentRef<typeof Primitive.span>;\ntype PrimitiveSpanProps = React.ComponentPropsWithoutRef<typeof Primitive.span>;\ninterface MenuItemIndicatorProps extends PrimitiveSpanProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst MenuItemIndicator = React.forwardRef<MenuItemIndicatorElement, MenuItemIndicatorProps>(\n  (props: ScopedProps<MenuItemIndicatorProps>, forwardedRef) => {\n    const { __scopeMenu, forceMount, ...itemIndicatorProps } = props;\n    const indicatorContext = useItemIndicatorContext(ITEM_INDICATOR_NAME, __scopeMenu);\n    return (\n      <Presence\n        present={\n          forceMount ||\n          isIndeterminate(indicatorContext.checked) ||\n          indicatorContext.checked === true\n        }\n      >\n        <Primitive.span\n          {...itemIndicatorProps}\n          ref={forwardedRef}\n          data-state={getCheckedState(indicatorContext.checked)}\n        />\n      </Presence>\n    );\n  }\n);\n\nMenuItemIndicator.displayName = ITEM_INDICATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuSeparator\n * -----------------------------------------------------------------------------------------------*/\n\nconst SEPARATOR_NAME = 'MenuSeparator';\n\ntype MenuSeparatorElement = React.ComponentRef<typeof Primitive.div>;\ninterface MenuSeparatorProps extends PrimitiveDivProps {}\n\nconst MenuSeparator = React.forwardRef<MenuSeparatorElement, MenuSeparatorProps>(\n  (props: ScopedProps<MenuSeparatorProps>, forwardedRef) => {\n    const { __scopeMenu, ...separatorProps } = props;\n    return (\n      <Primitive.div\n        role=\"separator\"\n        aria-orientation=\"horizontal\"\n        {...separatorProps}\n        ref={forwardedRef}\n      />\n    );\n  }\n);\n\nMenuSeparator.displayName = SEPARATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'MenuArrow';\n\ntype MenuArrowElement = React.ComponentRef<typeof PopperPrimitive.Arrow>;\ntype PopperArrowProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Arrow>;\ninterface MenuArrowProps extends PopperArrowProps {}\n\nconst MenuArrow = React.forwardRef<MenuArrowElement, MenuArrowProps>(\n  (props: ScopedProps<MenuArrowProps>, forwardedRef) => {\n    const { __scopeMenu, ...arrowProps } = props;\n    const popperScope = usePopperScope(__scopeMenu);\n    return <PopperPrimitive.Arrow {...popperScope} {...arrowProps} ref={forwardedRef} />;\n  }\n);\n\nMenuArrow.displayName = ARROW_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuSub\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_NAME = 'MenuSub';\n\ntype MenuSubContextValue = {\n  contentId: string;\n  triggerId: string;\n  trigger: MenuSubTriggerElement | null;\n  onTriggerChange(trigger: MenuSubTriggerElement | null): void;\n};\n\nconst [MenuSubProvider, useMenuSubContext] = createMenuContext<MenuSubContextValue>(SUB_NAME);\n\ninterface MenuSubProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  onOpenChange?(open: boolean): void;\n}\n\nconst MenuSub: React.FC<MenuSubProps> = (props: ScopedProps<MenuSubProps>) => {\n  const { __scopeMenu, children, open = false, onOpenChange } = props;\n  const parentMenuContext = useMenuContext(SUB_NAME, __scopeMenu);\n  const popperScope = usePopperScope(__scopeMenu);\n  const [trigger, setTrigger] = React.useState<MenuSubTriggerElement | null>(null);\n  const [content, setContent] = React.useState<MenuContentElement | null>(null);\n  const handleOpenChange = useCallbackRef(onOpenChange);\n\n  // Prevent the parent menu from reopening with open submenus.\n  React.useEffect(() => {\n    if (parentMenuContext.open === false) handleOpenChange(false);\n    return () => handleOpenChange(false);\n  }, [parentMenuContext.open, handleOpenChange]);\n\n  return (\n    <PopperPrimitive.Root {...popperScope}>\n      <MenuProvider\n        scope={__scopeMenu}\n        open={open}\n        onOpenChange={handleOpenChange}\n        content={content}\n        onContentChange={setContent}\n      >\n        <MenuSubProvider\n          scope={__scopeMenu}\n          contentId={useId()}\n          triggerId={useId()}\n          trigger={trigger}\n          onTriggerChange={setTrigger}\n        >\n          {children}\n        </MenuSubProvider>\n      </MenuProvider>\n    </PopperPrimitive.Root>\n  );\n};\n\nMenuSub.displayName = SUB_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuSubTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_TRIGGER_NAME = 'MenuSubTrigger';\n\ntype MenuSubTriggerElement = MenuItemImplElement;\ninterface MenuSubTriggerProps extends MenuItemImplProps {}\n\nconst MenuSubTrigger = React.forwardRef<MenuSubTriggerElement, MenuSubTriggerProps>(\n  (props: ScopedProps<MenuSubTriggerProps>, forwardedRef) => {\n    const context = useMenuContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const rootContext = useMenuRootContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const subContext = useMenuSubContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const contentContext = useMenuContentContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const openTimerRef = React.useRef<number | null>(null);\n    const { pointerGraceTimerRef, onPointerGraceIntentChange } = contentContext;\n    const scope = { __scopeMenu: props.__scopeMenu };\n\n    const clearOpenTimer = React.useCallback(() => {\n      if (openTimerRef.current) window.clearTimeout(openTimerRef.current);\n      openTimerRef.current = null;\n    }, []);\n\n    React.useEffect(() => clearOpenTimer, [clearOpenTimer]);\n\n    React.useEffect(() => {\n      const pointerGraceTimer = pointerGraceTimerRef.current;\n      return () => {\n        window.clearTimeout(pointerGraceTimer);\n        onPointerGraceIntentChange(null);\n      };\n    }, [pointerGraceTimerRef, onPointerGraceIntentChange]);\n\n    return (\n      <MenuAnchor asChild {...scope}>\n        <MenuItemImpl\n          id={subContext.triggerId}\n          aria-haspopup=\"menu\"\n          aria-expanded={context.open}\n          aria-controls={subContext.contentId}\n          data-state={getOpenState(context.open)}\n          {...props}\n          ref={composeRefs(forwardedRef, subContext.onTriggerChange)}\n          // This is redundant for mouse users but we cannot determine pointer type from\n          // click event and we cannot use pointerup event (see git history for reasons why)\n          onClick={(event) => {\n            props.onClick?.(event);\n            if (props.disabled || event.defaultPrevented) return;\n            /**\n             * We manually focus because iOS Safari doesn't always focus on click (e.g. buttons)\n             * and we rely heavily on `onFocusOutside` for submenus to close when switching\n             * between separate submenus.\n             */\n            event.currentTarget.focus();\n            if (!context.open) context.onOpenChange(true);\n          }}\n          onPointerMove={composeEventHandlers(\n            props.onPointerMove,\n            whenMouse((event) => {\n              contentContext.onItemEnter(event);\n              if (event.defaultPrevented) return;\n              if (!props.disabled && !context.open && !openTimerRef.current) {\n                contentContext.onPointerGraceIntentChange(null);\n                openTimerRef.current = window.setTimeout(() => {\n                  context.onOpenChange(true);\n                  clearOpenTimer();\n                }, 100);\n              }\n            })\n          )}\n          onPointerLeave={composeEventHandlers(\n            props.onPointerLeave,\n            whenMouse((event) => {\n              clearOpenTimer();\n\n              const contentRect = context.content?.getBoundingClientRect();\n              if (contentRect) {\n                // TODO: make sure to update this when we change positioning logic\n                const side = context.content?.dataset.side as Side;\n                const rightSide = side === 'right';\n                const bleed = rightSide ? -5 : +5;\n                const contentNearEdge = contentRect[rightSide ? 'left' : 'right'];\n                const contentFarEdge = contentRect[rightSide ? 'right' : 'left'];\n\n                contentContext.onPointerGraceIntentChange({\n                  area: [\n                    // Apply a bleed on clientX to ensure that our exit point is\n                    // consistently within polygon bounds\n                    { x: event.clientX + bleed, y: event.clientY },\n                    { x: contentNearEdge, y: contentRect.top },\n                    { x: contentFarEdge, y: contentRect.top },\n                    { x: contentFarEdge, y: contentRect.bottom },\n                    { x: contentNearEdge, y: contentRect.bottom },\n                  ],\n                  side,\n                });\n\n                window.clearTimeout(pointerGraceTimerRef.current);\n                pointerGraceTimerRef.current = window.setTimeout(\n                  () => contentContext.onPointerGraceIntentChange(null),\n                  300\n                );\n              } else {\n                contentContext.onTriggerLeave(event);\n                if (event.defaultPrevented) return;\n\n                // There's 100ms where the user may leave an item before the submenu was opened.\n                contentContext.onPointerGraceIntentChange(null);\n              }\n            })\n          )}\n          onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n            const isTypingAhead = contentContext.searchRef.current !== '';\n            if (props.disabled || (isTypingAhead && event.key === ' ')) return;\n            if (SUB_OPEN_KEYS[rootContext.dir].includes(event.key)) {\n              context.onOpenChange(true);\n              // The trigger may hold focus if opened via pointer interaction\n              // so we ensure content is given focus again when switching to keyboard.\n              context.content?.focus();\n              // prevent window from scrolling\n              event.preventDefault();\n            }\n          })}\n        />\n      </MenuAnchor>\n    );\n  }\n);\n\nMenuSubTrigger.displayName = SUB_TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuSubContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_CONTENT_NAME = 'MenuSubContent';\n\ntype MenuSubContentElement = MenuContentImplElement;\ninterface MenuSubContentProps\n  extends Omit<\n    MenuContentImplProps,\n    keyof MenuContentImplPrivateProps | 'onCloseAutoFocus' | 'onEntryFocus' | 'side' | 'align'\n  > {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst MenuSubContent = React.forwardRef<MenuSubContentElement, MenuSubContentProps>(\n  (props: ScopedProps<MenuSubContentProps>, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopeMenu);\n    const { forceMount = portalContext.forceMount, ...subContentProps } = props;\n    const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n    const rootContext = useMenuRootContext(CONTENT_NAME, props.__scopeMenu);\n    const subContext = useMenuSubContext(SUB_CONTENT_NAME, props.__scopeMenu);\n    const ref = React.useRef<MenuSubContentElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    return (\n      <Collection.Provider scope={props.__scopeMenu}>\n        <Presence present={forceMount || context.open}>\n          <Collection.Slot scope={props.__scopeMenu}>\n            <MenuContentImpl\n              id={subContext.contentId}\n              aria-labelledby={subContext.triggerId}\n              {...subContentProps}\n              ref={composedRefs}\n              align=\"start\"\n              side={rootContext.dir === 'rtl' ? 'left' : 'right'}\n              disableOutsidePointerEvents={false}\n              disableOutsideScroll={false}\n              trapFocus={false}\n              onOpenAutoFocus={(event) => {\n                // when opening a submenu, focus content for keyboard users only\n                if (rootContext.isUsingKeyboardRef.current) ref.current?.focus();\n                event.preventDefault();\n              }}\n              // The menu might close because of focusing another menu item in the parent menu. We\n              // don't want it to refocus the trigger in that case so we handle trigger focus ourselves.\n              onCloseAutoFocus={(event) => event.preventDefault()}\n              onFocusOutside={composeEventHandlers(props.onFocusOutside, (event) => {\n                // We prevent closing when the trigger is focused to avoid triggering a re-open animation\n                // on pointer interaction.\n                if (event.target !== subContext.trigger) context.onOpenChange(false);\n              })}\n              onEscapeKeyDown={composeEventHandlers(props.onEscapeKeyDown, (event) => {\n                rootContext.onClose();\n                // ensure pressing escape in submenu doesn't escape full screen mode\n                event.preventDefault();\n              })}\n              onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n                // Submenu key events bubble through portals. We only care about keys in this menu.\n                const isKeyDownInside = event.currentTarget.contains(event.target as HTMLElement);\n                const isCloseKey = SUB_CLOSE_KEYS[rootContext.dir].includes(event.key);\n                if (isKeyDownInside && isCloseKey) {\n                  context.onOpenChange(false);\n                  // We focus manually because we prevented it in `onCloseAutoFocus`\n                  subContext.trigger?.focus();\n                  // prevent window from scrolling\n                  event.preventDefault();\n                }\n              })}\n            />\n          </Collection.Slot>\n        </Presence>\n      </Collection.Provider>\n    );\n  }\n);\n\nMenuSubContent.displayName = SUB_CONTENT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction getOpenState(open: boolean) {\n  return open ? 'open' : 'closed';\n}\n\nfunction isIndeterminate(checked?: CheckedState): checked is 'indeterminate' {\n  return checked === 'indeterminate';\n}\n\nfunction getCheckedState(checked: CheckedState) {\n  return isIndeterminate(checked) ? 'indeterminate' : checked ? 'checked' : 'unchecked';\n}\n\nfunction focusFirst(candidates: HTMLElement[]) {\n  const PREVIOUSLY_FOCUSED_ELEMENT = document.activeElement;\n  for (const candidate of candidates) {\n    // if focus is already where we want to go, we don't want to keep going through the candidates\n    if (candidate === PREVIOUSLY_FOCUSED_ELEMENT) return;\n    candidate.focus();\n    if (document.activeElement !== PREVIOUSLY_FOCUSED_ELEMENT) return;\n  }\n}\n\n/**\n * Wraps an array around itself at a given start index\n * Example: `wrapArray(['a', 'b', 'c', 'd'], 2) === ['c', 'd', 'a', 'b']`\n */\nfunction wrapArray<T>(array: T[], startIndex: number) {\n  return array.map<T>((_, index) => array[(startIndex + index) % array.length]!);\n}\n\n/**\n * This is the \"meat\" of the typeahead matching logic. It takes in all the values,\n * the search and the current match, and returns the next match (or `undefined`).\n *\n * We normalize the search because if a user has repeatedly pressed a character,\n * we want the exact same behavior as if we only had that one character\n * (ie. cycle through options starting with that character)\n *\n * We also reorder the values by wrapping the array around the current match.\n * This is so we always look forward from the current match, and picking the first\n * match will always be the correct one.\n *\n * Finally, if the normalized search is exactly one character, we exclude the\n * current match from the values because otherwise it would be the first to match always\n * and focus would never move. This is as opposed to the regular case, where we\n * don't want focus to move if the current match still matches.\n */\nfunction getNextMatch(values: string[], search: string, currentMatch?: string) {\n  const isRepeated = search.length > 1 && Array.from(search).every((char) => char === search[0]);\n  const normalizedSearch = isRepeated ? search[0]! : search;\n  const currentMatchIndex = currentMatch ? values.indexOf(currentMatch) : -1;\n  let wrappedValues = wrapArray(values, Math.max(currentMatchIndex, 0));\n  const excludeCurrentMatch = normalizedSearch.length === 1;\n  if (excludeCurrentMatch) wrappedValues = wrappedValues.filter((v) => v !== currentMatch);\n  const nextMatch = wrappedValues.find((value) =>\n    value.toLowerCase().startsWith(normalizedSearch.toLowerCase())\n  );\n  return nextMatch !== currentMatch ? nextMatch : undefined;\n}\n\ntype Point = { x: number; y: number };\ntype Polygon = Point[];\ntype Side = 'left' | 'right';\ntype GraceIntent = { area: Polygon; side: Side };\n\n// Determine if a point is inside of a polygon.\n// Based on https://github.com/substack/point-in-polygon\nfunction isPointInPolygon(point: Point, polygon: Polygon) {\n  const { x, y } = point;\n  let inside = false;\n  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n    const ii = polygon[i]!;\n    const jj = polygon[j]!;\n    const xi = ii.x;\n    const yi = ii.y;\n    const xj = jj.x;\n    const yj = jj.y;\n\n    // prettier-ignore\n    const intersect = ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n    if (intersect) inside = !inside;\n  }\n\n  return inside;\n}\n\nfunction isPointerInGraceArea(event: React.PointerEvent, area?: Polygon) {\n  if (!area) return false;\n  const cursorPos = { x: event.clientX, y: event.clientY };\n  return isPointInPolygon(cursorPos, area);\n}\n\nfunction whenMouse<E>(handler: React.PointerEventHandler<E>): React.PointerEventHandler<E> {\n  return (event) => (event.pointerType === 'mouse' ? handler(event) : undefined);\n}\n\nconst Root = Menu;\nconst Anchor = MenuAnchor;\nconst Portal = MenuPortal;\nconst Content = MenuContent;\nconst Group = MenuGroup;\nconst Label = MenuLabel;\nconst Item = MenuItem;\nconst CheckboxItem = MenuCheckboxItem;\nconst RadioGroup = MenuRadioGroup;\nconst RadioItem = MenuRadioItem;\nconst ItemIndicator = MenuItemIndicator;\nconst Separator = MenuSeparator;\nconst Arrow = MenuArrow;\nconst Sub = MenuSub;\nconst SubTrigger = MenuSubTrigger;\nconst SubContent = MenuSubContent;\n\nexport {\n  createMenuScope,\n  //\n  Menu,\n  MenuAnchor,\n  MenuPortal,\n  MenuContent,\n  MenuGroup,\n  MenuLabel,\n  MenuItem,\n  MenuCheckboxItem,\n  MenuRadioGroup,\n  MenuRadioItem,\n  MenuItemIndicator,\n  MenuSeparator,\n  MenuArrow,\n  MenuSub,\n  MenuSubTrigger,\n  MenuSubContent,\n  //\n  Root,\n  Anchor,\n  Portal,\n  Content,\n  Group,\n  Label,\n  Item,\n  CheckboxItem,\n  RadioGroup,\n  RadioItem,\n  ItemIndicator,\n  Separator,\n  Arrow,\n  Sub,\n  SubTrigger,\n  SubContent,\n};\nexport type {\n  MenuProps,\n  MenuAnchorProps,\n  MenuPortalProps,\n  MenuContentProps,\n  MenuGroupProps,\n  MenuLabelProps,\n  MenuItemProps,\n  MenuCheckboxItemProps,\n  MenuRadioGroupProps,\n  MenuRadioItemProps,\n  MenuItemIndicatorProps,\n  MenuSeparatorProps,\n  MenuArrowProps,\n  MenuSubProps,\n  MenuSubTriggerProps,\n  MenuSubContentProps,\n};\n", "import React from 'react';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createSlot, type Slot } from '@radix-ui/react-slot';\n\ntype SlotProps = React.ComponentPropsWithoutRef<typeof Slot>;\ntype CollectionElement = HTMLElement;\ninterface CollectionProps extends SlotProps {\n  scope: any;\n}\n\n// We have resorted to returning slots directly rather than exposing primitives that can then\n// be slotted like `<CollectionItem as={Slot}>\u2026</CollectionItem>`.\n// This is because we encountered issues with generic types that cannot be statically analysed\n// due to creating them dynamically via createCollection.\n\nfunction createCollection<ItemElement extends HTMLElement, ItemData = {}>(name: string) {\n  /* -----------------------------------------------------------------------------------------------\n   * CollectionProvider\n   * ---------------------------------------------------------------------------------------------*/\n\n  const PROVIDER_NAME = name + 'CollectionProvider';\n  const [createCollectionContext, createCollectionScope] = createContextScope(PROVIDER_NAME);\n\n  type ContextValue = {\n    collectionRef: React.RefObject<CollectionElement | null>;\n    itemMap: Map<\n      React.RefObject<ItemElement | null>,\n      { ref: React.RefObject<ItemElement | null> } & ItemData\n    >;\n  };\n\n  const [CollectionProviderImpl, useCollectionContext] = createCollectionContext<ContextValue>(\n    PROVIDER_NAME,\n    { collectionRef: { current: null }, itemMap: new Map() }\n  );\n\n  const CollectionProvider: React.FC<{ children?: React.ReactNode; scope: any }> = (props) => {\n    const { scope, children } = props;\n    const ref = React.useRef<CollectionElement>(null);\n    const itemMap = React.useRef<ContextValue['itemMap']>(new Map()).current;\n    return (\n      <CollectionProviderImpl scope={scope} itemMap={itemMap} collectionRef={ref}>\n        {children}\n      </CollectionProviderImpl>\n    );\n  };\n\n  CollectionProvider.displayName = PROVIDER_NAME;\n\n  /* -----------------------------------------------------------------------------------------------\n   * CollectionSlot\n   * ---------------------------------------------------------------------------------------------*/\n\n  const COLLECTION_SLOT_NAME = name + 'CollectionSlot';\n\n  const CollectionSlotImpl = createSlot(COLLECTION_SLOT_NAME);\n  const CollectionSlot = React.forwardRef<CollectionElement, CollectionProps>(\n    (props, forwardedRef) => {\n      const { scope, children } = props;\n      const context = useCollectionContext(COLLECTION_SLOT_NAME, scope);\n      const composedRefs = useComposedRefs(forwardedRef, context.collectionRef);\n      return <CollectionSlotImpl ref={composedRefs}>{children}</CollectionSlotImpl>;\n    }\n  );\n\n  CollectionSlot.displayName = COLLECTION_SLOT_NAME;\n\n  /* -----------------------------------------------------------------------------------------------\n   * CollectionItem\n   * ---------------------------------------------------------------------------------------------*/\n\n  const ITEM_SLOT_NAME = name + 'CollectionItemSlot';\n  const ITEM_DATA_ATTR = 'data-radix-collection-item';\n\n  type CollectionItemSlotProps = ItemData & {\n    children: React.ReactNode;\n    scope: any;\n  };\n\n  const CollectionItemSlotImpl = createSlot(ITEM_SLOT_NAME);\n  const CollectionItemSlot = React.forwardRef<ItemElement, CollectionItemSlotProps>(\n    (props, forwardedRef) => {\n      const { scope, children, ...itemData } = props;\n      const ref = React.useRef<ItemElement>(null);\n      const composedRefs = useComposedRefs(forwardedRef, ref);\n      const context = useCollectionContext(ITEM_SLOT_NAME, scope);\n\n      React.useEffect(() => {\n        context.itemMap.set(ref, { ref, ...(itemData as unknown as ItemData) });\n        return () => void context.itemMap.delete(ref);\n      });\n\n      return (\n        <CollectionItemSlotImpl {...{ [ITEM_DATA_ATTR]: '' }} ref={composedRefs}>\n          {children}\n        </CollectionItemSlotImpl>\n      );\n    }\n  );\n\n  CollectionItemSlot.displayName = ITEM_SLOT_NAME;\n\n  /* -----------------------------------------------------------------------------------------------\n   * useCollection\n   * ---------------------------------------------------------------------------------------------*/\n\n  function useCollection(scope: any) {\n    const context = useCollectionContext(name + 'CollectionConsumer', scope);\n\n    const getItems = React.useCallback(() => {\n      const collectionNode = context.collectionRef.current;\n      if (!collectionNode) return [];\n      const orderedNodes = Array.from(collectionNode.querySelectorAll(`[${ITEM_DATA_ATTR}]`));\n      const items = Array.from(context.itemMap.values());\n      const orderedItems = items.sort(\n        (a, b) => orderedNodes.indexOf(a.ref.current!) - orderedNodes.indexOf(b.ref.current!)\n      );\n      return orderedItems;\n    }, [context.collectionRef, context.itemMap]);\n\n    return getItems;\n  }\n\n  return [\n    { Provider: CollectionProvider, Slot: CollectionSlot, ItemSlot: CollectionItemSlot },\n    useCollection,\n    createCollectionScope,\n  ] as const;\n}\n\nexport { createCollection };\nexport type { CollectionProps };\n", "import React from 'react';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createSlot, type Slot } from '@radix-ui/react-slot';\nimport type { EntryOf } from './ordered-dictionary';\nimport { OrderedDict } from './ordered-dictionary';\n\ntype SlotProps = React.ComponentPropsWithoutRef<typeof Slot>;\ntype CollectionElement = HTMLElement;\ninterface CollectionProps extends SlotProps {\n  scope: any;\n}\n\ninterface BaseItemData {\n  id?: string;\n}\n\ntype ItemDataWithElement<\n  ItemData extends BaseItemData,\n  ItemElement extends HTMLElement,\n> = ItemData & {\n  element: ItemElement;\n};\n\ntype ItemMap<ItemElement extends HTMLElement, ItemData extends BaseItemData> = OrderedDict<\n  ItemElement,\n  ItemDataWithElement<ItemData, ItemElement>\n>;\n\nfunction createCollection<\n  ItemElement extends HTMLElement,\n  ItemData extends BaseItemData = BaseItemData,\n>(name: string) {\n  /* -----------------------------------------------------------------------------------------------\n   * CollectionProvider\n   * ---------------------------------------------------------------------------------------------*/\n\n  const PROVIDER_NAME = name + 'CollectionProvider';\n  const [createCollectionContext, createCollectionScope] = createContextScope(PROVIDER_NAME);\n\n  type ContextValue = {\n    collectionElement: CollectionElement | null;\n    collectionRef: React.Ref<CollectionElement | null>;\n    collectionRefObject: React.RefObject<CollectionElement | null>;\n    itemMap: ItemMap<ItemElement, ItemData>;\n    setItemMap: React.Dispatch<React.SetStateAction<ItemMap<ItemElement, ItemData>>>;\n  };\n\n  const [CollectionContextProvider, useCollectionContext] = createCollectionContext<ContextValue>(\n    PROVIDER_NAME,\n    {\n      collectionElement: null,\n      collectionRef: { current: null },\n      collectionRefObject: { current: null },\n      itemMap: new OrderedDict(),\n      setItemMap: () => void 0,\n    }\n  );\n\n  type CollectionState = [\n    ItemMap: ItemMap<ItemElement, ItemData>,\n    SetItemMap: React.Dispatch<React.SetStateAction<ItemMap<ItemElement, ItemData>>>,\n  ];\n\n  const CollectionProvider: React.FC<{\n    children?: React.ReactNode;\n    scope: any;\n    state?: CollectionState;\n  }> = ({ state, ...props }) => {\n    return state ? (\n      <CollectionProviderImpl {...props} state={state} />\n    ) : (\n      <CollectionInit {...props} />\n    );\n  };\n  CollectionProvider.displayName = PROVIDER_NAME;\n\n  const CollectionInit: React.FC<{\n    children?: React.ReactNode;\n    scope: any;\n  }> = (props) => {\n    const state = useInitCollection();\n    return <CollectionProviderImpl {...props} state={state} />;\n  };\n  CollectionInit.displayName = PROVIDER_NAME + 'Init';\n\n  const CollectionProviderImpl: React.FC<{\n    children?: React.ReactNode;\n    scope: any;\n    state: CollectionState;\n  }> = (props) => {\n    const { scope, children, state } = props;\n    const ref = React.useRef<CollectionElement>(null);\n    const [collectionElement, setCollectionElement] = React.useState<CollectionElement | null>(\n      null\n    );\n    const composeRefs = useComposedRefs(ref, setCollectionElement);\n    const [itemMap, setItemMap] = state;\n\n    React.useEffect(() => {\n      if (!collectionElement) return;\n\n      const observer = getChildListObserver(() => {\n        // setItemMap((map) => {\n        //   const copy = new OrderedDict(map).toSorted(([, a], [, b]) =>\n        //     !a.element || !b.element ? 0 : isElementPreceding(a.element, b.element) ? -1 : 1\n        //   );\n        //   // check if the order has changed\n        //   let index = -1;\n        //   for (const entry of copy) {\n        //     index++;\n        //     const key = map.keyAt(index)!;\n        //     const [copyKey] = entry;\n        //     if (key !== copyKey) {\n        //       // order has changed!\n        //       return copy;\n        //     }\n        //   }\n        //   return map;\n        // });\n      });\n      observer.observe(collectionElement, {\n        childList: true,\n        subtree: true,\n      });\n      return () => {\n        observer.disconnect();\n      };\n    }, [collectionElement]);\n\n    return (\n      <CollectionContextProvider\n        scope={scope}\n        itemMap={itemMap}\n        setItemMap={setItemMap}\n        collectionRef={composeRefs}\n        collectionRefObject={ref}\n        collectionElement={collectionElement}\n      >\n        {children}\n      </CollectionContextProvider>\n    );\n  };\n\n  CollectionProviderImpl.displayName = PROVIDER_NAME + 'Impl';\n\n  /* -----------------------------------------------------------------------------------------------\n   * CollectionSlot\n   * ---------------------------------------------------------------------------------------------*/\n\n  const COLLECTION_SLOT_NAME = name + 'CollectionSlot';\n\n  const CollectionSlotImpl = createSlot(COLLECTION_SLOT_NAME);\n  const CollectionSlot = React.forwardRef<CollectionElement, CollectionProps>(\n    (props, forwardedRef) => {\n      const { scope, children } = props;\n      const context = useCollectionContext(COLLECTION_SLOT_NAME, scope);\n      const composedRefs = useComposedRefs(forwardedRef, context.collectionRef);\n      return <CollectionSlotImpl ref={composedRefs}>{children}</CollectionSlotImpl>;\n    }\n  );\n\n  CollectionSlot.displayName = COLLECTION_SLOT_NAME;\n\n  /* -----------------------------------------------------------------------------------------------\n   * CollectionItem\n   * ---------------------------------------------------------------------------------------------*/\n\n  const ITEM_SLOT_NAME = name + 'CollectionItemSlot';\n  const ITEM_DATA_ATTR = 'data-radix-collection-item';\n\n  type CollectionItemSlotProps = ItemData & {\n    children: React.ReactNode;\n    scope: any;\n  };\n\n  const CollectionItemSlotImpl = createSlot(ITEM_SLOT_NAME);\n  const CollectionItemSlot = React.forwardRef<ItemElement, CollectionItemSlotProps>(\n    (props, forwardedRef) => {\n      const { scope, children, ...itemData } = props;\n      const ref = React.useRef<ItemElement>(null);\n      const [element, setElement] = React.useState<ItemElement | null>(null);\n      const composedRefs = useComposedRefs(forwardedRef, ref, setElement);\n      const context = useCollectionContext(ITEM_SLOT_NAME, scope);\n\n      const { setItemMap } = context;\n\n      const itemDataRef = React.useRef(itemData);\n      if (!shallowEqual(itemDataRef.current, itemData)) {\n        itemDataRef.current = itemData;\n      }\n      const memoizedItemData = itemDataRef.current;\n\n      React.useEffect(() => {\n        const itemData = memoizedItemData;\n        setItemMap((map) => {\n          if (!element) {\n            return map;\n          }\n\n          if (!map.has(element)) {\n            map.set(element, { ...(itemData as unknown as ItemData), element });\n            return map.toSorted(sortByDocumentPosition);\n          }\n\n          return map\n            .set(element, { ...(itemData as unknown as ItemData), element })\n            .toSorted(sortByDocumentPosition);\n        });\n\n        return () => {\n          setItemMap((map) => {\n            if (!element || !map.has(element)) {\n              return map;\n            }\n            map.delete(element);\n            return new OrderedDict(map);\n          });\n        };\n      }, [element, memoizedItemData, setItemMap]);\n\n      return (\n        <CollectionItemSlotImpl {...{ [ITEM_DATA_ATTR]: '' }} ref={composedRefs as any}>\n          {children}\n        </CollectionItemSlotImpl>\n      );\n    }\n  );\n\n  CollectionItemSlot.displayName = ITEM_SLOT_NAME;\n\n  /* -----------------------------------------------------------------------------------------------\n   * useInitCollection\n   * ---------------------------------------------------------------------------------------------*/\n\n  function useInitCollection() {\n    return React.useState<ItemMap<ItemElement, ItemData>>(new OrderedDict());\n  }\n\n  /* -----------------------------------------------------------------------------------------------\n   * useCollection\n   * ---------------------------------------------------------------------------------------------*/\n\n  function useCollection(scope: any) {\n    const { itemMap } = useCollectionContext(name + 'CollectionConsumer', scope);\n\n    return itemMap;\n  }\n\n  const functions = {\n    createCollectionScope,\n    useCollection,\n    useInitCollection,\n  };\n\n  return [\n    { Provider: CollectionProvider, Slot: CollectionSlot, ItemSlot: CollectionItemSlot },\n    functions,\n  ] as const;\n}\n\nexport { createCollection };\nexport type { CollectionProps };\n\nfunction shallowEqual(a: any, b: any) {\n  if (a === b) return true;\n  if (typeof a !== 'object' || typeof b !== 'object') return false;\n  if (a == null || b == null) return false;\n  const keysA = Object.keys(a);\n  const keysB = Object.keys(b);\n  if (keysA.length !== keysB.length) return false;\n  for (const key of keysA) {\n    if (!Object.prototype.hasOwnProperty.call(b, key)) return false;\n    if (a[key] !== b[key]) return false;\n  }\n  return true;\n}\n\nfunction isElementPreceding(a: Element, b: Element) {\n  return !!(b.compareDocumentPosition(a) & Node.DOCUMENT_POSITION_PRECEDING);\n}\n\nfunction sortByDocumentPosition<E extends HTMLElement, T extends BaseItemData>(\n  a: EntryOf<ItemMap<E, T>>,\n  b: EntryOf<ItemMap<E, T>>\n) {\n  return !a[1].element || !b[1].element\n    ? 0\n    : isElementPreceding(a[1].element, b[1].element)\n      ? -1\n      : 1;\n}\n\nfunction getChildListObserver(callback: () => void) {\n  const observer = new MutationObserver((mutationsList) => {\n    for (const mutation of mutationsList) {\n      if (mutation.type === 'childList') {\n        callback();\n        return;\n      }\n    }\n  });\n\n  return observer;\n}\n", "// Not a real member because it shouldn't be accessible, but the super class\n// calls `set` which needs to read the instanciation state, so it can't be a\n// private member.\nconst __instanciated = new WeakMap<OrderedDict<any, any>, boolean>();\nexport class OrderedDict<K, V> extends Map<K, V> {\n  #keys: K[];\n\n  constructor(iterable?: Iterable<readonly [K, V]> | null | undefined);\n  constructor(entries?: readonly (readonly [K, V])[] | null) {\n    super(entries);\n    this.#keys = [...super.keys()];\n    __instanciated.set(this, true);\n  }\n\n  set(key: K, value: V) {\n    if (__instanciated.get(this)) {\n      if (this.has(key)) {\n        this.#keys[this.#keys.indexOf(key)] = key;\n      } else {\n        this.#keys.push(key);\n      }\n    }\n    super.set(key, value);\n    return this;\n  }\n\n  insert(index: number, key: K, value: V) {\n    const has = this.has(key);\n    const length = this.#keys.length;\n    const relativeIndex = toSafeInteger(index);\n    let actualIndex = relativeIndex >= 0 ? relativeIndex : length + relativeIndex;\n    const safeIndex = actualIndex < 0 || actualIndex >= length ? -1 : actualIndex;\n\n    if (safeIndex === this.size || (has && safeIndex === this.size - 1) || safeIndex === -1) {\n      this.set(key, value);\n      return this;\n    }\n\n    const size = this.size + (has ? 0 : 1);\n\n    // If you insert at, say, -2, without this bit you'd replace the\n    // second-to-last item and push the rest up one, which means the new item is\n    // 3rd to last. This isn't very intuitive; inserting at -2 is more like\n    // saying \"make this item the second to last\".\n    if (relativeIndex < 0) {\n      actualIndex++;\n    }\n\n    const keys = [...this.#keys];\n    let nextValue: V | undefined;\n    let shouldSkip = false;\n    for (let i = actualIndex; i < size; i++) {\n      if (actualIndex === i) {\n        let nextKey = keys[i]!;\n        if (keys[i] === key) {\n          nextKey = keys[i + 1]!;\n        }\n        if (has) {\n          // delete first to ensure that the item is moved to the end\n          this.delete(key);\n        }\n        nextValue = this.get(nextKey);\n        this.set(key, value);\n      } else {\n        if (!shouldSkip && keys[i - 1] === key) {\n          shouldSkip = true;\n        }\n        const currentKey = keys[shouldSkip ? i : i - 1]!;\n        const currentValue = nextValue!;\n        nextValue = this.get(currentKey);\n        this.delete(currentKey);\n        this.set(currentKey, currentValue);\n      }\n    }\n    return this;\n  }\n\n  with(index: number, key: K, value: V) {\n    const copy = new OrderedDict(this);\n    copy.insert(index, key, value);\n    return copy;\n  }\n\n  before(key: K) {\n    const index = this.#keys.indexOf(key) - 1;\n    if (index < 0) {\n      return undefined;\n    }\n    return this.entryAt(index);\n  }\n\n  /**\n   * Sets a new key-value pair at the position before the given key.\n   */\n  setBefore(key: K, newKey: K, value: V) {\n    const index = this.#keys.indexOf(key);\n    if (index === -1) {\n      return this;\n    }\n    return this.insert(index, newKey, value);\n  }\n\n  after(key: K) {\n    let index = this.#keys.indexOf(key);\n    index = index === -1 || index === this.size - 1 ? -1 : index + 1;\n    if (index === -1) {\n      return undefined;\n    }\n    return this.entryAt(index);\n  }\n\n  /**\n   * Sets a new key-value pair at the position after the given key.\n   */\n  setAfter(key: K, newKey: K, value: V) {\n    const index = this.#keys.indexOf(key);\n    if (index === -1) {\n      return this;\n    }\n    return this.insert(index + 1, newKey, value);\n  }\n\n  first() {\n    return this.entryAt(0);\n  }\n\n  last() {\n    return this.entryAt(-1);\n  }\n\n  clear() {\n    this.#keys = [];\n    return super.clear();\n  }\n\n  delete(key: K) {\n    const deleted = super.delete(key);\n    if (deleted) {\n      this.#keys.splice(this.#keys.indexOf(key), 1);\n    }\n    return deleted;\n  }\n\n  deleteAt(index: number) {\n    const key = this.keyAt(index);\n    if (key !== undefined) {\n      return this.delete(key);\n    }\n    return false;\n  }\n\n  at(index: number) {\n    const key = at(this.#keys, index);\n    if (key !== undefined) {\n      return this.get(key);\n    }\n  }\n\n  entryAt(index: number): [K, V] | undefined {\n    const key = at(this.#keys, index);\n    if (key !== undefined) {\n      return [key, this.get(key)!];\n    }\n  }\n\n  indexOf(key: K) {\n    return this.#keys.indexOf(key);\n  }\n\n  keyAt(index: number) {\n    return at(this.#keys, index);\n  }\n\n  from(key: K, offset: number) {\n    const index = this.indexOf(key);\n    if (index === -1) {\n      return undefined;\n    }\n    let dest = index + offset;\n    if (dest < 0) dest = 0;\n    if (dest >= this.size) dest = this.size - 1;\n    return this.at(dest);\n  }\n\n  keyFrom(key: K, offset: number) {\n    const index = this.indexOf(key);\n    if (index === -1) {\n      return undefined;\n    }\n    let dest = index + offset;\n    if (dest < 0) dest = 0;\n    if (dest >= this.size) dest = this.size - 1;\n    return this.keyAt(dest);\n  }\n\n  find(\n    predicate: (entry: [K, V], index: number, dictionary: OrderedDict<K, V>) => boolean,\n    thisArg?: any\n  ) {\n    let index = 0;\n    for (const entry of this) {\n      if (Reflect.apply(predicate, thisArg, [entry, index, this])) {\n        return entry;\n      }\n      index++;\n    }\n    return undefined;\n  }\n\n  findIndex(\n    predicate: (entry: [K, V], index: number, dictionary: OrderedDict<K, V>) => boolean,\n    thisArg?: any\n  ) {\n    let index = 0;\n    for (const entry of this) {\n      if (Reflect.apply(predicate, thisArg, [entry, index, this])) {\n        return index;\n      }\n      index++;\n    }\n    return -1;\n  }\n\n  filter<KK extends K, VV extends V>(\n    predicate: (entry: [K, V], index: number, dict: OrderedDict<K, V>) => entry is [KK, VV],\n    thisArg?: any\n  ): OrderedDict<KK, VV>;\n\n  filter(\n    predicate: (entry: [K, V], index: number, dictionary: OrderedDict<K, V>) => unknown,\n    thisArg?: any\n  ): OrderedDict<K, V>;\n\n  filter(\n    predicate: (entry: [K, V], index: number, dictionary: OrderedDict<K, V>) => unknown,\n    thisArg?: any\n  ) {\n    const entries: Array<[K, V]> = [];\n    let index = 0;\n    for (const entry of this) {\n      if (Reflect.apply(predicate, thisArg, [entry, index, this])) {\n        entries.push(entry);\n      }\n      index++;\n    }\n    return new OrderedDict(entries);\n  }\n\n  map<U>(\n    callbackfn: (entry: [K, V], index: number, dictionary: OrderedDict<K, V>) => U,\n    thisArg?: any\n  ): OrderedDict<K, U> {\n    const entries: [K, U][] = [];\n    let index = 0;\n    for (const entry of this) {\n      entries.push([entry[0], Reflect.apply(callbackfn, thisArg, [entry, index, this])]);\n      index++;\n    }\n    return new OrderedDict(entries);\n  }\n\n  reduce(\n    callbackfn: (\n      previousValue: [K, V],\n      currentEntry: [K, V],\n      currentIndex: number,\n      dictionary: OrderedDict<K, V>\n    ) => [K, V]\n  ): [K, V];\n  reduce(\n    callbackfn: (\n      previousValue: [K, V],\n      currentEntry: [K, V],\n      currentIndex: number,\n      dictionary: OrderedDict<K, V>\n    ) => [K, V],\n    initialValue: [K, V]\n  ): [K, V];\n  reduce<U>(\n    callbackfn: (\n      previousValue: U,\n      currentEntry: [K, V],\n      currentIndex: number,\n      dictionary: OrderedDict<K, V>\n    ) => U,\n    initialValue: U\n  ): U;\n\n  reduce<U>(\n    ...args: [\n      (\n        previousValue: U,\n        currentEntry: [K, V],\n        currentIndex: number,\n        dictionary: OrderedDict<K, V>\n      ) => U,\n      U?,\n    ]\n  ) {\n    const [callbackfn, initialValue] = args;\n    let index = 0;\n    let accumulator = initialValue ?? this.at(0)!;\n    for (const entry of this) {\n      if (index === 0 && args.length === 1) {\n        accumulator = entry as any;\n      } else {\n        accumulator = Reflect.apply(callbackfn, this, [accumulator, entry, index, this]);\n      }\n      index++;\n    }\n    return accumulator;\n  }\n\n  reduceRight(\n    callbackfn: (\n      previousValue: [K, V],\n      currentEntry: [K, V],\n      currentIndex: number,\n      dictionary: OrderedDict<K, V>\n    ) => [K, V]\n  ): [K, V];\n  reduceRight(\n    callbackfn: (\n      previousValue: [K, V],\n      currentEntry: [K, V],\n      currentIndex: number,\n      dictionary: OrderedDict<K, V>\n    ) => [K, V],\n    initialValue: [K, V]\n  ): [K, V];\n  reduceRight<U>(\n    callbackfn: (\n      previousValue: [K, V],\n      currentValue: U,\n      currentIndex: number,\n      dictionary: OrderedDict<K, V>\n    ) => U,\n    initialValue: U\n  ): U;\n\n  reduceRight<U>(\n    ...args: [\n      (\n        previousValue: U,\n        currentEntry: [K, V],\n        currentIndex: number,\n        dictionary: OrderedDict<K, V>\n      ) => U,\n      U?,\n    ]\n  ) {\n    const [callbackfn, initialValue] = args;\n    let accumulator = initialValue ?? this.at(-1)!;\n    for (let index = this.size - 1; index >= 0; index--) {\n      const entry = this.at(index)!;\n      if (index === this.size - 1 && args.length === 1) {\n        accumulator = entry as any;\n      } else {\n        accumulator = Reflect.apply(callbackfn, this, [accumulator, entry, index, this]);\n      }\n    }\n    return accumulator;\n  }\n\n  toSorted(compareFn?: (a: [K, V], b: [K, V]) => number): OrderedDict<K, V> {\n    const entries = [...this.entries()].sort(compareFn);\n    return new OrderedDict(entries);\n  }\n\n  toReversed(): OrderedDict<K, V> {\n    const reversed = new OrderedDict<K, V>();\n    for (let index = this.size - 1; index >= 0; index--) {\n      const key = this.keyAt(index)!;\n      const element = this.get(key)!;\n      reversed.set(key, element);\n    }\n    return reversed;\n  }\n\n  toSpliced(start: number, deleteCount?: number): OrderedDict<K, V>;\n  toSpliced(start: number, deleteCount: number, ...items: [K, V][]): OrderedDict<K, V>;\n\n  toSpliced(...args: [start: number, deleteCount: number, ...items: [K, V][]]) {\n    const entries = [...this.entries()];\n    entries.splice(...args);\n    return new OrderedDict(entries);\n  }\n\n  slice(start?: number, end?: number) {\n    const result = new OrderedDict<K, V>();\n    let stop = this.size - 1;\n\n    if (start === undefined) {\n      return result;\n    }\n\n    if (start < 0) {\n      start = start + this.size;\n    }\n\n    if (end !== undefined && end > 0) {\n      stop = end - 1;\n    }\n\n    for (let index = start; index <= stop; index++) {\n      const key = this.keyAt(index)!;\n      const element = this.get(key)!;\n      result.set(key, element);\n    }\n    return result;\n  }\n\n  every(\n    predicate: (entry: [K, V], index: number, dictionary: OrderedDict<K, V>) => unknown,\n    thisArg?: any\n  ) {\n    let index = 0;\n    for (const entry of this) {\n      if (!Reflect.apply(predicate, thisArg, [entry, index, this])) {\n        return false;\n      }\n      index++;\n    }\n    return true;\n  }\n\n  some(\n    predicate: (entry: [K, V], index: number, dictionary: OrderedDict<K, V>) => unknown,\n    thisArg?: any\n  ) {\n    let index = 0;\n    for (const entry of this) {\n      if (Reflect.apply(predicate, thisArg, [entry, index, this])) {\n        return true;\n      }\n      index++;\n    }\n    return false;\n  }\n}\n\nexport type KeyOf<D extends OrderedDict<any, any>> =\n  D extends OrderedDict<infer K, any> ? K : never;\nexport type ValueOf<D extends OrderedDict<any, any>> =\n  D extends OrderedDict<any, infer V> ? V : never;\nexport type EntryOf<D extends OrderedDict<any, any>> = [KeyOf<D>, ValueOf<D>];\nexport type KeyFrom<E extends EntryOf<any>> = E[0];\nexport type ValueFrom<E extends EntryOf<any>> = E[1];\n\nfunction at<T>(array: ArrayLike<T>, index: number): T | undefined {\n  if ('at' in Array.prototype) {\n    return Array.prototype.at.call(array, index);\n  }\n  const actualIndex = toSafeIndex(array, index);\n  return actualIndex === -1 ? undefined : array[actualIndex];\n}\n\nfunction toSafeIndex(array: ArrayLike<any>, index: number) {\n  const length = array.length;\n  const relativeIndex = toSafeInteger(index);\n  const actualIndex = relativeIndex >= 0 ? relativeIndex : length + relativeIndex;\n  return actualIndex < 0 || actualIndex >= length ? -1 : actualIndex;\n}\n\nfunction toSafeInteger(number: number) {\n  // eslint-disable-next-line no-self-compare\n  return number !== number || number === 0 ? 0 : Math.trunc(number);\n}\n", "import * as React from 'react';\n\ntype Direction = 'ltr' | 'rtl';\nconst DirectionContext = React.createContext<Direction | undefined>(undefined);\n\n/* -------------------------------------------------------------------------------------------------\n * Direction\n * -----------------------------------------------------------------------------------------------*/\n\ninterface DirectionProviderProps {\n  children?: React.ReactNode;\n  dir: Direction;\n}\nconst DirectionProvider: React.FC<DirectionProviderProps> = (props) => {\n  const { dir, children } = props;\n  return <DirectionContext.Provider value={dir}>{children}</DirectionContext.Provider>;\n};\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction useDirection(localDir?: Direction) {\n  const globalDir = React.useContext(DirectionContext);\n  return localDir || globalDir || 'ltr';\n}\n\nconst Provider = DirectionProvider;\n\nexport {\n  useDirection,\n  //\n  Provider,\n  //\n  DirectionProvider,\n};\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { createCollection } from '@radix-ui/react-collection';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useId } from '@radix-ui/react-id';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { useDirection } from '@radix-ui/react-direction';\n\nimport type { Scope } from '@radix-ui/react-context';\n\nconst ENTRY_FOCUS = 'rovingFocusGroup.onEntryFocus';\nconst EVENT_OPTIONS = { bubbles: false, cancelable: true };\n\n/* -------------------------------------------------------------------------------------------------\n * RovingFocusGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst GROUP_NAME = 'RovingFocusGroup';\n\ntype ItemData = { id: string; focusable: boolean; active: boolean };\nconst [Collection, useCollection, createCollectionScope] = createCollection<\n  HTMLSpanElement,\n  ItemData\n>(GROUP_NAME);\n\ntype ScopedProps<P> = P & { __scopeRovingFocusGroup?: Scope };\nconst [createRovingFocusGroupContext, createRovingFocusGroupScope] = createContextScope(\n  GROUP_NAME,\n  [createCollectionScope]\n);\n\ntype Orientation = React.AriaAttributes['aria-orientation'];\ntype Direction = 'ltr' | 'rtl';\n\ninterface RovingFocusGroupOptions {\n  /**\n   * The orientation of the group.\n   * Mainly so arrow navigation is done accordingly (left & right vs. up & down)\n   */\n  orientation?: Orientation;\n  /**\n   * The direction of navigation between items.\n   */\n  dir?: Direction;\n  /**\n   * Whether keyboard navigation should loop around\n   * @defaultValue false\n   */\n  loop?: boolean;\n}\n\ntype RovingContextValue = RovingFocusGroupOptions & {\n  currentTabStopId: string | null;\n  onItemFocus(tabStopId: string): void;\n  onItemShiftTab(): void;\n  onFocusableItemAdd(): void;\n  onFocusableItemRemove(): void;\n};\n\nconst [RovingFocusProvider, useRovingFocusContext] =\n  createRovingFocusGroupContext<RovingContextValue>(GROUP_NAME);\n\ntype RovingFocusGroupElement = RovingFocusGroupImplElement;\ninterface RovingFocusGroupProps extends RovingFocusGroupImplProps {}\n\nconst RovingFocusGroup = React.forwardRef<RovingFocusGroupElement, RovingFocusGroupProps>(\n  (props: ScopedProps<RovingFocusGroupProps>, forwardedRef) => {\n    return (\n      <Collection.Provider scope={props.__scopeRovingFocusGroup}>\n        <Collection.Slot scope={props.__scopeRovingFocusGroup}>\n          <RovingFocusGroupImpl {...props} ref={forwardedRef} />\n        </Collection.Slot>\n      </Collection.Provider>\n    );\n  }\n);\n\nRovingFocusGroup.displayName = GROUP_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype RovingFocusGroupImplElement = React.ComponentRef<typeof Primitive.div>;\ntype PrimitiveDivProps = React.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface RovingFocusGroupImplProps\n  extends Omit<PrimitiveDivProps, 'dir'>,\n    RovingFocusGroupOptions {\n  currentTabStopId?: string | null;\n  defaultCurrentTabStopId?: string;\n  onCurrentTabStopIdChange?: (tabStopId: string | null) => void;\n  onEntryFocus?: (event: Event) => void;\n  preventScrollOnEntryFocus?: boolean;\n}\n\nconst RovingFocusGroupImpl = React.forwardRef<\n  RovingFocusGroupImplElement,\n  RovingFocusGroupImplProps\n>((props: ScopedProps<RovingFocusGroupImplProps>, forwardedRef) => {\n  const {\n    __scopeRovingFocusGroup,\n    orientation,\n    loop = false,\n    dir,\n    currentTabStopId: currentTabStopIdProp,\n    defaultCurrentTabStopId,\n    onCurrentTabStopIdChange,\n    onEntryFocus,\n    preventScrollOnEntryFocus = false,\n    ...groupProps\n  } = props;\n  const ref = React.useRef<RovingFocusGroupImplElement>(null);\n  const composedRefs = useComposedRefs(forwardedRef, ref);\n  const direction = useDirection(dir);\n  const [currentTabStopId, setCurrentTabStopId] = useControllableState({\n    prop: currentTabStopIdProp,\n    defaultProp: defaultCurrentTabStopId ?? null,\n    onChange: onCurrentTabStopIdChange,\n    caller: GROUP_NAME,\n  });\n  const [isTabbingBackOut, setIsTabbingBackOut] = React.useState(false);\n  const handleEntryFocus = useCallbackRef(onEntryFocus);\n  const getItems = useCollection(__scopeRovingFocusGroup);\n  const isClickFocusRef = React.useRef(false);\n  const [focusableItemsCount, setFocusableItemsCount] = React.useState(0);\n\n  React.useEffect(() => {\n    const node = ref.current;\n    if (node) {\n      node.addEventListener(ENTRY_FOCUS, handleEntryFocus);\n      return () => node.removeEventListener(ENTRY_FOCUS, handleEntryFocus);\n    }\n  }, [handleEntryFocus]);\n\n  return (\n    <RovingFocusProvider\n      scope={__scopeRovingFocusGroup}\n      orientation={orientation}\n      dir={direction}\n      loop={loop}\n      currentTabStopId={currentTabStopId}\n      onItemFocus={React.useCallback(\n        (tabStopId) => setCurrentTabStopId(tabStopId),\n        [setCurrentTabStopId]\n      )}\n      onItemShiftTab={React.useCallback(() => setIsTabbingBackOut(true), [])}\n      onFocusableItemAdd={React.useCallback(\n        () => setFocusableItemsCount((prevCount) => prevCount + 1),\n        []\n      )}\n      onFocusableItemRemove={React.useCallback(\n        () => setFocusableItemsCount((prevCount) => prevCount - 1),\n        []\n      )}\n    >\n      <Primitive.div\n        tabIndex={isTabbingBackOut || focusableItemsCount === 0 ? -1 : 0}\n        data-orientation={orientation}\n        {...groupProps}\n        ref={composedRefs}\n        style={{ outline: 'none', ...props.style }}\n        onMouseDown={composeEventHandlers(props.onMouseDown, () => {\n          isClickFocusRef.current = true;\n        })}\n        onFocus={composeEventHandlers(props.onFocus, (event) => {\n          // We normally wouldn't need this check, because we already check\n          // that the focus is on the current target and not bubbling to it.\n          // We do this because Safari doesn't focus buttons when clicked, and\n          // instead, the wrapper will get focused and not through a bubbling event.\n          const isKeyboardFocus = !isClickFocusRef.current;\n\n          if (event.target === event.currentTarget && isKeyboardFocus && !isTabbingBackOut) {\n            const entryFocusEvent = new CustomEvent(ENTRY_FOCUS, EVENT_OPTIONS);\n            event.currentTarget.dispatchEvent(entryFocusEvent);\n\n            if (!entryFocusEvent.defaultPrevented) {\n              const items = getItems().filter((item) => item.focusable);\n              const activeItem = items.find((item) => item.active);\n              const currentItem = items.find((item) => item.id === currentTabStopId);\n              const candidateItems = [activeItem, currentItem, ...items].filter(\n                Boolean\n              ) as typeof items;\n              const candidateNodes = candidateItems.map((item) => item.ref.current!);\n              focusFirst(candidateNodes, preventScrollOnEntryFocus);\n            }\n          }\n\n          isClickFocusRef.current = false;\n        })}\n        onBlur={composeEventHandlers(props.onBlur, () => setIsTabbingBackOut(false))}\n      />\n    </RovingFocusProvider>\n  );\n});\n\n/* -------------------------------------------------------------------------------------------------\n * RovingFocusGroupItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_NAME = 'RovingFocusGroupItem';\n\ntype RovingFocusItemElement = React.ComponentRef<typeof Primitive.span>;\ntype PrimitiveSpanProps = React.ComponentPropsWithoutRef<typeof Primitive.span>;\ninterface RovingFocusItemProps extends Omit<PrimitiveSpanProps, 'children'> {\n  tabStopId?: string;\n  focusable?: boolean;\n  active?: boolean;\n  children?:\n    | React.ReactNode\n    | ((props: { hasTabStop: boolean; isCurrentTabStop: boolean }) => React.ReactNode);\n}\n\nconst RovingFocusGroupItem = React.forwardRef<RovingFocusItemElement, RovingFocusItemProps>(\n  (props: ScopedProps<RovingFocusItemProps>, forwardedRef) => {\n    const {\n      __scopeRovingFocusGroup,\n      focusable = true,\n      active = false,\n      tabStopId,\n      children,\n      ...itemProps\n    } = props;\n    const autoId = useId();\n    const id = tabStopId || autoId;\n    const context = useRovingFocusContext(ITEM_NAME, __scopeRovingFocusGroup);\n    const isCurrentTabStop = context.currentTabStopId === id;\n    const getItems = useCollection(__scopeRovingFocusGroup);\n\n    const { onFocusableItemAdd, onFocusableItemRemove, currentTabStopId } = context;\n\n    React.useEffect(() => {\n      if (focusable) {\n        onFocusableItemAdd();\n        return () => onFocusableItemRemove();\n      }\n    }, [focusable, onFocusableItemAdd, onFocusableItemRemove]);\n\n    return (\n      <Collection.ItemSlot\n        scope={__scopeRovingFocusGroup}\n        id={id}\n        focusable={focusable}\n        active={active}\n      >\n        <Primitive.span\n          tabIndex={isCurrentTabStop ? 0 : -1}\n          data-orientation={context.orientation}\n          {...itemProps}\n          ref={forwardedRef}\n          onMouseDown={composeEventHandlers(props.onMouseDown, (event) => {\n            // We prevent focusing non-focusable items on `mousedown`.\n            // Even though the item has tabIndex={-1}, that only means take it out of the tab order.\n            if (!focusable) event.preventDefault();\n            // Safari doesn't focus a button when clicked so we run our logic on mousedown also\n            else context.onItemFocus(id);\n          })}\n          onFocus={composeEventHandlers(props.onFocus, () => context.onItemFocus(id))}\n          onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n            if (event.key === 'Tab' && event.shiftKey) {\n              context.onItemShiftTab();\n              return;\n            }\n\n            if (event.target !== event.currentTarget) return;\n\n            const focusIntent = getFocusIntent(event, context.orientation, context.dir);\n\n            if (focusIntent !== undefined) {\n              if (event.metaKey || event.ctrlKey || event.altKey || event.shiftKey) return;\n              event.preventDefault();\n              const items = getItems().filter((item) => item.focusable);\n              let candidateNodes = items.map((item) => item.ref.current!);\n\n              if (focusIntent === 'last') candidateNodes.reverse();\n              else if (focusIntent === 'prev' || focusIntent === 'next') {\n                if (focusIntent === 'prev') candidateNodes.reverse();\n                const currentIndex = candidateNodes.indexOf(event.currentTarget);\n                candidateNodes = context.loop\n                  ? wrapArray(candidateNodes, currentIndex + 1)\n                  : candidateNodes.slice(currentIndex + 1);\n              }\n\n              /**\n               * Imperative focus during keydown is risky so we prevent React's batching updates\n               * to avoid potential bugs. See: https://github.com/facebook/react/issues/20332\n               */\n              setTimeout(() => focusFirst(candidateNodes));\n            }\n          })}\n        >\n          {typeof children === 'function'\n            ? children({ isCurrentTabStop, hasTabStop: currentTabStopId != null })\n            : children}\n        </Primitive.span>\n      </Collection.ItemSlot>\n    );\n  }\n);\n\nRovingFocusGroupItem.displayName = ITEM_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\n// prettier-ignore\nconst MAP_KEY_TO_FOCUS_INTENT: Record<string, FocusIntent> = {\n  ArrowLeft: 'prev', ArrowUp: 'prev',\n  ArrowRight: 'next', ArrowDown: 'next',\n  PageUp: 'first', Home: 'first',\n  PageDown: 'last', End: 'last',\n};\n\nfunction getDirectionAwareKey(key: string, dir?: Direction) {\n  if (dir !== 'rtl') return key;\n  return key === 'ArrowLeft' ? 'ArrowRight' : key === 'ArrowRight' ? 'ArrowLeft' : key;\n}\n\ntype FocusIntent = 'first' | 'last' | 'prev' | 'next';\n\nfunction getFocusIntent(event: React.KeyboardEvent, orientation?: Orientation, dir?: Direction) {\n  const key = getDirectionAwareKey(event.key, dir);\n  if (orientation === 'vertical' && ['ArrowLeft', 'ArrowRight'].includes(key)) return undefined;\n  if (orientation === 'horizontal' && ['ArrowUp', 'ArrowDown'].includes(key)) return undefined;\n  return MAP_KEY_TO_FOCUS_INTENT[key];\n}\n\nfunction focusFirst(candidates: HTMLElement[], preventScroll = false) {\n  const PREVIOUSLY_FOCUSED_ELEMENT = document.activeElement;\n  for (const candidate of candidates) {\n    // if focus is already where we want to go, we don't want to keep going through the candidates\n    if (candidate === PREVIOUSLY_FOCUSED_ELEMENT) return;\n    candidate.focus({ preventScroll });\n    if (document.activeElement !== PREVIOUSLY_FOCUSED_ELEMENT) return;\n  }\n}\n\n/**\n * Wraps an array around itself at a given start index\n * Example: `wrapArray(['a', 'b', 'c', 'd'], 2) === ['c', 'd', 'a', 'b']`\n */\nfunction wrapArray<T>(array: T[], startIndex: number) {\n  return array.map<T>((_, index) => array[(startIndex + index) % array.length]!);\n}\n\nconst Root = RovingFocusGroup;\nconst Item = RovingFocusGroupItem;\n\nexport {\n  createRovingFocusGroupScope,\n  //\n  RovingFocusGroup,\n  RovingFocusGroupItem,\n  //\n  Root,\n  Item,\n};\nexport type { RovingFocusGroupProps, RovingFocusItemProps };\n", "\"use client\";\n\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\";\nimport type { ReactNode } from \"react\";\nimport { forwardRef } from \"react\";\n\nimport { useLiveblocksUiConfig } from \"../../config\";\nimport {\n  FLOATING_ELEMENT_COLLISION_PADDING,\n  FLOATING_ELEMENT_SIDE_OFFSET,\n} from \"../../constants\";\nimport { useOverrides } from \"../../overrides\";\nimport { cn } from \"../../utils/cn\";\n\nexport interface DropdownProps\n  extends Pick<\n      DropdownMenuPrimitive.DropdownMenuProps,\n      \"defaultOpen\" | \"open\" | \"onOpenChange\"\n    >,\n    Pick<DropdownMenuPrimitive.DropdownMenuTriggerProps, \"children\">,\n    Omit<DropdownMenuPrimitive.DropdownMenuContentProps, \"content\"> {\n  content: ReactNode;\n}\n\ninterface DropdownItemProps\n  extends DropdownMenuPrimitive.DropdownMenuItemProps {\n  icon?: ReactNode;\n}\n\nexport function Dropdown({\n  children,\n  content,\n  defaultOpen,\n  open,\n  onOpenChange,\n  className,\n  ...props\n}: DropdownProps) {\n  const $ = useOverrides();\n  const { portalContainer } = useLiveblocksUiConfig();\n\n  return (\n    <DropdownMenuPrimitive.Root\n      defaultOpen={defaultOpen}\n      open={open}\n      onOpenChange={onOpenChange}\n      dir={$.dir}\n    >\n      {children}\n      <DropdownMenuPrimitive.Portal container={portalContainer}>\n        <DropdownMenuPrimitive.Content\n          className={cn(\n            \"lb-root lb-portal lb-elevation lb-dropdown\",\n            className\n          )}\n          sideOffset={FLOATING_ELEMENT_SIDE_OFFSET}\n          collisionPadding={FLOATING_ELEMENT_COLLISION_PADDING}\n          {...props}\n        >\n          {content}\n        </DropdownMenuPrimitive.Content>\n      </DropdownMenuPrimitive.Portal>\n    </DropdownMenuPrimitive.Root>\n  );\n}\n\nexport const DropdownItem = forwardRef<HTMLDivElement, DropdownItemProps>(\n  ({ children, className, icon, ...props }, forwardedRef) => {\n    return (\n      <DropdownMenuPrimitive.DropdownMenuItem\n        className={cn(\"lb-dropdown-item\", className)}\n        {...props}\n        ref={forwardedRef}\n      >\n        {icon ? (\n          <span className=\"lb-dropdown-item-icon lb-icon-container\">\n            {icon}\n          </span>\n        ) : null}\n        {children ? (\n          <span className=\"lb-dropdown-item-label\">{children}</span>\n        ) : null}\n      </DropdownMenuPrimitive.DropdownMenuItem>\n    );\n  }\n);\n\nexport { DropdownMenuTrigger as DropdownTrigger } from \"@radix-ui/react-dropdown-menu\";\n", "\"use client\";\n\nimport {\n  assertNever,\n  type CommentAttachment,\n  type CommentData,\n  type CommentReaction as CommentReactionData,\n  type GroupMentionData,\n  MENTION_CHARACTER,\n  type MentionData,\n  Permission,\n} from \"@liveblocks/core\";\nimport {\n  useAddRoomCommentReaction,\n  useDeleteRoomComment,\n  useEditRoomComment,\n  useMarkRoomThreadAsRead,\n  useRemoveRoomCommentReaction,\n  useRoomAttachmentUrl,\n  useRoomPermissions,\n} from \"@liveblocks/react/_private\";\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\";\nimport type {\n  ComponentProps,\n  ComponentPropsWithoutRef,\n  FormEvent,\n  MouseEvent,\n  ReactNode,\n  RefObject,\n  SyntheticEvent,\n} from \"react\";\nimport {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport {\n  ComponentsProvider,\n  type GlobalComponents,\n  useComponents,\n} from \"../components\";\nimport { CheckIcon } from \"../icons/Check\";\nimport { CrossIcon } from \"../icons/Cross\";\nimport { DeleteIcon } from \"../icons/Delete\";\nimport { EditIcon } from \"../icons/Edit\";\nimport { EllipsisIcon } from \"../icons/Ellipsis\";\nimport { EmojiPlusIcon } from \"../icons/EmojiPlus\";\nimport type {\n  CommentOverrides,\n  ComposerOverrides,\n  GlobalOverrides,\n} from \"../overrides\";\nimport { useOverrides } from \"../overrides\";\nimport type { ComposerSubmitComment } from \"../primitives\";\nimport * as CommentPrimitive from \"../primitives/Comment\";\nimport type {\n  CommentBodyLinkProps,\n  CommentBodyMentionProps,\n  CommentLinkProps,\n  CommentMentionProps as CommentPrimitiveMentionProps,\n} from \"../primitives/Comment/types\";\nimport * as ComposerPrimitive from \"../primitives/Composer\";\nimport { Timestamp } from \"../primitives/Timestamp\";\nimport { useCurrentUserId } from \"../shared\";\nimport type { CommentAttachmentArgs } from \"../types\";\nimport { cn } from \"../utils/cn\";\nimport { download } from \"../utils/download\";\nimport { useIsGroupMentionMember } from \"../utils/use-group-mention\";\nimport { useRefs } from \"../utils/use-refs\";\nimport { useIntersectionCallback } from \"../utils/use-visible\";\nimport { useWindowFocus } from \"../utils/use-window-focus\";\nimport type { ComposerProps } from \"./Composer\";\nimport { Composer } from \"./Composer\";\nimport {\n  FileAttachment,\n  MediaAttachment,\n  separateMediaAttachments,\n} from \"./internal/Attachment\";\nimport { Avatar } from \"./internal/Avatar\";\nimport { Button, CustomButton } from \"./internal/Button\";\nimport { Dropdown, DropdownItem, DropdownTrigger } from \"./internal/Dropdown\";\nimport { Emoji } from \"./internal/Emoji\";\nimport { EmojiPicker, EmojiPickerTrigger } from \"./internal/EmojiPicker\";\nimport { Group } from \"./internal/Group\";\nimport { List } from \"./internal/List\";\nimport { ShortcutTooltip, Tooltip, TooltipProvider } from \"./internal/Tooltip\";\nimport { User } from \"./internal/User\";\n\nconst REACTIONS_TRUNCATE = 5;\n\nexport interface CommentProps extends ComponentPropsWithoutRef<\"div\"> {\n  /**\n   * The comment to display.\n   */\n  comment: CommentData;\n\n  /**\n   * How to show or hide the actions.\n   */\n  showActions?: boolean | \"hover\";\n\n  /**\n   * Whether to show the comment if it was deleted. If set to `false`, it will render deleted comments as `null`.\n   */\n  showDeleted?: boolean;\n\n  /**\n   * Whether to show reactions.\n   */\n  showReactions?: boolean;\n\n  /**\n   * Whether to show attachments.\n   */\n  showAttachments?: boolean;\n\n  /**\n   * Whether to show the composer's formatting controls when editing the comment.\n   */\n  showComposerFormattingControls?: ComposerProps[\"showFormattingControls\"];\n\n  /**\n   * Whether to indent the comment's content.\n   */\n  indentContent?: boolean;\n\n  /**\n   * The event handler called when the comment is edited.\n   */\n  onCommentEdit?: (comment: CommentData) => void;\n\n  /**\n   * The event handler called when the comment is deleted.\n   */\n  onCommentDelete?: (comment: CommentData) => void;\n\n  /**\n   * The event handler called when clicking on the author.\n   */\n  onAuthorClick?: (userId: string, event: MouseEvent<HTMLElement>) => void;\n\n  /**\n   * The event handler called when clicking on a mention.\n   */\n  onMentionClick?: (\n    mention: MentionData,\n    event: MouseEvent<HTMLElement>\n  ) => void;\n\n  /**\n   * The event handler called when clicking on a comment's attachment.\n   */\n  onAttachmentClick?: (\n    args: CommentAttachmentArgs,\n    event: MouseEvent<HTMLElement>\n  ) => void;\n\n  /**\n   * Override the component's strings.\n   */\n  overrides?: Partial<GlobalOverrides & CommentOverrides & ComposerOverrides>;\n\n  /**\n   * Override the component's components.\n   */\n  components?: Partial<GlobalComponents>;\n\n  /**\n   * @internal\n   */\n  autoMarkReadThreadId?: string;\n\n  /**\n   * @internal\n   */\n  additionalActions?: ReactNode;\n\n  /**\n   * @internal\n   */\n  additionalDropdownItemsBefore?: ReactNode;\n\n  /**\n   * @internal\n   */\n  additionalDropdownItemsAfter?: ReactNode;\n\n  /**\n   * @internal\n   */\n  additionalActionsClassName?: string;\n}\n\ninterface CommentReactionButtonProps\n  extends ComponentPropsWithoutRef<typeof Button> {\n  reaction: CommentReactionData;\n  overrides?: Partial<GlobalOverrides & CommentOverrides>;\n}\n\ninterface CommentReactionProps extends ComponentPropsWithoutRef<\"button\"> {\n  comment: CommentData;\n  reaction: CommentReactionData;\n  overrides?: Partial<GlobalOverrides & CommentOverrides>;\n}\n\ntype CommentNonInteractiveReactionProps = Omit<CommentReactionProps, \"comment\">;\n\ninterface CommentAttachmentProps extends ComponentProps<typeof FileAttachment> {\n  attachment: CommentAttachment;\n  onAttachmentClick?: CommentProps[\"onAttachmentClick\"];\n}\n\ninterface CommentMentionProps\n  extends CommentBodyMentionProps,\n    CommentPrimitiveMentionProps {\n  overrides?: CommentProps[\"overrides\"];\n}\n\nfunction CommentUserMention({\n  mention,\n  className,\n  ...props\n}: CommentMentionProps) {\n  const currentId = useCurrentUserId();\n\n  return (\n    <CommentPrimitive.Mention\n      className={cn(\"lb-mention lb-comment-mention\", className)}\n      data-self={mention.id === currentId ? \"\" : undefined}\n      {...props}\n    >\n      <span className=\"lb-mention-symbol\">{MENTION_CHARACTER}</span>\n      <User userId={mention.id} />\n    </CommentPrimitive.Mention>\n  );\n}\n\nfunction CommentGroupMention({\n  mention,\n  className,\n  ...props\n}: CommentMentionProps) {\n  const isMember = useIsGroupMentionMember(mention as GroupMentionData);\n\n  return (\n    <CommentPrimitive.Mention\n      className={cn(\"lb-mention lb-comment-mention\", className)}\n      data-self={isMember ? \"\" : undefined}\n      {...props}\n    >\n      <span className=\"lb-mention-symbol\">{MENTION_CHARACTER}</span>\n      <Group groupId={mention.id} />\n    </CommentPrimitive.Mention>\n  );\n}\n\nexport function CommentMention({ mention, ...props }: CommentMentionProps) {\n  switch (mention.kind) {\n    case \"user\":\n      return <CommentUserMention mention={mention} {...props} />;\n\n    case \"group\":\n      return <CommentGroupMention mention={mention} {...props} />;\n\n    default:\n      return assertNever(mention, \"Unhandled mention kind\");\n  }\n}\n\nexport function CommentLink({\n  href,\n  children,\n  className,\n  ...props\n}: CommentBodyLinkProps & CommentLinkProps) {\n  const { Anchor } = useComponents();\n\n  return (\n    <CommentPrimitive.Link\n      className={cn(\"lb-comment-link\", className)}\n      href={href}\n      {...props}\n      asChild\n    >\n      <Anchor {...props}>{children}</Anchor>\n    </CommentPrimitive.Link>\n  );\n}\n\nexport function CommentNonInteractiveLink({\n  href: _href,\n  children,\n  className,\n  ...props\n}: CommentBodyLinkProps & CommentLinkProps) {\n  return (\n    <span className={cn(\"lb-comment-link\", className)} {...props}>\n      {children}\n    </span>\n  );\n}\n\nconst CommentReactionButton = forwardRef<\n  HTMLButtonElement,\n  CommentReactionButtonProps\n>(({ reaction, overrides, className, ...props }, forwardedRef) => {\n  const $ = useOverrides(overrides);\n  return (\n    <CustomButton\n      className={cn(\"lb-comment-reaction\", className)}\n      variant=\"outline\"\n      aria-label={$.COMMENT_REACTION_DESCRIPTION(\n        reaction.emoji,\n        reaction.users.length\n      )}\n      {...props}\n      ref={forwardedRef}\n    >\n      <Emoji className=\"lb-comment-reaction-emoji\" emoji={reaction.emoji} />\n      <span className=\"lb-comment-reaction-count\">{reaction.users.length}</span>\n    </CustomButton>\n  );\n});\n\nexport const CommentReaction = forwardRef<\n  HTMLButtonElement,\n  CommentReactionProps\n>(({ comment, reaction, overrides, disabled, ...props }, forwardedRef) => {\n  const addReaction = useAddRoomCommentReaction(comment.roomId);\n  const removeReaction = useRemoveRoomCommentReaction(comment.roomId);\n  const currentId = useCurrentUserId();\n  const isActive = useMemo(() => {\n    return reaction.users.some((users) => users.id === currentId);\n  }, [currentId, reaction]);\n  const $ = useOverrides(overrides);\n  const tooltipContent = useMemo(\n    () => (\n      <span>\n        {$.COMMENT_REACTION_LIST(\n          <List\n            values={reaction.users.map((users) => (\n              <User key={users.id} userId={users.id} replaceSelf />\n            ))}\n            formatRemaining={$.LIST_REMAINING_USERS}\n            truncate={REACTIONS_TRUNCATE}\n            locale={$.locale}\n          />,\n          reaction.emoji,\n          reaction.users.length\n        )}\n      </span>\n    ),\n    [$, reaction]\n  );\n\n  const stopPropagation = useCallback((event: SyntheticEvent) => {\n    event.stopPropagation();\n  }, []);\n\n  const handlePressedChange = useCallback(\n    (isPressed: boolean) => {\n      if (isPressed) {\n        addReaction({\n          threadId: comment.threadId,\n          commentId: comment.id,\n          emoji: reaction.emoji,\n        });\n      } else {\n        removeReaction({\n          threadId: comment.threadId,\n          commentId: comment.id,\n          emoji: reaction.emoji,\n        });\n      }\n    },\n    [addReaction, comment.threadId, comment.id, reaction.emoji, removeReaction]\n  );\n\n  return (\n    <Tooltip\n      content={tooltipContent}\n      multiline\n      className=\"lb-comment-reaction-tooltip\"\n    >\n      <TogglePrimitive.Root\n        asChild\n        pressed={isActive}\n        onPressedChange={handlePressedChange}\n        onClick={stopPropagation}\n        disabled={disabled}\n        ref={forwardedRef}\n      >\n        <CommentReactionButton\n          data-self={isActive ? \"\" : undefined}\n          reaction={reaction}\n          overrides={overrides}\n          {...props}\n        />\n      </TogglePrimitive.Root>\n    </Tooltip>\n  );\n});\n\nexport const CommentNonInteractiveReaction = forwardRef<\n  HTMLButtonElement,\n  CommentNonInteractiveReactionProps\n>(({ reaction, overrides, ...props }, forwardedRef) => {\n  const currentId = useCurrentUserId();\n  const isActive = useMemo(() => {\n    return reaction.users.some((users) => users.id === currentId);\n  }, [currentId, reaction]);\n\n  return (\n    <CommentReactionButton\n      disableable={false}\n      data-self={isActive ? \"\" : undefined}\n      reaction={reaction}\n      overrides={overrides}\n      {...props}\n      ref={forwardedRef}\n    />\n  );\n});\n\nfunction openAttachment({ attachment, url }: CommentAttachmentArgs) {\n  // Open the attachment in a new tab if the attachment is a PDF,\n  // an image, a video, or audio. Otherwise, download it.\n  if (\n    attachment.mimeType === \"application/pdf\" ||\n    attachment.mimeType.startsWith(\"image/\") ||\n    attachment.mimeType.startsWith(\"video/\") ||\n    attachment.mimeType.startsWith(\"audio/\")\n  ) {\n    window.open(url, \"_blank\");\n  } else {\n    download(url, attachment.name);\n  }\n}\n\nfunction CommentMediaAttachment({\n  attachment,\n  onAttachmentClick,\n  roomId,\n  className,\n  overrides,\n  ...props\n}: CommentAttachmentProps & {\n  roomId: string;\n}) {\n  const { url } = useRoomAttachmentUrl(attachment.id, roomId);\n\n  const handleClick = useCallback(\n    (event: MouseEvent<HTMLElement>) => {\n      if (!url) {\n        return;\n      }\n\n      const args: CommentAttachmentArgs = { attachment, url };\n\n      onAttachmentClick?.(args, event);\n\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n\n      openAttachment(args);\n    },\n    [attachment, onAttachmentClick, url]\n  );\n\n  return (\n    <MediaAttachment\n      className={cn(\"lb-comment-attachment\", className)}\n      {...props}\n      attachment={attachment}\n      overrides={overrides}\n      onClick={url ? handleClick : undefined}\n      roomId={roomId}\n    />\n  );\n}\n\nfunction CommentFileAttachment({\n  attachment,\n  onAttachmentClick,\n  roomId,\n  className,\n  overrides,\n  ...props\n}: CommentAttachmentProps & {\n  roomId: string;\n}) {\n  const { url } = useRoomAttachmentUrl(attachment.id, roomId);\n\n  const handleClick = useCallback(\n    (event: MouseEvent<HTMLElement>) => {\n      if (!url) {\n        return;\n      }\n\n      const args: CommentAttachmentArgs = { attachment, url };\n\n      onAttachmentClick?.(args, event);\n\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n\n      openAttachment(args);\n    },\n    [attachment, onAttachmentClick, url]\n  );\n\n  return (\n    <FileAttachment\n      className={cn(\"lb-comment-attachment\", className)}\n      {...props}\n      attachment={attachment}\n      overrides={overrides}\n      onClick={url ? handleClick : undefined}\n      roomId={roomId}\n    />\n  );\n}\n\nexport function CommentNonInteractiveFileAttachment({\n  className,\n  ...props\n}: CommentAttachmentProps) {\n  return (\n    <FileAttachment\n      className={cn(\"lb-comment-attachment\", className)}\n      allowMediaPreview={false}\n      {...props}\n    />\n  );\n}\n\n// A void component (which doesn't render anything) responsible for marking a thread\n// as read when the comment it's used in becomes visible.\n// Moving this logic into a separate component allows us to use the visibility\n// and focus hooks \"conditionally\" by conditionally rendering this component.\nfunction AutoMarkReadThreadIdHandler({\n  threadId,\n  roomId,\n  commentRef,\n}: {\n  threadId: string;\n  roomId: string;\n  commentRef: RefObject<HTMLElement>;\n}) {\n  const markThreadAsRead = useMarkRoomThreadAsRead(roomId);\n  const isWindowFocused = useWindowFocus();\n\n  useIntersectionCallback(\n    commentRef,\n    (isIntersecting) => {\n      if (isIntersecting) {\n        markThreadAsRead(threadId);\n      }\n    },\n    {\n      // The underlying IntersectionObserver is only enabled when the window is focused\n      enabled: isWindowFocused,\n    }\n  );\n\n  return null;\n}\n\n/**\n * Displays a single comment.\n *\n * @example\n * <>\n *   {thread.comments.map((comment) => (\n *     <Comment key={comment.id} comment={comment} />\n *   ))}\n * </>\n */\nexport const Comment = forwardRef<HTMLDivElement, CommentProps>(\n  (\n    {\n      comment,\n      indentContent = true,\n      showDeleted,\n      showActions = \"hover\",\n      showReactions = true,\n      showAttachments = true,\n      showComposerFormattingControls = true,\n      onAuthorClick,\n      onMentionClick,\n      onAttachmentClick,\n      onCommentEdit,\n      onCommentDelete,\n      overrides,\n      components,\n      className,\n      additionalActions,\n      additionalActionsClassName,\n      additionalDropdownItemsBefore,\n      additionalDropdownItemsAfter,\n      autoMarkReadThreadId,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const ref = useRef<HTMLDivElement>(null);\n    const mergedRefs = useRefs(forwardedRef, ref);\n    const currentUserId = useCurrentUserId();\n    const deleteComment = useDeleteRoomComment(comment.roomId);\n    const editComment = useEditRoomComment(comment.roomId);\n    const addReaction = useAddRoomCommentReaction(comment.roomId);\n    const removeReaction = useRemoveRoomCommentReaction(comment.roomId);\n    const $ = useOverrides(overrides);\n    const [isEditing, setEditing] = useState(false);\n    const [isTarget, setTarget] = useState(false);\n    const [isMoreActionOpen, setMoreActionOpen] = useState(false);\n    const [isReactionActionOpen, setReactionActionOpen] = useState(false);\n    const { mediaAttachments, fileAttachments } = useMemo(() => {\n      return separateMediaAttachments(comment.attachments);\n    }, [comment.attachments]);\n\n    const permissions = useRoomPermissions(comment.roomId);\n    const canComment =\n      permissions.size > 0\n        ? permissions.has(Permission.CommentsWrite) ||\n          permissions.has(Permission.Write)\n        : true;\n\n    const stopPropagation = useCallback((event: SyntheticEvent) => {\n      event.stopPropagation();\n    }, []);\n\n    const handleEdit = useCallback(() => {\n      setEditing(true);\n    }, []);\n\n    const handleEditCancel = useCallback(\n      (event: MouseEvent<HTMLButtonElement>) => {\n        event.stopPropagation();\n        setEditing(false);\n      },\n      []\n    );\n\n    const handleEditSubmit = useCallback(\n      (\n        { body, attachments }: ComposerSubmitComment,\n        event: FormEvent<HTMLFormElement>\n      ) => {\n        // TODO: Add a way to preventDefault from within this callback, to override the default behavior (e.g. showing a confirmation dialog)\n        onCommentEdit?.(comment);\n\n        if (event.isDefaultPrevented()) {\n          return;\n        }\n\n        event.stopPropagation();\n        event.preventDefault();\n\n        setEditing(false);\n        editComment({\n          commentId: comment.id,\n          threadId: comment.threadId,\n          body,\n          attachments,\n        });\n      },\n      [comment, editComment, onCommentEdit]\n    );\n\n    const handleDelete = useCallback(() => {\n      // TODO: Add a way to preventDefault from within this callback, to override the default behavior (e.g. showing a confirmation dialog)\n      onCommentDelete?.(comment);\n\n      deleteComment({\n        commentId: comment.id,\n        threadId: comment.threadId,\n      });\n    }, [comment, deleteComment, onCommentDelete]);\n\n    const handleAuthorClick = useCallback(\n      (event: MouseEvent<HTMLElement>) => {\n        onAuthorClick?.(comment.userId, event);\n      },\n      [comment.userId, onAuthorClick]\n    );\n\n    const handleReactionSelect = useCallback(\n      (emoji: string) => {\n        const reactionIndex = comment.reactions.findIndex(\n          (reaction) => reaction.emoji === emoji\n        );\n\n        if (\n          reactionIndex >= 0 &&\n          currentUserId &&\n          comment.reactions[reactionIndex]?.users.some(\n            (user) => user.id === currentUserId\n          )\n        ) {\n          removeReaction({\n            threadId: comment.threadId,\n            commentId: comment.id,\n            emoji,\n          });\n        } else {\n          addReaction({\n            threadId: comment.threadId,\n            commentId: comment.id,\n            emoji,\n          });\n        }\n      },\n      [\n        addReaction,\n        comment.id,\n        comment.reactions,\n        comment.threadId,\n        removeReaction,\n        currentUserId,\n      ]\n    );\n\n    useEffect(() => {\n      const isWindowDefined = typeof window !== \"undefined\";\n      if (!isWindowDefined) return;\n\n      const hash = window.location.hash;\n      const commentId = hash.slice(1);\n\n      if (commentId === comment.id) {\n        setTarget(true);\n      }\n    }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n    if (!showDeleted && !comment.body) {\n      return null;\n    }\n\n    return (\n      <TooltipProvider>\n        <ComponentsProvider components={components}>\n          {autoMarkReadThreadId && (\n            <AutoMarkReadThreadIdHandler\n              commentRef={ref}\n              threadId={autoMarkReadThreadId}\n              roomId={comment.roomId}\n            />\n          )}\n          <div\n            id={comment.id}\n            className={cn(\n              \"lb-root lb-comment\",\n              indentContent && \"lb-comment:indent-content\",\n              showActions === \"hover\" && \"lb-comment:show-actions-hover\",\n              (isMoreActionOpen || isReactionActionOpen) &&\n                \"lb-comment:action-open\",\n              className\n            )}\n            data-deleted={!comment.body ? \"\" : undefined}\n            data-editing={isEditing ? \"\" : undefined}\n            // In some cases, `:target` doesn't work as expected so we also define it manually.\n            data-target={isTarget ? \"\" : undefined}\n            dir={$.dir}\n            {...props}\n            ref={mergedRefs}\n          >\n            <div className=\"lb-comment-header\">\n              <div className=\"lb-comment-details\">\n                <Avatar\n                  className=\"lb-comment-avatar\"\n                  userId={comment.userId}\n                  onClick={handleAuthorClick}\n                />\n                <span className=\"lb-comment-details-labels\">\n                  <User\n                    className=\"lb-comment-author\"\n                    userId={comment.userId}\n                    onClick={handleAuthorClick}\n                  />\n                  <span className=\"lb-comment-date\">\n                    <Timestamp\n                      locale={$.locale}\n                      date={comment.createdAt}\n                      className=\"lb-date lb-comment-date-created\"\n                    />\n                    {comment.editedAt && comment.body && (\n                      <>\n                        {\" \"}\n                        <span className=\"lb-comment-date-edited\">\n                          {$.COMMENT_EDITED}\n                        </span>\n                      </>\n                    )}\n                  </span>\n                </span>\n              </div>\n              {showActions && !isEditing && (\n                <div\n                  className={cn(\n                    \"lb-comment-actions\",\n                    additionalActionsClassName\n                  )}\n                >\n                  {additionalActions ?? null}\n                  {showReactions && canComment ? (\n                    <EmojiPicker\n                      onEmojiSelect={handleReactionSelect}\n                      onOpenChange={setReactionActionOpen}\n                    >\n                      <Tooltip content={$.COMMENT_ADD_REACTION}>\n                        <EmojiPickerTrigger asChild>\n                          <Button\n                            className=\"lb-comment-action\"\n                            onClick={stopPropagation}\n                            aria-label={$.COMMENT_ADD_REACTION}\n                            icon={<EmojiPlusIcon />}\n                          />\n                        </EmojiPickerTrigger>\n                      </Tooltip>\n                    </EmojiPicker>\n                  ) : null}\n                  {comment.userId === currentUserId ||\n                  additionalDropdownItemsBefore ||\n                  additionalDropdownItemsAfter ? (\n                    <Dropdown\n                      open={isMoreActionOpen}\n                      onOpenChange={setMoreActionOpen}\n                      align=\"end\"\n                      content={\n                        <>\n                          {additionalDropdownItemsBefore}\n                          {comment.userId === currentUserId && (\n                            <>\n                              <DropdownItem\n                                onSelect={handleEdit}\n                                onClick={stopPropagation}\n                                icon={<EditIcon />}\n                              >\n                                {$.COMMENT_EDIT}\n                              </DropdownItem>\n                              <DropdownItem\n                                onSelect={handleDelete}\n                                onClick={stopPropagation}\n                                icon={<DeleteIcon />}\n                              >\n                                {$.COMMENT_DELETE}\n                              </DropdownItem>\n                            </>\n                          )}\n                          {additionalDropdownItemsAfter}\n                        </>\n                      }\n                    >\n                      <Tooltip content={$.COMMENT_MORE}>\n                        <DropdownTrigger asChild>\n                          <Button\n                            className=\"lb-comment-action\"\n                            disabled={!comment.body}\n                            onClick={stopPropagation}\n                            aria-label={$.COMMENT_MORE}\n                            icon={<EllipsisIcon />}\n                          />\n                        </DropdownTrigger>\n                      </Tooltip>\n                    </Dropdown>\n                  ) : null}\n                </div>\n              )}\n            </div>\n            <div className=\"lb-comment-content\">\n              {isEditing ? (\n                <Composer\n                  className=\"lb-comment-composer\"\n                  onComposerSubmit={handleEditSubmit}\n                  defaultValue={comment.body}\n                  defaultAttachments={comment.attachments}\n                  autoFocus\n                  showAttribution={false}\n                  showAttachments={showAttachments}\n                  showFormattingControls={showComposerFormattingControls}\n                  actions={\n                    <>\n                      <Tooltip\n                        content={$.COMMENT_EDIT_COMPOSER_CANCEL}\n                        aria-label={$.COMMENT_EDIT_COMPOSER_CANCEL}\n                      >\n                        <Button\n                          className=\"lb-composer-action\"\n                          onClick={handleEditCancel}\n                          icon={<CrossIcon />}\n                        />\n                      </Tooltip>\n                      <ShortcutTooltip\n                        content={$.COMMENT_EDIT_COMPOSER_SAVE}\n                        shortcut=\"Enter\"\n                      >\n                        <ComposerPrimitive.Submit asChild>\n                          <Button\n                            variant=\"primary\"\n                            className=\"lb-composer-action\"\n                            onClick={stopPropagation}\n                            aria-label={$.COMMENT_EDIT_COMPOSER_SAVE}\n                            icon={<CheckIcon />}\n                          />\n                        </ComposerPrimitive.Submit>\n                      </ShortcutTooltip>\n                    </>\n                  }\n                  overrides={{\n                    COMPOSER_PLACEHOLDER: $.COMMENT_EDIT_COMPOSER_PLACEHOLDER,\n                  }}\n                  roomId={comment.roomId}\n                />\n              ) : comment.body ? (\n                <>\n                  <CommentPrimitive.Body\n                    className=\"lb-comment-body\"\n                    body={comment.body}\n                    components={{\n                      Mention: ({ mention }) => (\n                        <CommentMention\n                          mention={mention}\n                          onClick={(event) => onMentionClick?.(mention, event)}\n                          overrides={overrides}\n                        />\n                      ),\n                      Link: CommentLink,\n                    }}\n                  />\n                  {showAttachments &&\n                  (mediaAttachments.length > 0 ||\n                    fileAttachments.length > 0) ? (\n                    <div className=\"lb-comment-attachments\">\n                      {mediaAttachments.length > 0 ? (\n                        <div className=\"lb-attachments\">\n                          {mediaAttachments.map((attachment) => (\n                            <CommentMediaAttachment\n                              key={attachment.id}\n                              attachment={attachment}\n                              overrides={overrides}\n                              onAttachmentClick={onAttachmentClick}\n                              roomId={comment.roomId}\n                            />\n                          ))}\n                        </div>\n                      ) : null}\n                      {fileAttachments.length > 0 ? (\n                        <div className=\"lb-attachments\">\n                          {fileAttachments.map((attachment) => (\n                            <CommentFileAttachment\n                              key={attachment.id}\n                              attachment={attachment}\n                              overrides={overrides}\n                              onAttachmentClick={onAttachmentClick}\n                              roomId={comment.roomId}\n                            />\n                          ))}\n                        </div>\n                      ) : null}\n                    </div>\n                  ) : null}\n                  {showReactions && comment.reactions.length > 0 && (\n                    <div className=\"lb-comment-reactions\">\n                      {comment.reactions.map((reaction) => (\n                        <CommentReaction\n                          key={reaction.emoji}\n                          comment={comment}\n                          reaction={reaction}\n                          overrides={overrides}\n                          disabled={!canComment}\n                        />\n                      ))}\n                      {canComment ? (\n                        <EmojiPicker onEmojiSelect={handleReactionSelect}>\n                          <Tooltip content={$.COMMENT_ADD_REACTION}>\n                            <EmojiPickerTrigger asChild>\n                              <Button\n                                className=\"lb-comment-reaction lb-comment-reaction-add\"\n                                variant=\"outline\"\n                                onClick={stopPropagation}\n                                aria-label={$.COMMENT_ADD_REACTION}\n                                icon={<EmojiPlusIcon />}\n                              />\n                            </EmojiPickerTrigger>\n                          </Tooltip>\n                        </EmojiPicker>\n                      ) : null}\n                    </div>\n                  )}\n                </>\n              ) : (\n                <div className=\"lb-comment-body\">\n                  <p className=\"lb-comment-deleted\">{$.COMMENT_DELETED}</p>\n                </div>\n              )}\n            </div>\n          </div>\n        </ComponentsProvider>\n      </TooltipProvider>\n    );\n  }\n);\n", "\"use client\";\n\nimport type { HistoryVersion } from \"@liveblocks/core\";\nimport type { ComponentPropsWithoutRef } from \"react\";\nimport { forwardRef } from \"react\";\n\nimport { useOverrides } from \"../overrides\";\nimport { Timestamp } from \"../primitives\";\nimport { cn } from \"../utils/cn\";\nimport { List } from \"./internal/List\";\nimport { User } from \"./internal/User\";\n\nconst AUTHORS_TRUNCATE = 3;\n\nexport interface HistoryVersionSummaryProps\n  extends ComponentPropsWithoutRef<\"button\"> {\n  version: HistoryVersion;\n  selected?: boolean;\n}\n\n/**\n * Displays some information about a version.\n *\n * @example\n * <HistoryVersionSummary version={version} />\n */\nexport const HistoryVersionSummary = forwardRef<\n  HTMLButtonElement,\n  HistoryVersionSummaryProps\n>(({ version, selected, className, ...props }, forwardedRef) => {\n  const $ = useOverrides();\n\n  return (\n    <button\n      {...props}\n      className={cn(\"lb-root lb-history-version-summary\", className)}\n      ref={forwardedRef}\n      data-selected={selected ? \"\" : undefined}\n    >\n      <Timestamp\n        locale={$.locale}\n        date={version.createdAt}\n        className=\"lb-date lb-history-version-summary-date\"\n      />\n      <span className=\"lb-history-version-summary-authors\">\n        <List\n          values={version.authors.map((author) => (\n            <User key={author.id} userId={author.id} replaceSelf />\n          ))}\n          formatRemaining={$.LIST_REMAINING_USERS}\n          truncate={AUTHORS_TRUNCATE}\n          locale={$.locale}\n        />\n      </span>\n    </button>\n  );\n});\n", "\"use client\";\n\nimport type { ComponentPropsWithoutRef } from \"react\";\nimport { Children, forwardRef } from \"react\";\n\nimport { cn } from \"../utils/cn\";\n\nexport type HistoryVersionSummaryListProps = ComponentPropsWithoutRef<\"ol\">;\n\n/**\n * Displays versions summaries as a list.\n *\n * @example\n * <HistoryVersionSummaryList>\n *   {versions.map((version) => (\n *     <HistoryVersionSummary key={version.id} version={version} />\n *   ))}\n * </HistoryVersionSummaryList>\n */\nexport const HistoryVersionSummaryList = forwardRef<\n  HTMLOListElement,\n  HistoryVersionSummaryListProps\n>(({ children, className, ...props }, forwardedRef) => {\n  return (\n    <ol\n      className={cn(\"lb-root lb-history-version-summary-list\", className)}\n      {...props}\n      ref={forwardedRef}\n    >\n      {Children.map(children, (child, index) => (\n        <li key={index} className=\"lb-history-version-summary-list-item\">\n          {child}\n        </li>\n      ))}\n    </ol>\n  );\n});\n", "import type {\n  BaseMetadata,\n  Client,\n  CommentData,\n  InboxNotificationThreadData,\n  ThreadData,\n} from \"@liveblocks/core\";\nimport { getMentionsFromCommentBody, kInternal } from \"@liveblocks/core\";\nimport type { ComponentProps } from \"react\";\n\nimport {\n  type CommentOverrides,\n  type GlobalOverrides,\n  useOverrides,\n} from \"../../overrides\";\nimport * as CommentPrimitive from \"../../primitives/Comment\";\nimport { cn } from \"../../utils/cn\";\nimport {\n  CommentMention,\n  CommentNonInteractiveFileAttachment,\n  CommentNonInteractiveLink,\n  CommentNonInteractiveReaction,\n} from \"../Comment\";\nimport { User } from \"./User\";\n\ntype InboxNotificationThreadCommentsContents = {\n  type: \"comments\";\n  unread: boolean;\n  comments: CommentData[];\n  userIds: string[];\n  date: Date;\n};\n\ntype InboxNotificationThreadMentionContents = {\n  type: \"mention\";\n  unread: boolean;\n  comments: CommentData[];\n  userIds: string[];\n  date: Date;\n};\n\nexport const INBOX_NOTIFICATION_THREAD_MAX_COMMENTS = 3;\n\ntype InboxNotificationThreadContents =\n  | InboxNotificationThreadCommentsContents\n  | InboxNotificationThreadMentionContents;\n\ninterface InboxNotificationCommentProps extends ComponentProps<\"div\"> {\n  comment: CommentData;\n  showHeader?: boolean;\n  showAttachments?: boolean;\n  showReactions?: boolean;\n  overrides?: Partial<GlobalOverrides & CommentOverrides>;\n}\n\nexport function InboxNotificationComment({\n  comment,\n  showHeader = true,\n  showAttachments = true,\n  showReactions = true,\n  overrides,\n  className,\n  ...props\n}: InboxNotificationCommentProps) {\n  const $ = useOverrides(overrides);\n\n  return (\n    <div\n      className={cn(\n        \"lb-root lb-inbox-notification-comment lb-comment\",\n        className\n      )}\n      {...props}\n    >\n      {showHeader && (\n        <div className=\"lb-comment-header\">\n          <User className=\"lb-comment-author\" userId={comment.userId} />\n        </div>\n      )}\n      <div className=\"lb-comment-content\">\n        {comment.body ? (\n          <>\n            <CommentPrimitive.Body\n              className=\"lb-comment-body\"\n              body={comment.body}\n              components={{\n                Mention: CommentMention,\n                Link: CommentNonInteractiveLink,\n              }}\n            />\n            {showReactions && comment.reactions.length > 0 && (\n              <div className=\"lb-comment-reactions\">\n                {comment.reactions.map((reaction) => (\n                  <CommentNonInteractiveReaction\n                    key={reaction.emoji}\n                    reaction={reaction}\n                    overrides={overrides}\n                    disabled\n                  />\n                ))}\n              </div>\n            )}\n            {showAttachments && comment.attachments.length > 0 ? (\n              <div className=\"lb-comment-attachments\">\n                <div className=\"lb-attachments\">\n                  {comment.attachments.map((attachment) => (\n                    <CommentNonInteractiveFileAttachment\n                      key={attachment.id}\n                      attachment={attachment}\n                      overrides={overrides}\n                      roomId={comment.roomId}\n                    />\n                  ))}\n                </div>\n              </div>\n            ) : null}\n          </>\n        ) : (\n          <div className=\"lb-comment-body\">\n            <p className=\"lb-comment-deleted\">{$.COMMENT_DELETED}</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n/**\n * Find the last comment with a mention for the given user ID,\n * unless the comment was created by the user themselves.\n */\nfunction findLastCommentWithMentionedId(\n  client: Client,\n  comments: CommentData[],\n  mentionedId: string\n) {\n  if (!comments.length) {\n    return;\n  }\n\n  for (let i = comments.length - 1; i >= 0; i--) {\n    const comment = comments[i]!;\n\n    if (comment.userId === mentionedId) {\n      continue;\n    }\n\n    if (comment.body) {\n      const mentions = getMentionsFromCommentBody(comment.body);\n\n      for (const mention of mentions) {\n        // 1. The comment contains a user mention for the current user.\n        if (mention.kind === \"user\" && mention.id === mentionedId) {\n          return comment;\n        }\n\n        // 2. The comment contains a group mention including the current user in its `userIds` array.\n        if (\n          mention.kind === \"group\" &&\n          mention.userIds?.includes(mentionedId)\n        ) {\n          return comment;\n        }\n\n        // 3. The comment contains a group mention including the current user in its managed group members.\n        if (mention.kind === \"group\" && mention.userIds === undefined) {\n          // Synchronously look up the group data for this group ID.\n          const group = client[kInternal].httpClient.groupsStore.getData(\n            mention.id\n          );\n\n          if (group?.members.some((member) => member.id === mentionedId)) {\n            return comment;\n          }\n        }\n      }\n    }\n  }\n\n  return;\n}\n\nfunction getUserIdsFromComments(comments: CommentData[]) {\n  return Array.from(new Set(comments.map((comment) => comment.userId)));\n}\n\nexport function generateInboxNotificationThreadContents(\n  client: Client,\n  inboxNotification: InboxNotificationThreadData,\n  thread: ThreadData<BaseMetadata>,\n  userId: string\n): InboxNotificationThreadContents {\n  const unreadComments = thread.comments.filter((comment) => {\n    if (!comment.body) {\n      return false;\n    }\n\n    return inboxNotification.readAt\n      ? comment.createdAt > inboxNotification.readAt &&\n          comment.createdAt <= inboxNotification.notifiedAt\n      : comment.createdAt <= inboxNotification.notifiedAt;\n  });\n\n  // If the thread is read, show the last comments.\n  if (unreadComments.length === 0) {\n    const lastComments = thread.comments\n      .filter((comment) => comment.body)\n      .slice(-INBOX_NOTIFICATION_THREAD_MAX_COMMENTS);\n\n    return {\n      type: \"comments\",\n      unread: false,\n      comments: lastComments,\n      userIds: getUserIdsFromComments(lastComments),\n      date: inboxNotification.notifiedAt,\n    };\n  }\n\n  const commentWithMention = findLastCommentWithMentionedId(\n    client,\n    unreadComments,\n    userId\n  );\n\n  // If the thread contains one or more mentions for the current user, show the last comment with a mention.\n  if (commentWithMention) {\n    return {\n      type: \"mention\",\n      unread: true,\n      comments: [commentWithMention],\n      userIds: [commentWithMention.userId],\n      date: commentWithMention.createdAt,\n    };\n  }\n\n  const lastUnreadComments = unreadComments.slice(\n    -INBOX_NOTIFICATION_THREAD_MAX_COMMENTS\n  );\n\n  // Otherwise, show the last unread comments.\n  return {\n    type: \"comments\",\n    unread: true,\n    comments: lastUnreadComments,\n    userIds: getUserIdsFromComments(unreadComments),\n    date: inboxNotification.notifiedAt,\n  };\n}\n", "\"use client\";\n\nimport { useRoomInfo } from \"@liveblocks/react\";\nimport type { ComponentProps } from \"react\";\nimport { useMemo } from \"react\";\n\nimport { cn } from \"../../utils/cn\";\n\nexport interface RoomProps extends ComponentProps<\"span\"> {\n  roomId: string;\n}\n\nexport function Room({ roomId, className, ...props }: RoomProps) {\n  const { info, isLoading } = useRoomInfo(roomId);\n  const resolvedRoomName = useMemo(() => {\n    return info?.name ?? roomId;\n  }, [info?.name, roomId]);\n\n  return (\n    <span\n      className={cn(\"lb-name lb-room\", className)}\n      data-loading={isLoading ? \"\" : undefined}\n      {...props}\n    >\n      {isLoading ? null : resolvedRoomName}\n    </span>\n  );\n}\n", "\"use client\";\n\nimport type {\n  InboxNotificationCustomData,\n  InboxNotificationData,\n  InboxNotificationTextMentionData,\n  InboxNotificationThreadData,\n  KDAD,\n} from \"@liveblocks/core\";\nimport {\n  assertNever,\n  generateUrl,\n  sanitizeUrl,\n  warnOnce,\n} from \"@liveblocks/core\";\nimport {\n  useClient,\n  useDeleteInboxNotification,\n  useInboxNotificationThread,\n  useMarkInboxNotificationAsRead,\n  useRoomInfo,\n} from \"@liveblocks/react\";\nimport { useRoomThreadSubscription } from \"@liveblocks/react/_private\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { TooltipProvider } from \"@radix-ui/react-tooltip\";\nimport type {\n  ComponentProps,\n  ComponentPropsWithoutRef,\n  ComponentType,\n  MouseEvent as ReactMouseEvent,\n  ReactNode,\n  SyntheticEvent,\n} from \"react\";\nimport { forwardRef, useCallback, useMemo, useState } from \"react\";\n\nimport type { GlobalComponents } from \"../components\";\nimport { useComponents } from \"../components\";\nimport { BellIcon } from \"../icons/Bell\";\nimport { BellCrossedIcon } from \"../icons/BellCrossed\";\nimport { CheckIcon } from \"../icons/Check\";\nimport { DeleteIcon } from \"../icons/Delete\";\nimport { EllipsisIcon } from \"../icons/Ellipsis\";\nimport { WarningIcon } from \"../icons/Warning\";\nimport type {\n  CommentOverrides,\n  GlobalOverrides,\n  InboxNotificationOverrides,\n  ThreadOverrides,\n} from \"../overrides\";\nimport { useOverrides } from \"../overrides\";\nimport { Timestamp } from \"../primitives/Timestamp\";\nimport { useCurrentUserId } from \"../shared\";\nimport type { SlotProp } from \"../types\";\nimport { cn } from \"../utils/cn\";\nimport { Avatar } from \"./internal/Avatar\";\nimport { Button } from \"./internal/Button\";\nimport { CodeBlock } from \"./internal/CodeBlock\";\nimport { Dropdown, DropdownItem, DropdownTrigger } from \"./internal/Dropdown\";\nimport {\n  generateInboxNotificationThreadContents,\n  INBOX_NOTIFICATION_THREAD_MAX_COMMENTS,\n  InboxNotificationComment,\n} from \"./internal/InboxNotificationThread\";\nimport { List } from \"./internal/List\";\nimport { Room } from \"./internal/Room\";\nimport { Tooltip } from \"./internal/Tooltip\";\nimport { User } from \"./internal/User\";\n\ntype ComponentTypeWithRef<\n  T extends keyof JSX.IntrinsicElements,\n  P,\n> = ComponentType<P & Pick<ComponentProps<T>, \"ref\">>;\n\ntype InboxNotificationKinds<KS extends KDAD = KDAD> = {\n  // For some reason, we cannot directly use KDAD in the mapped type line\n  // below, because it will result in '{}' rather than picking up the\n  // definition from the user-provided 'ActivitiesData'. Might be an internal\n  // TS optimization, so we're making it a param to defer the resolution.\n  [K in KS]: ComponentTypeWithRef<\"a\", InboxNotificationCustomKindProps<K>>;\n} & {\n  thread: ComponentTypeWithRef<\"a\", InboxNotificationThreadKindProps>;\n  textMention: ComponentTypeWithRef<\"a\", InboxNotificationTextMentionKindProps>;\n};\n\ninterface InboxNotificationSharedProps {\n  /**\n   * How to show or hide the actions.\n   */\n  showActions?: boolean | \"hover\";\n}\n\nexport interface InboxNotificationProps\n  extends Omit<ComponentPropsWithoutRef<\"a\">, \"title\">,\n    InboxNotificationSharedProps {\n  /**\n   * The inbox notification to display.\n   */\n  inboxNotification: InboxNotificationData;\n\n  /**\n   * Override specific kinds of inbox notifications.\n   */\n  kinds?: Partial<InboxNotificationKinds>;\n\n  /**\n   * Override the component's strings.\n   */\n  overrides?: Partial<\n    GlobalOverrides &\n      InboxNotificationOverrides &\n      ThreadOverrides &\n      CommentOverrides\n  >;\n\n  /**\n   * Override the component's components.\n   */\n  components?: Partial<GlobalComponents>;\n}\n\nexport interface InboxNotificationThreadProps\n  extends Omit<InboxNotificationProps, \"kinds\" | \"children\">,\n    InboxNotificationSharedProps {\n  /**\n   * The inbox notification to display.\n   */\n  inboxNotification: InboxNotificationThreadData;\n\n  /**\n   * Whether to show the room name in the title.\n   */\n  showRoomName?: boolean;\n\n  /**\n   * Whether to show reactions.\n   */\n  showReactions?: boolean;\n\n  /**\n   * Whether to show attachments.\n   */\n  showAttachments?: boolean;\n}\n\nexport interface InboxNotificationTextMentionProps\n  extends Omit<InboxNotificationProps, \"kinds\">,\n    InboxNotificationSharedProps {\n  /**\n   * The inbox notification to display.\n   */\n  inboxNotification: InboxNotificationTextMentionData;\n\n  /**\n   * Whether to show the room name in the title.\n   */\n  showRoomName?: boolean;\n}\n\nexport interface InboxNotificationInspectorProps\n  extends Omit<InboxNotificationProps, \"kinds\" | \"children\">,\n    InboxNotificationSharedProps {\n  /**\n   * The inbox notification to display.\n   */\n  inboxNotification: InboxNotificationData;\n}\n\nexport interface InboxNotificationCustomProps\n  extends Omit<InboxNotificationProps, \"kinds\">,\n    InboxNotificationSharedProps,\n    SlotProp {\n  /**\n   * The inbox notification to display.\n   */\n  inboxNotification: InboxNotificationCustomData;\n\n  /**\n   * The inbox notification's content.\n   */\n  children: ReactNode;\n\n  /**\n   * The inbox notification's title.\n   */\n  title: ReactNode;\n\n  /**\n   * The inbox notification's aside content.\n   * Can be combined with `InboxNotification.Icon` or `InboxNotification.Avatar` to easily follow default styles.\n   */\n  aside?: ReactNode;\n\n  /**\n   * Whether to mark the inbox notification as read when clicked.\n   */\n  markAsReadOnClick?: boolean;\n}\n\nexport type InboxNotificationThreadKindProps = Omit<\n  InboxNotificationProps,\n  \"kinds\"\n> & {\n  inboxNotification: InboxNotificationThreadData;\n};\n\nexport type InboxNotificationTextMentionKindProps = Omit<\n  InboxNotificationProps,\n  \"kinds\"\n> & {\n  inboxNotification: InboxNotificationTextMentionData;\n};\n\nexport type InboxNotificationCustomKindProps<K extends KDAD = KDAD> = Omit<\n  InboxNotificationProps,\n  \"kinds\"\n> & {\n  inboxNotification: InboxNotificationCustomData<K>;\n};\n\ninterface InboxNotificationLayoutProps\n  extends Omit<ComponentPropsWithoutRef<\"a\">, \"title\">,\n    InboxNotificationSharedProps,\n    SlotProp {\n  inboxNotification: InboxNotificationData;\n  aside?: ReactNode;\n  title: ReactNode;\n  date: Date | string | number;\n  unread?: boolean;\n  overrides?: Partial<GlobalOverrides & InboxNotificationOverrides>;\n  components?: Partial<GlobalComponents>;\n  markAsReadOnClick?: boolean;\n\n  /**\n   * @internal\n   */\n  additionalDropdownItemsBefore?: ReactNode;\n\n  /**\n   * @internal\n   */\n  additionalDropdownItemsAfter?: ReactNode;\n}\n\nexport type InboxNotificationIconProps = ComponentProps<\"div\">;\n\nexport interface InboxNotificationAvatarProps extends ComponentProps<\"div\"> {\n  /**\n   * The user ID to display the avatar for.\n   */\n  userId: string;\n}\n\nconst InboxNotificationLayout = forwardRef<\n  HTMLAnchorElement,\n  InboxNotificationLayoutProps\n>(\n  (\n    {\n      inboxNotification,\n      children,\n      aside,\n      title,\n      date,\n      unread,\n      markAsReadOnClick,\n      onClick,\n      href,\n      showActions,\n      overrides,\n      components,\n      className,\n      asChild,\n      additionalDropdownItemsBefore,\n      additionalDropdownItemsAfter,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const $ = useOverrides(overrides);\n    const { Anchor } = useComponents(components);\n    const Component = asChild ? Slot : Anchor;\n    const [isMoreActionOpen, setMoreActionOpen] = useState(false);\n    const markInboxNotificationAsRead = useMarkInboxNotificationAsRead();\n    const deleteInboxNotification = useDeleteInboxNotification();\n\n    const handleClick = useCallback(\n      (event: ReactMouseEvent<HTMLAnchorElement, MouseEvent>) => {\n        onClick?.(event);\n\n        const shouldMarkAsReadOnClick = markAsReadOnClick ?? Boolean(href);\n\n        if (unread && shouldMarkAsReadOnClick) {\n          markInboxNotificationAsRead(inboxNotification.id);\n        }\n      },\n      [\n        href,\n        inboxNotification.id,\n        markAsReadOnClick,\n        markInboxNotificationAsRead,\n        onClick,\n        unread,\n      ]\n    );\n\n    const stopPropagation = useCallback((event: SyntheticEvent) => {\n      event.stopPropagation();\n    }, []);\n\n    const preventDefaultAndStopPropagation = useCallback(\n      (event: SyntheticEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n      },\n      []\n    );\n\n    const handleMoreClick = useCallback((event: ReactMouseEvent) => {\n      event.preventDefault();\n      event.stopPropagation();\n      setMoreActionOpen((open) => !open);\n    }, []);\n\n    const handleMarkAsRead = useCallback(() => {\n      markInboxNotificationAsRead(inboxNotification.id);\n    }, [inboxNotification.id, markInboxNotificationAsRead]);\n\n    const handleDelete = useCallback(() => {\n      deleteInboxNotification(inboxNotification.id);\n    }, [inboxNotification.id, deleteInboxNotification]);\n\n    return (\n      <TooltipProvider>\n        <Component\n          className={cn(\n            \"lb-root lb-inbox-notification\",\n            showActions === \"hover\" &&\n              \"lb-inbox-notification:show-actions-hover\",\n            isMoreActionOpen && \"lb-inbox-notification:action-open\",\n            className\n          )}\n          dir={$.dir}\n          data-unread={unread ? \"\" : undefined}\n          data-kind={inboxNotification.kind}\n          onClick={handleClick}\n          href={href}\n          {...props}\n          ref={forwardedRef}\n        >\n          {aside && <div className=\"lb-inbox-notification-aside\">{aside}</div>}\n          <div className=\"lb-inbox-notification-content\">\n            <div className=\"lb-inbox-notification-header\">\n              <span className=\"lb-inbox-notification-title\">{title}</span>\n              <div className=\"lb-inbox-notification-details\">\n                <span className=\"lb-inbox-notification-details-labels\">\n                  <Timestamp\n                    locale={$.locale}\n                    date={date}\n                    className=\"lb-date lb-inbox-notification-date\"\n                  />\n                  {unread && (\n                    <span\n                      className=\"lb-inbox-notification-unread-indicator\"\n                      role=\"presentation\"\n                    />\n                  )}\n                </span>\n              </div>\n              {showActions && (\n                <div className=\"lb-inbox-notification-actions\">\n                  <Dropdown\n                    open={isMoreActionOpen}\n                    onOpenChange={setMoreActionOpen}\n                    align=\"end\"\n                    content={\n                      <>\n                        {additionalDropdownItemsBefore}\n                        {unread ? (\n                          <DropdownItem\n                            onSelect={handleMarkAsRead}\n                            onClick={stopPropagation}\n                            icon={<CheckIcon />}\n                          >\n                            {$.INBOX_NOTIFICATION_MARK_AS_READ}\n                          </DropdownItem>\n                        ) : null}\n                        <DropdownItem\n                          onSelect={handleDelete}\n                          onClick={stopPropagation}\n                          icon={<DeleteIcon />}\n                        >\n                          {$.INBOX_NOTIFICATION_DELETE}\n                        </DropdownItem>\n                        {additionalDropdownItemsAfter}\n                      </>\n                    }\n                  >\n                    <Tooltip content={$.INBOX_NOTIFICATION_MORE}>\n                      <DropdownTrigger asChild>\n                        <Button\n                          className=\"lb-inbox-notification-action\"\n                          onClick={handleMoreClick}\n                          onPointerDown={preventDefaultAndStopPropagation}\n                          onPointerUp={preventDefaultAndStopPropagation}\n                          aria-label={$.INBOX_NOTIFICATION_MORE}\n                          icon={<EllipsisIcon />}\n                        />\n                      </DropdownTrigger>\n                    </Tooltip>\n                  </Dropdown>\n                </div>\n              )}\n            </div>\n            <div className=\"lb-inbox-notification-body\">{children}</div>\n          </div>\n        </Component>\n      </TooltipProvider>\n    );\n  }\n);\n\nfunction InboxNotificationIcon({\n  className,\n  ...props\n}: InboxNotificationIconProps) {\n  return (\n    <div className={cn(\"lb-inbox-notification-icon\", className)} {...props} />\n  );\n}\n\nfunction InboxNotificationAvatar({\n  className,\n  ...props\n}: InboxNotificationAvatarProps) {\n  return (\n    <Avatar\n      className={cn(\"lb-inbox-notification-avatar\", className)}\n      {...props}\n    />\n  );\n}\n\nconst InboxNotificationThread = forwardRef<\n  HTMLAnchorElement,\n  InboxNotificationThreadProps\n>(\n  (\n    {\n      inboxNotification,\n      href,\n      showRoomName = true,\n      showReactions = true,\n      showAttachments = true,\n      showActions = \"hover\",\n      overrides,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const $ = useOverrides(overrides);\n    const client = useClient();\n    const thread = useInboxNotificationThread(inboxNotification.id);\n    const {\n      status: subscriptionStatus,\n      subscribe,\n      unsubscribe,\n    } = useRoomThreadSubscription(thread.roomId, thread.id);\n    const currentUserId = useCurrentUserId();\n    const { info } = useRoomInfo(inboxNotification.roomId);\n    const contents = useMemo(() => {\n      const contents = generateInboxNotificationThreadContents(\n        client,\n        inboxNotification,\n        thread,\n        currentUserId ?? \"\"\n      );\n\n      if (contents.comments.length === 0 || contents.userIds.length === 0) {\n        return null;\n      }\n\n      switch (contents.type) {\n        case \"comments\": {\n          const reversedUserIds = [...contents.userIds].reverse();\n          const firstUserId = reversedUserIds[0]!;\n\n          const aside = <InboxNotificationAvatar userId={firstUserId} />;\n          const title = $.INBOX_NOTIFICATION_THREAD_COMMENTS_LIST(\n            <List\n              values={reversedUserIds.map((userId) => (\n                <User key={userId} userId={userId} replaceSelf />\n              ))}\n              formatRemaining={$.LIST_REMAINING_USERS}\n              truncate={INBOX_NOTIFICATION_THREAD_MAX_COMMENTS - 1}\n              locale={$.locale}\n            />,\n            showRoomName ? <Room roomId={thread.roomId} /> : undefined,\n            reversedUserIds.length\n          );\n          const content = (\n            <div className=\"lb-inbox-notification-comments\">\n              {contents.comments.map((comment) => (\n                <InboxNotificationComment\n                  key={comment.id}\n                  comment={comment}\n                  showHeader={contents.comments.length > 1}\n                  showAttachments={showAttachments}\n                  showReactions={showReactions}\n                  overrides={overrides}\n                />\n              ))}\n            </div>\n          );\n\n          return {\n            unread: contents.unread,\n            date: contents.date,\n            aside,\n            title,\n            content,\n            threadId: thread.id,\n            commentId: contents.comments[contents.comments.length - 1]!.id,\n          };\n        }\n\n        case \"mention\": {\n          const mentionCreatedBy = contents.userIds[0]!;\n          const mentionComment = contents.comments[0]!;\n\n          const aside = <InboxNotificationAvatar userId={mentionCreatedBy} />;\n          const title = $.INBOX_NOTIFICATION_THREAD_MENTION(\n            <User key={mentionCreatedBy} userId={mentionCreatedBy} />,\n            showRoomName ? <Room roomId={thread.roomId} /> : undefined\n          );\n          const content = (\n            <div className=\"lb-inbox-notification-comments\">\n              <InboxNotificationComment\n                key={mentionComment.id}\n                comment={mentionComment}\n                showHeader={false}\n                showAttachments={showAttachments}\n                showReactions={showReactions}\n                overrides={overrides}\n              />\n            </div>\n          );\n\n          return {\n            unread: contents.unread,\n            date: contents.date,\n            aside,\n            title,\n            content,\n            threadId: thread.id,\n            commentId: mentionComment.id,\n          };\n        }\n\n        default:\n          return assertNever(\n            contents,\n            \"Unexpected thread inbox notification type\"\n          );\n      }\n    }, [\n      $,\n      client,\n      currentUserId,\n      inboxNotification,\n      overrides,\n      showRoomName,\n      showAttachments,\n      showReactions,\n      thread,\n    ]);\n    // Use URL from `resolveRoomsInfo` if `href` isn't set.\n    const resolvedHref = useMemo(() => {\n      const resolvedHref = href ?? info?.url;\n\n      return resolvedHref\n        ? // Set the comment ID as the URL hash.\n          generateUrl(resolvedHref, undefined, contents?.commentId)\n        : undefined;\n    }, [contents?.commentId, href, info?.url]);\n\n    const handleSubscribeChange = useCallback(() => {\n      if (subscriptionStatus === \"subscribed\") {\n        unsubscribe();\n      } else {\n        subscribe();\n      }\n    }, [subscriptionStatus, subscribe, unsubscribe]);\n\n    const stopPropagation = useCallback((event: SyntheticEvent) => {\n      event.stopPropagation();\n    }, []);\n\n    if (!contents) {\n      return null;\n    }\n\n    const { aside, title, content, date, unread } = contents;\n\n    return (\n      <InboxNotificationLayout\n        inboxNotification={inboxNotification}\n        aside={aside}\n        title={title}\n        date={date}\n        unread={unread}\n        overrides={overrides}\n        href={resolvedHref}\n        showActions={showActions}\n        markAsReadOnClick={false}\n        additionalDropdownItemsBefore={\n          <DropdownItem\n            onSelect={handleSubscribeChange}\n            onClick={stopPropagation}\n            icon={\n              subscriptionStatus === \"subscribed\" ? (\n                <BellCrossedIcon />\n              ) : (\n                <BellIcon />\n              )\n            }\n          >\n            {subscriptionStatus === \"subscribed\"\n              ? $.THREAD_UNSUBSCRIBE\n              : $.THREAD_SUBSCRIBE}\n          </DropdownItem>\n        }\n        {...props}\n        ref={forwardedRef}\n      >\n        {content}\n      </InboxNotificationLayout>\n    );\n  }\n);\n\nconst InboxNotificationTextMention = forwardRef<\n  HTMLAnchorElement,\n  InboxNotificationTextMentionProps\n>(\n  (\n    {\n      inboxNotification,\n      showActions = \"hover\",\n      showRoomName = true,\n      href,\n      overrides,\n      ...props\n    },\n    ref\n  ) => {\n    const $ = useOverrides(overrides);\n    const { info } = useRoomInfo(inboxNotification.roomId);\n    // Use URL from `resolveRoomsInfo` if `href` isn't set.\n    const resolvedHref = useMemo(() => {\n      const resolvedHref = href ?? info?.url;\n\n      return resolvedHref\n        ? (sanitizeUrl(resolvedHref) ?? undefined)\n        : undefined;\n    }, [href, info?.url]);\n\n    const unread = useMemo(() => {\n      return (\n        !inboxNotification.readAt ||\n        inboxNotification.notifiedAt > inboxNotification.readAt\n      );\n    }, [inboxNotification.notifiedAt, inboxNotification.readAt]);\n\n    return (\n      <InboxNotificationLayout\n        inboxNotification={inboxNotification}\n        aside={<InboxNotificationAvatar userId={inboxNotification.createdBy} />}\n        title={$.INBOX_NOTIFICATION_TEXT_MENTION(\n          <User\n            key={inboxNotification.createdBy}\n            userId={inboxNotification.createdBy}\n          />,\n          showRoomName ? <Room roomId={inboxNotification.roomId} /> : undefined\n        )}\n        date={inboxNotification.notifiedAt}\n        unread={unread}\n        overrides={overrides}\n        showActions={showActions}\n        href={resolvedHref}\n        {...props}\n        ref={ref}\n      />\n    );\n  }\n);\n\nconst InboxNotificationCustom = forwardRef<\n  HTMLAnchorElement,\n  InboxNotificationCustomProps\n>(\n  (\n    {\n      inboxNotification,\n      showActions = \"hover\",\n      title,\n      aside,\n      children,\n      overrides,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const unread = useMemo(() => {\n      return (\n        !inboxNotification.readAt ||\n        inboxNotification.notifiedAt > inboxNotification.readAt\n      );\n    }, [inboxNotification.notifiedAt, inboxNotification.readAt]);\n\n    return (\n      <InboxNotificationLayout\n        inboxNotification={inboxNotification}\n        aside={aside}\n        title={title}\n        date={inboxNotification.notifiedAt}\n        unread={unread}\n        overrides={overrides}\n        showActions={showActions}\n        {...props}\n        ref={forwardedRef}\n      >\n        {children}\n      </InboxNotificationLayout>\n    );\n  }\n);\n\nconst InboxNotificationInspector = forwardRef<\n  HTMLAnchorElement,\n  InboxNotificationInspectorProps\n>(\n  (\n    { inboxNotification, showActions = \"hover\", overrides, ...props },\n    forwardedRef\n  ) => {\n    const unread = useMemo(() => {\n      return (\n        !inboxNotification.readAt ||\n        inboxNotification.notifiedAt > inboxNotification.readAt\n      );\n    }, [inboxNotification.notifiedAt, inboxNotification.readAt]);\n\n    return (\n      <InboxNotificationLayout\n        inboxNotification={inboxNotification}\n        title={<code>{inboxNotification.id}</code>}\n        date={inboxNotification.notifiedAt}\n        unread={unread}\n        overrides={overrides}\n        showActions={showActions}\n        {...props}\n        ref={forwardedRef}\n        data-inspector=\"\"\n      >\n        <CodeBlock\n          title=\"Data\"\n          code={JSON.stringify(inboxNotification, null, 2)}\n        />\n      </InboxNotificationLayout>\n    );\n  }\n);\n\nconst InboxNotificationCustomMissing = forwardRef<\n  HTMLAnchorElement,\n  Omit<InboxNotificationCustomProps, \"children\" | \"title\" | \"aside\">\n>(({ inboxNotification, ...props }, forwardedRef) => {\n  return (\n    <InboxNotificationCustom\n      inboxNotification={inboxNotification}\n      {...props}\n      title={\n        <>\n          Custom notification kind <code>{inboxNotification.kind}</code> is not\n          handled\n        </>\n      }\n      aside={\n        <InboxNotificationIcon>\n          <WarningIcon />\n        </InboxNotificationIcon>\n      }\n      ref={forwardedRef}\n      data-missing=\"\"\n    >\n      Notifications of this kind wont be displayed in production. Use the{\" \"}\n      <code>kinds</code> prop to define how they should be rendered, learn more\n      in the console.\n    </InboxNotificationCustom>\n  );\n});\n\n/**\n * Displays a single inbox notification.\n *\n * @example\n * <>\n *   {inboxNotifications.map((inboxNotification) => (\n *     <InboxNotification\n *       key={inboxNotification.id}\n *       inboxNotification={inboxNotification}\n *       href={`/rooms/${inboxNotification.roomId}`\n *     />\n *   ))}\n * </>\n */\nexport const InboxNotification = Object.assign(\n  forwardRef<HTMLAnchorElement, InboxNotificationProps>(\n    ({ inboxNotification, kinds, ...props }, forwardedRef) => {\n      switch (inboxNotification.kind) {\n        case \"thread\": {\n          const ResolvedInboxNotificationThread =\n            kinds?.thread ?? InboxNotificationThread;\n\n          return (\n            <ResolvedInboxNotificationThread\n              inboxNotification={inboxNotification}\n              {...props}\n              ref={forwardedRef}\n            />\n          );\n        }\n\n        case \"textMention\": {\n          const ResolvedInboxNotificationTextMention =\n            kinds?.textMention ?? InboxNotificationTextMention;\n\n          return (\n            <ResolvedInboxNotificationTextMention\n              inboxNotification={inboxNotification}\n              {...props}\n              ref={forwardedRef}\n            />\n          );\n        }\n\n        default: {\n          const ResolvedInboxNotificationCustom =\n            kinds?.[inboxNotification.kind];\n\n          if (!ResolvedInboxNotificationCustom) {\n            if (process.env.NODE_ENV !== \"production\") {\n              warnOnce(\n                `Custom notification kind \"${inboxNotification.kind}\" is not handled so notifications of this kind will not be displayed in production. Use the kinds prop to define how they should be rendered. Learn more: https://liveblocks.io/docs/api-reference/liveblocks-react-ui#Rendering-notification-kinds-differently.`\n              );\n\n              return (\n                <InboxNotificationCustomMissing\n                  inboxNotification={inboxNotification}\n                  {...props}\n                  ref={forwardedRef}\n                />\n              );\n            } else {\n              // Don't render anything in production if this inbox notification kind is not defined.\n              return null;\n            }\n          }\n\n          return (\n            <ResolvedInboxNotificationCustom\n              inboxNotification={inboxNotification}\n              {...props}\n              ref={forwardedRef}\n            />\n          );\n        }\n      }\n    }\n  ),\n  {\n    /**\n     * Displays a thread inbox notification kind.\n     */\n    Thread: InboxNotificationThread,\n\n    /**\n     * Displays a text mention inbox notification kind.\n     */\n    TextMention: InboxNotificationTextMention,\n\n    /**\n     * Displays a custom inbox notification kind.\n     */\n    Custom: InboxNotificationCustom,\n\n    /**\n     * Display the inbox notification's data, which can be useful during development.\n     *\n     * @example\n     * <InboxNotification\n     *   inboxNotification={inboxNotification}\n     *   kinds={{\n     *     $custom: InboxNotification.Inspector,\n     *   }}\n     * />\n     */\n    Inspector: InboxNotificationInspector,\n    Icon: InboxNotificationIcon,\n    Avatar: InboxNotificationAvatar,\n  }\n);\n", "\"use client\";\n\nimport type { ComponentPropsWithoutRef } from \"react\";\nimport { Children, forwardRef, useRef } from \"react\";\n\nimport { cn } from \"../utils/cn\";\nimport { useIntersectionCallback } from \"../utils/use-visible\";\n\nexport interface InboxNotificationListProps\n  extends ComponentPropsWithoutRef<\"ol\"> {\n  /**\n   * This API is *EXPERIMENTAL* and likely not going to be the final API. Do\n   * not rely on it.\n   *\n   * @private\n   */\n  onReachEnd?: () => void;\n}\n\nfunction ReachEndMarker({\n  enabled,\n  onReachEnd,\n}: {\n  enabled: boolean;\n  onReachEnd: () => void;\n}) {\n  const markerRef = useRef<HTMLDivElement>(null);\n\n  useIntersectionCallback(\n    markerRef,\n    (isIntersecting) => {\n      if (isIntersecting) {\n        onReachEnd();\n      }\n    },\n    {\n      enabled,\n    }\n  );\n\n  return <div ref={markerRef} style={{ height: 0 }} />;\n}\n\n/**\n * Displays inbox notifications as a list.\n *\n * @example\n * <InboxNotificationList>\n *   {inboxNotifications.map((inboxNotification) => (\n *     <InboxNotification key={inboxNotification.id} inboxNotification={inboxNotification} />\n *   ))}\n * </InboxNotificationList>\n */\nexport const InboxNotificationList = forwardRef<\n  HTMLOListElement,\n  InboxNotificationListProps\n>(({ onReachEnd, children, className, ...props }, forwardedRef) => {\n  return (\n    <ol\n      className={cn(\"lb-root lb-inbox-notification-list\", className)}\n      {...props}\n      ref={forwardedRef}\n    >\n      {Children.map(children, (child, index) => (\n        <li key={index} className=\"lb-inbox-notification-list-item\">\n          {child}\n        </li>\n      ))}\n      {/* Render an invisible marker at the end which is tied to an IntersectionObserver to be alerted when the end of the list has been reached */}\n      {onReachEnd && (\n        <ReachEndMarker\n          onReachEnd={onReachEnd}\n          enabled={Children.count(children) > 0}\n        />\n      )}\n    </ol>\n  );\n});\n", "\"use client\";\n\nimport {\n  type BaseMetadata,\n  type CommentData,\n  type DM,\n  Permission,\n  type ThreadData,\n} from \"@liveblocks/core\";\nimport { findLastIndex } from \"@liveblocks/core\";\nimport {\n  useMarkRoomThreadAsResolved,\n  useMarkRoomThreadAsUnresolved,\n  useRoomPermissions,\n  useRoomThreadSubscription,\n} from \"@liveblocks/react/_private\";\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\";\nimport type {\n  ComponentPropsWithoutRef,\n  ForwardedRef,\n  RefAttributes,\n  SyntheticEvent,\n} from \"react\";\nimport {\n  forwardRef,\n  Fragment,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\n\nimport type { GlobalComponents } from \"../components\";\nimport { ArrowDownIcon } from \"../icons/ArrowDown\";\nimport { BellIcon } from \"../icons/Bell\";\nimport { BellCrossedIcon } from \"../icons/BellCrossed\";\nimport { CheckCircleIcon } from \"../icons/CheckCircle\";\nimport { CheckCircleFillIcon } from \"../icons/CheckCircleFill\";\nimport type {\n  CommentOverrides,\n  ComposerOverrides,\n  GlobalOverrides,\n  ThreadOverrides,\n} from \"../overrides\";\nimport { useOverrides } from \"../overrides\";\nimport { cn } from \"../utils/cn\";\nimport type { CommentProps } from \"./Comment\";\nimport { Comment } from \"./Comment\";\nimport type { ComposerProps } from \"./Composer\";\nimport { Composer } from \"./Composer\";\nimport { Button } from \"./internal/Button\";\nimport { DropdownItem } from \"./internal/Dropdown\";\nimport { Tooltip, TooltipProvider } from \"./internal/Tooltip\";\n\nexport interface ThreadProps<M extends BaseMetadata = DM>\n  extends ComponentPropsWithoutRef<\"div\"> {\n  /**\n   * The thread to display.\n   */\n  thread: ThreadData<M>;\n\n  /**\n   * How to show or hide the composer to reply to the thread.\n   */\n  showComposer?: boolean | \"collapsed\";\n\n  /**\n   * Whether to show the action to resolve the thread.\n   */\n  showResolveAction?: boolean;\n\n  /**\n   * How to show or hide the actions.\n   */\n  showActions?: CommentProps[\"showActions\"];\n\n  /**\n   * Whether to show reactions.\n   */\n  showReactions?: CommentProps[\"showReactions\"];\n\n  /**\n   * Whether to show the composer's formatting controls.\n   */\n  showComposerFormattingControls?: ComposerProps[\"showFormattingControls\"];\n\n  /**\n   * The maximum number of comments to show.\n   *\n   * The first and last comments are always shown and by default if some comments\n   * are hidden, only the first comment will be shown before the \"show more\" button\n   * and after it will be shown all the newest comments to fit the limit set.\n   *\n   * It's possible to customize this by setting `maxVisibleComments` to an object:\n   *\n   * @example\n   * // Only show the last comment, and all the older ones to fit the limit.\n   * <Thread maxVisibleComments={{ max: 5, show: \"oldest\" }} />\n   *\n   * @example\n   * // Show as many old comments as new ones to fit the limit.\n   * <Thread maxVisibleComments={{ max: 5, show: \"both\" }} />\n   */\n  maxVisibleComments?:\n    | number\n    | { max: number; show: \"oldest\" | \"both\" | \"newest\" };\n\n  /**\n   * Whether to blur the composer editor when the composer is submitted.\n   */\n  blurComposerOnSubmit?: ComposerProps[\"blurOnSubmit\"];\n\n  /**\n   * Whether to indent the comments' content.\n   */\n  indentCommentContent?: CommentProps[\"indentContent\"];\n\n  /**\n   * Whether to show deleted comments.\n   */\n  showDeletedComments?: CommentProps[\"showDeleted\"];\n\n  /**\n   * Whether to show attachments.\n   */\n  showAttachments?: boolean;\n\n  /**\n   * The event handler called when changing the resolved status.\n   */\n  onResolvedChange?: (resolved: boolean) => void;\n\n  /**\n   * The event handler called when a comment is edited.\n   */\n  onCommentEdit?: CommentProps[\"onCommentEdit\"];\n\n  /**\n   * The event handler called when a comment is deleted.\n   */\n  onCommentDelete?: CommentProps[\"onCommentDelete\"];\n\n  /**\n   * The event handler called when the thread is deleted.\n   * A thread is deleted when all its comments are deleted.\n   */\n  onThreadDelete?: (thread: ThreadData<M>) => void;\n\n  /**\n   * The event handler called when clicking on a comment's author.\n   */\n  onAuthorClick?: CommentProps[\"onAuthorClick\"];\n\n  /**\n   * The event handler called when clicking on a mention.\n   */\n  onMentionClick?: CommentProps[\"onMentionClick\"];\n\n  /**\n   * The event handler called when clicking on a comment's attachment.\n   */\n  onAttachmentClick?: CommentProps[\"onAttachmentClick\"];\n\n  /**\n   * The event handler called when the composer is submitted.\n   */\n  onComposerSubmit?: ComposerProps[\"onComposerSubmit\"];\n\n  /**\n   * Override the component's strings.\n   */\n  overrides?: Partial<\n    GlobalOverrides & ThreadOverrides & CommentOverrides & ComposerOverrides\n  >;\n\n  /**\n   * Override the component's components.\n   */\n  components?: Partial<GlobalComponents>;\n}\n\n/**\n * Displays a thread of comments, with a composer to reply\n * to it.\n *\n * @example\n * <>\n *   {threads.map((thread) => (\n *     <Thread key={thread.id} thread={thread} />\n *   ))}\n * </>\n */\nexport const Thread = forwardRef(\n  <M extends BaseMetadata = DM>(\n    {\n      thread,\n      indentCommentContent = true,\n      showActions = \"hover\",\n      showDeletedComments,\n      showResolveAction = true,\n      showReactions = true,\n      showComposer = \"collapsed\",\n      showAttachments = true,\n      showComposerFormattingControls = true,\n      maxVisibleComments,\n      onResolvedChange,\n      onCommentEdit,\n      onCommentDelete,\n      onThreadDelete,\n      onAuthorClick,\n      onMentionClick,\n      onAttachmentClick,\n      onComposerSubmit,\n      blurComposerOnSubmit,\n      overrides,\n      components,\n      className,\n      ...props\n    }: ThreadProps<M>,\n    forwardedRef: ForwardedRef<HTMLDivElement>\n  ) => {\n    const markThreadAsResolved = useMarkRoomThreadAsResolved(thread.roomId);\n    const markThreadAsUnresolved = useMarkRoomThreadAsUnresolved(thread.roomId);\n    const $ = useOverrides(overrides);\n    const [showAllComments, setShowAllComments] = useState(false);\n    const firstCommentIndex = useMemo(() => {\n      return showDeletedComments\n        ? 0\n        : thread.comments.findIndex((comment) => comment.body);\n    }, [showDeletedComments, thread.comments]);\n    const lastCommentIndex = useMemo(() => {\n      return showDeletedComments\n        ? thread.comments.length - 1\n        : findLastIndex(thread.comments, (comment) => Boolean(comment.body));\n    }, [showDeletedComments, thread.comments]);\n    const hiddenComments = useMemo(() => {\n      const maxVisibleCommentsCount =\n        typeof maxVisibleComments === \"number\"\n          ? maxVisibleComments\n          : maxVisibleComments?.max;\n      const visibleCommentsShow =\n        (typeof maxVisibleComments === \"object\"\n          ? maxVisibleComments?.show\n          : undefined) ?? \"newest\";\n\n      // If we explicitly want to show all comments or there's no limit set,\n      // no need to hide any comments.\n      if (showAllComments || maxVisibleCommentsCount === undefined) {\n        return;\n      }\n\n      const comments = thread.comments\n        .map((comment, index) => ({ comment, index }))\n        .filter(({ comment }) => showDeletedComments || comment.body);\n\n      // There aren't enough comments so no need to hide any.\n      if (comments.length <= Math.max(maxVisibleCommentsCount, 2)) {\n        return;\n      }\n\n      const firstVisibleComment = comments[0]!;\n      const lastVisibleComment = comments[comments.length - 1]!;\n\n      // Always show the first and last comments even if the limit is set to lower than 2.\n      if (maxVisibleCommentsCount <= 2) {\n        const firstHiddenCommentIndex =\n          comments[1]?.index ?? firstVisibleComment.index;\n        const lastHiddenCommentIndex =\n          comments[comments.length - 2]?.index ?? lastVisibleComment.index;\n\n        return {\n          firstIndex: firstHiddenCommentIndex,\n          lastIndex: lastHiddenCommentIndex,\n          count: comments.slice(1, comments.length - 1).length,\n        };\n      }\n\n      const remainingVisibleCommentsCount = maxVisibleCommentsCount - 2;\n\n      // Split the remaining visible comments before, after, or equally.\n      const beforeVisibleCommentsCount =\n        visibleCommentsShow === \"oldest\"\n          ? remainingVisibleCommentsCount\n          : visibleCommentsShow === \"newest\"\n            ? 0\n            : Math.floor(remainingVisibleCommentsCount / 2);\n      const afterVisibleCommentsCount =\n        visibleCommentsShow === \"oldest\"\n          ? 0\n          : visibleCommentsShow === \"newest\"\n            ? remainingVisibleCommentsCount\n            : Math.ceil(remainingVisibleCommentsCount / 2);\n\n      // The first comment is always visible so `+ 1` to skip it.\n      const firstHiddenComment = comments[1 + beforeVisibleCommentsCount];\n      // The last comment is always visible so `- 2` to skip it.\n      const lastHiddenComment =\n        comments[comments.length - 2 - afterVisibleCommentsCount];\n\n      // There aren't any comments to hide besides the first and last ones.\n      if (\n        !firstHiddenComment ||\n        !lastHiddenComment ||\n        firstHiddenComment.index > lastHiddenComment.index\n      ) {\n        return;\n      }\n\n      return {\n        firstIndex: firstHiddenComment.index,\n        lastIndex: lastHiddenComment.index,\n        count: thread.comments\n          .slice(firstHiddenComment.index, lastHiddenComment.index + 1)\n          .filter((comment) => showDeletedComments || comment.body).length,\n      };\n    }, [\n      maxVisibleComments,\n      showAllComments,\n      showDeletedComments,\n      thread.comments,\n    ]);\n    const {\n      status: subscriptionStatus,\n      unreadSince,\n      subscribe,\n      unsubscribe,\n    } = useRoomThreadSubscription(thread.roomId, thread.id);\n    const unreadIndex = useMemo(() => {\n      // The user is not subscribed to this thread.\n      if (subscriptionStatus !== \"subscribed\") {\n        return;\n      }\n\n      // The user hasn't read the thread yet, so all comments are unread.\n      if (unreadSince === null) {\n        return firstCommentIndex;\n      }\n\n      // The user has read the thread, so we find the first unread comment.\n      const unreadIndex = thread.comments.findIndex(\n        (comment) =>\n          (showDeletedComments ? true : comment.body) &&\n          comment.createdAt > unreadSince\n      );\n\n      return unreadIndex >= 0 && unreadIndex < thread.comments.length\n        ? unreadIndex\n        : undefined;\n    }, [\n      firstCommentIndex,\n      showDeletedComments,\n      subscriptionStatus,\n      thread.comments,\n      unreadSince,\n    ]);\n    const [newIndex, setNewIndex] = useState<number>();\n    const newIndicatorIndex = newIndex === undefined ? unreadIndex : newIndex;\n\n    useEffect(() => {\n      if (unreadIndex) {\n        // Keep the \"new\" indicator at the lowest unread index.\n        setNewIndex((persistedUnreadIndex) =>\n          Math.min(persistedUnreadIndex ?? Infinity, unreadIndex)\n        );\n      }\n    }, [unreadIndex]);\n\n    const permissions = useRoomPermissions(thread.roomId);\n    const canComment =\n      permissions.size > 0\n        ? permissions.has(Permission.CommentsWrite) ||\n          permissions.has(Permission.Write)\n        : true;\n\n    const stopPropagation = useCallback((event: SyntheticEvent) => {\n      event.stopPropagation();\n    }, []);\n\n    const handleResolvedChange = useCallback(\n      (resolved: boolean) => {\n        onResolvedChange?.(resolved);\n\n        if (resolved) {\n          markThreadAsResolved(thread.id);\n        } else {\n          markThreadAsUnresolved(thread.id);\n        }\n      },\n      [\n        markThreadAsResolved,\n        markThreadAsUnresolved,\n        onResolvedChange,\n        thread.id,\n      ]\n    );\n\n    const handleCommentDelete = useCallback(\n      (comment: CommentData) => {\n        onCommentDelete?.(comment);\n\n        const filteredComments = thread.comments.filter(\n          (comment) => comment.body\n        );\n\n        if (filteredComments.length <= 1) {\n          onThreadDelete?.(thread);\n        }\n      },\n      [onCommentDelete, onThreadDelete, thread]\n    );\n\n    const handleSubscribeChange = useCallback(() => {\n      if (subscriptionStatus === \"subscribed\") {\n        unsubscribe();\n      } else {\n        subscribe();\n      }\n    }, [subscriptionStatus, subscribe, unsubscribe]);\n\n    return (\n      <TooltipProvider>\n        <div\n          className={cn(\n            \"lb-root lb-thread\",\n            showActions === \"hover\" && \"lb-thread:show-actions-hover\",\n            className\n          )}\n          data-resolved={thread.resolved ? \"\" : undefined}\n          data-unread={unreadIndex !== undefined ? \"\" : undefined}\n          dir={$.dir}\n          {...props}\n          ref={forwardedRef}\n        >\n          <div className=\"lb-thread-comments\">\n            {thread.comments.map((comment, index) => {\n              const isFirstComment = index === firstCommentIndex;\n              const isUnread =\n                unreadIndex !== undefined && index >= unreadIndex;\n              const isHidden =\n                hiddenComments &&\n                index >= hiddenComments.firstIndex &&\n                index <= hiddenComments.lastIndex;\n              const isFirstHiddenComment =\n                isHidden && index === hiddenComments.firstIndex;\n\n              if (isFirstHiddenComment) {\n                return (\n                  <div\n                    key={`${comment.id}-show-more`}\n                    className=\"lb-thread-show-more\"\n                  >\n                    <Button\n                      variant=\"ghost\"\n                      className=\"lb-thread-show-more-button\"\n                      onClick={() => setShowAllComments(true)}\n                    >\n                      {$.THREAD_SHOW_MORE_COMMENTS(hiddenComments.count)}\n                    </Button>\n                  </div>\n                );\n              }\n\n              if (isHidden) {\n                return null;\n              }\n\n              const children = (\n                <Comment\n                  key={comment.id}\n                  overrides={overrides}\n                  className=\"lb-thread-comment\"\n                  data-unread={isUnread ? \"\" : undefined}\n                  comment={comment}\n                  indentContent={indentCommentContent}\n                  showDeleted={showDeletedComments}\n                  showActions={showActions}\n                  showReactions={showReactions}\n                  showAttachments={showAttachments}\n                  showComposerFormattingControls={\n                    showComposerFormattingControls\n                  }\n                  onCommentEdit={onCommentEdit}\n                  onCommentDelete={handleCommentDelete}\n                  onAuthorClick={onAuthorClick}\n                  onMentionClick={onMentionClick}\n                  onAttachmentClick={onAttachmentClick}\n                  components={components}\n                  autoMarkReadThreadId={\n                    index === lastCommentIndex && isUnread\n                      ? thread.id\n                      : undefined\n                  }\n                  additionalActionsClassName={\n                    isFirstComment ? \"lb-thread-actions\" : undefined\n                  }\n                  additionalActions={\n                    isFirstComment && showResolveAction ? (\n                      <Tooltip\n                        content={\n                          thread.resolved\n                            ? $.THREAD_UNRESOLVE\n                            : $.THREAD_RESOLVE\n                        }\n                      >\n                        <TogglePrimitive.Root\n                          pressed={thread.resolved}\n                          onPressedChange={handleResolvedChange}\n                          asChild\n                        >\n                          <Button\n                            className=\"lb-comment-action\"\n                            onClick={stopPropagation}\n                            aria-label={\n                              thread.resolved\n                                ? $.THREAD_UNRESOLVE\n                                : $.THREAD_RESOLVE\n                            }\n                            icon={\n                              thread.resolved ? (\n                                <CheckCircleFillIcon />\n                              ) : (\n                                <CheckCircleIcon />\n                              )\n                            }\n                            disabled={!canComment}\n                          />\n                        </TogglePrimitive.Root>\n                      </Tooltip>\n                    ) : null\n                  }\n                  additionalDropdownItemsBefore={\n                    isFirstComment ? (\n                      <DropdownItem\n                        onSelect={handleSubscribeChange}\n                        onClick={stopPropagation}\n                        icon={\n                          subscriptionStatus === \"subscribed\" ? (\n                            <BellCrossedIcon />\n                          ) : (\n                            <BellIcon />\n                          )\n                        }\n                      >\n                        {subscriptionStatus === \"subscribed\"\n                          ? $.THREAD_UNSUBSCRIBE\n                          : $.THREAD_SUBSCRIBE}\n                      </DropdownItem>\n                    ) : null\n                  }\n                />\n              );\n\n              return index === newIndicatorIndex &&\n                newIndicatorIndex !== firstCommentIndex &&\n                newIndicatorIndex <= lastCommentIndex ? (\n                <Fragment key={comment.id}>\n                  <div\n                    className=\"lb-thread-new-indicator\"\n                    aria-label={$.THREAD_NEW_INDICATOR_DESCRIPTION}\n                  >\n                    <span className=\"lb-thread-new-indicator-label\">\n                      <ArrowDownIcon className=\"lb-thread-new-indicator-label-icon\" />\n                      {$.THREAD_NEW_INDICATOR}\n                    </span>\n                  </div>\n                  {children}\n                </Fragment>\n              ) : (\n                children\n              );\n            })}\n          </div>\n          {showComposer && (\n            <Composer\n              className=\"lb-thread-composer\"\n              threadId={thread.id}\n              defaultCollapsed={showComposer === \"collapsed\" ? true : undefined}\n              showAttachments={showAttachments}\n              showFormattingControls={showComposerFormattingControls}\n              onComposerSubmit={onComposerSubmit}\n              blurOnSubmit={blurComposerOnSubmit}\n              overrides={{\n                COMPOSER_PLACEHOLDER: $.THREAD_COMPOSER_PLACEHOLDER,\n                COMPOSER_SEND: $.THREAD_COMPOSER_SEND,\n                ...overrides,\n              }}\n              roomId={thread.roomId}\n            />\n          )}\n        </div>\n      </TooltipProvider>\n    );\n  }\n) as <M extends BaseMetadata = DM>(\n  props: ThreadProps<M> & RefAttributes<HTMLDivElement>\n) => JSX.Element;\n", "import { detectDupes } from \"@liveblocks/core\";\n\nimport { PKG_FORMAT, PKG_NAME, PKG_VERSION } from \"./version\";\n\ndetectDupes(PKG_NAME, PKG_VERSION, PKG_FORMAT);\n\nexport type {\n  AiChatComponents,\n  AiChatComponentsEmptyProps,\n  AiChatComponentsLoadingProps,\n  AiChatProps,\n} from \"./components/AiChat\";\nexport { AiChat } from \"./components/AiChat\";\nexport type { AiToolIconProps, AiToolProps } from \"./components/AiTool\";\nexport { AiTool } from \"./components/AiTool\";\nexport type { CommentProps } from \"./components/Comment\";\nexport { Comment } from \"./components/Comment\";\nexport type { ComposerProps } from \"./components/Composer\";\nexport { Composer } from \"./components/Composer\";\nexport type { HistoryVersionSummaryProps } from \"./components/HistoryVersionSummary\";\nexport { HistoryVersionSummary } from \"./components/HistoryVersionSummary\";\nexport type { HistoryVersionSummaryListProps } from \"./components/HistoryVersionSummaryList\";\nexport { HistoryVersionSummaryList } from \"./components/HistoryVersionSummaryList\";\nexport type {\n  InboxNotificationAvatarProps,\n  InboxNotificationCustomKindProps,\n  InboxNotificationCustomProps,\n  InboxNotificationIconProps,\n  InboxNotificationInspectorProps,\n  InboxNotificationProps,\n  InboxNotificationTextMentionKindProps,\n  InboxNotificationTextMentionProps,\n  InboxNotificationThreadKindProps,\n  InboxNotificationThreadProps,\n} from \"./components/InboxNotification\";\nexport { InboxNotification } from \"./components/InboxNotification\";\nexport type { InboxNotificationListProps } from \"./components/InboxNotificationList\";\nexport { InboxNotificationList } from \"./components/InboxNotificationList\";\nexport type { ThreadProps } from \"./components/Thread\";\nexport { Thread } from \"./components/Thread\";\nexport { LiveblocksUiConfig } from \"./config\";\nexport * as Icon from \"./icon\";\nexport type {\n  CommentOverrides,\n  ComposerOverrides,\n  GlobalOverrides,\n  InboxNotificationOverrides,\n  LocalizationOverrides,\n  Overrides,\n  ThreadOverrides,\n} from \"./overrides\";\nexport { useOverrides } from \"./overrides\";\nexport type {\n  AiComposerSubmitMessage,\n  ComposerSubmitComment,\n} from \"./primitives\";\nexport type {\n  CommentAttachmentArgs,\n  ComposerBodyMark,\n  ComposerBodyMarks,\n} from \"./types\";\n", "import type { BaseMetadata, DM, ThreadData } from \"@liveblocks/core\";\nimport { useLayoutEffect } from \"@liveblocks/react/_private\";\nimport {\n  Thread as DefaultThread,\n  type ThreadProps,\n} from \"@liveblocks/react-ui\";\nimport { cn } from \"@liveblocks/react-ui/_private\";\nimport { type Editor, useEditorState } from \"@tiptap/react\";\nimport type { ComponentPropsWithoutRef, ComponentType } from \"react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\nimport { THREADS_PLUGIN_KEY } from \"../types\";\nimport { getRectFromCoords } from \"../utils\";\n\nconst DEFAULT_GAP = 20;\nconst DEFAULT_ACTIVE_THREAD_OFFSET = -12;\n\n// TODO: move that back to a variable\nconst GAP = `var(--lb-tiptap-anchored-threads-gap, ${DEFAULT_GAP}px)`;\nconst ACTIVE_THREAD_OFFSET = `var(--lb-tiptap-anchored-threads-active-thread-offset, ${DEFAULT_ACTIVE_THREAD_OFFSET}px)`;\n\ntype AnchoredThreadsComponents = {\n  Thread: ComponentType<ThreadProps>;\n};\n\nexport interface AnchoredThreadsProps<M extends BaseMetadata = DM>\n  extends Omit<ComponentPropsWithoutRef<\"div\">, \"children\"> {\n  /**\n   * The threads to display.\n   */\n  threads: ThreadData<M>[];\n\n  /**\n   * Override the component's components.\n   */\n  components?: Partial<AnchoredThreadsComponents>;\n\n  /**\n   * The Tiptap editor.\n   */\n  editor: Editor | null;\n}\n\nexport function AnchoredThreads({\n  threads,\n  components,\n  className,\n  style,\n  editor,\n  ...props\n}: AnchoredThreadsProps) {\n  const Thread = components?.Thread ?? DefaultThread;\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [orderedThreads, setOrderedThreads] = useState<\n    { position: { from: number; to: number }; thread: ThreadData }[]\n  >([]);\n  const [elements, setElements] = useState<Map<string, HTMLElement>>(new Map());\n  const [positions, setPositions] = useState<Map<string, number>>(new Map()); // A map of thread ids to their 'top' position in the document\n\n  const { pluginState } = useEditorState({\n    editor,\n    selector: (ctx) => {\n      if (!ctx?.editor?.state) return { pluginState: undefined };\n      const state = THREADS_PLUGIN_KEY.getState(ctx.editor.state);\n      return {\n        pluginState: state,\n      };\n    },\n    equalityFn: (prev, next) => {\n      if (!prev || !next) return false;\n      return (\n        prev.pluginState?.selectedThreadId ===\n          next.pluginState?.selectedThreadId &&\n        prev.pluginState?.threadPositions === next.pluginState?.threadPositions\n      ); // new map is made each time threadPos updates so shallow equality is fine\n    },\n  }) ?? { pluginState: undefined };\n\n  // TODO: lexical supoprts multiple threads being active, should probably do that here as well\n  const handlePositionThreads = useCallback(() => {\n    const container = containerRef.current;\n    if (container === null || !editor || !editor.view) return;\n\n    const activeIndex = orderedThreads.findIndex(\n      ({ thread }) => thread.id === pluginState?.selectedThreadId\n    );\n    const ascending =\n      activeIndex !== -1 ? orderedThreads.slice(activeIndex) : orderedThreads;\n    const descending =\n      activeIndex !== -1 ? orderedThreads.slice(0, activeIndex) : [];\n\n    const newPositions = new Map<string, number>();\n\n    // Iterate over each thread and calculate its new position by taking into account the position of the previously positioned threads\n    for (const { thread, position } of ascending) {\n      const coords = editor.view.coordsAtPos(\n        Math.min(position.from, editor.view.state.doc.content.size - 1)\n      );\n      const rect = getRectFromCoords(coords);\n      let top = rect.top - container.getBoundingClientRect().top;\n\n      for (const [id, position] of newPositions) {\n        // Retrieve the element associated with the thread\n        const el = elements.get(id);\n        if (el === undefined) continue;\n\n        if (\n          top >= position &&\n          top <= position + el.getBoundingClientRect().height\n        ) {\n          top = position + el.getBoundingClientRect().height;\n        }\n      }\n\n      newPositions.set(thread.id, top);\n    }\n\n    for (const { thread, position } of descending.reverse()) {\n      const coords = editor.view.coordsAtPos(position.from);\n      const rect = getRectFromCoords(coords);\n      // Retrieve the element associated with the current thread\n      const el = elements.get(thread.id);\n      if (el === undefined) continue;\n\n      let top = rect.top - container.getBoundingClientRect().top;\n      for (const [, position] of newPositions) {\n        if (top >= position - el.getBoundingClientRect().height) {\n          top = position - el.getBoundingClientRect().height;\n        }\n      }\n\n      newPositions.set(thread.id, top);\n    }\n\n    setPositions(newPositions);\n  }, [editor, orderedThreads, pluginState?.selectedThreadId, elements]);\n\n  useEffect(() => {\n    if (!pluginState) return;\n    setOrderedThreads(\n      Array.from(pluginState.threadPositions, ([threadId, position]) => ({\n        threadId,\n        position,\n      })).reduce(\n        (acc, { threadId, position }) => {\n          const thread = threads.find(\n            (thread) => thread.id === threadId && !thread.resolved\n          );\n          if (!thread) return acc;\n          acc.push({ thread, position });\n          return acc;\n        },\n        [] as { thread: ThreadData; position: { from: number; to: number } }[]\n      )\n    );\n    handlePositionThreads();\n    // disable exhaustive deps because we don't want an infinite loop\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [pluginState, threads]);\n\n  useLayoutEffect(handlePositionThreads, [handlePositionThreads]);\n\n  useEffect(() => {\n    const observer = new ResizeObserver(handlePositionThreads);\n    const container = editor?.view?.dom;\n    if (container) {\n      observer.observe(container);\n    }\n    for (const element of elements.values()) {\n      observer.observe(element);\n    }\n\n    return () => observer.disconnect();\n  }, [elements, editor, handlePositionThreads]);\n\n  const onItemAdd = useCallback((id: string, el: HTMLElement) => {\n    setElements((prev) => new Map(prev).set(id, el));\n  }, []);\n\n  const onItemRemove = useCallback((id: string) => {\n    setElements((prev) => {\n      const items = new Map(prev);\n      items.delete(id);\n      return items;\n    });\n  }, []);\n\n  const onThreadSelect = useCallback(\n    (id: string) => {\n      if (!editor) return;\n      editor.commands.selectThread(id);\n    },\n    [editor]\n  );\n\n  if (!editor) return null;\n\n  return (\n    <div\n      {...props}\n      className={cn(className, \"lb-root lb-tiptap-anchored-threads\")}\n      ref={containerRef}\n      style={{\n        position: \"relative\",\n        ...style,\n      }}\n    >\n      {orderedThreads.map(({ thread, position }) => {\n        // In blocknote, it's possible for this to be undefined\n        if (!editor.view) {\n          return null;\n        }\n        const coords = editor.view.coordsAtPos(\n          Math.min(position.from, editor.state.doc.content.size - 1)\n        );\n        const rect = getRectFromCoords(coords);\n        const offset = editor.options.element.getBoundingClientRect().top;\n\n        let top = rect.top - offset;\n\n        if (positions.has(thread.id)) {\n          top = positions.get(thread.id)!;\n        }\n\n        const isActive = thread.id === pluginState?.selectedThreadId;\n\n        return (\n          <ThreadWrapper\n            key={thread.id}\n            onThreadClick={onThreadSelect}\n            onItemAdd={onItemAdd}\n            onItemRemove={onItemRemove}\n            Thread={Thread}\n            thread={thread}\n            isActive={isActive}\n            style={{\n              position: \"absolute\",\n              transform: `translate3d(${isActive ? ACTIVE_THREAD_OFFSET : 0}, ${top}px, 0)`,\n              insetInlineStart: 0,\n              inlineSize: \"100%\",\n              paddingBlockEnd: GAP,\n            }}\n          />\n        );\n      })}\n    </div>\n  );\n}\n\ninterface ThreadWrapperProps extends ThreadProps {\n  Thread: ComponentType<ThreadProps>;\n  onThreadClick: (id: string) => void;\n  onItemAdd: (id: string, el: HTMLElement) => void;\n  onItemRemove: (id: string) => void;\n  isActive: boolean;\n}\n\nfunction ThreadWrapper({\n  onThreadClick,\n  onItemAdd,\n  onItemRemove,\n  thread,\n  Thread,\n  className,\n  isActive,\n  ...props\n}: ThreadWrapperProps) {\n  const divRef = useRef<HTMLDivElement>(null);\n\n  useLayoutEffect(() => {\n    const el = divRef.current;\n    if (el === null) return;\n\n    onItemAdd(thread.id, el);\n    return () => {\n      onItemRemove(thread.id);\n    };\n  }, [onItemAdd, onItemRemove, thread.id]);\n\n  function handleThreadClick() {\n    onThreadClick(thread.id);\n  }\n\n  return (\n    <div\n      ref={divRef}\n      className={cn(\"lb-tiptap-anchored-threads-thread-container\", className)}\n      {...props}\n    >\n      <Thread\n        thread={thread}\n        data-state={isActive ? \"active\" : \"inactive\"}\n        onClick={handleThreadClick}\n        className=\"lb-tiptap-anchored-threads-thread\"\n        showComposer={isActive ? true : false}\n      />\n    </div>\n  );\n}\n", "import {\n  autoUpdate,\n  flip,\n  hide,\n  inline,\n  limitShift,\n  offset,\n  shift,\n  size,\n  useFloating,\n} from \"@floating-ui/react-dom\";\nimport type { BaseMetadata } from \"@liveblocks/client\";\nimport type { DM } from \"@liveblocks/core\";\nimport { useCreateThread } from \"@liveblocks/react\";\nimport { useLayoutEffect } from \"@liveblocks/react/_private\";\nimport type {\n  ComposerProps,\n  ComposerSubmitComment,\n} from \"@liveblocks/react-ui\";\nimport { Composer as DefaultComposer } from \"@liveblocks/react-ui\";\nimport { type Editor, useEditorState } from \"@tiptap/react\";\nimport type {\n  ComponentType,\n  FormEvent,\n  KeyboardEvent,\n  MouseEvent,\n} from \"react\";\nimport { forwardRef, useCallback } from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport type {\n  CommentsExtensionStorage,\n  ExtendedChainedCommands,\n} from \"../types\";\nimport { compareSelections, getDomRangeFromSelection } from \"../utils\";\n\ntype FloatingComposerComponents = {\n  Composer: ComponentType<Omit<ComposerProps, \"threadId\" | \"commentId\">>;\n};\n\nexport type FloatingComposerProps<M extends BaseMetadata = DM> = Omit<\n  ComposerProps<M>,\n  \"threadId\" | \"commentId\"\n> & {\n  /**\n   * Override the component's components.\n   */\n  components?: Partial<FloatingComposerComponents>;\n\n  /**\n   * The Tiptap editor.\n   */\n  editor: Editor | null;\n};\n\nexport const FLOATING_COMPOSER_COLLISION_PADDING = 10;\n\nexport const FloatingComposer = forwardRef<\n  HTMLFormElement,\n  FloatingComposerProps\n>(function FloatingComposer(\n  { editor, onComposerSubmit, onKeyDown, onClick, components, ...props },\n  forwardedRef\n) {\n  const Composer = components?.Composer ?? DefaultComposer;\n  const createThread = useCreateThread();\n  const pendingCommentSelection =\n    useEditorState({\n      editor,\n      selector: (ctx) => {\n        if (!ctx.editor) return;\n\n        return (\n          ctx.editor.storage.liveblocksComments as\n            | CommentsExtensionStorage\n            | undefined\n        )?.pendingComment && !ctx.editor.state.selection.empty\n          ? ctx.editor.state.selection\n          : undefined;\n      },\n      equalityFn: compareSelections,\n    }) ?? undefined;\n  const isOpen = pendingCommentSelection !== undefined;\n  const {\n    refs: { setReference, setFloating },\n    strategy,\n    x,\n    y,\n  } = useFloating({\n    strategy: \"fixed\",\n    placement: \"bottom\",\n    middleware: [\n      inline({ padding: FLOATING_COMPOSER_COLLISION_PADDING }),\n      flip({ padding: FLOATING_COMPOSER_COLLISION_PADDING, crossAxis: false }),\n      offset(10),\n      hide({ padding: FLOATING_COMPOSER_COLLISION_PADDING }),\n      shift({\n        padding: FLOATING_COMPOSER_COLLISION_PADDING,\n        limiter: limitShift(),\n      }),\n      size({ padding: FLOATING_COMPOSER_COLLISION_PADDING }),\n    ],\n    whileElementsMounted: (...args) => {\n      return autoUpdate(...args, {\n        animationFrame: true,\n      });\n    },\n  });\n\n  useLayoutEffect(() => {\n    if (!editor || !isOpen) {\n      return;\n    }\n\n    if (!pendingCommentSelection) {\n      setReference(null);\n    } else {\n      const domRange = getDomRangeFromSelection(\n        editor,\n        pendingCommentSelection\n      );\n\n      setReference(domRange);\n    }\n  }, [pendingCommentSelection, editor, isOpen, setReference]);\n\n  // Submit a new thread and update the comment highlight to show a completed highlight\n  const handleComposerSubmit = useCallback(\n    (comment: ComposerSubmitComment, event: FormEvent<HTMLFormElement>) => {\n      onComposerSubmit?.(comment, event);\n      if (event.defaultPrevented) return;\n\n      if (!editor) {\n        return;\n      }\n\n      event.preventDefault();\n\n      const thread = createThread({\n        body: comment.body,\n        attachments: comment.attachments,\n        metadata: props.metadata ?? {},\n      });\n      editor.commands.addComment(thread.id);\n    },\n    [onComposerSubmit, editor, createThread, props.metadata]\n  );\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLFormElement>) => {\n      onKeyDown?.(event);\n\n      if (event.isDefaultPrevented() || !editor) {\n        return;\n      }\n\n      if (event.key === \"Escape\") {\n        (editor.chain() as ExtendedChainedCommands<\"closePendingComment\">)\n          .closePendingComment()\n          .run();\n      }\n    },\n    [editor, onKeyDown]\n  );\n\n  const handleClick = useCallback(\n    (event: MouseEvent<HTMLFormElement>) => {\n      onClick?.(event);\n\n      if (event.defaultPrevented) {\n        return;\n      }\n\n      // Don't send up a click event from emoji picker and close the composer.\n      event.stopPropagation();\n    },\n    [onClick]\n  );\n\n  if (!isOpen || !editor) {\n    return null;\n  }\n\n  return createPortal(\n    <div\n      className=\"lb-root lb-portal lb-elevation lb-tiptap-floating lb-tiptap-floating-composer\"\n      ref={setFloating}\n      style={{\n        position: strategy,\n        top: 0,\n        left: 0,\n        transform: `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`,\n        minWidth: \"max-content\",\n      }}\n    >\n      <Composer\n        ref={forwardedRef}\n        autoFocus\n        {...props}\n        onKeyDown={handleKeyDown}\n        onComposerSubmit={handleComposerSubmit}\n        onClick={handleClick}\n      />\n    </div>,\n    document.body\n  );\n});\n", "import {\n  autoUpdate,\n  flip,\n  hide,\n  limitShift,\n  offset,\n  shift,\n  size,\n  useFloating,\n} from \"@floating-ui/react-dom\";\nimport type { BaseMetadata, DM, ThreadData } from \"@liveblocks/core\";\nimport { useLayoutEffect } from \"@liveblocks/react/_private\";\nimport {\n  Thread as DefaultThread,\n  type ThreadProps,\n} from \"@liveblocks/react-ui\";\nimport { cn } from \"@liveblocks/react-ui/_private\";\nimport { type Editor, useEditorState } from \"@tiptap/react\";\nimport {\n  type ComponentType,\n  type HTMLAttributes,\n  type KeyboardEvent,\n  type ReactNode,\n  useCallback,\n  useEffect,\n  useState,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { THREADS_PLUGIN_KEY } from \"../types\";\n\ntype FloatingThreadsComponents = {\n  Thread: ComponentType<ThreadProps>;\n};\n\nexport interface FloatingThreadsProps<M extends BaseMetadata = DM>\n  extends Omit<HTMLAttributes<HTMLDivElement>, \"children\"> {\n  /**\n   * The threads to display.\n   */\n  threads: ThreadData<M>[];\n\n  /**\n   * Override the component's components.\n   */\n  components?: Partial<FloatingThreadsComponents>;\n\n  /**\n   * The Tiptap editor.\n   */\n  editor: Editor | null;\n}\n\nexport function FloatingThreads({\n  threads,\n  components,\n  editor,\n  ...props\n}: FloatingThreadsProps) {\n  const Thread = components?.Thread ?? DefaultThread;\n\n  const { pluginState } = useEditorState({\n    editor,\n    selector: (ctx) => {\n      if (!ctx?.editor?.state) return { pluginState: undefined };\n      const state = THREADS_PLUGIN_KEY.getState(ctx.editor.state);\n      return {\n        pluginState: state,\n      };\n    },\n    equalityFn: (prev, next) => {\n      if (!prev || !next) return false;\n      return (\n        prev.pluginState?.selectedThreadPos ===\n          next.pluginState?.selectedThreadPos &&\n        prev.pluginState?.selectedThreadId ===\n          next.pluginState?.selectedThreadId\n      );\n    },\n  }) ?? { pluginState: undefined };\n\n  const [activeThread, setActiveThread] = useState<ThreadData | null>(null);\n\n  useEffect(() => {\n    if (!editor || !pluginState) {\n      setActiveThread(null);\n      return;\n    }\n    const { selectedThreadId, selectedThreadPos } = pluginState;\n    if (selectedThreadId === null || selectedThreadPos === null) {\n      setActiveThread(null);\n      return;\n    }\n    const active = (threads ?? []).find(\n      (thread) => selectedThreadId === thread.id\n    );\n    setActiveThread(active ?? null);\n  }, [editor, pluginState, threads]);\n\n  const handleEscapeKeydown = useCallback((): boolean => {\n    if (!editor || activeThread === null) return false;\n    editor.commands.selectThread(null);\n    return true;\n  }, [activeThread, editor]);\n\n  if (!activeThread || !editor || activeThread.resolved) return null;\n\n  return (\n    <FloatingThreadPortal\n      thread={activeThread}\n      editor={editor}\n      container={document.body}\n      {...props}\n    >\n      {activeThread && (\n        <ThreadWrapper\n          key={activeThread.id}\n          thread={activeThread}\n          Thread={Thread}\n          onEscapeKeydown={handleEscapeKeydown}\n          className=\"lb-tiptap-floating-threads-thread\"\n        />\n      )}\n    </FloatingThreadPortal>\n  );\n}\n\ninterface FloatingThreadPortalProps\n  extends Omit<HTMLAttributes<HTMLDivElement>, \"children\"> {\n  thread: ThreadData;\n  editor: Editor;\n  container: HTMLElement;\n  children: ReactNode;\n}\n\nexport const FLOATING_THREAD_COLLISION_PADDING = 10;\n\nfunction FloatingThreadPortal({\n  container,\n  editor,\n  thread,\n  children,\n  className,\n  style,\n  ...props\n}: FloatingThreadPortalProps) {\n  const {\n    refs: { setReference, setFloating },\n    strategy,\n    x,\n    y,\n  } = useFloating({\n    strategy: \"absolute\",\n    placement: \"bottom\",\n    middleware: [\n      flip({ padding: FLOATING_THREAD_COLLISION_PADDING, crossAxis: false }),\n      offset(10),\n      hide({ padding: FLOATING_THREAD_COLLISION_PADDING }),\n      shift({\n        padding: FLOATING_THREAD_COLLISION_PADDING,\n        limiter: limitShift(),\n      }),\n      size({\n        padding: FLOATING_THREAD_COLLISION_PADDING,\n        apply({ availableWidth, availableHeight, elements }) {\n          elements.floating.style.setProperty(\n            \"--lb-tiptap-floating-threads-available-width\",\n            `${availableWidth}px`\n          );\n          elements.floating.style.setProperty(\n            \"--lb-tiptap-floating-threads-available-height\",\n            `${availableHeight}px`\n          );\n        },\n      }),\n    ],\n    whileElementsMounted: (...args) => {\n      return autoUpdate(...args, {\n        animationFrame: true,\n      });\n    },\n  });\n\n  const updateRef = useCallback(() => {\n    const el = editor.view.dom.querySelector(\n      `[data-lb-thread-id=\"${thread.id}\"]`\n    );\n    if (el) {\n      setReference(el);\n    }\n  }, [setReference, editor, thread.id]);\n\n  // Remote cursor updates and other edits can cause the ref to break\n  useEffect(() => {\n    editor.on(\"transaction\", updateRef);\n    return () => {\n      editor.off(\"transaction\", updateRef);\n    };\n  }, [editor, updateRef]);\n\n  useLayoutEffect(updateRef, [updateRef]);\n\n  return createPortal(\n    <div\n      ref={setFloating}\n      {...props}\n      style={{\n        ...style,\n        position: strategy,\n        top: 0,\n        left: 0,\n        transform: `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`,\n        minWidth: \"max-content\",\n      }}\n      className={cn(\n        \"lb-root lb-portal lb-elevation lb-tiptap-floating lb-tiptap-floating-threads\",\n        className\n      )}\n    >\n      {children}\n    </div>,\n    container\n  );\n}\n\ninterface ThreadWrapperProps extends ThreadProps {\n  thread: ThreadData;\n  Thread: ComponentType<ThreadProps>;\n  onEscapeKeydown: () => void;\n}\n\nfunction ThreadWrapper({\n  thread,\n  Thread,\n  onEscapeKeydown,\n  onKeyDown,\n  ...threadProps\n}: ThreadWrapperProps) {\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLDivElement>) => {\n      onKeyDown?.(event);\n\n      // TODO: Add ability to preventDefault on keydown to override the default behavior, e.g. to show an alert dialog\n      if (event.key === \"Escape\") {\n        onEscapeKeydown();\n      }\n    },\n    [onEscapeKeydown, onKeyDown]\n  );\n\n  return <Thread thread={thread} onKeyDown={handleKeyDown} {...threadProps} />;\n}\n", "/**\n *  base64.ts\n *\n *  Licensed under the BSD 3-Clause License.\n *    http://opensource.org/licenses/BSD-3-Clause\n *\n *  References:\n *    http://en.wikipedia.org/wiki/Base64\n *\n * @author Dan Kogai (https://github.com/dankogai)\n */\nconst version = '3.7.8';\n/**\n * @deprecated use lowercase `version`.\n */\nconst VERSION = version;\nconst _hasBuffer = typeof Buffer === 'function';\nconst _TD = typeof TextDecoder === 'function' ? new TextDecoder() : undefined;\nconst _TE = typeof TextEncoder === 'function' ? new TextEncoder() : undefined;\nconst b64ch = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nconst b64chs = Array.prototype.slice.call(b64ch);\nconst b64tab = ((a) => {\n    let tab = {};\n    a.forEach((c, i) => tab[c] = i);\n    return tab;\n})(b64chs);\nconst b64re = /^(?:[A-Za-z\\d+\\/]{4})*?(?:[A-Za-z\\d+\\/]{2}(?:==)?|[A-Za-z\\d+\\/]{3}=?)?$/;\nconst _fromCC = String.fromCharCode.bind(String);\nconst _U8Afrom = typeof Uint8Array.from === 'function'\n    ? Uint8Array.from.bind(Uint8Array)\n    : (it) => new Uint8Array(Array.prototype.slice.call(it, 0));\nconst _mkUriSafe = (src) => src\n    .replace(/=/g, '').replace(/[+\\/]/g, (m0) => m0 == '+' ? '-' : '_');\nconst _tidyB64 = (s) => s.replace(/[^A-Za-z0-9\\+\\/]/g, '');\n/**\n * polyfill version of `btoa`\n */\nconst btoaPolyfill = (bin) => {\n    // console.log('polyfilled');\n    let u32, c0, c1, c2, asc = '';\n    const pad = bin.length % 3;\n    for (let i = 0; i < bin.length;) {\n        if ((c0 = bin.charCodeAt(i++)) > 255 ||\n            (c1 = bin.charCodeAt(i++)) > 255 ||\n            (c2 = bin.charCodeAt(i++)) > 255)\n            throw new TypeError('invalid character found');\n        u32 = (c0 << 16) | (c1 << 8) | c2;\n        asc += b64chs[u32 >> 18 & 63]\n            + b64chs[u32 >> 12 & 63]\n            + b64chs[u32 >> 6 & 63]\n            + b64chs[u32 & 63];\n    }\n    return pad ? asc.slice(0, pad - 3) + \"===\".substring(pad) : asc;\n};\n/**\n * does what `window.btoa` of web browsers do.\n * @param {String} bin binary string\n * @returns {string} Base64-encoded string\n */\nconst _btoa = typeof btoa === 'function' ? (bin) => btoa(bin)\n    : _hasBuffer ? (bin) => Buffer.from(bin, 'binary').toString('base64')\n        : btoaPolyfill;\nconst _fromUint8Array = _hasBuffer\n    ? (u8a) => Buffer.from(u8a).toString('base64')\n    : (u8a) => {\n        // cf. https://stackoverflow.com/questions/12710001/how-to-convert-uint8-array-to-base64-encoded-string/12713326#12713326\n        const maxargs = 0x1000;\n        let strs = [];\n        for (let i = 0, l = u8a.length; i < l; i += maxargs) {\n            strs.push(_fromCC.apply(null, u8a.subarray(i, i + maxargs)));\n        }\n        return _btoa(strs.join(''));\n    };\n/**\n * converts a Uint8Array to a Base64 string.\n * @param {boolean} [urlsafe] URL-and-filename-safe a la RFC4648 5\n * @returns {string} Base64 string\n */\nconst fromUint8Array = (u8a, urlsafe = false) => urlsafe ? _mkUriSafe(_fromUint8Array(u8a)) : _fromUint8Array(u8a);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const utob = (src: string) => unescape(encodeURIComponent(src));\n// reverting good old fationed regexp\nconst cb_utob = (c) => {\n    if (c.length < 2) {\n        var cc = c.charCodeAt(0);\n        return cc < 0x80 ? c\n            : cc < 0x800 ? (_fromCC(0xc0 | (cc >>> 6))\n                + _fromCC(0x80 | (cc & 0x3f)))\n                : (_fromCC(0xe0 | ((cc >>> 12) & 0x0f))\n                    + _fromCC(0x80 | ((cc >>> 6) & 0x3f))\n                    + _fromCC(0x80 | (cc & 0x3f)));\n    }\n    else {\n        var cc = 0x10000\n            + (c.charCodeAt(0) - 0xD800) * 0x400\n            + (c.charCodeAt(1) - 0xDC00);\n        return (_fromCC(0xf0 | ((cc >>> 18) & 0x07))\n            + _fromCC(0x80 | ((cc >>> 12) & 0x3f))\n            + _fromCC(0x80 | ((cc >>> 6) & 0x3f))\n            + _fromCC(0x80 | (cc & 0x3f)));\n    }\n};\nconst re_utob = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFFF]|[^\\x00-\\x7F]/g;\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-8 string\n * @returns {string} UTF-16 string\n */\nconst utob = (u) => u.replace(re_utob, cb_utob);\n//\nconst _encode = _hasBuffer\n    ? (s) => Buffer.from(s, 'utf8').toString('base64')\n    : _TE\n        ? (s) => _fromUint8Array(_TE.encode(s))\n        : (s) => _btoa(utob(s));\n/**\n * converts a UTF-8-encoded string to a Base64 string.\n * @param {boolean} [urlsafe] if `true` make the result URL-safe\n * @returns {string} Base64 string\n */\nconst encode = (src, urlsafe = false) => urlsafe\n    ? _mkUriSafe(_encode(src))\n    : _encode(src);\n/**\n * converts a UTF-8-encoded string to URL-safe Base64 RFC4648 5.\n * @returns {string} Base64 string\n */\nconst encodeURI = (src) => encode(src, true);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const btou = (src: string) => decodeURIComponent(escape(src));\n// reverting good old fationed regexp\nconst re_btou = /[\\xC0-\\xDF][\\x80-\\xBF]|[\\xE0-\\xEF][\\x80-\\xBF]{2}|[\\xF0-\\xF7][\\x80-\\xBF]{3}/g;\nconst cb_btou = (cccc) => {\n    switch (cccc.length) {\n        case 4:\n            var cp = ((0x07 & cccc.charCodeAt(0)) << 18)\n                | ((0x3f & cccc.charCodeAt(1)) << 12)\n                | ((0x3f & cccc.charCodeAt(2)) << 6)\n                | (0x3f & cccc.charCodeAt(3)), offset = cp - 0x10000;\n            return (_fromCC((offset >>> 10) + 0xD800)\n                + _fromCC((offset & 0x3FF) + 0xDC00));\n        case 3:\n            return _fromCC(((0x0f & cccc.charCodeAt(0)) << 12)\n                | ((0x3f & cccc.charCodeAt(1)) << 6)\n                | (0x3f & cccc.charCodeAt(2)));\n        default:\n            return _fromCC(((0x1f & cccc.charCodeAt(0)) << 6)\n                | (0x3f & cccc.charCodeAt(1)));\n    }\n};\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-16 string\n * @returns {string} UTF-8 string\n */\nconst btou = (b) => b.replace(re_btou, cb_btou);\n/**\n * polyfill version of `atob`\n */\nconst atobPolyfill = (asc) => {\n    // console.log('polyfilled');\n    asc = asc.replace(/\\s+/g, '');\n    if (!b64re.test(asc))\n        throw new TypeError('malformed base64.');\n    asc += '=='.slice(2 - (asc.length & 3));\n    let u24, r1, r2;\n    let binArray = []; // use array to avoid minor gc in loop\n    for (let i = 0; i < asc.length;) {\n        u24 = b64tab[asc.charAt(i++)] << 18\n            | b64tab[asc.charAt(i++)] << 12\n            | (r1 = b64tab[asc.charAt(i++)]) << 6\n            | (r2 = b64tab[asc.charAt(i++)]);\n        if (r1 === 64) {\n            binArray.push(_fromCC(u24 >> 16 & 255));\n        }\n        else if (r2 === 64) {\n            binArray.push(_fromCC(u24 >> 16 & 255, u24 >> 8 & 255));\n        }\n        else {\n            binArray.push(_fromCC(u24 >> 16 & 255, u24 >> 8 & 255, u24 & 255));\n        }\n    }\n    return binArray.join('');\n};\n/**\n * does what `window.atob` of web browsers do.\n * @param {String} asc Base64-encoded string\n * @returns {string} binary string\n */\nconst _atob = typeof atob === 'function' ? (asc) => atob(_tidyB64(asc))\n    : _hasBuffer ? (asc) => Buffer.from(asc, 'base64').toString('binary')\n        : atobPolyfill;\n//\nconst _toUint8Array = _hasBuffer\n    ? (a) => _U8Afrom(Buffer.from(a, 'base64'))\n    : (a) => _U8Afrom(_atob(a).split('').map(c => c.charCodeAt(0)));\n/**\n * converts a Base64 string to a Uint8Array.\n */\nconst toUint8Array = (a) => _toUint8Array(_unURI(a));\n//\nconst _decode = _hasBuffer\n    ? (a) => Buffer.from(a, 'base64').toString('utf8')\n    : _TD\n        ? (a) => _TD.decode(_toUint8Array(a))\n        : (a) => btou(_atob(a));\nconst _unURI = (a) => _tidyB64(a.replace(/[-_]/g, (m0) => m0 == '-' ? '+' : '/'));\n/**\n * converts a Base64 string to a UTF-8 string.\n * @param {String} src Base64 string.  Both normal and URL-safe are supported\n * @returns {string} UTF-8 string\n */\nconst decode = (src) => _decode(_unURI(src));\n/**\n * check if a value is a valid Base64 string\n * @param {String} src a value to check\n  */\nconst isValid = (src) => {\n    if (typeof src !== 'string')\n        return false;\n    const s = src.replace(/\\s+/g, '').replace(/={0,2}$/, '');\n    return !/[^\\s0-9a-zA-Z\\+/]/.test(s) || !/[^\\s0-9a-zA-Z\\-_]/.test(s);\n};\n//\nconst _noEnum = (v) => {\n    return {\n        value: v, enumerable: false, writable: true, configurable: true\n    };\n};\n/**\n * extend String.prototype with relevant methods\n */\nconst extendString = function () {\n    const _add = (name, body) => Object.defineProperty(String.prototype, name, _noEnum(body));\n    _add('fromBase64', function () { return decode(this); });\n    _add('toBase64', function (urlsafe) { return encode(this, urlsafe); });\n    _add('toBase64URI', function () { return encode(this, true); });\n    _add('toBase64URL', function () { return encode(this, true); });\n    _add('toUint8Array', function () { return toUint8Array(this); });\n};\n/**\n * extend Uint8Array.prototype with relevant methods\n */\nconst extendUint8Array = function () {\n    const _add = (name, body) => Object.defineProperty(Uint8Array.prototype, name, _noEnum(body));\n    _add('toBase64', function (urlsafe) { return fromUint8Array(this, urlsafe); });\n    _add('toBase64URI', function () { return fromUint8Array(this, true); });\n    _add('toBase64URL', function () { return fromUint8Array(this, true); });\n};\n/**\n * extend Builtin prototypes with relevant methods\n */\nconst extendBuiltins = () => {\n    extendString();\n    extendUint8Array();\n};\nconst gBase64 = {\n    version: version,\n    VERSION: VERSION,\n    atob: _atob,\n    atobPolyfill: atobPolyfill,\n    btoa: _btoa,\n    btoaPolyfill: btoaPolyfill,\n    fromBase64: decode,\n    toBase64: encode,\n    encode: encode,\n    encodeURI: encodeURI,\n    encodeURL: encodeURI,\n    utob: utob,\n    btou: btou,\n    decode: decode,\n    isValid: isValid,\n    fromUint8Array: fromUint8Array,\n    toUint8Array: toUint8Array,\n    extendString: extendString,\n    extendUint8Array: extendUint8Array,\n    extendBuiltins: extendBuiltins\n};\n// makecjs:CUT //\nexport { version };\nexport { VERSION };\nexport { _atob as atob };\nexport { atobPolyfill };\nexport { _btoa as btoa };\nexport { btoaPolyfill };\nexport { decode as fromBase64 };\nexport { encode as toBase64 };\nexport { utob };\nexport { encode };\nexport { encodeURI };\nexport { encodeURI as encodeURL };\nexport { btou };\nexport { decode };\nexport { isValid };\nexport { fromUint8Array };\nexport { toUint8Array };\nexport { extendString };\nexport { extendUint8Array };\nexport { extendBuiltins };\n// and finally,\nexport { gBase64 as Base64 };\n", "/* eslint-env browser */\n\n/**\n * Helpers to work with IndexedDB.\n *\n * @module indexeddb\n */\n\nimport * as promise from './promise.js'\nimport * as error from './error.js'\n\n/* c8 ignore start */\n\n/**\n * IDB Request to Promise transformer\n *\n * @param {IDBRequest} request\n * @return {Promise<any>}\n */\nexport const rtop = request => promise.create((resolve, reject) => {\n  // @ts-ignore\n  request.onerror = event => reject(new Error(event.target.error))\n  // @ts-ignore\n  request.onsuccess = event => resolve(event.target.result)\n})\n\n/**\n * @param {string} name\n * @param {function(IDBDatabase):any} initDB Called when the database is first created\n * @return {Promise<IDBDatabase>}\n */\nexport const openDB = (name, initDB) => promise.create((resolve, reject) => {\n  const request = indexedDB.open(name)\n  /**\n   * @param {any} event\n   */\n  request.onupgradeneeded = event => initDB(event.target.result)\n  /**\n   * @param {any} event\n   */\n  request.onerror = event => reject(error.create(event.target.error))\n  /**\n   * @param {any} event\n   */\n  request.onsuccess = event => {\n    /**\n     * @type {IDBDatabase}\n     */\n    const db = event.target.result\n    db.onversionchange = () => { db.close() }\n    resolve(db)\n  }\n})\n\n/**\n * @param {string} name\n */\nexport const deleteDB = name => rtop(indexedDB.deleteDatabase(name))\n\n/**\n * @param {IDBDatabase} db\n * @param {Array<Array<string>|Array<string|IDBObjectStoreParameters|undefined>>} definitions\n */\nexport const createStores = (db, definitions) => definitions.forEach(d =>\n  // @ts-ignore\n  db.createObjectStore.apply(db, d)\n)\n\n/**\n * @param {IDBDatabase} db\n * @param {Array<string>} stores\n * @param {\"readwrite\"|\"readonly\"} [access]\n * @return {Array<IDBObjectStore>}\n */\nexport const transact = (db, stores, access = 'readwrite') => {\n  const transaction = db.transaction(stores, access)\n  return stores.map(store => getStore(transaction, store))\n}\n\n/**\n * @param {IDBObjectStore} store\n * @param {IDBKeyRange} [range]\n * @return {Promise<number>}\n */\nexport const count = (store, range) =>\n  rtop(store.count(range))\n\n/**\n * @param {IDBObjectStore} store\n * @param {String | number | ArrayBuffer | Date | Array<any> } key\n * @return {Promise<String | number | ArrayBuffer | Date | Array<any>>}\n */\nexport const get = (store, key) =>\n  rtop(store.get(key))\n\n/**\n * @param {IDBObjectStore} store\n * @param {String | number | ArrayBuffer | Date | IDBKeyRange | Array<any> } key\n */\nexport const del = (store, key) =>\n  rtop(store.delete(key))\n\n/**\n * @param {IDBObjectStore} store\n * @param {String | number | ArrayBuffer | Date | boolean} item\n * @param {String | number | ArrayBuffer | Date | Array<any>} [key]\n */\nexport const put = (store, item, key) =>\n  rtop(store.put(item, key))\n\n/**\n * @param {IDBObjectStore} store\n * @param {String | number | ArrayBuffer | Date | boolean}  item\n * @param {String | number | ArrayBuffer | Date | Array<any>}  key\n * @return {Promise<any>}\n */\nexport const add = (store, item, key) =>\n  rtop(store.add(item, key))\n\n/**\n * @param {IDBObjectStore} store\n * @param {String | number | ArrayBuffer | Date}  item\n * @return {Promise<number>} Returns the generated key\n */\nexport const addAutoKey = (store, item) =>\n  rtop(store.add(item))\n\n/**\n * @param {IDBObjectStore} store\n * @param {IDBKeyRange} [range]\n * @param {number} [limit]\n * @return {Promise<Array<any>>}\n */\nexport const getAll = (store, range, limit) =>\n  rtop(store.getAll(range, limit))\n\n/**\n * @param {IDBObjectStore} store\n * @param {IDBKeyRange} [range]\n * @param {number} [limit]\n * @return {Promise<Array<any>>}\n */\nexport const getAllKeys = (store, range, limit) =>\n  rtop(store.getAllKeys(range, limit))\n\n/**\n * @param {IDBObjectStore} store\n * @param {IDBKeyRange|null} query\n * @param {'next'|'prev'|'nextunique'|'prevunique'} direction\n * @return {Promise<any>}\n */\nexport const queryFirst = (store, query, direction) => {\n  /**\n   * @type {any}\n   */\n  let first = null\n  return iterateKeys(store, query, key => {\n    first = key\n    return false\n  }, direction).then(() => first)\n}\n\n/**\n * @param {IDBObjectStore} store\n * @param {IDBKeyRange?} [range]\n * @return {Promise<any>}\n */\nexport const getLastKey = (store, range = null) => queryFirst(store, range, 'prev')\n\n/**\n * @param {IDBObjectStore} store\n * @param {IDBKeyRange?} [range]\n * @return {Promise<any>}\n */\nexport const getFirstKey = (store, range = null) => queryFirst(store, range, 'next')\n\n/**\n * @typedef KeyValuePair\n * @type {Object}\n * @property {any} k key\n * @property {any} v Value\n */\n\n/**\n * @param {IDBObjectStore} store\n * @param {IDBKeyRange} [range]\n * @param {number} [limit]\n * @return {Promise<Array<KeyValuePair>>}\n */\nexport const getAllKeysValues = (store, range, limit) =>\n  // @ts-ignore\n  promise.all([getAllKeys(store, range, limit), getAll(store, range, limit)]).then(([ks, vs]) => ks.map((k, i) => ({ k, v: vs[i] })))\n\n/**\n * @param {any} request\n * @param {function(IDBCursorWithValue):void|boolean|Promise<void|boolean>} f\n * @return {Promise<void>}\n */\nconst iterateOnRequest = (request, f) => promise.create((resolve, reject) => {\n  request.onerror = reject\n  /**\n   * @param {any} event\n   */\n  request.onsuccess = async event => {\n    const cursor = event.target.result\n    if (cursor === null || (await f(cursor)) === false) {\n      return resolve()\n    }\n    cursor.continue()\n  }\n})\n\n/**\n * Iterate on keys and values\n * @param {IDBObjectStore} store\n * @param {IDBKeyRange|null} keyrange\n * @param {function(any,any):void|boolean|Promise<void|boolean>} f Callback that receives (value, key)\n * @param {'next'|'prev'|'nextunique'|'prevunique'} direction\n */\nexport const iterate = (store, keyrange, f, direction = 'next') =>\n  iterateOnRequest(store.openCursor(keyrange, direction), cursor => f(cursor.value, cursor.key))\n\n/**\n * Iterate on the keys (no values)\n *\n * @param {IDBObjectStore} store\n * @param {IDBKeyRange|null} keyrange\n * @param {function(any):void|boolean|Promise<void|boolean>} f callback that receives the key\n * @param {'next'|'prev'|'nextunique'|'prevunique'} direction\n */\nexport const iterateKeys = (store, keyrange, f, direction = 'next') =>\n  iterateOnRequest(store.openKeyCursor(keyrange, direction), cursor => f(cursor.key))\n\n/**\n * Open store from transaction\n * @param {IDBTransaction} t\n * @param {String} store\n * @returns {IDBObjectStore}\n */\nexport const getStore = (t, store) => t.objectStore(store)\n\n/**\n * @param {any} lower\n * @param {any} upper\n * @param {boolean} lowerOpen\n * @param {boolean} upperOpen\n */\nexport const createIDBKeyRangeBound = (lower, upper, lowerOpen, upperOpen) => IDBKeyRange.bound(lower, upper, lowerOpen, upperOpen)\n\n/**\n * @param {any} upper\n * @param {boolean} upperOpen\n */\nexport const createIDBKeyRangeUpperBound = (upper, upperOpen) => IDBKeyRange.upperBound(upper, upperOpen)\n\n/**\n * @param {any} lower\n * @param {boolean} lowerOpen\n */\nexport const createIDBKeyRangeLowerBound = (lower, lowerOpen) => IDBKeyRange.lowerBound(lower, lowerOpen)\n\n/* c8 ignore stop */\n", "import * as Y from 'yjs'\nimport * as idb from 'lib0/indexeddb'\nimport * as promise from 'lib0/promise'\nimport { Observable } from 'lib0/observable'\n\nconst customStoreName = 'custom'\nconst updatesStoreName = 'updates'\n\nexport const PREFERRED_TRIM_SIZE = 500\n\n/**\n * @param {IndexeddbPersistence} idbPersistence\n * @param {function(IDBObjectStore):void} [beforeApplyUpdatesCallback]\n * @param {function(IDBObjectStore):void} [afterApplyUpdatesCallback]\n */\nexport const fetchUpdates = (idbPersistence, beforeApplyUpdatesCallback = () => {}, afterApplyUpdatesCallback = () => {}) => {\n  const [updatesStore] = idb.transact(/** @type {IDBDatabase} */ (idbPersistence.db), [updatesStoreName]) // , 'readonly')\n  return idb.getAll(updatesStore, idb.createIDBKeyRangeLowerBound(idbPersistence._dbref, false)).then(updates => {\n    if (!idbPersistence._destroyed) {\n      beforeApplyUpdatesCallback(updatesStore)\n      Y.transact(idbPersistence.doc, () => {\n        updates.forEach(val => Y.applyUpdate(idbPersistence.doc, val))\n      }, idbPersistence, false)\n      afterApplyUpdatesCallback(updatesStore)\n    }\n  })\n    .then(() => idb.getLastKey(updatesStore).then(lastKey => { idbPersistence._dbref = lastKey + 1 }))\n    .then(() => idb.count(updatesStore).then(cnt => { idbPersistence._dbsize = cnt }))\n    .then(() => updatesStore)\n}\n\n/**\n * @param {IndexeddbPersistence} idbPersistence\n * @param {boolean} forceStore\n */\nexport const storeState = (idbPersistence, forceStore = true) =>\n  fetchUpdates(idbPersistence)\n    .then(updatesStore => {\n      if (forceStore || idbPersistence._dbsize >= PREFERRED_TRIM_SIZE) {\n        idb.addAutoKey(updatesStore, Y.encodeStateAsUpdate(idbPersistence.doc))\n          .then(() => idb.del(updatesStore, idb.createIDBKeyRangeUpperBound(idbPersistence._dbref, true)))\n          .then(() => idb.count(updatesStore).then(cnt => { idbPersistence._dbsize = cnt }))\n      }\n    })\n\n/**\n * @param {string} name\n */\nexport const clearDocument = name => idb.deleteDB(name)\n\n/**\n * @extends Observable<string>\n */\nexport class IndexeddbPersistence extends Observable {\n  /**\n   * @param {string} name\n   * @param {Y.Doc} doc\n   */\n  constructor (name, doc) {\n    super()\n    this.doc = doc\n    this.name = name\n    this._dbref = 0\n    this._dbsize = 0\n    this._destroyed = false\n    /**\n     * @type {IDBDatabase|null}\n     */\n    this.db = null\n    this.synced = false\n    this._db = idb.openDB(name, db =>\n      idb.createStores(db, [\n        ['updates', { autoIncrement: true }],\n        ['custom']\n      ])\n    )\n    /**\n     * @type {Promise<IndexeddbPersistence>}\n     */\n    this.whenSynced = promise.create(resolve => this.on('synced', () => resolve(this)))\n\n    this._db.then(db => {\n      this.db = db\n      /**\n       * @param {IDBObjectStore} updatesStore\n       */\n      const beforeApplyUpdatesCallback = (updatesStore) => idb.addAutoKey(updatesStore, Y.encodeStateAsUpdate(doc))\n      const afterApplyUpdatesCallback = () => {\n        if (this._destroyed) return this\n        this.synced = true\n        this.emit('synced', [this])\n      }\n      fetchUpdates(this, beforeApplyUpdatesCallback, afterApplyUpdatesCallback)\n    })\n    /**\n     * Timeout in ms untill data is merged and persisted in idb.\n     */\n    this._storeTimeout = 1000\n    /**\n     * @type {any}\n     */\n    this._storeTimeoutId = null\n    /**\n     * @param {Uint8Array} update\n     * @param {any} origin\n     */\n    this._storeUpdate = (update, origin) => {\n      if (this.db && origin !== this) {\n        const [updatesStore] = idb.transact(/** @type {IDBDatabase} */ (this.db), [updatesStoreName])\n        idb.addAutoKey(updatesStore, update)\n        if (++this._dbsize >= PREFERRED_TRIM_SIZE) {\n          // debounce store call\n          if (this._storeTimeoutId !== null) {\n            clearTimeout(this._storeTimeoutId)\n          }\n          this._storeTimeoutId = setTimeout(() => {\n            storeState(this, false)\n            this._storeTimeoutId = null\n          }, this._storeTimeout)\n        }\n      }\n    }\n    doc.on('update', this._storeUpdate)\n    this.destroy = this.destroy.bind(this)\n    doc.on('destroy', this.destroy)\n  }\n\n  destroy () {\n    if (this._storeTimeoutId) {\n      clearTimeout(this._storeTimeoutId)\n    }\n    this.doc.off('update', this._storeUpdate)\n    this.doc.off('destroy', this.destroy)\n    this._destroyed = true\n    return this._db.then(db => {\n      db.close()\n    })\n  }\n\n  /**\n   * Destroys this instance and removes all data from indexeddb.\n   *\n   * @return {Promise<void>}\n   */\n  clearData () {\n    return this.destroy().then(() => {\n      idb.deleteDB(this.name)\n    })\n  }\n\n  /**\n   * @param {String | number | ArrayBuffer | Date} key\n   * @return {Promise<String | number | ArrayBuffer | Date | any>}\n   */\n  get (key) {\n    return this._db.then(db => {\n      const [custom] = idb.transact(db, [customStoreName], 'readonly')\n      return idb.get(custom, key)\n    })\n  }\n\n  /**\n   * @param {String | number | ArrayBuffer | Date} key\n   * @param {String | number | ArrayBuffer | Date} value\n   * @return {Promise<String | number | ArrayBuffer | Date>}\n   */\n  set (key, value) {\n    return this._db.then(db => {\n      const [custom] = idb.transact(db, [customStoreName])\n      return idb.put(custom, value, key)\n    })\n  }\n\n  /**\n   * @param {String | number | ArrayBuffer | Date} key\n   * @return {Promise<undefined>}\n   */\n  del (key) {\n    return this._db.then(db => {\n      const [custom] = idb.transact(db, [customStoreName])\n      return idb.del(custom, key)\n    })\n  }\n}\n", "/**\n * Internal webcrypto alias.\n * We use WebCrypto aka globalThis.crypto, which exists in browsers and node.js 16+.\n * See utils.ts for details.\n * @module\n */\ndeclare const globalThis: Record<string, any> | undefined;\nexport const crypto: any =\n  typeof globalThis === 'object' && 'crypto' in globalThis ? globalThis.crypto : undefined;\n", "/**\n * Utilities for hex, bytes, CSPRNG.\n * @module\n */\n/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */\n\n// We use WebCrypto aka globalThis.crypto, which exists in browsers and node.js 16+.\n// node.js versions earlier than v19 don't declare it in global scope.\n// For node.js, package.json#exports field mapping rewrites import\n// from `crypto` to `cryptoNode`, which imports native module.\n// Makes the utils un-importable in browsers without a bundler.\n// Once node.js 18 is deprecated (2025-04-30), we can just drop the import.\nimport { crypto } from '@noble/hashes/crypto';\n\n/** Checks if something is Uint8Array. Be careful: nodejs Buffer will return true. */\nexport function isBytes(a: unknown): a is Uint8Array {\n  return a instanceof Uint8Array || (ArrayBuffer.isView(a) && a.constructor.name === 'Uint8Array');\n}\n\n/** Asserts something is positive integer. */\nexport function anumber(n: number): void {\n  if (!Number.isSafeInteger(n) || n < 0) throw new Error('positive integer expected, got ' + n);\n}\n\n/** Asserts something is Uint8Array. */\nexport function abytes(b: Uint8Array | undefined, ...lengths: number[]): void {\n  if (!isBytes(b)) throw new Error('Uint8Array expected');\n  if (lengths.length > 0 && !lengths.includes(b.length))\n    throw new Error('Uint8Array expected of length ' + lengths + ', got length=' + b.length);\n}\n\n/** Asserts something is hash */\nexport function ahash(h: IHash): void {\n  if (typeof h !== 'function' || typeof h.create !== 'function')\n    throw new Error('Hash should be wrapped by utils.createHasher');\n  anumber(h.outputLen);\n  anumber(h.blockLen);\n}\n\n/** Asserts a hash instance has not been destroyed / finished */\nexport function aexists(instance: any, checkFinished = true): void {\n  if (instance.destroyed) throw new Error('Hash instance has been destroyed');\n  if (checkFinished && instance.finished) throw new Error('Hash#digest() has already been called');\n}\n\n/** Asserts output is properly-sized byte array */\nexport function aoutput(out: any, instance: any): void {\n  abytes(out);\n  const min = instance.outputLen;\n  if (out.length < min) {\n    throw new Error('digestInto() expects output buffer of length at least ' + min);\n  }\n}\n\n/** Generic type encompassing 8/16/32-byte arrays - but not 64-byte. */\n// prettier-ignore\nexport type TypedArray = Int8Array | Uint8ClampedArray | Uint8Array |\n  Uint16Array | Int16Array | Uint32Array | Int32Array;\n\n/** Cast u8 / u16 / u32 to u8. */\nexport function u8(arr: TypedArray): Uint8Array {\n  return new Uint8Array(arr.buffer, arr.byteOffset, arr.byteLength);\n}\n\n/** Cast u8 / u16 / u32 to u32. */\nexport function u32(arr: TypedArray): Uint32Array {\n  return new Uint32Array(arr.buffer, arr.byteOffset, Math.floor(arr.byteLength / 4));\n}\n\n/** Zeroize a byte array. Warning: JS provides no guarantees. */\nexport function clean(...arrays: TypedArray[]): void {\n  for (let i = 0; i < arrays.length; i++) {\n    arrays[i].fill(0);\n  }\n}\n\n/** Create DataView of an array for easy byte-level manipulation. */\nexport function createView(arr: TypedArray): DataView {\n  return new DataView(arr.buffer, arr.byteOffset, arr.byteLength);\n}\n\n/** The rotate right (circular right shift) operation for uint32 */\nexport function rotr(word: number, shift: number): number {\n  return (word << (32 - shift)) | (word >>> shift);\n}\n\n/** The rotate left (circular left shift) operation for uint32 */\nexport function rotl(word: number, shift: number): number {\n  return (word << shift) | ((word >>> (32 - shift)) >>> 0);\n}\n\n/** Is current platform little-endian? Most are. Big-Endian platform: IBM */\nexport const isLE: boolean = /* @__PURE__ */ (() =>\n  new Uint8Array(new Uint32Array([0x11223344]).buffer)[0] === 0x44)();\n\n/** The byte swap operation for uint32 */\nexport function byteSwap(word: number): number {\n  return (\n    ((word << 24) & 0xff000000) |\n    ((word << 8) & 0xff0000) |\n    ((word >>> 8) & 0xff00) |\n    ((word >>> 24) & 0xff)\n  );\n}\n/** Conditionally byte swap if on a big-endian platform */\nexport const swap8IfBE: (n: number) => number = isLE\n  ? (n: number) => n\n  : (n: number) => byteSwap(n);\n\n/** @deprecated */\nexport const byteSwapIfBE: typeof swap8IfBE = swap8IfBE;\n/** In place byte swap for Uint32Array */\nexport function byteSwap32(arr: Uint32Array): Uint32Array {\n  for (let i = 0; i < arr.length; i++) {\n    arr[i] = byteSwap(arr[i]);\n  }\n  return arr;\n}\n\nexport const swap32IfBE: (u: Uint32Array) => Uint32Array = isLE\n  ? (u: Uint32Array) => u\n  : byteSwap32;\n\n// Built-in hex conversion https://caniuse.com/mdn-javascript_builtins_uint8array_fromhex\nconst hasHexBuiltin: boolean = /* @__PURE__ */ (() =>\n  // @ts-ignore\n  typeof Uint8Array.from([]).toHex === 'function' && typeof Uint8Array.fromHex === 'function')();\n\n// Array where index 0xf0 (240) is mapped to string 'f0'\nconst hexes = /* @__PURE__ */ Array.from({ length: 256 }, (_, i) =>\n  i.toString(16).padStart(2, '0')\n);\n\n/**\n * Convert byte array to hex string. Uses built-in function, when available.\n * @example bytesToHex(Uint8Array.from([0xca, 0xfe, 0x01, 0x23])) // 'cafe0123'\n */\nexport function bytesToHex(bytes: Uint8Array): string {\n  abytes(bytes);\n  // @ts-ignore\n  if (hasHexBuiltin) return bytes.toHex();\n  // pre-caching improves the speed 6x\n  let hex = '';\n  for (let i = 0; i < bytes.length; i++) {\n    hex += hexes[bytes[i]];\n  }\n  return hex;\n}\n\n// We use optimized technique to convert hex string to byte array\nconst asciis = { _0: 48, _9: 57, A: 65, F: 70, a: 97, f: 102 } as const;\nfunction asciiToBase16(ch: number): number | undefined {\n  if (ch >= asciis._0 && ch <= asciis._9) return ch - asciis._0; // '2' => 50-48\n  if (ch >= asciis.A && ch <= asciis.F) return ch - (asciis.A - 10); // 'B' => 66-(65-10)\n  if (ch >= asciis.a && ch <= asciis.f) return ch - (asciis.a - 10); // 'b' => 98-(97-10)\n  return;\n}\n\n/**\n * Convert hex string to byte array. Uses built-in function, when available.\n * @example hexToBytes('cafe0123') // Uint8Array.from([0xca, 0xfe, 0x01, 0x23])\n */\nexport function hexToBytes(hex: string): Uint8Array {\n  if (typeof hex !== 'string') throw new Error('hex string expected, got ' + typeof hex);\n  // @ts-ignore\n  if (hasHexBuiltin) return Uint8Array.fromHex(hex);\n  const hl = hex.length;\n  const al = hl / 2;\n  if (hl % 2) throw new Error('hex string expected, got unpadded hex of length ' + hl);\n  const array = new Uint8Array(al);\n  for (let ai = 0, hi = 0; ai < al; ai++, hi += 2) {\n    const n1 = asciiToBase16(hex.charCodeAt(hi));\n    const n2 = asciiToBase16(hex.charCodeAt(hi + 1));\n    if (n1 === undefined || n2 === undefined) {\n      const char = hex[hi] + hex[hi + 1];\n      throw new Error('hex string expected, got non-hex character \"' + char + '\" at index ' + hi);\n    }\n    array[ai] = n1 * 16 + n2; // multiply first octet, e.g. 'a3' => 10*16+3 => 160 + 3 => 163\n  }\n  return array;\n}\n\n/**\n * There is no setImmediate in browser and setTimeout is slow.\n * Call of async fn will return Promise, which will be fullfiled only on\n * next scheduler queue processing step and this is exactly what we need.\n */\nexport const nextTick = async (): Promise<void> => {};\n\n/** Returns control to thread each 'tick' ms to avoid blocking. */\nexport async function asyncLoop(\n  iters: number,\n  tick: number,\n  cb: (i: number) => void\n): Promise<void> {\n  let ts = Date.now();\n  for (let i = 0; i < iters; i++) {\n    cb(i);\n    // Date.now() is not monotonic, so in case if clock goes backwards we return return control too\n    const diff = Date.now() - ts;\n    if (diff >= 0 && diff < tick) continue;\n    await nextTick();\n    ts += diff;\n  }\n}\n\n// Global symbols, but ts doesn't see them: https://github.com/microsoft/TypeScript/issues/31535\ndeclare const TextEncoder: any;\ndeclare const TextDecoder: any;\n\n/**\n * Converts string to bytes using UTF8 encoding.\n * @example utf8ToBytes('abc') // Uint8Array.from([97, 98, 99])\n */\nexport function utf8ToBytes(str: string): Uint8Array {\n  if (typeof str !== 'string') throw new Error('string expected');\n  return new Uint8Array(new TextEncoder().encode(str)); // https://bugzil.la/1681809\n}\n\n/**\n * Converts bytes to string using UTF8 encoding.\n * @example bytesToUtf8(Uint8Array.from([97, 98, 99])) // 'abc'\n */\nexport function bytesToUtf8(bytes: Uint8Array): string {\n  return new TextDecoder().decode(bytes);\n}\n\n/** Accepted input of hash functions. Strings are converted to byte arrays. */\nexport type Input = string | Uint8Array;\n/**\n * Normalizes (non-hex) string or Uint8Array to Uint8Array.\n * Warning: when Uint8Array is passed, it would NOT get copied.\n * Keep in mind for future mutable operations.\n */\nexport function toBytes(data: Input): Uint8Array {\n  if (typeof data === 'string') data = utf8ToBytes(data);\n  abytes(data);\n  return data;\n}\n\n/** KDFs can accept string or Uint8Array for user convenience. */\nexport type KDFInput = string | Uint8Array;\n/**\n * Helper for KDFs: consumes uint8array or string.\n * When string is passed, does utf8 decoding, using TextDecoder.\n */\nexport function kdfInputToBytes(data: KDFInput): Uint8Array {\n  if (typeof data === 'string') data = utf8ToBytes(data);\n  abytes(data);\n  return data;\n}\n\n/** Copies several Uint8Arrays into one. */\nexport function concatBytes(...arrays: Uint8Array[]): Uint8Array {\n  let sum = 0;\n  for (let i = 0; i < arrays.length; i++) {\n    const a = arrays[i];\n    abytes(a);\n    sum += a.length;\n  }\n  const res = new Uint8Array(sum);\n  for (let i = 0, pad = 0; i < arrays.length; i++) {\n    const a = arrays[i];\n    res.set(a, pad);\n    pad += a.length;\n  }\n  return res;\n}\n\ntype EmptyObj = {};\nexport function checkOpts<T1 extends EmptyObj, T2 extends EmptyObj>(\n  defaults: T1,\n  opts?: T2\n): T1 & T2 {\n  if (opts !== undefined && {}.toString.call(opts) !== '[object Object]')\n    throw new Error('options should be object or undefined');\n  const merged = Object.assign(defaults, opts);\n  return merged as T1 & T2;\n}\n\n/** Hash interface. */\nexport type IHash = {\n  (data: Uint8Array): Uint8Array;\n  blockLen: number;\n  outputLen: number;\n  create: any;\n};\n\n/** For runtime check if class implements interface */\nexport abstract class Hash<T extends Hash<T>> {\n  abstract blockLen: number; // Bytes per block\n  abstract outputLen: number; // Bytes in output\n  abstract update(buf: Input): this;\n  // Writes digest into buf\n  abstract digestInto(buf: Uint8Array): void;\n  abstract digest(): Uint8Array;\n  /**\n   * Resets internal state. Makes Hash instance unusable.\n   * Reset is impossible for keyed hashes if key is consumed into state. If digest is not consumed\n   * by user, they will need to manually call `destroy()` when zeroing is necessary.\n   */\n  abstract destroy(): void;\n  /**\n   * Clones hash instance. Unsafe: doesn't check whether `to` is valid. Can be used as `clone()`\n   * when no options are passed.\n   * Reasons to use `_cloneInto` instead of clone: 1) performance 2) reuse instance => all internal\n   * buffers are overwritten => causes buffer overwrite which is used for digest in some cases.\n   * There are no guarantees for clean-up because it's impossible in JS.\n   */\n  abstract _cloneInto(to?: T): T;\n  // Safe version that clones internal state\n  abstract clone(): T;\n}\n\n/**\n * XOF: streaming API to read digest in chunks.\n * Same as 'squeeze' in keccak/k12 and 'seek' in blake3, but more generic name.\n * When hash used in XOF mode it is up to user to call '.destroy' afterwards, since we cannot\n * destroy state, next call can require more bytes.\n */\nexport type HashXOF<T extends Hash<T>> = Hash<T> & {\n  xof(bytes: number): Uint8Array; // Read 'bytes' bytes from digest stream\n  xofInto(buf: Uint8Array): Uint8Array; // read buf.length bytes from digest stream into buf\n};\n\n/** Hash function */\nexport type CHash = ReturnType<typeof createHasher>;\n/** Hash function with output */\nexport type CHashO = ReturnType<typeof createOptHasher>;\n/** XOF with output */\nexport type CHashXO = ReturnType<typeof createXOFer>;\n\n/** Wraps hash function, creating an interface on top of it */\nexport function createHasher<T extends Hash<T>>(\n  hashCons: () => Hash<T>\n): {\n  (msg: Input): Uint8Array;\n  outputLen: number;\n  blockLen: number;\n  create(): Hash<T>;\n} {\n  const hashC = (msg: Input): Uint8Array => hashCons().update(toBytes(msg)).digest();\n  const tmp = hashCons();\n  hashC.outputLen = tmp.outputLen;\n  hashC.blockLen = tmp.blockLen;\n  hashC.create = () => hashCons();\n  return hashC;\n}\n\nexport function createOptHasher<H extends Hash<H>, T extends Object>(\n  hashCons: (opts?: T) => Hash<H>\n): {\n  (msg: Input, opts?: T): Uint8Array;\n  outputLen: number;\n  blockLen: number;\n  create(opts?: T): Hash<H>;\n} {\n  const hashC = (msg: Input, opts?: T): Uint8Array => hashCons(opts).update(toBytes(msg)).digest();\n  const tmp = hashCons({} as T);\n  hashC.outputLen = tmp.outputLen;\n  hashC.blockLen = tmp.blockLen;\n  hashC.create = (opts?: T) => hashCons(opts);\n  return hashC;\n}\n\nexport function createXOFer<H extends HashXOF<H>, T extends Object>(\n  hashCons: (opts?: T) => HashXOF<H>\n): {\n  (msg: Input, opts?: T): Uint8Array;\n  outputLen: number;\n  blockLen: number;\n  create(opts?: T): HashXOF<H>;\n} {\n  const hashC = (msg: Input, opts?: T): Uint8Array => hashCons(opts).update(toBytes(msg)).digest();\n  const tmp = hashCons({} as T);\n  hashC.outputLen = tmp.outputLen;\n  hashC.blockLen = tmp.blockLen;\n  hashC.create = (opts?: T) => hashCons(opts);\n  return hashC;\n}\nexport const wrapConstructor: typeof createHasher = createHasher;\nexport const wrapConstructorWithOpts: typeof createOptHasher = createOptHasher;\nexport const wrapXOFConstructorWithOpts: typeof createXOFer = createXOFer;\n\n/** Cryptographically secure PRNG. Uses internal OS-level `crypto.getRandomValues`. */\nexport function randomBytes(bytesLength = 32): Uint8Array {\n  if (crypto && typeof crypto.getRandomValues === 'function') {\n    return crypto.getRandomValues(new Uint8Array(bytesLength));\n  }\n  // Legacy Node.js compatibility\n  if (crypto && typeof crypto.randomBytes === 'function') {\n    return Uint8Array.from(crypto.randomBytes(bytesLength));\n  }\n  throw new Error('crypto.getRandomValues must be defined');\n}\n", "/**\n * Internal Merkle-Damgard hash utils.\n * @module\n */\nimport { type Input, Hash, abytes, aexists, aoutput, clean, createView, toBytes } from './utils.ts';\n\n/** Polyfill for Safari 14. https://caniuse.com/mdn-javascript_builtins_dataview_setbiguint64 */\nexport function setBigUint64(\n  view: DataView,\n  byteOffset: number,\n  value: bigint,\n  isLE: boolean\n): void {\n  if (typeof view.setBigUint64 === 'function') return view.setBigUint64(byteOffset, value, isLE);\n  const _32n = BigInt(32);\n  const _u32_max = BigInt(0xffffffff);\n  const wh = Number((value >> _32n) & _u32_max);\n  const wl = Number(value & _u32_max);\n  const h = isLE ? 4 : 0;\n  const l = isLE ? 0 : 4;\n  view.setUint32(byteOffset + h, wh, isLE);\n  view.setUint32(byteOffset + l, wl, isLE);\n}\n\n/** Choice: a ? b : c */\nexport function Chi(a: number, b: number, c: number): number {\n  return (a & b) ^ (~a & c);\n}\n\n/** Majority function, true if any two inputs is true. */\nexport function Maj(a: number, b: number, c: number): number {\n  return (a & b) ^ (a & c) ^ (b & c);\n}\n\n/**\n * Merkle-Damgard hash construction base class.\n * Could be used to create MD5, RIPEMD, SHA1, SHA2.\n */\nexport abstract class HashMD<T extends HashMD<T>> extends Hash<T> {\n  protected abstract process(buf: DataView, offset: number): void;\n  protected abstract get(): number[];\n  protected abstract set(...args: number[]): void;\n  abstract destroy(): void;\n  protected abstract roundClean(): void;\n\n  readonly blockLen: number;\n  readonly outputLen: number;\n  readonly padOffset: number;\n  readonly isLE: boolean;\n\n  // For partial updates less than block size\n  protected buffer: Uint8Array;\n  protected view: DataView;\n  protected finished = false;\n  protected length = 0;\n  protected pos = 0;\n  protected destroyed = false;\n\n  constructor(blockLen: number, outputLen: number, padOffset: number, isLE: boolean) {\n    super();\n    this.blockLen = blockLen;\n    this.outputLen = outputLen;\n    this.padOffset = padOffset;\n    this.isLE = isLE;\n    this.buffer = new Uint8Array(blockLen);\n    this.view = createView(this.buffer);\n  }\n  update(data: Input): this {\n    aexists(this);\n    data = toBytes(data);\n    abytes(data);\n    const { view, buffer, blockLen } = this;\n    const len = data.length;\n    for (let pos = 0; pos < len; ) {\n      const take = Math.min(blockLen - this.pos, len - pos);\n      // Fast path: we have at least one block in input, cast it to view and process\n      if (take === blockLen) {\n        const dataView = createView(data);\n        for (; blockLen <= len - pos; pos += blockLen) this.process(dataView, pos);\n        continue;\n      }\n      buffer.set(data.subarray(pos, pos + take), this.pos);\n      this.pos += take;\n      pos += take;\n      if (this.pos === blockLen) {\n        this.process(view, 0);\n        this.pos = 0;\n      }\n    }\n    this.length += data.length;\n    this.roundClean();\n    return this;\n  }\n  digestInto(out: Uint8Array): void {\n    aexists(this);\n    aoutput(out, this);\n    this.finished = true;\n    // Padding\n    // We can avoid allocation of buffer for padding completely if it\n    // was previously not allocated here. But it won't change performance.\n    const { buffer, view, blockLen, isLE } = this;\n    let { pos } = this;\n    // append the bit '1' to the message\n    buffer[pos++] = 0b10000000;\n    clean(this.buffer.subarray(pos));\n    // we have less than padOffset left in buffer, so we cannot put length in\n    // current block, need process it and pad again\n    if (this.padOffset > blockLen - pos) {\n      this.process(view, 0);\n      pos = 0;\n    }\n    // Pad until full block byte with zeros\n    for (let i = pos; i < blockLen; i++) buffer[i] = 0;\n    // Note: sha512 requires length to be 128bit integer, but length in JS will overflow before that\n    // You need to write around 2 exabytes (u64_max / 8 / (1024**6)) for this to happen.\n    // So we just write lowest 64 bits of that value.\n    setBigUint64(view, blockLen - 8, BigInt(this.length * 8), isLE);\n    this.process(view, 0);\n    const oview = createView(out);\n    const len = this.outputLen;\n    // NOTE: we do division by 4 later, which should be fused in single op with modulo by JIT\n    if (len % 4) throw new Error('_sha2: outputLen should be aligned to 32bit');\n    const outLen = len / 4;\n    const state = this.get();\n    if (outLen > state.length) throw new Error('_sha2: outputLen bigger than state');\n    for (let i = 0; i < outLen; i++) oview.setUint32(4 * i, state[i], isLE);\n  }\n  digest(): Uint8Array {\n    const { buffer, outputLen } = this;\n    this.digestInto(buffer);\n    const res = buffer.slice(0, outputLen);\n    this.destroy();\n    return res;\n  }\n  _cloneInto(to?: T): T {\n    to ||= new (this.constructor as any)() as T;\n    to.set(...this.get());\n    const { blockLen, buffer, length, finished, destroyed, pos } = this;\n    to.destroyed = destroyed;\n    to.finished = finished;\n    to.length = length;\n    to.pos = pos;\n    if (length % blockLen) to.buffer.set(buffer);\n    return to;\n  }\n  clone(): T {\n    return this._cloneInto();\n  }\n}\n\n/**\n * Initial SHA-2 state: fractional parts of square roots of first 16 primes 2..53.\n * Check out `test/misc/sha2-gen-iv.js` for recomputation guide.\n */\n\n/** Initial SHA256 state. Bits 0..32 of frac part of sqrt of primes 2..19 */\nexport const SHA256_IV: Uint32Array = /* @__PURE__ */ Uint32Array.from([\n  0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a, 0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19,\n]);\n\n/** Initial SHA224 state. Bits 32..64 of frac part of sqrt of primes 23..53 */\nexport const SHA224_IV: Uint32Array = /* @__PURE__ */ Uint32Array.from([\n  0xc1059ed8, 0x367cd507, 0x3070dd17, 0xf70e5939, 0xffc00b31, 0x68581511, 0x64f98fa7, 0xbefa4fa4,\n]);\n\n/** Initial SHA384 state. Bits 0..64 of frac part of sqrt of primes 23..53 */\nexport const SHA384_IV: Uint32Array = /* @__PURE__ */ Uint32Array.from([\n  0xcbbb9d5d, 0xc1059ed8, 0x629a292a, 0x367cd507, 0x9159015a, 0x3070dd17, 0x152fecd8, 0xf70e5939,\n  0x67332667, 0xffc00b31, 0x8eb44a87, 0x68581511, 0xdb0c2e0d, 0x64f98fa7, 0x47b5481d, 0xbefa4fa4,\n]);\n\n/** Initial SHA512 state. Bits 0..64 of frac part of sqrt of primes 2..19 */\nexport const SHA512_IV: Uint32Array = /* @__PURE__ */ Uint32Array.from([\n  0x6a09e667, 0xf3bcc908, 0xbb67ae85, 0x84caa73b, 0x3c6ef372, 0xfe94f82b, 0xa54ff53a, 0x5f1d36f1,\n  0x510e527f, 0xade682d1, 0x9b05688c, 0x2b3e6c1f, 0x1f83d9ab, 0xfb41bd6b, 0x5be0cd19, 0x137e2179,\n]);\n", "/**\n * Internal helpers for u64. BigUint64Array is too slow as per 2025, so we implement it using Uint32Array.\n * @todo re-check https://issues.chromium.org/issues/42212588\n * @module\n */\nconst U32_MASK64 = /* @__PURE__ */ BigInt(2 ** 32 - 1);\nconst _32n = /* @__PURE__ */ BigInt(32);\n\nfunction fromBig(\n  n: bigint,\n  le = false\n): {\n  h: number;\n  l: number;\n} {\n  if (le) return { h: Number(n & U32_MASK64), l: Number((n >> _32n) & U32_MASK64) };\n  return { h: Number((n >> _32n) & U32_MASK64) | 0, l: Number(n & U32_MASK64) | 0 };\n}\n\nfunction split(lst: bigint[], le = false): Uint32Array[] {\n  const len = lst.length;\n  let Ah = new Uint32Array(len);\n  let Al = new Uint32Array(len);\n  for (let i = 0; i < len; i++) {\n    const { h, l } = fromBig(lst[i], le);\n    [Ah[i], Al[i]] = [h, l];\n  }\n  return [Ah, Al];\n}\n\nconst toBig = (h: number, l: number): bigint => (BigInt(h >>> 0) << _32n) | BigInt(l >>> 0);\n// for Shift in [0, 32)\nconst shrSH = (h: number, _l: number, s: number): number => h >>> s;\nconst shrSL = (h: number, l: number, s: number): number => (h << (32 - s)) | (l >>> s);\n// Right rotate for Shift in [1, 32)\nconst rotrSH = (h: number, l: number, s: number): number => (h >>> s) | (l << (32 - s));\nconst rotrSL = (h: number, l: number, s: number): number => (h << (32 - s)) | (l >>> s);\n// Right rotate for Shift in (32, 64), NOTE: 32 is special case.\nconst rotrBH = (h: number, l: number, s: number): number => (h << (64 - s)) | (l >>> (s - 32));\nconst rotrBL = (h: number, l: number, s: number): number => (h >>> (s - 32)) | (l << (64 - s));\n// Right rotate for shift===32 (just swaps l&h)\nconst rotr32H = (_h: number, l: number): number => l;\nconst rotr32L = (h: number, _l: number): number => h;\n// Left rotate for Shift in [1, 32)\nconst rotlSH = (h: number, l: number, s: number): number => (h << s) | (l >>> (32 - s));\nconst rotlSL = (h: number, l: number, s: number): number => (l << s) | (h >>> (32 - s));\n// Left rotate for Shift in (32, 64), NOTE: 32 is special case.\nconst rotlBH = (h: number, l: number, s: number): number => (l << (s - 32)) | (h >>> (64 - s));\nconst rotlBL = (h: number, l: number, s: number): number => (h << (s - 32)) | (l >>> (64 - s));\n\n// JS uses 32-bit signed integers for bitwise operations which means we cannot\n// simple take carry out of low bit sum by shift, we need to use division.\nfunction add(\n  Ah: number,\n  Al: number,\n  Bh: number,\n  Bl: number\n): {\n  h: number;\n  l: number;\n} {\n  const l = (Al >>> 0) + (Bl >>> 0);\n  return { h: (Ah + Bh + ((l / 2 ** 32) | 0)) | 0, l: l | 0 };\n}\n// Addition with more than 2 elements\nconst add3L = (Al: number, Bl: number, Cl: number): number => (Al >>> 0) + (Bl >>> 0) + (Cl >>> 0);\nconst add3H = (low: number, Ah: number, Bh: number, Ch: number): number =>\n  (Ah + Bh + Ch + ((low / 2 ** 32) | 0)) | 0;\nconst add4L = (Al: number, Bl: number, Cl: number, Dl: number): number =>\n  (Al >>> 0) + (Bl >>> 0) + (Cl >>> 0) + (Dl >>> 0);\nconst add4H = (low: number, Ah: number, Bh: number, Ch: number, Dh: number): number =>\n  (Ah + Bh + Ch + Dh + ((low / 2 ** 32) | 0)) | 0;\nconst add5L = (Al: number, Bl: number, Cl: number, Dl: number, El: number): number =>\n  (Al >>> 0) + (Bl >>> 0) + (Cl >>> 0) + (Dl >>> 0) + (El >>> 0);\nconst add5H = (low: number, Ah: number, Bh: number, Ch: number, Dh: number, Eh: number): number =>\n  (Ah + Bh + Ch + Dh + Eh + ((low / 2 ** 32) | 0)) | 0;\n\n// prettier-ignore\nexport {\n  add, add3H, add3L, add4H, add4L, add5H, add5L, fromBig, rotlBH, rotlBL, rotlSH, rotlSL, rotr32H, rotr32L, rotrBH, rotrBL, rotrSH, rotrSL, shrSH, shrSL, split, toBig\n};\n// prettier-ignore\nconst u64: { fromBig: typeof fromBig; split: typeof split; toBig: (h: number, l: number) => bigint; shrSH: (h: number, _l: number, s: number) => number; shrSL: (h: number, l: number, s: number) => number; rotrSH: (h: number, l: number, s: number) => number; rotrSL: (h: number, l: number, s: number) => number; rotrBH: (h: number, l: number, s: number) => number; rotrBL: (h: number, l: number, s: number) => number; rotr32H: (_h: number, l: number) => number; rotr32L: (h: number, _l: number) => number; rotlSH: (h: number, l: number, s: number) => number; rotlSL: (h: number, l: number, s: number) => number; rotlBH: (h: number, l: number, s: number) => number; rotlBL: (h: number, l: number, s: number) => number; add: typeof add; add3L: (Al: number, Bl: number, Cl: number) => number; add3H: (low: number, Ah: number, Bh: number, Ch: number) => number; add4L: (Al: number, Bl: number, Cl: number, Dl: number) => number; add4H: (low: number, Ah: number, Bh: number, Ch: number, Dh: number) => number; add5H: (low: number, Ah: number, Bh: number, Ch: number, Dh: number, Eh: number) => number; add5L: (Al: number, Bl: number, Cl: number, Dl: number, El: number) => number; } = {\n  fromBig, split, toBig,\n  shrSH, shrSL,\n  rotrSH, rotrSL, rotrBH, rotrBL,\n  rotr32H, rotr32L,\n  rotlSH, rotlSL, rotlBH, rotlBL,\n  add, add3L, add3H, add4L, add4H, add5H, add5L,\n};\nexport default u64;\n", "/**\n * SHA2 hash function. A.k.a. sha256, sha384, sha512, sha512_224, sha512_256.\n * SHA256 is the fastest hash implementable in JS, even faster than Blake3.\n * Check out [RFC 4634](https://datatracker.ietf.org/doc/html/rfc4634) and\n * [FIPS 180-4](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf).\n * @module\n */\nimport { Chi, HashMD, Maj, SHA224_IV, SHA256_IV, SHA384_IV, SHA512_IV } from './_md.ts';\nimport * as u64 from './_u64.ts';\nimport { type CHash, clean, createHasher, rotr } from './utils.ts';\n\n/**\n * Round constants:\n * First 32 bits of fractional parts of the cube roots of the first 64 primes 2..311)\n */\n// prettier-ignore\nconst SHA256_K = /* @__PURE__ */ Uint32Array.from([\n  0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,\n  0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,\n  0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,\n  0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,\n  0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n  0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,\n  0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n  0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2\n]);\n\n/** Reusable temporary buffer. \"W\" comes straight from spec. */\nconst SHA256_W = /* @__PURE__ */ new Uint32Array(64);\nexport class SHA256 extends HashMD<SHA256> {\n  // We cannot use array here since array allows indexing by variable\n  // which means optimizer/compiler cannot use registers.\n  protected A: number = SHA256_IV[0] | 0;\n  protected B: number = SHA256_IV[1] | 0;\n  protected C: number = SHA256_IV[2] | 0;\n  protected D: number = SHA256_IV[3] | 0;\n  protected E: number = SHA256_IV[4] | 0;\n  protected F: number = SHA256_IV[5] | 0;\n  protected G: number = SHA256_IV[6] | 0;\n  protected H: number = SHA256_IV[7] | 0;\n\n  constructor(outputLen: number = 32) {\n    super(64, outputLen, 8, false);\n  }\n  protected get(): [number, number, number, number, number, number, number, number] {\n    const { A, B, C, D, E, F, G, H } = this;\n    return [A, B, C, D, E, F, G, H];\n  }\n  // prettier-ignore\n  protected set(\n    A: number, B: number, C: number, D: number, E: number, F: number, G: number, H: number\n  ): void {\n    this.A = A | 0;\n    this.B = B | 0;\n    this.C = C | 0;\n    this.D = D | 0;\n    this.E = E | 0;\n    this.F = F | 0;\n    this.G = G | 0;\n    this.H = H | 0;\n  }\n  protected process(view: DataView, offset: number): void {\n    // Extend the first 16 words into the remaining 48 words w[16..63] of the message schedule array\n    for (let i = 0; i < 16; i++, offset += 4) SHA256_W[i] = view.getUint32(offset, false);\n    for (let i = 16; i < 64; i++) {\n      const W15 = SHA256_W[i - 15];\n      const W2 = SHA256_W[i - 2];\n      const s0 = rotr(W15, 7) ^ rotr(W15, 18) ^ (W15 >>> 3);\n      const s1 = rotr(W2, 17) ^ rotr(W2, 19) ^ (W2 >>> 10);\n      SHA256_W[i] = (s1 + SHA256_W[i - 7] + s0 + SHA256_W[i - 16]) | 0;\n    }\n    // Compression function main loop, 64 rounds\n    let { A, B, C, D, E, F, G, H } = this;\n    for (let i = 0; i < 64; i++) {\n      const sigma1 = rotr(E, 6) ^ rotr(E, 11) ^ rotr(E, 25);\n      const T1 = (H + sigma1 + Chi(E, F, G) + SHA256_K[i] + SHA256_W[i]) | 0;\n      const sigma0 = rotr(A, 2) ^ rotr(A, 13) ^ rotr(A, 22);\n      const T2 = (sigma0 + Maj(A, B, C)) | 0;\n      H = G;\n      G = F;\n      F = E;\n      E = (D + T1) | 0;\n      D = C;\n      C = B;\n      B = A;\n      A = (T1 + T2) | 0;\n    }\n    // Add the compressed chunk to the current hash value\n    A = (A + this.A) | 0;\n    B = (B + this.B) | 0;\n    C = (C + this.C) | 0;\n    D = (D + this.D) | 0;\n    E = (E + this.E) | 0;\n    F = (F + this.F) | 0;\n    G = (G + this.G) | 0;\n    H = (H + this.H) | 0;\n    this.set(A, B, C, D, E, F, G, H);\n  }\n  protected roundClean(): void {\n    clean(SHA256_W);\n  }\n  destroy(): void {\n    this.set(0, 0, 0, 0, 0, 0, 0, 0);\n    clean(this.buffer);\n  }\n}\n\nexport class SHA224 extends SHA256 {\n  protected A: number = SHA224_IV[0] | 0;\n  protected B: number = SHA224_IV[1] | 0;\n  protected C: number = SHA224_IV[2] | 0;\n  protected D: number = SHA224_IV[3] | 0;\n  protected E: number = SHA224_IV[4] | 0;\n  protected F: number = SHA224_IV[5] | 0;\n  protected G: number = SHA224_IV[6] | 0;\n  protected H: number = SHA224_IV[7] | 0;\n  constructor() {\n    super(28);\n  }\n}\n\n// SHA2-512 is slower than sha256 in js because u64 operations are slow.\n\n// Round contants\n// First 32 bits of the fractional parts of the cube roots of the first 80 primes 2..409\n// prettier-ignore\nconst K512 = /* @__PURE__ */ (() => u64.split([\n  '0x428a2f98d728ae22', '0x7137449123ef65cd', '0xb5c0fbcfec4d3b2f', '0xe9b5dba58189dbbc',\n  '0x3956c25bf348b538', '0x59f111f1b605d019', '0x923f82a4af194f9b', '0xab1c5ed5da6d8118',\n  '0xd807aa98a3030242', '0x12835b0145706fbe', '0x243185be4ee4b28c', '0x550c7dc3d5ffb4e2',\n  '0x72be5d74f27b896f', '0x80deb1fe3b1696b1', '0x9bdc06a725c71235', '0xc19bf174cf692694',\n  '0xe49b69c19ef14ad2', '0xefbe4786384f25e3', '0x0fc19dc68b8cd5b5', '0x240ca1cc77ac9c65',\n  '0x2de92c6f592b0275', '0x4a7484aa6ea6e483', '0x5cb0a9dcbd41fbd4', '0x76f988da831153b5',\n  '0x983e5152ee66dfab', '0xa831c66d2db43210', '0xb00327c898fb213f', '0xbf597fc7beef0ee4',\n  '0xc6e00bf33da88fc2', '0xd5a79147930aa725', '0x06ca6351e003826f', '0x142929670a0e6e70',\n  '0x27b70a8546d22ffc', '0x2e1b21385c26c926', '0x4d2c6dfc5ac42aed', '0x53380d139d95b3df',\n  '0x650a73548baf63de', '0x766a0abb3c77b2a8', '0x81c2c92e47edaee6', '0x92722c851482353b',\n  '0xa2bfe8a14cf10364', '0xa81a664bbc423001', '0xc24b8b70d0f89791', '0xc76c51a30654be30',\n  '0xd192e819d6ef5218', '0xd69906245565a910', '0xf40e35855771202a', '0x106aa07032bbd1b8',\n  '0x19a4c116b8d2d0c8', '0x1e376c085141ab53', '0x2748774cdf8eeb99', '0x34b0bcb5e19b48a8',\n  '0x391c0cb3c5c95a63', '0x4ed8aa4ae3418acb', '0x5b9cca4f7763e373', '0x682e6ff3d6b2b8a3',\n  '0x748f82ee5defb2fc', '0x78a5636f43172f60', '0x84c87814a1f0ab72', '0x8cc702081a6439ec',\n  '0x90befffa23631e28', '0xa4506cebde82bde9', '0xbef9a3f7b2c67915', '0xc67178f2e372532b',\n  '0xca273eceea26619c', '0xd186b8c721c0c207', '0xeada7dd6cde0eb1e', '0xf57d4f7fee6ed178',\n  '0x06f067aa72176fba', '0x0a637dc5a2c898a6', '0x113f9804bef90dae', '0x1b710b35131c471b',\n  '0x28db77f523047d84', '0x32caab7b40c72493', '0x3c9ebe0a15c9bebc', '0x431d67c49c100d4c',\n  '0x4cc5d4becb3e42b6', '0x597f299cfc657e2a', '0x5fcb6fab3ad6faec', '0x6c44198c4a475817'\n].map(n => BigInt(n))))();\nconst SHA512_Kh = /* @__PURE__ */ (() => K512[0])();\nconst SHA512_Kl = /* @__PURE__ */ (() => K512[1])();\n\n// Reusable temporary buffers\nconst SHA512_W_H = /* @__PURE__ */ new Uint32Array(80);\nconst SHA512_W_L = /* @__PURE__ */ new Uint32Array(80);\n\nexport class SHA512 extends HashMD<SHA512> {\n  // We cannot use array here since array allows indexing by variable\n  // which means optimizer/compiler cannot use registers.\n  // h -- high 32 bits, l -- low 32 bits\n  protected Ah: number = SHA512_IV[0] | 0;\n  protected Al: number = SHA512_IV[1] | 0;\n  protected Bh: number = SHA512_IV[2] | 0;\n  protected Bl: number = SHA512_IV[3] | 0;\n  protected Ch: number = SHA512_IV[4] | 0;\n  protected Cl: number = SHA512_IV[5] | 0;\n  protected Dh: number = SHA512_IV[6] | 0;\n  protected Dl: number = SHA512_IV[7] | 0;\n  protected Eh: number = SHA512_IV[8] | 0;\n  protected El: number = SHA512_IV[9] | 0;\n  protected Fh: number = SHA512_IV[10] | 0;\n  protected Fl: number = SHA512_IV[11] | 0;\n  protected Gh: number = SHA512_IV[12] | 0;\n  protected Gl: number = SHA512_IV[13] | 0;\n  protected Hh: number = SHA512_IV[14] | 0;\n  protected Hl: number = SHA512_IV[15] | 0;\n\n  constructor(outputLen: number = 64) {\n    super(128, outputLen, 16, false);\n  }\n  // prettier-ignore\n  protected get(): [\n    number, number, number, number, number, number, number, number,\n    number, number, number, number, number, number, number, number\n  ] {\n    const { Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl } = this;\n    return [Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl];\n  }\n  // prettier-ignore\n  protected set(\n    Ah: number, Al: number, Bh: number, Bl: number, Ch: number, Cl: number, Dh: number, Dl: number,\n    Eh: number, El: number, Fh: number, Fl: number, Gh: number, Gl: number, Hh: number, Hl: number\n  ): void {\n    this.Ah = Ah | 0;\n    this.Al = Al | 0;\n    this.Bh = Bh | 0;\n    this.Bl = Bl | 0;\n    this.Ch = Ch | 0;\n    this.Cl = Cl | 0;\n    this.Dh = Dh | 0;\n    this.Dl = Dl | 0;\n    this.Eh = Eh | 0;\n    this.El = El | 0;\n    this.Fh = Fh | 0;\n    this.Fl = Fl | 0;\n    this.Gh = Gh | 0;\n    this.Gl = Gl | 0;\n    this.Hh = Hh | 0;\n    this.Hl = Hl | 0;\n  }\n  protected process(view: DataView, offset: number): void {\n    // Extend the first 16 words into the remaining 64 words w[16..79] of the message schedule array\n    for (let i = 0; i < 16; i++, offset += 4) {\n      SHA512_W_H[i] = view.getUint32(offset);\n      SHA512_W_L[i] = view.getUint32((offset += 4));\n    }\n    for (let i = 16; i < 80; i++) {\n      // s0 := (w[i-15] rightrotate 1) xor (w[i-15] rightrotate 8) xor (w[i-15] rightshift 7)\n      const W15h = SHA512_W_H[i - 15] | 0;\n      const W15l = SHA512_W_L[i - 15] | 0;\n      const s0h = u64.rotrSH(W15h, W15l, 1) ^ u64.rotrSH(W15h, W15l, 8) ^ u64.shrSH(W15h, W15l, 7);\n      const s0l = u64.rotrSL(W15h, W15l, 1) ^ u64.rotrSL(W15h, W15l, 8) ^ u64.shrSL(W15h, W15l, 7);\n      // s1 := (w[i-2] rightrotate 19) xor (w[i-2] rightrotate 61) xor (w[i-2] rightshift 6)\n      const W2h = SHA512_W_H[i - 2] | 0;\n      const W2l = SHA512_W_L[i - 2] | 0;\n      const s1h = u64.rotrSH(W2h, W2l, 19) ^ u64.rotrBH(W2h, W2l, 61) ^ u64.shrSH(W2h, W2l, 6);\n      const s1l = u64.rotrSL(W2h, W2l, 19) ^ u64.rotrBL(W2h, W2l, 61) ^ u64.shrSL(W2h, W2l, 6);\n      // SHA256_W[i] = s0 + s1 + SHA256_W[i - 7] + SHA256_W[i - 16];\n      const SUMl = u64.add4L(s0l, s1l, SHA512_W_L[i - 7], SHA512_W_L[i - 16]);\n      const SUMh = u64.add4H(SUMl, s0h, s1h, SHA512_W_H[i - 7], SHA512_W_H[i - 16]);\n      SHA512_W_H[i] = SUMh | 0;\n      SHA512_W_L[i] = SUMl | 0;\n    }\n    let { Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl } = this;\n    // Compression function main loop, 80 rounds\n    for (let i = 0; i < 80; i++) {\n      // S1 := (e rightrotate 14) xor (e rightrotate 18) xor (e rightrotate 41)\n      const sigma1h = u64.rotrSH(Eh, El, 14) ^ u64.rotrSH(Eh, El, 18) ^ u64.rotrBH(Eh, El, 41);\n      const sigma1l = u64.rotrSL(Eh, El, 14) ^ u64.rotrSL(Eh, El, 18) ^ u64.rotrBL(Eh, El, 41);\n      //const T1 = (H + sigma1 + Chi(E, F, G) + SHA256_K[i] + SHA256_W[i]) | 0;\n      const CHIh = (Eh & Fh) ^ (~Eh & Gh);\n      const CHIl = (El & Fl) ^ (~El & Gl);\n      // T1 = H + sigma1 + Chi(E, F, G) + SHA512_K[i] + SHA512_W[i]\n      // prettier-ignore\n      const T1ll = u64.add5L(Hl, sigma1l, CHIl, SHA512_Kl[i], SHA512_W_L[i]);\n      const T1h = u64.add5H(T1ll, Hh, sigma1h, CHIh, SHA512_Kh[i], SHA512_W_H[i]);\n      const T1l = T1ll | 0;\n      // S0 := (a rightrotate 28) xor (a rightrotate 34) xor (a rightrotate 39)\n      const sigma0h = u64.rotrSH(Ah, Al, 28) ^ u64.rotrBH(Ah, Al, 34) ^ u64.rotrBH(Ah, Al, 39);\n      const sigma0l = u64.rotrSL(Ah, Al, 28) ^ u64.rotrBL(Ah, Al, 34) ^ u64.rotrBL(Ah, Al, 39);\n      const MAJh = (Ah & Bh) ^ (Ah & Ch) ^ (Bh & Ch);\n      const MAJl = (Al & Bl) ^ (Al & Cl) ^ (Bl & Cl);\n      Hh = Gh | 0;\n      Hl = Gl | 0;\n      Gh = Fh | 0;\n      Gl = Fl | 0;\n      Fh = Eh | 0;\n      Fl = El | 0;\n      ({ h: Eh, l: El } = u64.add(Dh | 0, Dl | 0, T1h | 0, T1l | 0));\n      Dh = Ch | 0;\n      Dl = Cl | 0;\n      Ch = Bh | 0;\n      Cl = Bl | 0;\n      Bh = Ah | 0;\n      Bl = Al | 0;\n      const All = u64.add3L(T1l, sigma0l, MAJl);\n      Ah = u64.add3H(All, T1h, sigma0h, MAJh);\n      Al = All | 0;\n    }\n    // Add the compressed chunk to the current hash value\n    ({ h: Ah, l: Al } = u64.add(this.Ah | 0, this.Al | 0, Ah | 0, Al | 0));\n    ({ h: Bh, l: Bl } = u64.add(this.Bh | 0, this.Bl | 0, Bh | 0, Bl | 0));\n    ({ h: Ch, l: Cl } = u64.add(this.Ch | 0, this.Cl | 0, Ch | 0, Cl | 0));\n    ({ h: Dh, l: Dl } = u64.add(this.Dh | 0, this.Dl | 0, Dh | 0, Dl | 0));\n    ({ h: Eh, l: El } = u64.add(this.Eh | 0, this.El | 0, Eh | 0, El | 0));\n    ({ h: Fh, l: Fl } = u64.add(this.Fh | 0, this.Fl | 0, Fh | 0, Fl | 0));\n    ({ h: Gh, l: Gl } = u64.add(this.Gh | 0, this.Gl | 0, Gh | 0, Gl | 0));\n    ({ h: Hh, l: Hl } = u64.add(this.Hh | 0, this.Hl | 0, Hh | 0, Hl | 0));\n    this.set(Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl);\n  }\n  protected roundClean(): void {\n    clean(SHA512_W_H, SHA512_W_L);\n  }\n  destroy(): void {\n    clean(this.buffer);\n    this.set(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);\n  }\n}\n\nexport class SHA384 extends SHA512 {\n  protected Ah: number = SHA384_IV[0] | 0;\n  protected Al: number = SHA384_IV[1] | 0;\n  protected Bh: number = SHA384_IV[2] | 0;\n  protected Bl: number = SHA384_IV[3] | 0;\n  protected Ch: number = SHA384_IV[4] | 0;\n  protected Cl: number = SHA384_IV[5] | 0;\n  protected Dh: number = SHA384_IV[6] | 0;\n  protected Dl: number = SHA384_IV[7] | 0;\n  protected Eh: number = SHA384_IV[8] | 0;\n  protected El: number = SHA384_IV[9] | 0;\n  protected Fh: number = SHA384_IV[10] | 0;\n  protected Fl: number = SHA384_IV[11] | 0;\n  protected Gh: number = SHA384_IV[12] | 0;\n  protected Gl: number = SHA384_IV[13] | 0;\n  protected Hh: number = SHA384_IV[14] | 0;\n  protected Hl: number = SHA384_IV[15] | 0;\n\n  constructor() {\n    super(48);\n  }\n}\n\n/**\n * Truncated SHA512/256 and SHA512/224.\n * SHA512_IV is XORed with 0xa5a5a5a5a5a5a5a5, then used as \"intermediary\" IV of SHA512/t.\n * Then t hashes string to produce result IV.\n * See `test/misc/sha2-gen-iv.js`.\n */\n\n/** SHA512/224 IV */\nconst T224_IV = /* @__PURE__ */ Uint32Array.from([\n  0x8c3d37c8, 0x19544da2, 0x73e19966, 0x89dcd4d6, 0x1dfab7ae, 0x32ff9c82, 0x679dd514, 0x582f9fcf,\n  0x0f6d2b69, 0x7bd44da8, 0x77e36f73, 0x04c48942, 0x3f9d85a8, 0x6a1d36c8, 0x1112e6ad, 0x91d692a1,\n]);\n\n/** SHA512/256 IV */\nconst T256_IV = /* @__PURE__ */ Uint32Array.from([\n  0x22312194, 0xfc2bf72c, 0x9f555fa3, 0xc84c64c2, 0x2393b86b, 0x6f53b151, 0x96387719, 0x5940eabd,\n  0x96283ee2, 0xa88effe3, 0xbe5e1e25, 0x53863992, 0x2b0199fc, 0x2c85b8aa, 0x0eb72ddc, 0x81c52ca2,\n]);\n\nexport class SHA512_224 extends SHA512 {\n  protected Ah: number = T224_IV[0] | 0;\n  protected Al: number = T224_IV[1] | 0;\n  protected Bh: number = T224_IV[2] | 0;\n  protected Bl: number = T224_IV[3] | 0;\n  protected Ch: number = T224_IV[4] | 0;\n  protected Cl: number = T224_IV[5] | 0;\n  protected Dh: number = T224_IV[6] | 0;\n  protected Dl: number = T224_IV[7] | 0;\n  protected Eh: number = T224_IV[8] | 0;\n  protected El: number = T224_IV[9] | 0;\n  protected Fh: number = T224_IV[10] | 0;\n  protected Fl: number = T224_IV[11] | 0;\n  protected Gh: number = T224_IV[12] | 0;\n  protected Gl: number = T224_IV[13] | 0;\n  protected Hh: number = T224_IV[14] | 0;\n  protected Hl: number = T224_IV[15] | 0;\n\n  constructor() {\n    super(28);\n  }\n}\n\nexport class SHA512_256 extends SHA512 {\n  protected Ah: number = T256_IV[0] | 0;\n  protected Al: number = T256_IV[1] | 0;\n  protected Bh: number = T256_IV[2] | 0;\n  protected Bl: number = T256_IV[3] | 0;\n  protected Ch: number = T256_IV[4] | 0;\n  protected Cl: number = T256_IV[5] | 0;\n  protected Dh: number = T256_IV[6] | 0;\n  protected Dl: number = T256_IV[7] | 0;\n  protected Eh: number = T256_IV[8] | 0;\n  protected El: number = T256_IV[9] | 0;\n  protected Fh: number = T256_IV[10] | 0;\n  protected Fl: number = T256_IV[11] | 0;\n  protected Gh: number = T256_IV[12] | 0;\n  protected Gl: number = T256_IV[13] | 0;\n  protected Hh: number = T256_IV[14] | 0;\n  protected Hl: number = T256_IV[15] | 0;\n\n  constructor() {\n    super(32);\n  }\n}\n\n/**\n * SHA2-256 hash function from RFC 4634.\n *\n * It is the fastest JS hash, even faster than Blake3.\n * To break sha256 using birthday attack, attackers need to try 2^128 hashes.\n * BTC network is doing 2^70 hashes/sec (2^95 hashes/year) as per 2025.\n */\nexport const sha256: CHash = /* @__PURE__ */ createHasher(() => new SHA256());\n/** SHA2-224 hash function from RFC 4634 */\nexport const sha224: CHash = /* @__PURE__ */ createHasher(() => new SHA224());\n\n/** SHA2-512 hash function from RFC 4634. */\nexport const sha512: CHash = /* @__PURE__ */ createHasher(() => new SHA512());\n/** SHA2-384 hash function from RFC 4634. */\nexport const sha384: CHash = /* @__PURE__ */ createHasher(() => new SHA384());\n\n/**\n * SHA2-512/256 \"truncated\" hash function, with improved resistance to length extension attacks.\n * See the paper on [truncated SHA512](https://eprint.iacr.org/2010/548.pdf).\n */\nexport const sha512_256: CHash = /* @__PURE__ */ createHasher(() => new SHA512_256());\n/**\n * SHA2-512/224 \"truncated\" hash function, with improved resistance to length extension attacks.\n * See the paper on [truncated SHA512](https://eprint.iacr.org/2010/548.pdf).\n */\nexport const sha512_224: CHash = /* @__PURE__ */ createHasher(() => new SHA512_224());\n", "import { detectDupes } from \"@liveblocks/core\";\n\nimport { PKG_FORMAT, PKG_NAME, PKG_VERSION } from \"./version\";\n\ndetectDupes(PKG_NAME, PKG_VERSION, PKG_FORMAT);\n\nexport type { ProviderOptions } from \"./provider\";\nexport { LiveblocksYjsProvider } from \"./provider\";\nexport { getYjsProviderForRoom } from \"./providerContext\";\n", "declare const __VERSION__: string;\ndeclare const TSUP_FORMAT: string;\n\nexport const PKG_NAME = \"@liveblocks/yjs\";\nexport const PKG_VERSION = typeof __VERSION__ === \"string\" && __VERSION__;\nexport const PKG_FORMAT = typeof TSUP_FORMAT === \"string\" && TSUP_FORMAT;\n", "import {\n  DerivedSignal,\n  type IYjsProvider,\n  type OpaqueRoom,\n  type YjsSyncStatus,\n} from \"@liveblocks/core\";\nimport { ClientMsgCode, kInternal, MutableSignal } from \"@liveblocks/core\";\nimport { Base64 } from \"js-base64\";\nimport { Observable } from \"lib0/observable\";\nimport { IndexeddbPersistence } from \"y-indexeddb\";\nimport type { Doc } from \"yjs\";\nimport { PermanentUserData } from \"yjs\";\n\nimport { Awareness } from \"./awareness\";\nimport yDocHandler from \"./doc\";\n\nexport type ProviderOptions = {\n  enablePermanentUserData?: boolean;\n  autoloadSubdocs?: boolean;\n  offlineSupport_experimental?: boolean;\n  useV2Encoding_experimental?: boolean;\n};\n\nexport class LiveblocksYjsProvider\n  extends Observable<unknown>\n  implements IYjsProvider\n{\n  private readonly room: OpaqueRoom;\n  private readonly rootDoc: Doc;\n  private readonly options: ProviderOptions;\n  private indexeddbProvider: IndexeddbPersistence | null = null;\n  private isPaused = false;\n\n  private readonly unsubscribers: Array<() => void> = [];\n\n  public readonly awareness: Awareness;\n\n  public readonly rootDocHandler: yDocHandler;\n  private readonly subdocHandlers = new MutableSignal<\n    Map<string, yDocHandler>\n  >(new Map());\n  private readonly syncStatus: DerivedSignal<YjsSyncStatus>;\n\n  public readonly permanentUserData?: PermanentUserData;\n\n  constructor(room: OpaqueRoom, doc: Doc, options: ProviderOptions = {}) {\n    super();\n    this.rootDoc = doc;\n    this.room = room;\n    this.options = options;\n    this.rootDocHandler = new yDocHandler({\n      doc,\n      isRoot: true,\n      updateDoc: this.updateDoc,\n      fetchDoc: this.fetchDoc,\n      useV2Encoding: this.options.useV2Encoding_experimental ?? false,\n    });\n\n    if (this.options.enablePermanentUserData) {\n      this.permanentUserData = new PermanentUserData(doc);\n    }\n\n    // TODO: Display a warning if a YjsProvider is already attached to the room\n    room[kInternal].setYjsProvider(this);\n\n    // if we have a connectionId already during construction, use that\n    this.awareness = new Awareness(this.rootDoc, this.room);\n\n    this.unsubscribers.push(\n      this.room.events.status.subscribe((status) => {\n        if (status === \"connected\") {\n          this.rootDocHandler.syncDoc();\n        } else {\n          this.rootDocHandler.synced = false;\n        }\n      })\n    );\n\n    this.unsubscribers.push(\n      this.room.events.ydoc.subscribe((message) => {\n        const { type } = message;\n        if (type === ClientMsgCode.UPDATE_YDOC) {\n          // don't apply updates that came from the client\n          return;\n        }\n        const {\n          stateVector,\n          update: updateStr,\n          guid,\n          v2,\n          remoteSnapshotHash,\n        } = message;\n        const canWrite = this.room.getSelf()?.canWrite ?? true;\n        const update = Base64.toUint8Array(updateStr);\n\n        // find the right doc and update\n        if (guid !== undefined) {\n          this.subdocHandlers.get().get(guid)?.handleServerUpdate({\n            update,\n            stateVector,\n            readOnly: !canWrite,\n            v2,\n            remoteSnapshotHash,\n          });\n        } else {\n          this.rootDocHandler.handleServerUpdate({\n            update,\n            stateVector,\n            readOnly: !canWrite,\n            v2,\n            remoteSnapshotHash,\n          });\n        }\n      })\n    );\n\n    if (options.offlineSupport_experimental) {\n      this.setupOfflineSupport();\n    }\n\n    // different consumers listen to sync and synced\n    this.rootDocHandler.on(\"synced\", () => {\n      const state = this.rootDocHandler.synced;\n      for (const [_, handler] of this.subdocHandlers.get()) {\n        handler.syncDoc();\n      }\n      this.emit(\"synced\", [state]);\n      this.emit(\"sync\", [state]);\n    });\n    this.rootDoc.on(\"subdocs\", this.handleSubdocs);\n    this.syncDoc();\n\n    this.syncStatus = DerivedSignal.from(() => {\n      // If the root document is loading or synchronizing, we infer that the overall status is also loading or synchronizing.\n      const rootDocumentStatus =\n        this.rootDocHandler.experimental_getSyncStatus();\n      if (\n        rootDocumentStatus === \"loading\" ||\n        rootDocumentStatus === \"synchronizing\"\n      ) {\n        return rootDocumentStatus;\n      }\n\n      // If the root document is synchronized, we check if all subdocs are synchronized. If at least one subdoc is not synchronized, we are still synchronizing.\n      const subdocumentStatuses = Array.from(\n        this.subdocHandlers.get().values()\n      ).map((handler) => handler.experimental_getSyncStatus());\n      if (subdocumentStatuses.some((state) => state !== \"synchronized\")) {\n        return \"synchronizing\";\n      }\n      return \"synchronized\";\n    });\n\n    this.emit(\"status\", [this.getStatus()]);\n\n    this.unsubscribers.push(\n      this.syncStatus.subscribe(() => {\n        this.emit(\"status\", [this.getStatus()]);\n      })\n    );\n  }\n\n  private setupOfflineSupport = () => {\n    this.indexeddbProvider = new IndexeddbPersistence(\n      this.room.id,\n      this.rootDoc\n    );\n    const onIndexedDbSync = () => {\n      this.rootDocHandler.synced = true;\n    };\n    this.indexeddbProvider.on(\"synced\", onIndexedDbSync);\n\n    this.unsubscribers.push(() => {\n      this.indexeddbProvider?.off(\"synced\", onIndexedDbSync);\n    });\n  };\n\n  private handleSubdocs = ({\n    loaded,\n    removed,\n    added,\n  }: {\n    loaded: Set<Doc>;\n    removed: Set<Doc>;\n    added: Set<Doc>;\n  }) => {\n    loaded.forEach(this.createSubdocHandler);\n    const subdocHandlers = this.subdocHandlers.get();\n    if (this.options.autoloadSubdocs) {\n      for (const subdoc of added) {\n        if (!subdocHandlers.has(subdoc.guid)) {\n          subdoc.load();\n        }\n      }\n    }\n    for (const subdoc of removed) {\n      if (subdocHandlers.has(subdoc.guid)) {\n        subdocHandlers.get(subdoc.guid)?.destroy();\n        subdocHandlers.delete(subdoc.guid);\n      }\n    }\n  };\n\n  private updateDoc = (update: Uint8Array, guid?: string) => {\n    const canWrite = this.room.getSelf()?.canWrite ?? true;\n    if (canWrite && !this.isPaused) {\n      this.room.updateYDoc(\n        Base64.fromUint8Array(update),\n        guid,\n        this.useV2Encoding\n      );\n    }\n  };\n\n  private fetchDoc = (vector: string, guid?: string) => {\n    this.room.fetchYDoc(vector, guid, this.useV2Encoding);\n  };\n\n  private createSubdocHandler = (subdoc: Doc): void => {\n    const subdocHandlers = this.subdocHandlers.get();\n    if (subdocHandlers.has(subdoc.guid)) {\n      // if we already handle this subdoc, just fetch it again\n      subdocHandlers.get(subdoc.guid)?.syncDoc();\n      return;\n    }\n    const handler = new yDocHandler({\n      doc: subdoc,\n      isRoot: false,\n      updateDoc: this.updateDoc,\n      fetchDoc: this.fetchDoc,\n      useV2Encoding: this.options.useV2Encoding_experimental ?? false,\n    });\n    subdocHandlers.set(subdoc.guid, handler);\n  };\n\n  // attempt to load a subdoc of a given guid\n  public loadSubdoc = (guid: string): boolean => {\n    for (const subdoc of this.rootDoc.subdocs) {\n      if (subdoc.guid === guid) {\n        subdoc.load();\n        return true;\n      }\n    }\n    // should we throw instead?\n    return false;\n  };\n\n  private syncDoc = () => {\n    this.rootDocHandler.syncDoc();\n    for (const [_, handler] of this.subdocHandlers.get()) {\n      handler.syncDoc();\n    }\n  };\n\n  get useV2Encoding(): boolean {\n    return this.options.useV2Encoding_experimental ?? false;\n  }\n\n  // The sync'd property is required by some provider implementations\n  get synced(): boolean {\n    return this.rootDocHandler.synced;\n  }\n\n  async pause(): Promise<void> {\n    await this.indexeddbProvider?.destroy();\n    this.indexeddbProvider = null;\n    this.isPaused = true;\n  }\n\n  unpause(): void {\n    this.isPaused = false;\n    if (this.options.offlineSupport_experimental) {\n      this.setupOfflineSupport();\n    }\n    this.rootDocHandler.syncDoc();\n  }\n\n  public getStatus(): YjsSyncStatus {\n    return this.syncStatus.get();\n  }\n\n  destroy(): void {\n    this.unsubscribers.forEach((unsub) => unsub());\n    this.awareness.destroy();\n    this.rootDocHandler.destroy();\n    this._observers = new Map();\n    for (const [_, handler] of this.subdocHandlers.get()) {\n      handler.destroy();\n    }\n    this.subdocHandlers.get().clear();\n    super.destroy();\n  }\n\n  async clearOfflineData(): Promise<void> {\n    if (!this.indexeddbProvider) return;\n    return this.indexeddbProvider.clearData();\n  }\n\n  getYDoc(): Doc {\n    return this.rootDoc;\n  }\n\n  // Some provider implementations expect to be able to call connect/disconnect, implement as noop\n  disconnect(): void {\n    // This is a noop for liveblocks as connections are managed by the room\n  }\n\n  connect(): void {\n    // This is a noop for liveblocks as connections are managed by the room\n  }\n\n  get subdocHandlers(): Map<string, yDocHandler> {\n    return this.subdocHandlers.get();\n  }\n\n  set subdocHandlers(value: Map<string, yDocHandler>) {\n    this.subdocHandlers.mutate((map) => {\n      map.clear();\n      for (const [key, handler] of value) {\n        map.set(key, handler);\n      }\n    });\n  }\n}\n", "/**\n * Utility module to work with key-value stores.\n *\n * @module map\n */\n\n/**\n * Creates a new Map instance.\n *\n * @function\n * @return {Map<any, any>}\n *\n * @function\n */\nexport const create = () => new Map()\n\n/**\n * Copy a Map object into a fresh Map object.\n *\n * @function\n * @template K,V\n * @param {Map<K,V>} m\n * @return {Map<K,V>}\n */\nexport const copy = m => {\n  const r = create()\n  m.forEach((v, k) => { r.set(k, v) })\n  return r\n}\n\n/**\n * Get map property. Create T if property is undefined and set T on map.\n *\n * ```js\n * const listeners = map.setIfUndefined(events, 'eventName', set.create)\n * listeners.add(listener)\n * ```\n *\n * @function\n * @template {Map<any, any>} MAP\n * @template {MAP extends Map<any,infer V> ? function():V : unknown} CF\n * @param {MAP} map\n * @param {MAP extends Map<infer K,any> ? K : unknown} key\n * @param {CF} createT\n * @return {ReturnType<CF>}\n */\nexport const setIfUndefined = (map, key, createT) => {\n  let set = map.get(key)\n  if (set === undefined) {\n    map.set(key, set = createT())\n  }\n  return set\n}\n\n/**\n * Creates an Array and populates it with the content of all key-value pairs using the `f(value, key)` function.\n *\n * @function\n * @template K\n * @template V\n * @template R\n * @param {Map<K,V>} m\n * @param {function(V,K):R} f\n * @return {Array<R>}\n */\nexport const map = (m, f) => {\n  const res = []\n  for (const [key, value] of m) {\n    res.push(f(value, key))\n  }\n  return res\n}\n\n/**\n * Tests whether any key-value pairs pass the test implemented by `f(value, key)`.\n *\n * @todo should rename to some - similarly to Array.some\n *\n * @function\n * @template K\n * @template V\n * @param {Map<K,V>} m\n * @param {function(V,K):boolean} f\n * @return {boolean}\n */\nexport const any = (m, f) => {\n  for (const [key, value] of m) {\n    if (f(value, key)) {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * Tests whether all key-value pairs pass the test implemented by `f(value, key)`.\n *\n * @function\n * @template K\n * @template V\n * @param {Map<K,V>} m\n * @param {function(V,K):boolean} f\n * @return {boolean}\n */\nexport const all = (m, f) => {\n  for (const [key, value] of m) {\n    if (!f(value, key)) {\n      return false\n    }\n  }\n  return true\n}\n", "/**\n * Utility module to work with sets.\n *\n * @module set\n */\n\nexport const create = () => new Set()\n\n/**\n * @template T\n * @param {Set<T>} set\n * @return {Array<T>}\n */\nexport const toArray = set => Array.from(set)\n\n/**\n * @template T\n * @param {Set<T>} set\n * @return {T}\n */\nexport const first = set =>\n  set.values().next().value ?? undefined\n\n/**\n * @template T\n * @param {Iterable<T>} entries\n * @return {Set<T>}\n */\nexport const from = entries => new Set(entries)\n", "/**\n * Utility module to work with Arrays.\n *\n * @module array\n */\n\nimport * as set from './set.js'\n\n/**\n * Return the last element of an array. The element must exist\n *\n * @template L\n * @param {ArrayLike<L>} arr\n * @return {L}\n */\nexport const last = arr => arr[arr.length - 1]\n\n/**\n * @template C\n * @return {Array<C>}\n */\nexport const create = () => /** @type {Array<C>} */ ([])\n\n/**\n * @template D\n * @param {Array<D>} a\n * @return {Array<D>}\n */\nexport const copy = a => /** @type {Array<D>} */ (a.slice())\n\n/**\n * Append elements from src to dest\n *\n * @template M\n * @param {Array<M>} dest\n * @param {Array<M>} src\n */\nexport const appendTo = (dest, src) => {\n  for (let i = 0; i < src.length; i++) {\n    dest.push(src[i])\n  }\n}\n\n/**\n * Transforms something array-like to an actual Array.\n *\n * @function\n * @template T\n * @param {ArrayLike<T>|Iterable<T>} arraylike\n * @return {T}\n */\nexport const from = Array.from\n\n/**\n * True iff condition holds on every element in the Array.\n *\n * @function\n * @template ITEM\n * @template {ArrayLike<ITEM>} ARR\n *\n * @param {ARR} arr\n * @param {function(ITEM, number, ARR):boolean} f\n * @return {boolean}\n */\nexport const every = (arr, f) => {\n  for (let i = 0; i < arr.length; i++) {\n    if (!f(arr[i], i, arr)) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * True iff condition holds on some element in the Array.\n *\n * @function\n * @template S\n * @template {ArrayLike<S>} ARR\n * @param {ARR} arr\n * @param {function(S, number, ARR):boolean} f\n * @return {boolean}\n */\nexport const some = (arr, f) => {\n  for (let i = 0; i < arr.length; i++) {\n    if (f(arr[i], i, arr)) {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * @template ELEM\n *\n * @param {ArrayLike<ELEM>} a\n * @param {ArrayLike<ELEM>} b\n * @return {boolean}\n */\nexport const equalFlat = (a, b) => a.length === b.length && every(a, (item, index) => item === b[index])\n\n/**\n * @template ELEM\n * @param {Array<Array<ELEM>>} arr\n * @return {Array<ELEM>}\n */\nexport const flatten = arr => fold(arr, /** @type {Array<ELEM>} */ ([]), (acc, val) => acc.concat(val))\n\n/**\n * @template T\n * @param {number} len\n * @param {function(number, Array<T>):T} f\n * @return {Array<T>}\n */\nexport const unfold = (len, f) => {\n  const array = new Array(len)\n  for (let i = 0; i < len; i++) {\n    array[i] = f(i, array)\n  }\n  return array\n}\n\n/**\n * @template T\n * @template RESULT\n * @param {Array<T>} arr\n * @param {RESULT} seed\n * @param {function(RESULT, T, number):RESULT} folder\n */\nexport const fold = (arr, seed, folder) => arr.reduce(folder, seed)\n\nexport const isArray = Array.isArray\n\n/**\n * @template T\n * @param {Array<T>} arr\n * @return {Array<T>}\n */\nexport const unique = arr => from(set.from(arr))\n\n/**\n * @template T\n * @template M\n * @param {ArrayLike<T>} arr\n * @param {function(T):M} mapper\n * @return {Array<T>}\n */\nexport const uniqueBy = (arr, mapper) => {\n  /**\n   * @type {Set<M>}\n   */\n  const happened = set.create()\n  /**\n   * @type {Array<T>}\n   */\n  const result = []\n  for (let i = 0; i < arr.length; i++) {\n    const el = arr[i]\n    const mapped = mapper(el)\n    if (!happened.has(mapped)) {\n      happened.add(mapped)\n      result.push(el)\n    }\n  }\n  return result\n}\n\n/**\n * @template {ArrayLike<any>} ARR\n * @template {function(ARR extends ArrayLike<infer T> ? T : never, number, ARR):any} MAPPER\n * @param {ARR} arr\n * @param {MAPPER} mapper\n * @return {Array<MAPPER extends function(...any): infer M ? M : never>}\n */\nexport const map = (arr, mapper) => {\n  /**\n   * @type {Array<any>}\n   */\n  const res = Array(arr.length)\n  for (let i = 0; i < arr.length; i++) {\n    res[i] = mapper(/** @type {any} */ (arr[i]), i, /** @type {any} */ (arr))\n  }\n  return /** @type {any} */ (res)\n}\n", "/**\n * Observable class prototype.\n *\n * @module observable\n */\n\nimport * as map from './map.js'\nimport * as set from './set.js'\nimport * as array from './array.js'\n\n/**\n * Handles named events.\n * @experimental\n *\n * This is basically a (better typed) duplicate of Observable, which will replace Observable in the\n * next release.\n *\n * @template {{[key in keyof EVENTS]: function(...any):void}} EVENTS\n */\nexport class ObservableV2 {\n  constructor () {\n    /**\n     * Some desc.\n     * @type {Map<string, Set<any>>}\n     */\n    this._observers = map.create()\n  }\n\n  /**\n   * @template {keyof EVENTS & string} NAME\n   * @param {NAME} name\n   * @param {EVENTS[NAME]} f\n   */\n  on (name, f) {\n    map.setIfUndefined(this._observers, /** @type {string} */ (name), set.create).add(f)\n    return f\n  }\n\n  /**\n   * @template {keyof EVENTS & string} NAME\n   * @param {NAME} name\n   * @param {EVENTS[NAME]} f\n   */\n  once (name, f) {\n    /**\n     * @param  {...any} args\n     */\n    const _f = (...args) => {\n      this.off(name, /** @type {any} */ (_f))\n      f(...args)\n    }\n    this.on(name, /** @type {any} */ (_f))\n  }\n\n  /**\n   * @template {keyof EVENTS & string} NAME\n   * @param {NAME} name\n   * @param {EVENTS[NAME]} f\n   */\n  off (name, f) {\n    const observers = this._observers.get(name)\n    if (observers !== undefined) {\n      observers.delete(f)\n      if (observers.size === 0) {\n        this._observers.delete(name)\n      }\n    }\n  }\n\n  /**\n   * Emit a named event. All registered event listeners that listen to the\n   * specified name will receive the event.\n   *\n   * @todo This should catch exceptions\n   *\n   * @template {keyof EVENTS & string} NAME\n   * @param {NAME} name The event name.\n   * @param {Parameters<EVENTS[NAME]>} args The arguments that are applied to the event listener.\n   */\n  emit (name, args) {\n    // copy all listeners to an array first to make sure that no event is emitted to listeners that are subscribed while the event handler is called.\n    return array.from((this._observers.get(name) || map.create()).values()).forEach(f => f(...args))\n  }\n\n  destroy () {\n    this._observers = map.create()\n  }\n}\n\n/* c8 ignore start */\n/**\n * Handles named events.\n *\n * @deprecated\n * @template N\n */\nexport class Observable {\n  constructor () {\n    /**\n     * Some desc.\n     * @type {Map<N, any>}\n     */\n    this._observers = map.create()\n  }\n\n  /**\n   * @param {N} name\n   * @param {function} f\n   */\n  on (name, f) {\n    map.setIfUndefined(this._observers, name, set.create).add(f)\n  }\n\n  /**\n   * @param {N} name\n   * @param {function} f\n   */\n  once (name, f) {\n    /**\n     * @param  {...any} args\n     */\n    const _f = (...args) => {\n      this.off(name, _f)\n      f(...args)\n    }\n    this.on(name, _f)\n  }\n\n  /**\n   * @param {N} name\n   * @param {function} f\n   */\n  off (name, f) {\n    const observers = this._observers.get(name)\n    if (observers !== undefined) {\n      observers.delete(f)\n      if (observers.size === 0) {\n        this._observers.delete(name)\n      }\n    }\n  }\n\n  /**\n   * Emit a named event. All registered event listeners that listen to the\n   * specified name will receive the event.\n   *\n   * @todo This should catch exceptions\n   *\n   * @param {N} name The event name.\n   * @param {Array<any>} args The arguments that are applied to the event listener.\n   */\n  emit (name, args) {\n    // copy all listeners to an array first to make sure that no event is emitted to listeners that are subscribed while the event handler is called.\n    return array.from((this._observers.get(name) || map.create()).values()).forEach(f => f(...args))\n  }\n\n  destroy () {\n    this._observers = map.create()\n  }\n}\n/* c8 ignore end */\n", "// TODO: apparently Yjs is full of anys or something, see if we can fix this\n/* eslint-disable @typescript-eslint/no-unsafe-call */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\nimport type { BaseUserMeta, JsonObject, User } from \"@liveblocks/client\";\nimport type { OpaqueRoom } from \"@liveblocks/core\";\nimport { Observable } from \"lib0/observable\";\nimport type * as Y from \"yjs\";\n\nconst Y_PRESENCE_KEY = \"__yjs\";\nconst Y_PRESENCE_ID_KEY = \"__yjs_clientid\";\n\ntype MetaClientState = {\n  clock: number;\n  lastUpdated: number;\n};\n\n/**\n * This class will store Yjs awareness in Liveblock's presence under the __yjs key\n * IMPORTANT: The Yjs awareness protocol uses ydoc.clientId to reference users\n * to their respective documents. To avoid mapping Yjs clientIds to liveblock's connectionId,\n * we simply set the clientId of the doc to the connectionId. Then no further mapping is required\n */\nexport class Awareness extends Observable<unknown> {\n  private room: OpaqueRoom;\n  public doc: Y.Doc;\n  public states: Map<number, unknown> = new Map();\n  // used to map liveblock's ActorId to Yjs ClientID, both unique numbers representing a client\n  public actorToClientMap: Map<number, number> = new Map();\n  // Meta is used to keep track and timeout users who disconnect. Liveblocks provides this for us, so we don't need to\n  // manage it here. Unfortunately, it's expected to exist by various integrations, so it's an empty map.\n  public meta: Map<number, MetaClientState> = new Map();\n  // _checkInterval this would hold a timer to remove users, but Liveblock's presence already handles this\n  // unfortunately it's typed by various integrations\n  public _checkInterval: number = 0;\n\n  private othersUnsub: () => void;\n  constructor(doc: Y.Doc, room: OpaqueRoom) {\n    super();\n    this.doc = doc;\n    this.room = room;\n    // Add the clientId to presence so we can map it to connectionId later\n    this.room.updatePresence({\n      [Y_PRESENCE_ID_KEY]: this.doc.clientID,\n    });\n    this.othersUnsub = this.room.events.others.subscribe((event) => {\n      let updates:\n        | { added: number[]; updated: number[]; removed: number[] }\n        | undefined;\n\n      // When others are changed, we emit an event that contains arrays added/updated/removed.\n      if (event.type === \"leave\") {\n        const targetClientId = this.actorToClientMap.get(\n          event.user.connectionId\n        );\n        if (targetClientId !== undefined) {\n          updates = { added: [], updated: [], removed: [targetClientId] };\n        }\n        // rebuild after the user leaves so we can get the ID of the user who left\n        this.rebuildActorToClientMap(event.others);\n      }\n      if (event.type === \"enter\" || event.type === \"update\") {\n        this.rebuildActorToClientMap(event.others);\n        const targetClientId = this.actorToClientMap.get(\n          event.user.connectionId\n        );\n        if (targetClientId !== undefined) {\n          updates = {\n            added: event.type === \"enter\" ? [targetClientId] : [],\n            updated: event.type === \"update\" ? [targetClientId] : [],\n            removed: [],\n          };\n        }\n      }\n      if (event.type === \"reset\") {\n        this.rebuildActorToClientMap(event.others);\n      }\n      if (updates !== undefined) {\n        this.emit(\"change\", [updates, \"presence\"]);\n        this.emit(\"update\", [updates, \"presence\"]);\n      }\n    });\n  }\n\n  rebuildActorToClientMap(\n    others: readonly User<JsonObject, BaseUserMeta>[]\n  ): void {\n    this.actorToClientMap.clear();\n    others.forEach((user) => {\n      if (user.presence[Y_PRESENCE_ID_KEY] !== undefined) {\n        this.actorToClientMap.set(\n          user.connectionId,\n          user.presence[Y_PRESENCE_ID_KEY] as number\n        );\n      }\n    });\n  }\n\n  destroy(): void {\n    this.emit(\"destroy\", [this]);\n    this.othersUnsub();\n    this.setLocalState(null);\n    super.destroy();\n  }\n\n  getLocalState(): JsonObject | null {\n    const presence = this.room.getPresence();\n    if (\n      Object.keys(presence).length === 0 ||\n      typeof presence[Y_PRESENCE_KEY] === \"undefined\"\n    ) {\n      return null;\n    }\n    return presence[Y_PRESENCE_KEY] as JsonObject | null;\n  }\n\n  setLocalState(state: Partial<JsonObject> | null): void {\n    const presence = this.room.getSelf()?.presence;\n    if (state === null) {\n      if (presence === undefined) {\n        // if presence is already undefined, we don't need to change anything here\n        return;\n      }\n      this.room.updatePresence({ ...presence, [Y_PRESENCE_KEY]: null });\n      this.emit(\"update\", [\n        { added: [], updated: [], removed: [this.doc.clientID] },\n        \"local\",\n      ]);\n      return;\n    }\n    // if presence was undefined, it's added, if not, it's updated\n    const yPresence = presence?.[Y_PRESENCE_KEY];\n    const added = yPresence === undefined ? [this.doc.clientID] : [];\n    const updated = yPresence === undefined ? [] : [this.doc.clientID];\n    this.room.updatePresence({\n      [Y_PRESENCE_KEY]: {\n        ...((yPresence as JsonObject) || {}),\n        ...(state || {}),\n      },\n    });\n    this.emit(\"update\", [{ added, updated, removed: [] }, \"local\"]);\n  }\n\n  setLocalStateField(field: string, value: JsonObject | null): void {\n    const presence = this.room.getSelf()?.presence[Y_PRESENCE_KEY];\n    const update = { [field]: value } as Partial<JsonObject>;\n    this.room.updatePresence({\n      [Y_PRESENCE_KEY]: { ...((presence as JsonObject) || {}), ...update },\n    });\n  }\n\n  // Translate liveblocks presence to yjs awareness\n  getStates(): Map<number, unknown> {\n    const others = this.room.getOthers();\n    const states = others.reduce((acc: Map<number, unknown>, otherUser) => {\n      const otherPresence = otherUser.presence[Y_PRESENCE_KEY];\n      const otherClientId = otherUser.presence[Y_PRESENCE_ID_KEY] as\n        | number\n        | undefined;\n      if (otherPresence !== undefined && otherClientId !== undefined) {\n        // set states of map clientId to yjs presence\n        acc.set(otherClientId, otherPresence || {});\n      }\n      return acc;\n    }, new Map<number, unknown>());\n\n    // add this client's yjs presence to states (local client not represented in others)\n    const localPresence = this.room.getSelf()?.presence[Y_PRESENCE_KEY];\n    if (localPresence !== undefined) {\n      states.set(this.doc.clientID, localPresence);\n    }\n    return states;\n  }\n}\n", "import {\n  DerivedSignal,\n  Signal as Signal,\n  type YjsSyncStatus,\n} from \"@liveblocks/core\";\nimport { sha256 } from \"@noble/hashes/sha2\";\nimport { Base64 } from \"js-base64\";\nimport { Observable } from \"lib0/observable\";\nimport { IndexeddbPersistence } from \"y-indexeddb\";\nimport * as Y from \"yjs\";\n\nexport default class yDocHandler extends Observable<unknown> {\n  private unsubscribers: Array<() => void> = [];\n\n  private _synced = false;\n  private doc: Y.Doc;\n  private updateRoomDoc: (update: Uint8Array) => void;\n  private fetchRoomDoc: (vector: string) => void;\n  private useV2Encoding: boolean;\n  private localSnapshotHash: Signal<string>;\n  private remoteSnapshotHash: Signal<string | null>;\n\n  private debounceTimer: ReturnType<typeof setTimeout> | null = null;\n  private static readonly DEBOUNCE_INTERVAL_MS = 200;\n\n  private isLocalAndRemoteSnapshotEqual: DerivedSignal<boolean>;\n\n  constructor({\n    doc,\n    isRoot,\n    updateDoc,\n    fetchDoc,\n    useV2Encoding,\n  }: {\n    doc: Y.Doc;\n    isRoot: boolean;\n    updateDoc: (update: Uint8Array, guid?: string) => void;\n    fetchDoc: (vector: string, guid?: string) => void;\n    useV2Encoding: boolean;\n  }) {\n    super();\n    this.doc = doc;\n    this.useV2Encoding = useV2Encoding;\n    // this.doc.load(); // this just emits a load event, it doesn't actually load anything\n    this.doc.on(useV2Encoding ? \"updateV2\" : \"update\", this.updateHandler);\n    this.updateRoomDoc = (update: Uint8Array) => {\n      updateDoc(update, isRoot ? undefined : this.doc.guid);\n    };\n    this.fetchRoomDoc = (vector: string) => {\n      fetchDoc(vector, isRoot ? undefined : this.doc.guid);\n    };\n\n    this.syncDoc();\n\n    const encodedSnapshot = this.useV2Encoding\n      ? Y.encodeSnapshotV2(Y.snapshot(this.doc))\n      : Y.encodeSnapshot(Y.snapshot(this.doc));\n\n    this.localSnapshotHash = new Signal(\n      Base64.fromUint8Array(sha256(encodedSnapshot))\n    );\n    this.remoteSnapshotHash = new Signal<string | null>(null);\n\n    this.isLocalAndRemoteSnapshotEqual = DerivedSignal.from(() => {\n      const remoteSnapshotHash = this.remoteSnapshotHash.get();\n      if (remoteSnapshotHash === null) return false;\n\n      const localSnapshotHash = this.localSnapshotHash.get();\n      if (localSnapshotHash !== remoteSnapshotHash) {\n        return false;\n      }\n      return true;\n    });\n  }\n\n  public handleServerUpdate = ({\n    update,\n    stateVector,\n    readOnly,\n    v2,\n    remoteSnapshotHash,\n  }: {\n    update: Uint8Array;\n    stateVector: string | null;\n    readOnly: boolean;\n    v2?: boolean;\n    remoteSnapshotHash: string;\n  }): void => {\n    // apply update from the server, updates from the server can be v1 or v2\n    const applyUpdate = v2 ? Y.applyUpdateV2 : Y.applyUpdate;\n    applyUpdate(this.doc, update, \"backend\");\n    // if this update is the result of a fetch, the state vector is included\n    if (stateVector) {\n      if (!readOnly) {\n        // Use server state to calculate a diff and send it\n        try {\n          // send v1 or v2update according to client option\n          const encodeUpdate = this.useV2Encoding\n            ? Y.encodeStateAsUpdateV2\n            : Y.encodeStateAsUpdate;\n          const localUpdate = encodeUpdate(\n            this.doc,\n            Base64.toUint8Array(stateVector)\n          );\n          this.updateRoomDoc(localUpdate);\n        } catch (e) {\n          // something went wrong encoding local state to send to the server\n          console.warn(e);\n        }\n      }\n      // now that we've sent our local and received from server, we're in sync\n      // calling `syncDoc` again will sync up the documents\n      this.synced = true;\n    }\n\n    this.remoteSnapshotHash.set(remoteSnapshotHash);\n  };\n\n  public syncDoc = (): void => {\n    this.synced = false;\n\n    // The state vector is sent to the server so it knows what to send back\n    // if you don't send it, it returns everything\n    const encodedVector = Base64.fromUint8Array(Y.encodeStateVector(this.doc));\n    this.fetchRoomDoc(encodedVector);\n  };\n\n  // The sync'd property is required by some provider implementations\n  get synced(): boolean {\n    return this._synced;\n  }\n\n  set synced(state: boolean) {\n    if (this._synced !== state) {\n      this._synced = state;\n      this.emit(\"synced\", [state]);\n      this.emit(\"sync\", [state]);\n    }\n  }\n\n  private debounced_updateLocalSnapshot() {\n    if (this.debounceTimer) clearTimeout(this.debounceTimer);\n    this.debounceTimer = setTimeout(() => {\n      // Compute local snapshot and update the local snapshot state\n      const encodedSnapshot = this.useV2Encoding\n        ? Y.encodeSnapshotV2(Y.snapshot(this.doc))\n        : Y.encodeSnapshot(Y.snapshot(this.doc));\n      this.localSnapshotHash.set(\n        Base64.fromUint8Array(sha256(encodedSnapshot))\n      );\n      this.debounceTimer = null;\n    }, yDocHandler.DEBOUNCE_INTERVAL_MS);\n  }\n\n  private updateHandler = (\n    update: Uint8Array,\n    origin: string | IndexeddbPersistence\n  ) => {\n    this.debounced_updateLocalSnapshot();\n\n    // don't send updates from indexedb, those will get handled by sync\n    const isFromLocal = origin instanceof IndexeddbPersistence;\n    if (origin !== \"backend\" && !isFromLocal) {\n      this.updateRoomDoc(update);\n    }\n  };\n\n  experimental_getSyncStatus(): YjsSyncStatus {\n    const remoteSnapshotHash = this.remoteSnapshotHash.get();\n    if (remoteSnapshotHash === null) {\n      return \"loading\";\n    }\n    if (!this.isLocalAndRemoteSnapshotEqual.get()) {\n      return \"synchronizing\";\n    }\n    return \"synchronized\";\n  }\n\n  destroy(): void {\n    if (this.debounceTimer) clearTimeout(this.debounceTimer);\n    this.doc.off(\"update\", this.updateHandler);\n    this.unsubscribers.forEach((unsub) => unsub());\n    this._observers = new Map();\n    this.doc.destroy();\n  }\n}\n", "import type { OpaqueRoom } from \"@liveblocks/core\";\nimport { Doc } from \"yjs\";\n\nimport { LiveblocksYjsProvider, type ProviderOptions } from \"./provider\";\n\n/* NOTE:\n      the purpose of the providersMap is to keep the same provider alive across renders\n      re-instantiating the provider when the room hasn't changed can cause the yjs doc state to be out of sync\n      with liveblocks yjs state. In this instance, we can just check if the room has changed, because the instance\n      from useRoom will be referentially equal to the previous instance.\n*/\nconst providersMap = new WeakMap<OpaqueRoom, LiveblocksYjsProvider>();\n\n/**\n * Get a LiveblocksYjsProvider for a room.\n * @param room - The room to get the provider for.\n * @param options - The options for the provider.\n * @returns A LiveblocksYjsProvider for the room.\n */\nconst getYjsProviderForRoom = (\n  room: OpaqueRoom,\n  options: ProviderOptions = {}\n): LiveblocksYjsProvider => {\n  const provider = providersMap.get(room);\n  if (provider !== undefined) {\n    return provider;\n  }\n  const doc = new Doc();\n  const newProvider = new LiveblocksYjsProvider(room, doc, options);\n\n  room.events.roomWillDestroy.subscribeOnce(() => {\n    newProvider.destroy();\n  });\n  providersMap.set(room, newProvider);\n  return newProvider;\n};\n\nexport { getYjsProviderForRoom };\n", "import { Extension } from '@tiptap/core'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport { EditorView } from '@tiptap/pm/view'\nimport {\n  redo,\n  undo,\n  ySyncPlugin,\n  yUndoPlugin,\n  yUndoPluginKey,\n  yXmlFragmentToProsemirrorJSON,\n} from 'y-prosemirror'\nimport { Doc, UndoManager, XmlFragment } from 'yjs'\n\ntype YSyncOpts = Parameters<typeof ySyncPlugin>[1];\ntype YUndoOpts = Parameters<typeof yUndoPlugin>[0];\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    collaboration: {\n      /**\n       * Undo recent changes\n       * @example editor.commands.undo()\n       */\n      undo: () => ReturnType;\n      /**\n       * Reapply reverted changes\n       * @example editor.commands.redo()\n       */\n      redo: () => ReturnType;\n    };\n  }\n}\n\nexport interface CollaborationStorage {\n  /**\n   * Whether collaboration is currently disabled.\n   * Disabling collaboration will prevent any changes from being synced with other users.\n   */\n  isDisabled: boolean;\n}\n\nexport interface CollaborationOptions {\n  /**\n   * An initialized Y.js document.\n   * @example new Y.Doc()\n   */\n  document?: Doc | null;\n\n  /**\n   * Name of a Y.js fragment, can be changed to sync multiple fields with one Y.js document.\n   * @default 'default'\n   * @example 'my-custom-field'\n   */\n  field?: string;\n\n  /**\n   * A raw Y.js fragment, can be used instead of `document` and `field`.\n   * @example new Y.Doc().getXmlFragment('body')\n   */\n  fragment?: XmlFragment | null;\n\n  /**\n   * Fired when the content from Yjs is initially rendered to Tiptap.\n   */\n  onFirstRender?: () => void;\n\n  /**\n   * Options for the Yjs sync plugin.\n   */\n  ySyncOptions?: YSyncOpts;\n\n  /**\n   * Options for the Yjs undo plugin.\n   */\n  yUndoOptions?: YUndoOpts;\n}\n\n/**\n * This extension allows you to collaborate with others in real-time.\n * @see https://tiptap.dev/api/extensions/collaboration\n */\nexport const Collaboration = Extension.create<CollaborationOptions, CollaborationStorage>({\n  name: 'collaboration',\n\n  priority: 1000,\n\n  addOptions() {\n    return {\n      document: null,\n      field: 'default',\n      fragment: null,\n    }\n  },\n\n  addStorage() {\n    return {\n      isDisabled: false,\n    }\n  },\n\n  onCreate() {\n    if (this.editor.extensionManager.extensions.find(extension => extension.name === 'history')) {\n      console.warn(\n        '[tiptap warn]: \"@tiptap/extension-collaboration\" comes with its own history support and is not compatible with \"@tiptap/extension-history\".',\n      )\n    }\n  },\n\n  addCommands() {\n    return {\n      undo:\n        () => ({ tr, state, dispatch }) => {\n          tr.setMeta('preventDispatch', true)\n\n          const undoManager: UndoManager = yUndoPluginKey.getState(state).undoManager\n\n          if (undoManager.undoStack.length === 0) {\n            return false\n          }\n\n          if (!dispatch) {\n            return true\n          }\n\n          return undo(state)\n        },\n      redo:\n        () => ({ tr, state, dispatch }) => {\n          tr.setMeta('preventDispatch', true)\n\n          const undoManager: UndoManager = yUndoPluginKey.getState(state).undoManager\n\n          if (undoManager.redoStack.length === 0) {\n            return false\n          }\n\n          if (!dispatch) {\n            return true\n          }\n\n          return redo(state)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-z': () => this.editor.commands.undo(),\n      'Mod-y': () => this.editor.commands.redo(),\n      'Shift-Mod-z': () => this.editor.commands.redo(),\n    }\n  },\n\n  addProseMirrorPlugins() {\n    const fragment = this.options.fragment\n      ? this.options.fragment\n      : (this.options.document as Doc).getXmlFragment(this.options.field)\n\n    // Quick fix until there is an official implementation (thanks to @hamflx).\n    // See https://github.com/yjs/y-prosemirror/issues/114 and https://github.com/yjs/y-prosemirror/issues/102\n    const yUndoPluginInstance = yUndoPlugin(this.options.yUndoOptions)\n    const originalUndoPluginView = yUndoPluginInstance.spec.view\n\n    yUndoPluginInstance.spec.view = (view: EditorView) => {\n      const { undoManager } = yUndoPluginKey.getState(view.state)\n\n      if (undoManager.restore) {\n        undoManager.restore()\n        undoManager.restore = () => {\n          // noop\n        }\n      }\n\n      const viewRet = originalUndoPluginView ? originalUndoPluginView(view) : undefined\n\n      return {\n        destroy: () => {\n          const hasUndoManSelf = undoManager.trackedOrigins.has(undoManager)\n          // eslint-disable-next-line no-underscore-dangle\n          const observers = undoManager._observers\n\n          undoManager.restore = () => {\n            if (hasUndoManSelf) {\n              undoManager.trackedOrigins.add(undoManager)\n            }\n\n            undoManager.doc.on('afterTransaction', undoManager.afterTransactionHandler)\n            // eslint-disable-next-line no-underscore-dangle\n            undoManager._observers = observers\n          }\n\n          if (viewRet?.destroy) {\n            viewRet.destroy()\n          }\n        },\n      }\n    }\n\n    const ySyncPluginOptions: YSyncOpts = {\n      ...this.options.ySyncOptions,\n      onFirstRender: this.options.onFirstRender,\n    }\n\n    const ySyncPluginInstance = ySyncPlugin(fragment, ySyncPluginOptions)\n\n    if (this.editor.options.enableContentCheck) {\n      fragment.doc?.on('beforeTransaction', () => {\n        try {\n          const jsonContent = (yXmlFragmentToProsemirrorJSON(fragment))\n\n          if (jsonContent.content.length === 0) {\n            return\n          }\n\n          this.editor.schema.nodeFromJSON(jsonContent).check()\n        } catch (error) {\n          this.editor.emit('contentError', {\n            error: error as Error,\n            editor: this.editor,\n            disableCollaboration: () => {\n              fragment.doc?.destroy()\n              this.storage.isDisabled = true\n            },\n          })\n          // If the content is invalid, return false to prevent the transaction from being applied\n          return false\n        }\n      })\n    }\n\n    return [\n      ySyncPluginInstance,\n      yUndoPluginInstance,\n      // Only add the filterInvalidContent plugin if content checking is enabled\n      this.editor.options.enableContentCheck\n        && new Plugin({\n          key: new PluginKey('filterInvalidContent'),\n          filterTransaction: () => {\n            // When collaboration is disabled, prevent any sync transactions from being applied\n            if (this.storage.isDisabled) {\n              // Destroy the Yjs document to prevent any further sync transactions\n              fragment.doc?.destroy()\n\n              return true\n            }\n\n            return true\n          },\n        }),\n    ].filter(Boolean)\n  },\n})\n", "import { Transaction } from '@tiptap/pm/state'\nimport { ySyncPluginKey } from 'y-prosemirror'\n\n/**\n * Checks if a transaction was originated from a Yjs change.\n * @param {Transaction} transaction - The transaction to check.\n * @returns {boolean} - True if the transaction was originated from a Yjs change, false otherwise.\n * @example\n * const transaction = new Transaction(doc)\n * const isOrigin = isChangeOrigin(transaction) // returns false\n */\nexport function isChangeOrigin(transaction: Transaction): boolean {\n  return !!transaction.getMeta(ySyncPluginKey)\n}\n", "import { Extension, Mark, mergeAttributes } from \"@tiptap/core\";\nimport type { Node } from \"@tiptap/pm/model\";\nimport type { Transaction } from \"@tiptap/pm/state\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { Decoration, DecorationSet } from \"@tiptap/pm/view\";\nimport { ySyncPluginKey } from \"y-prosemirror\";\n\nimport type { CommentsExtensionStorage, ThreadPluginState } from \"../types\";\nimport {\n  LIVEBLOCKS_COMMENT_MARK_TYPE,\n  ThreadPluginActions,\n  THREADS_ACTIVE_SELECTION_PLUGIN,\n  THREADS_PLUGIN_KEY,\n} from \"../types\";\n\ntype ThreadPluginAction = {\n  name: ThreadPluginActions;\n  data: string | null;\n};\n\nexport const FILTERED_THREADS_PLUGIN_KEY = new PluginKey<{\n  filteredThreads?: Set<string>;\n}>();\n\n/**\n * Known issues: Overlapping marks are merged when reloading the doc. May be related:\n * https://github.com/ueberdosis/tiptap/issues/4339\n * https://github.com/yjs/y-prosemirror/issues/47\n */\nconst Comment = Mark.create({\n  name: LIVEBLOCKS_COMMENT_MARK_TYPE,\n  excludes: \"\",\n  inclusive: false,\n  keepOnSplit: true,\n  parseHTML: () => {\n    return [\n      {\n        tag: \"span\",\n        getAttrs: (node) =>\n          node.getAttribute(\"data-lb-thread-id\") !== null && null,\n      },\n    ];\n  },\n  addAttributes() {\n    // Return an object with attribute configuration\n    return {\n      orphan: {\n        parseHTML: (element) => !!element.getAttribute(\"data-orphan\"),\n        renderHTML: (attributes) => {\n          return (attributes as { orphan: boolean }).orphan\n            ? {\n                \"data-orphan\": \"true\",\n              }\n            : {};\n        },\n        default: false,\n      },\n      threadId: {\n        parseHTML: (element) => element.getAttribute(\"data-lb-thread-id\"),\n        renderHTML: (attributes) => {\n          return {\n            \"data-lb-thread-id\": (attributes as { threadId: string }).threadId,\n          };\n        },\n        default: \"\",\n      },\n    };\n  },\n\n  renderHTML({ HTMLAttributes }: { HTMLAttributes: Record<string, any> }) {\n    const filteredThreads = this.editor\n      ? FILTERED_THREADS_PLUGIN_KEY.getState(this.editor.state)?.filteredThreads\n      : undefined;\n    const threadId = (HTMLAttributes as { [\"data-lb-thread-id\"]: string })[\n      \"data-lb-thread-id\"\n    ];\n    if (filteredThreads && !filteredThreads.has(threadId)) {\n      return [\n        \"span\",\n        mergeAttributes(HTMLAttributes, {\n          class: \"lb-root lb-tiptap-thread-mark\",\n          \"data-hidden\": \"\",\n        }),\n      ];\n    }\n\n    return [\n      \"span\",\n      mergeAttributes(HTMLAttributes, {\n        class: \"lb-root lb-tiptap-thread-mark\",\n      }),\n    ];\n  },\n\n  /**\n   * This plugin tracks the (first) position of each thread mark in the doc and creates a decoration for the selected thread\n   */\n  addProseMirrorPlugins() {\n    const updateState = (doc: Node, selectedThreadId: string | null) => {\n      const threadPositions = new Map<string, { from: number; to: number }>();\n      const decorations: Decoration[] = [];\n      // find all thread marks and store their position + create decoration for selected thread\n      doc.descendants((node, pos) => {\n        node.marks.forEach((mark) => {\n          if (mark.type === this.type) {\n            const thisThreadId = (\n              mark.attrs as { threadId: string | undefined }\n            ).threadId;\n            if (!thisThreadId) {\n              return;\n            }\n            const from = pos;\n            const to = from + node.nodeSize;\n\n            // FloatingThreads component uses \"to\" as the position, so always store the largest \"to\" found\n            // AnchoredThreads component uses \"from\" as the position, so always store the smallest \"from\" found\n            const currentPosition = threadPositions.get(thisThreadId) ?? {\n              from: Infinity,\n              to: 0,\n            };\n            threadPositions.set(thisThreadId, {\n              from: Math.min(from, currentPosition.from),\n              to: Math.max(to, currentPosition.to),\n            });\n\n            if (selectedThreadId === thisThreadId) {\n              decorations.push(\n                Decoration.inline(from, to, {\n                  class: \"lb-root lb-tiptap-thread-mark-selected\",\n                })\n              );\n\n              const decoration = this.editor.view.dom.querySelector(\n                `.lb-tiptap-thread-mark[data-lb-thread-id=\"${thisThreadId}\"]`\n              );\n\n              if (decoration) {\n                decoration.scrollIntoView({\n                  behavior: \"smooth\",\n                  block: \"nearest\",\n                });\n              }\n            }\n          }\n        });\n      });\n      return {\n        decorations: DecorationSet.create(doc, decorations),\n        selectedThreadId,\n        threadPositions,\n        selectedThreadPos:\n          selectedThreadId !== null\n            ? (threadPositions.get(selectedThreadId)?.to ?? null)\n            : null,\n      };\n    };\n\n    return [\n      new Plugin({\n        key: THREADS_PLUGIN_KEY,\n        state: {\n          init() {\n            return {\n              threadPositions: new Map<string, { from: number; to: number }>(),\n              selectedThreadId: null,\n              selectedThreadPos: null,\n              decorations: DecorationSet.empty,\n            } as ThreadPluginState;\n          },\n          apply(tr, state) {\n            const action = tr.getMeta(THREADS_PLUGIN_KEY) as ThreadPluginAction;\n            if (!tr.docChanged && !action) {\n              return state;\n            }\n\n            if (!action) {\n              // Doc changed, but no action, just update rects\n              return updateState(tr.doc, state.selectedThreadId);\n            }\n            // handle actions, possibly support more actions\n            if (\n              action.name === ThreadPluginActions.SET_SELECTED_THREAD_ID &&\n              state.selectedThreadId !== action.data\n            ) {\n              return updateState(tr.doc, action.data);\n            }\n\n            return state;\n          },\n        },\n        props: {\n          decorations: (state) => {\n            return (\n              THREADS_PLUGIN_KEY.getState(state)?.decorations ??\n              DecorationSet.empty\n            );\n          },\n          handleClick: (view, pos, event) => {\n            if (event.button !== 0) {\n              return;\n            }\n\n            const selectThread = (threadId: string | null) => {\n              view.dispatch(\n                view.state.tr.setMeta(THREADS_PLUGIN_KEY, {\n                  name: ThreadPluginActions.SET_SELECTED_THREAD_ID,\n                  data: threadId,\n                })\n              );\n            };\n\n            const node = view.state.doc.nodeAt(pos);\n            if (!node) {\n              selectThread(null);\n              return;\n            }\n            const commentMark = node.marks.find(\n              (mark) => mark.type === this.type && !mark.attrs.orphan\n            );\n            // nothing to select\n            if (!commentMark) {\n              selectThread(null);\n              return;\n            }\n            const threadId = commentMark?.attrs.threadId as string | undefined;\n\n            const filtered = FILTERED_THREADS_PLUGIN_KEY.getState(\n              view.state\n            )?.filteredThreads;\n            if (threadId && filtered && !filtered.has(threadId)) {\n              selectThread(null);\n              return;\n            }\n\n            selectThread(threadId ?? null);\n          },\n        },\n      }),\n    ];\n  },\n});\n\nexport const CommentsExtension = Extension.create<\n  { filteredThreads?: Set<string> },\n  CommentsExtensionStorage\n>({\n  name: \"liveblocksComments\",\n  priority: 95,\n  addExtensions() {\n    return [Comment];\n  },\n\n  addStorage() {\n    return {\n      pendingComment: false,\n    };\n  },\n\n  addCommands() {\n    return {\n      addPendingComment: () => () => {\n        if (this.editor.state.selection.empty) {\n          return false;\n        }\n        // unselect any open threads\n        this.editor.view.dispatch(\n          this.editor.state.tr.setMeta(THREADS_PLUGIN_KEY, {\n            name: ThreadPluginActions.SET_SELECTED_THREAD_ID,\n            data: null,\n          })\n        );\n        this.storage.pendingComment = true;\n        return true;\n      },\n      closePendingComment: () => () => {\n        this.storage.pendingComment = false;\n        return true;\n      },\n      selectThread: (id: string | null) => () => {\n        const filtered = FILTERED_THREADS_PLUGIN_KEY.getState(\n          this.editor.state\n        )?.filteredThreads;\n        if (id && filtered && !filtered.has(id)) {\n          this.editor.view.dispatch(\n            this.editor.state.tr.setMeta(THREADS_PLUGIN_KEY, {\n              name: ThreadPluginActions.SET_SELECTED_THREAD_ID,\n              data: null,\n            })\n          );\n          return true;\n        }\n\n        this.editor.view.dispatch(\n          this.editor.state.tr.setMeta(THREADS_PLUGIN_KEY, {\n            name: ThreadPluginActions.SET_SELECTED_THREAD_ID,\n            data: id,\n          })\n        );\n        return true;\n      },\n      addComment:\n        (id: string) =>\n        ({ commands }) => {\n          if (\n            !this.storage.pendingComment ||\n            this.editor.state.selection.empty\n          ) {\n            return false;\n          }\n          commands.setMark(LIVEBLOCKS_COMMENT_MARK_TYPE, { threadId: id });\n          this.storage.pendingComment = false;\n          return true;\n        },\n    };\n  },\n\n  // @ts-expect-error - this is incorrectly typed upstream in Mark.ts of TipTap. This event does include transaction\n  // correct: https://github.com/ueberdosis/tiptap/blob/2ff327ced84df6865b4ef98947b667aa79992292/packages/core/src/types.ts#L60\n  // incorrect: https://github.com/ueberdosis/tiptap/blob/2ff327ced84df6865b4ef98947b667aa79992292/packages/core/src/Mark.ts#L330\n  onSelectionUpdate(\n    this: { storage: CommentsExtensionStorage }, // NOTE: there are more types here I didn't override, this gets removed after submitting PR to tiptap\n    { transaction }: { transaction: Transaction } // TODO: remove this after submitting PR to tiptap\n  ) {\n    // ignore changes made by yjs\n    if (!this.storage.pendingComment || transaction.getMeta(ySyncPluginKey)) {\n      return;\n    }\n    // if selection changes, hide the composer. We could keep the composer open and move it to the new selection?\n    this.storage.pendingComment = false;\n  },\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: THREADS_ACTIVE_SELECTION_PLUGIN,\n        props: {\n          decorations: ({ doc, selection }) => {\n            if (!this.storage.pendingComment) {\n              return DecorationSet.create(doc, []);\n            }\n            const { from, to } = selection;\n            const decorations: Decoration[] = [\n              Decoration.inline(from, to, {\n                class: \"lb-root lb-selection lb-tiptap-active-selection\",\n              }),\n            ];\n            return DecorationSet.create(doc, decorations);\n          },\n        },\n      }),\n      new Plugin({\n        key: FILTERED_THREADS_PLUGIN_KEY,\n        state: {\n          init: () => ({\n            filteredThreads: this.options.filteredThreads,\n          }),\n          apply(tr, value) {\n            const meta = tr.getMeta(FILTERED_THREADS_PLUGIN_KEY) as\n              | { filteredThreads?: Set<string> }\n              | undefined;\n            if (meta?.filteredThreads) {\n              return { filteredThreads: meta.filteredThreads };\n            }\n            return value;\n          },\n        },\n        view: (view) => {\n          const syncDom = () => {\n            const filteredThreads = FILTERED_THREADS_PLUGIN_KEY.getState(\n              view.state\n            )?.filteredThreads;\n\n            // Toggle attribute for all comment-mark spans\n            const els = view.dom.querySelectorAll<HTMLElement>(\n              \"span.lb-tiptap-thread-mark[data-lb-thread-id]\"\n            );\n            els.forEach((el) => {\n              const id = el.getAttribute(\"data-lb-thread-id\");\n              if (!id) return;\n              if (!filteredThreads || filteredThreads.has(id)) {\n                el.removeAttribute(\"data-hidden\");\n              } else {\n                el.setAttribute(\"data-hidden\", \"\");\n              }\n            });\n          };\n\n          queueMicrotask(syncDom);\n\n          return {\n            update: (view, prevState) => {\n              const curr = FILTERED_THREADS_PLUGIN_KEY.getState(\n                view.state\n              )?.filteredThreads;\n              const prev =\n                FILTERED_THREADS_PLUGIN_KEY.getState(\n                  prevState\n                )?.filteredThreads;\n\n              if (\n                !areSetsEqual(prev, curr) ||\n                view.state.doc !== prevState.doc\n              ) {\n                syncDom();\n\n                const selected = THREADS_PLUGIN_KEY.getState(\n                  view.state\n                )?.selectedThreadId;\n                if (selected && curr && !curr.has(selected)) {\n                  view.dispatch(\n                    view.state.tr.setMeta(THREADS_PLUGIN_KEY, {\n                      name: ThreadPluginActions.SET_SELECTED_THREAD_ID,\n                      data: null,\n                    })\n                  );\n                }\n              }\n            },\n          };\n        },\n      }),\n    ];\n  },\n});\n\nexport function areSetsEqual(a?: Set<string>, b?: Set<string>): boolean {\n  if (a === b) return true;\n  if (!a || !b) return false;\n  if (a.size !== b.size) return false;\n  for (const v of a) if (!b.has(v)) return false;\n  return true;\n}\n", "import { escapeForRegEx, Range } from '@tiptap/core'\nimport { ResolvedPos } from '@tiptap/pm/model'\n\nexport interface Trigger {\n  char: string\n  allowSpaces: boolean\n  allowToIncludeChar: boolean\n  allowedPrefixes: string[] | null\n  startOfLine: boolean\n  $position: ResolvedPos\n}\n\nexport type SuggestionMatch = {\n  range: Range\n  query: string\n  text: string\n} | null\n\nexport function findSuggestionMatch(config: Trigger): SuggestionMatch {\n  const {\n    char, allowSpaces: allowSpacesOption, allowToIncludeChar, allowedPrefixes, startOfLine, $position,\n  } = config\n\n  const allowSpaces = allowSpacesOption && !allowToIncludeChar\n\n  const escapedChar = escapeForRegEx(char)\n  const suffix = new RegExp(`\\\\s${escapedChar}$`)\n  const prefix = startOfLine ? '^' : ''\n  const finalEscapedChar = allowToIncludeChar ? '' : escapedChar\n  const regexp = allowSpaces\n    ? new RegExp(`${prefix}${escapedChar}.*?(?=\\\\s${finalEscapedChar}|$)`, 'gm')\n    : new RegExp(`${prefix}(?:^)?${escapedChar}[^\\\\s${finalEscapedChar}]*`, 'gm')\n\n  const text = $position.nodeBefore?.isText && $position.nodeBefore.text\n\n  if (!text) {\n    return null\n  }\n\n  const textFrom = $position.pos - text.length\n  const match = Array.from(text.matchAll(regexp)).pop()\n\n  if (!match || match.input === undefined || match.index === undefined) {\n    return null\n  }\n\n  // JavaScript doesn't have lookbehinds. This hacks a check that first character\n  // is a space or the start of the line\n  const matchPrefix = match.input.slice(Math.max(0, match.index - 1), match.index)\n  const matchPrefixIsAllowed = new RegExp(`^[${allowedPrefixes?.join('')}\\0]?$`).test(matchPrefix)\n\n  if (allowedPrefixes !== null && !matchPrefixIsAllowed) {\n    return null\n  }\n\n  // The absolute position of the match in the document\n  const from = textFrom + match.index\n  let to = from + match[0].length\n\n  // Edge case handling; if spaces are allowed and we're directly in between\n  // two triggers\n  if (allowSpaces && suffix.test(text.slice(to - 1, to + 1))) {\n    match[0] += ' '\n    to += 1\n  }\n\n  // If the $position is located within the matched substring, return that range\n  if (from < $position.pos && to >= $position.pos) {\n    return {\n      range: {\n        from,\n        to,\n      },\n      query: match[0].slice(char.length),\n      text: match[0],\n    }\n  }\n\n  return null\n}\n", "import type { Editor, Range } from '@tiptap/core'\nimport type { EditorState } from '@tiptap/pm/state'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport type { EditorView } from '@tiptap/pm/view'\nimport { Decoration, DecorationSet } from '@tiptap/pm/view'\n\nimport { findSuggestionMatch as defaultFindSuggestionMatch } from './findSuggestionMatch.js'\n\nexport interface SuggestionOptions<I = any, TSelected = any> {\n  /**\n   * The plugin key for the suggestion plugin.\n   * @default 'suggestion'\n   * @example 'mention'\n   */\n  pluginKey?: PluginKey\n\n  /**\n   * The editor instance.\n   * @default null\n   */\n  editor: Editor\n\n  /**\n   * The character that triggers the suggestion.\n   * @default '@'\n   * @example '#'\n   */\n  char?: string\n\n  /**\n   * Allow spaces in the suggestion query. Not compatible with `allowToIncludeChar`. Will be disabled if `allowToIncludeChar` is set to `true`.\n   * @default false\n   * @example true\n   */\n  allowSpaces?: boolean\n\n  /**\n   * Allow the character to be included in the suggestion query. Not compatible with `allowSpaces`.\n   * @default false\n   */\n  allowToIncludeChar?: boolean\n\n  /**\n   * Allow prefixes in the suggestion query.\n   * @default [' ']\n   * @example [' ', '@']\n   */\n  allowedPrefixes?: string[] | null\n\n  /**\n   * Only match suggestions at the start of the line.\n   * @default false\n   * @example true\n   */\n  startOfLine?: boolean\n\n  /**\n   * The tag name of the decoration node.\n   * @default 'span'\n   * @example 'div'\n   */\n  decorationTag?: string\n\n  /**\n   * The class name of the decoration node.\n   * @default 'suggestion'\n   * @example 'mention'\n   */\n  decorationClass?: string\n\n  /**\n   * Creates a decoration with the provided content.\n   * @param decorationContent - The content to display in the decoration\n   * @default \"\" - Creates an empty decoration if no content provided\n   * @example 'Type to search...'\n   */\n  decorationContent?: string\n\n  /**\n   * The class name of the decoration node when it is empty.\n   * @default 'is-empty'\n   * @example 'is-empty'\n   */\n  decorationEmptyClass?: string\n\n  /**\n   * A function that is called when a suggestion is selected.\n   * @param props The props object.\n   * @param props.editor The editor instance.\n   * @param props.range The range of the suggestion.\n   * @param props.props The props of the selected suggestion.\n   * @returns void\n   * @example ({ editor, range, props }) => { props.command(props.props) }\n   */\n  command?: (props: { editor: Editor; range: Range; props: TSelected }) => void\n\n  /**\n   * A function that returns the suggestion items in form of an array.\n   * @param props The props object.\n   * @param props.editor The editor instance.\n   * @param props.query The current suggestion query.\n   * @returns An array of suggestion items.\n   * @example ({ editor, query }) => [{ id: 1, label: 'John Doe' }]\n   */\n  items?: (props: { query: string; editor: Editor }) => I[] | Promise<I[]>\n\n  /**\n   * The render function for the suggestion.\n   * @returns An object with render functions.\n   */\n  render?: () => {\n    onBeforeStart?: (props: SuggestionProps<I, TSelected>) => void\n    onStart?: (props: SuggestionProps<I, TSelected>) => void\n    onBeforeUpdate?: (props: SuggestionProps<I, TSelected>) => void\n    onUpdate?: (props: SuggestionProps<I, TSelected>) => void\n    onExit?: (props: SuggestionProps<I, TSelected>) => void\n    onKeyDown?: (props: SuggestionKeyDownProps) => boolean\n  }\n\n  /**\n   * A function that returns a boolean to indicate if the suggestion should be active.\n   * @param props The props object.\n   * @returns {boolean}\n   */\n  allow?: (props: {\n    editor: Editor\n    state: EditorState\n    range: Range\n    isActive?: boolean\n  }) => boolean\n  findSuggestionMatch?: typeof defaultFindSuggestionMatch\n}\n\nexport interface SuggestionProps<I = any, TSelected = any> {\n  /**\n   * The editor instance.\n   */\n  editor: Editor\n\n  /**\n   * The range of the suggestion.\n   */\n  range: Range\n\n  /**\n   * The current suggestion query.\n   */\n  query: string\n\n  /**\n   * The current suggestion text.\n   */\n  text: string\n\n  /**\n   * The suggestion items array.\n   */\n  items: I[]\n\n  /**\n   * A function that is called when a suggestion is selected.\n   * @param props The props object.\n   * @returns void\n   */\n  command: (props: TSelected) => void\n\n  /**\n   * The decoration node HTML element\n   * @default null\n   */\n  decorationNode: Element | null\n\n  /**\n   * The function that returns the client rect\n   * @default null\n   * @example () => new DOMRect(0, 0, 0, 0)\n   */\n  clientRect?: (() => DOMRect | null) | null\n}\n\nexport interface SuggestionKeyDownProps {\n  view: EditorView\n  event: KeyboardEvent\n  range: Range\n}\n\nexport const SuggestionPluginKey = new PluginKey('suggestion')\n\n/**\n * This utility allows you to create suggestions.\n * @see https://tiptap.dev/api/utilities/suggestion\n */\nexport function Suggestion<I = any, TSelected = any>({\n  pluginKey = SuggestionPluginKey,\n  editor,\n  char = '@',\n  allowSpaces = false,\n  allowToIncludeChar = false,\n  allowedPrefixes = [' '],\n  startOfLine = false,\n  decorationTag = 'span',\n  decorationClass = 'suggestion',\n  decorationContent = '',\n  decorationEmptyClass = 'is-empty',\n  command = () => null,\n  items = () => [],\n  render = () => ({}),\n  allow = () => true,\n  findSuggestionMatch = defaultFindSuggestionMatch,\n}: SuggestionOptions<I, TSelected>) {\n  let props: SuggestionProps<I, TSelected> | undefined\n  const renderer = render?.()\n\n  const plugin: Plugin<any> = new Plugin({\n    key: pluginKey,\n\n    view() {\n      return {\n        update: async (view, prevState) => {\n          const prev = this.key?.getState(prevState)\n          const next = this.key?.getState(view.state)\n\n          // See how the state changed\n          const moved = prev.active && next.active && prev.range.from !== next.range.from\n          const started = !prev.active && next.active\n          const stopped = prev.active && !next.active\n          const changed = !started && !stopped && prev.query !== next.query\n\n          const handleStart = started || (moved && changed)\n          const handleChange = changed || moved\n          const handleExit = stopped || (moved && changed)\n\n          // Cancel when suggestion isn't active\n          if (!handleStart && !handleChange && !handleExit) {\n            return\n          }\n\n          const state = handleExit && !handleStart ? prev : next\n          const decorationNode = view.dom.querySelector(\n            `[data-decoration-id=\"${state.decorationId}\"]`,\n          )\n\n          props = {\n            editor,\n            range: state.range,\n            query: state.query,\n            text: state.text,\n            items: [],\n            command: commandProps => {\n              return command({\n                editor,\n                range: state.range,\n                props: commandProps,\n              })\n            },\n            decorationNode,\n            // virtual node for popper.js or tippy.js\n            // this can be used for building popups without a DOM node\n            clientRect: decorationNode\n              ? () => {\n                // because of `items` can be asynchrounous well search for the current decoration node\n                  const { decorationId } = this.key?.getState(editor.state) // eslint-disable-line\n                const currentDecorationNode = view.dom.querySelector(\n                  `[data-decoration-id=\"${decorationId}\"]`,\n                )\n\n                return currentDecorationNode?.getBoundingClientRect() || null\n              }\n              : null,\n          }\n\n          if (handleStart) {\n            renderer?.onBeforeStart?.(props)\n          }\n\n          if (handleChange) {\n            renderer?.onBeforeUpdate?.(props)\n          }\n\n          if (handleChange || handleStart) {\n            props.items = await items({\n              editor,\n              query: state.query,\n            })\n          }\n\n          if (handleExit) {\n            renderer?.onExit?.(props)\n          }\n\n          if (handleChange) {\n            renderer?.onUpdate?.(props)\n          }\n\n          if (handleStart) {\n            renderer?.onStart?.(props)\n          }\n        },\n\n        destroy: () => {\n          if (!props) {\n            return\n          }\n\n          renderer?.onExit?.(props)\n        },\n      }\n    },\n\n    state: {\n      // Initialize the plugin's internal state.\n      init() {\n        const state: {\n          active: boolean\n          range: Range\n          query: null | string\n          text: null | string\n          composing: boolean\n          decorationId?: string | null\n        } = {\n          active: false,\n          range: {\n            from: 0,\n            to: 0,\n          },\n          query: null,\n          text: null,\n          composing: false,\n        }\n\n        return state\n      },\n\n      // Apply changes to the plugin state from a view transaction.\n      apply(transaction, prev, _oldState, state) {\n        const { isEditable } = editor\n        const { composing } = editor.view\n        const { selection } = transaction\n        const { empty, from } = selection\n        const next = { ...prev }\n\n        next.composing = composing\n\n        // We can only be suggesting if the view is editable, and:\n        //   * there is no selection, or\n        //   * a composition is active (see: https://github.com/ueberdosis/tiptap/issues/1449)\n        if (isEditable && (empty || editor.view.composing)) {\n          // Reset active state if we just left the previous suggestion range\n          if (\n            (from < prev.range.from || from > prev.range.to)\n            && !composing\n            && !prev.composing\n          ) {\n            next.active = false\n          }\n\n          // Try to match against where our cursor currently is\n          const match = findSuggestionMatch({\n            char,\n            allowSpaces,\n            allowToIncludeChar,\n            allowedPrefixes,\n            startOfLine,\n            $position: selection.$from,\n          })\n          const decorationId = `id_${Math.floor(Math.random() * 0xffffffff)}`\n\n          // If we found a match, update the current state to show it\n          if (\n            match\n            && allow({\n              editor,\n              state,\n              range: match.range,\n              isActive: prev.active,\n            })\n          ) {\n            next.active = true\n            next.decorationId = prev.decorationId\n              ? prev.decorationId\n              : decorationId\n            next.range = match.range\n            next.query = match.query\n            next.text = match.text\n          } else {\n            next.active = false\n          }\n        } else {\n          next.active = false\n        }\n\n        // Make sure to empty the range if suggestion is inactive\n        if (!next.active) {\n          next.decorationId = null\n          next.range = { from: 0, to: 0 }\n          next.query = null\n          next.text = null\n        }\n\n        return next\n      },\n    },\n\n    props: {\n      // Call the keydown hook if suggestion is active.\n      handleKeyDown(view, event) {\n        const { active, range } = plugin.getState(view.state)\n\n        if (!active) {\n          return false\n        }\n\n        return renderer?.onKeyDown?.({ view, event, range }) || false\n      },\n\n      // Setup decorator on the currently active suggestion.\n      decorations(state) {\n        const {\n          active, range, decorationId, query,\n        } = plugin.getState(state)\n\n        if (!active) {\n          return null\n        }\n\n        const isEmpty = !query?.length\n        const classNames = [decorationClass]\n\n        if (isEmpty) {\n          classNames.push(decorationEmptyClass)\n        }\n\n        return DecorationSet.create(state.doc, [\n          Decoration.inline(range.from, range.to, {\n            nodeName: decorationTag,\n            class: classNames.join(' '),\n            'data-decoration-id': decorationId,\n            'data-decoration-content': decorationContent,\n          }),\n        ])\n      },\n    },\n  })\n\n  return plugin\n}\n", "import {\n  type GroupMentionData,\n  MENTION_CHARACTER,\n  type MentionData,\n  type UserMentionData,\n} from \"@liveblocks/core\";\nimport { cn, Group, User } from \"@liveblocks/react-ui/_private\";\nimport type { Node } from \"@tiptap/pm/model\";\nimport { NodeViewWrapper } from \"@tiptap/react\";\nimport { type ComponentPropsWithoutRef, forwardRef } from \"react\";\n\nimport {\n  LIVEBLOCKS_GROUP_MENTION_TYPE,\n  LIVEBLOCKS_MENTION_TYPE,\n  type SerializedTiptapMentionData,\n} from \"../types\";\n\ninterface MentionProps extends ComponentPropsWithoutRef<\"span\"> {\n  mention: MentionData;\n  isSelected: boolean;\n}\n\nconst UserMention = forwardRef<HTMLSpanElement, MentionProps>(\n  ({ mention, isSelected }, forwardedRef) => {\n    return (\n      <NodeViewWrapper\n        className={cn(\n          \"lb-root lb-mention lb-tiptap-mention\",\n          isSelected && \"lb-mention-selected\"\n        )}\n        as=\"span\"\n        ref={forwardedRef}\n      >\n        <span className=\"lb-mention-symbol\">{MENTION_CHARACTER}</span>\n        <User userId={mention.id} />\n      </NodeViewWrapper>\n    );\n  }\n);\n\nconst GroupMention = forwardRef<HTMLSpanElement, MentionProps>(\n  ({ mention, isSelected }, forwardedRef) => {\n    return (\n      <NodeViewWrapper\n        className={cn(\n          \"lb-root lb-mention lb-tiptap-mention\",\n          isSelected && \"lb-mention-selected\"\n        )}\n        as=\"span\"\n        ref={forwardedRef}\n      >\n        <span className=\"lb-mention-symbol\">{MENTION_CHARACTER}</span>\n        <Group groupId={mention.id} />\n      </NodeViewWrapper>\n    );\n  }\n);\n\nfunction deserializeGroupUserIds(\n  userIds: string | undefined\n): string[] | undefined {\n  if (typeof userIds !== \"string\") {\n    return undefined;\n  }\n\n  try {\n    const parsedUserIds = JSON.parse(userIds) as string[];\n\n    if (Array.isArray(parsedUserIds)) {\n      return parsedUserIds;\n    }\n\n    return undefined;\n  } catch {\n    return undefined;\n  }\n}\n\nexport const Mention = forwardRef<\n  HTMLSpanElement,\n  { node: Node; selected: boolean }\n>(({ node, selected: isSelected }, forwardedRef) => {\n  const attrs = node.attrs as Omit<SerializedTiptapMentionData, \"kind\">;\n\n  if (node.type.name === LIVEBLOCKS_MENTION_TYPE) {\n    const mention: UserMentionData = {\n      kind: \"user\",\n      id: attrs.id,\n    };\n\n    return (\n      <UserMention\n        mention={mention}\n        isSelected={isSelected}\n        ref={forwardedRef}\n      />\n    );\n  }\n\n  if (node.type.name === LIVEBLOCKS_GROUP_MENTION_TYPE) {\n    const mention: GroupMentionData = {\n      kind: \"group\",\n      id: attrs.id,\n      userIds: deserializeGroupUserIds(attrs.userIds),\n    };\n\n    return (\n      <GroupMention\n        mention={mention}\n        isSelected={isSelected}\n        ref={forwardedRef}\n      />\n    );\n  }\n\n  return null;\n});\n", "import { mergeAttributes, Node } from \"@tiptap/core\";\nimport { ReactNodeViewRenderer } from \"@tiptap/react\";\n\nimport { LIVEBLOCKS_GROUP_MENTION_TYPE } from \"../types\";\nimport { Mention } from \"./Mention\";\n\nexport const GroupMentionNode = Node.create<never, never>({\n  name: LIVEBLOCKS_GROUP_MENTION_TYPE,\n  group: \"inline\",\n  inline: true,\n  selectable: true,\n  atom: true,\n\n  priority: 101,\n  parseHTML() {\n    return [\n      {\n        tag: \"liveblocks-group-mention\",\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"liveblocks-group-mention\", mergeAttributes(HTMLAttributes)];\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer(Mention, {\n      contentDOMElementTag: \"span\",\n    });\n  },\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: (element) => element.getAttribute(\"data-id\"),\n        renderHTML: (attributes) => {\n          if (!attributes.id) {\n            return {};\n          }\n\n          return {\n            \"data-id\": attributes.id as string, // \"as\" typing because TipTap doesn't have a way to type attributes\n          };\n        },\n      },\n      userIds: {\n        default: undefined,\n        parseHTML: (element) => {\n          const userIdsAttribute = element.getAttribute(\"data-user-ids\");\n\n          if (!userIdsAttribute) {\n            return undefined;\n          }\n\n          try {\n            const userIds = JSON.parse(userIdsAttribute) as string[];\n\n            return Array.isArray(userIds) ? userIds : undefined;\n          } catch {\n            return undefined;\n          }\n        },\n        renderHTML: (attributes) => {\n          if (!attributes.userIds || !Array.isArray(attributes.userIds)) {\n            return {};\n          }\n\n          return {\n            \"data-user-ids\": JSON.stringify(attributes.userIds),\n          };\n        },\n      },\n      notificationId: {\n        default: null,\n        parseHTML: (element) => element.getAttribute(\"data-notification-id\"),\n        renderHTML: (attributes) => {\n          if (!attributes.notificationId) {\n            return {};\n          }\n\n          return {\n            \"data-notification-id\": attributes.notificationId as string, // \"as\" typing because TipTap doesn't have a way to type attributes\n          };\n        },\n      },\n    };\n  },\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () =>\n        this.editor.commands.command(({ tr, state }) => {\n          let isMention = false;\n          const { selection } = state;\n          const { empty, anchor } = selection;\n\n          if (!empty) {\n            return false;\n          }\n\n          state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n            if (node.type.name === this.name) {\n              isMention = true;\n              tr.insertText(\"\", pos, pos + node.nodeSize);\n            }\n          });\n\n          return isMention;\n        }),\n    };\n  },\n});\n", "import { mergeAttributes, Node } from \"@tiptap/core\";\nimport { ReactNodeViewRenderer } from \"@tiptap/react\";\n\nimport { LIVEBLOCKS_MENTION_TYPE } from \"../types\";\nimport { Mention } from \"./Mention\";\n\nexport const MentionNode = Node.create<never, never>({\n  name: LIVEBLOCKS_MENTION_TYPE,\n  group: \"inline\",\n  inline: true,\n  selectable: true,\n  atom: true,\n\n  priority: 101,\n  parseHTML() {\n    return [\n      {\n        tag: \"liveblocks-mention\",\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"liveblocks-mention\", mergeAttributes(HTMLAttributes)];\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer(Mention, {\n      contentDOMElementTag: \"span\",\n    });\n  },\n\n  addAttributes() {\n    return {\n      id: {\n        default: null,\n        parseHTML: (element) => element.getAttribute(\"data-id\"),\n        renderHTML: (attributes) => {\n          if (!attributes.id) {\n            return {};\n          }\n\n          return {\n            \"data-id\": attributes.id as string, // \"as\" typing because TipTap doesn't have a way to type attributes\n          };\n        },\n      },\n      notificationId: {\n        default: null,\n        parseHTML: (element) => element.getAttribute(\"data-notification-id\"),\n        renderHTML: (attributes) => {\n          if (!attributes.notificationId) {\n            return {};\n          }\n\n          return {\n            \"data-notification-id\": attributes.notificationId as string, // \"as\" typing because TipTap doesn't have a way to type attributes\n          };\n        },\n      },\n    };\n  },\n  addKeyboardShortcuts() {\n    return {\n      Backspace: () =>\n        this.editor.commands.command(({ tr, state }) => {\n          let isMention = false;\n          const { selection } = state;\n          const { empty, anchor } = selection;\n\n          if (!empty) {\n            return false;\n          }\n\n          state.doc.nodesBetween(anchor - 1, anchor, (node, pos) => {\n            if (node.type.name === this.name) {\n              isMention = true;\n              tr.insertText(\"\", pos, pos + node.nodeSize);\n            }\n          });\n\n          return isMention;\n        }),\n    };\n  },\n});\n", "import {\n  autoUpdate,\n  flip,\n  hide,\n  limitShift,\n  offset,\n  shift,\n  size,\n  useFloating,\n} from \"@floating-ui/react-dom\";\nimport { assertNever, createInboxNotificationId } from \"@liveblocks/core\";\nimport { useRoom } from \"@liveblocks/react\";\nimport {\n  useLayoutEffect,\n  useMentionSuggestions,\n} from \"@liveblocks/react/_private\";\nimport {\n  Avatar,\n  Group,\n  GroupDescription,\n  User,\n  UsersIcon,\n} from \"@liveblocks/react-ui/_private\";\nimport type { HTMLAttributes, MouseEvent } from \"react\";\nimport { forwardRef, useEffect, useImperativeHandle, useState } from \"react\";\n\nimport type { TiptapMentionData } from \"../types\";\n\nexport const SUGGESTIONS_COLLISION_PADDING = 10;\n\nexport interface MentionsListProps extends HTMLAttributes<HTMLDivElement> {\n  query: string;\n  command: (otps: TiptapMentionData) => void;\n  clientRect: () => DOMRect;\n  hide: boolean;\n}\n\nexport type MentionsListHandle = {\n  onKeyDown: ({ event }: { event: KeyboardEvent }) => boolean;\n};\n\nexport const MentionsList = forwardRef<MentionsListHandle, MentionsListProps>(\n  (props, ref) => {\n    const [selectedIndex, setSelectedIndex] = useState(0);\n    const room = useRoom();\n    const suggestions = useMentionSuggestions(room.id, props.query);\n    const { onMouseEnter, onClick } = props;\n    const {\n      refs: { setReference, setFloating },\n      strategy,\n      x,\n      y,\n    } = useFloating({\n      strategy: \"fixed\",\n      placement: \"top-start\",\n      middleware: [\n        flip({ padding: SUGGESTIONS_COLLISION_PADDING, crossAxis: false }),\n        offset(10),\n        hide({ padding: SUGGESTIONS_COLLISION_PADDING }),\n        shift({\n          padding: SUGGESTIONS_COLLISION_PADDING,\n          limiter: limitShift(),\n        }),\n        size({ padding: SUGGESTIONS_COLLISION_PADDING }),\n      ],\n      whileElementsMounted: (...args) => {\n        return autoUpdate(...args, {\n          animationFrame: true,\n        });\n      },\n    });\n\n    useLayoutEffect(() => {\n      setReference({\n        getBoundingClientRect: props.clientRect,\n      });\n    }, [setReference, props.clientRect]);\n\n    const selectItem = (index: number) => {\n      const mention = (suggestions ?? [])[index];\n\n      if (!mention) {\n        return;\n      }\n\n      const notificationId = createInboxNotificationId();\n\n      switch (mention.kind) {\n        case \"user\":\n          props.command({\n            kind: \"user\",\n            id: mention.id,\n            notificationId,\n          });\n          break;\n\n        case \"group\":\n          props.command({\n            kind: \"group\",\n            id: mention.id,\n            userIds: mention.userIds,\n            notificationId,\n          });\n          break;\n\n        default:\n          return assertNever(mention, \"Unhandled mention kind\");\n      }\n    };\n\n    const upHandler = () => {\n      setSelectedIndex(\n        (selectedIndex + (suggestions?.length ?? 0) - 1) %\n          (suggestions?.length ?? 0)\n      );\n    };\n\n    const downHandler = () => {\n      setSelectedIndex((selectedIndex + 1) % (suggestions?.length ?? 0));\n    };\n\n    const enterHandler = () => {\n      selectItem(selectedIndex);\n    };\n\n    useEffect(() => setSelectedIndex(0), [suggestions]);\n\n    useImperativeHandle(ref, () => ({\n      onKeyDown: ({ event }: { event: KeyboardEvent }) => {\n        if (event.key === \"ArrowUp\") {\n          upHandler();\n          return true;\n        }\n\n        if (event.key === \"ArrowDown\") {\n          downHandler();\n          return true;\n        }\n\n        if (event.key === \"Enter\") {\n          enterHandler();\n          return true;\n        }\n\n        return false;\n      },\n    }));\n\n    const handleClick =\n      (index: number) => (event: MouseEvent<HTMLDivElement>) => {\n        onClick?.(event);\n\n        if (event.isDefaultPrevented()) return;\n        selectItem(index);\n      };\n    const handleMouseEnter =\n      (index: number) => (event: MouseEvent<HTMLDivElement>) => {\n        onMouseEnter?.(event);\n\n        if (event.isDefaultPrevented()) return;\n\n        setSelectedIndex(index);\n      };\n\n    if (suggestions === undefined || suggestions.length === 0) {\n      return null;\n    }\n\n    return (\n      <div\n        className=\"lb-root lb-portal lb-elevation lb-tiptap-suggestions lb-tiptap-mention-suggestions\"\n        ref={setFloating}\n        style={{\n          position: strategy,\n          top: 0,\n          left: 0,\n          transform: `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`,\n          minWidth: \"max-content\",\n          display: props.hide ? \"none\" : \"block\",\n        }}\n      >\n        <div className=\"lb-tiptap-suggestions-list lb-tiptap-mention-suggestions-list\">\n          {suggestions.map((mention, index) => {\n            return (\n              <div\n                className=\"lb-tiptap-suggestions-list-item lb-tiptap-mention-suggestion\"\n                key={index}\n                role=\"option\"\n                data-highlighted={index === selectedIndex || undefined}\n                onMouseEnter={handleMouseEnter(index)}\n                onClick={handleClick(index)}\n              >\n                {mention.kind === \"user\" ? (\n                  <>\n                    <Avatar\n                      userId={mention.id}\n                      className=\"lb-tiptap-mention-suggestion-avatar\"\n                    />\n                    <User\n                      userId={mention.id}\n                      className=\"lb-tiptap-mention-suggestion-user\"\n                    />\n                  </>\n                ) : mention.kind === \"group\" ? (\n                  <>\n                    <Avatar\n                      groupId={mention.id}\n                      className=\"lb-tiptap-mention-suggestion-avatar\"\n                      icon={<UsersIcon />}\n                    />\n                    <Group\n                      groupId={mention.id}\n                      className=\"lb-tiptap-mention-suggestion-group\"\n                    >\n                      <GroupDescription\n                        groupId={mention.id}\n                        className=\"lb-tiptap-mention-suggestion-group-description\"\n                      />\n                    </Group>\n                  </>\n                ) : (\n                  assertNever(mention, \"Unhandled mention kind\")\n                )}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n);\n", "import {\n  assertNever,\n  createInboxNotificationId,\n  MENTION_CHARACTER,\n} from \"@liveblocks/core\";\nimport {\n  combineTransactionSteps,\n  type Content,\n  Extension,\n  getChangedRanges,\n} from \"@tiptap/core\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport { Slice } from \"@tiptap/pm/model\";\nimport { Plugin } from \"@tiptap/pm/state\";\nimport { ReactRenderer } from \"@tiptap/react\";\nimport Suggestion from \"@tiptap/suggestion\";\nimport { ySyncPluginKey } from \"y-prosemirror\";\n\nimport {\n  LIVEBLOCKS_GROUP_MENTION_TYPE,\n  LIVEBLOCKS_MENTION_EXTENSION,\n  LIVEBLOCKS_MENTION_KEY,\n  LIVEBLOCKS_MENTION_NOTIFIER_KEY,\n  LIVEBLOCKS_MENTION_PASTE_KEY,\n  LIVEBLOCKS_MENTION_TYPE,\n  type TiptapMentionData,\n} from \"../types\";\nimport { getMentionsFromNode, mapFragment } from \"../utils\";\nimport { GroupMentionNode } from \"./GroupMentionNode\";\nimport { MentionNode } from \"./MentionNode\";\nimport type { MentionsListHandle, MentionsListProps } from \"./MentionsList\";\nimport { MentionsList } from \"./MentionsList\";\n\n/**\n *\n * Handles creating new notificationIds when notifications are pasted\n *\n * @returns Plugin\n */\nconst mentionPasteHandler = (): Plugin => {\n  return new Plugin({\n    key: LIVEBLOCKS_MENTION_PASTE_KEY,\n    props: {\n      transformPasted: (slice) => {\n        const getNewNotificationIds = (node: ProseMirrorNode) => {\n          // If this is a mention node, we need to get a new notification id\n          if (\n            node.type.name === LIVEBLOCKS_MENTION_TYPE ||\n            node.type.name === LIVEBLOCKS_GROUP_MENTION_TYPE\n          ) {\n            return node.type.create(\n              { ...node.attrs, notificationId: createInboxNotificationId() },\n              node.content\n            );\n          }\n          return node.copy(node.content);\n        };\n        const fragment = mapFragment(slice.content, getNewNotificationIds);\n        return new Slice(fragment, slice.openStart, slice.openEnd);\n      },\n    },\n  });\n};\n\nexport type MentionExtensionOptions = {\n  onCreateMention: (mention: TiptapMentionData) => void;\n  onDeleteMention: (notificationId: string) => void;\n};\n/**\n *\n * The purpose of this plugin is to create inbox notifications when a mention is\n *\n * @returns Plugin (from @tiptap/core)\n */\nconst notifier = ({\n  onCreateMention,\n  onDeleteMention,\n}: MentionExtensionOptions): Plugin => {\n  return new Plugin({\n    key: LIVEBLOCKS_MENTION_NOTIFIER_KEY,\n    appendTransaction: (transactions, oldState, newState) => {\n      const docChanges =\n        transactions.some((transaction) => transaction.docChanged) &&\n        !oldState.doc.eq(newState.doc);\n      // don't run if there was no change\n      if (!docChanges) {\n        return;\n      }\n      // don't run if from collab\n      if (\n        transactions.some((transaction) => transaction.getMeta(ySyncPluginKey))\n      ) {\n        return;\n      }\n      const transform = combineTransactionSteps(oldState.doc, [\n        ...transactions,\n      ]);\n      const changes = getChangedRanges(transform);\n\n      changes.forEach(({ newRange, oldRange }) => {\n        const newMentions = getMentionsFromNode(newState.doc, newRange);\n        const oldMentions = getMentionsFromNode(oldState.doc, oldRange);\n\n        if (oldMentions.size || newMentions.size) {\n          // create new mentions\n          newMentions.forEach((mention) => {\n            if (!oldMentions.has(mention.notificationId)) {\n              onCreateMention(mention);\n            }\n          });\n          // delete old mentions\n          oldMentions.forEach((mention) => {\n            if (!newMentions.has(mention.notificationId)) {\n              onDeleteMention(mention.notificationId);\n            }\n          });\n        }\n      });\n\n      return undefined;\n    },\n  });\n};\n\nexport const MentionExtension = Extension.create<MentionExtensionOptions>({\n  name: LIVEBLOCKS_MENTION_EXTENSION,\n\n  priority: 101,\n  addOptions() {\n    return {\n      onCreateMention: () => {},\n      onDeleteMention: () => {},\n    };\n  },\n\n  addExtensions() {\n    return [MentionNode, GroupMentionNode];\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      Suggestion({\n        editor: this.editor,\n        char: MENTION_CHARACTER,\n        pluginKey: LIVEBLOCKS_MENTION_KEY,\n        command: ({ editor, range, props }) => {\n          // increase range.to by one when the next node is of type \"text\"\n          // and starts with a space character\n          const nodeAfter = editor.view.state.selection.$to.nodeAfter;\n          const overrideSpace = nodeAfter?.text?.startsWith(\" \");\n\n          if (overrideSpace) {\n            range.to += 1;\n          }\n\n          const mention = props as TiptapMentionData;\n\n          let mentionNode: Content;\n\n          if (mention.kind === \"user\") {\n            mentionNode = {\n              type: LIVEBLOCKS_MENTION_TYPE,\n              attrs: {\n                id: mention.id,\n                notificationId: mention.notificationId,\n              },\n            };\n          } else if (mention.kind === \"group\") {\n            mentionNode = {\n              type: LIVEBLOCKS_GROUP_MENTION_TYPE,\n              attrs: {\n                id: mention.id,\n                userIds: mention.userIds\n                  ? JSON.stringify(mention.userIds)\n                  : undefined,\n                notificationId: mention.notificationId,\n              },\n            };\n          } else {\n            assertNever(mention, \"Unhandled mention kind\");\n          }\n\n          editor\n            .chain()\n            .focus()\n            .insertContentAt(range, [\n              mentionNode,\n              {\n                type: \"text\",\n                text: \" \",\n              },\n            ])\n            .run();\n\n          // get reference to `window` object from editor element, to support cross-frame JS usage\n          editor.view.dom.ownerDocument.defaultView\n            ?.getSelection()\n            ?.collapseToEnd();\n        },\n        allow: ({ state, range }) => {\n          const $fromParentType = state.doc.resolve(range.from).parent.type;\n\n          return Boolean(\n            $fromParentType.contentMatch.matchType(\n              state.schema.nodes[LIVEBLOCKS_MENTION_TYPE]\n            ) ||\n              $fromParentType.contentMatch.matchType(\n                state.schema.nodes[LIVEBLOCKS_GROUP_MENTION_TYPE]\n              )\n          );\n        },\n        allowSpaces: true,\n        items: () => [], // we'll let the mentions list component do this\n        render: () => {\n          let component: ReactRenderer<MentionsListHandle, MentionsListProps>;\n          return {\n            onStart: (props) => {\n              component = new ReactRenderer<\n                MentionsListHandle,\n                MentionsListProps\n              >(MentionsList, {\n                props,\n                editor: props.editor,\n              });\n\n              if (!props.clientRect) {\n                return;\n              }\n\n              document.body.appendChild(component.element);\n            },\n\n            onUpdate(props) {\n              component.updateProps(props);\n            },\n\n            onKeyDown(props) {\n              if (props.event.key === \"Escape\") {\n                component.updateProps({\n                  ...props,\n                  hide: true,\n                });\n                return true;\n              }\n              return component.ref?.onKeyDown(props) ?? false;\n            },\n\n            onExit() {\n              if (document.body.contains(component.element)) {\n                document.body.removeChild(component.element);\n              }\n              component.destroy();\n            },\n          };\n        },\n      }),\n      notifier(this.options),\n      mentionPasteHandler(),\n    ];\n  },\n});\n", "import type {\n  BaseUserMeta,\n  IUserInfo,\n  JsonObject,\n  User,\n} from \"@liveblocks/core\";\nimport { kInternal, TextEditorType } from \"@liveblocks/core\";\nimport { useClient, useRoom } from \"@liveblocks/react\";\nimport {\n  getUmbrellaStoreForClient,\n  useCreateTextMention,\n  useDeleteTextMention,\n  useReportTextEditor,\n  useYjsProvider,\n} from \"@liveblocks/react/_private\";\nimport { useInitial } from \"@liveblocks/react-ui/_private\";\nimport type { LiveblocksYjsProvider } from \"@liveblocks/yjs\";\nimport { getYjsProviderForRoom } from \"@liveblocks/yjs\";\nimport type { AnyExtension, Editor } from \"@tiptap/core\";\nimport { Extension, getMarkType, Mark } from \"@tiptap/core\";\nimport Collaboration from \"@tiptap/extension-collaboration\";\nimport CollaborationCursor from \"@tiptap/extension-collaboration-cursor\";\nimport type { Mark as PMMark } from \"@tiptap/pm/model\";\nimport { useCallback, useEffect, useRef, useSyncExternalStore } from \"react\";\n\nimport { AiExtension } from \"./ai/AiExtension\";\nimport {\n  areSetsEqual,\n  CommentsExtension,\n  FILTERED_THREADS_PLUGIN_KEY,\n} from \"./comments/CommentsExtension\";\nimport { MentionExtension } from \"./mentions/MentionExtension\";\nimport type {\n  LiveblocksExtensionOptions,\n  LiveblocksExtensionStorage,\n  ResolveContextualPromptArgs,\n  ResolveContextualPromptResponse,\n} from \"./types\";\nimport { LIVEBLOCKS_COMMENT_MARK_TYPE } from \"./types\";\n\ntype WithRequired<T, K extends keyof T> = T & { [P in K]-?: T[P] };\n\nconst DEFAULT_OPTIONS: WithRequired<LiveblocksExtensionOptions, \"field\"> = {\n  field: \"default\",\n  comments: true,\n  mentions: true,\n  offlineSupport_experimental: false,\n  enablePermanentUserData: false,\n};\n\nconst LiveblocksCollab = Collaboration.extend({\n  // Override the onCreate method to warn users about potential misconfigurations\n  onCreate() {\n    if (\n      !this.editor.extensionManager.extensions.find((e) => e.name === \"doc\")\n    ) {\n      console.warn(\n        \"[Liveblocks] The tiptap document extension is required for Liveblocks collaboration. Please add it or use Tiptap StarterKit extension.\"\n      );\n    }\n    if (\n      !this.editor.extensionManager.extensions.find(\n        (e) => e.name === \"paragraph\"\n      )\n    ) {\n      console.warn(\n        \"[Liveblocks] The tiptap paragraph extension is required for Liveblocks collaboration. Please add it or use Tiptap StarterKit extension.\"\n      );\n    }\n\n    if (\n      !this.editor.extensionManager.extensions.find((e) => e.name === \"text\")\n    ) {\n      console.warn(\n        \"[Liveblocks] The tiptap text extension is required for Liveblocks collaboration. Please add it or use Tiptap StarterKit extension.\"\n      );\n    }\n    if (\n      this.editor.extensionManager.extensions.find((e) => e.name === \"history\")\n    ) {\n      console.warn(\n        \"[Liveblocks] The history extension is enabled, Liveblocks extension provides its own. Please remove or disable the History plugin to prevent unwanted conflicts.\"\n      );\n    }\n  },\n});\n\n/**\n * Returns whether the editor has loaded the initial text contents from the\n * server and is ready to be used.\n *\n */\nexport function useIsEditorReady(): boolean {\n  const yjsProvider = useYjsProvider();\n\n  const getSnapshot = useCallback(() => {\n    const status = yjsProvider?.getStatus();\n    return status === \"synchronizing\" || status === \"synchronized\";\n  }, [yjsProvider]);\n\n  const subscribe = useCallback(\n    (callback: () => void) => {\n      if (yjsProvider === undefined) return () => {};\n      yjsProvider.on(\"status\", callback);\n      return () => {\n        yjsProvider.off(\"status\", callback);\n      };\n    },\n    [yjsProvider]\n  );\n\n  return useSyncExternalStore(subscribe, getSnapshot, getSnapshot);\n}\n\nconst YChangeMark = Mark.create({\n  name: \"ychange\",\n  inclusive: false,\n  parseHTML() {\n    return [{ tag: \"ychange\" }];\n  },\n  addAttributes() {\n    return {\n      user: {\n        default: null,\n        parseHTML: (element) => element.getAttribute(\"ychange_user\") ?? null,\n        renderHTML: (attributes: { user: string | null }) => {\n          if (!attributes.user) {\n            return {};\n          }\n          return { \"data-ychange-user\": attributes.user };\n        },\n      },\n      type: {\n        default: null,\n        parseHTML: (element) => element.getAttribute(\"ychange_type\") ?? null,\n        renderHTML: (attributes: { type: string | null }) => {\n          if (!attributes.type) {\n            return {};\n          }\n          return {\n            \"data-ychange-type\": attributes.type,\n            \"data-liveblocks\": \"\",\n            class: `lb-root lb-tiptap-change lb-tiptap-change-${attributes.type}`,\n          };\n        },\n      },\n      color: {\n        default: null,\n        parseHTML: (element) => {\n          return element.getAttribute(\"ychange_color\") ?? null;\n        },\n        renderHTML: () => {\n          // attributes: { color: { light: string; dark: string } | null }\n          return {}; // we don't need this color attribute for now\n        },\n      },\n    };\n  },\n  renderHTML({ HTMLAttributes }) {\n    return [\"ychange\", HTMLAttributes, 0];\n  },\n});\n\nexport const useLiveblocksExtension = (\n  opts?: LiveblocksExtensionOptions\n): Extension => {\n  const options = {\n    ...DEFAULT_OPTIONS,\n    ...opts,\n  };\n  const textEditorType = useInitial<TextEditorType>(\n    options.textEditorType ?? TextEditorType.TipTap\n  );\n  const editor = useRef<Editor | null>(null);\n  const room = useRoom();\n\n  // TODO: we don't need these things if comments isn't turned on...\n  // TODO: we don't have a reference to the editor here, need to figure this out\n  // useErrorListener((error) => {\n  //   // If thread creation fails, we remove the thread id from the associated nodes and unwrap the nodes if they are no longer associated with any threads\n  //   if (\n  //     error.context.type === \"CREATE_THREAD_ERROR\" &&\n  //     error.context.roomId === room.id\n  //   ) {\n  //     handleThreadDelete(error.context.threadId);\n  //   }\n  // });\n\n  const isEditorReady = useIsEditorReady();\n  const client = useClient();\n  const store = getUmbrellaStoreForClient(client);\n  const roomId = room.id;\n  const yjsProvider = useYjsProvider();\n\n  // If the user provided initialContent, wait for ready and then set it\n  useEffect(() => {\n    if (\n      !isEditorReady ||\n      !yjsProvider ||\n      !options.initialContent ||\n      !editor.current\n    )\n      return;\n\n    // As noted in the tiptap documentation, you may not set initial content with collaboration.\n    // The docs provide the following workaround:\n    const ydoc = (yjsProvider as LiveblocksYjsProvider).getYDoc();\n    const hasContentSet = ydoc.getMap(\"liveblocks_config\").get(\"hasContentSet\");\n    if (!hasContentSet) {\n      ydoc.getMap(\"liveblocks_config\").set(\"hasContentSet\", true);\n      editor.current.commands.setContent(options.initialContent);\n    }\n  }, [isEditorReady, yjsProvider, options.initialContent]);\n\n  useReportTextEditor(textEditorType, options.field ?? DEFAULT_OPTIONS.field);\n\n  const prevThreadsRef = useRef<Set<string> | undefined>(undefined);\n\n  useEffect(() => {\n    if (!isEditorReady) return;\n\n    if (!editor.current) return;\n\n    const newThreads = options.threads_experimental\n      ? new Set(options.threads_experimental.map((t) => t.id))\n      : undefined;\n\n    const hasFilteredThreadsChanged = !areSetsEqual(\n      prevThreadsRef.current,\n      newThreads\n    );\n\n    if (hasFilteredThreadsChanged) {\n      prevThreadsRef.current = newThreads;\n    }\n\n    if (hasFilteredThreadsChanged) {\n      editor.current.view.dispatch(\n        editor.current.state.tr.setMeta(FILTERED_THREADS_PLUGIN_KEY, {\n          filteredThreads: options.threads_experimental\n            ? new Set(options.threads_experimental.map((t) => t.id))\n            : undefined,\n        })\n      );\n    }\n  }, [isEditorReady, options.threads_experimental]);\n\n  const createTextMention = useCreateTextMention();\n  const deleteTextMention = useDeleteTextMention();\n\n  return Extension.create<never, LiveblocksExtensionStorage>({\n    name: \"liveblocksExtension\",\n\n    onCreate() {\n      editor.current = this.editor;\n      if (this.editor.options.content) {\n        console.warn(\n          \"[Liveblocks] Initial content must be set in the useLiveblocksExtension hook option. Remove content from your editor options.\"\n        );\n      }\n      if (\n        options.mentions &&\n        this.editor.extensionManager.extensions.find(\n          (e) => e.name.toLowerCase() === \"mention\"\n        )\n      ) {\n        console.warn(\n          \"[Liveblocks] Liveblocks own mention plugin is enabled, using another mention plugin may cause a conflict.\"\n        );\n      }\n      const self = room.getSelf();\n      const updateUser = ({\n        info,\n        id: userId,\n      }: User<JsonObject, BaseUserMeta>) => {\n        if (!info) {\n          return;\n        }\n        const { user: storedUser } =\n          this.storage.provider.awareness.getLocalState() as {\n            user: IUserInfo;\n          };\n        if (this.storage.permanentUserData) {\n          const pud = this.storage.permanentUserData.clients.get(\n            this.storage.doc.clientID\n          );\n          // Only update if there is no entry or if the entry is different\n          if (!pud || pud !== userId) {\n            this.storage.permanentUserData.setUserMapping(\n              this.storage.doc,\n              this.storage.doc.clientID,\n              userId ?? \"Unknown\" // TODO: change this to the user's ID so we can map it to the user's name\n            );\n          }\n        }\n        if (\n          info.name !== storedUser?.name ||\n          info.color !== storedUser?.color\n        ) {\n          this.editor.commands.updateUser({\n            name: info.name,\n            color: info.color,\n          });\n        }\n      };\n      // if we already have user info, we update the user\n      if (self?.info) {\n        updateUser(self);\n      }\n      // we also listen in case the user info changes\n      this.storage.unsubs.push(room.events.self.subscribe(updateUser));\n      if (options.comments) {\n        const commentMarkType = getMarkType(\n          LIVEBLOCKS_COMMENT_MARK_TYPE,\n          this.editor.schema\n        );\n        this.storage.unsubs.push(\n          // Subscribe to threads so we can update comment marks if they become resolved/deleted\n          store.outputs.threads.subscribe(() => {\n            const threadMap = new Map(\n              store.outputs.threads\n                .get()\n                .findMany(roomId, { resolved: false }, \"asc\")\n                .map((thread) => [thread.id, true])\n            );\n            function isComment(mark: PMMark): mark is PMMark & {\n              attrs: { orphan: boolean; threadId: string };\n            } {\n              return mark.type.name === LIVEBLOCKS_COMMENT_MARK_TYPE;\n            }\n            // when threads change, find marks and update them if needed\n            this.editor.state.doc.descendants((node, pos) => {\n              node.marks.forEach((mark) => {\n                if (isComment(mark)) {\n                  const markThreadId = mark.attrs.threadId;\n                  const isOrphan = !threadMap.has(markThreadId);\n                  if (isOrphan !== mark.attrs.orphan) {\n                    const { tr } = this.editor.state;\n                    const trimmedFrom = Math.max(pos, 0);\n                    const trimmedTo = Math.min(\n                      pos + node.nodeSize,\n                      this.editor.state.doc.content.size - 1\n                    );\n                    tr.removeMark(trimmedFrom, trimmedTo, mark);\n                    tr.addMark(\n                      trimmedFrom,\n                      trimmedTo,\n                      commentMarkType.create({\n                        ...mark.attrs,\n                        orphan: isOrphan,\n                      })\n                    );\n                    this.editor.view.dispatch(tr);\n                  }\n                }\n              });\n            });\n          })\n        );\n      }\n    },\n    onDestroy() {\n      this.storage.unsubs.forEach((unsub) => unsub());\n    },\n    addGlobalAttributes() {\n      return [\n        {\n          types: [\"paragraph\", \"heading\"],\n          attributes: {\n            ychange: { default: null },\n          },\n        },\n      ];\n    },\n    addStorage() {\n      const provider = getYjsProviderForRoom(room, {\n        enablePermanentUserData:\n          !!options.ai || options.enablePermanentUserData,\n        offlineSupport_experimental: options.offlineSupport_experimental,\n      });\n      return {\n        doc: provider.getYDoc(),\n        provider,\n        permanentUserData: provider.permanentUserData,\n        unsubs: [],\n      };\n    },\n    addExtensions() {\n      const extensions: AnyExtension[] = [\n        YChangeMark,\n        LiveblocksCollab.configure({\n          ySyncOptions: {\n            permanentUserData: this.storage.permanentUserData,\n          },\n          document: this.storage.doc,\n          field: options.field,\n        }),\n        CollaborationCursor.configure({\n          provider: this.storage.provider,\n        }),\n      ];\n\n      if (options.comments) {\n        extensions.push(CommentsExtension);\n      }\n      if (options.mentions) {\n        extensions.push(\n          MentionExtension.configure({\n            onCreateMention: (mention) => {\n              createTextMention(mention.notificationId, mention);\n            },\n            onDeleteMention: deleteTextMention,\n          })\n        );\n      }\n      if (options.ai) {\n        const resolveContextualPrompt = async ({\n          prompt,\n          context,\n          previous,\n          signal,\n        }: ResolveContextualPromptArgs): Promise<ResolveContextualPromptResponse> => {\n          const result = await room[kInternal].executeContextualPrompt({\n            prompt,\n            context,\n            previous,\n            signal,\n          });\n\n          // This response is validated afterwards by AiExtension itself\n          return JSON.parse(result) as ResolveContextualPromptResponse;\n        };\n\n        extensions.push(\n          AiExtension.configure({\n            resolveContextualPrompt,\n            ...(typeof options.ai === \"boolean\" ? {} : options.ai),\n            doc: this.storage.doc,\n            pud: this.storage.permanentUserData,\n          })\n        );\n      }\n\n      return extensions;\n    },\n  });\n};\n", "import { useLayoutEffect } from \"@liveblocks/react/_private\";\nimport {\n  Children,\n  type ComponentProps,\n  createContext,\n  forwardRef,\n  useContext,\n  useId,\n} from \"react\";\n\n// This file is separate to avoid circular dependencies\n\ntype FloatingToolbarContext = {\n  close: () => void;\n  registerExternal: (id: string) => () => void;\n};\n\nexport const FloatingToolbarContext =\n  createContext<FloatingToolbarContext | null>(null);\n\nexport const FloatingToolbarExternal = forwardRef<\n  HTMLDivElement,\n  ComponentProps<\"div\">\n>(({ children, style, ...props }, forwardedRef) => {\n  const id = useId();\n  const externalId = `liveblocks-floating-toolbar-external-${id}`;\n  const floatingToolbarContext = useContext(FloatingToolbarContext);\n  const registerExternal = floatingToolbarContext?.registerExternal;\n\n  useLayoutEffect(() => {\n    if (!registerExternal) {\n      return;\n    }\n\n    return registerExternal(externalId);\n  }, [registerExternal, externalId]);\n\n  if (!floatingToolbarContext || Children.count(children) === 0) {\n    return <>{children}</>;\n  }\n\n  return (\n    <div\n      ref={forwardedRef}\n      style={{ display: \"contents\", ...style }}\n      data-liveblocks-floating-toolbar-external={id}\n      {...props}\n      id={externalId}\n    >\n      {children}\n    </div>\n  );\n});\n", "import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { clamp } from '@radix-ui/number';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { createCollection } from '@radix-ui/react-collection';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useDirection } from '@radix-ui/react-direction';\nimport { DismissableLayer } from '@radix-ui/react-dismissable-layer';\nimport { useFocusGuards } from '@radix-ui/react-focus-guards';\nimport { FocusScope } from '@radix-ui/react-focus-scope';\nimport { useId } from '@radix-ui/react-id';\nimport * as PopperPrimitive from '@radix-ui/react-popper';\nimport { createPopperScope } from '@radix-ui/react-popper';\nimport { Portal as PortalPrimitive } from '@radix-ui/react-portal';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { createSlot } from '@radix-ui/react-slot';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\nimport { usePrevious } from '@radix-ui/react-use-previous';\nimport { VISUALLY_HIDDEN_STYLES } from '@radix-ui/react-visually-hidden';\nimport { hideOthers } from 'aria-hidden';\nimport { RemoveScroll } from 'react-remove-scroll';\n\nimport type { Scope } from '@radix-ui/react-context';\n\ntype Direction = 'ltr' | 'rtl';\n\nconst OPEN_KEYS = [' ', 'Enter', 'ArrowUp', 'ArrowDown'];\nconst SELECTION_KEYS = [' ', 'Enter'];\n\n/* -------------------------------------------------------------------------------------------------\n * Select\n * -----------------------------------------------------------------------------------------------*/\n\nconst SELECT_NAME = 'Select';\n\ntype ItemData = { value: string; disabled: boolean; textValue: string };\nconst [Collection, useCollection, createCollectionScope] = createCollection<\n  SelectItemElement,\n  ItemData\n>(SELECT_NAME);\n\ntype ScopedProps<P> = P & { __scopeSelect?: Scope };\nconst [createSelectContext, createSelectScope] = createContextScope(SELECT_NAME, [\n  createCollectionScope,\n  createPopperScope,\n]);\nconst usePopperScope = createPopperScope();\n\ntype SelectContextValue = {\n  trigger: SelectTriggerElement | null;\n  onTriggerChange(node: SelectTriggerElement | null): void;\n  valueNode: SelectValueElement | null;\n  onValueNodeChange(node: SelectValueElement): void;\n  valueNodeHasChildren: boolean;\n  onValueNodeHasChildrenChange(hasChildren: boolean): void;\n  contentId: string;\n  value: string | undefined;\n  onValueChange(value: string): void;\n  open: boolean;\n  required?: boolean;\n  onOpenChange(open: boolean): void;\n  dir: SelectProps['dir'];\n  triggerPointerDownPosRef: React.MutableRefObject<{ x: number; y: number } | null>;\n  disabled?: boolean;\n};\n\nconst [SelectProvider, useSelectContext] = createSelectContext<SelectContextValue>(SELECT_NAME);\n\ntype NativeOption = React.ReactElement<React.ComponentProps<'option'>>;\n\ntype SelectNativeOptionsContextValue = {\n  onNativeOptionAdd(option: NativeOption): void;\n  onNativeOptionRemove(option: NativeOption): void;\n};\nconst [SelectNativeOptionsProvider, useSelectNativeOptionsContext] =\n  createSelectContext<SelectNativeOptionsContextValue>(SELECT_NAME);\n\ninterface ControlledClearableSelectProps {\n  value: string | undefined;\n  defaultValue?: never;\n  onValueChange: (value: string | undefined) => void;\n}\n\ninterface ControlledUnclearableSelectProps {\n  value: string;\n  defaultValue?: never;\n  onValueChange: (value: string) => void;\n}\n\ninterface UncontrolledSelectProps {\n  value?: never;\n  defaultValue?: string;\n  onValueChange?: {\n    (value: string): void;\n    (value: string | undefined): void;\n  };\n}\n\ntype SelectControlProps =\n  | ControlledClearableSelectProps\n  | ControlledUnclearableSelectProps\n  | UncontrolledSelectProps;\n\ninterface SelectSharedProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?(open: boolean): void;\n  dir?: Direction;\n  name?: string;\n  autoComplete?: string;\n  disabled?: boolean;\n  required?: boolean;\n  form?: string;\n}\n\n// TODO: Should improve typing somewhat, but this would be a breaking change.\n// Consider using in the next major version (along with some testing to be sure\n// it works as expected and doesn't cause problems)\ntype _FutureSelectProps = SelectSharedProps & SelectControlProps;\n\ntype SelectProps = SelectSharedProps & {\n  value?: string;\n  defaultValue?: string;\n  onValueChange?(value: string): void;\n};\n\nconst Select: React.FC<SelectProps> = (props: ScopedProps<SelectProps>) => {\n  const {\n    __scopeSelect,\n    children,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    value: valueProp,\n    defaultValue,\n    onValueChange,\n    dir,\n    name,\n    autoComplete,\n    disabled,\n    required,\n    form,\n  } = props;\n  const popperScope = usePopperScope(__scopeSelect);\n  const [trigger, setTrigger] = React.useState<SelectTriggerElement | null>(null);\n  const [valueNode, setValueNode] = React.useState<SelectValueElement | null>(null);\n  const [valueNodeHasChildren, setValueNodeHasChildren] = React.useState(false);\n  const direction = useDirection(dir);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen ?? false,\n    onChange: onOpenChange,\n    caller: SELECT_NAME,\n  });\n  const [value, setValue] = useControllableState({\n    prop: valueProp,\n    defaultProp: defaultValue,\n    onChange: onValueChange as any,\n    caller: SELECT_NAME,\n  });\n  const triggerPointerDownPosRef = React.useRef<{ x: number; y: number } | null>(null);\n\n  // We set this to true by default so that events bubble to forms without JS (SSR)\n  const isFormControl = trigger ? form || !!trigger.closest('form') : true;\n  const [nativeOptionsSet, setNativeOptionsSet] = React.useState(new Set<NativeOption>());\n\n  // The native `select` only associates the correct default value if the corresponding\n  // `option` is rendered as a child **at the same time** as itself.\n  // Because it might take a few renders for our items to gather the information to build\n  // the native `option`(s), we generate a key on the `select` to make sure React re-builds it\n  // each time the options change.\n  const nativeSelectKey = Array.from(nativeOptionsSet)\n    .map((option) => option.props.value)\n    .join(';');\n\n  return (\n    <PopperPrimitive.Root {...popperScope}>\n      <SelectProvider\n        required={required}\n        scope={__scopeSelect}\n        trigger={trigger}\n        onTriggerChange={setTrigger}\n        valueNode={valueNode}\n        onValueNodeChange={setValueNode}\n        valueNodeHasChildren={valueNodeHasChildren}\n        onValueNodeHasChildrenChange={setValueNodeHasChildren}\n        contentId={useId()}\n        value={value}\n        onValueChange={setValue}\n        open={open}\n        onOpenChange={setOpen}\n        dir={direction}\n        triggerPointerDownPosRef={triggerPointerDownPosRef}\n        disabled={disabled}\n      >\n        <Collection.Provider scope={__scopeSelect}>\n          <SelectNativeOptionsProvider\n            scope={props.__scopeSelect}\n            onNativeOptionAdd={React.useCallback((option) => {\n              setNativeOptionsSet((prev) => new Set(prev).add(option));\n            }, [])}\n            onNativeOptionRemove={React.useCallback((option) => {\n              setNativeOptionsSet((prev) => {\n                const optionsSet = new Set(prev);\n                optionsSet.delete(option);\n                return optionsSet;\n              });\n            }, [])}\n          >\n            {children}\n          </SelectNativeOptionsProvider>\n        </Collection.Provider>\n\n        {isFormControl ? (\n          <SelectBubbleInput\n            key={nativeSelectKey}\n            aria-hidden\n            required={required}\n            tabIndex={-1}\n            name={name}\n            autoComplete={autoComplete}\n            value={value}\n            // enable form autofill\n            onChange={(event) => setValue(event.target.value)}\n            disabled={disabled}\n            form={form}\n          >\n            {value === undefined ? <option value=\"\" /> : null}\n            {Array.from(nativeOptionsSet)}\n          </SelectBubbleInput>\n        ) : null}\n      </SelectProvider>\n    </PopperPrimitive.Root>\n  );\n};\n\nSelect.displayName = SELECT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRIGGER_NAME = 'SelectTrigger';\n\ntype SelectTriggerElement = React.ComponentRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = React.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface SelectTriggerProps extends PrimitiveButtonProps {}\n\nconst SelectTrigger = React.forwardRef<SelectTriggerElement, SelectTriggerProps>(\n  (props: ScopedProps<SelectTriggerProps>, forwardedRef) => {\n    const { __scopeSelect, disabled = false, ...triggerProps } = props;\n    const popperScope = usePopperScope(__scopeSelect);\n    const context = useSelectContext(TRIGGER_NAME, __scopeSelect);\n    const isDisabled = context.disabled || disabled;\n    const composedRefs = useComposedRefs(forwardedRef, context.onTriggerChange);\n    const getItems = useCollection(__scopeSelect);\n    const pointerTypeRef = React.useRef<React.PointerEvent['pointerType']>('touch');\n\n    const [searchRef, handleTypeaheadSearch, resetTypeahead] = useTypeaheadSearch((search) => {\n      const enabledItems = getItems().filter((item) => !item.disabled);\n      const currentItem = enabledItems.find((item) => item.value === context.value);\n      const nextItem = findNextItem(enabledItems, search, currentItem);\n      if (nextItem !== undefined) {\n        context.onValueChange(nextItem.value);\n      }\n    });\n\n    const handleOpen = (pointerEvent?: React.MouseEvent | React.PointerEvent) => {\n      if (!isDisabled) {\n        context.onOpenChange(true);\n        // reset typeahead when we open\n        resetTypeahead();\n      }\n\n      if (pointerEvent) {\n        context.triggerPointerDownPosRef.current = {\n          x: Math.round(pointerEvent.pageX),\n          y: Math.round(pointerEvent.pageY),\n        };\n      }\n    };\n\n    return (\n      <PopperPrimitive.Anchor asChild {...popperScope}>\n        <Primitive.button\n          type=\"button\"\n          role=\"combobox\"\n          aria-controls={context.contentId}\n          aria-expanded={context.open}\n          aria-required={context.required}\n          aria-autocomplete=\"none\"\n          dir={context.dir}\n          data-state={context.open ? 'open' : 'closed'}\n          disabled={isDisabled}\n          data-disabled={isDisabled ? '' : undefined}\n          data-placeholder={shouldShowPlaceholder(context.value) ? '' : undefined}\n          {...triggerProps}\n          ref={composedRefs}\n          // Enable compatibility with native label or custom `Label` \"click\" for Safari:\n          onClick={composeEventHandlers(triggerProps.onClick, (event) => {\n            // Whilst browsers generally have no issue focusing the trigger when clicking\n            // on a label, Safari seems to struggle with the fact that there's no `onClick`.\n            // We force `focus` in this case. Note: this doesn't create any other side-effect\n            // because we are preventing default in `onPointerDown` so effectively\n            // this only runs for a label \"click\"\n            event.currentTarget.focus();\n\n            // Open on click when using a touch or pen device\n            if (pointerTypeRef.current !== 'mouse') {\n              handleOpen(event);\n            }\n          })}\n          onPointerDown={composeEventHandlers(triggerProps.onPointerDown, (event) => {\n            pointerTypeRef.current = event.pointerType;\n\n            // prevent implicit pointer capture\n            // https://www.w3.org/TR/pointerevents3/#implicit-pointer-capture\n            const target = event.target as HTMLElement;\n            if (target.hasPointerCapture(event.pointerId)) {\n              target.releasePointerCapture(event.pointerId);\n            }\n\n            // only call handler if it's the left button (mousedown gets triggered by all mouse buttons)\n            // but not when the control key is pressed (avoiding MacOS right click); also not for touch\n            // devices because that would open the menu on scroll. (pen devices behave as touch on iOS).\n            if (event.button === 0 && event.ctrlKey === false && event.pointerType === 'mouse') {\n              handleOpen(event);\n              // prevent trigger from stealing focus from the active item after opening.\n              event.preventDefault();\n            }\n          })}\n          onKeyDown={composeEventHandlers(triggerProps.onKeyDown, (event) => {\n            const isTypingAhead = searchRef.current !== '';\n            const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;\n            if (!isModifierKey && event.key.length === 1) handleTypeaheadSearch(event.key);\n            if (isTypingAhead && event.key === ' ') return;\n            if (OPEN_KEYS.includes(event.key)) {\n              handleOpen();\n              event.preventDefault();\n            }\n          })}\n        />\n      </PopperPrimitive.Anchor>\n    );\n  }\n);\n\nSelectTrigger.displayName = TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectValue\n * -----------------------------------------------------------------------------------------------*/\n\nconst VALUE_NAME = 'SelectValue';\n\ntype SelectValueElement = React.ComponentRef<typeof Primitive.span>;\ntype PrimitiveSpanProps = React.ComponentPropsWithoutRef<typeof Primitive.span>;\ninterface SelectValueProps extends Omit<PrimitiveSpanProps, 'placeholder'> {\n  placeholder?: React.ReactNode;\n}\n\nconst SelectValue = React.forwardRef<SelectValueElement, SelectValueProps>(\n  (props: ScopedProps<SelectValueProps>, forwardedRef) => {\n    // We ignore `className` and `style` as this part shouldn't be styled.\n    const { __scopeSelect, className, style, children, placeholder = '', ...valueProps } = props;\n    const context = useSelectContext(VALUE_NAME, __scopeSelect);\n    const { onValueNodeHasChildrenChange } = context;\n    const hasChildren = children !== undefined;\n    const composedRefs = useComposedRefs(forwardedRef, context.onValueNodeChange);\n\n    useLayoutEffect(() => {\n      onValueNodeHasChildrenChange(hasChildren);\n    }, [onValueNodeHasChildrenChange, hasChildren]);\n\n    return (\n      <Primitive.span\n        {...valueProps}\n        ref={composedRefs}\n        // we don't want events from the portalled `SelectValue` children to bubble\n        // through the item they came from\n        style={{ pointerEvents: 'none' }}\n      >\n        {shouldShowPlaceholder(context.value) ? <>{placeholder}</> : children}\n      </Primitive.span>\n    );\n  }\n);\n\nSelectValue.displayName = VALUE_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectIcon\n * -----------------------------------------------------------------------------------------------*/\n\nconst ICON_NAME = 'SelectIcon';\n\ntype SelectIconElement = React.ComponentRef<typeof Primitive.span>;\ninterface SelectIconProps extends PrimitiveSpanProps {}\n\nconst SelectIcon = React.forwardRef<SelectIconElement, SelectIconProps>(\n  (props: ScopedProps<SelectIconProps>, forwardedRef) => {\n    const { __scopeSelect, children, ...iconProps } = props;\n    return (\n      <Primitive.span aria-hidden {...iconProps} ref={forwardedRef}>\n        {children || '\u25BC'}\n      </Primitive.span>\n    );\n  }\n);\n\nSelectIcon.displayName = ICON_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'SelectPortal';\n\ntype PortalProps = React.ComponentPropsWithoutRef<typeof PortalPrimitive>;\ninterface SelectPortalProps {\n  children?: React.ReactNode;\n  /**\n   * Specify a container element to portal the content into.\n   */\n  container?: PortalProps['container'];\n}\n\nconst SelectPortal: React.FC<SelectPortalProps> = (props: ScopedProps<SelectPortalProps>) => {\n  return <PortalPrimitive asChild {...props} />;\n};\n\nSelectPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'SelectContent';\n\ntype SelectContentElement = SelectContentImplElement;\ninterface SelectContentProps extends SelectContentImplProps {}\n\nconst SelectContent = React.forwardRef<SelectContentElement, SelectContentProps>(\n  (props: ScopedProps<SelectContentProps>, forwardedRef) => {\n    const context = useSelectContext(CONTENT_NAME, props.__scopeSelect);\n    const [fragment, setFragment] = React.useState<DocumentFragment>();\n\n    // setting the fragment in `useLayoutEffect` as `DocumentFragment` doesn't exist on the server\n    useLayoutEffect(() => {\n      setFragment(new DocumentFragment());\n    }, []);\n\n    if (!context.open) {\n      const frag = fragment as Element | undefined;\n      return frag\n        ? ReactDOM.createPortal(\n            <SelectContentProvider scope={props.__scopeSelect}>\n              <Collection.Slot scope={props.__scopeSelect}>\n                <div>{props.children}</div>\n              </Collection.Slot>\n            </SelectContentProvider>,\n            frag\n          )\n        : null;\n    }\n\n    return <SelectContentImpl {...props} ref={forwardedRef} />;\n  }\n);\n\nSelectContent.displayName = CONTENT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectContentImpl\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_MARGIN = 10;\n\ntype SelectContentContextValue = {\n  content?: SelectContentElement | null;\n  viewport?: SelectViewportElement | null;\n  onViewportChange?: (node: SelectViewportElement | null) => void;\n  itemRefCallback?: (node: SelectItemElement | null, value: string, disabled: boolean) => void;\n  selectedItem?: SelectItemElement | null;\n  onItemLeave?: () => void;\n  itemTextRefCallback?: (\n    node: SelectItemTextElement | null,\n    value: string,\n    disabled: boolean\n  ) => void;\n  focusSelectedItem?: () => void;\n  selectedItemText?: SelectItemTextElement | null;\n  position?: SelectContentProps['position'];\n  isPositioned?: boolean;\n  searchRef?: React.RefObject<string>;\n};\n\nconst [SelectContentProvider, useSelectContentContext] =\n  createSelectContext<SelectContentContextValue>(CONTENT_NAME);\n\nconst CONTENT_IMPL_NAME = 'SelectContentImpl';\n\ntype SelectContentImplElement = SelectPopperPositionElement | SelectItemAlignedPositionElement;\ntype DismissableLayerProps = React.ComponentPropsWithoutRef<typeof DismissableLayer>;\ntype FocusScopeProps = React.ComponentPropsWithoutRef<typeof FocusScope>;\n\ntype SelectPopperPrivateProps = { onPlaced?: PopperContentProps['onPlaced'] };\n\ninterface SelectContentImplProps\n  extends Omit<SelectPopperPositionProps, keyof SelectPopperPrivateProps>,\n    Omit<SelectItemAlignedPositionProps, keyof SelectPopperPrivateProps> {\n  /**\n   * Event handler called when auto-focusing on close.\n   * Can be prevented.\n   */\n  onCloseAutoFocus?: FocusScopeProps['onUnmountAutoFocus'];\n  /**\n   * Event handler called when the escape key is down.\n   * Can be prevented.\n   */\n  onEscapeKeyDown?: DismissableLayerProps['onEscapeKeyDown'];\n  /**\n   * Event handler called when the a `pointerdown` event happens outside of the `DismissableLayer`.\n   * Can be prevented.\n   */\n  onPointerDownOutside?: DismissableLayerProps['onPointerDownOutside'];\n\n  position?: 'item-aligned' | 'popper';\n}\n\nconst Slot = createSlot('SelectContent.RemoveScroll');\n\nconst SelectContentImpl = React.forwardRef<SelectContentImplElement, SelectContentImplProps>(\n  (props: ScopedProps<SelectContentImplProps>, forwardedRef) => {\n    const {\n      __scopeSelect,\n      position = 'item-aligned',\n      onCloseAutoFocus,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      //\n      // PopperContent props\n      side,\n      sideOffset,\n      align,\n      alignOffset,\n      arrowPadding,\n      collisionBoundary,\n      collisionPadding,\n      sticky,\n      hideWhenDetached,\n      avoidCollisions,\n      //\n      ...contentProps\n    } = props;\n    const context = useSelectContext(CONTENT_NAME, __scopeSelect);\n    const [content, setContent] = React.useState<SelectContentImplElement | null>(null);\n    const [viewport, setViewport] = React.useState<SelectViewportElement | null>(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));\n    const [selectedItem, setSelectedItem] = React.useState<SelectItemElement | null>(null);\n    const [selectedItemText, setSelectedItemText] = React.useState<SelectItemTextElement | null>(\n      null\n    );\n    const getItems = useCollection(__scopeSelect);\n    const [isPositioned, setIsPositioned] = React.useState(false);\n    const firstValidItemFoundRef = React.useRef(false);\n\n    // aria-hide everything except the content (better supported equivalent to setting aria-modal)\n    React.useEffect(() => {\n      if (content) return hideOthers(content);\n    }, [content]);\n\n    // Make sure the whole tree has focus guards as our `Select` may be\n    // the last element in the DOM (because of the `Portal`)\n    useFocusGuards();\n\n    const focusFirst = React.useCallback(\n      (candidates: Array<HTMLElement | null>) => {\n        const [firstItem, ...restItems] = getItems().map((item) => item.ref.current);\n        const [lastItem] = restItems.slice(-1);\n\n        const PREVIOUSLY_FOCUSED_ELEMENT = document.activeElement;\n        for (const candidate of candidates) {\n          // if focus is already where we want to go, we don't want to keep going through the candidates\n          if (candidate === PREVIOUSLY_FOCUSED_ELEMENT) return;\n          candidate?.scrollIntoView({ block: 'nearest' });\n          // viewport might have padding so scroll to its edges when focusing first/last items.\n          if (candidate === firstItem && viewport) viewport.scrollTop = 0;\n          if (candidate === lastItem && viewport) viewport.scrollTop = viewport.scrollHeight;\n          candidate?.focus();\n          if (document.activeElement !== PREVIOUSLY_FOCUSED_ELEMENT) return;\n        }\n      },\n      [getItems, viewport]\n    );\n\n    const focusSelectedItem = React.useCallback(\n      () => focusFirst([selectedItem, content]),\n      [focusFirst, selectedItem, content]\n    );\n\n    // Since this is not dependent on layout, we want to ensure this runs at the same time as\n    // other effects across components. Hence why we don't call `focusSelectedItem` inside `position`.\n    React.useEffect(() => {\n      if (isPositioned) {\n        focusSelectedItem();\n      }\n    }, [isPositioned, focusSelectedItem]);\n\n    // prevent selecting items on `pointerup` in some cases after opening from `pointerdown`\n    // and close on `pointerup` outside.\n    const { onOpenChange, triggerPointerDownPosRef } = context;\n    React.useEffect(() => {\n      if (content) {\n        let pointerMoveDelta = { x: 0, y: 0 };\n\n        const handlePointerMove = (event: PointerEvent) => {\n          pointerMoveDelta = {\n            x: Math.abs(Math.round(event.pageX) - (triggerPointerDownPosRef.current?.x ?? 0)),\n            y: Math.abs(Math.round(event.pageY) - (triggerPointerDownPosRef.current?.y ?? 0)),\n          };\n        };\n        const handlePointerUp = (event: PointerEvent) => {\n          // If the pointer hasn't moved by a certain threshold then we prevent selecting item on `pointerup`.\n          if (pointerMoveDelta.x <= 10 && pointerMoveDelta.y <= 10) {\n            event.preventDefault();\n          } else {\n            // otherwise, if the event was outside the content, close.\n            if (!content.contains(event.target as HTMLElement)) {\n              onOpenChange(false);\n            }\n          }\n          document.removeEventListener('pointermove', handlePointerMove);\n          triggerPointerDownPosRef.current = null;\n        };\n\n        if (triggerPointerDownPosRef.current !== null) {\n          document.addEventListener('pointermove', handlePointerMove);\n          document.addEventListener('pointerup', handlePointerUp, { capture: true, once: true });\n        }\n\n        return () => {\n          document.removeEventListener('pointermove', handlePointerMove);\n          document.removeEventListener('pointerup', handlePointerUp, { capture: true });\n        };\n      }\n    }, [content, onOpenChange, triggerPointerDownPosRef]);\n\n    React.useEffect(() => {\n      const close = () => onOpenChange(false);\n      window.addEventListener('blur', close);\n      window.addEventListener('resize', close);\n      return () => {\n        window.removeEventListener('blur', close);\n        window.removeEventListener('resize', close);\n      };\n    }, [onOpenChange]);\n\n    const [searchRef, handleTypeaheadSearch] = useTypeaheadSearch((search) => {\n      const enabledItems = getItems().filter((item) => !item.disabled);\n      const currentItem = enabledItems.find((item) => item.ref.current === document.activeElement);\n      const nextItem = findNextItem(enabledItems, search, currentItem);\n      if (nextItem) {\n        /**\n         * Imperative focus during keydown is risky so we prevent React's batching updates\n         * to avoid potential bugs. See: https://github.com/facebook/react/issues/20332\n         */\n        setTimeout(() => (nextItem.ref.current as HTMLElement).focus());\n      }\n    });\n\n    const itemRefCallback = React.useCallback(\n      (node: SelectItemElement | null, value: string, disabled: boolean) => {\n        const isFirstValidItem = !firstValidItemFoundRef.current && !disabled;\n        const isSelectedItem = context.value !== undefined && context.value === value;\n        if (isSelectedItem || isFirstValidItem) {\n          setSelectedItem(node);\n          if (isFirstValidItem) firstValidItemFoundRef.current = true;\n        }\n      },\n      [context.value]\n    );\n    const handleItemLeave = React.useCallback(() => content?.focus(), [content]);\n    const itemTextRefCallback = React.useCallback(\n      (node: SelectItemTextElement | null, value: string, disabled: boolean) => {\n        const isFirstValidItem = !firstValidItemFoundRef.current && !disabled;\n        const isSelectedItem = context.value !== undefined && context.value === value;\n        if (isSelectedItem || isFirstValidItem) {\n          setSelectedItemText(node);\n        }\n      },\n      [context.value]\n    );\n\n    const SelectPosition = position === 'popper' ? SelectPopperPosition : SelectItemAlignedPosition;\n\n    // Silently ignore props that are not supported by `SelectItemAlignedPosition`\n    const popperContentProps =\n      SelectPosition === SelectPopperPosition\n        ? {\n            side,\n            sideOffset,\n            align,\n            alignOffset,\n            arrowPadding,\n            collisionBoundary,\n            collisionPadding,\n            sticky,\n            hideWhenDetached,\n            avoidCollisions,\n          }\n        : {};\n\n    return (\n      <SelectContentProvider\n        scope={__scopeSelect}\n        content={content}\n        viewport={viewport}\n        onViewportChange={setViewport}\n        itemRefCallback={itemRefCallback}\n        selectedItem={selectedItem}\n        onItemLeave={handleItemLeave}\n        itemTextRefCallback={itemTextRefCallback}\n        focusSelectedItem={focusSelectedItem}\n        selectedItemText={selectedItemText}\n        position={position}\n        isPositioned={isPositioned}\n        searchRef={searchRef}\n      >\n        <RemoveScroll as={Slot} allowPinchZoom>\n          <FocusScope\n            asChild\n            // we make sure we're not trapping once it's been closed\n            // (closed !== unmounted when animating out)\n            trapped={context.open}\n            onMountAutoFocus={(event) => {\n              // we prevent open autofocus because we manually focus the selected item\n              event.preventDefault();\n            }}\n            onUnmountAutoFocus={composeEventHandlers(onCloseAutoFocus, (event) => {\n              context.trigger?.focus({ preventScroll: true });\n              event.preventDefault();\n            })}\n          >\n            <DismissableLayer\n              asChild\n              disableOutsidePointerEvents\n              onEscapeKeyDown={onEscapeKeyDown}\n              onPointerDownOutside={onPointerDownOutside}\n              // When focus is trapped, a focusout event may still happen.\n              // We make sure we don't trigger our `onDismiss` in such case.\n              onFocusOutside={(event) => event.preventDefault()}\n              onDismiss={() => context.onOpenChange(false)}\n            >\n              <SelectPosition\n                role=\"listbox\"\n                id={context.contentId}\n                data-state={context.open ? 'open' : 'closed'}\n                dir={context.dir}\n                onContextMenu={(event) => event.preventDefault()}\n                {...contentProps}\n                {...popperContentProps}\n                onPlaced={() => setIsPositioned(true)}\n                ref={composedRefs}\n                style={{\n                  // flex layout so we can place the scroll buttons properly\n                  display: 'flex',\n                  flexDirection: 'column',\n                  // reset the outline by default as the content MAY get focused\n                  outline: 'none',\n                  ...contentProps.style,\n                }}\n                onKeyDown={composeEventHandlers(contentProps.onKeyDown, (event) => {\n                  const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;\n\n                  // select should not be navigated using tab key so we prevent it\n                  if (event.key === 'Tab') event.preventDefault();\n\n                  if (!isModifierKey && event.key.length === 1) handleTypeaheadSearch(event.key);\n\n                  if (['ArrowUp', 'ArrowDown', 'Home', 'End'].includes(event.key)) {\n                    const items = getItems().filter((item) => !item.disabled);\n                    let candidateNodes = items.map((item) => item.ref.current!);\n\n                    if (['ArrowUp', 'End'].includes(event.key)) {\n                      candidateNodes = candidateNodes.slice().reverse();\n                    }\n                    if (['ArrowUp', 'ArrowDown'].includes(event.key)) {\n                      const currentElement = event.target as SelectItemElement;\n                      const currentIndex = candidateNodes.indexOf(currentElement);\n                      candidateNodes = candidateNodes.slice(currentIndex + 1);\n                    }\n\n                    /**\n                     * Imperative focus during keydown is risky so we prevent React's batching updates\n                     * to avoid potential bugs. See: https://github.com/facebook/react/issues/20332\n                     */\n                    setTimeout(() => focusFirst(candidateNodes));\n\n                    event.preventDefault();\n                  }\n                })}\n              />\n            </DismissableLayer>\n          </FocusScope>\n        </RemoveScroll>\n      </SelectContentProvider>\n    );\n  }\n);\n\nSelectContentImpl.displayName = CONTENT_IMPL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectItemAlignedPosition\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_ALIGNED_POSITION_NAME = 'SelectItemAlignedPosition';\n\ntype SelectItemAlignedPositionElement = React.ComponentRef<typeof Primitive.div>;\ninterface SelectItemAlignedPositionProps extends PrimitiveDivProps, SelectPopperPrivateProps {}\n\nconst SelectItemAlignedPosition = React.forwardRef<\n  SelectItemAlignedPositionElement,\n  SelectItemAlignedPositionProps\n>((props: ScopedProps<SelectItemAlignedPositionProps>, forwardedRef) => {\n  const { __scopeSelect, onPlaced, ...popperProps } = props;\n  const context = useSelectContext(CONTENT_NAME, __scopeSelect);\n  const contentContext = useSelectContentContext(CONTENT_NAME, __scopeSelect);\n  const [contentWrapper, setContentWrapper] = React.useState<HTMLDivElement | null>(null);\n  const [content, setContent] = React.useState<SelectItemAlignedPositionElement | null>(null);\n  const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));\n  const getItems = useCollection(__scopeSelect);\n  const shouldExpandOnScrollRef = React.useRef(false);\n  const shouldRepositionRef = React.useRef(true);\n\n  const { viewport, selectedItem, selectedItemText, focusSelectedItem } = contentContext;\n  const position = React.useCallback(() => {\n    if (\n      context.trigger &&\n      context.valueNode &&\n      contentWrapper &&\n      content &&\n      viewport &&\n      selectedItem &&\n      selectedItemText\n    ) {\n      const triggerRect = context.trigger.getBoundingClientRect();\n\n      // -----------------------------------------------------------------------------------------\n      //  Horizontal positioning\n      // -----------------------------------------------------------------------------------------\n      const contentRect = content.getBoundingClientRect();\n      const valueNodeRect = context.valueNode.getBoundingClientRect();\n      const itemTextRect = selectedItemText.getBoundingClientRect();\n\n      if (context.dir !== 'rtl') {\n        const itemTextOffset = itemTextRect.left - contentRect.left;\n        const left = valueNodeRect.left - itemTextOffset;\n        const leftDelta = triggerRect.left - left;\n        const minContentWidth = triggerRect.width + leftDelta;\n        const contentWidth = Math.max(minContentWidth, contentRect.width);\n        const rightEdge = window.innerWidth - CONTENT_MARGIN;\n        const clampedLeft = clamp(left, [\n          CONTENT_MARGIN,\n          // Prevents the content from going off the starting edge of the\n          // viewport. It may still go off the ending edge, but this can be\n          // controlled by the user since they may want to manage overflow in a\n          // specific way.\n          // https://github.com/radix-ui/primitives/issues/2049\n          Math.max(CONTENT_MARGIN, rightEdge - contentWidth),\n        ]);\n\n        contentWrapper.style.minWidth = minContentWidth + 'px';\n        contentWrapper.style.left = clampedLeft + 'px';\n      } else {\n        const itemTextOffset = contentRect.right - itemTextRect.right;\n        const right = window.innerWidth - valueNodeRect.right - itemTextOffset;\n        const rightDelta = window.innerWidth - triggerRect.right - right;\n        const minContentWidth = triggerRect.width + rightDelta;\n        const contentWidth = Math.max(minContentWidth, contentRect.width);\n        const leftEdge = window.innerWidth - CONTENT_MARGIN;\n        const clampedRight = clamp(right, [\n          CONTENT_MARGIN,\n          Math.max(CONTENT_MARGIN, leftEdge - contentWidth),\n        ]);\n\n        contentWrapper.style.minWidth = minContentWidth + 'px';\n        contentWrapper.style.right = clampedRight + 'px';\n      }\n\n      // -----------------------------------------------------------------------------------------\n      // Vertical positioning\n      // -----------------------------------------------------------------------------------------\n      const items = getItems();\n      const availableHeight = window.innerHeight - CONTENT_MARGIN * 2;\n      const itemsHeight = viewport.scrollHeight;\n\n      const contentStyles = window.getComputedStyle(content);\n      const contentBorderTopWidth = parseInt(contentStyles.borderTopWidth, 10);\n      const contentPaddingTop = parseInt(contentStyles.paddingTop, 10);\n      const contentBorderBottomWidth = parseInt(contentStyles.borderBottomWidth, 10);\n      const contentPaddingBottom = parseInt(contentStyles.paddingBottom, 10);\n      const fullContentHeight = contentBorderTopWidth + contentPaddingTop + itemsHeight + contentPaddingBottom + contentBorderBottomWidth; // prettier-ignore\n      const minContentHeight = Math.min(selectedItem.offsetHeight * 5, fullContentHeight);\n\n      const viewportStyles = window.getComputedStyle(viewport);\n      const viewportPaddingTop = parseInt(viewportStyles.paddingTop, 10);\n      const viewportPaddingBottom = parseInt(viewportStyles.paddingBottom, 10);\n\n      const topEdgeToTriggerMiddle = triggerRect.top + triggerRect.height / 2 - CONTENT_MARGIN;\n      const triggerMiddleToBottomEdge = availableHeight - topEdgeToTriggerMiddle;\n\n      const selectedItemHalfHeight = selectedItem.offsetHeight / 2;\n      const itemOffsetMiddle = selectedItem.offsetTop + selectedItemHalfHeight;\n      const contentTopToItemMiddle = contentBorderTopWidth + contentPaddingTop + itemOffsetMiddle;\n      const itemMiddleToContentBottom = fullContentHeight - contentTopToItemMiddle;\n\n      const willAlignWithoutTopOverflow = contentTopToItemMiddle <= topEdgeToTriggerMiddle;\n\n      if (willAlignWithoutTopOverflow) {\n        const isLastItem =\n          items.length > 0 && selectedItem === items[items.length - 1]!.ref.current;\n        contentWrapper.style.bottom = 0 + 'px';\n        const viewportOffsetBottom =\n          content.clientHeight - viewport.offsetTop - viewport.offsetHeight;\n        const clampedTriggerMiddleToBottomEdge = Math.max(\n          triggerMiddleToBottomEdge,\n          selectedItemHalfHeight +\n            // viewport might have padding bottom, include it to avoid a scrollable viewport\n            (isLastItem ? viewportPaddingBottom : 0) +\n            viewportOffsetBottom +\n            contentBorderBottomWidth\n        );\n        const height = contentTopToItemMiddle + clampedTriggerMiddleToBottomEdge;\n        contentWrapper.style.height = height + 'px';\n      } else {\n        const isFirstItem = items.length > 0 && selectedItem === items[0]!.ref.current;\n        contentWrapper.style.top = 0 + 'px';\n        const clampedTopEdgeToTriggerMiddle = Math.max(\n          topEdgeToTriggerMiddle,\n          contentBorderTopWidth +\n            viewport.offsetTop +\n            // viewport might have padding top, include it to avoid a scrollable viewport\n            (isFirstItem ? viewportPaddingTop : 0) +\n            selectedItemHalfHeight\n        );\n        const height = clampedTopEdgeToTriggerMiddle + itemMiddleToContentBottom;\n        contentWrapper.style.height = height + 'px';\n        viewport.scrollTop = contentTopToItemMiddle - topEdgeToTriggerMiddle + viewport.offsetTop;\n      }\n\n      contentWrapper.style.margin = `${CONTENT_MARGIN}px 0`;\n      contentWrapper.style.minHeight = minContentHeight + 'px';\n      contentWrapper.style.maxHeight = availableHeight + 'px';\n      // -----------------------------------------------------------------------------------------\n\n      onPlaced?.();\n\n      // we don't want the initial scroll position adjustment to trigger \"expand on scroll\"\n      // so we explicitly turn it on only after they've registered.\n      requestAnimationFrame(() => (shouldExpandOnScrollRef.current = true));\n    }\n  }, [\n    getItems,\n    context.trigger,\n    context.valueNode,\n    contentWrapper,\n    content,\n    viewport,\n    selectedItem,\n    selectedItemText,\n    context.dir,\n    onPlaced,\n  ]);\n\n  useLayoutEffect(() => position(), [position]);\n\n  // copy z-index from content to wrapper\n  const [contentZIndex, setContentZIndex] = React.useState<string>();\n  useLayoutEffect(() => {\n    if (content) setContentZIndex(window.getComputedStyle(content).zIndex);\n  }, [content]);\n\n  // When the viewport becomes scrollable at the top, the scroll up button will mount.\n  // Because it is part of the normal flow, it will push down the viewport, thus throwing our\n  // trigger => selectedItem alignment off by the amount the viewport was pushed down.\n  // We wait for this to happen and then re-run the positining logic one more time to account for it.\n  const handleScrollButtonChange = React.useCallback(\n    (node: SelectScrollButtonImplElement | null) => {\n      if (node && shouldRepositionRef.current === true) {\n        position();\n        focusSelectedItem?.();\n        shouldRepositionRef.current = false;\n      }\n    },\n    [position, focusSelectedItem]\n  );\n\n  return (\n    <SelectViewportProvider\n      scope={__scopeSelect}\n      contentWrapper={contentWrapper}\n      shouldExpandOnScrollRef={shouldExpandOnScrollRef}\n      onScrollButtonChange={handleScrollButtonChange}\n    >\n      <div\n        ref={setContentWrapper}\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          position: 'fixed',\n          zIndex: contentZIndex,\n        }}\n      >\n        <Primitive.div\n          {...popperProps}\n          ref={composedRefs}\n          style={{\n            // When we get the height of the content, it includes borders. If we were to set\n            // the height without having `boxSizing: 'border-box'` it would be too big.\n            boxSizing: 'border-box',\n            // We need to ensure the content doesn't get taller than the wrapper\n            maxHeight: '100%',\n            ...popperProps.style,\n          }}\n        />\n      </div>\n    </SelectViewportProvider>\n  );\n});\n\nSelectItemAlignedPosition.displayName = ITEM_ALIGNED_POSITION_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectPopperPosition\n * -----------------------------------------------------------------------------------------------*/\n\nconst POPPER_POSITION_NAME = 'SelectPopperPosition';\n\ntype SelectPopperPositionElement = React.ComponentRef<typeof PopperPrimitive.Content>;\ntype PopperContentProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Content>;\ninterface SelectPopperPositionProps extends PopperContentProps, SelectPopperPrivateProps {}\n\nconst SelectPopperPosition = React.forwardRef<\n  SelectPopperPositionElement,\n  SelectPopperPositionProps\n>((props: ScopedProps<SelectPopperPositionProps>, forwardedRef) => {\n  const {\n    __scopeSelect,\n    align = 'start',\n    collisionPadding = CONTENT_MARGIN,\n    ...popperProps\n  } = props;\n  const popperScope = usePopperScope(__scopeSelect);\n\n  return (\n    <PopperPrimitive.Content\n      {...popperScope}\n      {...popperProps}\n      ref={forwardedRef}\n      align={align}\n      collisionPadding={collisionPadding}\n      style={{\n        // Ensure border-box for floating-ui calculations\n        boxSizing: 'border-box',\n        ...popperProps.style,\n        // re-namespace exposed content custom properties\n        ...{\n          '--radix-select-content-transform-origin': 'var(--radix-popper-transform-origin)',\n          '--radix-select-content-available-width': 'var(--radix-popper-available-width)',\n          '--radix-select-content-available-height': 'var(--radix-popper-available-height)',\n          '--radix-select-trigger-width': 'var(--radix-popper-anchor-width)',\n          '--radix-select-trigger-height': 'var(--radix-popper-anchor-height)',\n        },\n      }}\n    />\n  );\n});\n\nSelectPopperPosition.displayName = POPPER_POSITION_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectViewport\n * -----------------------------------------------------------------------------------------------*/\n\ntype SelectViewportContextValue = {\n  contentWrapper?: HTMLDivElement | null;\n  shouldExpandOnScrollRef?: React.RefObject<boolean>;\n  onScrollButtonChange?: (node: SelectScrollButtonImplElement | null) => void;\n};\n\nconst [SelectViewportProvider, useSelectViewportContext] =\n  createSelectContext<SelectViewportContextValue>(CONTENT_NAME, {});\n\nconst VIEWPORT_NAME = 'SelectViewport';\n\ntype SelectViewportElement = React.ComponentRef<typeof Primitive.div>;\ntype PrimitiveDivProps = React.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface SelectViewportProps extends PrimitiveDivProps {\n  nonce?: string;\n}\n\nconst SelectViewport = React.forwardRef<SelectViewportElement, SelectViewportProps>(\n  (props: ScopedProps<SelectViewportProps>, forwardedRef) => {\n    const { __scopeSelect, nonce, ...viewportProps } = props;\n    const contentContext = useSelectContentContext(VIEWPORT_NAME, __scopeSelect);\n    const viewportContext = useSelectViewportContext(VIEWPORT_NAME, __scopeSelect);\n    const composedRefs = useComposedRefs(forwardedRef, contentContext.onViewportChange);\n    const prevScrollTopRef = React.useRef(0);\n    return (\n      <>\n        {/* Hide scrollbars cross-browser and enable momentum scroll for touch devices */}\n        <style\n          dangerouslySetInnerHTML={{\n            __html: `[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}`,\n          }}\n          nonce={nonce}\n        />\n        <Collection.Slot scope={__scopeSelect}>\n          <Primitive.div\n            data-radix-select-viewport=\"\"\n            role=\"presentation\"\n            {...viewportProps}\n            ref={composedRefs}\n            style={{\n              // we use position: 'relative' here on the `viewport` so that when we call\n              // `selectedItem.offsetTop` in calculations, the offset is relative to the viewport\n              // (independent of the scrollUpButton).\n              position: 'relative',\n              flex: 1,\n              // Viewport should only be scrollable in the vertical direction.\n              // This won't work in vertical writing modes, so we'll need to\n              // revisit this if/when that is supported\n              // https://developer.chrome.com/blog/vertical-form-controls\n              overflow: 'hidden auto',\n              ...viewportProps.style,\n            }}\n            onScroll={composeEventHandlers(viewportProps.onScroll, (event) => {\n              const viewport = event.currentTarget;\n              const { contentWrapper, shouldExpandOnScrollRef } = viewportContext;\n              if (shouldExpandOnScrollRef?.current && contentWrapper) {\n                const scrolledBy = Math.abs(prevScrollTopRef.current - viewport.scrollTop);\n                if (scrolledBy > 0) {\n                  const availableHeight = window.innerHeight - CONTENT_MARGIN * 2;\n                  const cssMinHeight = parseFloat(contentWrapper.style.minHeight);\n                  const cssHeight = parseFloat(contentWrapper.style.height);\n                  const prevHeight = Math.max(cssMinHeight, cssHeight);\n\n                  if (prevHeight < availableHeight) {\n                    const nextHeight = prevHeight + scrolledBy;\n                    const clampedNextHeight = Math.min(availableHeight, nextHeight);\n                    const heightDiff = nextHeight - clampedNextHeight;\n\n                    contentWrapper.style.height = clampedNextHeight + 'px';\n                    if (contentWrapper.style.bottom === '0px') {\n                      viewport.scrollTop = heightDiff > 0 ? heightDiff : 0;\n                      // ensure the content stays pinned to the bottom\n                      contentWrapper.style.justifyContent = 'flex-end';\n                    }\n                  }\n                }\n              }\n              prevScrollTopRef.current = viewport.scrollTop;\n            })}\n          />\n        </Collection.Slot>\n      </>\n    );\n  }\n);\n\nSelectViewport.displayName = VIEWPORT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst GROUP_NAME = 'SelectGroup';\n\ntype SelectGroupContextValue = { id: string };\n\nconst [SelectGroupContextProvider, useSelectGroupContext] =\n  createSelectContext<SelectGroupContextValue>(GROUP_NAME);\n\ntype SelectGroupElement = React.ComponentRef<typeof Primitive.div>;\ninterface SelectGroupProps extends PrimitiveDivProps {}\n\nconst SelectGroup = React.forwardRef<SelectGroupElement, SelectGroupProps>(\n  (props: ScopedProps<SelectGroupProps>, forwardedRef) => {\n    const { __scopeSelect, ...groupProps } = props;\n    const groupId = useId();\n    return (\n      <SelectGroupContextProvider scope={__scopeSelect} id={groupId}>\n        <Primitive.div role=\"group\" aria-labelledby={groupId} {...groupProps} ref={forwardedRef} />\n      </SelectGroupContextProvider>\n    );\n  }\n);\n\nSelectGroup.displayName = GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectLabel\n * -----------------------------------------------------------------------------------------------*/\n\nconst LABEL_NAME = 'SelectLabel';\n\ntype SelectLabelElement = React.ComponentRef<typeof Primitive.div>;\ninterface SelectLabelProps extends PrimitiveDivProps {}\n\nconst SelectLabel = React.forwardRef<SelectLabelElement, SelectLabelProps>(\n  (props: ScopedProps<SelectLabelProps>, forwardedRef) => {\n    const { __scopeSelect, ...labelProps } = props;\n    const groupContext = useSelectGroupContext(LABEL_NAME, __scopeSelect);\n    return <Primitive.div id={groupContext.id} {...labelProps} ref={forwardedRef} />;\n  }\n);\n\nSelectLabel.displayName = LABEL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_NAME = 'SelectItem';\n\ntype SelectItemContextValue = {\n  value: string;\n  disabled: boolean;\n  textId: string;\n  isSelected: boolean;\n  onItemTextChange(node: SelectItemTextElement | null): void;\n};\n\nconst [SelectItemContextProvider, useSelectItemContext] =\n  createSelectContext<SelectItemContextValue>(ITEM_NAME);\n\ntype SelectItemElement = React.ComponentRef<typeof Primitive.div>;\ninterface SelectItemProps extends PrimitiveDivProps {\n  value: string;\n  disabled?: boolean;\n  textValue?: string;\n}\n\nconst SelectItem = React.forwardRef<SelectItemElement, SelectItemProps>(\n  (props: ScopedProps<SelectItemProps>, forwardedRef) => {\n    const {\n      __scopeSelect,\n      value,\n      disabled = false,\n      textValue: textValueProp,\n      ...itemProps\n    } = props;\n    const context = useSelectContext(ITEM_NAME, __scopeSelect);\n    const contentContext = useSelectContentContext(ITEM_NAME, __scopeSelect);\n    const isSelected = context.value === value;\n    const [textValue, setTextValue] = React.useState(textValueProp ?? '');\n    const [isFocused, setIsFocused] = React.useState(false);\n    const composedRefs = useComposedRefs(forwardedRef, (node) =>\n      contentContext.itemRefCallback?.(node, value, disabled)\n    );\n    const textId = useId();\n    const pointerTypeRef = React.useRef<React.PointerEvent['pointerType']>('touch');\n\n    const handleSelect = () => {\n      if (!disabled) {\n        context.onValueChange(value);\n        context.onOpenChange(false);\n      }\n    };\n\n    if (value === '') {\n      throw new Error(\n        'A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.'\n      );\n    }\n\n    return (\n      <SelectItemContextProvider\n        scope={__scopeSelect}\n        value={value}\n        disabled={disabled}\n        textId={textId}\n        isSelected={isSelected}\n        onItemTextChange={React.useCallback((node) => {\n          setTextValue((prevTextValue) => prevTextValue || (node?.textContent ?? '').trim());\n        }, [])}\n      >\n        <Collection.ItemSlot\n          scope={__scopeSelect}\n          value={value}\n          disabled={disabled}\n          textValue={textValue}\n        >\n          <Primitive.div\n            role=\"option\"\n            aria-labelledby={textId}\n            data-highlighted={isFocused ? '' : undefined}\n            // `isFocused` caveat fixes stuttering in VoiceOver\n            aria-selected={isSelected && isFocused}\n            data-state={isSelected ? 'checked' : 'unchecked'}\n            aria-disabled={disabled || undefined}\n            data-disabled={disabled ? '' : undefined}\n            tabIndex={disabled ? undefined : -1}\n            {...itemProps}\n            ref={composedRefs}\n            onFocus={composeEventHandlers(itemProps.onFocus, () => setIsFocused(true))}\n            onBlur={composeEventHandlers(itemProps.onBlur, () => setIsFocused(false))}\n            onClick={composeEventHandlers(itemProps.onClick, () => {\n              // Open on click when using a touch or pen device\n              if (pointerTypeRef.current !== 'mouse') handleSelect();\n            })}\n            onPointerUp={composeEventHandlers(itemProps.onPointerUp, () => {\n              // Using a mouse you should be able to do pointer down, move through\n              // the list, and release the pointer over the item to select it.\n              if (pointerTypeRef.current === 'mouse') handleSelect();\n            })}\n            onPointerDown={composeEventHandlers(itemProps.onPointerDown, (event) => {\n              pointerTypeRef.current = event.pointerType;\n            })}\n            onPointerMove={composeEventHandlers(itemProps.onPointerMove, (event) => {\n              // Remember pointer type when sliding over to this item from another one\n              pointerTypeRef.current = event.pointerType;\n              if (disabled) {\n                contentContext.onItemLeave?.();\n              } else if (pointerTypeRef.current === 'mouse') {\n                // even though safari doesn't support this option, it's acceptable\n                // as it only means it might scroll a few pixels when using the pointer.\n                event.currentTarget.focus({ preventScroll: true });\n              }\n            })}\n            onPointerLeave={composeEventHandlers(itemProps.onPointerLeave, (event) => {\n              if (event.currentTarget === document.activeElement) {\n                contentContext.onItemLeave?.();\n              }\n            })}\n            onKeyDown={composeEventHandlers(itemProps.onKeyDown, (event) => {\n              const isTypingAhead = contentContext.searchRef?.current !== '';\n              if (isTypingAhead && event.key === ' ') return;\n              if (SELECTION_KEYS.includes(event.key)) handleSelect();\n              // prevent page scroll if using the space key to select an item\n              if (event.key === ' ') event.preventDefault();\n            })}\n          />\n        </Collection.ItemSlot>\n      </SelectItemContextProvider>\n    );\n  }\n);\n\nSelectItem.displayName = ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectItemText\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_TEXT_NAME = 'SelectItemText';\n\ntype SelectItemTextElement = React.ComponentRef<typeof Primitive.span>;\ninterface SelectItemTextProps extends PrimitiveSpanProps {}\n\nconst SelectItemText = React.forwardRef<SelectItemTextElement, SelectItemTextProps>(\n  (props: ScopedProps<SelectItemTextProps>, forwardedRef) => {\n    // We ignore `className` and `style` as this part shouldn't be styled.\n    const { __scopeSelect, className, style, ...itemTextProps } = props;\n    const context = useSelectContext(ITEM_TEXT_NAME, __scopeSelect);\n    const contentContext = useSelectContentContext(ITEM_TEXT_NAME, __scopeSelect);\n    const itemContext = useSelectItemContext(ITEM_TEXT_NAME, __scopeSelect);\n    const nativeOptionsContext = useSelectNativeOptionsContext(ITEM_TEXT_NAME, __scopeSelect);\n    const [itemTextNode, setItemTextNode] = React.useState<SelectItemTextElement | null>(null);\n    const composedRefs = useComposedRefs(\n      forwardedRef,\n      (node) => setItemTextNode(node),\n      itemContext.onItemTextChange,\n      (node) => contentContext.itemTextRefCallback?.(node, itemContext.value, itemContext.disabled)\n    );\n\n    const textContent = itemTextNode?.textContent;\n    const nativeOption = React.useMemo(\n      () => (\n        <option key={itemContext.value} value={itemContext.value} disabled={itemContext.disabled}>\n          {textContent}\n        </option>\n      ),\n      [itemContext.disabled, itemContext.value, textContent]\n    );\n\n    const { onNativeOptionAdd, onNativeOptionRemove } = nativeOptionsContext;\n    useLayoutEffect(() => {\n      onNativeOptionAdd(nativeOption);\n      return () => onNativeOptionRemove(nativeOption);\n    }, [onNativeOptionAdd, onNativeOptionRemove, nativeOption]);\n\n    return (\n      <>\n        <Primitive.span id={itemContext.textId} {...itemTextProps} ref={composedRefs} />\n\n        {/* Portal the select item text into the trigger value node */}\n        {itemContext.isSelected && context.valueNode && !context.valueNodeHasChildren\n          ? ReactDOM.createPortal(itemTextProps.children, context.valueNode)\n          : null}\n      </>\n    );\n  }\n);\n\nSelectItemText.displayName = ITEM_TEXT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectItemIndicator\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_INDICATOR_NAME = 'SelectItemIndicator';\n\ntype SelectItemIndicatorElement = React.ComponentRef<typeof Primitive.span>;\ninterface SelectItemIndicatorProps extends PrimitiveSpanProps {}\n\nconst SelectItemIndicator = React.forwardRef<SelectItemIndicatorElement, SelectItemIndicatorProps>(\n  (props: ScopedProps<SelectItemIndicatorProps>, forwardedRef) => {\n    const { __scopeSelect, ...itemIndicatorProps } = props;\n    const itemContext = useSelectItemContext(ITEM_INDICATOR_NAME, __scopeSelect);\n    return itemContext.isSelected ? (\n      <Primitive.span aria-hidden {...itemIndicatorProps} ref={forwardedRef} />\n    ) : null;\n  }\n);\n\nSelectItemIndicator.displayName = ITEM_INDICATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectScrollUpButton\n * -----------------------------------------------------------------------------------------------*/\n\nconst SCROLL_UP_BUTTON_NAME = 'SelectScrollUpButton';\n\ntype SelectScrollUpButtonElement = SelectScrollButtonImplElement;\ninterface SelectScrollUpButtonProps extends Omit<SelectScrollButtonImplProps, 'onAutoScroll'> {}\n\nconst SelectScrollUpButton = React.forwardRef<\n  SelectScrollUpButtonElement,\n  SelectScrollUpButtonProps\n>((props: ScopedProps<SelectScrollUpButtonProps>, forwardedRef) => {\n  const contentContext = useSelectContentContext(SCROLL_UP_BUTTON_NAME, props.__scopeSelect);\n  const viewportContext = useSelectViewportContext(SCROLL_UP_BUTTON_NAME, props.__scopeSelect);\n  const [canScrollUp, setCanScrollUp] = React.useState(false);\n  const composedRefs = useComposedRefs(forwardedRef, viewportContext.onScrollButtonChange);\n\n  useLayoutEffect(() => {\n    if (contentContext.viewport && contentContext.isPositioned) {\n      const viewport = contentContext.viewport;\n      function handleScroll() {\n        const canScrollUp = viewport.scrollTop > 0;\n        setCanScrollUp(canScrollUp);\n      }\n      handleScroll();\n      viewport.addEventListener('scroll', handleScroll);\n      return () => viewport.removeEventListener('scroll', handleScroll);\n    }\n  }, [contentContext.viewport, contentContext.isPositioned]);\n\n  return canScrollUp ? (\n    <SelectScrollButtonImpl\n      {...props}\n      ref={composedRefs}\n      onAutoScroll={() => {\n        const { viewport, selectedItem } = contentContext;\n        if (viewport && selectedItem) {\n          viewport.scrollTop = viewport.scrollTop - selectedItem.offsetHeight;\n        }\n      }}\n    />\n  ) : null;\n});\n\nSelectScrollUpButton.displayName = SCROLL_UP_BUTTON_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectScrollDownButton\n * -----------------------------------------------------------------------------------------------*/\n\nconst SCROLL_DOWN_BUTTON_NAME = 'SelectScrollDownButton';\n\ntype SelectScrollDownButtonElement = SelectScrollButtonImplElement;\ninterface SelectScrollDownButtonProps extends Omit<SelectScrollButtonImplProps, 'onAutoScroll'> {}\n\nconst SelectScrollDownButton = React.forwardRef<\n  SelectScrollDownButtonElement,\n  SelectScrollDownButtonProps\n>((props: ScopedProps<SelectScrollDownButtonProps>, forwardedRef) => {\n  const contentContext = useSelectContentContext(SCROLL_DOWN_BUTTON_NAME, props.__scopeSelect);\n  const viewportContext = useSelectViewportContext(SCROLL_DOWN_BUTTON_NAME, props.__scopeSelect);\n  const [canScrollDown, setCanScrollDown] = React.useState(false);\n  const composedRefs = useComposedRefs(forwardedRef, viewportContext.onScrollButtonChange);\n\n  useLayoutEffect(() => {\n    if (contentContext.viewport && contentContext.isPositioned) {\n      const viewport = contentContext.viewport;\n      function handleScroll() {\n        const maxScroll = viewport.scrollHeight - viewport.clientHeight;\n        // we use Math.ceil here because if the UI is zoomed-in\n        // `scrollTop` is not always reported as an integer\n        const canScrollDown = Math.ceil(viewport.scrollTop) < maxScroll;\n        setCanScrollDown(canScrollDown);\n      }\n      handleScroll();\n      viewport.addEventListener('scroll', handleScroll);\n      return () => viewport.removeEventListener('scroll', handleScroll);\n    }\n  }, [contentContext.viewport, contentContext.isPositioned]);\n\n  return canScrollDown ? (\n    <SelectScrollButtonImpl\n      {...props}\n      ref={composedRefs}\n      onAutoScroll={() => {\n        const { viewport, selectedItem } = contentContext;\n        if (viewport && selectedItem) {\n          viewport.scrollTop = viewport.scrollTop + selectedItem.offsetHeight;\n        }\n      }}\n    />\n  ) : null;\n});\n\nSelectScrollDownButton.displayName = SCROLL_DOWN_BUTTON_NAME;\n\ntype SelectScrollButtonImplElement = React.ComponentRef<typeof Primitive.div>;\ninterface SelectScrollButtonImplProps extends PrimitiveDivProps {\n  onAutoScroll(): void;\n}\n\nconst SelectScrollButtonImpl = React.forwardRef<\n  SelectScrollButtonImplElement,\n  SelectScrollButtonImplProps\n>((props: ScopedProps<SelectScrollButtonImplProps>, forwardedRef) => {\n  const { __scopeSelect, onAutoScroll, ...scrollIndicatorProps } = props;\n  const contentContext = useSelectContentContext('SelectScrollButton', __scopeSelect);\n  const autoScrollTimerRef = React.useRef<number | null>(null);\n  const getItems = useCollection(__scopeSelect);\n\n  const clearAutoScrollTimer = React.useCallback(() => {\n    if (autoScrollTimerRef.current !== null) {\n      window.clearInterval(autoScrollTimerRef.current);\n      autoScrollTimerRef.current = null;\n    }\n  }, []);\n\n  React.useEffect(() => {\n    return () => clearAutoScrollTimer();\n  }, [clearAutoScrollTimer]);\n\n  // When the viewport becomes scrollable on either side, the relevant scroll button will mount.\n  // Because it is part of the normal flow, it will push down (top button) or shrink (bottom button)\n  // the viewport, potentially causing the active item to now be partially out of view.\n  // We re-run the `scrollIntoView` logic to make sure it stays within the viewport.\n  useLayoutEffect(() => {\n    const activeItem = getItems().find((item) => item.ref.current === document.activeElement);\n    activeItem?.ref.current?.scrollIntoView({ block: 'nearest' });\n  }, [getItems]);\n\n  return (\n    <Primitive.div\n      aria-hidden\n      {...scrollIndicatorProps}\n      ref={forwardedRef}\n      style={{ flexShrink: 0, ...scrollIndicatorProps.style }}\n      onPointerDown={composeEventHandlers(scrollIndicatorProps.onPointerDown, () => {\n        if (autoScrollTimerRef.current === null) {\n          autoScrollTimerRef.current = window.setInterval(onAutoScroll, 50);\n        }\n      })}\n      onPointerMove={composeEventHandlers(scrollIndicatorProps.onPointerMove, () => {\n        contentContext.onItemLeave?.();\n        if (autoScrollTimerRef.current === null) {\n          autoScrollTimerRef.current = window.setInterval(onAutoScroll, 50);\n        }\n      })}\n      onPointerLeave={composeEventHandlers(scrollIndicatorProps.onPointerLeave, () => {\n        clearAutoScrollTimer();\n      })}\n    />\n  );\n});\n\n/* -------------------------------------------------------------------------------------------------\n * SelectSeparator\n * -----------------------------------------------------------------------------------------------*/\n\nconst SEPARATOR_NAME = 'SelectSeparator';\n\ntype SelectSeparatorElement = React.ComponentRef<typeof Primitive.div>;\ninterface SelectSeparatorProps extends PrimitiveDivProps {}\n\nconst SelectSeparator = React.forwardRef<SelectSeparatorElement, SelectSeparatorProps>(\n  (props: ScopedProps<SelectSeparatorProps>, forwardedRef) => {\n    const { __scopeSelect, ...separatorProps } = props;\n    return <Primitive.div aria-hidden {...separatorProps} ref={forwardedRef} />;\n  }\n);\n\nSelectSeparator.displayName = SEPARATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'SelectArrow';\n\ntype SelectArrowElement = React.ComponentRef<typeof PopperPrimitive.Arrow>;\ntype PopperArrowProps = React.ComponentPropsWithoutRef<typeof PopperPrimitive.Arrow>;\ninterface SelectArrowProps extends PopperArrowProps {}\n\nconst SelectArrow = React.forwardRef<SelectArrowElement, SelectArrowProps>(\n  (props: ScopedProps<SelectArrowProps>, forwardedRef) => {\n    const { __scopeSelect, ...arrowProps } = props;\n    const popperScope = usePopperScope(__scopeSelect);\n    const context = useSelectContext(ARROW_NAME, __scopeSelect);\n    const contentContext = useSelectContentContext(ARROW_NAME, __scopeSelect);\n    return context.open && contentContext.position === 'popper' ? (\n      <PopperPrimitive.Arrow {...popperScope} {...arrowProps} ref={forwardedRef} />\n    ) : null;\n  }\n);\n\nSelectArrow.displayName = ARROW_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SelectBubbleInput\n * -----------------------------------------------------------------------------------------------*/\n\nconst BUBBLE_INPUT_NAME = 'SelectBubbleInput';\n\ntype InputProps = React.ComponentPropsWithoutRef<typeof Primitive.select>;\ninterface SwitchBubbleInputProps extends InputProps {}\n\nconst SelectBubbleInput = React.forwardRef<HTMLSelectElement, SwitchBubbleInputProps>(\n  ({ __scopeSelect, value, ...props }: ScopedProps<SwitchBubbleInputProps>, forwardedRef) => {\n    const ref = React.useRef<HTMLSelectElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    const prevValue = usePrevious(value);\n\n    // Bubble value change to parents (e.g form change event)\n    React.useEffect(() => {\n      const select = ref.current;\n      if (!select) return;\n\n      const selectProto = window.HTMLSelectElement.prototype;\n      const descriptor = Object.getOwnPropertyDescriptor(\n        selectProto,\n        'value'\n      ) as PropertyDescriptor;\n      const setValue = descriptor.set;\n      if (prevValue !== value && setValue) {\n        const event = new Event('change', { bubbles: true });\n        setValue.call(select, value);\n        select.dispatchEvent(event);\n      }\n    }, [prevValue, value]);\n\n    /**\n     * We purposefully use a `select` here to support form autofill as much as\n     * possible.\n     *\n     * We purposefully do not add the `value` attribute here to allow the value\n     * to be set programmatically and bubble to any parent form `onChange`\n     * event. Adding the `value` will cause React to consider the programmatic\n     * dispatch a duplicate and it will get swallowed.\n     *\n     * We use visually hidden styles rather than `display: \"none\"` because\n     * Safari autofill won't work otherwise.\n     */\n    return (\n      <Primitive.select\n        {...props}\n        style={{ ...VISUALLY_HIDDEN_STYLES, ...props.style }}\n        ref={composedRefs}\n        defaultValue={value}\n      />\n    );\n  }\n);\n\nSelectBubbleInput.displayName = BUBBLE_INPUT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction shouldShowPlaceholder(value?: string) {\n  return value === '' || value === undefined;\n}\n\nfunction useTypeaheadSearch(onSearchChange: (search: string) => void) {\n  const handleSearchChange = useCallbackRef(onSearchChange);\n  const searchRef = React.useRef('');\n  const timerRef = React.useRef(0);\n\n  const handleTypeaheadSearch = React.useCallback(\n    (key: string) => {\n      const search = searchRef.current + key;\n      handleSearchChange(search);\n\n      (function updateSearch(value: string) {\n        searchRef.current = value;\n        window.clearTimeout(timerRef.current);\n        // Reset `searchRef` 1 second after it was last updated\n        if (value !== '') timerRef.current = window.setTimeout(() => updateSearch(''), 1000);\n      })(search);\n    },\n    [handleSearchChange]\n  );\n\n  const resetTypeahead = React.useCallback(() => {\n    searchRef.current = '';\n    window.clearTimeout(timerRef.current);\n  }, []);\n\n  React.useEffect(() => {\n    return () => window.clearTimeout(timerRef.current);\n  }, []);\n\n  return [searchRef, handleTypeaheadSearch, resetTypeahead] as const;\n}\n\n/**\n * This is the \"meat\" of the typeahead matching logic. It takes in a list of items,\n * the search and the current item, and returns the next item (or `undefined`).\n *\n * We normalize the search because if a user has repeatedly pressed a character,\n * we want the exact same behavior as if we only had that one character\n * (ie. cycle through items starting with that character)\n *\n * We also reorder the items by wrapping the array around the current item.\n * This is so we always look forward from the current item, and picking the first\n * item will always be the correct one.\n *\n * Finally, if the normalized search is exactly one character, we exclude the\n * current item from the values because otherwise it would be the first to match always\n * and focus would never move. This is as opposed to the regular case, where we\n * don't want focus to move if the current item still matches.\n */\nfunction findNextItem<T extends { textValue: string }>(\n  items: T[],\n  search: string,\n  currentItem?: T\n) {\n  const isRepeated = search.length > 1 && Array.from(search).every((char) => char === search[0]);\n  const normalizedSearch = isRepeated ? search[0]! : search;\n  const currentItemIndex = currentItem ? items.indexOf(currentItem) : -1;\n  let wrappedItems = wrapArray(items, Math.max(currentItemIndex, 0));\n  const excludeCurrentItem = normalizedSearch.length === 1;\n  if (excludeCurrentItem) wrappedItems = wrappedItems.filter((v) => v !== currentItem);\n  const nextItem = wrappedItems.find((item) =>\n    item.textValue.toLowerCase().startsWith(normalizedSearch.toLowerCase())\n  );\n  return nextItem !== currentItem ? nextItem : undefined;\n}\n\n/**\n * Wraps an array around itself at a given start index\n * Example: `wrapArray(['a', 'b', 'c', 'd'], 2) === ['c', 'd', 'a', 'b']`\n */\nfunction wrapArray<T>(array: T[], startIndex: number) {\n  return array.map<T>((_, index) => array[(startIndex + index) % array.length]!);\n}\n\nconst Root = Select;\nconst Trigger = SelectTrigger;\nconst Value = SelectValue;\nconst Icon = SelectIcon;\nconst Portal = SelectPortal;\nconst Content = SelectContent;\nconst Viewport = SelectViewport;\nconst Group = SelectGroup;\nconst Label = SelectLabel;\nconst Item = SelectItem;\nconst ItemText = SelectItemText;\nconst ItemIndicator = SelectItemIndicator;\nconst ScrollUpButton = SelectScrollUpButton;\nconst ScrollDownButton = SelectScrollDownButton;\nconst Separator = SelectSeparator;\nconst Arrow = SelectArrow;\n\nexport {\n  createSelectScope,\n  //\n  Select,\n  SelectTrigger,\n  SelectValue,\n  SelectIcon,\n  SelectPortal,\n  SelectContent,\n  SelectViewport,\n  SelectGroup,\n  SelectLabel,\n  SelectItem,\n  SelectItemText,\n  SelectItemIndicator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n  SelectSeparator,\n  SelectArrow,\n  //\n  Root,\n  Trigger,\n  Value,\n  Icon,\n  Portal,\n  Content,\n  Viewport,\n  Group,\n  Label,\n  Item,\n  ItemText,\n  ItemIndicator,\n  ScrollUpButton,\n  ScrollDownButton,\n  Separator,\n  Arrow,\n};\nexport type {\n  SelectProps,\n  SelectTriggerProps,\n  SelectValueProps,\n  SelectIconProps,\n  SelectPortalProps,\n  SelectContentProps,\n  SelectViewportProps,\n  SelectGroupProps,\n  SelectLabelProps,\n  SelectItemProps,\n  SelectItemTextProps,\n  SelectItemIndicatorProps,\n  SelectScrollUpButtonProps,\n  SelectScrollDownButtonProps,\n  SelectSeparatorProps,\n  SelectArrowProps,\n};\n", "function clamp(value: number, [min, max]: [number, number]): number {\n  return Math.min(max, Math.max(min, value));\n}\n\nexport { clamp };\n", "import * as React from 'react';\n\nfunction usePrevious<T>(value: T) {\n  const ref = React.useRef({ value, previous: value });\n\n  // We compare values before making an update to ensure that\n  // a change has been made. This ensures the previous value is\n  // persisted correctly between renders.\n  return React.useMemo(() => {\n    if (ref.current.value !== value) {\n      ref.current.previous = ref.current.value;\n      ref.current.value = value;\n    }\n    return ref.current.previous;\n  }, [value]);\n}\n\nexport { usePrevious };\n", "import {\n  BlockquoteIcon,\n  BoldIcon,\n  Button,\n  CheckIcon,\n  cn,\n  CodeIcon,\n  CommentIcon,\n  H1Icon,\n  H2Icon,\n  H3Icon,\n  ItalicIcon,\n  ListOrderedIcon,\n  ListUnorderedIcon,\n  QuestionMarkIcon,\n  RedoIcon,\n  SelectButton,\n  ShortcutTooltip,\n  SparklesIcon,\n  StrikethroughIcon,\n  TextIcon,\n  TooltipProvider,\n  UnderlineIcon,\n  UndoIcon,\n} from \"@liveblocks/react-ui/_private\";\nimport * as SelectPrimitive from \"@radix-ui/react-select\";\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\";\nimport type { Editor } from \"@tiptap/react\";\nimport type {\n  ComponentProps,\n  ComponentType,\n  KeyboardEvent,\n  ReactNode,\n} from \"react\";\nimport { forwardRef, useCallback, useContext, useMemo } from \"react\";\n\nimport { EditorProvider, useCurrentEditor } from \"../context\";\nimport type { AiExtensionStorage, ExtendedChainedCommands } from \"../types\";\nimport { FloatingToolbarContext, FloatingToolbarExternal } from \"./shared\";\n\nexport const BLOCK_SELECT_SIDE_OFFSET = 10;\nexport const FLOATING_ELEMENT_COLLISION_PADDING = 10;\n\nexport interface ToolbarSlotProps {\n  editor: Editor;\n}\n\nexport type ToolbarSlot = ReactNode | ComponentType<ToolbarSlotProps>;\n\nexport interface ToolbarProps extends Omit<ComponentProps<\"div\">, \"children\"> {\n  /**\n   * The Tiptap editor.\n   */\n  editor: Editor | null;\n\n  /**\n   * The content of the toolbar, overriding the default content.\n   * Use the `before` and `after` props if you want to keep and extend the default content.\n   */\n  children?: ToolbarSlot;\n\n  /**\n   * The content to display at the start of the toolbar.\n   */\n  before?: ToolbarSlot;\n\n  /**\n   * The content to display at the end of the toolbar.\n   */\n  after?: ToolbarSlot;\n}\n\nexport interface ToolbarButtonProps extends ComponentProps<\"button\"> {\n  /**\n   * The name of this button displayed in its tooltip.\n   */\n  name: string;\n\n  /**\n   * An optional icon displayed in this button.\n   */\n  icon?: ReactNode;\n\n  /**\n   * An optional keyboard shortcut displayed in this button's tooltip.\n   *\n   * @example\n   * \"Mod-Alt-B\"  \"B\" in Apple environments, \"B\" otherwise\n   * \"Ctrl-Shift-Escape\"  \"\"\n   * \"Space\"  \"\"\n   */\n  shortcut?: string;\n}\n\nexport interface ToolbarToggleProps extends ToolbarButtonProps {\n  /**\n   * Whether the button is toggled.\n   */\n  active: boolean;\n}\n\nexport interface ToolbarBlockSelectorItem {\n  /**\n   * The name of this block element, displayed as the label of this item.\n   */\n  name: string;\n\n  /**\n   * Optionally replace the name used as the label of this item by any content.\n   */\n  label?: ReactNode;\n\n  /**\n   * An optional icon displayed in this item.\n   */\n  icon?: ReactNode;\n\n  /**\n   * Whether this block element is currently active.\n   * Set to `\"default\"` to display this item when no other item is active.\n   */\n  isActive: ((editor: Editor) => boolean) | \"default\";\n\n  /**\n   * A callback invoked when this item is selected.\n   */\n  setActive: (editor: Editor) => void;\n}\n\nexport interface ToolbarBlockSelectorProps extends ComponentProps<\"button\"> {\n  /**\n   * The items displayed in this block selector.\n   * When provided as an array, the default items are overridden. To avoid this,\n   * a function can be provided instead and it will receive the default items.\n   *\n   * @example\n   * <Toolbar.BlockSelector\n   *   items={[\n   *     {\n   *       name: \"Text\",\n   *       isActive: \"default\",\n   *       setActive: () => { ... },\n   *     },\n   *     {\n   *       name: \"Heading 1\",\n   *       isActive: () => { ... },\n   *       setActive: () => { ... },\n   *     },\n   *   ]}\n   * />\n   *\n   * @example\n   * <Toolbar.BlockSelector\n   *   items={(defaultItems) => [\n   *     ...defaultItems,\n   *     {\n   *       name: \"Custom block\",\n   *       isActive: () => { ... },\n   *       setActive: () => { ... },\n   *     },\n   *   ]}\n   * />\n   */\n  items?:\n    | ToolbarBlockSelectorItem[]\n    | ((\n        defaultItems: ToolbarBlockSelectorItem[]\n      ) => ToolbarBlockSelectorItem[]);\n}\n\nexport type ToolbarSeparatorProps = ComponentProps<\"div\">;\n\nexport function applyToolbarSlot(\n  slot: ToolbarSlot,\n  props: ToolbarSlotProps\n): ReactNode {\n  if (typeof slot === \"function\") {\n    const Component = slot;\n\n    return <Component {...props} />;\n  }\n\n  return slot;\n}\n\nconst ToolbarButton = forwardRef<HTMLButtonElement, ToolbarButtonProps>(\n  ({ icon, children, name, shortcut, onKeyDown, ...props }, forwardedRef) => {\n    const floatingToolbarContext = useContext(FloatingToolbarContext);\n    const closeFloatingToolbar = floatingToolbarContext?.close;\n\n    const handleKeyDown = useCallback(\n      (event: KeyboardEvent<HTMLButtonElement>) => {\n        onKeyDown?.(event);\n\n        if (\n          !event.isDefaultPrevented() &&\n          closeFloatingToolbar &&\n          event.key === \"Escape\"\n        ) {\n          closeFloatingToolbar();\n          event.preventDefault();\n          event.stopPropagation();\n        }\n      },\n      [onKeyDown, closeFloatingToolbar]\n    );\n\n    return (\n      <ShortcutTooltip content={name} shortcut={shortcut}>\n        <Button\n          type=\"button\"\n          variant=\"toolbar\"\n          ref={forwardedRef}\n          icon={icon}\n          aria-label={!children ? name : undefined}\n          // Safari doesn't mark buttons as focusable, which breaks `relatedTarget`\n          // in focus/blur events. https://bugs.webkit.org/show_bug.cgi?id=254655\n          tabIndex={0}\n          {...props}\n          onKeyDown={handleKeyDown}\n        >\n          {!children && !icon ? name : children}\n        </Button>\n      </ShortcutTooltip>\n    );\n  }\n);\n\nconst ToolbarToggle = forwardRef<HTMLButtonElement, ToolbarToggleProps>(\n  ({ active, ...props }, forwardedRef) => {\n    return (\n      <TogglePrimitive.Root asChild pressed={active}>\n        <ToolbarButton ref={forwardedRef} {...props} />\n      </TogglePrimitive.Root>\n    );\n  }\n);\n\nfunction createDefaultBlockSelectorItems(\n  editor: Editor\n): ToolbarBlockSelectorItem[] {\n  const items: (ToolbarBlockSelectorItem | null)[] = [\n    {\n      name: \"Text\",\n      icon: <TextIcon />,\n      isActive: \"default\",\n      setActive: (editor) => editor.chain().focus().clearNodes().run(),\n    },\n    \"toggleHeading\" in editor.commands\n      ? {\n          name: \"Heading 1\",\n          icon: <H1Icon />,\n          isActive: (editor) => editor.isActive(\"heading\", { level: 1 }),\n          setActive: (editor) =>\n            (\n              editor.chain().focus().clearNodes() as ExtendedChainedCommands<\n                \"toggleHeading\",\n                [{ level: number }]\n              >\n            )\n              .toggleHeading({ level: 1 })\n              .run(),\n        }\n      : null,\n    \"toggleHeading\" in editor.commands\n      ? {\n          name: \"Heading 2\",\n          icon: <H2Icon />,\n          isActive: (editor) => editor.isActive(\"heading\", { level: 2 }),\n          setActive: (editor) =>\n            (\n              editor.chain().focus().clearNodes() as ExtendedChainedCommands<\n                \"toggleHeading\",\n                [{ level: number }]\n              >\n            )\n              .toggleHeading({ level: 2 })\n              .run(),\n        }\n      : null,\n    \"toggleHeading\" in editor.commands\n      ? {\n          name: \"Heading 3\",\n          icon: <H3Icon />,\n          isActive: (editor) => editor.isActive(\"heading\", { level: 3 }),\n          setActive: (editor) =>\n            (\n              editor.chain().focus().clearNodes() as ExtendedChainedCommands<\n                \"toggleHeading\",\n                [{ level: number }]\n              >\n            )\n              .toggleHeading({ level: 3 })\n              .run(),\n        }\n      : null,\n    \"toggleBulletList\" in editor.commands\n      ? {\n          name: \"Bullet list\",\n          icon: <ListUnorderedIcon />,\n          isActive: (editor) => editor.isActive(\"bulletList\"),\n          setActive: (editor) =>\n            (\n              editor\n                .chain()\n                .focus()\n                .clearNodes() as ExtendedChainedCommands<\"toggleBulletList\">\n            )\n              .toggleBulletList()\n              .run(),\n        }\n      : null,\n    \"toggleOrderedList\" in editor.commands\n      ? {\n          name: \"Numbered list\",\n          icon: <ListOrderedIcon />,\n          isActive: (editor) => editor.isActive(\"orderedList\"),\n          setActive: (editor) =>\n            (\n              editor\n                .chain()\n                .focus()\n                .clearNodes() as ExtendedChainedCommands<\"toggleOrderedList\">\n            )\n              .toggleOrderedList()\n              .run(),\n        }\n      : null,\n    \"toggleBlockquote\" in editor.commands\n      ? {\n          name: \"Blockquote\",\n          icon: <BlockquoteIcon />,\n          isActive: (editor) => editor.isActive(\"blockquote\"),\n          setActive: (editor) =>\n            (\n              editor\n                .chain()\n                .focus()\n                .clearNodes() as ExtendedChainedCommands<\"toggleBlockquote\">\n            )\n              .toggleBlockquote()\n              .run(),\n        }\n      : null,\n  ];\n\n  return items.filter(Boolean) as ToolbarBlockSelectorItem[];\n}\n\nconst ToolbarBlockSelector = forwardRef<\n  HTMLButtonElement,\n  ToolbarBlockSelectorProps\n>(({ items, onKeyDown, ...props }, forwardedRef) => {\n  const floatingToolbarContext = useContext(FloatingToolbarContext);\n  const closeFloatingToolbar = floatingToolbarContext?.close;\n  const editor = useCurrentEditor(\n    \"BlockSelector\",\n    \"Toolbar or FloatingToolbar\"\n  );\n  const resolvedItems = useMemo(() => {\n    if (Array.isArray(items)) {\n      return items;\n    }\n\n    const defaultItems = createDefaultBlockSelectorItems(editor);\n\n    return items ? items(defaultItems) : defaultItems;\n  }, [editor, items]);\n  let defaultItem: ToolbarBlockSelectorItem | undefined;\n  let activeItem = editor.isInitialized\n    ? resolvedItems.find((item) => {\n        if (item.isActive === \"default\") {\n          defaultItem = item;\n          return false;\n        }\n\n        return item.isActive(editor);\n      })\n    : undefined;\n\n  if (!activeItem) {\n    activeItem = defaultItem;\n  }\n\n  const handleItemChange = (name: string) => {\n    const item = resolvedItems.find((item) => item.name === name);\n\n    if (item) {\n      item.setActive(editor);\n\n      // If present in a floating toolbar, close it on change\n      floatingToolbarContext?.close();\n    }\n  };\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent<HTMLButtonElement>) => {\n      onKeyDown?.(event);\n\n      if (\n        !event.isDefaultPrevented() &&\n        closeFloatingToolbar &&\n        event.key === \"Escape\"\n      ) {\n        closeFloatingToolbar();\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    },\n    [onKeyDown, closeFloatingToolbar]\n  );\n\n  return (\n    <SelectPrimitive.Root\n      value={activeItem?.name}\n      onValueChange={handleItemChange}\n    >\n      <ShortcutTooltip content=\"Turn into\">\n        <SelectPrimitive.Trigger\n          asChild\n          {...props}\n          ref={forwardedRef}\n          onKeyDown={handleKeyDown}\n          disabled={resolvedItems.length === 0}\n        >\n          <SelectButton variant=\"toolbar\">\n            {activeItem?.name ?? \"Turn into\"}\n          </SelectButton>\n        </SelectPrimitive.Trigger>\n      </ShortcutTooltip>\n      <SelectPrimitive.Portal>\n        <FloatingToolbarExternal>\n          <SelectPrimitive.Content\n            position=\"popper\"\n            sideOffset={BLOCK_SELECT_SIDE_OFFSET}\n            collisionPadding={FLOATING_ELEMENT_COLLISION_PADDING}\n            className=\"lb-root lb-portal lb-elevation lb-dropdown lb-select-dropdown lb-tiptap-block-selector-dropdown\"\n          >\n            {resolvedItems.map((item) => (\n              <SelectPrimitive.Item\n                key={item.name}\n                value={item.name}\n                className=\"lb-dropdown-item\"\n                data-name={item.name}\n              >\n                {item.icon ? (\n                  <span className=\"lb-dropdown-item-icon lb-icon-container\">\n                    {item.icon}\n                  </span>\n                ) : null}\n                <span className=\"lb-dropdown-item-label\">\n                  {item.label ?? item.name}\n                </span>\n                {item.name === activeItem?.name ? (\n                  <span className=\"lb-dropdown-item-accessory lb-icon-container\">\n                    <CheckIcon />\n                  </span>\n                ) : null}\n              </SelectPrimitive.Item>\n            ))}\n          </SelectPrimitive.Content>\n        </FloatingToolbarExternal>\n      </SelectPrimitive.Portal>\n    </SelectPrimitive.Root>\n  );\n});\n\nconst ToolbarSeparator = forwardRef<HTMLDivElement, ToolbarSeparatorProps>(\n  ({ className, ...props }, forwardedRef) => {\n    return (\n      <div\n        ref={forwardedRef}\n        role=\"separator\"\n        aria-orientation=\"vertical\"\n        className={cn(\"lb-tiptap-toolbar-separator\", className)}\n        {...props}\n      />\n    );\n  }\n);\n\nfunction ToolbarSectionHistory() {\n  const editor = useCurrentEditor(\n    \"SectionHistory\",\n    \"Toolbar or FloatingToolbar\"\n  );\n\n  return (\n    <>\n      <ToolbarButton\n        name=\"Undo\"\n        icon={<UndoIcon />}\n        shortcut=\"Mod-Z\"\n        onClick={() => editor.chain().focus().undo().run()}\n        disabled={!editor.can().chain().focus().undo().run()}\n      />\n      <ToolbarButton\n        name=\"Redo\"\n        icon={<RedoIcon />}\n        shortcut=\"Mod-Shift-Z\"\n        onClick={() => editor.chain().focus().redo().run()}\n        disabled={!editor.can().chain().focus().redo().run()}\n      />\n    </>\n  );\n}\n\nfunction ToolbarSectionInline() {\n  const editor = useCurrentEditor(\n    \"SectionInline\",\n    \"Toolbar or FloatingToolbar\"\n  );\n  const supportsBold = \"toggleBold\" in editor.commands;\n  const supportsItalic = \"toggleItalic\" in editor.commands;\n  const supportsUnderline = \"toggleUnderline\" in editor.commands;\n  const supportsStrike = \"toggleStrike\" in editor.commands;\n  const supportsCode = \"toggleCode\" in editor.commands;\n\n  return (\n    <>\n      {supportsBold && (\n        <ToolbarToggle\n          name=\"Bold\"\n          icon={<BoldIcon />}\n          shortcut=\"Mod-B\"\n          onClick={() =>\n            (editor.chain().focus() as ExtendedChainedCommands<\"toggleBold\">)\n              .toggleBold()\n              .run()\n          }\n          disabled={\n            !(\n              editor\n                .can()\n                .chain()\n                .focus() as ExtendedChainedCommands<\"toggleBold\">\n            )\n              .toggleBold()\n              .run()\n          }\n          active={editor.isActive(\"bold\")}\n        />\n      )}\n      {supportsItalic && (\n        <ToolbarToggle\n          name=\"Italic\"\n          icon={<ItalicIcon />}\n          shortcut=\"Mod-I\"\n          onClick={() =>\n            (editor.chain().focus() as ExtendedChainedCommands<\"toggleItalic\">)\n              .toggleItalic()\n              .run()\n          }\n          disabled={\n            !(\n              editor\n                .can()\n                .chain()\n                .focus() as ExtendedChainedCommands<\"toggleItalic\">\n            )\n              .toggleItalic()\n              .run()\n          }\n          active={editor.isActive(\"italic\")}\n        />\n      )}\n      {supportsUnderline && (\n        <ToolbarToggle\n          name=\"Underline\"\n          icon={<UnderlineIcon />}\n          shortcut=\"Mod-U\"\n          onClick={() =>\n            (\n              editor\n                .chain()\n                .focus() as ExtendedChainedCommands<\"toggleUnderline\">\n            )\n              .toggleUnderline()\n              .run()\n          }\n          disabled={\n            !(\n              editor\n                .can()\n                .chain()\n                .focus() as ExtendedChainedCommands<\"toggleUnderline\">\n            )\n              .toggleUnderline()\n              .run()\n          }\n          active={editor.isActive(\"underline\")}\n        />\n      )}\n      {supportsStrike && (\n        <ToolbarToggle\n          name=\"Strikethrough\"\n          icon={<StrikethroughIcon />}\n          shortcut=\"Mod-U\"\n          onClick={() =>\n            (editor.chain().focus() as ExtendedChainedCommands<\"toggleStrike\">)\n              .toggleStrike()\n              .run()\n          }\n          disabled={\n            !(\n              editor\n                .can()\n                .chain()\n                .focus() as ExtendedChainedCommands<\"toggleStrike\">\n            )\n              .toggleStrike()\n              .run()\n          }\n          active={editor.isActive(\"strike\")}\n        />\n      )}\n      {supportsCode && (\n        <ToolbarToggle\n          name=\"Inline code\"\n          icon={<CodeIcon />}\n          shortcut=\"Mod-E\"\n          onClick={() =>\n            (editor.chain().focus() as ExtendedChainedCommands<\"toggleCode\">)\n              .toggleCode()\n              .run()\n          }\n          disabled={\n            !(\n              editor\n                .can()\n                .chain()\n                .focus() as ExtendedChainedCommands<\"toggleCode\">\n            )\n              .toggleCode()\n              .run()\n          }\n          active={editor.isActive(\"code\")}\n        />\n      )}\n    </>\n  );\n}\n\nfunction ToolbarSectionCollaboration() {\n  const editor = useCurrentEditor(\n    \"SectionCollaboration\",\n    \"Toolbar or FloatingToolbar\"\n  );\n  const supportsThread = \"addPendingComment\" in editor.commands;\n\n  return (\n    <>\n      {supportsThread && (\n        <ToolbarButton\n          name=\"Add a comment\"\n          icon={<CommentIcon />}\n          onClick={() =>\n            (\n              editor\n                .chain()\n                .focus() as ExtendedChainedCommands<\"addPendingComment\">\n            )\n              .addPendingComment()\n              .run()\n          }\n        >\n          Comment\n        </ToolbarButton>\n      )}\n    </>\n  );\n}\n\nfunction ToolbarSectionAi() {\n  const editor = useCurrentEditor(\"SectionAi\", \"Toolbar or FloatingToolbar\");\n  const supportsAi = \"askAi\" in editor.commands;\n  const aiName = (editor.storage.liveblocksAi as AiExtensionStorage | undefined)\n    ?.name;\n\n  return (\n    <>\n      {supportsAi && (\n        <>\n          <ToolbarButton\n            name={`Ask ${aiName} anything`}\n            icon={<SparklesIcon />}\n            onClick={() =>\n              (\n                editor.chain().focus() as ExtendedChainedCommands<\"askAi\">\n              ).askAi()\n            }\n          >\n            Ask {aiName}\n          </ToolbarButton>\n          <ToolbarButton\n            name=\"Explain\"\n            icon={<QuestionMarkIcon />}\n            onClick={() =>\n              (\n                editor.chain().focus() as ExtendedChainedCommands<\"askAi\">\n              ).askAi(\"Explain what the text is about\")\n            }\n          >\n            Explain\n          </ToolbarButton>\n        </>\n      )}\n    </>\n  );\n}\n\nfunction DefaultToolbarContent({ editor }: ToolbarSlotProps) {\n  const supportsThread = \"addPendingComment\" in editor.commands;\n  const supportsAi = \"askAi\" in editor.commands;\n\n  return (\n    <>\n      <ToolbarSectionHistory />\n      <ToolbarSeparator />\n      {supportsAi ? (\n        <>\n          <ToolbarSectionAi />\n          <ToolbarSeparator />\n        </>\n      ) : null}\n      <ToolbarBlockSelector />\n      <ToolbarSectionInline />\n      {supportsThread ? (\n        <>\n          <ToolbarSeparator />\n          <ToolbarSectionCollaboration />\n        </>\n      ) : null}\n    </>\n  );\n}\n\n/**\n * A static toolbar containing actions and values related to the editor.\n *\n * @example\n * <Toolbar editor={editor} />\n *\n * @example\n * <Toolbar editor={editor}>\n *   <Toolbar.BlockSelector />\n *   <Toolbar.Separator />\n *   <Toolbar.SectionInline />\n *   <Toolbar.Separator />\n *   <Toolbar.Button name=\"Custom action\" onClick={() => { ... }} icon={<Icon.QuestionMark />} />\n * </Toolbar>\n */\nexport const Toolbar = Object.assign(\n  forwardRef<HTMLDivElement, ToolbarProps>(\n    (\n      {\n        before,\n        after,\n        children = DefaultToolbarContent,\n        editor,\n        className,\n        ...props\n      },\n      forwardedRef\n    ) => {\n      if (!editor) {\n        return null;\n      }\n\n      const slotProps: ToolbarSlotProps = { editor };\n\n      return (\n        <TooltipProvider>\n          <EditorProvider editor={editor}>\n            <div\n              ref={forwardedRef}\n              role=\"toolbar\"\n              aria-label=\"Toolbar\"\n              aria-orientation=\"horizontal\"\n              className={cn(\"lb-root lb-tiptap-toolbar\", className)}\n              {...props}\n            >\n              {applyToolbarSlot(before, slotProps)}\n              {applyToolbarSlot(children, slotProps)}\n              {applyToolbarSlot(after, slotProps)}\n            </div>\n          </EditorProvider>\n        </TooltipProvider>\n      );\n    }\n  ),\n  {\n    /**\n     * A button for triggering actions.\n     *\n     * @example\n     * <Toolbar.Button name=\"Comment\" shortcut=\"Mod-Shift-E\" onClick={() => { ... }} />\n     *\n     * @example\n     * <Toolbar.Button name=\"Mention someone\" icon={<Icon.Mention />} onClick={() => { ... }} />\n     */\n    Button: ToolbarButton,\n\n    /**\n     * A toggle button for values that can be active or inactive.\n     *\n     * @example\n     * <Toolbar.Toggle name=\"Bold\" active={isBold} />\n     *\n     * @example\n     * <Toolbar.Toggle name=\"Italic\" icon={<Icon.Italic />} shortcut=\"Mod-I\" active={isItalic} onClick={() => { ... }} />\n     */\n    Toggle: ToolbarToggle,\n\n    /**\n     * A dropdown selector to switch between different block types.\n     *\n     * @example\n     * <Toolbar.BlockSelector />\n     */\n    BlockSelector: ToolbarBlockSelector,\n\n    /**\n     * A visual (and accessible) separator to separate sections in a toolbar.\n     */\n    Separator: ToolbarSeparator,\n\n    /**\n     * A section containing history actions. (e.g. undo, redo)\n     */\n    SectionHistory: ToolbarSectionHistory,\n\n    /**\n     * A section containing inline formatting actions. (e.g. bold, italic, underline, ...)\n     */\n    SectionInline: ToolbarSectionInline,\n\n    /**\n     * A section containing collaborative actions. (e.g. adding a comment)\n     */\n    SectionCollaboration: ToolbarSectionCollaboration,\n\n    /**\n     * A section containing AI actions. (e.g. opening the AI toolbar)\n     */\n    SectionAi: ToolbarSectionAi,\n  }\n);\n", "import {\n  autoUpdate,\n  type DetectOverflowOptions,\n  flip,\n  hide,\n  inline,\n  limitShift,\n  offset,\n  shift,\n  size,\n  useFloating,\n  type UseFloatingOptions,\n} from \"@floating-ui/react-dom\";\nimport { useLayoutEffect } from \"@liveblocks/react/_private\";\nimport {\n  cn,\n  TooltipProvider,\n  useInitial,\n  useRefs,\n} from \"@liveblocks/react-ui/_private\";\nimport { type Editor, isTextSelection, useEditorState } from \"@tiptap/react\";\nimport type {\n  ComponentProps,\n  FocusEvent as ReactFocusEvent,\n  PointerEvent as ReactPointerEvent,\n} from \"react\";\nimport {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { EditorProvider } from \"../context\";\nimport type { FloatingPosition } from \"../types\";\nimport { FloatingToolbarContext, FloatingToolbarExternal } from \"./shared\";\nimport {\n  applyToolbarSlot,\n  Toolbar,\n  type ToolbarSlot,\n  type ToolbarSlotProps,\n} from \"./Toolbar\";\n\nexport interface FloatingToolbarProps\n  extends Omit<ComponentProps<\"div\">, \"children\"> {\n  /**\n   * The Tiptap editor.\n   */\n  editor: Editor | null;\n\n  /**\n   * The vertical position of the floating toolbar.\n   */\n  position?: FloatingPosition;\n\n  /**\n   * The vertical offset of the floating toolbar from the selection.\n   */\n  offset?: number;\n\n  /**\n   * The content of the floating toolbar, overriding the default content.\n   * Use the `before` and `after` props if you want to keep and extend the default content.\n   */\n  children?: ToolbarSlot;\n\n  /**\n   * The content to display at the start of the floating toolbar.\n   */\n  before?: ToolbarSlot;\n\n  /**\n   * The content to display at the end of the floating toolbar.\n   */\n  after?: ToolbarSlot;\n}\n\nexport const FLOATING_TOOLBAR_COLLISION_PADDING = 10;\nconst FLOATING_TOOLBAR_OPEN_DELAY = 50;\n\nfunction DefaultFloatingToolbarContent({ editor }: ToolbarSlotProps) {\n  const supportsThread = \"addPendingComment\" in editor.commands;\n  const supportsAi = \"askAi\" in editor.commands;\n\n  return (\n    <>\n      {supportsAi ? (\n        <>\n          <Toolbar.SectionAi />\n          <Toolbar.Separator />\n        </>\n      ) : null}\n      <Toolbar.BlockSelector />\n      <Toolbar.SectionInline />\n      {supportsThread ? (\n        <>\n          <Toolbar.Separator />\n          <Toolbar.SectionCollaboration />\n        </>\n      ) : null}\n    </>\n  );\n}\n\n/**\n * A floating toolbar attached to the selection and containing actions and values related to the editor.\n *\n * @example\n * <FloatingToolbar editor={editor} />\n *\n * @example\n * <FloatingToolbar editor={editor}>\n *   <Toolbar.BlockSelector />\n *   <Toolbar.Separator />\n *   <Toolbar.SectionInline />\n *   <Toolbar.Separator />\n *   <Toolbar.Button name=\"Custom action\" onClick={() => { ... }} icon={<Icon.QuestionMark />} />\n * </FloatingToolbar>\n */\nexport const FloatingToolbar = Object.assign(\n  forwardRef<HTMLDivElement, FloatingToolbarProps>(\n    (\n      {\n        children = DefaultFloatingToolbarContent,\n        before,\n        after,\n        position = \"top\",\n        offset: sideOffset = 6,\n        editor,\n        onPointerDown,\n        onFocus,\n        onBlur,\n        className,\n        ...props\n      },\n      forwardedRef\n    ) => {\n      const toolbarRef = useRef<HTMLDivElement>(null);\n      const externalIds = useInitial<Set<string>>(() => new Set());\n      const [isPointerDown, setPointerDown] = useState(false);\n      const [isFocused, setFocused] = useState(false);\n      const [isManuallyClosed, setManuallyClosed] = useState(false);\n      const hasSelectionRange =\n        useEditorState({\n          editor,\n          equalityFn: Object.is,\n          selector: (ctx) => {\n            const editor = ctx.editor;\n\n            if (!editor) {\n              return false;\n            }\n\n            const { doc, selection } = editor.state;\n            const { empty, ranges } = selection;\n            const from = Math.min(...ranges.map((range) => range.$from.pos));\n            const to = Math.max(...ranges.map((range) => range.$to.pos));\n\n            if (empty) {\n              return false;\n            }\n\n            return (\n              isTextSelection(selection) && doc.textBetween(from, to).length > 0\n            );\n          },\n        }) ?? false;\n\n      const isOpen =\n        isFocused && !isPointerDown && hasSelectionRange && !isManuallyClosed;\n      const [delayedIsOpen, setDelayedIsOpen] = useState(isOpen);\n      const delayedIsOpenTimeoutRef = useRef<number>();\n\n      // Reset the manually closed state when there's another change\n      useEffect(() => {\n        if (!editor) {\n          return;\n        }\n\n        setManuallyClosed(false);\n\n        const handleSelectionChange = () => {\n          setManuallyClosed(false);\n        };\n\n        editor.on(\"selectionUpdate\", handleSelectionChange);\n\n        return () => {\n          editor.off(\"selectionUpdate\", handleSelectionChange);\n        };\n      }, [isFocused, hasSelectionRange, editor]);\n\n      // Don't close when the focus moves from the editor to the toolbar\n      useEffect(() => {\n        if (!editor) {\n          return;\n        }\n\n        const handleFocus = () => {\n          setFocused(true);\n        };\n\n        const handleBlur = (event: FocusEvent) => {\n          if (\n            event.relatedTarget &&\n            toolbarRef.current?.contains(event.relatedTarget as Node)\n          ) {\n            return;\n          }\n\n          if (event.relatedTarget === editor.view.dom) {\n            return;\n          }\n\n          for (const externalId of externalIds) {\n            if (\n              document\n                .getElementById(externalId)\n                ?.contains(event.relatedTarget as Node)\n            ) {\n              return;\n            }\n          }\n\n          setFocused(false);\n        };\n\n        editor.view.dom.addEventListener(\"focus\", handleFocus);\n        editor.view.dom.addEventListener(\"blur\", handleBlur);\n\n        return () => {\n          editor.view.dom.removeEventListener(\"focus\", handleFocus);\n          editor.view.dom.removeEventListener(\"blur\", handleBlur);\n        };\n      }, [editor, externalIds]);\n\n      const handleFocus = useCallback(\n        (event: ReactFocusEvent<HTMLDivElement>) => {\n          onFocus?.(event);\n\n          if (!event.isDefaultPrevented()) {\n            setFocused(true);\n          }\n        },\n        [onFocus]\n      );\n\n      // Close the toolbar when the it loses focus to something else than the editor\n      const handleBlur = useCallback(\n        (event: ReactFocusEvent<HTMLDivElement>) => {\n          onBlur?.(event);\n\n          if (!event.isDefaultPrevented()) {\n            if (\n              event.relatedTarget &&\n              toolbarRef.current?.contains(event.relatedTarget as Node)\n            ) {\n              return;\n            }\n\n            if (event.relatedTarget === editor?.view.dom) {\n              return;\n            }\n\n            for (const externalId of externalIds) {\n              if (\n                document\n                  .getElementById(externalId)\n                  ?.contains(event.relatedTarget as Node)\n              ) {\n                return;\n              }\n            }\n\n            setFocused(false);\n          }\n        },\n        [onBlur, editor, externalIds]\n      );\n\n      // Delay the opening of the toolbar to avoid flickering issues\n      useEffect(() => {\n        if (isOpen) {\n          delayedIsOpenTimeoutRef.current = window.setTimeout(() => {\n            setDelayedIsOpen(true);\n          }, FLOATING_TOOLBAR_OPEN_DELAY);\n        } else {\n          setDelayedIsOpen(false);\n        }\n\n        return () => {\n          window.clearTimeout(delayedIsOpenTimeoutRef.current);\n        };\n      }, [isOpen]);\n\n      const floatingOptions: UseFloatingOptions = useMemo(() => {\n        const detectOverflowOptions: DetectOverflowOptions = {\n          padding: FLOATING_TOOLBAR_COLLISION_PADDING,\n        };\n\n        return {\n          strategy: \"fixed\",\n          placement: position,\n          middleware: [\n            inline(detectOverflowOptions),\n            flip({ ...detectOverflowOptions, crossAxis: false }),\n            hide(detectOverflowOptions),\n            shift({\n              ...detectOverflowOptions,\n              limiter: limitShift(),\n            }),\n            offset(sideOffset),\n            size(detectOverflowOptions),\n          ],\n          whileElementsMounted: (...args) => {\n            return autoUpdate(...args, {\n              animationFrame: true,\n            });\n          },\n        };\n      }, [position, sideOffset]);\n      const {\n        refs: { setReference, setFloating },\n        strategy,\n        x,\n        y,\n        isPositioned,\n      } = useFloating({\n        ...floatingOptions,\n        open: delayedIsOpen,\n      });\n      const mergedRefs = useRefs(forwardedRef, toolbarRef, setFloating);\n\n      const handlePointerDown = useCallback(\n        (event: ReactPointerEvent<HTMLDivElement>) => {\n          onPointerDown?.(event);\n\n          event.stopPropagation();\n\n          // Prevent the toolbar from closing when clicking on the toolbar itself\n          if (event.target === toolbarRef.current) {\n            event.preventDefault();\n          }\n        },\n        [onPointerDown]\n      );\n\n      useEffect(() => {\n        if (!editor) {\n          return;\n        }\n\n        const handlePointerDown = () => {\n          setPointerDown(true);\n        };\n        const handlePointerUp = () => {\n          setPointerDown(false);\n        };\n\n        editor.view.dom.addEventListener(\"pointerdown\", handlePointerDown);\n        document.addEventListener(\"pointercancel\", handlePointerUp);\n        document.addEventListener(\"pointerup\", handlePointerUp);\n\n        return () => {\n          editor.view.dom.removeEventListener(\"pointerdown\", handlePointerDown);\n          document.removeEventListener(\"pointercancel\", handlePointerUp);\n          document.removeEventListener(\"pointerup\", handlePointerUp);\n        };\n      }, [editor]);\n\n      useLayoutEffect(() => {\n        if (!editor || !delayedIsOpen) {\n          return;\n        }\n\n        const updateSelectionReference = () => {\n          const domSelection = window.getSelection();\n\n          if (\n            editor.state.selection.empty ||\n            !domSelection ||\n            !domSelection.rangeCount\n          ) {\n            setReference(null);\n          } else {\n            const domRange = domSelection.getRangeAt(0);\n\n            setReference(domRange);\n          }\n        };\n\n        editor.on(\"transaction\", updateSelectionReference);\n        updateSelectionReference();\n\n        return () => {\n          editor.off(\"transaction\", updateSelectionReference);\n        };\n      }, [editor, delayedIsOpen, setReference]);\n\n      useEffect(() => {\n        if (!editor || !delayedIsOpen) {\n          return;\n        }\n\n        const handleKeyDown = (event: KeyboardEvent) => {\n          if (event.target !== editor.view.dom && event.defaultPrevented) {\n            return;\n          }\n\n          if (event.key === \"Escape\") {\n            event.preventDefault();\n            event.stopPropagation();\n\n            editor.commands.focus();\n            setManuallyClosed(true);\n          }\n        };\n\n        editor.view.dom.addEventListener(\"keydown\", handleKeyDown);\n\n        return () => {\n          editor.view.dom.removeEventListener(\"keydown\", handleKeyDown);\n        };\n      }, [editor, delayedIsOpen]);\n\n      const close = useCallback(() => {\n        setManuallyClosed(true);\n      }, [setManuallyClosed]);\n\n      const registerExternal = useCallback(\n        (id: string) => {\n          externalIds.add(id);\n\n          return () => {\n            externalIds.delete(id);\n          };\n        },\n        [externalIds]\n      );\n\n      if (!editor || !delayedIsOpen) {\n        return null;\n      }\n\n      const slotProps: ToolbarSlotProps = { editor };\n\n      return createPortal(\n        <TooltipProvider>\n          <EditorProvider editor={editor}>\n            <FloatingToolbarContext.Provider\n              value={{ close, registerExternal }}\n            >\n              <div\n                role=\"toolbar\"\n                aria-label=\"Floating toolbar\"\n                aria-orientation=\"horizontal\"\n                className={cn(\n                  \"lb-root lb-portal lb-elevation lb-tiptap-floating-toolbar lb-tiptap-toolbar\",\n                  className\n                )}\n                ref={mergedRefs}\n                style={{\n                  position: strategy,\n                  top: 0,\n                  left: 0,\n                  transform: isPositioned\n                    ? `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`\n                    : \"translate3d(0, -200%, 0)\",\n                  minWidth: \"max-content\",\n                }}\n                onPointerDown={handlePointerDown}\n                onFocus={handleFocus}\n                onBlur={handleBlur}\n                {...props}\n              >\n                {applyToolbarSlot(before, slotProps)}\n                {applyToolbarSlot(children, slotProps)}\n                {applyToolbarSlot(after, slotProps)}\n              </div>\n            </FloatingToolbarContext.Provider>\n          </EditorProvider>\n        </TooltipProvider>,\n        document.body\n      );\n    }\n  ),\n  {\n    /**\n     * A component that can be wrapped around elements which are rendered outside of the floating\n     * toolbar (e.g. portals) to prevent the toolbar from closing when clicking/focusing within them.\n     *\n     * @example\n     * <FloatingToolbar editor={editor}>\n     *   <Popover.Root>\n     *     <Popover.Trigger asChild>\n     *       <Toolbar.Button>Open popover</Toolbar.Button>\n     *     </Popover.Trigger>\n     *     <Popover.Portal>\n     *       <FloatingToolbar.External>\n     *         <Popover.Content>\n     *           This popover is rendered outside of the floating toolbar, but the toolbar will not close when clicking/focusing within it.\n     *         </Popover.Content>\n     *       </FloatingToolbar.External>\n     *     </Popover.Portal>\n     *   </Popover.Root>\n     * </FloatingToolbar>\n     */\n    External: FloatingToolbarExternal,\n  }\n);\n", "import type { HistoryVersion } from \"@liveblocks/core\";\nimport { useHistoryVersionData } from \"@liveblocks/react\";\nimport { useOverrides } from \"@liveblocks/react-ui\";\nimport {\n  Button,\n  cn,\n  List,\n  RestoreIcon,\n  SpinnerIcon,\n  User,\n} from \"@liveblocks/react-ui/_private\";\nimport type { Content, Editor } from \"@tiptap/react\";\nimport { EditorContent, useEditor } from \"@tiptap/react\";\nimport type { ComponentPropsWithoutRef } from \"react\";\nimport { forwardRef, useCallback, useEffect } from \"react\";\nimport { yXmlFragmentToProseMirrorRootNode } from \"y-prosemirror\";\nimport { applyUpdate, Doc } from \"yjs\";\n\nconst AUTHORS_TRUNCATE = 3;\n\nexport interface HistoryVersionPreviewProps\n  extends ComponentPropsWithoutRef<\"div\"> {\n  version: HistoryVersion;\n  editor: Editor;\n  onVersionRestore?: (version: HistoryVersion) => void;\n}\n\n/**\n * Displays a specific version of the current TipTap document.\n *\n * @example\n * <HistoryVersionPreview version={version} />\n */\nexport const HistoryVersionPreview = forwardRef<\n  HTMLDivElement,\n  HistoryVersionPreviewProps\n>(\n  (\n    { version, editor: parentEditor, onVersionRestore, className, ...props },\n    forwardedRef\n  ) => {\n    const $ = useOverrides();\n    const { isLoading, data, error } = useHistoryVersionData(version.id);\n\n    const previewEditor = useEditor({\n      // ignore extensions, only get marks/nodes\n      editable: false,\n      extensions: parentEditor.extensionManager.extensions.filter(\n        (e) => e.type !== \"extension\"\n      ),\n    });\n    useEffect(() => {\n      if (data && previewEditor) {\n        const doc = new Doc();\n        applyUpdate(doc, data);\n        const root = doc.getXmlFragment(\"default\"); // TODO: lookup field\n        const node = yXmlFragmentToProseMirrorRootNode(\n          root,\n          parentEditor.schema\n        );\n        previewEditor.commands.setContent(node.toJSON() as Content);\n      }\n    }, [data, previewEditor, parentEditor]);\n    const restore = useCallback(() => {\n      parentEditor.commands.setContent(previewEditor?.getJSON() ?? \"\");\n      onVersionRestore?.(version);\n    }, [onVersionRestore, parentEditor, previewEditor, version]);\n\n    return (\n      <div\n        {...props}\n        className={cn(\n          \"lb-root lb-history-version-preview lb-tiptap-version-preview\",\n          className\n        )}\n        ref={forwardedRef}\n      >\n        {isLoading ? (\n          <div className=\"lb-loading lb-history-version-preview-loading\">\n            <SpinnerIcon />\n          </div>\n        ) : error ? (\n          <div className=\"lb-error lb-history-version-preview-error\">\n            {$.HISTORY_VERSION_PREVIEW_ERROR(error)}\n          </div>\n        ) : (\n          <div className=\"lb-history-version-preview-content lb-tiptap-editor-container lb-tiptap-version-preview-editor-container\">\n            <EditorContent editor={previewEditor} />\n          </div>\n        )}\n        <div className=\"lb-history-version-preview-footer\">\n          <span className=\"lb-history-version-preview-authors\">\n            {$.HISTORY_VERSION_PREVIEW_AUTHORS_LIST(\n              <List\n                values={version.authors.map((author) => (\n                  <User key={author.id} userId={author.id} replaceSelf />\n                ))}\n                formatRemaining={$.LIST_REMAINING_USERS}\n                truncate={AUTHORS_TRUNCATE}\n                locale={$.locale}\n              />\n            )}\n          </span>\n          <div className=\"lb-history-version-preview-actions\">\n            <Button\n              onClick={restore}\n              disabled={!data}\n              variant=\"primary\"\n              size=\"large\"\n              className=\"lb-history-version-preview-action\"\n              icon={<RestoreIcon />}\n            >\n              {$.HISTORY_VERSION_PREVIEW_RESTORE}\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n);\n", "import { detectDupes } from \"@liveblocks/core\";\n\nimport type { AiCommands, CommentsCommands } from \"./types\";\nimport { PKG_FORMAT, PKG_NAME, PKG_VERSION } from \"./version\";\n\ndetectDupes(PKG_NAME, PKG_VERSION, PKG_FORMAT);\n\nexport type { AiToolbarProps } from \"./ai/AiToolbar\";\nexport { AiToolbar } from \"./ai/AiToolbar\";\nexport type { AnchoredThreadsProps } from \"./comments/AnchoredThreads\";\nexport { AnchoredThreads } from \"./comments/AnchoredThreads\";\nexport type { FloatingComposerProps } from \"./comments/FloatingComposer\";\nexport { FloatingComposer } from \"./comments/FloatingComposer\";\nexport type { FloatingThreadsProps } from \"./comments/FloatingThreads\";\nexport { FloatingThreads } from \"./comments/FloatingThreads\";\nexport { useLiveblocksExtension } from \"./LiveblocksExtension\";\nexport { useIsEditorReady } from \"./LiveblocksExtension\";\nexport { GroupMentionNode } from \"./mentions/GroupMentionNode\";\nexport { MentionExtension } from \"./mentions/MentionExtension\";\nexport { MentionNode } from \"./mentions/MentionNode\";\nexport type { FloatingToolbarProps } from \"./toolbar/FloatingToolbar\";\nexport { FloatingToolbar } from \"./toolbar/FloatingToolbar\";\nexport type {\n  ToolbarBlockSelectorItem,\n  ToolbarBlockSelectorProps,\n  ToolbarButtonProps,\n  ToolbarProps,\n  ToolbarSeparatorProps,\n  ToolbarToggleProps,\n} from \"./toolbar/Toolbar\";\nexport { Toolbar } from \"./toolbar/Toolbar\";\nexport type {\n  AiConfiguration,\n  ResolveContextualPromptArgs,\n  ResolveContextualPromptResponse,\n} from \"./types\";\nexport type { HistoryVersionPreviewProps } from \"./version-history/HistoryVersionPreview\";\nexport { HistoryVersionPreview } from \"./version-history/HistoryVersionPreview\";\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    liveblocksComments: CommentsCommands<ReturnType>;\n    liveblocksAi: AiCommands<ReturnType>;\n  }\n}\n"],
  "mappings": "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",
  "names": ["isObject", "string", "index", "string", "Symbol", "Symbol", "tag", "e", "Symbol", "isObject", "other", "isObject", "debounce", "options", "time", "debounce", "isObject", "throttle", "options", "MODIFIERS", "isHotkey", "options", "string", "check", "e", "k", "PKG_NAME", "PKG_VERSION", "PKG_FORMAT", "v", "start", "end", "isStart", "list", "x", "platform", "x", "options", "max", "offset", "options", "platform", "placements", "sides", "side", "placement", "overflow", "x", "getBoundingClientRect", "top", "bottom", "left", "right", "width", "height", "y", "min", "max", "offset", "apply", "node", "getComputedStyle", "_e", "list", "getComputedStyle", "$", "x", "html", "cache", "options", "_e", "offset", "shift", "flip", "size", "hide", "arrow", "inline", "limitShift", "computePosition", "options", "cache", "noop", "options", "platform", "node", "computePosition", "data", "x", "arrow", "offset", "shift", "limitShift", "flip", "size", "hide", "options", "inline", "arrow", "import_react", "import_react", "import_react", "import_react", "useLayoutEffect", "useOriginalLayoutEffect", "useEffect", "kInternal", "useState", "name", "index", "size", "React", "React", "node", "import_jsx_runtime", "Slot", "props", "Slottable", "Fragment", "_a", "cache", "key", "from", "Component", "count", "from", "count", "list", "Component", "$", "inline", "escape", "html", "encode", "count", "offset", "_a", "l", "link", "lexer", "node", "options", "list", "t", "tag", "start", "text", "next", "k", "parser", "tokens", "args", "ret", "walkTokens", "parse", "src", "e", "msg", "defaultComponents", "heading", "index", "start", "List", "Component", "Link", "_a", "CodeBlock", "Separator", "_", "string", "options", "document", "React", "React", "import_jsx_runtime", "createContext", "useContext", "index", "_a", "createScope", "nextScopes", "currentScope", "React", "React", "ReactDOM", "import_jsx_runtime", "node", "Slot", "Node", "React", "_a", "React", "import_jsx_runtime", "node", "index", "handleAndDispatchPointerDownOutsideEvent", "React", "React", "useLayoutEffect", "React", "useLayoutEffect2", "React", "React", "import_jsx_runtime", "React", "size", "useLayoutEffect2", "import_jsx_runtime", "node", "arrow", "offset", "shift", "limitShift", "flip", "size", "hide", "useLayoutEffect2", "_a", "_e", "PopperArrow", "options", "x", "Root", "Arrow", "React", "import_react_dom", "import_jsx_runtime", "useLayoutEffect2", "_a", "ReactDOM", "React2", "React", "getElementRef", "node", "useLayoutEffect2", "_a", "React", "React2", "React", "React", "useLayoutEffect2", "from", "value", "_a", "React", "import_jsx_runtime", "NAME", "Root", "import_jsx_runtime", "trigger", "open", "PORTAL_NAME", "CONTENT_NAME", "Slottable", "handleScroll", "Root", "ARROW_NAME", "Arrow", "point", "x", "p", "q", "r", "Root", "Portal", "Content", "index", "Tooltip", "Root3", "Portal", "_a", "$", "Tooltip", "Anchor", "CodeBlock", "DefaultCodeBlock", "$", "string", "o", "e", "msg", "isPlainObject", "_a", "index", "t", "x", "isPlainObject", "immer", "path", "isSet", "parent", "isArray", "current", "_a", "Immer", "self", "base", "p", "Immer", "PathRef", "transform", "ref", "op", "current", "affinity", "path", "Path", "unref", "PointRef", "point", "Point", "RangeRef", "Range", "DIRTY_PATHS", "WeakMap", "DIRTY_PATH_KEYS", "FLUSHING", "NORMALIZING", "PATH_REFS", "POINT_REFS", "RANGE_REFS", "ancestors", "options", "arguments", "length", "undefined", "reverse", "paths", "levels", "slice", "common", "another", "i", "av", "bv", "push", "compare", "min", "Math", "endsAfter", "as", "bs", "equals", "endsAt", "endsBefore", "every", "n", "hasPrevious", "isAfter", "isAncestor", "isBefore", "isChild", "isCommon", "isDescendant", "isParent", "isPath", "value", "Array", "isArray", "isSibling", "al", "bl", "list", "next", "Error", "concat", "last", "operationCanTransformPath", "operation", "type", "parent", "previous", "relative", "ancestor", "p", "position", "newPath", "onp", "copy", "o", "toPrimitive", "toPropertyKey", "applyToDraft", "editor", "selection", "node", "Node", "index", "children", "splice", "key", "points", "offset", "text", "leaf", "before", "after", "get", "prevPath", "prev", "Text", "isText", "Scrubber", "stringify", "truePath", "newParent", "newIndex", "result", "texts", "preferNext", "properties", "newProperties", "hasOwnProperty", "isRange", "_objectSpread", "newNode", "GeneralTransforms", "createDraft", "finishDraft", "isDraft", "NodeTransforms", "insertNodes", "nodes", "liftNodes", "mergeNodes", "moveNodes", "removeNodes", "setNodes", "props", "splitNodes", "unsetNodes", "unwrapNodes", "wrapNodes", "element", "SelectionTransforms", "collapse", "deselect", "move", "select", "target", "setPoint", "setSelection", "isDeepEqual", "a", "b", "isPlainObject", "objectWithoutPropertiesLoose", "edges", "range", "anchor", "focus", "isBackward", "end", "surrounds", "intersectionRange", "intersection", "includes", "rs", "re", "ts", "te", "start", "isAfterStart", "isBeforeEnd", "isPoint", "rest", "_objectWithoutProperties", "_excluded", "s1", "e1", "s2", "e2", "isCollapsed", "isExpanded", "isForward", "produce", "r", "affinityAnchor", "affinityFocus", "isElement", "isNodeList", "Editor", "isEditor", "Element", "isElementList", "val", "isElementProps", "isElementType", "elementVal", "elementKey", "matches", "IS_NODE_LIST_CACHE", "root", "entry", "child", "c", "childPath", "descendant", "descendants", "elements", "extractProps", "_excluded2", "first", "fragment", "newRoot", "nodeEntries", "pass", "_ref", "getIf", "has", "isNode", "cachedResult", "set", "isTextProps", "from", "to", "visited", "Set", "add", "nextIndex", "parentPath", "string", "map", "join", "Operation", "isNodeOperation", "isOperation", "endsWith", "isOperationList", "isSelectionOperation", "isTextOperation", "inverse", "inversePath", "inverseNewPath", "IS_EDITOR_CACHE", "cachedIsEditor", "addMark", "apply", "deleteFragment", "insertBreak", "insertSoftBreak", "insertFragment", "insertNode", "insertText", "isElementReadOnly", "isInline", "isSelectable", "isVoid", "normalizeNode", "onChange", "removeMark", "getDirtyPaths", "marks", "operations", "above", "at", "deleteBackward", "unit", "deleteForward", "elementReadOnly", "hasBlocks", "hasInlines", "hasPath", "hasTexts", "isBlock", "isEdge", "isEmpty", "isEnd", "isNormalizing", "isStart", "getMarks", "normalize", "pathRef", "pathRefs", "pointRef", "pointRefs", "positions", "rangeRef", "rangeRefs", "setNormalizing", "unhangRange", "void", "withoutNormalizing", "fn", "shouldMergeNodesRemovePrevNode", "prevNode", "curNode", "Span", "isSpan", "value", "Array", "isArray", "length", "every", "Path", "isPath", "Point", "compare", "point", "another", "result", "path", "offset", "isAfter", "isBefore", "equals", "isPoint", "isPlainObject", "transform", "op", "options", "produce", "p", "affinity", "type", "text", "position", "Math", "min", "isAncestor", "_objectSpread", "_scrubber", "undefined", "Scrubber", "setScrubber", "scrubber", "stringify", "JSON", "Text", "loose", "omitText", "obj", "rest", "_objectWithoutProperties", "_excluded", "isDeepEqual", "isText", "isTextList", "val", "isTextProps", "props", "matches", "key", "hasOwnProperty", "decorations", "node", "leaves", "dec", "_excluded2", "start", "end", "Range", "edges", "next", "leafEnd", "decorationStart", "decorationEnd", "leaf", "leafStart", "Object", "assign", "push", "middle", "before", "after", "off", "slice", "getDefaultInsertLocation", "editor", "selection", "children", "Editor", "matchPath", "n", "getCharacterDistance", "str", "isRTL", "arguments", "isLTR", "codepoints", "codepointsIteratorRTL", "left", "CodepointType", "None", "right", "distance", "gb11", "gb12Or13", "char", "code", "codePointAt", "getCodepointType", "intersects", "ZWJ", "ExtPict", "endsWithEmojiZWJ", "substring", "RI", "endsWithOddNumberOfRIs", "isBoundaryPair", "SPACE", "PUNCTUATION", "CHAMELEON", "getWordDistance", "dist", "started", "charDist", "remaining", "splitByCharacterDistance", "isWordCharacter", "at", "test", "nextChar", "nextRemaining", "i", "char1", "charAt", "isLowSurrogate", "charCodeAt", "char2", "isHighSurrogate", "charCode", "reExtend", "rePrepend", "reSpacingMark", "reL", "reV", "reT", "reLV", "reLVT", "reExtPict", "Any", "search", "Extend", "Prepend", "SpacingMark", "L", "V", "T", "LV", "LVT", "x", "y", "NonBoundaryPairs", "findIndex", "r", "endingEmojiZWJ", "endingRIs", "match", "numRIs", "TextTransforms", "delete", "insertFragment", "fragment", "insertText", "withoutNormalizing", "voids", "range", "isRange", "isCollapsed", "anchor", "void", "startRef", "pointRef", "endRef", "Transforms", "startPoint", "unref", "endPoint", "setSelection", "focus", "elementReadOnly", "apply", "GeneralTransforms", "NodeTransforms", "SelectionTransforms", "BATCHING_DIRTY_PATHS", "WeakMap", "isBatchingDirtyPaths", "get", "batchDirtyPaths", "fn", "update", "set", "updateDirtyPaths", "newDirtyPaths", "oldDirtyPaths", "DIRTY_PATHS", "oldDirtyPathKeys", "DIRTY_PATH_KEYS", "Set", "dirtyPaths", "dirtyPathKeys", "add", "join", "has", "newPath", "ref", "pathRefs", "PathRef", "pointRefs", "PointRef", "rangeRefs", "RangeRef", "operationCanTransformPath", "getDirtyPaths", "operations", "normalize", "operation", "marks", "FLUSHING", "Promise", "resolve", "then", "onChange", "levels", "descendants", "from", "Node", "nodes", "_ref", "concat", "ancestors", "previousPath", "previous", "oldAncestors", "newAncestors", "ancestor", "newParent", "newIndex", "resultPath", "nextPath", "getFragment", "normalizeNode", "entry", "Element", "isElement", "child", "insertNodes", "shouldHaveInlines", "isEditor", "isInline", "currentNode", "prev", "isLast", "isInlineOrText", "removeNodes", "newChild", "elementChild", "mergeNodes", "shouldNormalize", "iteration", "initialDirtyPathsLength", "maxIterations", "Error", "above", "mode", "reverse", "addMark", "parentNode", "parentPath", "parent", "isVoid", "markableVoid", "expandedSelection", "isExpanded", "markAcceptingVoidSelected", "selectedNode", "selectedPath", "setNodes", "split", "edge", "d", "target", "positions", "deleteBackward", "unit", "deleteForward", "deleteFragment", "direction", "isElementReadOnly", "first", "getVoid", "hasBlocks", "element", "some", "isBlock", "hasInlines", "hasPath", "hasTexts", "insertBreak", "splitNodes", "always", "insertNode", "insertSoftBreak", "isEdge", "isStart", "isEnd", "isEmpty", "isNormalizing", "NORMALIZING", "last", "isBackward", "markedVoid", "block", "prevNode", "prevPath", "blockPath", "pointAfterLocation", "to", "span", "includes", "universal", "ignoreNonSelectable", "nodeEntries", "pass", "isSelectable", "hit", "isLower", "emit", "force", "getDirtyPathKeys", "popDirtyPath", "pop", "allPaths", "allPathKeys", "map", "dirtyPath", "_", "pathRef", "current", "refs", "PATH_REFS", "depth", "firstPath", "lastPath", "common", "POINT_REFS", "isNewBlock", "blockText", "leafTextRemaining", "leafTextOffset", "e", "s", "string", "isFirst", "calcDistance", "pointBeforeLocation", "rangeRef", "RANGE_REFS", "removeMark", "unsetNodes", "setNormalizing", "t", "unhangRange", "hasPrevious", "endBlock", "skip", "shouldMergeNodesRemovePrevNode", "_ref2", "deleteText", "_Editor$void", "_Editor$void2", "hanging", "furthestVoid", "voidPath", "opts", "endOfDoc", "startBlock", "isAcrossBlocks", "isSingleText", "startNonEditable", "endNonEditable", "isCommon", "removedText", "filter", "forEach", "startUnref", "endUnref", "select", "batchDirty", "inlineElementMatch", "inlinePath", "blockMatch", "isBlockStart", "isBlockEnd", "isBlockEmpty", "mergeStart", "mergeEnd", "matcher", "isRoot", "starts", "middles", "ends", "starting", "inlineMatch", "isInlineStart", "isInlineEnd", "middleRef", "collapse", "deselect", "properties", "newProperties", "move", "setPoint", "oldProps", "newProps", "k", "keys", "isNode", "isAtEnd", "index", "batchedOps", "_loop", "liftNodes", "parentNodeEntry", "toPath", "moveNodes", "splitPath", "hasSingleChildNest", "commonPath", "isPreviousSibling", "isSibling", "emptyAncestor", "emptyRef", "toRef", "targets", "depths", "merge", "splitMode", "endAtEndOfNode", "startAtStartOfNode", "prop", "nodeProp", "hasChanges", "deleteRange", "height", "beforeRef", "afterRef", "highest", "voidMatch", "nudge", "voidNode", "afterPath", "siblingHeight", "highestPath", "lowestPath", "extractProps", "_afterRef", "unwrapNodes", "intersection", "wrapNodes", "roots", "a", "rootPath", "commonNodeEntry", "commonNode", "wrapperPath", "wrapper", "_ret", "createEditor", "_len", "args", "_key", "_len2", "_key2", "_len3", "_key3", "_len4", "_key4", "_len5", "_key5", "_len6", "_key6", "_len7", "_key7", "_len8", "_key8", "_len9", "_key9", "_len10", "_key10", "_len11", "_key11", "_len12", "_key12", "_len13", "_key13", "_len14", "_key14", "_len15", "_key15", "_len16", "_key16", "_len17", "_key17", "_len18", "_key18", "_len19", "_key19", "_delete", "_len20", "_key20", "_len21", "_key21", "_len22", "_key22", "_len23", "_key23", "_len24", "_key24", "_len25", "_key25", "_len26", "_key26", "getMarks", "_len27", "_key27", "_len28", "_key28", "_len29", "_key29", "_len30", "_key30", "_len31", "_key31", "_len32", "_key32", "_len33", "_key33", "_len34", "_key34", "_len35", "_key35", "_len36", "_key36", "_len37", "_key37", "_len38", "_key38", "_len39", "_key39", "_len40", "_key40", "_len41", "_key41", "_len42", "_key42", "_len43", "_key43", "_len44", "_key44", "_len45", "_key45", "_len46", "_key46", "_len47", "_key47", "_len48", "_key48", "_len49", "_key49", "_len50", "_key50", "_len51", "_key51", "_len52", "_key52", "_len53", "_key53", "_len54", "_key54", "_len55", "_key55", "_len56", "_key56", "_len57", "_key57", "_len58", "_key58", "_len59", "_key59", "_len60", "_key60", "_len61", "_key61", "_len62", "_key62", "_len63", "_key63", "_len64", "_key64", "_len65", "_key65", "_len66", "_key66", "_len67", "_key67", "_len68", "_key68", "_len69", "_key69", "_len70", "_key70", "_len71", "_key71", "_len72", "_key72", "_len73", "_key73", "_void", "_len74", "_key74", "_len75", "_key75", "_len76", "_key76", "_len77", "_key77", "History", "isHistory", "value", "isPlainObject", "Array", "isArray", "redos", "undos", "length", "Operation", "isOperationList", "operations", "SAVING", "WeakMap", "MERGING", "SPLITTING_ONCE", "HistoryEditor", "isHistoryEditor", "value", "History", "isHistory", "history", "Editor", "isEditor", "isMerging", "editor", "get", "isSplittingOnce", "setSplittingOnce", "set", "isSaving", "redo", "undo", "withMerging", "fn", "prev", "withNewBatch", "delete", "withoutMerging", "withoutSaving", "withHistory", "e", "apply", "undos", "redos", "length", "batch", "selectionBefore", "Transforms", "setSelection", "withoutNormalizing", "op", "operations", "pop", "writeHistory", "inverseOps", "map", "Operation", "inverse", "reverse", "lastBatch", "lastOp", "save", "merge", "shouldSave", "shouldMerge", "undefined", "push", "selection", "shift", "stack", "type", "offset", "text", "Path", "equals", "path", "isElement", "el", "nodeType", "canOverflow", "overflow", "skipOverflowHiddenElements", "isScrollable", "clientHeight", "scrollHeight", "clientWidth", "scrollWidth", "style", "getComputedStyle", "overflowY", "overflowX", "frame", "ownerDocument", "defaultView", "frameElement", "e", "alignNearest", "scrollingEdgeStart", "scrollingEdgeEnd", "scrollingSize", "scrollingBorderStart", "scrollingBorderEnd", "elementEdgeStart", "elementEdgeEnd", "elementSize", "getParentElement", "element", "parent", "parentElement", "getRootNode", "host", "compute", "target", "options", "_a", "_b", "_c", "_d", "document", "scrollMode", "block", "inline", "boundary", "checkBoundary", "node", "TypeError", "scrollingElement", "documentElement", "frames", "cursor", "push", "body", "viewportWidth", "window", "visualViewport", "width", "innerWidth", "viewportHeight", "height", "innerHeight", "scrollX", "scrollY", "targetHeight", "targetWidth", "top", "targetTop", "right", "targetRight", "bottom", "targetBottom", "left", "targetLeft", "getBoundingClientRect", "marginTop", "marginRight", "marginBottom", "marginLeft", "computedStyle", "parseFloat", "scrollMarginTop", "scrollMarginRight", "scrollMarginBottom", "scrollMarginLeft", "targetBlock", "targetInline", "computations", "index", "length", "frameStyle", "borderLeft", "parseInt", "borderLeftWidth", "borderTop", "borderTopWidth", "borderRight", "borderRightWidth", "borderBottom", "borderBottomWidth", "blockScroll", "inlineScroll", "scrollbarWidth", "offsetWidth", "scrollbarHeight", "offsetHeight", "scaleX", "scaleY", "Math", "max", "scrollLeft", "scrollTop", "min", "getOptions", "options", "block", "inline", "Object", "keys", "length", "scrollIntoView", "target", "isConnected", "element", "currentElement", "parentNode", "document", "ShadowRoot", "host", "margins", "computedStyle", "window", "getComputedStyle", "top", "parseFloat", "scrollMarginTop", "right", "scrollMarginRight", "bottom", "scrollMarginBottom", "left", "scrollMarginLeft", "behavior", "compute", "el", "adjustedTop", "adjustedLeft", "scroll", "ResizeObserverBoxOptions", "freeze", "ResizeObserverSize", "freeze", "DOMRectReadOnly", "x", "freeze", "_a", "_a", "isElement", "global", "global", "size", "freeze", "_a", "ResizeObserverEntry", "freeze", "node", "parent", "callbacks", "ot", "ot", "process", "ResizeObserver", "Scheduler", "process", "global", "n", "ResizeObservation", "size", "ResizeObserverDetail", "ResizeObserverController", "options", "index", "ot", "ResizeObserver", "options", "isElement", "_objectWithoutPropertiesLoose", "_objectWithoutProperties", "objectWithoutPropertiesLoose", "_typeof", "o", "_toPrimitive", "_toPropertyKey", "toPrimitive", "_defineProperty", "toPropertyKey", "EditorContext", "createContext", "useSlateStatic", "editor", "useContext", "Error", "REACT_MAJOR_VERSION", "parseInt", "React", "version", "split", "IS_IOS", "navigator", "window", "test", "userAgent", "MSStream", "IS_APPLE", "IS_ANDROID", "IS_FIREFOX", "IS_WEBKIT", "IS_EDGE_LEGACY", "IS_CHROME", "IS_CHROME_LEGACY", "IS_ANDROID_CHROME_LEGACY", "IS_FIREFOX_LEGACY", "IS_UC_MOBILE", "IS_WECHATBROWSER", "CAN_USE_DOM", "document", "createElement", "_navigator$userAgent$", "match", "_navigator$userAgent$2", "HAS_BEFORE_INPUT_SUPPORT", "globalThis", "InputEvent", "prototype", "getTargetRanges", "IS_NODE_MAP_DIRTY", "WeakMap", "NODE_TO_INDEX", "NODE_TO_PARENT", "EDITOR_TO_WINDOW", "EDITOR_TO_ELEMENT", "EDITOR_TO_PLACEHOLDER_ELEMENT", "ELEMENT_TO_NODE", "NODE_TO_ELEMENT", "NODE_TO_KEY", "EDITOR_TO_KEY_TO_ELEMENT", "IS_READ_ONLY", "IS_FOCUSED", "IS_COMPOSING", "EDITOR_TO_USER_SELECTION", "EDITOR_TO_ON_CHANGE", "EDITOR_TO_SCHEDULE_FLUSH", "EDITOR_TO_PENDING_INSERTION_MARKS", "EDITOR_TO_USER_MARKS", "EDITOR_TO_PENDING_DIFFS", "EDITOR_TO_PENDING_ACTION", "EDITOR_TO_PENDING_SELECTION", "EDITOR_TO_FORCE_RENDER", "PLACEHOLDER_SYMBOL", "Symbol", "MARK_PLACEHOLDER_SYMBOL", "DOMNode", "Node", "DOMText", "Text", "getDefaultView", "value", "ownerDocument", "defaultView", "isDOMComment", "isDOMNode", "nodeType", "isDOMElement", "isDOMSelection", "anchorNode", "Selection", "isDOMText", "isPlainTextOnlyPaste", "event", "clipboardData", "getData", "types", "length", "normalizeDOMPoint", "domPoint", "node", "offset", "childNodes", "isLast", "index", "getEditableChildAndIndex", "i", "getEditableChild", "textContent", "hasShadowRoot", "parent", "parentNode", "toString", "direction", "child", "triedForward", "triedBackward", "getAttribute", "getPlainText", "domNode", "text", "nodeValue", "childNode", "Array", "from", "display", "getComputedStyle", "getPropertyValue", "tagName", "catchSlateFragment", "getSlateFragmentAttribute", "dataTransfer", "htmlData", "fragment", "getSelection", "root", "isTrackedMutation", "mutation", "batch", "target", "matches", "ReactEditor", "getWindow", "contains", "hasDOMNode", "editable", "parentMutation", "find", "_ref", "addedNodes", "removedNodes", "getActiveElement", "activeElement", "_activeElement", "shadowRoot", "_activeElement$shadow", "_activeElement2", "isBefore", "otherNode", "Boolean", "compareDocumentPosition", "DOCUMENT_POSITION_PRECEDING", "isAfter", "DOCUMENT_POSITION_FOLLOWING", "n", "Key", "constructor", "id", "concat", "androidPendingDiffs", "get", "androidScheduleFlush", "_EDITOR_TO_SCHEDULE_F", "blur", "el", "toDOMNode", "findDocumentOrShadowRoot", "set", "deselect", "selection", "domSelection", "rangeCount", "removeAllRanges", "Transforms", "getRootNode", "Document", "ShadowRoot", "findEventRange", "nativeEvent", "clientX", "x", "clientY", "y", "toSlateNode", "path", "findPath", "Element", "isElement", "Editor", "isVoid", "rect", "getBoundingClientRect", "isPrev", "isInline", "left", "width", "top", "height", "edge", "point", "before", "after", "range", "domRange", "caretRangeFromPoint", "position", "caretPositionFromPoint", "createRange", "setStart", "offsetNode", "setEnd", "toSlateRange", "exactMatch", "suppressThrow", "findKey", "key", "isEditor", "unshift", "Scrubber", "stringify", "focus", "options", "arguments", "undefined", "retries", "operations", "setTimeout", "toDOMRange", "addRange", "select", "start", "preventScroll", "editorEl", "targetEl", "parentElement", "err", "message", "includes", "closest", "isContentEditable", "hasEditableTarget", "hasRange", "anchor", "hasPath", "hasSelectableTarget", "isTargetInsideNonReadonlyVoid", "hasTarget", "insertData", "data", "insertFragmentData", "insertTextData", "isComposing", "isFocused", "isReadOnly", "slateNode", "setFragmentData", "originEvent", "KEY_TO_ELEMENT", "toDOMPoint", "void", "at", "selector", "texts", "querySelectorAll", "attr", "trueLength", "end", "nextText", "hasAttribute", "_nextText$textContent", "domText", "startsWith", "Math", "min", "max", "isBackward", "Range", "domAnchor", "domFocus", "isCollapsed", "startNode", "startOffset", "endNode", "endOffset", "startEl", "isStartAtZeroWidth", "endEl", "isEndAtZeroWidth", "domEl", "toSlatePoint", "searchDirection", "nearestNode", "nearestOffset", "textNode", "_domNode$textContent", "_domNode$textContent2", "potentialVoidNode", "voidNode", "potentialNonEditableNode", "nonEditableNode", "leafNode", "contents", "cloneContents", "removals", "slice", "call", "forEach", "textContext", "removeChild", "leafNodes", "current", "getLeafNodes", "elementNode", "_leafNodes$find", "nextElementSibling", "leaf", "_leafNodes2$findLast", "previousElementSibling", "findLast", "endsWith", "querySelector", "_focusNode$textConten", "startContainer", "anchorOffset", "focusNode", "focusOffset", "firstRange", "getRangeAt", "lastRange", "HTMLTableRowElement", "getLastChildren", "element", "childElementCount", "children", "firstNodeRow", "lastNodeRow", "firstNode", "lastNode", "HTMLElement", "innerHTML", "endContainer", "collapsed", "focusBeforeAnchor", "isExpanded", "isForward", "mode", "unhangRange", "voids", "verifyDiffState", "textDiff", "diff", "isText", "nextPath", "Path", "next", "nextNode", "applyStringDiff", "_len", "diffs", "_key", "reduce", "longestCommonPrefixLength", "str", "another", "charAt", "longestCommonSuffixLength", "normalizeStringDiff", "targetText", "removedText", "prefixLength", "suffixLength", "normalized", "mergeStringDiffs", "a", "b", "overlap", "applied", "sliceEnd", "targetRange", "normalizePoint", "parentBlock", "above", "isBlock", "entry", "isDescendant", "normalizeRange", "transformPendingPoint", "op", "pendingDiffs", "equals", "Point", "transform", "affinity", "transformed", "type", "transformPendingRange", "transformTextDiff", "newPath", "RESOLVE_DELAY", "FLUSH_DELAY", "debug", "isDataTransfer", "name", "createAndroidInputManager", "scheduleOnDOMSelectionChange", "onDOMSelectionChange", "flushing", "compositionEndTimeoutId", "flushTimeoutId", "actionTimeoutId", "idCounter", "insertPositionHint", "applyPendingSelection", "pendingSelection", "delete", "performAction", "action", "isPoint", "run", "flush", "clearTimeout", "hasPendingDiffs", "hasPendingAction", "selectionRef", "rangeRef", "marks", "scheduleSelectionChange", "_EDITOR_TO_PENDING_DI", "_EDITOR_TO_PENDING_DI2", "pendingMarks", "insertText", "deleteFragment", "filter", "_ref2", "cancel", "unref", "userMarks", "onChange", "handleCompositionEnd", "_event", "handleCompositionStart", "updatePlaceholderVisibility", "forceHide", "placeholderElement", "style", "removeProperty", "storeDiff", "_EDITOR_TO_PENDING_DI3", "idx", "findIndex", "change", "push", "merged", "splice", "_objectSpread", "scheduleAction", "handleDOMBeforeInput", "_targetRange2", "inputType", "nativeTargetRange", "canStoreDiff", "edges", "relevantPendingDiffs", "handleUserSelect", "targetNode", "deleteForward", "_nativeTargetRange", "nativeCollapsed", "deleteBackward", "unit", "insertSoftBreak", "insertBreak", "replace", "parts", "line", "hintPosition", "search", "diffPosition", "scheduleFlush", "_EDITOR_TO_PENDING_DI4", "hasPendingChanges", "isFlushing", "pathChanged", "parentPathChanged", "handleInput", "handleKeyDown", "_", "handleDomMutations", "mutations", "some", "_EDITOR_TO_FORCE_REND", "useIsMounted", "isMountedRef", "useRef", "useEffect", "useIsomorphicLayoutEffect", "useLayoutEffect", "useMutationObserver", "callback", "mutationObserver", "useState", "MutationObserver", "takeRecords", "observe", "disconnect", "MUTATION_OBSERVER_CONFIG", "subtree", "childList", "characterData", "useAndroidInputManager", "_excluded", "isMounted", "inputManager", "shallowCompare", "obj1", "obj2", "Object", "keys", "every", "hasOwnProperty", "isDecorationFlagsEqual", "other", "rangeOwnProps", "otherOwnProps", "_excluded2", "isElementDecorationsEqual", "list", "isTextDecorationsEqual", "String", "props", "parentPath", "isMarkPlaceholder", "ZeroWidthString", "string", "isLineBreak", "TextString", "isTrailing", "ref", "getTextContent", "initialText", "textWithTrailing", "MemoizedText", "memo", "forwardRef", "attributes", "PLACEHOLDER_DELAY", "disconnectPlaceholderResizeObserver", "placeholderResizeObserver", "releaseObserver", "clearTimeoutRef", "timeoutRef", "Leaf", "renderPlaceholder", "renderLeaf", "DefaultLeaf", "placeholderRef", "showPlaceholder", "setShowPlaceholder", "showPlaceholderTimeoutRef", "callbackPlaceholderRef", "useCallback", "placeholderEl", "_leaf$onPlaceholderRe", "onPlaceholderResize", "ResizeObserver", "ResizeObserverPolyfill", "_leaf$onPlaceholderRe2", "leafIsPlaceholder", "placeholderProps", "placeholder", "pointerEvents", "maxWidth", "opacity", "userSelect", "textDecoration", "WebkitUserModify", "contentEditable", "Fragment", "MemoizedLeaf", "prev", "decorations", "leaves", "SlateText", "callbackRef", "span", "renderElement", "p", "DefaultElement", "readOnly", "useReadOnly", "useChildren", "hasInlines", "dir", "getDirection", "Tag", "color", "outline", "MemoizedElement", "DecorateContext", "useDecorate", "SelectedContext", "useSelected", "decorate", "isLeafBlock", "sel", "intersection", "ds", "dec", "d", "Provider", "ElementComponent", "TextComponent", "ReadOnlyContext", "SlateContext", "useSlate", "context", "useTrackUserInput", "editor", "useSlateStatic", "receivedUserInput", "useRef", "animationFrameIdRef", "onUserInput", "useCallback", "current", "window", "ReactEditor", "getWindow", "cancelAnimationFrame", "requestAnimationFrame", "useEffect", "TRIPLE_CLICK", "HOTKEYS", "bold", "compose", "moveBackward", "moveForward", "moveWordBackward", "moveWordForward", "deleteBackward", "deleteForward", "extendBackward", "extendForward", "italic", "insertSoftBreak", "splitBlock", "undo", "APPLE_HOTKEYS", "moveLineBackward", "moveLineForward", "deleteLineBackward", "deleteLineForward", "deleteWordBackward", "deleteWordForward", "extendLineBackward", "extendLineForward", "redo", "transposeCharacter", "WINDOWS_HOTKEYS", "create", "key", "generic", "apple", "windows", "isGeneric", "isHotkey", "isApple", "isWindows", "event", "IS_APPLE", "isBold", "isCompose", "isMoveBackward", "isMoveForward", "isDeleteBackward", "isDeleteForward", "isDeleteLineBackward", "isDeleteLineForward", "isDeleteWordBackward", "isDeleteWordForward", "isExtendBackward", "isExtendForward", "isExtendLineBackward", "isExtendLineForward", "isItalic", "isMoveLineBackward", "isMoveLineForward", "isMoveWordBackward", "isMoveWordForward", "isRedo", "isSoftBreak", "isSplitBlock", "isTransposeCharacter", "isUndo", "createRestoreDomManager", "bufferedMutations", "clear", "registerMutations", "mutations", "trackedMutations", "filter", "mutation", "isTrackedMutation", "push", "restoreDOM", "length", "reverse", "forEach", "type", "removedNodes", "node", "target", "insertBefore", "nextSibling", "addedNodes", "removeChild", "MUTATION_OBSERVER_CONFIG", "subtree", "childList", "characterData", "characterDataOldValue", "RestoreDOMComponent", "Component", "constructor", "arguments", "_defineProperty", "observe", "_this$mutationObserve", "props", "Error", "mutationObserver", "componentDidMount", "context", "manager", "MutationObserver", "getSnapshotBeforeUpdate", "_this$mutationObserve2", "_this$mutationObserve3", "_this$manager2", "pendingMutations", "takeRecords", "_this$manager", "disconnect", "componentDidUpdate", "_this$manager3", "componentWillUnmount", "_this$mutationObserve4", "render", "children", "EditorContext", "RestoreDOM", "IS_ANDROID", "_ref", "React", "createElement", "Fragment", "ComposingContext", "createContext", "Children", "props", "React", "createElement", "Fragment", "useChildren", "Editable", "forwardRef", "forwardedRef", "defaultRenderPlaceholder", "useCallback", "DefaultPlaceholder", "_objectSpread", "autoFocus", "decorate", "defaultDecorate", "onDOMBeforeInput", "propsOnDOMBeforeInput", "placeholder", "readOnly", "renderElement", "renderLeaf", "renderPlaceholder", "scrollSelectionIntoView", "defaultScrollSelectionIntoView", "style", "userStyle", "as", "Component", "disableDefaultStyles", "attributes", "_objectWithoutProperties", "_excluded", "editor", "useSlate", "isComposing", "setIsComposing", "useState", "ref", "useRef", "deferredOperations", "placeholderHeight", "setPlaceholderHeight", "processing", "onUserInput", "receivedUserInput", "useTrackUserInput", "forceRender", "useReducer", "s", "EDITOR_TO_FORCE_RENDER", "set", "IS_READ_ONLY", "state", "useMemo", "isDraggingInternally", "isUpdatingSelection", "latestElement", "hasMarkPlaceholder", "useEffect", "current", "focus", "androidInputManagerRef", "onDOMSelectionChange", "throttle", "IS_NODE_MAP_DIRTY", "get", "el", "ReactEditor", "toDOMNode", "root", "getRootNode", "IS_WEBKIT", "ShadowRoot", "active", "getActiveElement", "document", "execCommand", "Transforms", "deselect", "androidInputManager", "IS_ANDROID", "isFlushing", "findDocumentOrShadowRoot", "activeElement", "domSelection", "getSelection", "IS_FOCUSED", "delete", "anchorNode", "focusNode", "anchorNodeSelectable", "hasEditableTarget", "isTargetInsideNonReadonlyVoid", "focusNodeInEditor", "hasTarget", "range", "toSlateRange", "exactMatch", "suppressThrow", "hasPendingChanges", "select", "handleUserSelect", "scheduleOnDOMSelectionChange", "debounce", "useAndroidInputManager", "node", "useIsomorphicLayoutEffect", "_androidInputManagerR", "_androidInputManagerR2", "window", "getDefaultView", "EDITOR_TO_WINDOW", "EDITOR_TO_ELEMENT", "NODE_TO_ELEMENT", "ELEMENT_TO_NODE", "selection", "isFocused", "hasPendingAction", "setDomSelection", "forceChange", "hasDomSelection", "type", "IS_FIREFOX", "rangeCount", "firstRange", "getRangeAt", "lastRange", "startContainer", "endContainer", "editorElement", "hasDomSelectionInEditor", "contains", "slateRange", "Range", "equals", "_anchorNode", "parentElement", "hasAttribute", "hasRange", "newDomRange", "toDOMRange", "collapseToEnd", "isBackward", "setBaseAndExtent", "endOffset", "startOffset", "removeAllRanges", "ensureSelection", "setTimeout", "timeoutId", "animationFrameId", "requestAnimationFrame", "ensureDomSelection", "e", "cancelAnimationFrame", "clearTimeout", "event", "ranges", "getTargetRanges", "newRange", "setStart", "setEnd", "preventDefault", "stopImmediatePropagation", "target", "isDOMEventHandled", "_EDITOR_TO_USER_SELEC", "handleDOMBeforeInput", "flush", "inputType", "data", "dataTransfer", "undefined", "isCompositionChange", "native", "isCollapsed", "length", "test", "anchor", "offset", "marks", "_node$parentElement", "_window$getComputedSt", "toDOMPoint", "closest", "getWindow", "hasDOMNode", "_lastText$textContent", "lastText", "createTreeWalker", "NodeFilter", "SHOW_TEXT", "lastChild", "textContent", "getComputedStyle", "whiteSpace", "block", "Editor", "above", "at", "path", "match", "n", "Element", "isElement", "isBlock", "Node", "string", "includes", "startsWith", "targetRange", "selectionRef", "rangeRef", "EDITOR_TO_USER_SELECTION", "isExpanded", "direction", "endsWith", "deleteFragment", "deleteForward", "deleteBackward", "unit", "insertSoftBreak", "insertBreak", "IS_COMPOSING", "constructor", "name", "insertData", "push", "insertText", "toRestore", "unref", "callbackRef", "cancel", "HAS_BEFORE_INPUT_SUPPORT", "removeEventListener", "addEventListener", "stoppedDragging", "decorations", "showPlaceholder", "children", "Array", "from", "texts", "placeHolderResizeHandler", "placeholderEl", "_placeholderEl$getBou", "getBoundingClientRect", "height", "start", "PLACEHOLDER_SYMBOL", "onPlaceholderResize", "leaf", "rest", "_excluded2", "Text", "loose", "unset", "Object", "fromEntries", "keys", "map", "mark", "MARK_PLACEHOLDER_SYMBOL", "text", "EDITOR_TO_PENDING_INSERTION_MARKS", "ReadOnlyContext", "Provider", "value", "ComposingContext", "DecorateContext", "RestoreDOM", "role", "spellCheck", "CAN_USE_DOM", "autoCorrect", "autoCapitalize", "contentEditable", "zindex", "suppressContentEditableWarning", "position", "wordWrap", "minHeight", "onBeforeInput", "isEventHandled", "hasSelectableTarget", "onInput", "handleInput", "op", "nativeEvent", "maybeHistoryEditor", "undo", "redo", "onBlur", "relatedTarget", "isDOMElement", "isDOMNode", "toSlateNode", "isVoid", "onClick", "findPath", "hasPath", "detail", "TRIPLE_CLICK", "blockPath", "_block$", "slice", "end", "startVoid", "void", "endVoid", "Path", "onCompositionEnd", "_androidInputManagerR3", "Promise", "resolve", "then", "handleCompositionEnd", "IS_FIREFOX_LEGACY", "IS_IOS", "IS_WECHATBROWSER", "IS_UC_MOBILE", "placeholderMarks", "EDITOR_TO_USER_MARKS", "userMarks", "onCompositionUpdate", "onCompositionStart", "_androidInputManagerR4", "handleCompositionStart", "onCopy", "isDOMEventTargetInput", "setFragmentData", "clipboardData", "onCut", "parent", "onDragOver", "onDragStart", "voidMatch", "voids", "onDrop", "draggedRange", "findEventRange", "onDragEnd", "onFocus", "onKeyDown", "_androidInputManagerR5", "handleKeyDown", "element", "isRTL", "getDirection", "Hotkeys", "isRedo", "isUndo", "isMoveLineBackward", "move", "reverse", "isMoveLineForward", "isExtendLineBackward", "edge", "isExtendLineForward", "isMoveBackward", "collapse", "isMoveForward", "isMoveWordBackward", "isMoveWordForward", "isBold", "isItalic", "isTransposeCharacter", "isSoftBreak", "isSplitBlock", "isDeleteBackward", "isDeleteForward", "isDeleteLineBackward", "isDeleteLineForward", "isDeleteWordBackward", "isDeleteWordForward", "IS_CHROME", "currentNode", "isInline", "onPaste", "isPlainTextOnlyPaste", "_ref", "domRange", "leafEl", "bind", "scrollIntoView", "scrollMode", "handler", "shouldTreatEventAsHandled", "isDefaultPrevented", "isPropagationStopped", "HTMLInputElement", "HTMLTextAreaElement", "defaultPrevented", "FocusedContext", "createContext", "SlateSelectorContext", "createContext", "useSelectorContext", "editor", "eventListeners", "useRef", "current", "slateRef", "onChange", "useCallback", "forEach", "listener", "selectorContext", "useMemo", "getSlate", "addEventListener", "callback", "push", "splice", "indexOf", "Slate", "props", "children", "onSelectionChange", "onValueChange", "initialValue", "rest", "_objectWithoutProperties", "_excluded", "context", "setContext", "React", "useState", "Node", "isNodeList", "Error", "concat", "Scrubber", "stringify", "Editor", "isEditor", "Object", "assign", "v", "handleSelectorChange", "onContextChange", "options", "_options$operation", "operation", "type", "selection", "prevContext", "useEffect", "EDITOR_TO_ON_CHANGE", "set", "isFocused", "setIsFocused", "ReactEditor", "useIsomorphicLayoutEffect", "fn", "REACT_MAJOR_VERSION", "document", "removeEventListener", "SlateSelectorContext", "Provider", "value", "createElement", "SlateContext", "EditorContext", "FocusedContext", "doRectsIntersect", "rect", "compareRect", "middle", "top", "bottom", "areRangesSameLine", "editor", "range1", "range2", "rect1", "ReactEditor", "toDOMRange", "getBoundingClientRect", "rect2", "findCurrentLineRange", "parentRange", "parentRangeBoundary", "Editor", "range", "Range", "end", "positions", "Array", "from", "at", "left", "right", "length", "Math", "floor", "withReact", "clipboardFormatKey", "arguments", "undefined", "e", "apply", "onChange", "deleteBackward", "addMark", "removeMark", "EDITOR_TO_KEY_TO_ELEMENT", "set", "WeakMap", "key", "value", "_EDITOR_TO_SCHEDULE_F", "_EDITOR_TO_PENDING_DI", "EDITOR_TO_SCHEDULE_FLUSH", "get", "EDITOR_TO_PENDING_INSERTION_MARKS", "EDITOR_TO_PENDING_DIFFS", "EDITOR_TO_USER_MARKS", "delete", "_EDITOR_TO_PENDING_DI2", "unit", "selection", "isCollapsed", "parentBlockEntry", "above", "match", "n", "Element", "isElement", "isBlock", "parentBlockPath", "parentElementRange", "anchor", "currentLineRange", "Transforms", "op", "matches", "pathRefMatches", "pendingDiffs", "transformed", "map", "textDiff", "transformTextDiff", "filter", "Boolean", "pendingSelection", "EDITOR_TO_PENDING_SELECTION", "transformPendingRange", "pendingAction", "EDITOR_TO_PENDING_ACTION", "Point", "isPoint", "transformPendingPoint", "_objectSpread", "type", "push", "getMatches", "path", "_EDITOR_TO_USER_SELEC", "EDITOR_TO_USER_SELECTION", "unref", "Path", "parent", "prevPath", "previous", "commonPath", "common", "newPath", "changedPath", "isBefore", "changedNode", "Node", "changedNodeKey", "findKey", "changedPathRef", "pathRef", "IS_NODE_MAP_DIRTY", "node", "NODE_TO_KEY", "current", "setFragmentData", "data", "start", "edges", "startVoid", "void", "endVoid", "domRange", "contents", "cloneContents", "attach", "childNodes", "forEach", "textContent", "trim", "voidNode", "r", "cloneRange", "domNode", "toDOMNode", "setEndAfter", "querySelector", "querySelectorAll", "zw", "isNewline", "getAttribute", "isDOMText", "span", "ownerDocument", "createElement", "style", "whiteSpace", "appendChild", "fragment", "getFragment", "string", "JSON", "stringify", "encoded", "window", "btoa", "encodeURIComponent", "setAttribute", "setData", "concat", "div", "body", "innerHTML", "getPlainText", "removeChild", "insertData", "insertFragmentData", "insertTextData", "getData", "getSlateFragmentAttribute", "decoded", "decodeURIComponent", "atob", "parsed", "parse", "insertFragment", "text", "lines", "split", "line", "splitNodes", "always", "insertText", "options", "maybeBatchUpdates", "REACT_MAJOR_VERSION", "ReactDOM", "unstable_batchedUpdates", "callback", "onContextChange", "EDITOR_TO_ON_CHANGE", "p", "levels", "normalizeNode", "node", "path", "SlateElement", "SlateNode", "SlateTransforms", "string", "node", "isEmpty", "SlateEditor", "_a", "Component", "SlateTransforms", "SlateEditor", "select", "focus", "isEditorEmpty", "isEmpty", "block", "useLayoutEffect", "_", "Component", "ReasoningPart", "RetrievalPart", "TextPart", "ToolInvocationPart", "index", "useControllableState", "value", "useControllableState", "Component", "_", "C", "P", "O", "T", "L", "E", "N", "M", "React", "React", "import_jsx_runtime", "node", "handleFocusIn", "focus", "handleFocusOut", "handleMutations", "container", "first", "last", "select", "nodes", "isHidden", "_a", "index", "React", "count", "count", "node", "__assign", "t", "n", "p", "e", "from", "l", "React", "React", "import_react", "useCallbackRef", "last", "React", "useIsomorphicLayoutEffect", "useCallbackRef", "React", "import_react", "x", "cbs", "options", "React", "import_react", "React", "_a", "_a", "callbacks", "SideCar", "React", "React", "React", "tag", "_a", "x", "_a", "options", "node", "current", "_a", "x", "Style", "parent", "e", "node", "node", "parent", "x", "e", "import_jsx_runtime", "TRIGGER_NAME", "PORTAL_NAME", "PortalProvider", "usePortalContext", "Slot", "CONTENT_NAME", "_a", "createContext2", "Root", "Portal", "Content", "t", "Y", "r", "o", "n", "K", "e", "u", "p", "m", "x", "C", "ge", "O", "$", "q", "_", "I", "v", "k", "E", "l", "J", "z", "W", "M", "U", "te", "V", "F", "X", "Q", "re", "oe", "ie", "se", "B", "Root", "Portal", "Content", "EditorContext", "parent", "ThreadPluginActions", "node", "range", "fragment", "parent", "from", "_a", "paragraph", "node", "takeSnapshot", "from", "_a", "useLayoutEffect", "customPrompt", "state", "hide", "offset", "shift", "limitShift", "x", "PKG_NAME", "PKG_VERSION", "PKG_FORMAT", "options", "callback", "_a", "$", "AiMessage.Content", "Collapsible.Root", "Collapsible.Trigger", "Collapsible.Content", "TextPart", "$", "AiMessage.Content", "props", "$", "AiComposerPrimitive.Abort", "AiComposerPrimitive.Submit", "AiComposerPrimitive.Form", "AiComposerPrimitive.Editor", "defaultComponents", "messages", "_a", "$", "$", "string", "Collapsible.Root", "Collapsible.Trigger", "Collapsible.Content", "React", "import_jsx_runtime", "NAME", "Root", "Component", "Mention", "Link", "block", "index", "inline", "_", "useLayoutEffect", "PORTAL_NAME", "Portal", "Component", "clamp", "min", "max", "min", "max", "range", "options", "clamp", "index", "at", "options", "before", "SlateEditor", "range", "SlateRange", "after", "marks", "SlateEditor", "SlateRange", "options", "isEmpty", "range", "WHITESPACE_REGEX", "defaultOptions", "at", "options", "start", "end", "SlateRange", "point", "move", "direction", "SlateEditor", "SlatePath", "SlateRange", "SlateEditor", "SlateTransforms", "insertText", "options", "SlateEditor", "node", "SlateElement", "SlateRange", "normalizeNode", "node", "path", "SlateElement", "_a", "SlateTransforms", "SlateNode", "marks", "SlateRange", "normalizeNode", "deleteBackward", "node", "path", "SlateElement", "_a", "SlateTransforms", "SlateNode", "SlatePath", "marks", "SlateRange", "SlateEditor", "start", "end", "SlateRange", "_", "point", "SlateEditor", "node", "SlateElement", "SlateTransforms", "deleteBackward", "_typeof", "o", "_toPrimitive", "_toPropertyKey", "toPrimitive", "_defineProperty", "toPropertyKey", "ANCHOR", "WeakMap", "FOCUS", "Token", "AnchorToken", "constructor", "props", "offset", "path", "FocusToken", "addAnchorToken", "text", "token", "length", "set", "getAnchorOffset", "get", "addFocusToken", "getFocusOffset", "STRINGS", "WeakSet", "resolveDescendants", "children", "nodes", "addChild", "child", "prev", "add", "Text", "isText", "c", "has", "equals", "loose", "push", "Element", "isElement", "n", "Error", "concat", "flat", "Infinity", "createAnchor", "tagName", "attributes", "createCursor", "createElement", "_objectSpread", "createFocus", "createFragment", "createSelection", "anchor", "find", "focus", "createText", "node", "delete", "Object", "assign", "createEditor", "makeEditor", "otherChildren", "selectionChild", "Range", "isRange", "descendants", "selection", "editor", "Node", "texts", "DEFAULT_CREATORS", "cursor", "element", "fragment", "createHyperscript", "options", "arguments", "undefined", "elements", "elementCreators", "normalizeElements", "creators", "jsx", "createFactory", "_len", "Array", "_key", "creator", "isPlainObject", "filter", "Boolean", "ret", "_loop", "NEWLINE_REGEX", "WHITESPACE_REGEX", "node", "jsx", "html", "_a", "fragment", "SlateTransforms", "_", "link", "block", "inline", "useLayoutEffect", "flip", "hide", "shift", "limitShift", "offset", "size", "options", "getSnapshot", "Mention", "_", "Link", "x", "useLayoutEffect", "_a", "Portal", "FloatingToolbar", "Component", "leaf", "focus", "select", "index", "marks", "isEmpty", "isEmpty2", "toggleMark", "Root", "RENDER_INTERVAL", "Component", "size", "Component", "$", "Tooltip", "React", "import_jsx_runtime", "usePopperScope", "ANCHOR_NAME", "TRIGGER_NAME", "trigger", "getState", "PORTAL_NAME", "PortalProvider", "usePortalContext", "CONTENT_NAME", "Slot", "_a", "CLOSE_NAME", "ARROW_NAME", "Arrow", "Root", "Portal", "Content", "import_react", "import_jsx_runtime", "emoji_picker_exports", "__export", "EmojiPickerActiveEmoji", "EmojiPickerEmpty", "EmojiPickerList", "EmojiPickerLoading", "EmojiPickerRoot", "EmojiPickerSearch", "EmojiPickerSkinTone", "EmojiPickerSkinToneSelector", "EmojiPickerViewport", "EMOJI_FONT_FAMILY", "SKIN_TONES", "capitalize", "string", "CANVAS_SIZE", "context", "isEmojiSupported", "emoji", "blue", "red", "i", "getStorage", "storage", "key", "validate", "item", "value", "setStorage", "optional", "data", "nullable", "number", "boolean", "object", "keys", "result", "naiveArray", "EMOJIBASE_EMOJIS_URL", "baseUrl", "locale", "EMOJIBASE_MESSAGES_URL", "EMOJIBASE_LOCALES", "EMOJIBASE_DEFAULT_LOCALE", "LOCAL_DATA_KEY", "SESSION_METADATA_KEY", "fetchEtag", "url", "signal", "fetchEmojibaseData", "emojis", "emojisEtag", "messages", "messagesEtag", "response", "fetchEmojibaseEtags", "getEmojibaseSkinToneVariations", "skinTone", "fetchEmojiData", "countryFlagsSubgroup", "subgroup", "filteredGroups", "group", "filteredEmojis", "categories", "skinTones", "formattedEmojis", "emojiData", "getSessionMetadata", "emojiVersion", "versionEmojis", "descendingVersions", "b", "highestVersion", "supportsCountryFlags", "version", "validateSessionMetadata", "validateLocalData", "getEmojiData", "emojibaseUrl", "sessionMetadata", "localData", "isSupportedVersion", "validateLocale", "validateSkinTone", "chunk", "array", "size", "chunks", "j", "searchEmojis", "search", "searchText", "scores", "score", "tag", "a", "getEmojiPickerData", "columns", "rows", "categoriesStartRowIndices", "emojisByCategory", "categoryIndex", "startRowIndex", "category", "categoryEmojis", "categoryRows", "createStore", "createInitialState", "state", "pending", "frameId", "subscribers", "flush", "subscriber", "get", "set", "partial", "subscribe", "useCreateStore", "store", "useState", "useCreateStoreContext", "missingProviderError", "Context", "createContext", "useContext", "children", "jsx", "useSelector", "selector", "compare", "slice", "setSlice", "useEffect", "nextSlice", "previousSlice", "useDebugValue", "useSelectorKey", "useCallback", "VIEWPORT_OVERSCAN", "createEmojiPickerStore", "onEmojiSelect", "initialLocale", "initialColumns", "initialSkinTone", "viewportScrollY", "categoryHeaderHeight", "rowHeight", "viewportHeight", "previousCategoryHeadersHeight", "totalHeight", "overscanStart", "overscanEnd", "viewportStartY", "viewportEndY", "viewportStartRowIndex", "viewportEndRowIndex", "viewportStartCategoryIndex", "interaction", "activeColumnIndex", "activeRowIndex", "listRef", "viewportRef", "list", "viewport", "rowIndex", "row", "rowY", "rowComputedStyle", "rowScrollMarginTop", "rowScrollMarginBottom", "viewportWidth", "scrollY", "useEmojiPickerStore", "EmojiPickerStoreProvider", "$search", "$activeEmoji", "$isEmpty", "$isLoading", "$rowsCount", "$categoriesCount", "$categoriesRowsStartIndices", "$skinTones", "sameEmojiPickerEmoji", "sameEmojiPickerRow", "index", "ZWJ", "EMOJI_MODIFIER_BASE", "ENDING_VARIATION_SELECTOR", "SKIN_TONE_MODIFIERS", "skinToneModifiers", "getSkinToneVariation", "segment", "baseEmoji", "_", "segments", "isZwjSequence", "getSkinToneVariations", "useActiveEmoji", "activeEmoji", "useDeferredValue", "useSkinTone", "skinToneVariations", "useMemo", "setSkinTone", "shallow", "keysA", "keysB", "noop", "requestIdleCallback", "callback", "options", "id", "start", "useLayoutEffect", "useOriginalLayoutEffect", "useStableCallback", "callbackRef", "useRef", "args", "EmojiPickerDataHandler", "setEmojiData", "controller", "error", "forwardRef", "onFocusCapture", "onBlurCapture", "style", "props", "forwardedRef", "stableOnEmojiSelect", "isFocusedWithin", "setFocusedWithin", "ref", "element", "handleFocusCapture", "event", "searchRef", "isSearch", "isViewport", "handleBlurCapture", "useImperativeHandle", "handleKeyDown", "onActiveEmojiChange", "columnIndex", "previousRowIndex", "previousRow", "nextRowIndex", "nextRow", "previousViewportWidth", "previousViewportHeight", "previousRowHeight", "previousCategoryHeaderHeight", "unsubscribe", "jsxs", "defaultValue", "onChange", "isControlled", "wasControlled", "handleChange", "ActiveEmojiAnnouncer", "memo", "onScroll", "onKeyDown", "rowsCount", "categoriesCount", "handleScroll", "resizeObserver", "entry", "width", "height", "onViewportSizeChange", "listEmojiProps", "isActive", "listRowProps", "sizer", "listCategoryProps", "listCategoryHeaderProps", "listSizerProps", "previousHeadersCount", "listProps", "preventDefault", "EmojiPickerListEmoji", "Emoji", "handleSelect", "handlePointerEnter", "handlePointerLeave", "EmojiPickerListRow", "Row", "EmojiPickerListCategory", "CategoryHeader", "EmojiPickerListSizers", "rowRef", "categoryHeaderRef", "entries", "onRowHeightChange", "onCategoryHeaderHeightChange", "DefaultEmojiPickerListCategoryHeader", "DefaultEmojiPickerListEmoji", "DefaultEmojiPickerListRow", "components", "categoriesRowsStartIndices", "Fragment", "onClick", "ariaLabel", "skinToneVariationIndex", "variation", "skinToneVariation", "nextSkinTone", "skinToneLabel", "nextSkinToneLabel", "handleClick", "EmojiPickerEmptyWithSearch", "$", "isOpen", "Root2", "Portal", "Content2", "EmojiPickerPrimitive", "Tooltip", "Tooltip", "insertText", "ComposerMention", "$", "Toggle", "ComposerFloatingToolbar", "ComposerLink", "isEmpty", "useLayoutEffect", "useControllableState", "_a", "React", "React", "import_react", "import_jsx_runtime", "import_react", "import_jsx_runtime", "PROVIDER_NAME", "createCollectionScope", "React", "useCollection", "React", "import_jsx_runtime", "React", "import_jsx_runtime", "EVENT_OPTIONS", "node", "focusFirst", "_", "index", "Root", "import_jsx_runtime", "Collection", "useCollection", "createCollectionScope", "usePopperScope", "ANCHOR_NAME", "PORTAL_NAME", "PortalProvider", "usePortalContext", "CONTENT_NAME", "Slot", "_a", "Root", "focusFirst", "GROUP_NAME", "ITEM_NAME", "ARROW_NAME", "Arrow", "trigger", "wrapArray", "_", "index", "v", "isPointInPolygon", "point", "x", "Anchor", "Portal", "Content", "Group", "Item", "import_jsx_runtime", "Root3", "TRIGGER_NAME", "PORTAL_NAME", "Portal", "CONTENT_NAME", "Content2", "_a", "GROUP_NAME", "Group", "LABEL_NAME", "ITEM_NAME", "CHECKBOX_ITEM_NAME", "RADIO_GROUP_NAME", "RADIO_ITEM_NAME", "SEPARATOR_NAME", "ARROW_NAME", "Arrow2", "SUB_TRIGGER_NAME", "SUB_CONTENT_NAME", "Root", "Portal", "Content", "$", "Root2", "Portal2", "Content2", "CommentMention", "CommentLink", "Anchor", "$", "Tooltip", "Root", "_a", "version", "$", "index", "$", "CommentPrimitive.Body", "CommentMention", "_a", "$", "Anchor", "Component", "Tooltip", "subscribe", "index", "$", "index", "_a", "subscribe", "isHidden", "Tooltip", "Root", "PKG_NAME", "PKG_VERSION", "PKG_FORMAT", "Thread", "DefaultThread", "positions", "_a", "next", "position", "thread", "useLayoutEffect", "offset", "FloatingComposer", "Composer", "DefaultComposer", "_a", "x", "inline", "flip", "offset", "hide", "shift", "limitShift", "size", "useLayoutEffect", "Thread", "DefaultThread", "_a", "next", "ThreadWrapper", "x", "flip", "offset", "hide", "shift", "limitShift", "size", "useLayoutEffect", "it", "l", "u", "encodeURI", "offset", "v", "create", "transact", "count", "range", "range", "first", "range", "create", "t", "transact", "count", "create", "transact", "min", "shift", "_", "msg", "isLE", "_32n", "l", "n", "le", "l", "l", "l", "B", "C", "D", "E", "F", "G", "H", "offset", "W2", "n", "PKG_NAME", "PKG_VERSION", "PKG_FORMAT", "create", "set", "Observable", "_a", "applyUpdate", "e", "options", "IndexeddbPersistence", "Base64", "_", "DerivedSignal", "fragment", "_a", "Comment", "node", "_a", "from", "threadId", "view", "v", "_a", "from", "findSuggestionMatch", "defaultFindSuggestionMatch", "next", "_e", "range", "isEmpty", "node", "Node", "node", "Node", "node", "x", "flip", "offset", "hide", "shift", "limitShift", "size", "useLayoutEffect", "index", "node", "fragment", "range", "_a", "e", "getSnapshot", "subscribe", "options", "t", "self", "node", "previous", "useLayoutEffect", "React", "ReactDOM", "clamp", "min", "max", "React", "import_jsx_runtime", "SELECTION_KEYS", "Collection", "useCollection", "createCollectionScope", "usePopperScope", "trigger", "TRIGGER_NAME", "useLayoutEffect2", "PORTAL_NAME", "CONTENT_NAME", "fragment", "Slot", "node", "focusFirst", "_a", "clamp", "GROUP_NAME", "LABEL_NAME", "ITEM_NAME", "ITEM_INDICATOR_NAME", "handleScroll", "canScrollUp", "canScrollDown", "SEPARATOR_NAME", "ARROW_NAME", "Arrow", "select", "wrapArray", "v", "_", "index", "Root", "Trigger", "Portal", "Content", "Item", "FLOATING_ELEMENT_COLLISION_PADDING", "Component", "Root", "editor", "item", "Root2", "Trigger", "Portal", "Content2", "Item", "_a", "before", "after", "before", "after", "editor", "from", "range", "handleFocus", "handleBlur", "_a", "inline", "flip", "hide", "shift", "limitShift", "offset", "size", "x", "handlePointerDown", "useLayoutEffect", "AUTHORS_TRUNCATE", "version", "$", "e", "node", "PKG_NAME", "PKG_VERSION", "PKG_FORMAT"]
}
